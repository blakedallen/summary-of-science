{"id": "http://arxiv.org/abs/1008.5126v3", "guidislink": true, "updated": "2012-03-12T13:39:51Z", "updated_parsed": [2012, 3, 12, 13, 39, 51, 0, 72, 0], "published": "2010-08-30T17:44:55Z", "published_parsed": [2010, 8, 30, 17, 44, 55, 0, 242, 0], "title": "Monotonically convergent optimization in quantum control using Krotov's\n  method", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1008.4884%2C1008.1580%2C1008.0675%2C1008.5376%2C1008.1538%2C1008.2671%2C1008.4072%2C1008.1435%2C1008.4806%2C1008.5051%2C1008.4467%2C1008.4979%2C1008.1423%2C1008.5126%2C1008.4350%2C1008.4959%2C1008.3562%2C1008.1468%2C1008.3953%2C1008.3011%2C1008.2460%2C1008.3166%2C1008.3666%2C1008.1655%2C1008.4401%2C1008.4911%2C1008.3179%2C1008.2649%2C1008.4800%2C1008.0247%2C1008.3001%2C1008.0465%2C1008.4764%2C1008.3131%2C1008.3689%2C1008.0656%2C1008.2167%2C1008.2897%2C1008.0816%2C1008.0453%2C1008.1529%2C1008.3873%2C1008.1834%2C1008.2497%2C1008.0957%2C1008.2324%2C1008.4939%2C1008.4077%2C1008.1509%2C1008.4445%2C1008.4745%2C1008.1315%2C1008.0973%2C1008.4762%2C1008.5194%2C1008.3924%2C1008.0447%2C1008.1162%2C1008.0508%2C1008.2280%2C1008.3820%2C1008.0502%2C1008.2744%2C1008.4926%2C1008.0196%2C1008.1089%2C1008.0187%2C1008.2229%2C1008.2379%2C1008.0279%2C1008.1034%2C1008.1997%2C1008.5104%2C1008.3863%2C1008.0102%2C1008.1673%2C1008.4179%2C1008.0150%2C1008.2941%2C1008.1725%2C1008.4739%2C1008.3071%2C1008.0947%2C1008.5073%2C1008.1841%2C1008.5072%2C1008.3292%2C1008.2910%2C1008.0442%2C1008.3603%2C1008.4897%2C1008.0842%2C1008.0287%2C1008.0874%2C1008.3796%2C1008.2461%2C1008.3594%2C1008.5043%2C1008.5387%2C1008.1848%2C1008.2847&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Monotonically convergent optimization in quantum control using Krotov's\n  method"}, "summary": "The non-linear optimization method developed by Konnov and Krotov [Automation\nand Remote Control 60, 1427 (1999)] has been used previously to extend the\ncapabilities of optimal control theory from the linear to the non-linear\nSchr\\\"odinger equation [Sklarz and Tannor, Phys. Rev. A 66, 053619 (2002)].\nHere we show that based on the Konnov-Krotov method, monotonically convergent\nalgorithms are obtained for a large class of quantum control problems. It\nincludes, in addition to non-linear equations of motion, control problems that\nare characterized by non-unitary time evolution, non-linear dependencies of the\nHamiltonian on the control, time-dependent targets and optimization functionals\nthat depend to higher than second order on the time-evolving states. We\nfurthermore show that the non-linear (second order) contribution can be\nestimated either analytically or numerically, yielding readily applicable\noptimization algorithms. We demonstrate monotonic convergence for an\noptimization functional that is an eighth-degree polynomial in the states. For\nthe 'standard' quantum control problem of a convex final-time functional,\nlinear equations of motion and linear dependency of the Hamiltonian on the\nfield, the second-order contribution is not required for monotonic convergence\nbut can be used to speed up convergence. We demonstrate this by comparing the\nperformance of first and second order algorithms for two examples.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1008.4884%2C1008.1580%2C1008.0675%2C1008.5376%2C1008.1538%2C1008.2671%2C1008.4072%2C1008.1435%2C1008.4806%2C1008.5051%2C1008.4467%2C1008.4979%2C1008.1423%2C1008.5126%2C1008.4350%2C1008.4959%2C1008.3562%2C1008.1468%2C1008.3953%2C1008.3011%2C1008.2460%2C1008.3166%2C1008.3666%2C1008.1655%2C1008.4401%2C1008.4911%2C1008.3179%2C1008.2649%2C1008.4800%2C1008.0247%2C1008.3001%2C1008.0465%2C1008.4764%2C1008.3131%2C1008.3689%2C1008.0656%2C1008.2167%2C1008.2897%2C1008.0816%2C1008.0453%2C1008.1529%2C1008.3873%2C1008.1834%2C1008.2497%2C1008.0957%2C1008.2324%2C1008.4939%2C1008.4077%2C1008.1509%2C1008.4445%2C1008.4745%2C1008.1315%2C1008.0973%2C1008.4762%2C1008.5194%2C1008.3924%2C1008.0447%2C1008.1162%2C1008.0508%2C1008.2280%2C1008.3820%2C1008.0502%2C1008.2744%2C1008.4926%2C1008.0196%2C1008.1089%2C1008.0187%2C1008.2229%2C1008.2379%2C1008.0279%2C1008.1034%2C1008.1997%2C1008.5104%2C1008.3863%2C1008.0102%2C1008.1673%2C1008.4179%2C1008.0150%2C1008.2941%2C1008.1725%2C1008.4739%2C1008.3071%2C1008.0947%2C1008.5073%2C1008.1841%2C1008.5072%2C1008.3292%2C1008.2910%2C1008.0442%2C1008.3603%2C1008.4897%2C1008.0842%2C1008.0287%2C1008.0874%2C1008.3796%2C1008.2461%2C1008.3594%2C1008.5043%2C1008.5387%2C1008.1848%2C1008.2847&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "The non-linear optimization method developed by Konnov and Krotov [Automation\nand Remote Control 60, 1427 (1999)] has been used previously to extend the\ncapabilities of optimal control theory from the linear to the non-linear\nSchr\\\"odinger equation [Sklarz and Tannor, Phys. Rev. A 66, 053619 (2002)].\nHere we show that based on the Konnov-Krotov method, monotonically convergent\nalgorithms are obtained for a large class of quantum control problems. It\nincludes, in addition to non-linear equations of motion, control problems that\nare characterized by non-unitary time evolution, non-linear dependencies of the\nHamiltonian on the control, time-dependent targets and optimization functionals\nthat depend to higher than second order on the time-evolving states. We\nfurthermore show that the non-linear (second order) contribution can be\nestimated either analytically or numerically, yielding readily applicable\noptimization algorithms. We demonstrate monotonic convergence for an\noptimization functional that is an eighth-degree polynomial in the states. For\nthe 'standard' quantum control problem of a convex final-time functional,\nlinear equations of motion and linear dependency of the Hamiltonian on the\nfield, the second-order contribution is not required for monotonic convergence\nbut can be used to speed up convergence. We demonstrate this by comparing the\nperformance of first and second order algorithms for two examples."}, "authors": ["Daniel Reich", "Mamadou Ndong", "Christiane P. Koch"], "author_detail": {"name": "Christiane P. Koch"}, "author": "Christiane P. Koch", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1063/1.3691827", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/1008.5126v3", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/1008.5126v3", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "quant-ph", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "quant-ph", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/1008.5126v3", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/1008.5126v3", "arxiv_comment": null, "journal_reference": "J. Chem. Phys. 136, 104103 (2012)", "doi": "10.1063/1.3691827", "fulltext": "Monotonically convergent optimization in quantum control using Krotov's method\nDaniel M. Reich,1, 2 Mamadou Ndong,1 and Christiane P. Koch1, 2, \u2217\n\narXiv:1008.5126v3 [quant-ph] 12 Mar 2012\n\n1\n\nInstitut f\u00fcr Theoretische Physik, Freie Universit\u00e4t Berlin, Arnimallee 14, 14195 Berlin, Germany\n2\nTheoretische Physik, Universit\u00e4t Kassel, Heinrich-Plett-Str. 40, 34132 Kassel, Germany\n(Dated: June 6, 2018)\n\nThe non-linear optimization method developed by Konnov and Krotov [Automation and Remote\nControl 60, 1427 (1999)] has been used previously to extend the capabilities of optimal control theory from the linear to the non-linear Schr\u00f6dinger equation [Sklarz and Tannor, Phys. Rev. A 66,\n053619 (2002)]. Here we show that based on the Konnov-Krotov method, monotonically convergent\nalgorithms are obtained for a large class of quantum control problems. It includes, in addition to nonlinear equations of motion, control problems that are characterized by non-unitary time evolution,\nnon-linear dependencies of the Hamiltonian on the control, time-dependent targets and optimization\nfunctionals that depend to higher than second order on the time-evolving states. We furthermore\nshow that the non-linear (second order) contribution can be estimated either analytically or numerically, yielding readily applicable optimization algorithms. We demonstrate monotonic convergence\nfor an optimization functional that is an eighth-degree polynomial in the states. For the 'standard'\nquantum control problem of a convex final-time functional, linear equations of motion and linear\ndependency of the Hamiltonian on the field, the second-order contribution is not required for monotonic convergence but can be used to speed up convergence. We demonstrate this by comparing the\nperformance of first and second order algorithms for two examples.\nPACS numbers:\n\nI.\n\nINTRODUCTION\n\nQuantum control of light and matter uses external\nfields to engineer constructive and destructive interferences to steer a physical process into a desired direction [1, 2]. The idea was pioneered in the 1980s [3\u20136]\nand gained wide-spread attention with the advent of femtosecond lasers and pulse shaping techniques [7]. It was\nrealized at about the same time that constructive and destructive interferences need not be devised by hand but\ncan rather be obtained employing concepts from engineering such as feedback and optimization [7\u201311]. This\nhas significantly broadened the range of quantum control\nproblems that can be tackled. In particular, optimal control theory (OCT) has become a popular tool employed\nin areas as different as vibrational dynamics of complex\nmolecules [12, 13], quantum dots and rings [14, 15], ultracold gases [16\u201319], multi-photon excitations [20, 21],\nnuclear magnetic resonance [22, 23] and quantum information [24\u201326].\nAll these applications are based on quantum dynamics,\nbut differ in their (i) equation of motion, (ii) dependence\nof the Hamiltonian on the control, and (iii) target functional. (i) In standard applications of OCT to quantum\ncontrol, the equation of motion is the linear Schr\u00f6dinger\nequation, e.g., Refs. [8, 17, 24, 25]. OCT can also be\napplied to examples with a non-linear equation of motion [13, 16, 19] which is obtained as an effective description in the framework of the mean-field approximation.\n(ii) The dependence of the Hamiltonian on the control is\n\n\u2217 Electronic\n\naddress: christiane.koch@uni-kassel.de\n\nlinear in most applications of OCT from atomic, molecular and chemical physics, reflecting a laser field driving optically allowed transitions. This is changed to a\nnon-linear dependence if multi-photon excitations [20, 21]\nor a parametrization of the control field [19] is considered. (iii) Linear and bilinear target functionals have\ncommonly been used in application of OCT to quantum control to date [27]. However, target functionals\nthat are higher order polynomials in the states of the\nsystem may be encountered in quantum information applications [28]. The type of dynamics and functionals\ntranslates into different requirements that must be met\nby the optimization algorithm. In particular for nonlinear equations of motion, non-linear dependencies of\nthe Hamiltonian on the control, time-dependent targets\nwhere the target operator is non-semidefinite and target functionals that are higher order polynomials in the\nstates, it is not straightforward to construct monotonically convergent algorithms. This is the problem that we\naddress here.\nWe utilize the non-linear optimization algorithm by\nKonnov and Krotov [29] which had been translated to\nthe language of quantum mechanics and first employed\nfor solving a quantum control problem by Sklarz and\nTannor [16]. Specifically, Sklarz and Tannor realized\nthat a generalized form of the optimization functional\nyielding modified adjoint states is required in order to\napply OCT to a non-linear Schr\u00f6dinger equation [16].\nWe show that the work by Sklarz and Tannor applies\nalso to quantum control problems that are characterized\nby non-unitary time evolution, time-dependent targets,\nnon-linear dependencies of the Hamiltonian on the control and target functionals that depend to higher than\nsecond order on the time-evolving states. Translating\nthe original proof by Konnov and Krotov [29] to quan-\n\n\f2\ntum control, we furthermore show that the parameters\nof the optimization algorithm can be estimated analytically or numerically. We can thus give a ready-to-use\nprescription of the algorithm where the parameters are\ndetermined by the physics of the problem. For the case\nof a quadratic functional and linear equations of motion,\na first order construction of Krotov's method is sufficient\nto guarantee monotonic convergence [16, 27]. We show\nthat in this case, a second order contribution may still\nbe used to speed up convergence.\nThe paper is organized as follows. The optimization\nalgorithm and the estimate of the algorithm's parameters\nare presented in Section II with all mathematical details\nof the derivation found in the appendices. Sections III\nand IV are devoted to applications of the optimization\nalgorithm. We demonstrate monotonic convergence for\none example that requires a second order construction in\nSection III, and we present two examples in Section IV\nfor which the second order construction is not required\nbut may be used to speed up convergence. Section V\nconcludes.\n\nII.\n\nOPTIMIZATION ALGORITHM\n\nA.\n\nControl problem\n\nThe control problem is characterized by stating the\ncontrol target and possible additional costs in functional\nform,\n\nJ = JT [{\u03c6k (T )}] +\n\nZ\n\nT\n\nJt [{\u03c6k (t)}, \u01eb(t)] dt ,\n\n(1)\n\n0\n\nwhere we have separated final-time T and intermediatetime t 'costs'. {\u03c6k (t)} denotes a set of complex state\nvectors [46] and \u01eb(t) is the external field or control that\nshall be optimized. The final-time cost is typically specified in terms of some desired unitary operator \u00d4, for\nexample [27],\n\no2\nn \u2020\n\u03bb0\nTr\n\u00d4\nP\u0302\n\u00db(T,\n0;\n\u01eb)\nP\u0302\nN\nN\nN2\nN\n\u03bb0 X\n\u2020\n=\u2212 2\nh\u03c6k (t = 0)|\u00d4 \u00db(T, 0; \u01eb)|\u03c6k (t = 0)ih\u03c6k\u2032 (t = 0)|\u00db(T, 0; \u01eb)\u2020 \u00d4|\u03c6k\u2032 (t = 0)i .\nN\n\u2032\n\nJT [{\u03c6k (T )}] = \u2212\n\n(2)\n\nk,k =1\n\nHere, \u00db(T, 0; \u01eb) denotes the time evolution operator from\nthe initial time t = 0 to the final time T under the action of the field \u01eb, and \u03bb0 is a weight. The dimension\nof the subspace of the total Hilbert space, H, on which\nthe target operator \u00d4 acts, HO , is denoted by N , and\nP\u0302N is the projector onto HO . {|\u03c6k (t = 0)i} \u2261 {|ki} is\na suitable orthonormal basis spanning this subspace. A\nsingle state-to-state transition is obtained by taking \u00d4\nto be the projector onto the target state, i.e. N = 1. In\norder to optimize one-qubit or two-qubit quantum gates,\nN = 2 and N = 4, respectively. The functional is normalized by 1/N 2 such that the optimum corresponds to\nthe weight JT = \u2212\u03bb0 .\nThe functional of Eq. (2) is quadratic in the states\nat final time {\u03c6k (T )}. A linear dependence is obtained\nby taking the real part instead of the square modulus\nof the trace and yields a phase-sensitive functional [27].\nGenerally, expressing the functionals in terms of expectation values yields at most a quadratic dependence on\nthe states. A functional that is a higher order polynomial\nin the states is obtained in the context of quantum information when optimizing for a certain degree of entanglement rather than a specific unitary transformation [28],\nsee Section III below.\n\nThe intermediate-time cost Jt ,\nJt [{\u03c6k (t)}, \u01eb] = g [{|\u03c6k (t)i}, \u01eb(t), t]\n= ga [\u01eb(t), t] + gb [{\u03c6k (t)}, t] ,\n\n(3)\n\nis typically used to minimize the field intensity and to\nswitch the field smoothly on and off,\nga [\u01eb(t)] =\n\n\u03bba\n2\n[\u01eb(t) \u2212 \u01ebref (t)] ,\nS(t)\n\n(4)\n\nwhere \u01ebref (t) denotes some reference field, S(t) is a positive (shape) function and \u03bba a weight. Jt can also be\nused to formulate time-dependent targets [30\u201332] or constraints that depend on the state of the system at intermediate times [33] such as\ngb [{\u03c6k (t)}] =\n\nN\n\u03bbb X\nh\u03c6k (t)|D\u0302(t)|\u03c6k (t)i ,\nTN\n\n(5)\n\nk=1\n\nwhere the dependence on the states again is quadratic.\nWhile complicated dependencies of ga [\u01eb] and gb [{\u03c6k }]\nare conceivable, we require ga [\u01eb] and gb [{\u03c6k }] to be additive, cf. Eq. (3). This assumption is typically justified\nsince costs or penalties involving the field are usually not\nrelated to costs concerning the dynamics of the system.\n\n\f3\nThe time evolution operator required to evaluate the\nfunctional, Eq. (2), can be obtained by solving the equation of motion for each of the basis states,\nd\ni\n|\u03c6k (t)i = \u2212 \u0124[\u03c6k , \u01eb]|\u03c6k (t)i ,\ndt\n~\n= |fk (\u03c6k , \u01eb)i , k = 1, . . . , N .\n\n(6)\n\nAn explicit dependency of the Hamiltonian on the state,\n\u0124[\u03c6k ], will occur for non-linear Schr\u00f6dinger equations\nsuch as the Gross-Pitaevski equation or Hartree-Focklike equations where the Hamiltonian is second order in\nthe states [13, 16, 19, 34]. The dependency of the Hamiltonian on the field can be linear, corresponding to onephoton dipole coupling, or higher order for non-resonant\nmulti-photon transitions. Equation (6) can be extended\nto account for non-unitary time evolution by considering\nthe density operator to be a vector in Liouville space and\nreplacing the Hamiltonian by the Liouvillian [35].\nB.\n\nIt is sufficient to expand the functional \u03a6({|\u03c6k i}, t) up to\nsecond order in the states to ensure the necessary monotonicity conditions for arbitrary change of the state vectors,\n\n\u03a6({\u03c6k }, t) =\n\nX\u0014\nk\n\n+\n\n\u0015\nh\u03c7k (t)|\u03c6k (t)i + h\u03c6k (t)|\u03c7k (t)i\n\n1X\nh\u2206\u03c6k (t)|\u03c3\u0302(t)|\u2206\u03c6l (t)i ,\n2\n\n(8)\n\nkl\n\nOptimization equations\n\nThe essence of Krotov's method [16, 29] consists in disentangling the interdependency of the states and the control by constructing an auxiliary functional L[{\u03c6k }, \u01eb, \u03a6]\nthat depends on the states, the control and an arbitrary\nscalar potential \u03a6 such that for any \u03a6, L[{\u03c6k }, \u01eb, \u03a6] and\nJ[{\u03c6k }, \u01eb] are identical and minimization of L[{\u03c6k }, \u01eb, \u03a6]\nis completely equivalent to minimization of J[{\u03c6k }, \u01eb].\nThis is achieved by adding a vanishing quantity,\nL[{\u03c6k }, \u01eb, \u03a6] = G({\u03c6k (T )}) \u2212 \u03a6({\u03c6k (0)}, 0)\nZ T\nR({\u03c6k (t)}, \u01eb(t), t)dt\n\u2212\n\n(7)\n\n0\n\nwith first order expansion coefficients \u03c7k (t) and \u2206\u03c6k (t)\nthe change in the state \u03c6k (t), given by \u2206\u03c6k (t) =\n(i+1)\n(i)\n\u03c6k\n(t) \u2212 \u03c6k (t) where the superscripts (i) and (i + 1)\ndenote propagation under the old and new fields, \u01eb(i) (t)\nand \u01eb(i+1) (t), respectively. Due to the freedom of choice\nin \u03a6, the operator \u03c3\u0302(t) in the second order term can be\nchosen to ensure the extremum condition with respect to\nthe state changes. If J is to be minimized, \u03c3\u0302(t) will be\nchosen to maximize it with respect to the change in the\nstates. Any change in the field leads then to monotonic\ndecrease of J [16, 29].\n\nwith\nG [{\u03c6k (T )}] = JT [{\u03c6k (T )}] + \u03a6({\u03c6k (T )}, T ) ,\nR [{\u03c6k (t)}, \u01eb(t), t] = \u2212 (ga [\u01eb(t), t] + gb [{\u03c6k (t)}, t])\n+\n\n+\n\n\u2202\u03a6\n+\n\u2202t\nN\nX\n\nN\nX\n\nk=1\n\n\u2207|\u03c6k i \u03a6 * |fk [\u03c6k , \u01eb, t]i\n\nhfk [\u03c6k , \u01eb, t]| * \u2207h\u03c6k | \u03a6 .\n\nRequiring the first order derivatives of L with respect\nto |\u03c6k (t)i, h\u03c6k (t)| and \u01eb(t) to vanish, yields a set of coupled control equations for the first order expansion coefficients \u03c7k (t) and the field. Since all involved functionals\nare real, it is sufficient to state the equation for the kets,\nthe bra equations being given by the adjoints,\n\nk=1\n\n\"\n#\nX (i)\ni \u2020 (i) (i) (i)\ni X (i)\n\u2020 (i) (i)\nd (i)\n(i)\n(i) (i)\n(i)\n|\u03c7 (t)i = \u2212 \u0124 [\u03c6k , \u01eb ]|\u03c7k i \u2212\n\u03c6l \u2207|\u03c6k i \u0124 [\u03c6k , \u01eb ] \u03c7l \u2212\n\u03c7l \u2207h\u03c6k | \u0124[\u03c6k , \u01eb ] \u03c6l\ndt k\n~\n~\nl\n\n+\u2207h\u03c6k | gb\n\n(i)\n\n|\u03c6k (t)i\n\n,\n\n(i)\n\n|\u03c7k (T )i = \u2212\u2207h\u03c6k | JT\n\n(i)\n\n|\u03c6k (T )i\n\nl\n\n(9a)\n\n,\n\nk = 1, . . . , N .\n\nThe 'initial' condition at the final time T is given in terms\n\n(9b)\n\nof the gradient with respect to the states of the final-time\n\n\f4\ncost, JT . Note that all gradients in Eqs. (9) are evaluated\n(i)\nwith the states \u03c6k that are forward propagated under\nthe old field, \u01eb(i) as indicated by the superscript (i). The\n\n\u2202g\n\u2202\u01eb\n\n= 2Im\n\u01eb(i+1) ,|\u03c6(i+1) i\n\n\"\n\nN\nX\n\nk=1\n\n*\n\n(i)\n\u03c7k (t)\n\n\u2202 \u0124\n\u2202\u01eb\n\n\u01eb(i+1) ,\u03c6(i+1)\n\n+\n\n(i+1)\n\u03c6k\n(t)\n\nIt involves backward propagation of the adjoint states\n(i)\nunder the old field, \u03c7k (t), and forward propagation of\n(i+1)\nthe states, \u03c6k\n(t), under the new field,\ni\nd (i+1)\n(i+1) (i+1)\n(i+1)\n|\u03c6\n(t)i = \u2212 \u0124[\u03c6k\n,\u01eb\n]|\u03c6k\n(t)i(11a)\ndt k\n~\n(i+1)\n|\u03c6k\n(0)i = |ki , k = 1, . . . , N .\n(11b)\nEquations (9)-(11) need to be solved simultaneously.\n\n\u01eb(i+1) (t) = \u01ebref (t) +\n(N *\nX\n\u2202 \u0124\nS(t)\n(i)\nIm\n\u03c7k (t)\n\u03bba\n\u2202\u01eb\nk=1\n\n(i+1)\n\n\u01eb(i+1) ,\u03c6(i+1)\n\n\u03c6k\n\nMoreover, for dipole transitions the Hamiltonian is given\nby \u0124 = \u01240 + \u03bc\u0302\u01eb(t); and hence \u2202 \u0124/\u2202\u01eb = \u03bc\u0302. We\nthus recover the familiar prescription for the change in\nfield obtained for a first order construction of the algorithm [27] plus an additional second order contribution,\n(i+1)\ngiven in terms of the change in the states, \u2206\u03c6k\n(t),\nwith 'weight' \u03c3(t).\nA choice of \u03c3(t) that guarantees a maximum of L with\nrespect to the states (i.e., a positive second derivative of\nR and negative second derivative of G) is given by [29]\n\u0012\n\u0013\nC\u0304\nC\u0304\n\u03c3(t) = eB\u0304(T \u2212t)\n\u2212 \u0100 \u2212\nfor B\u0304 6= 0 ,(13a)\nB\u0304\nB\u0304\n\u03c3(t) = C\u0304(T \u2212 t) \u2212 \u0100\nfor B\u0304 = 0 . (13b)\nThe physics of the problem, i.e., the dependency of the\nfunctional on the states, the dependency of the Hamiltonian on the control, (non-)linearity of the equation of\nmotion governing and unitary or non-unitary of the time\nevolution, determine the parameters \u0100, B\u0304 and C\u0304,\n\u0100 = max (\u03b5A , 2A + \u03b5A ) ,\nB\u0304 = 2B + \u03b5B ,\nC\u0304 = min (\u2212\u03b5C , 2C \u2212 \u03b5C ) ,\n\nprescription for the new field is obtained by evaluating\nthe derivative of the constraints with respect to the field,\n\n(14a)\n(14b)\n(14c)\n\n*\nN\nX\n\u2202 \u0124\n1\n\u2206\u03c6k (t)\n+ \u03c3(t)\n2\n\u2202\u01eb\nk=1\n\n\u01eb(i+1) ,\u03c6(i+1)\n\n+#\n\n(i+1)\n\u03c6k\n(t)\n\n.\n\n(10)\n\nThe iteration is started by propagating Eqs. (11) under\n(0)\nsome guess field, \u01eb(0) (t), to obtain \u03c6k (T ) and evaluate\nEq. (9b). The equation for the backward propagation,\nEq. (9a), becomes an inhomogeneous Schr\u00f6dinger equation for non-linear equations of motion, cf. the terms in\nsquare brackets, or if the intermediate-time cost, gb , depends on the states (\u2207h\u03c6k | gb 6= 0). If the time-dependent\ncost over the field takes the form of Eq. (4), the equation\nfor the new field reads\n\n+\n\n(t)\n\nN\n\n*\n\nX\n1\n\u2202 \u0124\n+ \u03c3(t)\n\u2206\u03c6k (t)\n2\n\u2202\u01eb\nk=1\n\n(i+1)\n\n\u01eb(i+1) ,\u03c6(i+1)\n\n\u03c6k\n\n(12)\n+)\n\n(t)\n\n.\n\nwhere the \u03b5i are non-negative numbers that can be used\nto enforce strict inequality [47]. It should be emphasized,\nthat only in cases where A, B and C all turn out to\nbe zero, the linear version of Krotov's method [27] is\nsufficient to guarantee monotonic convergence.\n\nC.\n\nParameters of the second order contribution\n\nFor quantum control problems the parameters\nA, B and C can either be estimated analytically or approximated numerically by considering\n(i+1)\n(i)\n\u2206G = G({\u03c6k\n(T )}) \u2212 G({\u03c6k (T )}) and \u2206R =\n(i+1)\n(i)\nR({\u03c6k\n(t)}, \u01eb(i) (t), t) \u2212 R({\u03c6k (t)}, \u01eb(i) (t), t) and guaranteeing their negativity and positivity, respectively. The\nanalytical estimate is based on a worst case scenario and\nstrictly guarantees monotonic convergence. The worst\ncase scenario may, however, not always be required and\na more efficient while less fail-proof approach is given by\nnumerical approximation of A, B and C.\nThe analytical estimate of A is obtained by requiring\n\u2206G \u2264 0. This is guaranteed if\n\n\f5\n\nPN\n\nk=1\n\nA = sup\n{\u2206\u03c6k }\n\n\u0010\n\u0011\n\u0010\n\u0011\n(i)\n(i)\n[h\u03c7k (T ) | \u2206\u03c6k (T )i + h\u2206\u03c6k (T ) | \u03c7k (T )i] + JT {\u03c6k (T ) + \u2206\u03c6k (T )} \u2212 JT {\u03c6k (T )}\n,\nPN\nk=1 [h\u2206\u03c6k (T ) | \u2206\u03c6k (T )i]\n\nwhere the supremum needs to be taken over all sets\nof possible state change vectors {\u2206\u03c6k (T )} with norm\nPN\nk=1 h\u2206\u03c6k (T ) | \u2206\u03c6k (T )i between zero and 2N . Konnov\nand Krotov proved [29] that, under certain conditions\nwhich are almost trivially fulfilled for quantum systems,\nquantities like the one on the right-hand side of Eq. (15)\nand similar ones obtained for B and C exist and are welldefined, see also Appendix A. We discuss in Appendix B\nhow Konnov's and Krotov's proof simplifies for quantum\nsystems such that the supremum in Eq. (15) can be estimated. Specifically, we show in Appendix C that the\nargument of the supremum in Eq. (15) can be rewritten\nin terms of a Taylor series of JT that starts at the second order. The series can be estimated by its Lagrange\nremainder,\nA\u2264\n\n1\nsup\n\u2202 \u03b1 JT ({\u2206\u03c6k (T )}) ,\n2 {\u2206\u03c6k };|\u03b1|=2\n\n(16)\n\n(15)\n\ni.e., A is given by the supremum over the second derivatives of the final-time functional, JT , with respect to the\nstates, \u03c6k (T ). The multi-index \u03b1 and derivative \u2202 \u03b1 are\ndefined in Eqs. (C2) and (C3), respectively. For functionals JT that are linear or convex in \u03c6k (T ), i.e. those for\nwhich the second derivatives vanish or are always nonpositive, A \u2264 0. For simplicity one can then choose\nA = 0, \u03b5A = 0 such that \u0100 = 0.\n\nThe analytical estimates of B and C are obtained by\nrequiring \u2206R \u2265 0 where\n\n\"\n\nPN\n[h\u2206\u03c6k (t) | \u2206fk (t)i + h\u2206fk (t) | \u2206\u03c6k (t)i]\n1\n\u2206R ({\u2206\u03c6(t)}, t) =\n[h\u2206\u03c6k (t) | \u2206\u03c6k (t)i] \u03c3\u0307(t) + \u03c3(t) k=1\nPN\n2\nk=1 [h\u2206\u03c6k (t) | \u2206\u03c6k (t)i]\nk=1\n#\nPN\nk=1 [h\u03c7\u0307k (t) | \u2206\u03c6k (t)i + h\u2206\u03c6k (t) | \u03c7\u0307k (t)i + h\u03c7k (t) | \u2206fk (t)i + h\u2206fk (t) | \u03c7k (t)i] \u2212 \u2206g\n. (17)\n+\nPN\nk=1 [h\u2206\u03c6k (t) | \u2206\u03c6k (t)i]\nN\nX\n\nThe second summand in the square brackets determines\nB and the third one C. \u2206fk and \u2206g describe the change,\ndue to changes in the states, in the equations of motion,\n\nand in the constraint,\n(i)\n\n\u2206g({\u2206\u03c6k }, t) = g({\u03c6k (t) + \u2206\u03c6k (t)}, \u01eb(i) (t), t)\n(i)\n\n\u2212g({\u03c6k (t)}, \u01eb(i) (t), t) .\n\n(i)\n\n|\u2206fk (\u2206\u03c6k , t)i = |fk (\u03c6k (t) + \u2206\u03c6k (t), \u01eb(i) (t), ti\n(i)\n\n\u2212|fk (\u03c6k (t), \u01eb(i) (t), t)i ,\n\nB =\n\nsup\n{\u2206\u03c6k };t\u2208[0,T ]\n\n(18)\n\nPN\n\nk=1\n\nB is given by\n\n[h\u2206\u03c6k (t) | \u2206fk (t)i + h\u2206fk (t) | \u2206\u03c6k (t)i]\nPN\nk=1 [h\u2206\u03c6k (t) | \u2206\u03c6k (t)i]\n\nand can be rewritten in terms of a supremum over the\nTaylor expansion of the Hamiltonian starting at first\norder and a supremum over the Hamiltonian, cf. Ap-\n\n(19)\n\n(20)\n\npendix C. Estimating the Taylor series by its Lagrange\nremainder, we obtain\n\n\f6\n\n\u221a\nB \u2264 2 N\n\n\u2202 \u03b1 \u0124 (\u2206\u03c6k (t)) + 2\n\nsup\n\u2206\u03c6k ;|\u03b1|=1\nt\u2208[0,T ]\n\nsup\n{\u2206\u03c6k };t\u2208[0,T ]\n\ni.e., B can be estimated by the supremum over the first\nderivative of the Hamiltonian with respect to the states\n\u03c6(t) and a term which can be interpreted as twice the\nmaximum absolute value of the imaginary part of the\nHamiltonian's eigenvalues. For unitary time evolution\ngoverned by the standard (linear) Schr\u00f6dinger equation,\nB = 0 can easily be proven and in this case \u03c3(t) is a\n\nC =\n\nPN\n\nk=1\n\ninf\n\n{\u2206\u03c6k };t\u2208[0,T ]\n\nD\nE\n\u0001\n(i)\nIm\n\u2206\u03c6\n(t)\n\u0124\n\u2206\u03c6\n(t),\n\u01eb\n,\nt\n\u2206\u03c6\n(t)\nk\nk\nk\nk=1\n,\nPN\nk=1 [h\u2206\u03c6k (t) | \u2206\u03c6k (t)i]\n\nPN\n\n(21)\n\nlinear function of time. It is also possible to take B = 0\nfor non-unitary time evolution with linear equations of\nmotion provided A and C can taken to be zero. For nonlinear equations of motion, the supremum of the first order derivatives of the Hamiltonian needs to be evaluated\nexplicitly. C is found to be\n\n[h\u03c7\u0307k (t) | \u2206\u03c6k (t)i + h\u2206\u03c6k (t) | \u03c7\u0307k (t)i + h\u03c7k (t) | \u2206fk (t)i + h\u2206fk (t) | \u03c7k (t)i] \u2212 \u2206g\n.\nPN\nk=1 [h\u2206\u03c6k (t) | \u2206\u03c6k (t)i]\n\n(22)\n\nAs shown in Appendix C, it can be rewritten in terms of suprema of the Taylor series of the Hamiltonian and the\nconstraint, g, starting at first and second order, respectively. Estimating the Taylor series by their Lagrange remainder,\nwe obtain\n\uf8ee\n\uf8f9\nrD\nN\nE\nh\ni\nX\uf8ef\n\uf8fa\n(i)\n(i)\n\u2212C \u2265 2\nsup\n[\u2202 \u03b1 g ({\u2206\u03c6k }, t)] ,\n(23)\n\u03c7k (t) \u03c7k (t) *\nsup\n\u2202 \u03b1 \u0124 (\u2206\u03c6k , t) \uf8fb +\n\uf8f0\n\u2206\u03c6k ;t\u2208[0,T ]\n|\u03b1|=1\n\nk=1\n\ni.e., C is given by the supremum of the first order derivatives of the Hamiltonian multiplied by the norm of the\ncostates \u03c7k (t) and the supremum of the first order derivatives of the constraint, g. For linear equations of motion and gb zero or linear in \u03c6k (t), we find C = 0. The\ncase of a quadratic dependency of g on the states \u03c6k ,\ncf. Eq. (5), can also easily be handled. The second term\nin the right-hand side of Eq. (23) can then be estimated\nby the eigenvalue of the operator D\u0302(t) with largest magnitude. For example if D\u0302(t) is the projector onto some\n\nA(i+1) ({\u2206\u03c6k }) =\nand\n\n{\u2206\u03c6k };t\u2208[0,T ]\n|\u03b1|=2\n\nsubspace, D\u0302(t) = P\u0302, then\nC \u2264\u2212\n\n\u03bbb\n\u03bbb\nmax[P\u0302] = \u2212\n.\nN T EV\nNT\n\nIn order to derive a numerical approximation for the\nparameters A, B and C, we assume a finite time grid,\n{tj }, j = 1, . . . , n, and define, based on Eqs. (15), (20)\n(i+1)\n(i+1)\n,\nand Cj\nand (22), parameters A(i+1) , Bj\n\n\u0010\n\u0011\n\u0010\n\u0011\n(i)\n(i)\n[h\u03c7\n(T\n)\n|\n\u2206\u03c6\n(T\n)i\n+\nh\u2206\u03c6\n(T\n)\n|\n\u03c7\n(T\n)i]\n+\nJ\n{\u03c6\n(T\n)\n+\n\u2206\u03c6\n(T\n)}\n\u2212\nJ\n{\u03c6\n(T\n)\nk\nk\nk\nk\nT\nk\nT\nk=1\nk\nk\n(25)\n,\nPN\nk=1 [h\u2206\u03c6k (T ) | \u2206\u03c6k (T )i]\n\nPN\n\nPN\n\n[h\u2206\u03c6k (tj ) | \u2206fk (\u2206\u03c6k , tj )i + h\u2206fk (\u2206\u03c6k , tj ) | \u2206\u03c6k (tj )i]\nPN\nk=1 [h\u2206\u03c6k (tj ) | \u2206\u03c6k (tj )i]\n\u0014X\nN\n\u0002\n1\n(i+1)\nh\u03c7\u0307k (tj ) | \u2206\u03c6k (tj )i + h\u2206\u03c6k (tj ) | \u03c7\u0307k (tj )i +\n({\u2206\u03c6k }) = PN\nCj\nk=1 [h\u2206\u03c6k (tj ) | \u2206\u03c6k (tj )i] k=1\n\u0015\n\u0003\nh\u03c7k (tj ) | \u2206fk (\u2206\u03c6k , tj )i + h\u2206fk (\u2206\u03c6k , tj ) | \u03c7k (tj )i \u2212 \u2206g ({\u2206\u03c6k }, tj )\n(i+1)\n\nBj\n\n(24)\n\n({\u2206\u03c6k }) =\n\nk=1\n\n\f7\n\n(i+1)\n\nB (i+1) = sup Bj\n\n,\n\n(26a)\n\nj\n\n(i+1)\n\nC (i+1) = inf Cj\nj\n\n,\n\n(26b)\n\nand inserting the resulting numerical estimates of \u0100, B\u0304,\n(i+1)\nand C\u0304 into Eqs. (13). Since the new states \u03c6k\n(t) =\n(i+1)\n(i)\n(i+1)\n(i+1)\nand Cj\n\u03c6k (t) + \u2206\u03c6(t) are not known, A\n, Bj\nneed to be approximated, for example by the values of\n(i)\n(i)\nA(i) , Bj and Cj calculated in the previous iteration.\nIn rare cases, this approximation might lead to loss of\nmonotonic convergence. The iteration then needs to be\n\n\u2202 2 ga\n\u2202\u01eb2\n\n>\n(i+1)\n\n\u03c6k\n\n,\u01eb(i+1)\n\nN\nX\n\nk=1\n\n*\n\n\u2202 2 \u0124\n\u2202\u01eb2\n\"*\n\n(i)\n\u03c7k (t)\nN\n\nX\n1\n+ \u03c3(t)\n2\nk=1\n\n\u01eb(i+1) ,\u03c6(i+1)\n\n\u2202 2 \u0124\n\u2206\u03c6k (t)\n\u2202\u01eb2\n\n\u01eb\n\n(i+1)\n\n\u2202 2 ga\n\u2202\u01eb2 \u01eb(i+1)\n\nk=1\n\n\u01eb(i+1) ,\u03c6(i+1)\n\nFor a non-linear dependency of the Hamiltonian on the\ncontrol, we define the change in the intermediate-time\nfunctional due to changes in the control,\n(i+1)\n\n\u2206\u01eb (t) = R({\u03c6k\n\n(t)}, \u01eb(i+1) (t), t)\n\n(i+1)\n\n\u2212R({\u03c6k\n\n(t)}, \u01eb(i) (t), t) .\n\nIn any iterative optimization, convergence with respect\nto the field can only be expected towards a local extremum. Here, the local extremum condition on J trans2\nlates into \u2202\u2202\u01ebR\n2 < 0, or,\n\n+\n\n\u01eb(i+1) ,\u03c6(i+1)\n\n> 0. This translates into the sign of\n\n( N *\nX\nS(t)\n\u2202 \u0124\n(i)\n(t) = \u01eb\u0303 (t) +\nIm\n\u03c7k (t)\n\u03bba\n\u2202\u01eb\n\nD. Monotonic convergence for arbitrary\ndependence of the Hamiltonian on the control\n\n(i+1)\n\u03c6k\n(t)\n\nFor a linear dependence of the Hamiltonian on the con2 \u2020\n2\n= \u2202\u2202\u01eb\u01242 = 0, and a maximum in R requires\ntrol, \u2202\u2202\u01eb\u0124\n2\nsimply\n\n(i+1)\n\n(i+1)\n\nthat\nand Cj\nrepeated with the values of A(i+1) , Bj\nwere obtained during the failed step. Numerical estimation of the second order parameters enforces monotonic\nconvergence with respect to a change in the states as gently as possible, making use of the optimization history to\nfind a compromise between monotonicity and speed of\nthe convergence.\n\nAt iteration step (i + 1), a numerical estimate for the second order parameter, \u03c3 (i+1) (t), is obtained by replacing\nA, B, and C in Eqs. (14) by A(i+1) , Eq. (25), together\nwith\n\n+\n\nN\nX\n\nk=1\n\n*\n\n(i+1)\n\u03c6k\n(t)\n\n(i+1)\n\u03c6k\n(t)\n\n+\n\n+\n\n*\n\n\u2202 2 \u0124\n\u2202\u01eb2\n\n\u2020\n\n(i+1)\n\u03c6k\n(t)\n\n\u2202 2 \u0124\n\u2202\u01eb2\n\n\u2020\n\n+#\n\n\u2206\u03c6k (t) (27)\n.\n\u01eb(i+1) ,\u03c6(i+1)\n\nthe weight \u03bba for the typical quadratic dependence of ga\non \u01eb, cf. Eq. (4). Inserting the corresponding derivative\nof ga , we obtain\n\n+\n\n(i+1)\n\u03c6k\n(t)\n\n*\nN\nX\n1\n\u2202 \u0124\n\u2206\u03c6k (t)\n+ \u03c3(t)\n2\n\u2202\u01eb\nk=1\n\n\u01eb(i+1) ,\u03c6(i+1)\n\n(i+1)\n\u03c6k\n(t)\n\n+)\n\n(28).\n\ncontrol, we find the zeroth order term to vanish. The first\norder derivative can be rewritten using Eq. (10). The remaining terms correspond to the Taylor series starting\nat second order which can be estimated by its Lagrange\nremainder,\n\n(29)\n\nThe strict maximum condition for R becomes \u2206\u01eb (t) > 0\n\u2200t. We assume Jt , cf. Eq. (3), to be additive. Rewrit(i+1) (i+1)\n(i+1) (i)\ning \u0124[\u03c6k\n,\u01eb\n, t] \u2212 \u0124[\u03c6k\n, \u01eb , t] in terms of the\nTaylor expansion of the Hamiltonian with respect to the\n\n\u01eb(i+1) ,\u03c6(i+1)\n\n+\n\n(i)\n\u03c7k (t)\n\nM\u03032\u01eb (t) = sup\n\n\u03c6k ;\u01eb\n\nEmploying\nfurthermore\n\u221a\n2 N , we obtain\n\n\u22022\n\u0124(\u03c6k , \u01eb, t) .\n\u2202\u01eb2\nPN\n\nk=1\n\np\nh\u2206\u03c6k (t) | \u2206\u03c6k (t)i\n\n(30)\n\u2264\n\n\f8\n\n\u0010\n\u0011 \u2202g\na\n\u2206\u01eb (t) > ga (\u01eb(i) , t) \u2212 ga (\u01eb(i+1) , t) + \u01eb(i+1) (t) \u2212 \u01eb(i) (t)\n\u2202\u01eb \u01eb(i+1)\n(\n)\nN rD\nE\n\u0010\n\u00112\nX\n\u221a\n(i)\n(i)\n\u01eb\n\u01eb\n+\nN M\u03032 (t)\n\u03c7k (t) \u03c7k (t) + |\u03c3(t)|N M\u03032 (t)\n\u01eb(i+1) (t) \u2212 \u01eb(i) (t) ,\nk=1\n\nThe Lagrange remainder can be evaluated by taking the\nsecond derivative of the Hamiltonian with respect to the\nfield and estimating the norm of the resulting operator\nby its spectral radius or its eigenvalue with largest square\n\n\u2206\u01eb (t) >\n\n\"\n\n\u03bba\n\u2212\nS(t)\n\n(\n\nN\n\n1\u221a X\nN\n2\nk=1\n\n\"r\nD\n\n(i)\n\u03c7k (t)\n\nmodulus. Since it is difficult to proceed without a specific dependence of ga on \u01eb, we assume a quadratic dependence, cf. Eq. (4), and find\n\nE\n\n(i)\n\u03c7k (t)\n\n#\n\nM\u03032\u01eb (t)\n\n+\n\n)#\n\nN |\u03c3(t)|M\u03032\u01eb (t)\n\n\u0010\n\u00112\n\u01eb(i+1) (t) \u2212 \u01eb(i) (t) .\n\nMonotonic convergence is ensured by adjusting the shape function S(t) and the parameter \u03bba such that\n\"r\n#\n\u001a\n\u001b\nN\nD\nE\n\u03bba\n1\u221a X\n(i)\n(i)\nN\n>\n\u03c7k (t) \u03c7k (t) M\u03032\u01eb (t) + N |\u03c3(t)|M\u03032\u01eb (t) .\nS(t)\n2\n\n(31)\n\n(32)\n\nk=1\n\nUnlike the algorithm of Ref. [21], the numerical effort in\nour approach to ensure monotonic convergence is independent of the order of the non-linearity of the Hamiltonian's dependence on the control.\n\nTo summarize section II, a second order construction\nof the optimization algorithm yields an additional contribution to the equation for the new field. Compared to the\nlinear variant of Krotov's method [27], it simply requires\nadditional storage of the states from the previous iteration to determine \u2206\u03c6k (t) and calculation of the function\n\u03c3(t). The parameters A, B and C determining \u03c3(t) turn\nout to be zero, i.e., the second order contribution vanishes, for the 'standard' quantum control problem with\nbilinear final-time cost, intermediate-time costs that are\nindependent of the states and linear equations of motion.\nA second order contribution can nevertheless be invoked\nto study its influence on convergence. This is investigated\nbelow in Section IV B. A second order contribution is required to guarantee monotonic convergence for final-time\ncosts that are a polynomial of higher than second order\nin the states [28], demonstrated below in Section III, and\nfor general intermediate-time costs that depend on the\nstates, studied below in Section IV C. A second order\nconstruction is also required for non-unitary time evolution and for non-linear equations of motion [16, 34].\n\nIII.\n\nAPPLICATION I: HIGHER ORDER\nPOLYNOMIAL COSTS\n\nA functional that is an eighth order polynomial in the\nstates arises in quantum information when optimizing for\na local equivalence class of two-qubit gates, [\u00d4], rather\nthan a specific two-qubit gate, \u00d4 [28]. The functional is\nbased on the local invariants of two-qubit gates [36] which\nuniquely characterise a local equivalence class. The explicit, somewhat lengthy expression of JTLI is given in\nRef. [28].\nWe employ JTLI to optimize for the local equivalence\nclass of the B-gate [37], given in the logical basis by\n\u00d4B = e 2 [ 2 \u03c3\u0302x \u2297\u03c3\u0302x + 4 \u03c3\u0302y \u2297\u03c3\u0302y ]\n\uf8f6\n\uf8eb\ncos(\u03c0/8)\n0\n0\ni sin(\u03c0/8)\n0\nsin(\u03c0/8) i cos(\u03c0/8)\n0\n\uf8f7\n\uf8ec\n= \uf8ed\n\uf8f8,\n0\ni cos(\u03c0/8) sin(\u03c0/8)\n0\ni sin(\u03c0/8)\n0\n0\ncos(\u03c0/8)\ni\n\n\u03c0\n\n\u03c0\n\nfor an effective spin-spin system,\n\u0124ef f =\n\n3\n~\u03a9(t)2 X\n\u03c3\u0302 i aij (x0 )\u03c3\u0302 j .\n8 i,j=0\n\n(33)\n\nThe effective Hamiltonian is derived, within second-order\nperturbation theory, for trapped polar molecules with\n2\n\u03a31/2 electronic ground states, subject to near-resonant\nmicrowave driving that induces strong dipole-dipole coupling [38]. \u03a9(t) denotes the Rabi frequency that will\n\n\f9\n10\n\nfirst order\nsecond order, A=1\nsecond order, A=5\n\nvalue of local invariants functional\n\n1\n0.1\n\nFor more complex Hamiltonians, optimization employing\na first order construction was found to always fail [28],\nunderlying the significance of the second order construction. The analytical estimate of the second order parameter takes all worst-case scenarios into account. Therefore values smaller than the analytical estimate might\nalready be sufficient for monotonicity which is confirmed\nas shown in Fig. 1 by the blue dashed line representing\n\u0100 = 5 and the black dotted line representing \u0100 = 1 even\nthough the analytical estimate is given by \u0100 = 45. Such\na less conservative estimate yields, moreover, signficantly\nfaster convergence for small \u03bba , a fact that was also confirmed for more complex Hamiltonians [28].\n\n\u03bba = 0.133\n\n0.01\n1\n\n1\u00d7100\n1\u00d710-1\n1\u00d710-2\n1\u00d710-3\n1\u00d710-4\n1\u00d710-5\n1\u00d710\n1\n1\u00d7100\n1\u00d710-1\n1\u00d710-2\n1\u00d710-3\n1\u00d710-4\n1\u00d710-5\n1\u00d710\n0\n\n\u03bba = 0.2\n\n\u03bba = 0.4\n\n5\n\n10\n\n15\n\n20\n25\niteration\n\n30\n\n35\n\n40\n\nIV.\nFIG. 1: (color online) Convergence of the local invariants\nfunctional that optimizes for a local equivalence class rather\nthan a specific operator and is an eighth order polynomial in\nthe states. The optimum corresponds to JTLI = 0.\n\nbe optimized, \u03c3\u0302 i are the 2 \u00d7 2 Pauli spin matrices,\ni = 1, 2, 3 \u2261 x, y, z with \u03c30 = 112 . The tensor aij depends on the distance x0 between the molecules and on\nthe polarization and detuning of the microwave field. We\nconsider here CaCl molecules in an optical lattice with a\nlattice spacing of 300 nm, microwave\n\u221a radiation of about\n9.13 GHz, polarizations \u03b1\u00b1 = 1/ 2, \u03b10 = 0, and a detuning from the rotational transition of 1.2 kHz.\nThe higher than quadratic dependence of JTLI on the\nstates leads to a non-zero analytical estimate of A, cf.\nEq. (16). Specifically, one has to calculate all second\nderivatives of the eighth order polynomial and evaluate\nthe supremum by considering\nan arbitrary\nchange in the\n\u221a\nP\nstates up to k\u2206\u03c6k = k k \u2206\u03c6k k \u2264 2 N , cf. Appendix B\n(Fig. 6). For our example, N = 4 and from the second\nderivatives, we obtain \u0100 = 45 although in practice a\nvalue of \u0100 = 5 was sufficient to preserve monotonic convergence. Figure 1 demonstrates that this choice of \u0100\n(blue dashed line) indeed ensures monotonic convergence\nindependent of other parameters of the algorithm such as\nthe weight \u03bba , cf. Eq. (4). Note that in this example convergence of the final-time functional JT and the complete\nfunctional J are equivalent due to our specific choice of\nga [27] and gb = 0. The latter yields C\u0304 = 0. Furthermore B\u0304 = 0 since our equation of motion is linear in\nthe states. The first order algorithm (solid red line) fails\ncompletely for small \u03bba and violates monotonic convergence for many iteration steps albeit finding an optimum\neventually for intermediate \u03bba . The weight \u03bba determines\nthe step size for changes in the field, cf. Eq. (12): small\n\u03bba leads to large values of the field and thus a possibly\nmore 'erratic' optimization, while for large \u03bba , optimization proceeds more cautiously, explaining that even the\nfirst order construction is found to converge monotonically. This is, however, due to the simplicity of our control problem which is essentially one-dimensional since\nsuccess is determined by the integrated field amplitude.\n\nAPPLICATION II: BILINEAR COSTS\n\nFor bilinear costs, the supremum estimation of C yields\nzero. We consider the dynamics of our examples to be described by the standard Schr\u00f6dinger equation such that\nB = 0 and B\u0304 can also be chosen zero. A second-order\nconstruction of the optimization algorithm becomes necessary if bilinear intermediate-time costs are employed,\ngb 6= 0, which lead to non-zero C, cf. Eq. (23). If\ngb = 0, a second-order construction is not required to\nensure monotonicity but can be utilized to speed up convergence.\nA.\n\nModel\n\nA simplified model for the vibrations in an Rb2\nmolecule that linearly interacts with a laser field takes\n1 +\nthree electronic states, X 1 \u03a3+\ng (5s + 5s), \u03a3u (5s + 5p) and\n1\n\u03a0g (5s + 4d), into account [33, 39],\n\u0124 =\n\n3\nX\ni=1\n\n\u0124i \u2297 |ei ihei | + \u03bc\u0302 \u01eb(t) * |e1 ihe2 |\n\n\u0001\n+|e2 ihe1 | + |e2 ihe3 | + |e3 ihe2 | .\n\n(34)\n\nHere, \u0124i denotes the vibrational Hamiltonians, \u0124i =\nT\u0302 + Vi (R\u0302), with kinetic and potential operators T\u0302 and\nVi (R\u0302), respectively, \u03bc\u0302 is the transition dipole operator,\nassumed to be independent of R\u0302, and \u01eb(t) the electric\nfield. The potentials are found in Ref. [40]. The vibrational Hamiltonians are represented on a Fourier grid [41]\nwith NR grid points yielding a total Hilbert space dimension of M = 3NR . The equations of motion are solved\nby the Chebychev propagator for homogeneous and inhomogeneous Schr\u00f6dinger equations, respectively [39, 41].\nAn initial field of the form\n\u01eb(0) (t) = \u01eb0 s(t) cos(\u03a9t)\n\n(35)\n\nis employed with \u01eb0 the maximum amplitude and \u03a9 the\ncentral frequency of the field. The shape function s(t)\nis taken to be s(t) = sin2 (\u03c0t/T ), where T corresponds\n\n\f10\n1.0\n1.00\n\n-JT\n\n0.8\n0.6\n0.4\n\nfirst order\nA = 0.001\n0.99\nA = 0.01\nA = 0.1\n50 100 150 200 250\nA = 0.2\nA = 2 A(\u2206\u03c6) 0.10\n\n0.2\n\n0.00\n0\n\n0.0\n\n0\n\n50\n\n100\n\n150\n\n1\n\n2\n\n200\n\n3\n\n4\n\n250\n\niteration\n\nFIG. 2: (color online) Convergence of the first order and second order constructions of the optimization algorithm as measured by the final-time objective, JT , for state-to-state transfer from vibrational level v = 10 to v = 0.\n\nto the optimization time. The weight of the final-time\nobjective, \u03bb0 , is taken to be one such that the optimum\ncorresponds to \u2212JT = 1.\nB.\n\nState-independent intermediate-time cost\n(gb = 0)\n\nWe investigate optimization of a state-to-state transfer\n(N = 1), taking for simplicity only the electronic states\n1 +\nX 1 \u03a3+\ng (5s+5s) and \u03a3u (5s+5p) into account. The initial\nand target states are taken to be the vibrational eigenstates v = 10 and v = 0 of the X 1 \u03a3+\ng (5s + 5s) electronic\nground state. With a vibrational period of the initial\nstate of 614 fs, the optimization time is set to T = 1 ps.\nThe central frequency and maximum field amplitude are\ntaken to be \u03a9 = \u03c9v=10\u2192v\u2032 =0 and \u01eb0 = 1 * 10\u22122 a.u.\nConvergence of the final-time objective JT is shown in\nFig. 2, comparing first order (black circles) and second\norder constructions of the algorithm. The second order\nconstruction is determined by the choice of \u0100 which can\nbe taken to be equal to some non-negative number, \u03b5A ,\ncf. Eq. (14) (dotted and dashed lines in Fig. 2) or \u0100 = 0\n(first order optimization, black circles in Fig. 2). The numerical estimate of A, cf. Eq. (25), is represented by the\nsolid red line in Fig. 2. The latter choice might speed up\nconvergence, but is more risky: Since \u0100 = 2A(i+1) (\u2206\u03c6)\ncan become negative, the condition for monotonic convergence may be violated. This is clearly seen in Fig. 2. In\nthe lower inset, monotonic convergence is lost for one step\nafter the first iteration step. We find in this case, that the\nstate change is almost maximal, k\u2206\u03c6k = 1.95 \u2264 2, i.e.,\nthe worst possible case that the optimization algorithm\nmust deal with is reached. While the first order construction converges faster initially, the upper inset shows that\nall second order constructions supersede the first order\none as the optimum is approached. This is readily understood by inspection of Eq. (12): The first order contri-\n\nbution to the change in the field is closely related to the\ngradient of the functional. [48] Since the gradient vanishes close to the optimum, convergence of the first order\nconstruction slows down as the optimum is approached.\nVariation of the non-negative number, \u03b5A , shows that an\noptimal choice of \u03b5A exists. However, this optimal choice\ncannot be determined a priori. In terms of convergence\nspeed close to the optimum, it is therefore recommendable to employ the numerical estimate of \u0100 (red solid\nline in Fig. 2.). Very similar behavior is found for optimization of a unitary transformation, a Hadamard gate\n(N = 2) on the lowest two vibrational eigenstates of the\nelectronic ground state (data not shown).\nC.\n\nState-dependent intermediate-time cost (gb 6= 0)\n\nState-to-state transfer from v = 0 to v = 1 and the\nHadamard gate on the lowest two vibrational eigenstates\nof the electronic ground state,\n\u0013\n\u0012\n1 1 1\n\u00d4 = \u221a\n,\n2 1 \u22121\nare optimized, taking into account an additional statedependent cost, gb (\u03c6, t). If both a state-dependent cost\nand a final-time target are present, the algorithm seeks\nto optimize a compromise between the two goals. The\nparameters \u03bb0 and \u03bbb determine the relative weight of\neach target. Monotonic convergence always refers to the\nvalue that the total functional, J of Eq. (1), takes; and\neach separate contribution to J does not need to converge\nmonotonically. Below we will discuss convergence of both\nJ and JT . In order to render the optimal value of J\nindependent of the choice of the weights \u03bb0 , \u03bbb , we define\na normalized functional,\nJ\n, \u03bbb \u2264 0 ,\n\u03bbb \u2212 \u03bb0\nJ \u2212 \u03bb0\n= 1\u2212\n, \u03bbb \u2265 0 ,\n\u03bbb \u2212 \u03bb0\n\nJnorm =\n\n(36a)\n\nJnorm\n\n(36b)\n\nthat converges toward one.\nThe cost gb is employed to avoid any population transfer to a forbidden subspace, taken to be the 1 \u03a0g (5s + 4d)\nstate, at all times t \u2208 [0, T ] [33]. This can be expressed\nby taking the operator D\u0302 in Eq.(5) to be one of the two\nchoices,\nD\u0302 = P\u0302allow = |e1 ihe1 | + |e2 ihe2 |,\n\nD\u0302 = P\u0302forbid = |e3 ihe3 |,\n\n\u03bbb \u2265 0 ,\n\n\u03bbb \u2264 0 (37a)\n(37b)\n\nwhere P\u0302allow and P\u0302forbid denote the projectors onto the\nallowed and forbidden subspaces, respectively. The allowed subspace is formed by the X 1 \u03a3+\ng (5s + 5s) and\n1 +\n\u03a3u (5s + 5p) states. The different signs of the weight\n\u03bbb indicate maximization of P\u0302allow and minimization of\nP\u0302forbid which is physically equivalent. Mathematically,\n\n\f11\n\n(i+1)\n\nN\n1 X\nh\u2206\u03c6k (t)|D\u0302|\u2206\u03c6k (t)i .\nNT\n\n0.96\n\n\u03bbb = -20\n\n0.6\n\n0.2\n\nfirst order\nC = -0.02\nC = -0.2\nC = -2\nC = 2C(\u2206\u03c6)\n\n0.0\n0\n\n500\n\n0.4\n\n0.94\n0.92\n0.90\n\n1000\n\n1000\niteration\n\n1500\n\n1500\n\n2000\n2000\n\nFIG. 3: (color online) Convergence of the first order and second order constructions for a Hadamard gate with a statedependent cost (D\u0302 = P\u0302allow , i.e. the second order construction is not required).\n\nk=1\n\n1\nfirst order,\n\u03bbb = 1\n1\nfirst order,\n\u03bbb = 20\nC = -0.5 \u03bbb/NT, \u03bbb = 20 0.99\nC = - \u03bbb/NT,\n\u03bbb = 20\nC = 2C(\u2206\u03c6),\n\u03bbb = 20\n\n0.8\n0.6\n0.4\n0.2\n\n1500\n\n2000\n\n0\n1\n0.6\n0.4\n0.2\n0\n0\n\n1\n\n-JT\n\n0.8\n\nJnorm\n\nwe find the necessary condition for monotonic convergence, \u2206\u03c6(t) \u2265 0, to be always fulfilled for D\u0302 = P\u0302allow . A\nsecond order construction is therefore not required [33],\ncorresponding to C = 0 in accordance with Eq. (24). In\nthis case, C\u0304 can be set to \u2212\u03b5C , cf. Eq. (14), where \u03b5C\nis a non-negative number to check for improved convergence with a second order algorithm. However, if the\nprojector onto the forbidden subspace is employed in gb ,\n\u2206\u03c6(t) \u2265 0 is not necessarily fulfilled and a second order construction is required to ensure monotonic convergence. Eq. (24) now yields a large negative number for\nC since \u03bbb is negative, and C\u0304 is determined by C. Our\napproach goes beyond the results of Ref. [33] where a\nconvergent (first order) algorithm was obtained only for\nnegative semi-definite operators \u03bbb D\u0302(t) in the additional\nconstraint gb . The second order construction of Eq. (28)\nallows for a larger class of operators D\u0302(t) in the statedependent constraint gb .\nThe final time is set to T = 2 ps, the central frequency\nof the guess field is chosen to be \u03a9 = \u03c9v=0\u2192v\u2032 =10 and\n\u01eb0 = 2 *10\u22124 a.u. \u0100 is taken to be zero since our emphasis\nis on the choice of the parameter C\u0304.\nIn analogy to the previous subsection, we first study\nthe case D\u0302 = P\u0302allow where the second order construction\nis not required but may improve convergence. Figure 3\ncompares the convergence of first and second order constructions. Taking C\u0304 to be equal to \u2212\u03b5C , cf. Eq. (14)\n(dotted and dashed lines in Fig. 3), does not affect monotonicity. However, it also does not yield faster convergence than the first order algorithm (black circles). The\nnumerical estimate, C\u0304 = 2C (i+1) (\u2206\u03c6) (solid red line in\nFig. 3), cf. Eq. (26b), neglecting \u03b5C in Eq. (14) is somewhat risky since C (i+1) (\u2206\u03c6) can become positive such\nthat this choice of C\u0304 does not guarantee monotonic convergence. Indeed, small violations of monotonicity, for\nexample between steps 1180 or 1300, are observed in\nFig. 3. However, this is more than compensated for by\nthe improved speed of convergence as compared to the\n\n-JT\n\n= \u2212\u03bbb\n\n(i)\n\n}, \u01eb(i) , t) \u2212 R({\u03c6k }, \u01eb(i) , t)\n\n0.8\n\nJnorm\n\n\u2206\u03c6(t) = R({\u03c6k\n\n1.0\n\n-JT\n\nthe equivalence does not hold since gb is a constraint and\ntherefore must have its sign opposite to that of JT . This\nis possible only for the choice of Eq. (37a). Note that the\n'wrong' sign of Eq. (37b) exemplifies the more general\nclass of indefinite operators D\u0302(t) for which it is not possible to construct a monotonically convergent algorithm\nusing the previously available tools by a simple change\nof sign.\nWith the choice of gb according to Eqs. (37), the analytical estimate of the parameter C of the second order contribution is given by Eq. (24). Writing explicitly\nthe change in the intermediate-time contribution to the\nfunctional due to the change in the states for a first order\nalgorithm,\n\n0.95\n0.9\n0\n\n50\n\n500\n\n100 150\n\n1000\niteration\n\n1\n0.8\n0.6\n0.4\n0.2\n0\n0\n\n50\n\n1500\n\n100 150\n\n2000\n\nFIG. 4: (color online) Convergence of the first order and second order constructions for state-to-state transfer with statedependent cost. The operator D\u0302 is taken to be the projector\nonto a forbidden subspace, i.e. the second order construction\nis required.\n\nfirst order and the conservative choices C\u0304 = \u2212\u03b5C . Very\nsimilar behavior is found for optimization of a state-tostate transition (data not shown).\nFor D\u0302 = P\u0302forbid , monotonic convergence needs to be\nensured by a second order construction with C given by\nEq. (24). This choice corresponds to the green dashed\nline in Fig. 4 which studies convergence of the final-time\nobjective, JT , and the complete functional, Jnorm , for a\nstate-to-state optimization. Taking C somewhat smaller\nthan the estimate of Eq. (24) may yield non-monotonic\nbehavior, cf. the blue dotted line in Fig. 4. If one neglects the second order contribution and the weight \u03bbb\nis large, the algorithm completely fails (orange diamonds\nin Fig. 4). For a small weight \u03bbb , the algorithm converges to an optimum but non-monotonic behavior is ob-\n\n\f12\n1\n\n-JT\n\n0.8\n0.6\n0.4\n0.2\n\nV.\n\n\u03bbb = 20\nC = -0.5\u03bbb/NT\nC = -\u03bbb/NT\nC = 2 C(\u2206\u03c6)\n\n0.95\n0.9\n0.85\n0.8\n\n1500\n\n2000\n\n1500\n\n2000\n\n0\n1\n\nJnorm\n\n0.98\n0.96\n\n0.995\n0.99\n\n0.94\n\n0.985\n0.98\n\n0.92\n0\n\n500\n\n1000\niteration\n\n1500\n\n2000\n\nFIG. 5: (color online) Convergence of second order constructions for a Hadamard gate with a state-dependent cost. The\noperator D\u0302 is taken to be the projector onto a forbidden subspace, i.e. the second order construction is required.\n\nserved at intermediate iterations (black circles). Note\nthat for small \u03bbb , the constraint gb is almost not enforced\ndue to insufficient weight. The best compromise between\nmonotonic convergence and high fidelity is obtained for\nC\u0304 = 2C (i+1) (\u2206\u03c6) (red solid line in Fig. 4). For the parameters for which the complete functional, Jnorm , converges monotonically (green dashed and solid red lines\nin Fig. 4), monotonic behavior is observed also for the\nfinal-time objective, JT . In general, this need not be the\ncase. We attribute it in the current example to our choice\nof the guess field which is relatively weak such that the\nforbidden subspace is not strongly populated. The algorithm therefore starts out in the 'right' direction for\noptimizing both targets, JT and gb , and it does not need\nto optimize one target at the expense of the other.\nFig. 5 presents convergence of the final-time objective,\nJT , and the complete functional, Jnorm , for optimization\nof the Hadamard gate. Similarly to Fig. 4, convergence is\nalmost identical for the analytical estimate of C based on\nEq. (24) (green dashed line in Fig. 4) and the numerical\nestimate according to Eq. (26b) (red solid line). A small\nviolation of the analytical estimate (blue dotted line in\nFig. 5) leads to non-monotonic behavior but may yield\nlarger fidelities after many iterations.\nTo summarize our numerical investigations, a second\norder contribution can be employed to enforce monotonic\nconvergence for functionals that are higher-order polynomials in the states or correspond to expectation values of\nnon-semidefinite operators. The numerical estimate of\nthe second order paramters might slightly violate monotonicity but yields the highest fidelities, especially as the\noptimum is approached. If a second order contribution\nis not required by the functional, it may nevertheless be\nused to improve convergence. Also in this case the numerical estimate of the second order parameters \u0100 and\nC\u0304 turns out to be most efficient.\n\nSUMMARY AND CONCLUSIONS\n\nApplying Krotov's method [29] to quantum control,\nwe have shown that monotonically convergent optimization algorithms are obtained for any quantum control\nproblem provided that a second order construction is employed. The equation for the optimized field then contains an additional term. Compared to a first order algorithm [27], only storage of the quantum states of the\nprevious iteration and calculation of the second order\nweight are additionally required. We have shown that\nthe parameters for the second order contribution can be\nestimated analytically based on the final-time target and\nintermediate-time 'costs', the equations of motion and\nthe dependence of the Hamiltonian on the control field\nor calculated numerically from the optimization history.\nThis is due to the normalization of quantum state vectors\nand finiteness of physical control fields, implying that optimization is performed over compact sets of candidate\nstates and controls, which has allowed us to significantly\nrelax the conditions for Krotov's constructive proof [29].\nWe have illustrated the power of our approach by applying it to two control problems for which no monotonically convergent algorithm existed \u2013 to target functionals that are higher-order polynomials in the states and\nto state-dependent constraints expressed as expectation\nvalue of a non-semidefinite operator. Target functionals that are higher order polynomials in the states arise\nfor optimization towards an equivalence class of operators rather than a specific operator. This is particularly\nrelevant in quantum information where one is interested\nin the optimal evolution of a primary system alone, irrespective of its environment [42], or in the entangling\ncontent of two-qubit gates [28].\nOur numerical examples illustrate that an analytical\nestimate of the algorithm parameters ensures monotonic\nconvergence by taking all worst-case scenarios for optimization into account. However, if worst-case scenarios\nare not encountered, the analytical estimate imposes limits which are too severe, slowing down convergence. Estimating the algorithm parameters numerically based on\nthe optimization history turns out to be a more efficient\nchoice. The numerical estimate of the second order parameters can also be employed to speed up convergence,\nin particular close to the optimum where the first order\ncontribution vanishes, for optimization problems where a\nsecond order construction is not strictly required.\nNote that the overall performance of the algorithm\nstill depends on the the weights of the each term in\nthe optimization functional and the optimization time T .\nThe latter has little influence on the convergence once it\nis larger than the quantum speed limit [43]. The role\nof the weights is more subtle, in particular for multioptimization problems [44]. A special role is taken by\nthe weight, \u03bba , of the term minimizing the field intensity: It determines the magnitude of the first order contribution to the new field analogously to the step size in\ngradient-type algorithms [23]. Since its modulus, |\u03bba |,\n\n\f13\nis a free parameter of the algorithm, its choice may be\nused to further improve the convergence speed. An efficient optimization method is obtained by choosing |\u03bba |\nbased on information from the second order derivative\nof the functional with respect to the field, estimated\nwith the Broyden-Fletcher-Goldfarb-Shanno (BFGS) algorithm [45]. Note that in terms of convergence speed\nthis goes beyond our approach which only makes use of\ninformation from the second order derivatives with respect to the states.\nThe work presented here opens up a whole range of\nnew applications for quantum optimal control. It provides a general set of tools to study optimization of finaltime functionals that are higher order polynomials in the\nstates [28], or optimization of time-dependent expectation values that were suggested for the control of highharmonic emission [32], or optimization for non-linear\nequations of motion such as the Gross-Pitaevski equation, time-dependent Hartree-Fock equations or timedependent density functional theory [15, 19, 34]. This set\nof tools allows for designing novel optimization functionals that capture the relevant physics without restriction\nto bilinear functionals.\nAcknowledgments\n\nWe would like to thank Reuven Eitan and David Tannor for their helpful comments on the manuscript. Financial support from the Deutsche Forschungsgemeinschaft\nis gratefully acknowledged.\nAppendix A: Proof of optimality of the second order\nansatz\n\nKonnov and Krotov base their proof upon the following\ncondition set A [29]:\n1. The right-hand side of the equation of motion,\nf (~\n\u03c6, \u01eb, t), is bounded, i.e. \u2203 K, L < \u221e : \u2200 (~\n\u03c6, \u01eb, t) \u2208\nR2N M \u00d7 E \u00d7 [0, T ] , kxk \u2265 M \u21d2 f (~\n\u03c6, \u01eb, t) \u2264 L * kxk.\n2. The Jacobian of the equation of motion is bounded,\ni.e. \u2203 A < \u221e : \u2200 (~\n\u03c6, \u01eb, t) R2N M \u00d7 E\u00d7 \u2208 [0, T ] :\nkJk \u2264 A.\n3. The functionals JT (~\n\u03c6) and g (~\n\u03c6, \u01eb, t) are twice\ndifferentiable and bounded, i.e.\n\u2203 K, L <\n\u221e : \u2200~\n\u03c6 \u2208 R2N M , k~\n\u03c6k \u2265 L \u21d2 JT (~\n\u03c6) \u2264\nKk~\n\u03c6k2 and |g (~\n\u03c6, \u01eb, t)| \u2264 Kk~\n\u03c6k2 \u2200 (t, \u01eb) \u2208 [0, T ] \u00d7\nE.\nHere, the real state vector \u03c6\n~ (t) is a piecewise differentiable function for all t \u2208 [0, T ] and the control \u01eb is\nan element of the Banach space of continous real valued functions on the interval [0, T ] with supremum norm\nkf (x) k\u221e = supx\u2208[0,T ] |f (x)|, i.e. \u01eb \u2208 (C [0, T ] , k * k\u221e )\nwith k\u01ebk\u221e \u2264 E < \u221e. In quantum control, the components of \u03c6\n~ (t) are the real and imaginary parts of the\n\nprojections of N Hilbert space vectors on a suitable orthonormal basis of the M -dimensional Hilbert space. The\nnorm of the Jacobian is then the matrix norm of the\n2N M \u00d7 2N M matrix, either column or row norm.\nBased on A, Konnov and Krotov proved the following\ntheorem [29]:\nTheorem 1 If the conditions\nA hold, then for each pro\u0001\ncess w(i) \u03c6\n~ (i) (t), \u01eb(i) (t) , there exists a solution for \u03a6 to\nthe extremization problem,\n\u0010\n\u0011\n\u0010\n\u0011\nR \u03c6\n~ (i) (t), \u01eb(i) (t), t; \u03a6 = min R \u03c6\n~ (t), \u01eb(i) (t), t\n\u03c6\n~\n\n\u0010\n\n(i)\n\nG \u03c6\n~ (T ); \u03a6\n\n\u0011\n\n\u2200 t \u2208 [0, T ] ,\n\n(A1)\n\n= max G (~\n\u03c6(T )) ,\n\n(A2)\n\n\u03c6\n~\n\nof the form\n1\n\u03a6(~\n\u03c6, \u03c7\n~ , t) = \u03c7\n~ (t) * \u03c6\n~ (t) + \u2206~\n\u03c6(t) * \u03a3\u0302(t) * \u2206~\n\u03c6(t) ,\n2\nand the matrix function \u03a3\u0302(t) can be represented as\n\u0010 \u0010\n\u0011\n\u0011\n\u03a3\u0302(t) = \u03b1 e\u03b3(T \u2212t) \u2212 1 + \u03b2 * 11 \u2261 \u03c3 (t) * 11 ,\n\nwhere \u03b1, \u03b2 < 0 and \u03b3 > 0 are constants.\n\nWith this theorem, the crucial part of constructing the\nalgorithm, i.e. determination of \u03c3(t) and thus \u03a6, is reduced to the determination of the constants \u03b1, \u03b2 and \u03b3.\nSince the proof of Theorem 1 shows how to estimate the\nvalues of \u03b1, \u03b2 and \u03b3, we will sketch it here. It is based on\nthe following Lemma which indicates why the conditions\nA need to be imposed.\nLemma 1 Let the function h (~\n\u03c6) : Rn \u2192 R satisfy the\nfollowing conditions: h \u2208 C (Rn ) with C (Rn ) denoting\nthe space of continuous\u0010 functions\nover Rn , h is twice dif\u0011\n~\nferentiable at ~0 with h ~0 = 0 and \u2207\u03c6~ h (~\n\u03c6)|\u03c6=\n~ ~0 = 0 and\n\u2203 K, L < \u221e : k~\n\u03c6k \u2265 L \u21d2 h (~\n\u03c6) \u2264 Kk~\n\u03c6k2 . Then:\nsup\nn\n\u03c6\u2208R\n~\n\nh (~\n\u03c6)\n<\u221e\nk~\n\u03c6k2\n\nWhen using Lemma 1, two problems may arise in ensuring that the supremum is finite. (i) Small values of\nk~\n\u03c6k create a small denominator which may lead to large\n\u03c6)\n~\n~ = ~0. This is eliminated by the\nvalues of kh(\u03c6k\n~ 2 near \u03c6\n\u0010 \u0011\n~\n\u03c6)|\u03c6=\nconditions of Lemma 1, h ~0 = 0 and \u2207\u03c6~ h (~\n~ ~0 = 0.\nWe show in Appendices A 1 and A 2 that all quantities\ntaking the role of h(~\n\u03c6) satisfy these conditions so that we\ncan employ Lemma 1. (ii) Large values of k~\n\u03c6k may cause\nlarge values of h (~\n\u03c6) which in turn can lead to large val\u03c6)\n~\nues of kh(\u03c6k\n\u03c6k \u2192 \u221e. The second problem is handled\n~ 2 as k~\nby imposing that h (~\n\u03c6) grows at most quadratically with\nk~\n\u03c6k which is guaranteed by the conditions A. Continuity\nof h(~\n\u03c6) then ensures finiteness of the supremum's argument for all intermediate values of k~\n\u03c6k, 0 < k~\n\u03c6k < \u221e.\n\n\f14\n1.\n\nthe desired result,\n\nFinal-time contribution to the second order\nansatz \u2013 proof of existence of finite A\n\n\u0010 \u0011\n~\n\u2207\u03c8~ h \u03c8\n\nWithout any assumption on the normalization, i.e.\nwithout any reference to quantum control, we verify that\nA of Eq. (15) is well-defined with A < \u221e based on the\n~ denote the\nconditions A and using Lemma 1. Let \u03c8\nchange in the state vector. Specifically, we have to check\nthat, for\n\u0010 \u0011\n~ =\u03c8\n~ * \u2206f~\nh \u03c8\n\n= ~0 .\n\nFinally,\nthe\n\u03c6)\n\u0011 condition set A tells us that JT (~\n\u0010\n2\n~\n, hence\nO k\u03c8k\n\u0010 \u0011\n~\nh \u03c8\n\nwith \u2206f defined\nh is\u0011 twice differentiable\n\u0010 \u0011 in Eq. (18), (i) \u0010\n~\n~\n~\nat 0 with h 0 = 0, (ii) \u2207\u03c8~ h \u03c8\n= ~0 and (iii)\n~ ~0\n\u03c8=\n\u0010 \u0011\n~ is bounded, i.e. finite constants K and L exist\nh \u03c8\n\u0010 \u0011\n~ \u2265 L \u21d2 h \u03c8\n~ \u2264 Kk\u03c8k\n~ 2.\nsuch that \u2203 K, L < \u221e : k\u03c8k\nObviously h is twice differentiable since f~ is twice differ~ Since\nentiable\nand \u0011\n\u03c7\n~ (T ) is a constant with respect to \u03c8.\n\u0010\n\u0001\n\u0001\n\u0001\n(i)\n(i)\n(i)\n~\n\u2212 JT \u03c6\n~\nJT \u03c6\n= JT \u03c6\n~\n\u2212 JT \u03c6\n~ (i) =\n~ +\u03c8\n~\n\u0010 \u0011\u03c8=0\n\u0010 \u0011\n~\n0, we find h ~0 = 0. We check whether \u2207\u03c8~ h \u03c8\n=\n\n\u03c8\n\n~ ~0\n\u03c8=\n\n=\n\n+\n\n!\n\n~\n\u2202\u03c8\n\n~ ~0\n\u03c8=\n\n*\n\n~\n\u03c8\n~\nk\u03c8k\n\n!\n\nIn analogy to Appendix A\n\u0010 1,\u0011 it is obvious that h is twice\n~\ndifferentiable at 0 with h ~0 = 0. In order to check that\n\u0010\n\u0011\n~\n\u2207\u03c8(t)\n= 0, we use the product rule,\n~ h \u03c8(t)\n\nSince we have to check these conditions at\u0001 t = T and\nT\nremembering that \u03c7\n~ (T ) = \u2212 \u2202J\n~ (i) (T ) , we obtain\n\u2202\u03c6\n~ \u03c6\n\u0011\n~\n\u2207\u03c8(t)\n~ h \u03c8(t)\n\n~\n~0\n\u03c8(t)=\n\n=\n\n~\n\u03c8(t)\n~\nk\u03c8(t)k\n\n!\n\n~ \u03c6) k\nFinally,\n\u0010\n\u0011the condition set A tells us that kf (~\n~\nO k\u03c8k , hence\n\u0010 \u0011\n\u0011\n\u0010\n~\n~ =\u03c8\n~ * \u2206f~ k\u03c8k\u2192\u221e\n~ 2 ,\nh \u03c8\n= O k\u03c8k\n\n~\n~0\n\u03c8(t)=\n\n\u0010\n\u0011\n~\n* \u2206f~ \u03c8(t)\n|\n{z\n=~0\n\n~\nk\u03c8k\u2192\u221e\n\n=\n\ni.e. h is indeed quadratically bounded. We may thus\nuse Lemma 1 which guarantees the existence of B < \u221e.\nMoreover, B > 0 due to taking the square modulus inside\nthe supremum.\n\n\u0011\n\u0010\n\u0010\n\u0011\n\u0011\n~ \u2212 JT \u03c6\n~ + JT \u03c6\n~ (i)\n~ (i) + \u03c8\n\u03c7\n~ *\u03c8\n\u0011\n\u0010\n\u0011\n\u0010\n~ + O k\u03c8k\n~ 2 + O (1)\nO k\u03c8k\n\u0011\n\u0010\n~ 2\nO k\u03c8k\n\n\u0010\n\nAnalogously to the previous section, we now verify\nthat B and C are well-defined with 0 < B < \u221e and\nC > \u2212\u221e without any assumption on the normalization\nof the state vector. The constant B defined in Eq. (20)\nis easily checked using Lemma 1. Similarly to proving\nthe existence of finite A, we have to check whether the\nconditions for Lemma 1 are fulfilled for\n\u0011\n\u0010\n~\n~ * \u2206f~\n= \u03c8(t)\nh \u03c8(t)\n\n\u2202JT \u0010 (i) \u0011\n* \u00ea\u03c8~ .\n= \u03c7\n~ * \u00ea\u03c8~ +\n\u03c6\n~\n\u2202\u03c6\n~\n\n\u0010\n\n=\n\n=\n\n2. Intermediate-time contribution to the second\norder ansatz \u2013 proof of existence of finite B, C\n\n*\u03c7\n~\n\n\u0010\n\u0011\n~\n~ (i) + \u03c8\n\u2202JT \u03c6\n\n~\nk\u03c8k\u2192\u221e\n\n~\nk\u03c8k\u2192\u221e\n\nand condition (iii) is fulfilled. We may thus use Lemma 1\nwhich guarantees the existence of A.\n\n~ ~0\n\u03c8=\n\n~\n\u03c8\n~\nk\u03c8k\n\n=\n\n=\n\n~0,\n\n\u0010 \u0011\n~\n\u2207~h \u03c8\n\n~ ~0,t=T\n\u03c8=\n\n\u0011\n\u2202JT \u0010 (i)\n\u03c6\n~ (T ) * \u00ea\u03c8(T\n~ )\n\u2202\u03c6\n~\n= \u03c7\n~ * \u00ea\u03c8(T\n~ * \u00ea\u03c8(T\n~ )\u2212\u03c7\n~ )\n\n= \u03c7\n~ * \u00ea\u03c8(T\n~ )+\n\n\u0010 \u0011\n~ * \u2207~\n\u2206f~\n+ \u03c8(t)\n\u03c8(t)\n~\n\u03c8(t)=0\n} |\n{z\n\n~\n\u03c8(t)=0\n\n=~0\n\n= ~0 .\n\n}\n\nTo prove the existence of finite C defined by Eq. (22),\n~ For\nwe distinguish the two cases for large and small k\u03c8k.\n~\nlarge k\u03c8(t)k, the argument of the infimum is finite. This\nfollows from \u03c7\n~ \u0307 (t) and \u03c7\n~ (t) being constant with respect\n~\nto \u03c8(t)\nand the fact that for large k~\n\u03c6k, we have kf~k \u2264\nK1 k~\n\u03c6k and |g| \u2264 K2 k~\n\u03c6k2 . Hence\n~ +\u03c7\n\u03c7\n~ \u0307 (t) * \u03c8(t)\n~ (t) * \u2206f~ \u2212 \u2206g\n\n~\nk\u03c8(t)k\u2192\u221e\n\n\u2264\n\n\u0011\n\u0010\n2\n~\n.\nO k\u03c8(t)k\n\n\f15\n~\nFor small k\u03c8(t)k\nwe have to check that the zeroth and\nfirst order terms in the denominator disappear. Inserting\n\nthe expression for \u03c7\n~ \u0307 into the definition of C yields\n\n\u0010\n\u0011\n~T * \u03c7\n~ +\u03c7\n~ \u2212 \u2206g\n\u2212\u2207\u03c6(t)\n~ (t) * \u03c8(t)\n~ (t) * \u2206f~ + \u2207\u03c6~ g * \u03c8(t)\n~ f\n\u0010\n\u0011\n,\nC=\ninf\n2N M ;t\u2208[0,T ]\n~\n~ * \u03c8(t)\n~\n\u03c8(t)\u2208R\n\u03c8(t)\n~\nFor sufficiently small \u03b5 and k\u03c8(t)k\n< \u03b5, we may approximate \u2206f and \u2206g to the first order,\n\u0011\n\u0010\n~ ~\n~ 2 ,\n\u2206f~ \u2243 \u2207\u03c6(t)\n~ f * \u03c8(t) + O k\u03c8k\n\u0011\n\u0010\n2\n~\n~\n.\n\u2206g \u2243 \u2207\u03c6(t)\ng\n*\n\u03c8(t)\n+\nO\nk\n\u03c8k\n~\n\n\u0010\n\n(A3)\n\nThis yields\n\n\u0011\n~\n~T * \u03c7\n~ + \u2207\u03c6(t)\n\u2212\u2207\u03c6(t)\n~ (t) * \u03c8(t)\n~ (t) * \u2206f~ \u2212 \u2206g\n~ f\n~ g * \u03c8(t) + \u03c7\n\u0010\n\u0011\n~ * \u03c8(t)\n~\n\u03c8(t)\n\u0010\n\u0011\n\u0010\n\u0011\n\u0010\n\u0011\n2\n~T * \u03c7\n~ + \u2207\u03c6(t)\n~\n~ ~\n~\n~\n\u2212\u2207\u03c6(t)\n~ (t) * \u03c8(t)\n~ (t) * \u2207\u03c6(t)\n~ f\n~ g * \u03c8(t) + \u03c7\n~ f * \u03c8(t) \u2212 \u2207\u03c6(t)\n~ g * \u03c8(t) + O k\u03c8(t)k\n~\nk\u03c8(t)k\u21920\n\u0010\n\u0011\n\u2212\u2192\n~ * \u03c8(t)\n~\n\u03c8(t)\n\u0011\n\u0010\n2\n~\nO\nk\n\u03c8(t)k\n~\nk\u03c8(t)k\u21920\n\u0011\n\u2212\u2192 \u0010\n~ * \u03c8(t)\n~\n\u03c8(t)\n= O (1) ,\n\n~\ni.e. C remains finite also for small k\u03c8(t)k.\nAppendix B: Applying Krotov's proof to quantum\ncontrol problems\n\nWe adapt Konnov and Krotov's results [29] to the case\nthat \u03c6\n~ is composed of the M real and imaginary expansion coefficients of N normalized quantum state vectors.\nIn quantum control applications, some of the conditions\nA, cf. Appendix A, are trivially fulfilled. Specifically,\nthe state vector \u03c6\n~ is inherently bounded for any field \u01eb\nif \u03c6\n~ is obtained from the equation of motion for a given\n\u01eb due to normalization.\nIn particular, k~\n\u03c6k cannot be\u221a\ncome larger than N and we may reduce the candiM\ndate space R2N\nfor \u03c6\n~ to a compactosubset of R2N M ,\nn\n\u221a\n\u03c6k \u2264 N \u2282 R2N M . The\nnamely X = \u03c6\n~ \u2208 R2N M k~\n\nconditions concerning the behavior for large k~\n\u03c6k are then\ntrivially fulfilled because the complete space of interest\n[0, T ] \u00d7 X \u00d7 E, that is the set of all {(t, \u03c6\n~ , \u01eb)}, is compact.\nThe boundedness of the right-hand side of the equations\n\nof motion, the Jacobian and the functionals is then guaranteed by simply asking f (t, \u03c6\n~ , \u01eb), J, JT (~\n\u03c6) and g (\u01eb, \u03c6\n~ , t)\nto be regular.\nDue to the restriction of the states to the compact subset X \u2282 R2N M , the proof simplifies for quantum control\napplications which we use to obtain straightforward estimates of the constants \u03b1, \u03b2 and \u03b3. The changes in R and\nG due to variation of the state from the extremal point,\n~ is measured by\n\u03c6\n~ (i) , to all possible states, \u03c6\n~ (i) + \u03c8,\n\u0010 \u0011\n\u0010\n\u0011\n\u0010\n\u0011\n~ = G \u03c6\n~ \u2212G \u03c6\n\u2206G \u03c8\n~ (i) (T ) + \u03c8\n~ (i) (T ) (B1)\n,\n\u0010\n\u0011\n\u0010\n\u0011\n~\n~\n\u2206R \u03c8(t),\nt = R \u03c6\n~ (i) (t) + \u03c8(t),\n\u01eb(i) (t), t\n\u0010\n\u0011\n\u2212R \u03c6\n~ (i) (t), \u01eb(i) (t), t .\n(B2)\nThen the global extremum\nconditions,\n(A1)-(A2),\n\u0010 \u0011\n\u0010 Eqs. \u0011\n~\n~\ncorrespond to \u2206G \u03c8 \u2264 0 and \u2206R \u03c8(t), t \u2265 0. In\n~ that\nquantum control applications, any state \u03c6\n~ (i) + \u03c8\n(i+1)\nis candidate for \u03c6\n~\nmust also be normalized. Geo~ lie therefore on a\nmetrically, all states \u03c6\n~ (i) and \u03c6\n~ (i) + \u03c8\n\n\f16\nAppendix C: Analytical estimate of the parameters\nof the second order contribution\n\n~ lie on\nFIG. 6: All admissible states,\n\u03c6\n~ (i) and \u03c6\n~ (i+1) = \u03c6\n~ (i) + \u03c8\n\u221a\na sphere of radius X = N around the origin. Therefore the\n~ varies between\nnorm of the change in the states states, k\u03c8k,\n0 and 2X.\n\n~ varies\nsphere of radius X. The norm of the vectors \u03c8\nbetween zero and 2X since for any two vectors \u03c6\n~ (i) ,\n(i+1)\n\u03c6\n~\nin X the minimum distance is zero while the maximum distance is 2X. This is illustrated in Fig. 6. The\n~ is then given by\nspace n\nfor the state change vectors \u03c8\no\n2N\nM\n(i)\n(i)\n~\u2208R\n~ \u2208 X \u2282 R2N M .\nY = \u03c8\n\u2203~\n\u03c6 \u2208X:\u03c6\n~ +\u03c8\nIn quantum control applications it is thus sufficient to\nvary the vector \u03c6\n~ (i+1) over the sphere of radius X around\nthe origin instead of the full R2N M .\nWith the definitions of A, B and C, cf. Eqs. (15), (20),\n(22), a strict maximum condition for G and minimum\ncondition for R is transformed into\n\u03c3(T ) < \u22122A ,\n1\n\u03c3\u0307 (t) \u2212 |\u03c3 (t)| * B + C > 0 .\n2\n\n(B3)\n(B4)\n\nA solution \u03c3(t) fulfilling these inequalities exists and it is\nstraightforward to check that the Konnov and Krotov's\nansatz Eq. (13) satisfies (B3) and (B4). More generally,\nthe ansatz [29]\n\u0010\n\u0011\n\u03c3 (t) = \u03b1 e\u03b3(T \u2212t) \u2212 1 + \u03b2\nwith \u03b1, \u03b2 < 0 and \u03b3 > 0 leads to the inequalities\n\u03b2 + 2A < 0 ,\n\u03b1\u03b3\n\u2212\n\u2212 B\u03b2 + C > 0 ,\n2\n\n(B5a)\n(B5b)\n\nwhich have at least one specific solution, namely Eq. (13),\nwith\n\u03b1=\n\nC\u0304\n\u2212 \u0100 , \u03b2 = \u2212\u0100 , \u03b3 = B\u0304 .\nB\u0304\n\nNote that if a set {\u03b10 , \u03b20 , \u03b30 } fulfills the inequalities (B5),\nthen any other set {\u03b1, \u03b2, \u03b3} with \u03b1 \u2264 \u03b10 < 0, \u03b2 \u2264 \u03b20 < 0,\n\u03b3 \u2265 \u03b30 > 0 does so, too. This flexibility can be utilized to estimate the constants A, B and C. Therefore\nthe suprema in Eqs. (15) and (20) and the infimum in\nEq. (22) can be estimated analytically.\n\nThe arguments of the suprema, respectively of the infimum, in A, B and C can be expressed in terms of Taylor series starting at the first, respectively second, order.\nEvaluating the remainder term of these Taylor series, we\nobtain estimates for A, B and C. Let W (~\n\u03c6) be a scalar,\nvector or matrix depending on \u03c6\n~ . Wn (~\n\u03c6) denotes the\nTaylor expansion of W around \u03c6\n~ (i) starting at the n-th\norder or, in other words, Wn (~\n\u03c6) equals W (~\n\u03c6) minus the\nfirst n \u2212 1 terms of its Taylor expansion around \u03c6\n~ (i) . For\nexample, we obtain for a scalar field\n\u0011\n\u0010\nW0 (~\n\u03c6) = W \u03c6\n~ (i) ,\n\u0011\n\u0010\nW1 (~\n\u03c6) = W (~\n\u03c6) \u2212 W \u03c6\n~ (i) ,\n\u0011\n\u0010\nW2 (~\n\u03c6) = W (~\n\u03c6) \u2212 W \u03c6\n~ (i)\n\u0011\n\u0011 \u0010\n\u0010\n~ \u2212\u03c6\n~ (i) ,\n\u2212\u2207\u03c6 W \u03c6\n~ (i) * \u03c6\nand so forth. The Taylor series starting at the n-th order\ncan be approximated by evaluating the remainder term.\nFor a scalar field W (~\n\u03c6) this is given by\n\u0010 \u0011\n\u0010\n\u0011\nX 1\nW\n\u03b1\n~\n~ \u03c8\n~(C1)\nWn (~\n\u03c6) = R\u03c6\n\u2202\u03b1W \u03c6\n~ (i) + c\u03c8\n~ (i) ,n \u03c8 =\n\u03b1!\n|\u03b1|=n\n\n~=\u03c6\nfor a c \u2208 (0, 1) and with \u03c8\n~ \u2212\u03c6\n~ (i) . Here \u03b1 is a multiindex representing the 2N M -tuple of natural numbers\nincluding zero,\n|\u03b1| =\nand\n\n2N\nM\nX\n\n\u03b1i ,\n\ni=1\n\n2N\nM\nY\n1\n1\n~\u03b1 =\n\u03c8i\u03b1i , (C2)\n,\u03c8\n= Q2N M\n\u03b1!\ni=1 \u03b1i !\ni=1\n\nM\n\u0010\n\u0011 2N\nY\n\u03c6)\n\u2202 \u03b1i W (~\n(\u2202 \u03b1 W ) \u03c6\n~ (i) =\n\u03b1i\n\u2202\u03c6i\ni=1\n\n.\n\n(C3)\n\n\u03c6\n~ =\u03c6\n~ (i)\n\nThe remainder can be estimated by\n\u0010 \u0011\n1 W \u0010 (i) \u0011 ~ \u03b1\nW\n~\n\u03c8 , |\u03b1| = n ,\n\u03c6\n~\nM\nR\u03c6\n~ (i) ,n \u03c8 \u2264\n\u03b1! n\nwith\n\u0011\n\u0010\n\u0011\n\u0010\n~ .\n~ (i) + \u03c8\n~ (i) = sup \u2202 \u03b1 W \u03c6\nMnW \u03c6\n\n(C4)\n\n~\n\u03c8\u2208Y;|\u03b1|=n\n\nAn estimate that is independent of the state \u03c6\n~ (i) is obtained by taking the supremum over all possible \u03c6\n~ (i) , i.e.\nwe define\n\u0011\n\u0010\n~ (i)\nMnW \u2261 sup Mn \u03c6\n\u03c6\n~ (i) \u2208X\n\n=\n\nsup\n~\n\u03c6\n~ (i) \u2208X;\u03c8\u2208Y;|\u03b1|=n\n\n=\n\nsup\n~\n\u03a8\u2208X;|\u03b1|=n\n\n\u0010\n\u0011\n~\n\u2202\u03b1W \u03c6\n~ (i) + \u03c8\n\n\u0010 \u0011\n~ .\n\u2202\u03b1W \u03a8\n\n(C5)\n\n\f17\nThis method to estimate the Lagrange remainder term\nlends itself to an intuitive geometrical interpretation, cf.\nFig. 6. For given \u03c6\n~ (i) , the Taylor expansion of W around\n(i)\n\u03c6\n~\nstarting at the nth order, Wn , can be estimated\nby the supremum of the nth derivatives taken over the\n~ = y0 . To give\nsphere around this state with radius k\u03c8k\nan estimate of Wn that holds for any \u03c6\n~ (i) , we have to\ncalculate the supremum around all possible state vectors. Since all \u03c6\n~ (i)\u221a are located on a sphere around the\norigin with radius N , we simply need to take the supremum of the nth derivatives over\u221aall vectors within a ball\naround the origin with radius 2 N . Since the Lagrange\nform of the remainder is based on the mean value theorem,\nbetween two values of a function\n\u0010 the difference\n\u0011\n\u0001\n~ \u2212W \u03c6\nW \u03c6\n~ (i) + \u03c8\n~ (i) is estimated by the first deriva~ and\ntive of the function at some point between \u03c6\n~ (i) + \u03c8\n\n~ are located on the\n\u03c6\n~ (i) . Since both \u221a\u03c6\n~ (i) and \u03c6\n~ (i) + \u03c8\nsphere of radius N around the origin, any difference\nof a function between these two points can only concern\nvalues of derivatives inside this sphere. Therefore we can\nrestrict the supremum to be taken over all states in X in\nthe last line of Eq. (C5).\nWe now apply the estimate of the Lagrange remainder to derive the constants A, B and C and use\nthe braket notation in the following.\n\u0010 Considering in\n\u0011\n(i)\nEq. (15) the Taylor expansion of JT {\u03c6k (T ) + \u2206\u03c6k }\n(i)\n\nin \u2206\u03c6k around \u03c6k (T ), the first order term cancels with\nh\u03c7k (T )|\u2206\u03c6k (T )i + c.c. since |\u03c7k (T )i is given in terms of\nthe gradient of JT ,\u0010cf. Eq. (9b).\nThe zeroth order term\n\u0011\n(i)\n\nis nullified by \u2212JT {\u03c6k (T ) ,\n\nP\n(i)\n(i)\nJT ({\u03c6k (T ) + \u2206\u03c6k (T )}) \u2212 JT ({\u03c6k (T )}) + N\nk=1 [h\u03c7k (T )|\u2206\u03c6k (T )i + h\u2206\u03c6k (T )|\u03c7k (T )i]\nPN\nh\u2206\u03c6\n(T\n)\n|\n\u2206\u03c6k (T )i\n{\u2206\u03c6k }\nk\nk=1\nJT,2 ({\u2206\u03c6k (T )})\n.\n= sup PN\n{\u2206\u03c6k }\nk=1 h\u2206\u03c6k (T ) | \u2206\u03c6k (T )i\n\nA =\n\nsup\n\nThe argument of the supremum in the definition of A,\nEq. (15),\n\u0010 can therefore be\n\u0011 viewed as the Taylor expansion\n(i)\n\n(i)\n\nof JT {\u03c6k (T ) + \u2206\u03c6k } around the \u03c6k (T ) starting at\nP\nthe second order, divided by N\nk=1 h\u2206\u03c6k (T ) | \u2206\u03c6k (T )i.\nIt is now possible to estimate JT,2 by its Lagrange remainder according to Eq. (C4),\nA =\n\n\u2264\n=\n=\n\nRJT (i)\n({\u2206\u03c6k (T )})\n{\u03c6 (T )},2\nsup PN k\n{\u2206\u03c6k }\nk=1 h\u2206\u03c6k (T ) | \u2206\u03c6k (T )i\n\u0010\n\u0011P\n(i)\nN\nJT\n1\nM\n{\u03c6\n(T\n)}\n2\nk=1 h\u2206\u03c6k (T ) | \u2206\u03c6k (T )i\nk\n2\nsup\nPN\n{\u2206\u03c6k }\nk=1 h\u2206\u03c6k (T ) | \u2206\u03c6k (T )i\n\u0011\n1 JT \u0010 (i)\n{\u03c6k (T )}\nM\n2 2\n1\nsup\n\u2202 \u03b1 JT ({\u2206\u03c6k (T )}) ,\n2 {\u2206\u03c6k };|\u03b1|=2\n\nyielding Eq. (16). Note that for functionals JT that are\nquadratic in the states, the global convergence condition\n(B3) coincides with the local one, \u22072\u03c6 G < 0, that was\nused in Ref. [16]. This can be seen by inserting the ansatz\nfor \u03a6, Eq. (8), into \u22072\u03c6 G < 0,\n\u0010\n\u0011\n\u22072\u03c6 JT \u03c6(i) (T ) + \u03c3(T ) < 0 .\nTo find an expression for the constant B defined by\nEq. (20), we rewrite the change \u2206fk in the equations\nof motion due to changes in the states, cf. Eq. (18),\nin terms of the Taylor expansion of the Hamiltonian in\n(i)\n\u2206\u03c6k (t) around the \u03c6k (t) starting at the first order, \u01241 ,\nand obtain\n\nhD\n\nE D\nEi\n\u2020\n(i)\n(i)\n(i)\n(i)\n\u2206\u03c6\n(t)\n\u0124\n(\u03c6\n+\n\u2206\u03c6\n,\n\u01eb\n)\n\u03c6\n(t)\n+\n\u03c6\n(t)\n\u0124\n(\u03c6\n+\n\u2206\u03c6\n,\n\u01eb\n)\n\u2206\u03c6\n(t)\nk\n1\nk\nk\nk\nk\nk\n1\nk=1\nk\nk\nB \u2264\nsup\nPN\n{\u2206\u03c6k };t\u2208[0,T ]\nk=1 h\u2206\u03c6k (t) | \u2206\u03c6k (t)i\nE\nD\n\u0010\n\u0011\nPN\n(i)\n(i)\n\u2206\u03c6\n(t)\nIm\n\u2206\u03c6\n(t)\n\u0124\n\u03c6\n(t)\n+\n\u2206\u03c6\n(t),\n\u01eb\n,\nt\nk\nk\nk\nk=1\nk\n+2\nsup\n.\nPN\n{\u2206\u03c6k };t\u2208[0,T ]\nk=1 [h\u2206\u03c6k (t) | \u2206\u03c6k (t)i]\nPN\n\nUsing the Cauchy Schwarz inequality for the scalar products in the argument of the first supremum and Eq. (C5) for\n\n\f18\nthe second supremum yields\nB \u2264\n\nsup\n{\u2206\u03c6k };t\u2208[0,T ]\n\n+2\n\n\u0015\nN \u0014p\n\u0011 q\n\u0010\nX\n(i)\n(i)\n(i)\n* h\u03c6k (t)|\u03c6k (t)i\nh\u2206\u03c6k (t) | \u2206\u03c6k (t)i * \u01241 \u03c6k + \u2206\u03c6k , \u01eb\n\n2\nPN\n\nh\u2206\u03c6k (t) | \u2206\u03c6k (t)i k=1\nD\nE\n\u0001\n(i)\nIm\n\u2206\u03c6\n(t)\n\u2206\u03c6\n(t)\n\u0124\n\u2206\u03c6\n(t),\n\u01eb\n,\nt\nk\nk\nk\nk=1\n.\nPN\nk=1 h\u2206\u03c6k (t) | \u2206\u03c6k (t)i\n\nk=1\n\nsup\n{\u2206\u03c6k };t\u2208[0,T ]\n\nPN\n\nTo evaluate the first supremum, we estimate the Taylor\nexpansion of the Hamiltonian starting at the first order,\n\u01241 , by its Lagrange remainder,\n\u01241 (\u2206\u03c6k )\n\n\u2264\n=\n\nN\nX\n\n|\u0124|,k\n\nM1\n\nk=1\nN\nX\n\n*\n\np\nh\u2206\u03c6k | \u2206\u03c6k i\n\nsup\n\nis given by the second supremum alone which is twice\nthe maximum absolute value of the imaginary part the\nHamiltonian's eigenvalues. That is, the second supremum is non-zero only for non-unitary time evolution. In\nsummary, for linear equations of motion and unitary time\nevolution, B = 0. The differential inequality system for\n\u03c3(t) then reduces to\n\n\u2202 \u03b1 \u0124 (\u2206\u03c6k )\n\n1\n\u03c3(T ) + A < 0 ,\n2\n1\n\u03c3\u0307(t) + C > 0 ,\n2\n\nk=1 \u2206\u03c6k ;|\u03b1|=1\n\np\n* h\u2206\u03c6k | \u2206\u03c6k i .,\n\n(C6)\n\nNote that the absolute value of the derivatives is required in the estimation of the Lagrange remainder\nsince q\nwe need to estimate the norm of \u01241 . With\n\u221a\nPN\n(i)\n(i)\nh\u03c6k (t)|\u03c6k (t)i = N , we obtain Eq. (21) for B.\nk=1\nIn particular,\nfor Hamiltonians \u0011that do\u0010not depend\u0011on the\n\u0010\n(i)\n(i)\nstate, \u0124 \u03c6k (t) + \u2206\u03c6k (t), \u01eb(i) \u2212 \u0124 \u03c6k (t), \u01eb(i) = 0,\nand the first supremum can taken to be zero. Then B\n\n!\n\nsuch that we obtain a linear solution for \u03c3(t),\n\u03c3(t) = C\u0304(T \u2212 t) \u2212 \u0100 .\n\n(C7)\n\nTo estimate the constant C defined by Eq. (22), we\nrewrite it, using Eq. (A3),\n\n\u0010\n\u0011\n\u0011\n\u0010\nEi\n\u0011E D\n\u0010\n(i)\n(i)\n(i)\n(i)\n(i)\n\u03c7k (t) fk,2 \u03c6k + \u2206\u03c6k , \u01eb(i) + fk,2 \u03c6k + \u2206\u03c6k , \u01eb(i) \u03c7k (t) \u2212 g2 {\u03c6k + \u2206\u03c6k }, t\nC=\ninf\n,\nPN\n{\u2206\u03c6k };t\u2208[0,T ]\nk=1 h\u2206\u03c6k (t) | \u2206\u03c6k (t)i\n(C8)\n(i)\nwhere |fk,2 i and g2 are the Taylor expansions of |fk i and g in \u2206\u03c6k (t) around \u03c6k (t) starting at the second\norder.\nExpressing \u0011|fk,2 i in terms of the Taylor expansion of the Hamiltonian starting at first order, |fk,2 i =\n\u0010\nPN\n\nk=1\n\nhD\n\n(i)\n\n\u01241 \u03c6k + \u2206\u03c6k , \u01eb(i) |\u2206\u03c6k (t)i, and introducing the approximation\n\nhD\n\u0010\nE D\n\u0010\nEi\n\u0011\n\u0011\n+\n(i)\n(i)\n(i)\n(i)\n\u03c7k (t) \u01241 \u03c6k + \u2206\u03c6k , \u01eb(i) \u2206\u03c6k (t) + \u2206\u03c6k (t) \u01241 \u03c6k + \u2206\u03c6k , \u01eb(i) \u03c7k (t)\n\u2212C \u2265\nsup\n\u2212\nPN\n{\u2206\u03c6k };t\u2208[0,T ]\nk=1 h\u2206\u03c6k (t) | \u2206\u03c6k (t)i\n\u0010\n\u0011\n(i)\ng2 {\u03c6k + \u2206\u03c6k }, t\n,\n+\nsup\nPN\n{\u2206\u03c6k };t\u2208[0,T ]\nk=1 h\u2206\u03c6k (t) | \u2206\u03c6k (t)i\nPN\n\nk=1\n\nwe may reuse our results for \u01241 , cf. Eq. (C6), together\nwith M1\u2212\u0124,k = \u2212M1\u0124,k to estimate the first term. The\nestimation of the second term involving g2 proceeds anal-\n\nogously to that of JT,2 , with M2g given by\nM2g =\n\nsup\n{\u2206\u03c6k };t\u2208[0,T ]\n|\u03b1|=2\n\n\u2202 \u03b1 g ({\u2206\u03c6k }, t) .\n\nWe thus obtain Eq. (23) for C. For Hamiltonians that\n\n\f19\n(i)\n\ndepend on the state, the first term in the right-hand side\nof Eq. (23) is non-zero. Note that the norm of all adjoint\n\u221a\n(i)\nvectors \u03c7k is equal to N only for state-independent\n(i)\nconstraint g. For state-dependent constraint g, \u03c7k is the\nsolution of an inhomogeneous Schr\u00f6dinger\n\u221a equation and\nits norm may be smaller or larger than N . However,\n(i)\nthe norm of all adjoint vectors \u03c7k is always known since\n\nthe \u03c7k are calculated in the previous iteration step, i.\nSo in order to estimate the first term of the right-hand\nside of Eq. (23), we only need to determine \u2202 \u0124 which\nis also needed for estimating B. In this case, \u2212C is then\ngiven by the sum of the spectral radius of the operator\n\u2202 \u0124 and the eigenvalue of D\u0302(t) with largest magnitude.\n\n[1] S. A. Rice and M. Zhao, Optical control of molecular\ndynamics (John Wiley & Sons, New York, 2000).\n[2] P. Brumer and M. Shapiro, Principles and Applications\nof the Quantum Control of Molecular Processes (Wiley\nInterscience, 2003).\n[3] D. Tannor and S. Rice, J. Chem. Phys. 83, 5013 (1985).\n[4] D. Tannor, R. Kosloff, and S. Rice, J. Chem. Phys. 85,\n5805 (1986).\n[5] P. Brumer and M. Shapiro, J. Chem. Phys. 84, 4103\n(1986).\n[6] P. Brumer and M. Shapiro, Chem. Phys. Lett. 126, 541\n(1986).\n[7] W. Warren, H. Rabitz, and M. Dahleh, Science 259, 1581\n(1993).\n[8] D. Tannor, V. Kazakov, and V. Orlov, in Time-dependent\nquantum molecular dynamics, edited by J. Broeckhove\nand L. Lathouwers (Plenum, 1992), pp. 347\u2013360.\n[9] R. S. Judson and H. Rabitz, Phys. Rev. Lett. 68, 1500\n(1992).\n[10] J. Soml\u00f3i, V. A. Kazakov, and D. J. Tannor, Chem. Phys.\n172, 85 (1993).\n[11] W. Zhu, J. Botina, and H. Rabitz, J. Chem. Phys. 108,\n1953 (1998).\n[12] N. Dosli\u0107, K. Sundermann, L. Gonz\u00e1lez, O. M\u00f3,\nJ. Giraud-Girard, and O. K\u00fchn, Phys. Chem. Chem.\nPhys. 1, 1249 (1999).\n[13] L. Wang, H.-D. Meyer, and V. May, J. Chem. Phys. 125,\n014102 (2006).\n[14] U. Hohenester and G. Stadler, Phys. Rev. Lett. 92,\n196801 (2004).\n[15] E. R\u00e4s\u00e4nen, A. Castro, J. Werschnik, A. Rubio, and\nE. K. U. Gross, Phys. Rev. Lett. 98, 157404 (2007).\n[16] S. E. Sklarz and D. J. Tannor, Phys. Rev. A 66, 053619\n(2002).\n[17] C. P. Koch, J. P. Palao, R. Kosloff, and F. MasnouSeeuws, Phys. Rev. A 70, 013402 (2004).\n[18] U. Hohenester, P. K. Rekdal, A. Borz\u0131\u0300, and J. Schmiedmayer, Phys. Rev. A 75, 023602 (2007).\n[19] J. Grond, G. von Winckel, J. Schmiedmayer, and U. Hohenester, Phys. Rev. A 80, 053625 (2009).\n[20] V. May, D. Ambrosek, M. Oppel, and L. Gonz\u00e1lez, J.\nChem. Phys. 127, 144102 (2007).\n[21] Y. Ohtsuki and K. Nakagami, Phys. Rev. A 77, 033414\n(2008).\n[22] T. E. Skinner, T. O. Reiss, B. Luy, N. Khaneja, and S. J.\nGlaser, J. Magn. Reson. 163, 8 (2003).\n[23] N. Khaneja, T. Reiss, C. Kehlet, T. Schulte-Herbr\u00fcggen,\nand S. J. Glaser, J. Magn. Reson. 172, 296 (2005).\n[24] J. P. Palao and R. Kosloff, Phys. Rev. Lett. 89, 188301\n(2002).\n[25] C. Tesch and R. de Vivie-Riedle, Phys. Rev. Lett. 89,\n157901 (2002).\n\n[26] P. Treutlein, T. W. H\u00e4nsch, J. Reichel, A. Negretti, M. A.\nCirone, and T. Calarco, Phys. Rev. A 74, 022312 (2006).\n[27] J. P. Palao and R. Kosloff, Phys. Rev. A 68, 062308\n(2003).\n[28] M. M. M\u00fcller, D. Reich, H. Yuan, K. B. Whaley, J. Vala,\nT. Calarco, and C. P. Koch, Phys. Rev. A 84, 042315\n(2011).\n[29] A. Konnov and V. Krotov, Automation and Remote Control 60, 1427 (1999).\n[30] Y. Ohtsuki, G. Turinici, and H. Rabitz, J. Chem. Phys.\n120, 5509 (2004).\n[31] A. Kaiser and V. May, J. Chem. Phys. 121, 2528 (2004).\n[32] I. \u015eerban, J. Werschnik, and E. K. U. Gross, Phys. Rev.\nA 71, 053810 (2005).\n[33] J. P. Palao, R. Kosloff, and C. P. Koch, Phys. Rev. A\n77, 063412 (2008).\n[34] M. Mundt and D. J. Tannor, New J. Phys. 11, 105038\n(2009).\n[35] S. Mukamel, Principles of Nonlinear Optics and Spectroscopy (Oxford University Press, 1995).\n[36] J. Zhang, J. Vala, S. Sastry, and K. B. Whaley, Phys.\nRev. A 67, 042313 (2003).\n[37] J. Zhang, J. Vala, S. Sastry, and B. Whaley, Phys. Rev.\nLett. 93, 020502 (2004).\n[38] A. Micheli, G. K. Brennen, and P. Zoller, Nature Phys.\n2, 341 (2006).\n[39] M. Ndong, H. Tal-Ezer, R. Kosloff, and C. P. Koch, J.\nChem. Phys. 130, 124108 (2009).\n[40] S. J. Park, S. W. Suh, Y. S. Lee, and G. H. Jeung, J.\nMolec. Spec. 207, 129 (2001).\n[41] R. Kosloff, J. Phys. Chem. 92, 2087 (1988).\n[42] M. D. Grace, J. Dominy, R. L. Kosut, C. Brif, and H. Rabitz, New J. Phys. 12, 015001 (2010).\n[43] T. Caneva, M. Murphy, T. Calarco, R. Fazio, S. Montangero, V. Giovannetti, and G. E. Santoro, Phys. Rev.\nLett. 103, 240501 (2009).\n[44] R. Chakrabarti, R. Wu, and H. Rabitz, Phys. Rev. A 78,\n033414 (2008).\n[45] R. Eitan, M. Mundt, and D. J. Tannor, Phys. Rev. A 83,\n053426 (2011).\n[46] In principle, all functionals depend on the state vectors\nand their complex conjugates, |\u03c6k (t)i and h\u03c6k (t)|, and\ndifferentiation needs to be carried out with respect to the\nstate vectors and their complex conjugates. To simplify\nnotation, we indicate by \u03c6k (t) the dependence on both\nthe bra and the ket vectors.\n[47] Note that the choice \u03b5i = 0 (i = A, B, C), in the worst\ncase, allows for iterations in which no change towards\nthe objective due to the change in the state variables is\nachieved. However, we will ensure strict monotonic convergence with respect to the change in the field such that\nin practice even the choice \u03b5i = 0 will almost always lead\n\n\f20\nto strict monotonic convergence.\n[48] Specifically, the gradient in an implementation of the\nGRAPE algorithm employing a sequential update of the\n\nfield coincides with the first order term of Eq. (12) [23].\n\n\f"}