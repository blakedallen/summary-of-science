{"id": "http://arxiv.org/abs/0711.4706v1", "guidislink": true, "updated": "2007-11-29T13:33:48Z", "updated_parsed": [2007, 11, 29, 13, 33, 48, 3, 333, 0], "published": "2007-11-29T13:33:48Z", "published_parsed": [2007, 11, 29, 13, 33, 48, 3, 333, 0], "title": "Ranks of elliptic curves over function fields", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0711.3184%2C0711.0983%2C0711.3039%2C0711.3004%2C0711.3085%2C0711.0371%2C0711.2600%2C0711.2138%2C0711.4851%2C0711.0802%2C0711.4687%2C0711.0402%2C0711.1728%2C0711.1721%2C0711.3585%2C0711.0011%2C0711.4860%2C0711.3518%2C0711.3974%2C0711.1881%2C0711.2886%2C0711.2024%2C0711.3049%2C0711.3515%2C0711.1187%2C0711.1837%2C0711.0640%2C0711.4804%2C0711.1675%2C0711.3663%2C0711.3788%2C0711.2638%2C0711.1140%2C0711.0746%2C0711.0706%2C0711.2951%2C0711.4898%2C0711.4685%2C0711.1884%2C0711.1267%2C0711.0511%2C0711.3458%2C0711.2512%2C0711.2031%2C0711.3753%2C0711.2803%2C0711.1286%2C0711.1163%2C0711.3982%2C0711.2845%2C0711.0219%2C0711.3666%2C0711.0452%2C0711.2590%2C0711.2144%2C0711.0266%2C0711.3923%2C0711.0198%2C0711.1376%2C0711.0226%2C0711.0887%2C0711.0610%2C0711.3533%2C0711.3596%2C0711.1090%2C0711.3018%2C0711.0952%2C0711.0794%2C0711.1457%2C0711.3087%2C0711.4411%2C0711.4836%2C0711.4547%2C0711.3036%2C0711.4188%2C0711.3342%2C0711.4280%2C0711.2672%2C0711.4530%2C0711.2869%2C0711.4004%2C0711.4718%2C0711.3485%2C0711.4706%2C0711.0614%2C0711.1330%2C0711.1554%2C0711.0822%2C0711.5022%2C0711.1003%2C0711.2450%2C0711.2985%2C0711.4157%2C0711.4367%2C0711.4399%2C0711.1178%2C0711.1281%2C0711.0656%2C0711.3271%2C0711.0917%2C0711.2459&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Ranks of elliptic curves over function fields"}, "summary": "We present experimental evidence to support the widely held belief that one\nhalf of all elliptic curves have infinitely many rational points. The method\nused to gather this evidence is a refinement of an algorithm due to the author\nwhich is based upon rigid and crystalline cohomology.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0711.3184%2C0711.0983%2C0711.3039%2C0711.3004%2C0711.3085%2C0711.0371%2C0711.2600%2C0711.2138%2C0711.4851%2C0711.0802%2C0711.4687%2C0711.0402%2C0711.1728%2C0711.1721%2C0711.3585%2C0711.0011%2C0711.4860%2C0711.3518%2C0711.3974%2C0711.1881%2C0711.2886%2C0711.2024%2C0711.3049%2C0711.3515%2C0711.1187%2C0711.1837%2C0711.0640%2C0711.4804%2C0711.1675%2C0711.3663%2C0711.3788%2C0711.2638%2C0711.1140%2C0711.0746%2C0711.0706%2C0711.2951%2C0711.4898%2C0711.4685%2C0711.1884%2C0711.1267%2C0711.0511%2C0711.3458%2C0711.2512%2C0711.2031%2C0711.3753%2C0711.2803%2C0711.1286%2C0711.1163%2C0711.3982%2C0711.2845%2C0711.0219%2C0711.3666%2C0711.0452%2C0711.2590%2C0711.2144%2C0711.0266%2C0711.3923%2C0711.0198%2C0711.1376%2C0711.0226%2C0711.0887%2C0711.0610%2C0711.3533%2C0711.3596%2C0711.1090%2C0711.3018%2C0711.0952%2C0711.0794%2C0711.1457%2C0711.3087%2C0711.4411%2C0711.4836%2C0711.4547%2C0711.3036%2C0711.4188%2C0711.3342%2C0711.4280%2C0711.2672%2C0711.4530%2C0711.2869%2C0711.4004%2C0711.4718%2C0711.3485%2C0711.4706%2C0711.0614%2C0711.1330%2C0711.1554%2C0711.0822%2C0711.5022%2C0711.1003%2C0711.2450%2C0711.2985%2C0711.4157%2C0711.4367%2C0711.4399%2C0711.1178%2C0711.1281%2C0711.0656%2C0711.3271%2C0711.0917%2C0711.2459&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "We present experimental evidence to support the widely held belief that one\nhalf of all elliptic curves have infinitely many rational points. The method\nused to gather this evidence is a refinement of an algorithm due to the author\nwhich is based upon rigid and crystalline cohomology."}, "authors": ["Alan G. B. Lauder"], "author_detail": {"name": "Alan G. B. Lauder"}, "author": "Alan G. B. Lauder", "arxiv_comment": "32 pages", "links": [{"href": "http://arxiv.org/abs/0711.4706v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/0711.4706v1", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "math.NT", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "math.NT", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "math.AG", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "11Y99", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/0711.4706v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/0711.4706v1", "journal_reference": null, "doi": null, "fulltext": "Ranks of elliptic curves over function fields\nAlan G.B. Lauder\n\narXiv:0711.4706v1 [math.NT] 29 Nov 2007\n\nOctober 26, 2018\nAbstract\nWe present experimental evidence to support the widely held belief that one half of\nall elliptic curves have infinitely many rational points. The method used to gather this\nevidence is a refinement of an algorithm due to the author which is based upon rigid and\ncrystalline cohomology.\n\n1\n\nIntroduction\n\nThere is a widely held belief that one half of all elliptic curves have infinitely many rational\npoints, but all experimental data which has been collected so far suggests that the fraction is\nactually two thirds [2, Introduction, Items (1) and (2)]. The final purpose of this paper is to\npresent experimental evidence supporting the widely held belief. Let us first digress, to explain\nthe origin of the method which has been used to collect this evidence.\nIn an earlier paper, the present author introduced a new method for computing zeta functions\nof varieties over finite fields [18]. The principal novelty of the method was that it proceeded\nby induction on the dimension of the variety. The author named it the fibration method. It\nwas observed that the method appeared to be especially useful for the case of surfaces over\nfinite fields which can be fibred into low genus curves. Given such a surface, the interesting\npart of its zeta function is exactly the L-function associated to the generic fibre - the generic\nfibre is a curve over a function field. According to a conjecture of Tate [23], the L-function\nreveals arithmetic properties of the curve, such as the rank of the group of rational points on its\nJacobian. In the present paper, we carefully refine the fibration method, focussing ultimately on\nthe case of elliptic curves over the rational function field, and use it to compute the L-functions\nof a randomly chosen sample of elliptic curves of extremely large conductor from a certain\nfamily. The computations reveal that around one half of those have rank, or at least analytic\nrank, greater than zero; see Section 9.\nLeaving aside this final motivating application, the central achievement of this paper is\nthe further development of the fibration method, with an emphasis upon the computation of\nL-functions of hyperelliptic curves over the rational function field. We shall now sketch the\nimprovements to the method which are obtained. We need to introduce some notation: For q a\npower of a prime p, let Fq denote the finite field with q elements of characteristic p, K denote\nthe unique unramified extension of the field of p-adic numbers of degree logp (q), and W denote\nthe ring of integers of K.\nThe challenge which we address is that of efficiently computing the zeta function of a smooth\nvariety over a finite field Fq . Our methods are based upon rigid and crystalline cohomology.\nUsing standard techniques, one sees that the problem of central interest is that of calculating\nthe pth power Frobenius action on the middle-dimensional rigid cohomology of the variety.\nThis is a finite-dimensional vector space over K. In the case in which the original variety V\nof dimension n can be fibred into smooth varieties V \u2192 S over a curve S \u2282 P1 , the paper\nn\n(V ) to that of\n[18] presents a method of reducing the problem of computing Frobenius on Hrig\nn\u22121\ncomputing Frobenius on Hrig (V0 ) for one smooth fibre V0 \u0592\u2192 V in the family. So the method\nproceeds by induction on the dimension. We now describe how the work in this paper refines\nthe fibration method.\n\n1\n\n\fn\u22121\nFirst, the method requires that a basis be found for the relative cohomology space Hrig\n(V /S)\nsuch that the \"matrix for the Gauss-Manin connection is Fuchsian\" [18, Section 4]. This is an\nentirely reasonable assumption as such bases are known to exist for families, for example, with\nan irreducible monodromy group, at least after extending the base field; however, the problem\nof actually finding such bases is an interesting open one, related to Hilbert's 21st problem.\nAn exposition of this problem is given, and modest contributions made, in Sections 7 and 8.3;\nhowever, this still remains an obstacle to the wider application of the fibration method.\nSecond, in [18, Section 9.3] some new ideas on how to significantly improve the practical\nperformance of the fibration method are sketched, although no details are offered. We work out\nthese ideas in great detail and use them in our calculations for elliptic curves. Specifically, let\nX be some smooth compactification of the variety V . There is a finitely generated W -module\nn\nHcris\n(X) attached to X called the middle-dimensional crystalline cohomology, and a natural\nn\nn\nmap Hcris\n(X) \u2192 Hrig\n(V ). The idea is that one computes a basis for the Frobenius-invariant W n\nn\nlattice H(X)prim = Im(Hcris\n(X) \u2192 Hrig\n(V )) and calculates Frobenius on this basis. Working\nwith this basis, one can exploit the Hodge filtration to significantly reduce the p-adic precision\nto which the matrix for Frobenius needs to be computed. Rather than find H(X)prim itself, in\nSection 3 and 4 for certain surfaces X we describe how to compute a lattice H(X, kD) (where\nD is a smooth divisor and k a suitably large integer) which is very close, in a precise sense, to\nH(X)prim , although possibly of larger rank. This lattice is sufficient for our application and\neasier to find.\nThird, in [18, Conjecture 7.4] a conjecture is made on the vanishing of certain coefficients in\nthe \"relative Frobenius matrix\" attached to families V \u2192 S of hyperelliptic curves and a choice\n1\nof basis for Hrig\n(V /S). The truth of this conjecture immediately yields improvements to the\nrunning time of the original fibration method, see [18, Examples 9.2, 9.3], and also the refined\nmethod of this paper. We prove the conjecture. This also gives a practical improvement when\none uses the deformation method to compute zeta functions of hyperelliptic curves over finite\nfields.\nWe now explain in greater detail the main theoretical contribution of this paper. Namely, our\nconstruction and application of W -lattices sitting in the middle-dimensional rigid cohomology\nof surfaces. This is the second refinement to the fibration method as introduced above.\nFor U a smooth surface of degree d in A3Fq , under certain assumptions for each k \u2265 max{2d\u2212\n4, 0} we explicitly construct a full rank W -lattice H(X, kD) sitting in the K-vector space\n2\nHrig\n(U ). The motivation for constructing this lattice is Theorem 5.1. This theorem asserts\nthat when q = p is prime, if we compute an approximation \u00c3 to the matrix A for the pth\npower Frobenius map F with respect to a basis for this lattice, the loss of precision in the\ncalculation of det(1 \u2212 p\u22121 \u00c3T ) is bounded by h2,0 + \u230alogp (k + 1)\u230b. Here h2,0 is the geometric\n2\ngenus of a smooth compactification of a lifting to W of U . Using an arbitrary basis of Hrig\n(U ),\neven when \u00c3 has entries in W the author does not know how to improve the naive loss of\n2\n2\n(U )) \u2212 1 (or \u230adim(Hrig\n(U ))/2\u230b \u2212 1 using the functional equation).\nprecision bound of dim(Hrig\n2\n(U )), d) \u2208\nFor the surfaces we implicitly consider in Section 9, we have p = 7 and (h2,0 , dim(Hrig\n{(0, 8, 6), (1, 20, 12), (2, 32, 18), (3, 44, 24), (4, 56, 30)}. So the use of a basis for H(X, kD) makes\na very significant impact on precisions required. Lying behind Theorem 5.1 is the existence of\nan embedding H(X, log D) \u2192 H(X, kD) with cokernel killed by multiplication by p\u230alogp (k+1)\u230b ,\n2\nwhere H(X, log D) \u2282 Hrig\n(U ) is a full rank W -lattice endowed with what we call a FrobeniusHodge structure (Definition 3.12). In the case in which U compactifies to a smooth surface X\nin P3Fq with smooth divisor at infinity, then our lattice H(X, log D) is exactly the log-crystalline\ncohomology of the pair (X, D), where D := X\\U (Section 3). Unfortunately, for the surfaces we\nare mainly interested in (Sections 8 and 9), this compactification is not smooth. The surfaces\nU we are mainly interested in do compactify to quasi-smooth surfaces X in weighted projective\nspaces. We make the additional assumption that these weighted projective surfaces are quotients\nof smooth surfaces X\u0303 in P3Fq with smooth divisor at infinity D\u0303 under a natural finite group action.\nThe lattices H(X, log D) and H(X, kD) are then defined by taking the invariant part under this\ngroup action of the lattices H(X\u0303, log D\u0303) and H(X\u0303, k D\u0303) associated to the affine part \u0168 := X\u0303\\D\u0303\nof the smooth projective surface X\u0303 (Section 4.1). The lattices H(X, log D) and H(X, kD) sit\n2\nnaturally in Hrig\n(U ), and we prove that H(X, log D) has a Frobenius-Hodge structure (Section\n\n2\n\n\f4.2). However, we stress that we do not prove that H(X, log D) is the log-crystalline cohomology\nof anything (although it undoubtedly is), see Note 4.8.\nThe second and third refinements to the fibration method do not impact in any dramatic\nmanner on the asymptotic analysis of running time of the method; see Section 8.4 for a discussion. Their significance is perhaps best appreciated with reference to explicit examples.\nRegarding the second refinement, in [18, Example 9.1] a nine-fold speed-up is obtained by assuming the truth of [18, Conjecture 7.4]. Regarding the third refinement, in Section 9 the\nauthor computes, amongst other things, the L-functions of 1000 elliptic curves over F7 (t) which\nhave discriminant a squarefree polynomial of degree 60. For each curve, the computation took\naround 1 hour using the second and third refinements in this paper (the first is not relevant\nfor the curves chosen). With only the second refinement, each computation would have taken\naround 4 hours. We note that in our computations in Section 9, and the timing presented in\nthis paragraph, we use an algorithm due to K. Kedlaya for recovering Weil polynomials from\ntheir p-adic approximations. [17, Section 4]. The output of our implementation of Kedlaya's\nalgorithm is provably correct, although there are no explicit bounds on its running time. All of\nour calculations are done using the computer algebra system Magma.\nWe conclude the introduction with a brief mention of the contents of the other sections in\nthis paper. Section 2 gives an overview of our refined fibration method and its relevance to the\ncomputation of L-functions. Section 6 proves some theorems of modest interest relating to one\nof the steps in the method, and includes a short discussion of the computation of the residue\nmap.\nThe author has been assisted in different ways by many different people, among them\nare: Noam Elkies, Victor Flynn, Ralf Gerkmann, Keith Gillow, Roger Heath-Brown, Hendrik\nHubrechts, Nicholas Katz, Bernard Le Stum, Atsushi Shiho, William Stein, Balazs Szendroi\nand Mark Watkins. He would like to thank them all. Especial thanks are due to Jan Denef,\nKiran Kedlaya and Nobuo Tsuzuki, who answered with great patience many questions from the\nauthor. Finally, a great debt of gratitude is owed to A.J. de Jong and Bjorn Poonen.\n\n2\n\nThe refined fibration method\n\nThe purpose of this section is to give an outline of the fibration method. The outline is based\nupon the original method presented in [18], incorporating refinements to the improvements\ncrudely sketched in [18, Section 9.3]. To deal with the method in full would require the introduction of a great burden of notation, so we shall focus on aspects of it that are developed in\nthis paper, and refer to [18] for details on parts which are fully investigated in that paper.\n\n2.1\n\np-adic rings and finite fields\n\nLet us first fix some notation which will be used throughout the paper. Let Fq be the finite\nfield with q elements of characteristic p, W := W (Fq ) be the ring of Witt vectors of Fq , and K\nbe the fraction field of W . Thus K is the unramified extension of the field of p-adic numbers\nof degree logp (q), and W is the ring of integers of K. Let \u03c3 : W \u2192 W and \u03c3K : K \u2192 K be the\nFrobenius automorphisms on W and K respectively, that is, the maps induced by functoriality\nby the pth power map on Fq . Let F\u0304q denote an algebraic closure of Fq , and for each integer\nk \u2265 1, let Fqk denote the unique extension of degree k of Fq in F\u0304q .\nWe warn the reader that the notation for the different varieties required in this paper is not\nconsistent with that in [18]. The reason for this is that the focus of the two papers is quite\ndifferent, and the notation from [18] would become burdensome in the present paper.\n\n2.2\n\nThe zeta function and reduction to the middle dimension\n\nLet X be a smooth projective variety of dimension n over the finite field Fq of characteristic p.\nThe zeta function Z(X, T ) is the formal power series\n!\n\u221e\nX\nTk\nZ(X, T ) := exp\n|X(Fqk )|\nk\nk=1\n\n3\n\n\fwhich encodes the number of Fqk -rational points |X(Fqk )| on X over the different finite extensions Fqk of the base field Fq . By a famous theorem of Dwork, Z(X, T ) is a rational function.\nThere is a formula from rigid cohomology [20, Pages 7-9]\nZ(X, T ) =\n\n2n\nY\n\ni\ndet(1 \u2212 T q n Fq\u22121 |Hrig\n(X))(\u22121)\n\ni+1\n\n;\n\ni=0\ni\nhere each Hrig\n(X) is a finite dimensional K-vector space, and Fq a linear map induced by the\nqth power map on the structure sheaf OX of X. There is a factorisation Fq = F logp (q) where F\ni\nis the \u03c3K -linear map on Hrig\n(X) induced by the pth power map on OX .\nThe problem we consider is to compute Z(X, T ) given equations defining the variety X. We\nshall now try and convince the reader that the central problem is computing the factor with\ni = n.\nFirst, we observe that if X is a hypersurface in a space whose zeta function is known, then\nby Poincar\u00e9 duality and the Lefschetz hyperplane theorem, one can reduce immediately to the\ncase i = n. So let us suppose we are not in such a fortunate situation. We shall proceed\nby induction on the dimension, and assume one can compute zeta functions of smooth zero\ndimensional varieties - we offer no suggestions on how this base case should be tackled. By\nPoincar\u00e9 duality, one need only calculate the factors in the formula for 0 \u2264 i \u2264 n. Let us\nassume that X \u2286 Pm , and there exists a smooth hyperplane section Y \u0592\u2192 X defined over\nthe finite field Fq - this is certainly the case after extending the base field. The Lefschetz\nhyperplane theorem then reveals that the factors for 0 \u2264 i < n \u2212 1 in the zeta function of\nZ(Y, T ) determine the corresponding factors in Z(X, T ). So by induction we reduce to the\ncases i = n \u2212 1, n. We suggest two different approaches to dealing with the case i = n \u2212 1.\nFirst, Deligne's pgcd theorem [6, Th\u00e9or\u00e8me 4.5.1] tells us that if one could compute the zeta\nfunctions of all smooth hyperplane sections in some Lefschetz pencil on X, then the (n \u2212 1)st\nfactor could be recovered by computing a greatest common divisor. Unfortunately, the author is\nnot aware of any effective bounds on how many hyperplane sections need to be considered until\none recovers the correct polynomial; in practice, though, this would seem a useful approach.\nSecond, a more sophisticated, but rigorous, method for obtaining the (n \u2212 1)st factor would be\nto use the spectral sequence in the fibration method, c.f. the proof of Proposition 6.1. This\nshould not be too difficult, although the author does not offer any details. In any case, we hope\nthe reader is convinced that the case i = n is the one of main interest.\nThe problem on which we now focus is that of calculating a p-adic approximation to a matrix\nn\nfor F on the space Hrig\n(X).\n\n2.3\n2.3.1\n\nHow the fibration method calculates in the middle dimension\nThe geometric set-up\n\nLet X be a smooth W -scheme of relative dimension n and D a smooth divisor on X . Assume\nthat U := X \\D is affine, and embed it in some affine space Am\nW , m \u2265 n + 1. Choose a fibration\n1\n1\nAm\nW \u2192 AW . Let U \u2192 AW be the restriction to U. Choose V \u2286 U so that the restriction V \u2192\nS \u2286 A1W has smooth fibres, and define Z := U\\V. By varying the embedding we may assume\nU \u2192 A1W is generically smooth, and so Z is of codimension one. Let Vs for s \u2208 S(W ) be some\nsmooth fibre in the family V \u2192 S - one may need to extend the base field Fq to find a smooth\nfibre. Let the special fibres and generic fibres of X , D, U, V, Z be denoted X, D, U, V, Z and\nXK , DK , UK , VK , ZK , respectively. Note that n is the dimension of the special fibre X. For\nexample, if X \u2282 Pm\nW then one can construct a Lefschetz pencil on XK with axis lying in the\ndivisor DK . The singular fibres in UK \u2192 SK will each then only have unique double-points.\n2.3.2\n\nF-crystals and isocrystals\n\nDefinition 2.1. An F -crystal is a finitely generated W -module M with a linear map F :\n\u03c3 \u2217 M \u2192 M which becomes an isomorphism after tensoring with K. An F -isocrystal is a finite\n\u2217\nV \u2192 V which is an isomorphism.\ndimensional K-vector space V with a linear map F : \u03c3K\n4\n\n\fThat is, an F -crystal is a finitely generated W -module M with a \u03c3-linear map F : M \u2192 M\nwhich becomes an injection after tensoring by K, and an F -isocrystal is a finite dimensional\nK-vector space with an injective \u03c3K -linear map F : V \u2192 V . Define the F -crystal W (m) (m \u2208\nZ, m \u2264 0) to be the rank one module over W where F acts on the basis elements by multiplication by p\u2212m , and likewise for K(m) (m \u2208 Z). We define Tate twists M (m) := M \u2297W W (m)\nof an F -crystal M , and likewise for F -isocrystals.\nLet i be an integer. Associated to X and D are F -crystals\ni\ni\ni\n(D), and Hcris\n((X, D))\nHcris\n(X), Hcris\n\ncalled the crystalline cohomology of X and D and log-crystalline cohomology of the pair (X, D),\nrespectively. The groups above fit together in an F -equivariant long exact sequence [1, Definition\n2.3.3, Proposition 2.4.1, Proposition 2.2.8]\ni\u22121\ni\ni\n* * * \u2192 Hcris\n(X) \u2192 Hcris\n((X, D)) \u2192 Hcris\n(D)(\u22121) \u2192 * * *\n\n(1)\n\nAssociated to X , D, U, V, Z and Vs are F -isocrystals\ni\ni\ni\ni\ni\nHrig\n(X), Hrig\n(D), Hrig\n(U ), Hrig\n(V ), and Hrig\n(Vs )\ni\ncalled the rigid cohomology of the special fibres, and F -isocrystals Hrig,Z\n(U ) called the rigid\ncohomology of U with support in Z. There is an F -equivariant long exact sequence\ni\ni\ni\n* * * \u2192 Hrig,Z\n(U ) \u2192 Hrig\n(U ) \u2192 Hrig\n(V ) \u2192 * * * .\n\n(2)\n\ni\n(The F -isocrystals Hrig,Z\n(U ) are really just defined to make this sequence exact [16, Section\n4.4].) There are natural maps\ni\n(X)\n\u2192 Hrig\ni\n\u2192 Hrig (U )\n\ni\n(X)\nHcris\ni\nHcris ((X, D))\n\nwhich are injections modulo torsion with images full rank W -lattices [1, Definition 2.3.3, Proposition 2.4.1]. We shall use the same symbol F to denote the Frobenius action on each of the\nF -crystals and F -isocrystals listed above.\nDefinition 2.2. The following images are Frobenius-invariant W -lattices sitting naturally in\nK-vector spaces; that is, F -crystals embedded naturally in F -isocrystals.\nH(X)prim\nH(X, log D)\nH(X)\n\nn\nn\n:= Im(Hcris\n(X) \u2192 Hrig\n(U ))\nn\nn\n(U ))\n:= Im(Hcris ((X, D)) \u2192 Hrig\nn\nn\n:= Im(Hcris\n(X) \u2192 Hrig\n(X)).\n\nFor the surfaces we consider, the lattice H(X)prim is exactly the free part of the primitive\nmiddle-dimensional crystalline cohomology.\n2.3.3\n\nA summary of the method\n\nWe wish to calculate a p-adic approximation to a matrix for the action of F on the full rank\nFrobenius-invariant W -lattice H(X). The reason why it is important to work with a basis for\nthis lattice rather than an arbitrary basis is given in [18, Section 9.3.2]. Essentially, one can\nexploit the Hodge filtration to significantly reduce the power of p to which the matrix needs to\nbe calculated. We first note that it is both easier and more efficient to compute a matrix for\nn\nF on the W -lattice H(X)prim . It is easier because U is affine and so the elements in Hrig\n(U )\ncan be described via n-forms defined on UK . It is more efficient, at least for the case n = 2 of\nsurfaces, since H(X)prim is the quotient of H(X) by the rank one lattice generated by the class\nof the curve D, and the Frobenius action on the class of this curve is just multiplication by q.\nThe steps in our algorithm for calculating F on the lattice H(X)prim and our work upon\nthe different steps can be tersely summarised as follows.\n5\n\n\fn\n\u2022 Step 1: Find a set of n-forms in \u0393(UK , \u03a9nUK ) whose image in Hrig\n(U ) is a basis for the\nfull rank W -lattice H(X, log D). [This is the problem of finding explicit bases in logcrystalline cohomology. It is solved for surfaces in certain weighted projective spaces in\nSections 3 and 4.]\n\n\u2022 Step 2: Use the long exact sequence for crystalline and log-crystalline cohomology (1)\nto compute a basis for the sublattice H(X)prim \u2286 H(X, log D) from one for H(X, log D)\nitself. [This is the problem of explicitly computing the residue map. It is briefly discussed\nin Section 6.3.]\n\u2022 Step 3: Use the long exact sequence in rigid cohomology (2) to map the basis elements\nn\nfor H(X)prim into the space Hrig\n(V ). Thus one reduces the problem to that of calculating\nn\nthe action of F on the space Hrig\n(V ). [We discuss this in Section 6 for certain surfaces.]\n\u2022 Step 4: Use the smooth fibration V \u2192 S to reduce the problem to that of calculating the\nn\u22121\naction of F on the space Hrig\n(Vs ) for one smooth fibre Vs \u0592\u2192 V defined over Fq . [This is\nthe heart of the fibration method, and is dealt with in detail in [18, Sections 3, 4, 5]. One\noutstanding problem which is not fully resolved in [18] is that of finding a Fuchsian basis.\nThis problem is explained in Section 7, and in Section 8.3 a solution for elliptic curves is\ngiven using an algorithm due to W. Dekkers.]\nIn practice, it is not always necessary or desirable to carry out Steps 1 and 2 exactly as stated.\nFirst, it is easier though perhaps slightly less efficient to compute a matrix for F on the full\nW -lattice H(X, log D) rather than its sublattice H(X)prim ; that is, to omit Step 2. Second, it is\nnot necessary to find H(X, log D) exactly, as a lattice which is very close to it will be sufficient.\nFor example, in our application to surfaces X we actually work with a lattice H(X, kD) (k \u226b 0,\nsee Theorem 3.11 and Definition 4.9) such that\n\u03c1\n\ni\n\n2\nH(X)prim \u0592\u2192 H(X, log D) \u0592\u2192 H(X, kD) \u2286 Hrig\n(U )\n\nwhere the cokernel of the embedding \u03c1 is killed by p\u230alogp (k+1)\u230b . For certain elliptic surfaces the\nmap i is an isomorphism and when p is large enough relative to the degree of the surface so\nis \u03c1, so we find H(X)prim exactly. For the examples we present in Section 9, the corank of\nthe image of i is 2, and the map \u03c1 has cokernel killed by at worst p2 . So H(X, kD) contains a\nsublattice of corank 2 which is very close to H(X)prim . This is good enough for our application.\nTheorem 5.1 exactly quantifies the benefits one obtains from working with a basis of the lattice\nH(X, kD).\n\n2.4\n\nL-functions\n\nWe now explain the relevance of our algorithm to the computation of L-functions of certain\ncurves. Let U \u2282 A3Fq be a smooth affine surface and U \u2192 A1Fq be the fibration via one of the\ncoordinate axes. Assume that one can extend U \u2192 A1Fq to a map X\u0302 \u2192 P1Fq where X\u0302 is a smooth\nprojective surface. Assume that the singular fibres of the map are geometrically irreducible, so\nthe trivial part of the N\u00e9ron-Severi lattice of X\u0302 is generated by the class of the zero section and\na smooth fibre. Define the F -invariant W -lattice\n2\n2\nH := Image(Hcris\n(X\u0302) \u2192 Hrig\n(U )).\n\nWe shall define the L-function of the generic curve X\u0302\u03b7 in the family X\u0302 \u2192 P1Fq to be\nL(X\u0302\u03b7 , T ) := det(1 \u2212 T Fq |H \u2297W K).\nThis agrees with the usual definition, since it is exactly the \"interesting part\" of the zeta\n2\n(X\u0302)) by removing factors coming from\nfunction, obtained from P2 (X\u0302, T ) := det(1 \u2212 T Fq |Hrig\n2\nthe classes of the zero section and a smooth fibre in Hcris (X\u0302).\nNote that in our application we shall compactify U to a (quasi-smooth) surface X in weighted\nprojective space, and the lattice H(X)prim will then be defined (see Section 4.2) and equal to\nH above.\n6\n\n\f3\n\nCrystalline cohomology of smooth surfaces in P3\n\nn\nIn this section we address the problem of finding the lattice H(X, log D) = Im(Hcris\n((X, D)) \u2192\nn\nHrig\n(U )), in the case in which X is a smooth surface of degree d sitting in projective space P3Fq .\nWe shall proceed in some generality in Sections 3.1, 3.2 and 3.3, before specialising to smooth\nsurfaces in P3Fq in Section 3.4. Ultimately, we will be satisfied with finding a lattice H(X, kD),\nfor any k \u2265 max{2d \u2212 4, 0}, which contains H(X, log D) as a sublattice, with the quotient an\nabelian group killed by multiplication by p\u230alogp (k+1)\u230b . We use these lattices to define analogous\nlattices in Section 4 associated to certain weighted projective surfaces, and explain why all of\nthese lattices are useful in Section 5.\n\n3.1\n\nCrystalline and de Rham cohomology\n\nLet X be a smooth W -scheme of relative dimension 2 and D a smooth divisor on X . For i \u2265 0,\ndenote by \u03a9iX := \u2227i \u03a91X the sheaf of differential i-forms on X , and by\n\u03a9\u2022X : 0 \u2192 OX \u2192 \u03a9X \u2192 \u03a92X \u2192 0\nthe algebraic\nby definition\nmodule. The\nan analogous\ni-forms on X\n\nde Rham complex of X . The algebraic de Rham cohomology HdR (X ) of X is\nthe hypercohomology H(\u03a9\u2022X ) of this complex. This is a finitely generated W complex \u03a9\u2022D and finitely generated W -module HdR (D) := H(\u03a9\u2022D ) are defined in\nmanner. For i \u2265 0, denote by \u03a9i (log D) := \u2227i \u03a91X (log D) the sheaf of differential\nwith logarithmic poles along D, and by\n\u03a9\u2022X (log D) : 0 \u2192 OX \u2192 \u03a9X (log D) \u2192 \u03a92X (log D) \u2192 0\n\nthe logarithmic de Rham complex [1, Definition 2.2.2]. The log-de Rham cohomology HdR ((X , D))\nis by definition the hypercohomology H(\u03a9\u2022X (log D)) of this complex. This is a finitely generated\nW -module. There is an exact sequence\nRes\n\n0 \u2192 \u03a9\u2022X \u2192 \u03a9\u2022X (log D) \u2192 j\u2217 \u03a9\u2022D [+1] \u2192 0\nwhere the map Res is the residue map and j : D \u0592\u2192 X [1, Proposition 2.2.8]. This induces a\nlong exact sequence on the hypercohomology groups:\ni\u22121\ni\ni\n* * * \u2192 HdR\n(X ) \u2192 HdR\n((X , D)) \u2192 HdR\n(D) \u2192 * * * .\n\nLet X and D be the special fibres of X and D respectively. Associated to the smooth pair of\nFq -varieties (X, D) are finitely generated W -modules with canonical isomorphisms [1, Definition\n2.3.3, Proposition 2.4.1]\nHcris (X) \u223c\n= HdR (X ), Hcris (D) \u223c\n= HdR (D), Hcris ((X, D)) \u223c\n= HdR ((X , D)).\nThese are the crystalline and log-crystalline cohomology groups. The aim of this section is to\ni\ngive an explicit presentation of the log-crystalline cohomology groups Hcris\n((X, D)) in terms of\nthe homology of a complex of free W -modules of finite rank.\n\n3.2\n\nThe hypercohomology of the logarithmic de Rham complex\n\nFor i, k \u2265 0, let \u03a9i (kD) := \u03a9iX \u2297OX OX (kD) denote the sheaf of differential i-forms on X with\npoles of order bounded by k along D. Consider the complex\n\u03a9\u2022X ((k + \u2022)D) : 0 \u2192 OX (kD) \u2192 \u03a9X ((k + 1)D) \u2192 \u03a92X ((k + 2)D) \u2192 0.\nTheorem 3.1. The cokernels of the maps of homology sheaves induced by the natural map of\ncomplexes of sheaves\n\u03a9\u2022X (log D) \u0592\u2192 \u03a9\u2022X ((k + \u2022)D)\nare killed by multiplication by lcm{1, 2, . . . , k + 1}. Moreover, the induced maps on homology\nsheaves are injective.\n7\n\n\fProof. We will show using \u00e9tale local coordinates that for each 0 \u2264 i \u2264 2 the map of homology\nsheaves\nHi (\u03a9\u2022X (log D)) \u2192 Hi (\u03a9\u2022X ((k + \u2022)D))\nis an injection and has cokernel killed by lcm{1, 2, . . . , k + i \u2212 1}. We shall use subscripts x and\ny to denote partial differentiation w.r.t. x and y, respectively.\nFor points not lying on D there is nothing to prove, since locally at these points the sheaves\nare isomorphic. Etale locally around a point on D the pair (X , D) looks like the hyperplane\nsection x = 0 of an open subset Spec(R) of Spec(W [x, y]). By a further Zariski localisation we\nmay assume R contains a subring isomorphic to R/(x), and derivation w.r.t. x is trivial on this\nsubring. (That is, with S := {y0 | (0, y0 ) 6\u2208 Spec(R)}, replace R by R\u2032 := R[1/(y \u2212 y0 ); y0 \u2208 S]\nand then W [y][1/(y\u2212y0 ); y0 \u2208 S] is the required subring of R\u2032 isomorphic to R\u2032 /(x); then replace\nthe notation R\u2032 by R.) Let l be a positive integer, and define nl := lcm{1, 2, . . . , l \u2212 1}. For\nP\nP\ni\n\u22121\ni+1\na = \u22121\n] where ai (y) \u2208 R/(x) \u2282 R, define \u00e2 := \u22122\n\u2208\ni=\u2212l ai (y)x \u2208 R[x\ni=\u2212l (ai (y)/(i + 1))x\n\u22121\n\u22121\nR[x ] \u2297W K. Then \u00e2x = a + (a\u22121 (y)/x) and nl \u00e2 \u2208 R[x ].\nFor i = 0 there is nothing to prove since the closed 0-forms are just the constant functions for\nboth sheaves. For i = 2, let \u03b1(x, y)dx\u2227dy \u2208 \u03a92R[x\u22121 ] be a closed 2-form with a pole of order k+2.\nLet \u03b1 = a(x, y)+b(x, y) where b has no pole along D, and write a as in the preceding paragraph,\ntaking l = k + 2. Define \u03b2 := \u00e2dy \u2208 \u03a91R[x\u22121 ] \u2297W K. Then \u03b1dx \u2227 dy \u2212 d\u03b2 = a\u22121xdx \u2227 dy + \u03b3\nwhere the 2-form \u03b3 has no pole along D. Morever, nk+2 \u03b2 \u2208 \u03a9R[x\u22121 ] . Thus after multiplication\nby nk+2 locally any 2-form can be written modulo exact 2-forms as a 2-form with a log-pole\nalong D. This proves the claim on the cokernel for i = 2.\nWe now consider the cokernel for i = 1. Let \u03b1 = \u03b2(x, y)dx + \u03b3(x, y)dy \u2208 \u03a91R[x\u22121 ] be a closed\n1-form with a pole of order k + 1 along D. Since \u03b1 is closed, \u03b2y = \u2212\u03b3x . As before, write\n\u03b2 = a(x, y) + b(x, y) where b has no pole along D, and write a as above, taking l = k + 1. Then\n\u03b1 \u2212 d(\u00e2) = a\u22121xdx + (\u03b3 \u2212 \u00e2y )dy. Using the equation \u03b2y = \u2212\u03b3x we see that \u03b3 \u2212 \u00e2y has no pole\nalong D. Thus after multiplication by nk+1 locally any closed 1-form can be written modulo\nexact 1-forms as a 1-form with a log-pole along D.\nWe now prove the maps on sheaves are injective by examining kernels. For i = 0 there\nis nothing to prove. For i = 1, a closed 1-form \u03b1 \u2208 \u03a91R[x\u22121 ] with a log-pole has the form\n\u03b2(x, y) dx\nx + \u03b3(x, y)dy where the functions \u03b2, \u03b3 \u2208 R have no poles along D, with (\u03b2/x)y = \u2212\u03b3x .\nSuppose that \u03b1 = df for some function f (x, y) \u2208 R[x\u22121 ] with a pole of order l \u2265 1 along D.\nSince fy = \u03b3, we see fy has no pole along D, so f must be independent of y with \u03b3 = fy = 0.\nThus (\u03b2/x)y = 0, so \u03b2 does not depend on y, and we have f (x)x = \u03b2(x)/x. This can only be\ntrue if \u03b2(x)/x has no pole along D, and so neither does f , a contradiction. Thus no such f can\nexist, and the map on homology sheaves is injective for i = 1.\nNow let i = 2. A (closed) 2-form \u03b1 \u2208 \u03a92R[x\u22121 ] with a log-pole locally has the form \u03b2(x, y) dx\nx \u2227\ndy for some function \u03b2 \u2208 R with no pole along D. Suppose that \u03b1 = d\u03b3 where the 1-form\n\u03b3 \u2208 \u03a91R[x\u22121 ] has a pole of order l \u2265 1 along D. We shall show that the exists a 1-form\n\u03b3 \u2032 \u2208 \u03a91R[x\u22121 ] with a log-pole along D such that \u03b1 = d\u03b3 \u2032 . This proves our map of homology\nsheaves is injective on 2-forms.\nWrite \u03b3 = a(x, y)dx + b(x, y)dy. Let a = a\u2032\u2032 + a\u2032 and b = b\u2032\u2032 + b\u2032 where a\u2032 has a simple\nP\u22122\ni\n\u2032\n\u2032\u2032\npole along D with a\u2032\u2032 := a \u2212 a\u2032 =\ni=\u2212l ai (y)x , and b has no pole along D with b :=\nP\n\u22121\ni\nb \u2212 b\u2032 =\ni=\u2212l bi (y)x . Then since \u03b2(x, y)/x = bx \u2212 ay has a log-pole, we see b\u2212l = 0,\nand for i = \u2212l, \u2212l + 1, . . . , \u22122 we have (ai )y = (i + 1)bi+1 . Hence \u03b3 \u2032\u2032 := a\u2032\u2032 dx + b\u2032\u2032 dy is a\nclosed 1-form. Defining \u03b3 \u2032 := a\u2032 dx + b\u2032 dy one sees that \u03b3 \u2032 has a log-pole along D. Moreover,\n\u03b1 = d\u03b3 = d(\u03b3 \u2032 + \u03b3 \u2032\u2032 ) = d\u03b3 \u2032 , as required.\nNote 3.2 An analogue of the claim on the cokernel is proved in [1, Theorem 2.2.5] with\nthe complex \u03a9\u2022X ((k + \u2022)D) replaced by the twisted logarithmic complex whose ith term is\n\u03a9iX (log D)\u2297OX OX (kD), for the more general situation in which D is a smooth normal crossings\ndivisor in a smooth W -scheme X of arbitrary dimension n.\nDefine the complex of sheaves Q\u2022 on X so that the sequence\n0 \u2192 \u03a9\u2022X (log D) \u2192 \u03a9\u2022X ((k + \u2022)D) \u2192 Q\u2022 \u2192 0\n8\n\n(3)\n\n\fis exact.\nCorollary 3.3. The homology sheaves Hi (Q\u2022 ) of the complex Q\u2022 are killed by multiplication\nby lcm{1, 2, . . . , k + 1}.\nProof. The long exact sequence for homology sheaves from the short exact sequence (3) has the\nform\n\u03c6i\n\u03b8\n* * * \u2192 Hi (\u03a9\u2022X (log D)) \u2192i Hi (\u03a9\u2022X ((k + \u2022)D)) \u2192 Hi (Q\u2022 )\n\u03c8i\n\n\u03c6i+1\n\n\u03b8i+1\n\n\u2192 Hi+1 (\u03a9\u2022X (log D)) \u2192 Hi (\u03a9\u2022X ((k + \u2022)D)) \u2192 * * *\nSince \u03b8i+1 is an injection by Theorem 3.1, Hi (Q\u2022 ) is isomorphic to the cokernel of \u03b8i and thus\nby that theorem is killed as claimed.\nIn the nicest situation one has the following corollary to Theorem 3.1.\nCorollary 3.4. If the characteristic p of the residue field of W is strictly greater than k + 1,\nthen we have the following isomorphism of hypercohomology groups:\nHdR ((X , D)) := H(\u03a9\u2022X (log D)) \u223c\n= H(\u03a9\u2022X ((k + \u2022)D)).\nProof. Since in this case lcm{1, 2, . . . , k + 1} is invertible in W , for each i by Theorem 3.1\nwe have an isomorphism of homology sheaves Hi (\u03a9\u2022X (log D)) \u223c\n= Hi (\u03a9\u2022X ((k + \u2022)D)). These\np,q\nhomology sheaves are the first terms in a spectral sequence E2 := H p (X , Hp (\u22c6)) computing the\nhypercohomology of each complex of sheaves \u22c6 [9, Remark 2.1.6 (i)]. Hence the hypercohomology\ngroups are isomorphic.\nIn general, one must be satisfied with the next corollary.\nCorollary 3.5. Let Hi denote the ith hypercohomology group. The kernel and cokernel of the\nmap Hi (\u03a9\u2022X (log D)) \u2192 Hi (\u03a9\u2022X ((k + \u2022)D)) are killed by multiplication by p\u230alogp (k+1)\u230b .\nProof. In this case by Corollary 3.4 for each i the homology sheaves Hi (Q\u2022 ) are killed by\nmultiplication by p\u230alogp (k+1)\u230b and hence so is the hypercohomology H(Q\u2022 ). The result follows\nfrom the long exact sequence in hypercohomology for the short exact sequence (3).\n\n3.3\n\nThe hypercohomology of \u03a9\u2022X ((k + \u2022)D).\n\nThe hypercohomology of \u03a9\u2022X ((k + \u2022)D) is accessible because of the following proposition.\nProposition 3.6. Assume k \u2265 0 is chosen so that the sheaves \u03a9iX ((k + i)D) are acyclic for\ni = 0, 1, 2. Then the hypercohomology of \u03a9\u2022X ((k+\u2022)D) is canonically isomorphic to the homology\nof the complex \u0393(X , \u03a9\u2022X ((k + \u2022)D)) of rings of global sections:\nd\n\n0 \u2192 \u0393(X , OX (kD)) \u2192 \u0393(X , \u03a9X ((k + 1)D)) \u2192 \u0393(X , \u03a92X ((k + 2)D)) \u2192 0.\nProof. The hypercohomology of \u03a9\u2022X ((k + \u2022)D) may be calculated via a spectral sequence, the\nfirst terms of which are the W -modules E1p,q := H q (X , \u03a9pX ((k + p)D)) [9, Remark 2.1.6 (ii)].\nSince the sheaves are acyclic, E1p,q = 0 for q > 0, and so this spectral sequence degenerates\nafter the first term. Hence the hypercohomology is just the homology of the complex of rings\nof global sections.\nCorollary 3.7. Assume that k \u2265 0 is chosen to satisfy the conditions of Proposition 3.6. Then\nthe natural map\n\u0393(X , \u03a92X ((k + 2)D))\n2\n(4)\nHcris\n((X, D)) \u2192\nd(\u0393(X , \u03a91X ((k + 1)D))\nhas kernel and cokernel killed by multiplication by p\u230alogp (k+1)\u230b . In particular, for p > k + 1 this\nmap is an isomorphism.\n\u2022\nProof. This follows from Corollary 3.5 and Proposition 3.6 and the natural isomorphism HdR\n((X , D)) \u223c\n=\n\u2022\nHcris ((X, D)).\n\n9\n\n\fBy Serre's vanishing theorem [11, Theorem III.5.2.(b)], the hypothesis of Proposition 3.6\nwill be satisfied for k \u226b 0. It remains to calculate an explicit value for k that one may choose.\nWe shall do this for the case in which X is a smooth surface in P3 .\nNote 3.8 The twisted logarithmic de Rham complex whose ith term is \u03a9iX (log D)\u2297OX OX (kD),\nwhich appears in [1, Theorem 2.2.5], will also be acyclic for k \u226b 0. However, the complex\n\u03a9\u2022X ((k + \u2022)D) seems easier to compute with.\n\n3.4\n\nVanishing theorems for smooth surfaces in P3\n\nIn this section we calculate explicit values of k which make the sheaves \u03a9iX ((k + i)D) acyclic,\nfor X a smooth surface in P3W .\nLet X be a smooth surface of degree d in projective space P := P3W with ideal sheaf I \u223c\n=\nOP (\u2212d). The latter condition is satisfied precisely when the surface X \u2297W Fq is of degree d.\nFor k \u2208 Z let OX (k) denote the twisting sheaf, and as usual define \u03a9iX (k) := \u03a9iX \u2297OX OX (k).\nLet D be a hyperplane section. For any k \u2208 Z we have \u03a9iX (kD) := \u03a9iX \u2297OX OX (kD) \u223c\n= \u03a9iX (k).\nThe proof of the following theorem was explained to the author by Bjorn Poonen.\nTheorem 3.9 (Poonen). The sheaves OX (k), \u03a9X (k) and \u03a92X (k) are acyclic for k > d \u2212 4,\nk > max{2d \u2212 4, 0}, and k > 0, respectively.\nProof. Let F be the defining polynomial for the surface X , and \u03c0 : X \u0592\u2192 P. The proof is based\nupon the following three exact sequences of sheaves c.f. [11, II.8.17, II.8.13]\n\u00d7F\n\n0 \u2192 OP (\u2212d) \u2192 OP \u2192 \u03c0\u2217 OX \u2192 0 on P.\n\n(5)\n\n0 \u2192 I/I 2 \u2192 \u03a9P |X \u2192 \u03a9X \u2192 0 on X\n\n(6)\n\n0 \u2192 \u03a9P \u2192 OX (\u22121)\u22954 \u2192 OP \u2192 0 on P,\n\n(7)\n\nand the calculation of the homology of projective 3-space P c.f. [11, III.5]\nH 0 (P, OP (e)) = 0 for e < 0\nH 1 (P, OP (e)) = H 2 (P, OP (e)) = 0 for all e\nH 3 (P, OP (e)) = 0 for e > \u22124.\nSince OP (e) is locally free and hence flat we may twist (5) by OP (e) and take homology to\nobtain the exact sequences\nH i (P, OP (e)) \u2192 H i (P, \u03c0\u2217 OX (e)) \u2192 H i+1 (P, OP (e \u2212 d)) for i \u2265 0.\n\n(8)\n\nSince \u03c0 is affine, we have H i (X , OX (e)) \u223c\n= H i (P, \u03c0\u2217 OX (e)) and from (8) and the homology of\nP we see that the latter vanishes for i > 0 and e \u2212 d > \u22124.\nNext, restricting (7) to X , twisting by OX (e) and taking homology we get exact sequences\nH i\u22121 (X , OX (e)) \u2192 H i (X , \u03a9P (e)|X ) \u2192 H i (X , OX (e \u2212 1))\u22954 for i \u2265 1.\nUsing our result on the vanishing of H i (X , OX (e)) we immediately deduce\nH i (X , \u03a9P (e)|X ) = 0 for i > 1 and e > d \u2212 3.\nFor i = 1, we need also determine when the the map\nH 0 (X , OX (e \u2212 1))\u22954 \u2192 H 0 (X , OX (e))\n\n(9)\n\nis a surjection. We need to determine explicitly what the spaces are and map is. First, twisting\n(5) by OP (e) and using the fact H 1 (P, OP (e)) = 0 we get that H 0 (X , OX (e)) equals the quotient\nof the space of homogeneous polynomials of degree e modulo those of the form F G where G is\nhomogeneous of degree e \u2212 d. Second, observe that the map in (9) comes from that in (7), and\nthe ith component is just multiplication by the ith variable Xi . So the map is surjective as soon\n10\n\n\fas e > 0; for one can obtain any monomial of degree e > 0 by multiplying some monomial of\ndegree e\u22121 by one of the Xi . Thus the map is surjective when e > 0, and so H 1 (X , \u03a9P (e)|X ) = 0\nfor e > max{0, d \u2212 3}.\nNow observe since I \u223c\n= OP (\u2212d) we have\nI/I 2 \u223c\n= I \u2297 OP /I \u223c\n= OP (\u2212d) \u2297 OX = OX (\u2212d).\nSo twisting (6) by OX (e) and taking homology we get exact sequences\nH i (X , \u03a9P (e)|X ) \u2192 H i (X , \u03a9X (e)) \u2192 H i+1 (X , OX (e \u2212 d)) for i \u2265 0.\nThus H i (X , \u03a9X (e)) = 0 for i > 0 and e > max{0, 2d \u2212 4}.\nFinally, taking top exterior powers in (6) one deduces \u03a92X \u223c\n= OX (d \u2212 4), which completes\nthe proof.\n\n3.5\n\nCrystalline lattices for smooth surfaces in P3\n\nThe next two theorems are the main results of Section 3.\nTheorem 3.10. Let X be a smooth surface in P3W of degree d which remains of degree d when\nreduced modulo p, and D the hyperplane section at infinity which we assume to be smooth. Let\nk + 1 > max{2d \u2212 4, 0}. Then the natural map\n2\nHcris\n((X, D)) \u2192\n\n\u0393(X , \u03a92X ((k + 2)D))\nd(\u0393(X , \u03a91X ((k + 1)D)))\n\n(10)\n\nhas kernel and cokernel killed by multiplication by p\u230alogp (k+1)\u230b .\nProof. Immediate from Corollary 3.7 and Theorem 3.9\nTheorem 3.11. With notation as in Theorem 3.10, let H(X, kD) denote the image of the\n2\nrighthand side of (10) in Hrig\n(U ), where U = X\\D. Let H(X, log D) denote the image of\n2\n2\nHcris ((X, D)) in Hrig (U ). Then there is a natural embedding H(X, log D) \u2192 H(X, kD) with\ncokernel killed by multiplication by p\u230alogp (k+1)\u230b .\n2\nProof. The maps Hcris\n((X, D)) \u2192 H(X, log D) and\n\n\u0393(X , \u03a92X ((k + 2)D))\n\u2192 H(X, kD)\nd(\u0393(X , \u03a91X ((k + 1)D)))\nare isomorphisms modulo torsion. The map H(X, log D) \u2192 H(X, kD) is defined via these\nisomorphisms, and its cokernel is killed as claimed by Theorem 3.10. It is am embedding since\nthe kernel of the map (10) is torsion.\n\n3.6\n\nFrobenius-Hodge structures for smooth surfaces in P3\n\nIn this section we gather some results which will be applied in Sections 4.2 and 5. We begin\nwith an entirely utilitarian definition whose relevance will shortly become apparent. Note that\nit is exactly adequate for our purposes but inadequate for general use.\nDefinition 3.12. A torsion-free F -crystal H has a (pure) Frobenius-Hodge structure if there\nexists j, m \u2208 Z with j, m \u2265 0 and a filtration by submodules 0 = Hm+1 \u2286 Hm \u2286 * * * \u2286 H0 = H\nsuch that F (Hi ) \u2286 pj+i (H) for 0 \u2264 i \u2264 m. A torsion-free F -crystal H has a (mixed) FrobeniusHodge structure if there exists a short exact sequence of F -crystals 0 \u2192 H1 \u2192 H \u2192 H2 \u2192 0\nsuch that H1 and H2 have pure Frobenius-Hodge structures.\nLet X be a smooth hypersurface in PnW with special fibre X and generic fibre XK . Then the\nm\nW -modules H j (X , \u03a9iX ) are torsion free [21, Page 660, Lines 15-16], and thus so are Hcris\n(X)\n(this is implied by the remarks [21, Page 662, Lines 7-9] and the statement of [21, Theorem\n11\n\n\f2]). We define the Hodge numbers hi,j := rank (H j (X , \u03a9iX )) = dim(H j (XK , \u03a9iXK )). Note that\nhi,j = hj,i . Let p be the residue characteristic of W , and assume that p > n \u2212 1 = dim(X).\nThe following result is from [21, Section 5]. There exist a filtration (Hodge filtration)\nm\n0 := Hm+1,m \u2286 Hm,m \u2286 Hm\u22121,m \u2286 * * * \u2286 H0,m = Hcris\n(X)\nm\nsuch that the pth power Frobenius F acts as F (Hi,m ) \u2286 pi Hcris\n(X). Moreover, rank (Hi,m /Hi+1,m ) =\ni,m\u2212i\nm\nh\nfor 0 \u2264 i \u2264 m. Thus Hcris (X) has a pure Frobenius-Hodge structure, see Definition\n3.12, with the ranks of the submodules in the filtration determined by the Hodge numbers of\nXK .\nNow let X be a smooth surface in P3W . Let D \u2282 P2W be the curve at infinity, which we\nassume to be smooth. Then the results in the above paragraph apply to give pure Frobenius2\n1\n1\n3\nHodge structures on Hcris\n(X ) and Hcris\n(D). Since Hcris\n(X) = Hcris\n(X) are torsion-free,\n1\n3\nand we know Hrig (X) = Hrig (X) = 0, by the Lefschetz hyperplane theorem, one deduces\n1\n3\nHcris\n(X) = Hcris\n(X) = 0. Moreover, since the cycle class map is injective in codimension 1\n[23, Page 97], from (14) one deduces the following exact sequence.\n2\n2\n1\n(X) \u2192 Hcris\n((X, D)) \u2192 Hcris\n(D)(\u22121) \u2192 0.\n0 \u2192 W (\u22121) \u2192 Hcris\n\n(11)\n\n2\nNote that F acts by multiplication by p on the rank 1 F -crystal W (\u22121), so Hcris\n(X)/W (\u22121) has\n2\na pure Frobenius-Hodge structure. The sequence (11) shows that Hcris ((X, D)) is torsion-free,\n2\nand defines a mixed Frobenius-Hodge structure on Hcris\n((X, D)), see Definition 3.12\n\n4\n\nWeighted projective surfaces\n\nIn this section we consider the case in which X is a surface of degree d in the weighted projective\nspace P(1, a, b, c)W . Following a suggestion of A.J. de Jong, we view X in a standard way as the\nquotient of a surface X \u0303 in P3 by the action of a finite group G \u223c\n= Z/(a)\u00d7Z/(b)\u00d7Z/(c). We assume\nthat X \u0303 is smooth with the G-invariant divisor at infinity D\u0303 smooth, and also that the affine piece\n2\n(U )\nU := X \u2229 A3W is smooth. Under these assumptions, we define a lattice H(X, log D) \u2282 Hrig\n2\nand for each k \u2265 max{2d \u2212 4, 0} explicitly construct a lattice H(X, kD) \u2282 Hrig (U ) such\nthat there is a embedding H(X, log D) \u2192 H(X, kD) with cokernel killed by multiplication by\np\u230alogq (k+1)\u230b . We explain the importance of the lattices H(X, log D) and H(X, kD) in Section 5.\n\n4.1\n\n2\nThe lattices H(X, log D) \u2286 H(X, kD) in Hrig\n(U)\n\nWe first define our ambient weighted projective space.\nDefinition 4.1. Let a, b, c be positive integers, and P(1, a, b, c)W be a weighted projective space\nover W ; that is, Proj(S) where the ring S := W [T, X, Y, Z] is graded by assigning weights\nwt(T ) := 1, wt(X) := a, wt(Y ) := b, wt(Z) := c. Assume that the residue characteristic p of W\ndoes not divide abc.\nNote that if desired one can assume that gcd(a, b, c) = 1 (although this plays no part in our\nproofs) since in any case P(1, a, b, c)W \u223c\n= P(1, a/e, b/e, c/e)W where e := gcd(a, b, c) [7, Page\n186].\nThe open subscheme defined by T 6= 0 is isomorphic to affine 3-space A3W with coordinates\ngiven by x := X/T a, y := Y /T b and z := Z/T c. Let R := W [X0 , X1 , X2 , X3 ] be the graded\npolynomial ring with wt(Xi ) := 1 for 0 \u2264 i \u2264 3 and define projective 3-space P3W := Proj(R).\nConsider the injective map of graded rings\n\u03c0 : S \u2192 R, T 7\u2192 X0 , X 7\u2192 X1a , Y 7\u2192 X2b , Z 7\u2192 X3c .\nThis induces a quotient map P3W \u2192 P(1, a, b, c)W of topological spaces.\nAssume now that W is large enough to contain primitive ath, bth and cth roots of unity\n\u03b6a , \u03b6b and \u03b6c , respectively. See Note 4.11 for a discussion of the general case. Let the group\nG := Z/(a) \u00d7 Z/(b) \u00d7 Z/(c) act on R by\nG \u00d7 R \u2192 R, (i, j, k) \u00d7 f (X0 , X1 , X2 , X3 ) 7\u2192 f (X0 , \u03b6ai X1 , \u03b6bj X2 , \u03b6ck X3 ).\n12\n\n\fLemma 4.2. The invariant subring RG of R under the action of G is exactly \u03c0(S) = R[X0 , X1a , X2b , X3c ].\nP\nProof. Certainly \u03c0(S) \u2286 RG . Suppose now that f = i ai X i \u2208 RG where i := (i0 , i1 , i2 , i3 ) \u2208\nZ4\u22650 and X i := X0i0 * * * X3i3 . Since G acts on each term ai X i in f by scalar multiplication,\neach term in f must be fixed by G. So it is enough to consider the case of a single monomial\nf = X0i0 * * * X3i3 . By considering the action of (1, 0, 0), (0, 1, 0), (0, 0, 1) \u2208 G in turn, one deduces\nthat a|i1 , b|i2 and c|i3 , so f \u2208 \u03c0(S), as required.\nCorollary 4.3. The weighted projective space P(1, a, b, c)W is isomorphic to the quotient scheme\nP3W /G.\n\u03c0\n\nProof. By Lemma 4.2, S \u223c\n= Proj(RG ) =: P3W /G.\n= RG , and so Proj(S) \u223c\nLet X be a hypersurface in P(1, a, b, c)W defined by a weighted homogeneous polynomial\nP (T, X, Y, Z) of degree d. Assume that the hypersurface X\u0303 in P3W defined by the polynomial\n\u03c0(P ) = P (X0 , X1a , X2b , X3c ) is a smooth W -scheme with ideal sheaf I \u223c\n= OP3W (\u2212d). Define D and\nD\u0303 to be the divisors on X and X\u0303 , respectively, defined by the ideals (T ) and (X0 ), respectively.\nLet U := X \\D and \u0168 := X \u0303 \\D\u0303.\nLemma 4.4. The group G acts on X \u0303 with X \u223c\n= X\u0303 /G, on \u0168 with U \u223c\n= \u0168/G, and on D\u0303 with\nD\u223c\nD\u0303/G.\n=\nProof. The group G acts on X\u0303 since the ideal (\u03c0(P )) is G-invariant. Now X \u0303 /G := Proj((R/(\u03c0(P )))G )\n\u03c0\nand we note (R/(\u03c0(P )))G \u223c\n= RG /(\u03c0(P )). The isomorphism S \u2192 RG reduces modulo the\n\u03c0\nhomogeneous ideal (P ) to an isomorphism S/(P ) \u2192 RG /(\u03c0(P )) = (R/(\u03c0(P )))G . So X =\n \u0303\nProj(S/(P )) = X /G.\nSince G acts trivially on T , it acts on U with (i, j, k) \u00d7 g(x, y, z) 7\u2192 g(\u03b6ai x, \u03b6bj y, \u03b6ck z), for\ng \u2208 W [x, y, z] = W [X/T a, Y /T b , Z/T c]. The proof that U \u223c\n= \u0168/G is similar to that in the\npreceding paragraph. The group G acts on D\u0303 since it fixes the homogeneous ideal (T ), and one\nsees as before that D \u223c\n= D\u0303/G.\nLet X, D, U, X\u0303, D\u0303, \u0168 denote the special fibres. Assume that U is smooth.\ni\nLemma 4.5. For each i \u2265 0, the group G acts on the rigid cohomology space Hrig\n(\u0168 ) and\ni\ni\nG\n\u223c\nHrig (U ) = Hrig (\u0168 ) .\n\n\u223c B G . Taking\nProof. Let A and B denote the coordinate rings of U and \u0168, respectively; so A =\n\u2020 G\nG \u2020 \u223c\n\u2020 \u223c\nweak completions we have A = (B ) = (B ) , the latter isomorphism follows since the action\nof G commutes with taking weak completions. Let d : B \u2020 \u2192 \u03a9B \u2020 be the universal derivation\nwhich is continuous w.r.t the p-adic metric on B \u2020 . One checks that (\u03a9\u2022B \u2020 )G is the direct factor in\n\u03a9\u2022B \u2020 corresponding to the trivial character in a character-based decomposition, that (\u03a9\u2022B \u2020 )G \u223c\n=\n\u03a9\u2022(B \u2020 )G as complexes of (B \u2020 )G -modules, and since (B \u2020 )G \u223c\n= A\u2020 we have \u03a9\u2022(B \u2020 )G \u223c\n= \u03a9\u2022A\u2020 . The rigid\ncohomology of \u0168 is by definition the homology H(\u03a9\u2022B \u2020 ). Since (\u03a9\u2022B \u2020 )G is the trivial-character\ndirect factor in \u03a9\u2022B \u2020 one has H(\u03a9\u2022B \u2020 )G \u223c\n= H((\u03a9\u2022B \u2020 )G ), and we know H((\u03a9\u2022B \u2020 )G ) \u223c\n= H(\u03a9\u2022A\u2020 ). But\nthe latter is by definition the rigid cohomology of U .\ni\nAssume that D\u0303 is a smooth divisor. Then the crystalline cohomology groups Hcris\n((X\u0303, D\u0303))\nare defined, and there is a natural map\ni\ni\nHcris\n((X\u0303, D\u0303)) \u2192 Hrig\n(\u0168 )\n\nwhich is an injection modulo torsion with image a full-rank W -lattice. These morphisms commute with the action of G, so we may take G-invariants to get natural maps\ni\ni\nHcris\n((X\u0303, D\u0303))G \u2192 Hrig\n(\u0168 )G\ni\nand by Lemma 4.5 the image is isomorphic to Hrig\n(U ).\n\n13\n\n\fi\nDefinition 4.6. For each i \u2265 0, define the W -module Hcris\n((X, D)) to be the G-invariant part\ni\nG\nHcris ((X\u0303, D\u0303)) . We shall call these groups the log-crystalline cohomology of the pair (X, D).\ni\nProposition 4.7. There is a natural map which is an injection modulo torsion Hcris\n((X, D)) \u2192\ni\nHrig (U ), with image a full-rank F -invariant W -lattice. Let us denote this lattice H(X, log D).\n\nProof. We constructed the natural map immediately before Definition 4.6, and it is an injection\nmodulo torsion. It is F -invariant since the action of G commutes with the pth power map on\nthe homogeneous coordinate ring R/(\u03c0(P ), p) of X\u0303. Since the order of G is coprime to p, there\nis a G-invariant decomposition\ni\ni\ni\ni\nHcris\n((X\u0303, D\u0303)) = Hcris\n((X\u0303, D\u0303))G \u2295 Ccris \u2192 Hrig\n(\u0168 )G \u2295 Crig = Hrig\n(\u0168 )\n\nand a natural map which is an injection modulo torsion Ccris \u2192 Crig . If the map in the\nproposition did not have a full-rank image, then the rank of the image of Ccris in Crig would\nhave to exceed the dimension of Crig ; an impossibility.\nNote 4.8 The W -scheme X in general will only be quasi-smooth, that is have quotient singularities, which in our case lie along the divisor D [8, Appendix B]. So the log-crystalline\ni\ncohomology Hcris\n((X, D)) is not a priori defined. The divisor D itself is a quasi-smooth curve\nin weighted projective space P(a, b, c)W . Quasi-smooth varieties are normal, and hence the\n2\ncurve D itself is smooth. The author believes that Hcris\n((X, D)) defined above is isomorphic to\n2\nHcris\n((X1 , D1 )) where X1 is some smooth compactification of U with D1 := X1 \\U1 a smooth\nnormal crossing divisor; however, he offers no proof of this.\n2\nUsing Theorem 3.10, the group Hcris\n((X\u0303, D\u0303)) can be explicitly described as the cohomology\n2\nclasses in Hrig (\u0168 ) of a set of elements in \u0393(\u0168, \u03a92\u0168 ). The G-invariants of this set are easily\ncalculated. Explicitly, for k + 1 > max{2d \u2212 4, 0} we see that the map\n\n2\n2\n((X\u0303, D\u0303))G \u2192\nHcris\n((X, D)) := Hcris\n\n\u0393(X\u0303 , \u03a92X\u0303 ((k + 2)D\u0303))G\n\u0393(X , \u03a92X ((k + 2)D))\n=\n(12)\n1\nd(\u0393(X , \u03a91X ((k + 1)D)))\nd(\u0393(X \u0303 , \u03a9 ((k + 1)D\u0303)))G\nX\u0303\n\nhas kernel and cokernel killed by multiplication by p\u230alogp (k+1)\u230b . The last equality of W -modules\nin (12) follows from the isomorphism \u0393(U, \u03a9iU ) \u223c\n= \u0393(U, (\u03c1\u2217 \u03a9i\u0168 )G ) where \u03c1 : \u0168 \u2192 U is the quotient\nmap, c.f. [22, Page 215, Lines 8-12], and the fact that pole orders are just calculated by taking\nsuitable weighted degrees.\nDefinition 4.9. For each k + 1 \u2265 max{2d \u2212 4, 0}, the lattice H(X, kD) is defined to be the\n2\nimage of the righthand side of (12) in Hrig\n(U ).\nProposition 4.10. There is a natural embedding H(X, log D) \u2192 H(X, kD) with cokernel killed\nby multiplication by p\u230alogp (k+1)\u230b .\nProof. Elements in the kernel of the natural map (12) must be torsion (take G-invariants in\n2\nCorollary 3.5 applied to the pair (X\u0303, D\u0303)) and so vanish in H(X, log D) = Im(Hcris\n((X, D)) \u2192\n2\nHrig (U )). The map in proposition is thus the embedding defined by pulling back elements\n2\nin H(X, log D) to the free part of Hcris\n((X, D)), mapping via (12), and then embedding in\n2\nHrig (U ).\nThe K-vector space H(X, kD) \u2297W K is F -invariant and so has the structure of an F isocrystal; however, H(X, kD) itself is not in general F -invariant.\nNote 4.11 Only the construction of the lattice H(X, log D) relies upon the existence of appropriate primitive roots \u03b6a , \u03b6b , \u03b6c \u2208 W \u2217 . The definition of H(X, kD) does not, and indeed\nthis lattice is independent of the choice of base field - see Section 4.3 for an example of how\nto construct this lattice. In the general case, one constructs a basis for the lattice H(X, kD).\nThe theory guarantees that if one extends the base field Fq to contain appropriate primitive\nroots, then this lattice is close to H(X, log D), and so is acted upon in a particular way by the\n14\n\n\fpth power Frobenius map F , see Section 5. But the action of the pth power Frobenius map is\nindependent of the field over which the basis is defined, so it acts in that manner on the original\n2\nlattice H(X, kD) \u2282 Hrig\n(U ).\nNote 4.12 A direct application of Poonen's method to surfaces in weighted projective space\nand experiments suggest that in fact k + 1 > max{2d \u2212 (1 + a + b + c), 0} is sufficient for the\nmap in (12) to have kernel and cokernel killed as claimed.\n\n4.2\n\nFrobenius-Hodge structures for weight projective surfaces\n\nWe continue with the notation and assumptions in Section 4.1. We shall also use the notation\nin the final paragraph of Section 3.6, only we now denote our smooth projective surface and\ncurve as X\u0303 and D\u0303, respectively. Taking G-invariants in the exact sequence (11) for the pair\n0\n(X\u0303, D\u0303) and noting the first non-zero term is Hcris\n(D\u0303) we get the sequence\n2\n2\n1\n((X, D)) \u2192 Hcris\n(D\u0303)(\u22121)G \u2192 0.\n0 \u2192 W (\u22121) \u2192 Hcris\n(X\u0303)G \u2192 Hcris\n\nSince Frobenius F commutes with the action of G, the above exact sequence defines a mixed\n2\nFrobenius-Hodge structure (Definition 3.12) on Hcris\n((X, D)). We examine this in more detail\nnext.\nLet us first recall how one defines Hodge numbers of quasi-smooth varieties, c.f. [4, Appendix\nA.3].\ns\nDefinition 4.13. Let j : XK\n\u2192 XK be the embedding of the smooth locus and i \u2265 0, and define\ni\ni\nthe sheaf \u03a9\u0302XK := j\u2217 \u03a9X s on XK . The Hodge numbers hi,j are the dimensions of the K-vector\nK\n\nspaces H j (XK , \u03a9\u0302iXK ).\nNote that DK is smooth so its Hodge numbers are defined in the usual manner, as the\ndimensions of the spaces H j (DK , \u03a9iDK ). By the result on [22, Page 215, Lines 8-12], for each\ni \u2265 0 we have an isomorphism of sheaves (\u03c1\u2217 \u03a9iD\u0303 )G \u223c\n= \u03a9iDK and (\u03c1\u2217 \u03a9iX\u0303 )G \u223c\n= \u03a9\u0302iXK where\nK\n\nK\n\n\u03c1 : X\u0303K \u2192 XK is the quotient map and also its restriction \u03c1 : D\u0303K \u2192 DK . It follows by\ndecomposing sheaves via characters of G and using the finiteness of \u03c1 that H j (X \u0303K , \u03a9iX\u0303 )G \u223c\n=\nK\nj\ni\nj\ni\nG \u223c\nj\ni\nH (XK , \u03a9\u0302 ) and H (D\u0303K , \u03a9 ) = H (DK , \u03a9 ). Thus the dimensions of the graded pieces\nXK\n\nD\u0303K\n\nDK\n\n2\n1\nin the filtrations on Hcris\n(X\u0303)G and Hcris\n(D\u0303)G are just the Hodge numbers of the quasi-smooth\nsurface XK and smooth curve DK .\n2\n2\nSince Hcris\n((X, D)) is a submodule of Hcris\n((X\u0303, D\u0303)) and the latter is torsion free, so is\n2\n2\nthe former. Thus the lattice H(X, log D) := Im(Hcris\n((X, D)) \u2192 Hrig\n(U )) is isomorphic to\n2\n2\nG\nHcris ((X, D)). Defining H(X)prim := Hcris (X) /W (\u22121) we see that there is a filtration 0 \u2286\nH2 \u2286 H1 \u2286 H0 = H(X)prim with F (Hi ) \u2286 pi H(X)prim . Recall hi,j := dim(H j (XK , \u03a9\u0302iXK )) are\nthe Hodge numbers of the quasi-smooth variety XK . We have h2,0 = rank H2 and h1,1 \u2212 1 =\nrank (H1 /H2 ) (we have removed the hyperplane class), and h0,2 = rank (H0 /H1 ). Defining\nh2 := h2,0 + h1,1 + h0,2 , the middle Betti number of XK , we see that H(X)prim has rank h2 \u2212 1.\nLikewise, the lattice\n1\n1\nH(D) := Im(Hcris\n(D\u0303)G \u2192 Hrig\n(D\u0303)G )\n1\nis isomorphic to Hcris\n(D\u0303)G and has a filtration 0 \u2286 H1\u2032 \u2286 H0\u2032 = H(D) with F (Hi\u2032 ) \u2286 pi (H(D))\n\u2032\nand rank H1 = g = rank (H0\u2032 /H1\u2032 ) where g := dim(H 0 (DK , \u03a91DK )). So the mixed Frobenius2\nHodge structure on H(X, log D) \u223c\n((X, D)) comes from the exact sequence\n= Hcris\n\n0 \u2192 H(X)prim \u2192 H(X, log D) \u2192 H(D)(\u22121) \u2192 0\nand the dimensions of the various graded pieces can be calculated from the Hodge numbers of\nthe quasi-smooth surface XK and smooth curve DK .\n\n15\n\n\f4.3\n\nSurfaces of the form z 2 = Q(x, y)\n\nWe now describe an explicit method for constructing the lattice H(X, kD) in the case in which\nU is a surface defined by a polynomial z 2 = Q(x, y).\n4.3.1\n\nDifferential forms on the surface\n\nAssume that the characteristic p of the residue field of W is odd. P\nLet a, b, c be positive integers\ni j\nwith gcd(a, b) = 1 and abc not divisible by p. Let Q(x, y) =\ni,j qi,j x y be a polynomial\nin W [x, y] such that ai + bj \u2264 2c for all pairs (i, j), with this bound met for some choice of\npair (i, j); that is, Q(x, y) has weighted degree 2c when one assigns weights wt(x) := a and\nwt(y) := b in the polynomial ring W [x, y]. Let X be the hypersurface of degree d := 2c in\nP(1, a, b, c)W defined by the polynomial\n\u0001\nP := T d (Z/T c )2 \u2212 Q(X/T a, Y /T b ) .\n\nLet D denote the scheme defined by the ideal (P, X0 ) and U := X \\D. The affine W -scheme\nU is defined by the polynomial z 2 = Q(x, y), where x = X/T a, y = Y /T b and z := Z/T c. We\nassume that U is smooth. We further assume that the schemes X\u0303 and D\u0303, respectively, in P3W\ndefined by the polynomial \u03c0(P ) := P (X0 , X1a , X2b , X3c ) and ideal (\u03c0(P ), X0 ), respectively, are\nsmooth W -schemes, although this will play no role in the construction of the lattice H(X, kD).\nLemma 4.14. The functions x, y, and z have poles of orders a, b and c, respectively, along the\ndivisor D. The 1-forms dx, dy and dz have poles of orders a + 1, b + 1 and c + 1 along D, and\nthe 2-form dx \u2227 dy a pole of order a + b + 2 along D.\nProof. Follows since the divisor D is defined by the homogeneous ideal (T ), differentiation\nincreases pole orders by one, and dx \u2227 dy = d(ydx).\nBy definition, the module \u0393(U, \u03a91U ) is generated over W [x, y, z]/(z 2 \u2212Q(x, y)) by the 1-forms\ndx, dy and dz subject to the one relation\n2zdz = Qx dx + Qy dy.\nIt follows immediately that the module \u0393(U, \u03a92U ) is generated over W [x, y, z]/(z 2 \u2212 Q(x, y)) by\nthe 2-forms dx \u2227 dy, dy \u2227 dz and dz \u2227 dx subject to the relations\ndy \u2227 dz = \u2212\n\nQx\nQy\ndx \u2227 dy, dz \u2227 dx = \u2212\ndx \u2227 dy.\n2z\n2z\n\nSince U is smooth we have (Q, Qx , Qy ) = (1). A simple computation now reveals that\n\u001a\n\u001b\nA + Bz\n2\n\u0393(U, \u03a9U ) =\ndx \u2227 dy | A, B \u2208 W [x, y] .\nz\nBy Lemma 4.14, the pole order of such a 2-form along D is bounded above by\nmax{wt(A) \u2212 c, wt(B)} + a + b + 2\nwhere wt here means weighted degree.\nLemma 4.15. Let B \u2208 W [x, y] have ordinary degree deg(B). Then for any k + 2 \u2265 wt(B) +\na + b + 2, the class of the 2-form Bdx \u2227 dy in the quotient on the righthand side of (12) is killed\n2\nby multiplication by p\u230alogp (deg(B)\u230b ; thus it is the zero class in Hrig\n(U ).\nProof. Integrating w.r.t. x, say, one constructs a polynomial C \u2208 W [x, y] with dC/dx =\np\u230alogp (deg(B)\u230b B. Then d(C \u2227 dy) = p\u230alogp (deg(B)\u230b Bdx \u2227 dy, as required.\n2\nSince we wish to construct the image in Hrig\n(U ) of the righthand side of (12), by Lemma\n4.15 we can restrict attention to 2-forms (A/z)dx \u2227 dy.\n\n16\n\n\fBy an explicit computation one finds that the exact forms (A/z)dx \u2227 dy are precisely those\nfor which\n2A = \u03b1Qx + \u03b2Qy + 2(\u03b1x + \u03b2y )Q, \u03b1, \u03b2 \u2208 W [x, y].\nPrecisely, such a form is d of\nCzdx + Dzdy + Edz, \u03b1 := D \u2212 Ey , \u03b2 := \u2212C + Ex , C, D, E \u2208 W [x, y].\nNote that the pole order of such a 1-form is bounded by max{wt(\u03b1)+c+b+1, wt(\u03b2)+c+a+1}. So\nto ensure this has pole order at most k+1 we need to have wt(\u03b1) \u2264 (k+1)\u2212(c+b+1) = k\u2212(b+c)\nand wt(\u03b2) \u2264 k \u2212 (a + c). Moreover, the 2-forms (A/z)dx \u2227 dy have pole order bounded by\nwt(A) \u2212 c + a + b + 2, so to ensure the pole order is at most k + 2 it is enough to have\nwt(A) \u2264 (k + 2) + c \u2212 (a + b + 2) = k + c \u2212 (a + b).\n4.3.2\n\nAn algorithm for constructing the lattice H(X, kD)\n\nFor any k \u2265 0, one constructs a set which generates the quotient in (12) as follows. For any\ninteger m \u2265 0, let Mon\u2264m denote the union of the set of monomials xi y j of weighted degree at\nmost m with {0}. Let Zm denote the free W -submodule of W [x, y] spanned by the monomials\nin Mon\u2264m+c\u2212(a+b+2) . Let Bm \u2286 Zm be the W -module generated by polynomials of the form\n\u03b1Qx + \u03b2Qy + 2(\u03b1x + \u03b2y ) where \u03b1 \u2208 Mon\u2264(m\u22121)\u2212(b+c+1) and \u03b2 \u2208 Mon\u2264(m\u22121)\u2212(a+c+1) . Define\nHm := Zm /Bm . Then Hk+2 is isomorphic to the quotient in (12) via the map\n\u03b8 : Zk+2 \u2192 \u0393(X , \u03a92X ((k + 2)D)), xi y j 7\u2192 xi y j dx \u2227 dy/2z.\nOne can find a set S(k) \u2286 Mon\u2264k+c\u2212(a+b) of monomials whose classes in Hk+2 are a W generating set for this quotient using the following method.\nLet Zm,p := Zm \u2297W Fq and Bm,p := Bm \u2297W Fq be Fq -vector spaces. Using linear algebra over\nFq , compute a generating set S(k) of monomials for the quotient Zk+2,p /Bk+2,p . Let hS(k)iW\ndenote the W -span of this generating set. Let w \u2208 Zk+2 . Then w = u1 + v1 mod p for some\nu1 \u2208 hS(k)iW and v1 \u2208 Bk+2 . Write w = u1 + v1 + pw2 where w2 \u2208 Zk+2 . Repeating the\nprocess we find u2 \u2208 hS(k)iW and v2 \u2208 Bk+2 such that w = (u1 + pu2 ) + (v1 + pv2 ) + p2 w2 for\nsome w2 \u2208 Zk+2 . By induction, and taking a p-adic limit, we find u \u2208 hS(k)iW and v \u2208 Bk+2\nsuch that w = u + v, as required.\nIf p > k + 1 and k \u2265 max{2d \u2212 4, 0}, and the classes of the forms\n\u03b8(s) = (s/2z)dx \u2227 dy for s \u2208 S(k)\n\n(13)\n\n2\nare independent in Hrig\n(U ), then the forms (13) are a basis for the lattice\n2\n2\nH(X, log D) = Im(Hcris\n((X, D)) \u2192 Hrig\n(U )).\n2\n2\n(U ); the latter\nNote that they will be independent in Hrig\n(U ) if and only if |S(k)| = dim Hrig\n2\n1\nis just (dim Hrig\n(X) \u2212 1) + dim Hrig\n(D) (c.f. first paragraph of the proof of Proposition 6.1),\nand so is easily calculated.\n2\nIf k \u2265 max{2d \u2212 4, 0} and the classes of (13) are independent in Hrig\n(U ), then the classes of\n2\n(13) span a lattice H(X, kD) \u2282 Hrig (U ) such that there is a natural embedding \u03c1 : H(X, log D) \u2192\n2\nH(X, kD) with cokernel killed by p\u230alogp (k+1)\u230b . If the classes are not independent in Hrig\n(U )\nthen one must do some further work to extract a basis for the free part of hS(k)iW . We have\nnot come across this situation in practice and so do not address it here.\n\n5\n\nFrobenius-Hodge structures and precision estimates\n\n2\nIn this section we explain how the use of a basis for the full-rank W -lattice H(X, kD) in Hrig\n(U )\nwhen calculating the Frobenius action allows one to compute with lower p-adic precisions.\nNotation and assumptions are as in Section 4. In particular, X := X \u0303 /G where G is a finite\ngroup of order prime to p and X\u0303 a smooth surface in P3W , D\u0303 is the divisor at infinity of X \u0303 ,\n\n17\n\n\fassumed smooth and fixed by G, and U := \u0168/G (where \u0168 := X \u0303 \\D\u0303) is smooth. We denote by\nX, D and U the special fibres of X , D and U, respectively. For k \u2265 max{2d\u2212 4, 0} the W -lattice\n2\nH(X, kD) \u2282 Hrig\n(U ) is described in Definition 4.9.\nTo state the next theorem in a simple manner, we shall say informally that a rational\napproximation \u00e3 \u2208 Q to a p-adic number a \u2208 Qp is correct modulo pN if ordp (\u00e3 \u2212 a) \u2265 N , with\nthis notion extended in the obvious way to matrices and polynomials.\nTheorem 5.1. Assume that the residue field of W is the prime field Fp where p > 2, and\ndenote by h2,0 := dim H 0 (XK , \u03a9\u03022XK ) the geometric genus of XK (Definition 4.13). Let \u00c3 be\nan approximation to the matrix for the Frobenius map F on H(X, kD) \u2297W K w.r.t. a basis of\nH(X, kD) which is correct modulo pN +1 , where N \u2265 2. Then the polynomial det(1 \u2212 p\u22121 \u00c3T )\n2,0\nis correct modulo pN +1\u2212h \u2212\u230alogp (k+1)\u230b .\nThis theorem is surprising since the matrix p\u22121 \u00c3 will not in general have entries in W , and\nso one naively expects a much greater loss of precision when the characteristic polynomial is\ncomputed. For example, when p > k + 1 one expects naively that the characteristic polynomial\n2\nof p\u22121 \u00c3 is only correct modulo pN +1\u2212(m\u22121) where m is the dimension of Hrig\n(U ). In our\n2,0\napplication to L-functions of elliptic curves, m is much larger than h , and so Theorem 5.1 is\nof great practical use.\nTheorem 5.1 is an immediate corollary of the next proposition.\nProposition 5.2. Let B be a basis for the W -lattice H(X, kD), and hence also the K-vector\nspace H(X, kD) \u2297W K. Let A \u2208 GL(m, K) be the matrix for the Frobenius map F acting on\nH(X, kD)\u2297W K w.r.t. this basis. Let N \u2265 2 be a positive\nbe a matrix\nPm integer and \u00c3 \u2208 GL(m, Q) P\nm\nsuch that ordp (\u00c3 \u2212 A) \u2265 N + 1. Write det(1 \u2212 AT ) = l=0 al T l and det(1 \u2212 \u00c3T ) = l=0 \u00e3l T l .\nThen\nordp (al \u2212 \u00e3l ) \u2265 N + i + m(l) \u2212 \u230alogp (k + 1)\u230b\nwhere m(l) is defined in the proof of Lemma 5.3.\nWe shall prove this proposition in several simple steps. Using the notation and results in\nSection 4.2, we have an exact sequence\n\u03c6\n\n\u03b8\n\n0 \u2192 H(X)prim \u2192 H(X, log D) \u2192 H(D)(\u22121) \u2192 0\nwhich defines a mixed Frobenius-Hodge structure (Definition 3.12) on H(X, log D) from the\npure Frobenius-Hodge structures on the outer terms. Say that a basis for H(X)prim is adapted\nto the Hodge filtration if the first h2,0 elements form a basis for H2 , and the first h2,0 + h1,1 \u2212 1\nform a basis for H1 . Likewise, say that a basis for H(D) is adapted to the Hodge filtration if the\nfirst g elements form a basis for H1\u2032 . Say that a basis for H(X, log D) is adapted to the Hodge\nfiltration if the first h2 \u2212 1 elements are \u03b8 applied to a basis of H(X)prim which is adapted to\nthe Hodge filtration, and p\u22121 \u03c6 applied to the last 2g elements gives a basis of H(D) which is\nadapted to the Hodge filtration. Note that m = (h2 \u2212 1) + 2g is the rank of H(X, log D).\nThe matrix A for Frobenius F on a basis of H(X, log D) which is adapted to the Hodge\nfiltration has the shape\n\u0012 2\n\u0013\np A2 pA1 A0\nB1\nB2\n0\n0\n0 p2 C1 pC2\n\nwhere A0 , A2 \u2208 M(h2 \u2212 1, h2,0 , W ), A1 \u2208 M(h2 \u2212 1, h1,1 \u2212 1, W ), Ci \u2208 M(2g, g, W ), Bi \u2208\nM(h2 \u2212 1, g, W ) and the 0s are zero matrices of the appropriate size.\n\nLemma 5.3. Let B be a basis for H(X, log D) which is adapted to the Hodge filtration and A\nthe matrix for Frobenius F on H(X, log D) w.r.t. the basis B. Let N \u2265 2 be a positive\nPminteger\nand \u00c3 \u2208 GL(m, Q) be a matrix such that ordp (\u00c3\u2212 A) \u2265 N + 1. Write det(1 \u2212 AT ) = l=0 al T l\nPm\nand det(1 \u2212 \u00c3T ) = l=0 \u00e3l T l . Then\nordp (al \u2212 \u00e3l ) \u2265 N + i + m(l)\n\nwhere m(l) is defined in the proof.\n18\n\n\fProof. Write p\u22121 A = (p\u22121 ai,j ) and p\u22121 \u00c3 = (p\u22121 \u00e3i,j ), so ordp (p\u22121 \u00e3i,j \u2212p\u22121 ai,j ) \u2265 N \u2265 2. From\nthe explicit block-form of the matrix A immediately above, one sees that the matrix V = (vi,j )\nbelow is such that ordp (p\u22121 ai,j ), ordp (p\u22121 \u00e3i,j ) \u2265 vi,j .\n\uf8eb\n\uf8f6\n1 * * * 1 0 * * * 0 \u22121 * * * \u22121 \u22121 * * * \u22121 \u22121 * * * \u22121\n\uf8ec ..\n..\n..\n..\n..\n..\n..\n..\n..\n.. \uf8f7\n\uf8ec .\n.\n.\n.\n.\n.\n.\n.\n.\n. \uf8f7\n\uf8ec\n\uf8f7\n\uf8ec 1 * * * 1 0 * * * 0 \u22121 * * * \u22121 \u22121 * * * \u22121 \u22121 * * * \u22121 \uf8f7\n\uf8f7\nV := \uf8ec\n\uf8ec N *** N N *** N N *** N\n1 ***\n1\n0 ***\n0 \uf8f7\n\uf8ec\n\uf8f7\n\uf8ec .\n..\n..\n..\n..\n..\n..\n..\n..\n.. \uf8f7\n\uf8ed ..\n.\n.\n.\n.\n.\n.\n.\n.\n. \uf8f8\nN\n\n***\n\nN\n\nN\n\n***\n\nN\n\nN\n\n***\n\nN\n\n1\n\n***\n\n1\n\n0\n\n***\n\n0\n\nExplicitly, the top left-hand (h2 \u2212 1) \u00d7 h2,0 sub-matrix of 1s in V corresponds to lower bounds\non the valuation of entries in the matrix pA2 , and so on. Let 1 \u2264 l \u2264 m. The lth coefficient\nof det(1 \u2212 T p\u22121 \u00c3) can be written explicitly as a signed sum of transversal products of the\nelements p\u22121 \u00e3i,j in p\u22121 \u00c3, c.f. [18, Equation (36)]. Each transversal product is determined by a\nchoice of indices 1 \u2264 u1 < * * * < ul \u2264 m and permutation \u03c4 \u2208 Sl ; namely, this defines the term\nsign(\u03c4 )(p\u22121 \u00e3u1 ,u\u03c4 (1) ) * * * (p\u22121 \u00e3ul ,u\u03c4 (l) ). According to [18, Lemma 9.5], the loss of precision\nordp ((p\u22121 au1 ,u\u03c4 (1) ) * * * (p\u22121 aul ,u\u03c4 (l) ) \u2212 (p\u22121 \u00e3u1 ,u\u03c4 (1) ) * * * (p\u22121 \u00e3ul ,u\u03c4 (l) ))\nwhen computing such a product is bounded below by N + v(u1 , . . . , ul ; \u03c4 ) where\nv(u1 , . . . , ul ; \u03c4 ) :=\n\nl\nX\n\nvui ,u\u03c4 (i) \u2212 min {vui ,u\u03c4 (i) }.\n1\u2264i\u2264l\n\ni=1\n\nSo for each l, we must find the minimum value m(l) taken by the function v(u1 , . . . , ul ; \u03c4 ) over\ndifferent choices of indices and permutation. By inspection of the matrix V , one sees that\n\uf8f1\n1 \u2264 l \u2264 h2,0\n\uf8f2 \u2212l + 1\n\u2212h2,0 + 1\nh2,0 < l \u2264 h2,0 + h1,1 \u2212 1 + g\nm(l) =\n\uf8f3\n\u2212h2,0 + 1 + (l \u2212 (h2,0 + h1,1 \u2212 1 + g)) h2,0 + h1,1 \u2212 1 + g < l \u2264 m.\n\nThe key point is that since N \u2265 2, one can restrict to transversals of p\u22121 A which factor as a\ntransversal of the (h2 \u2212 1) \u00d7 (h2 \u2212 1) sub-matrix (pA2 , A1 , p\u22121 A0 ) times one of the 2g \u00d7 2g submatrix (pC1 , C2 ), and it is easy to compute the minimum value of v(*) over such transversals.\nTo see why we can restrict in this way, suppose that 1 \u2264 u1 < * * * < ul \u2264 m is a choice of indices\nand \u03c4 \u2208 Sl permutation such that the corresponding transversal of p\u22121 A contains exactly s \u2265 1\nelements from the top-right h2 \u22121\u00d72g sub-matrix of p\u22121 A. Then by Lemma 5.4, the transversal\nmust also contain exactly s elements from the bottom-left 2g \u00d7h2 \u22121 sub-matrix of p\u22121 A. Hence\nv(u1 , . . . , ul ; \u03c4 ) equals (N \u2212 1)s \u2265 s plus a choice of l \u2212 s elements lying in distinct columns (and\nrows) of the top-left h2 \u2212 1 \u00d7 h2 \u2212 1 sub-matrix of V and the bottom-right 2g \u00d7 2g submatrix\nof V , plus one. Such a sum cannot be less than the value m(l) given above.\nLemma 5.4. Let M be an m \u00d7 m matrix over a commutative ring and M = (Mij )1\u2264i,j\u22642\na block decomposition where the block M1,1 is square of size m\u2032 , and the block M2,2 is square\nof size m\u2032\u2032 := m \u2212 m\u2032 . Then any transversal product of M must contain an equal number\nof elements from M1,2 and M2,1 . (See the proof of Lemma 5.3 for a definition of the term\ntransversal product.)\nProof. We may restrict immediately to the case in which the transversal product is determined\nby choosing an element from every row and column of M , by extracting a suitable submatrix.\nFor such a transversal product, if s elements are chosen from M1,2 then by considering columns\none sees m\u2032\u2032 \u2212 s are chosen from M2,2 , and by considering rows that m\u2032 \u2212 s are chosen from\nM1,1 . Hence m \u2212 (s + (m\u2032 \u2212 s) + (m\u2032\u2032 \u2212 s)) = s are chosen from M2,1 .\nLemma 5.5. Lemma 5.3 is true for B any basis of H(X, log D).\n19\n\n\fProof. Let B be any basis for H(X, log D) and A the matrix for Frobenius F w.r.t. B. Let B \u2032\nbe a basis adapted to the Hodge filtration and A\u2032 the matrix for Frobenius F w.r.t. B \u2032 . Of\ncourse, the characteristic polynomials of A and A\u2032 are the same. Let \u00c3 \u2208 GL(Q, m) be such\nthat ordp (\u00c3 \u2212 A) \u2265 N + 1. Let C \u2208 GL(m, W ) be the change of basis matrix from B to B \u2032 , so\nA\u2032 = C \u22121 AC. Define D := C \u22121 \u00c3C, so the characteristic polynomials of D and \u00c3 are identical.\nWe have D \u2212 A\u2032 = C \u22121 (\u00c3 \u2212 A)C so ordp (D \u2212 A\u2032 ) \u2265 N + 1. Hence the characteristic polynomials\nof D and A\u2032 agree as claimed in Lemma 5.3. Thus so do those of \u00c3 and A.\nLemma 5.6. Proposition 5.2 is true for bases B of H(X, kD) which satisfy the following property: There exists a basis B \u2032 of H(X, log D) with the change of basis matrix from B to B \u2032 a\ndiagonal matrix E = diag(pn1 , . . . , pnm ) with ni \u2264 \u230alogp (k + 1)\u230b.\nNote that such bases exist since we know that H(X, kD)/H(X, log D) is a finite abelian\np-group killed by multiplication by p\u230alogp (k+1)\u230b .\nProof. Define G := E \u22121 \u00c3E and H := E \u22121 AE. Then H is the matrix for Frobenius F w.r.t.\na basis of the lattice H(X, log D). Moreover, G \u2212 H = E \u22121 (\u00c3 \u2212 A)E and so ordp (G \u2212 H) \u2265\n(N + 1) \u2212 \u230alogp (k + 1)\u230b. The characteristic polynomials of G and H are the same as those of \u00c3\nPm\nPm\nand A, respectively, that is i=0 \u00e3i T i and i=0 ai T i . By Lemma 5.5 (with notation \"A and\n\u00c3\" replaced by \"H and G\", and N replaced by N \u2212 \u230alogp (k + 1)\u230b) they agree as claimed.\nOne now deduces Proposition 5.2 from Lemma 5.6 using a similar argument as that in the\nproof of Lemma 5.5.\n\n6\n\nThe inclusions U \u2282 X and V \u2282 U\n\nn\nn\nIn this section we analyse the kernel and cokernel of the map Hrig\n(U ) \u2192 Hrig\n(V ) which arises\n1\nin the fibration method. We restrict to the case in which n = 2 and Hrig (X) = 0. The actual\npractical computation of this map does not cause any problems. Since both U and V are\naffine, cohomology classes can be represented by n-forms defined globally, and the map is just\nrestriction.\nWe also briefly consider the problem of computing the residue map Res in the exact sequence\nRes\n\nn\u22121\nn\nn\n* * * \u2192 Hcris\n(X) \u2192 Hcris\n((X, D)) \u2192 Hcris\n(D)(\u22121) \u2192 * * * .\nn\nn\nGiven a basis for the full rank W -lattice H(X, log D) = Im(Hcris\n(X, D) \u2192 Hrig\n(U )), the\nsublattice H(X)prim \u2286 H(X, log D) can in principle be recovered through an understanding of\nthe residue map (Step 2 in Section 2.3.3).\n\n6.1\n\nExcision exact sequences\n\nIn this section we gather some exact sequences which will be used in Section 6.2 and have\nalready been used in some earlier sections. First, for Y a smooth projective variety over Fq and\nZ a smooth normal crossings divisor, we have the \"residue\" sequence\nRes\n\ni\u22121\ni\ni\n* * * \u2192 Hcris\n(Y ) \u2192 Hcris\n((Y, Z)) \u2192 Hcris\n(Z)(\u22121) \u2192 * * * .\n\n(14)\n\n(This follows, in the case in which the pair (Y, Z) lifts to a smooth pair over W at least, from the\nanalogous sequence in algebraic de Rham cohomology [1, Proposition 2.2.8] and the comparision\ntheorems [1, Definition 2.3.3, Proposition 2.4.1].) Second, for Y a smooth variety over Fq of\npure dimension d and Z \u2282 Y a closed subscheme we have the localisation sequence\ni\ni\ni\n* * * \u2192 HZ,rig\n(Y ) \u2192 Hrig\n(Y ) \u2192 Hrig\n(Y \\Z) \u2192 * * * .\n\n20\n\n\fi\nHere HZ,rig\n(Y ) is rigid cohomology of Y with support along Z, which is really just defined to\nmake this sequence exact. When Z is smooth and pure of codimension e, one has the Gysin\nisomorphism [25]\ni\u22122e\ni\nHrig,Z\n(Y ) \u223c\n(Z)(\u2212e)\n= Hrig\n\nwhich leads to the more useful sequence\ni\u22122e\ni\ni\n* * * \u2192 Hrig\n(Z)(\u2212e) \u2192 Hrig\n(Y ) \u2192 Hrig\n(Y \\Z) \u2192 * * * .\n\n(15)\n\nSequences (14) and (15) are related in so much as if one tensors the first by K over W one\nobtains a special case of the second. We only need (15) for our application in the next section.\ni\nFinally, we recall that when Y is affine Hrig\n(Y ) = 0 for i > dim(Y ).\n\n6.2\n\n2\n2\nInjectivity of the map Hrig\n(U) \u2192 Hrig\n(V )\n\nThe propositions in this section makes rigorous the ideas in [18, Section 9.3.1]. First, we consider\nthe case of a smooth surface X.\n1\n3\nProposition 6.1. Let X be a smooth projective surface over Fq , with Hrig\n(X) = Hrig\n(X) = 0,\nU an affine piece of X obtained by removing a smooth divisor D, and V \u2282 U such that Z := U \\V\nis pure of dimension 1 and there is a map V \u2192 S \u2282 A1 with smooth fibres. Then the map\n2\n2\nHrig\n(U ) \u2192 Hrig\n(V ) is an injection.\n\nProof. Writing out the sequence (15) in full for the pair (X, D) one obtains\n0\n(X)\n0 \u2192 Hrig\n\u2192\n0\nc\n2\n(X)\n\u2192 Hrig\n\u2192\n0\n4\n\u2192 Hrig\n(X)\n\n0\n(U )\n\u2192 Hrig\n1\n\u2192 Hrig (U )\n2\n(U )\n\u2192 Hrig\n\u2192\n0\n\u2192\n0\n\n\u2192\n0\n0\n\u2192 Hrig (D)(\u22121)\n1\n(D)(\u22121)\n\u2192 Hrig\n2\n\u2192 Hrig (D)(\u22121)\n\u2192\n0.\n\n0\n0\nNote that Hrig\n(X) = Hrig\n(D) = K. The image of the map c is the class of the divisor D.\nSince the cycle class map is injective in codimension one [23, Page 97], we must have that\n1\nHrig\n(U ) = 0.\nLet V \u2282 U with Z := U \\V pure of codimension 1. We do not assume that Z is smooth, so\ncannot apply the sequence (15) directly to the pair (U, Z). To get around this problem: Let P\ndenote the singular locus on Z, a union of points, and Z\u0303 := Z\\P , \u0168 := U \\P . First, (U, P ) is a\nsmooth pair, with P of codimension 2 in U . So (15) for this pair is\n\n0 \u2192\n0\n\u2192\n0\n\u2192\n0\n\u2192\n0\n0\n\u2192 Hrig\n(P )(\u22122)\n\n0\n\u2192 Hrig\n(U )\n1\n\u2192 Hrig\n(U )\n2\n\u2192 Hrig\n(U )\n\u2192\n0\n\u2192\n0\n\n\u2192\n\u2192\n\u2192\n\u2192\n\u2192\n\n0\nHrig\n(\u0168 )\n1\nHrig\n(\u0168 )\n2\nHrig\n(\u0168 )\n3\nHrig (\u0168 )\n0\n\nNote that \u0168 is not affine when P 6= \u2205. Second, (\u0168 , Z\u0303) is a smooth pair with Z\u0303 of codimension\n1 in \u0168 and V = \u0168 \\Z\u0303. So (15) for this pair is\n0\n\n\u2192\n0\n\u2192\n0\n0\n\u2192 Hrig\n(Z\u0303)(\u22121)\n1\n\u2192 Hrig\n(Z\u0303)(\u22121)\n\n\u2192\n\u2192\n\u2192\n\u2192\n\n0\nHrig\n(\u0168 )\n1\nHrig (\u0168 )\n2\nHrig\n(\u0168 )\n3\nHrig (\u0168 )\n\n0\n\u2192 Hrig\n(V )\n1\n\u2192 Hrig (V )\n2\n\u2192 Hrig\n(V )\n\u2192\n0\n\nThus the following sequence is exact\n1\n0\n2\n2\n0 \u2192 Hrig\n(V ) \u2192 Hrig\n(Z\u0303)(\u22121) \u2192 Hrig\n(U ) \u2192 Hrig\n(V )\n1\n0\n\u2192 Hrig\n(Z\u0303)(\u22121) \u2192 Hrig\n(P )(\u22122) \u2192 0.\n\n21\n\n(16)\n\n\fi\nTo calculate Hrig\n(V ) for i = 1, 2, we use the assumption that there is a surjective map\n1\ni\nV \u2192 S \u2282 A with smooth fibres. Let Hrig\n(V /S) denote relative rigid cohomology for this map,\nwhere i = 0, 1, 2. Then\n0,1\n1,0\n1,1\n1\n2\nHrig\n(V ) \u223c\n(V ) \u223c\n= E2,rig \u2295 E2,rig , Hrig\n= E2,rig\n\nwhere\n\n1,i\nE2,rig\n0,1\nE2,rig\n\n:=\n:=\n\n\u0001\ni\ni\nCoker \u2207 : Hrig\n(V /S) \u2192 Hrig\n(V /S) \u2297 \u03a91S .\n\u0001\n1\n1\nKer \u2207 : Hrig\n(V /S) \u2192 Hrig\n(V /S) \u2297 \u03a91S .\n\n1,0 \u223c\n1\n1\nAs in the proof of [18, Proposition 8.1] we have E2,rig\n(S)(\u22121) and one sees Hrig\n(S) \u223c\n= Hrig\n=\n0\nHrig (Z\u0303). Thus (16) begins\n0,1\n1\n1\n2\n0 \u2192 E2,rig\n\u2295 Hrig\n(S)(\u22121) \u2192 Hrig\n(S)(\u22121) \u2192 Hrig\n(U ) \u2192 * * *\n0,1\n2\n2\nand we deduce that E2,rig\n= 0 and Hrig\n(U ) \u0592\u2192 Hrig\n(V ).\nOur conclusion is that the following sequence is exact\n2\n2\n1\n0\n0 \u2192 Hrig\n(U ) \u2192 Hrig\n(V ) \u2192 Hrig\n(Z\u0303)(\u22121) \u2192 Hrig\n(P )(\u22122) \u2192 0\n2\n2\nand in particular the map Hrig\n(U ) \u0592\u2192 Hrig\n(V ) is an injection.\n\nNext, we consider the case which arises in our application; that of a quasi-smooth hypersurface in a weighted projective space.\nProposition 6.2. As in Section 4, let X := X\u0303/G where G is a finite group of order prime to\np and X\u0303 a smooth surface in P3Fq . Let D\u0303 be the divisor at infinity of X\u0303, assumed smooth and\nfixed by G, and U := \u0168 /G where \u0168 := X\u0303\\D\u0303. Furthermore, let V \u2282 U be such that Z := U \\V\nis pure of dimension 1, and there is a map V \u2192 S \u2282 A1 with smooth fibres. Then the map\n2\n2\nHrig\n(U ) \u2192 Hrig\n(V ) is an injection.\n1\n1\nProof. The proof is as before, once one has established that Hrig\n(U ) = 0. Now Hrig\n(X\u0303) = 0\n3\nsince X\u0303 is a smooth hypersurface in PFq . The sequence (15) for the pair (X\u0303, D\u0303) reveals that\n1\n1\n1\nHrig\n(\u0168 ) = 0. Hence Hrig\n(U ) = Hrig\n(\u0168 )G = 0, as required.\n\n6.3\n\nComputing the residue map\n\nIn principle the residue map can be computed by using explicit \u010cech-de Rham complexes,\nfollowing the approach of Gerkmann [10]. In unpublished notes, the author refined Gerkmann's work to obtain an explicit formula for the residue map in the case in which X := P2W\nand D is a curve. Extending this to the case X := P3W and D is a surface proved too\nchallenging for the present author, although plausible explicit expressions were obtained after much work. Note that the author carried out these latter calculations in an attempt\n2\n2\nto recover the lattice Im(Hcris\n(D) \u2192 Hrig\n(D)) from the construction in [1] of the lattice\n3\n3\nIm(Hcris ((X, D)) \u2192 Hrig (X\\D)) via the residue map.\nThe author's experience with these calculations suggest that the explicit construction of the\nresidue map in the case X is a surface and D is a smooth divisor is in principle possible, but\n2\n2\nperhaps not desirable in practice unless Hrig\n(U ) has much larger dimension than Im(Hrig\n(X) \u2192\n2\nHrig (U )). In our calculations in Section 9 the former had dimension only two greater than the\nlatter.\n\n7\n\nThe Fuchsian basis problem\n\nThis section is entirely expositional. We introduce the Fuchsian basis problem, and explain its\nrelevance to our algorithm.\n\n22\n\n\f7.1\n\nHilbert's 21st problem and Fuchsian bases\n\nLet F be a field of characteristic zero and consider a linear differential system\ndC(y)\n+ B(y)C(y) = 0,\ndy\n\n(17)\n\nwhere B(y) is an m \u00d7 m matrix with entries in the rational function field F (y), and the solution\nmatrix C(y) is an invertible matrix over some differential extension field of F (y). If H(y) is any\ninvertible matrix of rational functions, we may transform (17) into an equivalent differential\nsystem in which B is replaced by\nB[H] := H \u22121 BH + H \u22121\n\ndH\n.\ndy\n\n(18)\n\nFor an irreducible polynomial p(y) \u2208 F [y] let F (y)p := F (y)[1/p] and F (y)(p) denote the\nlocal ring at p, i.e., the extension of F [y] in which all irreducible polynomials excluding p(y)\nhave been inverted. We shall say that (17) is regular at p(y) \u2208 F [y] if there exists a matrix\nH \u2208 GL(m, F (y)p ) such that B[H] has entries in F (y)(p) . We shall say that (17) is regular\nsingular at p(y) \u2208 F [y] if it is not regular at p(y) but there exists a matrix H \u2208 GL(m, F (y)p )\nsuch that p(y)B[H] has entries in F (y)(p) . We say that the system is regular/regular singular at\ninfinity, if is regular/regular singular at y, after replacing the matrix B(y) by \u22121/y 2 B(1/y). We\ncall (17) regular singular if it is either regular or regular singular at all irreducible polynomials\np(y) and infinity.\nFor simplicity of exposition, let us henceforth assume that the system (17) is regular singular\nat infinity, and let P (y) be the product of all irreducible polynomials p(y) at which it is regular\nsingular. Let us say P (y) defines the finite singular locus. We shall say that (17) is Fuchsian if\nthere exists a matrix H \u2208 GL(m, F [y, 1/P (y)]) such that P (y)B[H] has entries in F [y] of degree\nless than deg(P (y)). We call B[H] of this form a Fuchsian matrix for the differential system\n(17). Fuchsian systems are of course regular singular. Establishing whether the converse holds\nwhen F is the field of complex numbers is closely related to Hilbert's 21st problem, though not\nthe statement of it. We require a solution to the problem:\nFuchsian Basis Problem. Give an algorithm which takes as input a regular singular differential system (17) which is regular singular at infinity and has finite singular locus defined by\nthe polynomial P (y), and either\n\u2022 Gives as output a change of basis matrix H(y) \u2208 GL(m, F [y, 1/P (y)]) such that B[H]\ndefined in (18) is a Fuchsian matrix for (17),\n\u2022 Terminates and declares correctly that the system is not Fuchsian.\nHilbert's 21st problem has a chequered but fascinating history. When F is the field of\ncomplex numbers, Fuchsian bases are known to exist for regular singular differential systems\nunder various conditions, such as irreducibility. For m = 3 there are examples of reducible\nsystems which are regular singular but not Fuchsian; Bolibruch has made a very explicit study\nof this case [3]. For m = 2, all regular singular systems over algebraically closed fields are\nFuchsian, and an effective algorithm exists for finding Fuchsian bases (Dekkers's algorithm [5]).\n\n7.2\n\nPicard-Fuchs systems\n\nLet VK \u2192 SK \u2282 P1K be a smooth family of K-varieties of relative dimension n \u2212 1. Associated\nn\u22121\nto this family is a free module HdR\n(VK /SK ) of finite rank m, say, over the coordinate ring\nA := \u0393(SK , OSK ), and an additive and Leibniz linear map (Gauss-Manin connection)\nn\u22121\nn\u22121\n\u2207 : HdR\n(VK /SK ) \u2192 HdR\n(VK /SK ) \u2297A \u03a91A .\nn\u22121\nChoose a coordinate function y on SK , and basis e1 , . . . , em for HdR\n(VK /SK ). Then with\nrespect to the choice of bases {ei } and {ei \u2297 dy} for the domain and codomain of \u2207, the map\nacts as\nd\n+ B(y) : Am \u2192 Am\ndy\n\n23\n\n\ffor some matrix B(y) with entries in A. The differential system associated to the Gauss-Manin\nconnection and choice of initial basis {ei } and coordinate y is defined to be (17). This system\nis regular singular, and has rational local exponents, by the regularity and local monodromy\ntheorems [12]. The method developed in [18, Section 4] for computing in the cokernel of \u2207,\nand controlling the loss of p-adic precision which accrues, assumes that a basis has been chosen\nsuch that the matrix B(y) for the Gauss-Manin connection is Fuchsian.\n\n8\n\nHyperelliptic curves over the rational function field\n\nIn this section we tie up various ends which were left loose in [18]. Specifically, in that paper the\nauthor made a conjecture, the truth of which would improve the practical performance of the\nfibration method for hyperelliptic curves. This conjecture is proved in Section 8.2. Second, the\nalgorithm assumed that certain local monodromy assumptions held true [18, Section 7.4]. In\npractice, it is easy to check computationally whether these assumptions hold, and they always\ndo. We prove that these assumptions are true for the elliptic curves we consider in Section 9\nby an explicit calculation (Section 8.3). Finally, in Section 8.4 we state some results on the\ncomplexity of the fibration method, incorporating the various refinements in this paper.\n\n8.1\n\nNotation\n\nLet us first introduce the notation which we shall use in this section. Let q be a power of\nan odd prime p, and Q\u0304(x, y) \u2208 Fq [x, y] have degree 2g + 1 in the variable x for some integer\n \u0304\ng \u2265 1. Denote by \u2206(y)\nthe Sylvester resultant of the polynomials Q\u0304 and \u2202 Q\u0304/\u2202x with respect\n \u0304\nto the variable x. We assume \u2206(y)\nis non-constant. Let Q(x, y) \u2208 W [x, y] be some lift of the\npolynomial Q\u0304(x, y), and \u2206 the Sylvester resultant of Q and \u2202Q/\u2202x w.r.t. x. We need to choose\n \u0304 > 0. This can certainly be done under some hypotheses,\nQ(x, y) so that deg(\u2206) = deg(\u2206)\nwhich are stated in the results below. Let\n\u0001\nU := Spec Fq [x, y, z]/(z 2 \u2212 Q\u0304(x, y) ,\nand let V \u2192 S be the family obtained by taking \"Spec\" of the homomorphism\n \u0304\n \u0304\nFq [y, 1/\u2206(y)]\n\u0592\u2192 Fq [x, y, 1/\u2206(y),\nz]/(z 2 \u2212 Q\u0304(x, y)).\nWe assume that U is smooth.\nIn our discussion of complexity estimates in Section 8.4, we assume that U compactifies to\na quasi-smooth surface X in a weighted projective space subject to certain further conditions,\n2\nexactly as in Section 4.3, so that we may use W -lattices in Hrig\n(U ) to speed-up computations.\nHowever, this compactification plays no role in Sections 8.2 and 8.3.\n\n8.2\n\nA conjecture on the relative Frobenius matrix\n\nIn this section we prove [18, Conjecture 7.4]. This gives a useful practical improvement to the\nperformance of the fibration method for hyperelliptic curves over function fields Fq (y).\n8.2.1\n\nStatement of conjecture 7.4\n\nWe recall some notions from [18, Section 7], alerting the reader again to the fact that our\nnotation has changed. Define A\u2020 to be the weak completion of the coordinate ring of the lifting\nSK of the base S. That is\n( \u221e\n)\nX ai (y)\nA\u2020 :=\n| deg(ai ) < deg(\u2206), ordp (ai ) \u2212 \u03b5|i| \u2192 \u221e for some \u03b5 > 0 .\n\u2206(y)i\ni=\u2212\u221e\n \u0304\nThere is a lifting of the pth power map from Fq [y, 1/\u2206(y)]\nto A\u2020 which sends x 7\u2192 xp and y 7\u2192 y p ,\nunique up to a choice of sign. Let us denote this map by \u03c3A\u2020 . There is a rank 2g free module\n24\n\n\f1\nHrig\n(V /S) over A\u2020 with basis given by the classes of the forms xi dx/z for i = 0, 1, . . . , 2g \u2212 1.\n1\n1\nThere is a map F : Hrig\n(V /S) \u2192 Hrig\n(V /S) which is \u03c3A\u2020 -linear, called the pth power (relative)\nFrobenius map. We represent this map F by a matrix F (y) w.r.t. our choice of basis.\n\n[18, Conjecture 7.4] The matrix F (y) has a pole of finite order at y = \u221e.\n8.2.2\n\nElliptic curves\n\n \u0304 = 4\u01013 + 27b\u03042 .\nAssume that Q\u0304(x, y) := x3 + \u0101(y)x + b\u0304(y) for some \u0101(y), b\u0304(y) \u2208 Fq [y]. Then \u2206\nWe first consider a special case.\n \u0304 = 12e.\nTheorem 8.1. Assume that deg(\u0101) \u2264 4e and deg(b\u0304) \u2264 6e for some e \u2265 1, and deg(\u2206)\nThen the entries in matrix F (y) when expanded locally as Laurent series in K((1/y)) have\ndegree in y at most (p + 1)e; that is, the pole order of F (y) at y = \u221e is bounded by (p + 1)e.\nProof. First, lift the elliptic curve equation to get z 2 = x3 + a(y)x + b(y) where a, b \u2208 W [y] \u2282\nK(y) with deg(a) \u2264 4e, deg(b) \u2264 6e and \u2206 := 4a3 + 27b2 such that deg(\u2206) = 12e. Note that\nany lifting satisfying the degree restrictions on a and b will be suitable. We make the change\nof variables v := 1/y, u := v 2e x and w := v 3e z to get an equation w2 = u3 + \u00e3(v)u + b\u0303(v). Here\n\u00e3(v) := v 4e a(1/v) \u2208 W [v] and b\u0303(v) := v 6e b(1/v) \u2208 W [v]. The condition on the degree of the\n \u0303\ndiscriminant ensures us that \u2206(v)\n:= 4\u00e33 + 27b\u03032 = v 12e \u2206(1/v) does not vanish at v = 0, even\nmodulo p. So the lifted curve over W [v] has good reduction at v = 0, even modulo p. Recall\nthat d is the universal derivation of the function field of the generic fibre of the lifted curve over\nthe base field K(y) = K(v). We see that\ndu xdx\nudu\ndu\ndx udu\nxdx\ndx\n= ve ,\n= v \u2212e\nand\n= ye ,\n= y \u2212e\n.\nz\nw\nz\nw\nw\nz\nw\nz\n\n(19)\n\nThe matrix F (y) expresses the action of the pth power Frobenius map on the basis dx/z and\nxdx/z. Let Fij (y) be the (i, j)th entries in F (y), for 1 \u2264 i, j \u2264 2. These are p-adic functions\nwhich converge on some open annulus of outer radius 1 around y = \u221e. We wish to show that\nthey only have a finite polynomial part in y; that is, they converge on the punctured open unit\ndisk around y = \u221e. Letting \u03c3 denote the Frobenius action on functions and differentials we\nhave\n\u0012\n\u0013\n\u0012 \u0013\n\u0012 \u0013\ndu\ndx\ne du\nep\n=\u03c3 v\n=v \u03c3\n.\n\u03c3\nz\nw\nw\n\u0001\nThe expression \u03c3 du\nw may be computed using Kedlaya's method [18, Section 7.3.3], and written\nmodulo exact differentials as a linear combination\n\u0012 \u0013\ndu\ndu\nudu\n\u03c3\n\u2261 A1,1 (v)\n+ A1,2 (v)\n.\nw\nw\nw\nThe key point is that A1,1 (v), A1,2 (v) \u2208 K[[v]]; thus these functions do not have poles at v = 0.\nThe reason for this is that since the lifted curve modulo p is smooth at v = 0, Kedlaya's reduction\nformulae do not introduce poles at this point. (Kedlaya's explicit method only introduces poles\nat singular fibres; indeed one can adapt this proof to show poles do not occur at singular fibres\nwith potentially good reduction.) Similarly, we see that\n\u0012\n\u0013\n\u0012\n\u0013\n\u0013\n\u0012\ndu\nudu\nudu\nxdx\n\u2212ep\n\u2212ep\nA2,1 (v)\n=v\n\u03c3\n\u2261v\n\u03c3\n+ A2,2 (v)\nz\nw\nw\nw\nwhere A2,1 (v), A2,2 (v) \u2208 K[[v]]. Hence using (19) to get back to our original basis we find\nF1,1 = y \u2212ep A1,1 (1/y)y e ,\nF2,1 = y ep A1,2 (1/y)y e ,\n\nF1,2 = y \u2212ep A1,2 (1/y)y \u2212e ,\nF2,2 = y ep A2,2 (1/y)y \u2212e\n\nwhere Ai,j \u2208 K[[1/y]]. Thus the matrix F (y) has no positive powers of y in the (1, 1) and (1, 2)\npositions, degree in y bounded by (p + 1)e in the (2, 1) position, and degree bounded by (p \u2212 1)e\nin the (2, 2) position.\n25\n\n\fThe bounds in the theorem above on the pole order for the elliptic curves considered in\nSection 9 are (p + 1)e where p = 7 and e \u2208 {1, 2, 3, 4, 5}, that is 8, 16, 24, 32, 40, and the actual\npole orders observed were 6, 12, 18, 24, 30, respectively.\nWe now consider the general case.\n \u0304 := 4\u01013 +27b\u03042\nTheorem 8.2. Assume deg(\u0101) \u2264 d/3 and deg(b\u0304) \u2264 d/2 where the discriminant \u2206\nhas degree d \u2265 1. Then the entries in matrix F (y) when expanded locally as Laurent series in\nK((1/y)) have degree in y at most \u230a(p + 1)d/12\u230b; that is, the pole order of F (y) at y = \u221e is\nbounded by \u230a(p + 1)d/12\u230b.\nProof. Lift the curve as before, preserving the degree of the discriminant. Let m be the smallest\ninteger such that 12|md where d = deg(\u2206(y))). Define \u1ef9 := y 1/m and consider the generic fibre\nof the original lifted curve as being defined by the equation z 2 = x3 + a(\u1ef9 m )x + b(\u1ef9 m ) over\nthe totally ramified extension K(\u1ef9)/K(y). Then deg\u1ef9 (\u2206(\u1ef9 m )) = 12e for some integer e \u2265 1.\nNow proceed as in the proof of Theorem 8.1, via the change of variables v := 1/\u1ef9, u := v 2e x\nand w := v 3e z, to deduce that the Frobenius matrix F (\u1ef9) has degree in \u1ef9 bounded by (p + 1)e.\nBut this matrix converges on an open annulus around infinity, and so must have entries in\nK((1/y)). Thus we deduce that the pole order at y = \u221e of F (y) is bounded by \u230a(p + 1)e/m\u230b =\n\u230a(p + 1)d/12\u230b.\nApplying the above theorem to [18, Examples 9.1, 9.2], one obtains bounds on the pole\norder of \u230a(17 + 1)26/12\u230b = 39 and \u230a(5 + 1)62/12\u230b = 31, respectively, which are exactly the pole\norders observed experimentally.\n8.2.3\n\nHyperelliptic curves\n\nThe same technique can be used to prove [18, Conjecture 7.4] in greater generality; that is, first\nconsider the case when the fibre y = \u221e is smooth, using an explicit change of basis, and then\nmake a totally ramified extension of K(y) to reduce to this case. We need the following lemma.\nLemma 8.3. Let g \u2265 0 and Z[a2 , a4 , . . . , a2(2g+1) ] be a graded polynomial ring, where wt(ai ) :=\ni. Then the discriminant of the polynomial x2g+1 + a2 x2g + a4 x2g\u22121 + * * * + a4g x + a2(2g+1) is\nhomogeneous of degree 2(2g + 1)2g.\nProof. For \u03bb \u2208 Q\u2217 the zero locus of the discriminant is invariant under the map a2i 7\u2192 \u03bbi a2i (1 \u2264\ni \u2264 2g + 1), since on the original polynomial this transformation composed with x \u2192 \u03bbx is just\nmultiplication by \u03bb2g+1 . So the discriminant is weighted homogeneous w.r.t. the given weights.\nTo compute the degree, specialise all but the constant coefficient to zero and use the explicit\nexpression as the discriminant as the determinant of a Sylvester matrix.\nThe next theorem subsumes Theorem 8.2.\nTheorem 8.4. Let Q\u0304(x, y) \u2208 Fq [x, y] be monic of degree 2g + 1 in the variable x for some\n \u0304\ninteger g \u2265 1. Let \u2206(y)\nbe the discriminant of the hyperelliptic curve z 2 = Q\u0304(x, y) over Fq (y),\n \u0304 > 0. Assume that when one writes Q\u0304(x, y) = x2g+1 + \u01012 (y)x2g + \u01014 (y)x2g\u22121 +\nand d := deg(\u2206)\n* * * + \u01012(2g+1) (y) we have\ni\n.\ndegy (\u0101i (y)) \u2264 d\n2(2g + 1)2g\nThen the entries in the matrix F (y) when expanded locally as Laurent series in K((1/y)) have\ndegree in y at most \u230ad(2g \u2212 1)(p + 1)/(4(2g + 1)g)\u230b; that is, the pole order of F (y) at y = \u221e is\nbounded by \u230ad(2g \u2212 1)(p + 1)/(4(2g + 1)g)\u230b.\nProof. Lift the polynomial Q\u0304(x, y) to a polynomial Q(x, y) \u2208 W [x, y] preserving the discriminant\ndegree. Lemma 8.3 and the assumptions on the degrees of the coefficients \u0101i (y) assures us\nthat any lifting which preserves the degree bounds on the coefficients will be suitable. Let\nus first assume that d = 2(2g + 1)2ge for some integer e. Define v := 1/y, u := v 2e x and\nw := v (2g+1)e z. Let Q\u0303(u, v) \u2208 K[u, v] be defined as Q\u0303(u, v) := v d/2g Q(v \u22122e u, 1/v). Then the\nequation w2 = Q\u0303(u, v) defines the generic fibre of the original lifted curve over K(v) w.r.t. the\n\n26\n\n\f \u0303\nnew choice of variables. The discriminant \u2206(v)\nof the polynomial Q\u0303(u, v) equals v d \u2206(1/v).\n \u0303\nSince we preserved the degree of the discriminant when lifting, \u2206(0)\n6= 0, even modulo p, and\nthe fibre at v = 0 is smooth, even modulo p. We can compute the action of F on the new basis\nui du/w for 0 \u2264 i < 2g using Kedlaya's algorithm. Let the (i, j)th coefficients of the matrix thus\nobtained be Ai,j (v). Since the fibre at v = 0 is smooth, we have that the local expansions of\nthe functions Ai,j (v) at v = 0 lie in K[[v]].\nLet Fi,j (y) be the (i, j)th coefficient of the matrix for the action of F on the original basis\nxi dx/z, 0 \u2264 i < 2g. Using the formulae\nxi dx\nui du uj du\nxj dx\n= v (2g+1)e\u22122e(i+1)\n,\n= y (2g+1)e\u22122e(j+1)\nz\nw\nw\nz\nwe see that\nFi,j (y) = y \u2212p[(2g+1)e\u22122e(i+1)] y (2g+1)e\u22122e(j+1) Ai,j (1/y)\n= y 2e(p(i+1)\u2212(j+1))\u2212(p\u22121)e(2g+1) Ai,j (1/y).\nThus the maximum degree in y which occurs is bounded by\n2e(2gp \u2212 1) \u2212 (p \u2212 1)e(2g + 1) = e(2g \u2212 1)(p + 1).\nThe general case is treated by first making the change of variable \u1ef9 := y 1/m where m is the\nsmallest integer such that 2(2g + 1)2ge = md for some integer e. One deduces that the degree in\n\u1ef9 of the matrix F (\u1ef9) is bounded by e(2g \u2212 1)(p + 1). Hence the degree of F (y) in y is bounded\nby \u230ae(2g \u2212 1)(p + 1)/m\u230b = \u230ad(2g \u2212 1)(p + 1)/(4(2g + 1)g)\u230b.\nApplying the above theorem to [18, Example 9.3] one obtains a bound of \u230a28(4 \u2212 1)(11 +\n1)/(4(4 + 1)2)\u230b = 25 and the experimentally observed pole order is 21.\n\n8.3\n\nThe Gauss-Manin connection for elliptic curves\n\nWrite Q\u0304(x, y) = x3 + \u0101(y)x + b\u0304(y) and Q(x, y) = x3 + a(y)x + b(y), with other notation as in\n1\nSection 8.1. Denote by B(y) the matrix for the Gauss-Manin connection on HdR\n(VK /SK ) with\nrespect to the coordinate function y and initial basis the cohomology classes of dx/z and xdx/z,\nsee Section 7.2 or [18, Section 7.3.1].\nProposition 8.5. The matrix for the Gauss-Manin connection with respect to our choice of\nbasis, acting on the left on column vectors, is\n!\nda\ndb\ndb\nda\n\u2212a2 dy\n\u2212 92 b dy\n\u2212a2 dy\n+ 32 ab dy\n1\n.\nB(y) =\nda\nda\ndb\ndb\n+ 92 b dy\na2 dy\n+ 92 b dy\n\u22123a dy\n\u2206(y)\nProof. An explicit calculation direct from the definition which uses the Sylvester matrix of\nQ(x, y) = x3 + a(y)x + b(y) and \u2202Q\n\u2202x with respect to x, and Kedlaya's formula for pole reduction\nof differential forms [15].\nLet K\u0304 be an algebraic closure of K, and R := {\u03b3 \u2208 K\u0304 | \u2206(\u03b3) = 0}. Let M(K[y], 2) be the\nring of 2 \u00d7 2 matrices over K[y]. Define \u03b2(y) \u2208 M(K[y], 2) by \u03b2(y) := \u2206(y)B(y).\nLemma 8.6. The matrix \u03b2(\u03b3) is nilpotent for all \u03b3 \u2208 R.\nProof. First, from Proposition 8.5 observe Tr(\u03b2(y)) = 0. An explicit calculation reveals that\n\u0012 \u00132 !\n\u0012 \u00132\ndb\nda\n1\n.\n+3\ndet(\u03b2(y)) = \u2212 \u2206(y) a\n4\ndy\ndy\nSo at a root \u03b3 of \u2206(y) = 0 we have det(\u03b2(\u03b3)) = 0, and hence det(T \u2212\u03b2(\u03b3)) = T 2 , as required.\n\n27\n\n\fProposition 8.7. Assume that \u2206(y) is squarefree, and let \u03b3 \u2208 R. Let t\u03b3 := y \u2212 \u03b3, a uniformizing parameter at \u03b3, K(\u03b3)((t\u03b3 )) be the field of Laurent series, and embed K[y, 1/\u2206(y)] \u0592\u2192\nK(\u03b3)((t\u03b3 )). Then\nB(t\u03b3 ) = r\u03b3 t\u03b3\u22121 + s\u03b3 (t\u03b3 ), s\u03b3 (t\u03b3 ) \u2208 M(K(\u03b3)[[t\u03b3 ]], 2)\nwhere the residue matrix r\u03b3 \u2208 M(K(\u03b3), 2) is nilpotent.\nProof. We have\nB(y) =\n\n\u03b2(y) X 1\n\u03b2(y)\n= \u2032\n.\n\u2206(y)\n\u2206 (y)\ny\u2212\u03b3\n\u03b3\u2208R\n\nLet \u03b3 \u2208 R. Then B(t\u03b3 ) can be written as claimed where r\u03b3 := \u03b2(\u03b3)/\u2206\u2032 (\u03b3). Since \u03b2(\u03b3) is\nnilpotent, it follows that r\u03b3 is nilpotent.\nThus under the hypothesis that \u2206(y) is squarefree, the Gauss-Manin has regular singular\npoints at the roots of \u2206(y) = 0, with nilpotent residue matrix. So we have proved in an entirely\nexplicit manner the following well-known result.\nCorollary 8.8. When the discriminant \u2206(y) is non-constant and squarefree, the family of\nelliptic curves defined by the equation z 2 = x3 + a(y)x + b(y) has regular singularities and\nunipotent local monodromy at the roots of \u2206(y) = 0.\nWe now consider the local monodromy at infinity. First, let us consider the case which arises\nin our calculations in Section 9.\nLemma 8.9. Assume that deg(a) \u2264 deg(b)/2 and deg(\u2206) = 2 deg(b). Then we have degy (B(y)) \u2264\n\u22121, and the coefficient of y in the local expansion at zero of B(y) has the form\n\u0012 9\n\u0013\n1\n\u2212 2 deg(b)\n\u22c6\n9\n0\n27\n2 deg(b)\nwhere \u22c6 = 0 when deg(a) < deg(b)/2. When deg(a) = deg(b)/2 we have\n\u0012\n\u0013\n\u03b12\n3\n\u03b12\n\u22c6=\n\u2212 deg(b) + deg(a) = \u2212\ndeg(b),\n\u03b2\n2\n4\u03b2\nwhere \u03b1 and \u03b2 are the leading coefficients of a and b, respectively.\nProof. This can be read off from the connection matrix in Proposition 8.5.\nWhen deg(b) \u2261 0 mod 6, as in Section 9, the residue matrix has integer eigenvalues \u00b1 deg(b)/6.\nNote that since the residue matrix is not prepared in this case, one cannot apply directly the\nprecision loss bounds deduced in [18, Section 4] when reducing the \"polynomial part\" of differential forms. However, by virtue of our proof of [18, Conjecture 7.4], very little reduction needs\nto be done on the \"polynomial part\", and naive estimates are sufficient.\nWhen deg(a) \u2265 deg(b) and deg(\u2206) = 3 deg(a), the matrix B(y) is such that degy (B(y)) \u2264\n\u22121, and one can explicitly read off the residue matrix. However, in the case deg(b)/2 < deg(a) <\ndeg(b) the entry B1,2 (y) does not have a simple pole at infinity and one needs to make a change\nof basis. We explain how to do this in the proof of Proposition 8.10, although we do not\nexamine the local monodromy at infinity. Note that we have not implemented this change of\nbasis routine in our algorithm as it requires an extension of the base field. The author does not\nknow whether a Fuchsian basis exists for the general case without first extending the base field.\nAssume deg(b)/2 < deg(a) < deg(b) and d := deg(\u2206) = max{2 deg(b), 3 deg(a)} > 0.\nWhen deg(a) \u2264 2 deg(b)/3 define m := 2 deg(a) \u2212 deg(b), and when deg(a) > 2 deg(b)/3 define\nm := deg(b) \u2212 deg(a). Note that m + 1 is the pole order at infinity of B1,2 (y). Assume that\n\u2206(y) is squarefree, and also that either B1,1 (y) or B2,1 (y) is non-zero.\nProposition 8.10. Let L \u2287 K be such that \u2206(y) has a root \u03b3 \u2208 L and a factor of degree m\n1\ndefined over L. Then there exists a basis for HdR\n(VK /SK ) \u2297K L such that the matrix for the\nGauss-Manin connection \u2207 is Fuchsian (see Section 7.1 for the definition of this term).\n28\n\n\fProof. After a change of variable y 7\u2192 y \u2212 \u03b3 we may assume \u03b3 = 0. We make a further change of\nvariable t := 1/y. The matrix for the connection \u2207 with respect to the same basis but different\n \u0303 := td \u2206(1/t). Then from\nchoice of coordinate function t is B\u0303(t) := \u22121/t2 B(1/t). Define \u2206\nProposition 8.5 one sees\n\uf8f6\n\uf8eb\nB\u0303(t) = \uf8ed\n\nc(t)\n \u0303\nt\u2206(t)\ntm\u22121 e(t)\n \u0303\n\u2206(t)\n\nd(t)\n \u0303\ntm+1 \u2206(t)\nc(t)\n\u2212 t\u2206(t)\n \u0303\n\n\uf8f8 , where c(t), d(t), e(t) \u2208 L[t] , e(t) or c(t) non-zero.\n\n \u0303 deg(d) \u2264\nMoreover, since B(y) had a simple pole at y = 0, one sees that deg(c) \u2264 deg(\u2206),\n \u0303 + m and deg(e) \u2264 deg(\u2206)\n \u0303 \u2212 m. Now make a change of basis using the matrix\ndeg(\u2206)\n\u0012\n\u0013\ng(t) \u03b1(t)\nH(t) :=\n0\ntm\n \u0303\nwhere g(t) is a factor of \u2206(t)\nof degree m, and \u03b1(t) \u2208 L[t] will shortly be chosen. One computes\nthat B\u0303[H] (see (18)) equals\n!\n\u2032\ng\u2032\nc\u2212\u03b1e\n2c\u03b1\u2212e\u03b12 +d\n+ \u03b1g \u2212 m\u03b1\n \u0303 + g\n \u0303\ntg\nt\u2206\nt\u2206g\n.\neg\ne\u03b1\u2212c\nm\n \u0303\n \u0303 + t\nt\u2206\nt\u2206\nChoose \u03b1 \u2208 K[t] with deg(\u03b1) < deg(g) = m such that\n\u2212e\u03b12 + 2c\u03b1 + d = gf\nfor some f \u2208 W [t]; that is, solve the quadratic equation \u2212eX 2 + 2cX + d = 0 mod g. This is\nalways possible without extending the field further: the discriminant of the equation is 4c2 +4ed,\n \u0303\n \u0303\nwhich is zero modulo \u2206(t)\nsince the residue matrices of B\u0303(t) are nilpotent at the roots of \u2206(t)\n(by Proposition 8.7). With this choice of \u03b1 one sees that the entries in the matrix B\u0303[H] are of\n \u0303\n \u0303\nthe form \u22c6/t\u2206(t)\nwhere deg(\u22c6) \u2264 deg(\u2206).\n\n8.4\n\nComplexity estimates\n\nAll of the complexity estimates in this section are for deterministic algorithms. Let Q\u0304(x, y) \u2208\nFq [x, y] with degx (Q\u0304) = 2g + 1 and h := degy (Q\u0304). From [19, Theorem 1] we see that one may\ncompute the L-function of a hyperelliptic curve z 2 = Q\u0304(x, y) over Fq (y) in (pgh log(q))C bit\noperations for some absolute constant C \u2265 1. For g fixed and h/p bounded, [18, Theorem 8.6]\ntells us we may compute the L-function in O(p1+\u03b5 log(q)3+\u03b5 h4+\u03b5 ) bit operations, for any \u03b5 > 0.\nLet us now assume Q\u0304(x, y) satisfies the hypothesis in the statement of Theorem 8.4. For h fixed,\nusing ideas similar to those in the last paragraph of [18, Section 8.3] and Theorem 8.4 one can\nshow that the L-function may be computed in O(p1+\u03b5 log(q)3+\u03b5 g 7+\u03b5 ) bit operations, for any\n\u03b5 > 0. The main point is that the bound in Theorem 8.4 does not grow with g. This last bound\ndoes not use any of the refinements in this paper other than the proof of [18, Conjecture 7.4].\nAssume now that g is fixed. The difficulty lies in proving bounds when h/p is allowed to\ngrow. The problem is that using the method in [18], even combined with our proof of [18,\n2\nConjecture 7.4], one can only show that the matrix of the pth power Frobenius on Hrig\n(V ) has\nvaluation bounded below by some absolute constant times \u2212h/p. This lower bounds impacts\non the complexity when one computes the characteristic polynomial, because of the possibility\nof precision loss. By computing Frobenius on the basis elements of the lattice H(X, kD) in\nSection 4.3 one gets a matrix whose valuation is bounded below by some absolute constant times\n\u2212 logp (h), and so there is no problem with precision loss when one computes the characteristic\npolynomial. Unfortunately, as yet the author has not been able to prove useful bounds during\nanother step of the refined algorithm; namely after reduction in the cokernel of \u2207, when an\n2\nelement of H(X, kD) \u2297W K written w.r.t a given generating set for Hrig\n(V ) is written as a\nlinear combination of the chosen basis for H(X, kD). In practice, this does not cause any\nproblems: this step can be accomplished by multiplication by an explicit matrix with entries\nin an algebraic number field, and one can measure the loss of precision simply by computing\n29\n\n\fthe valuation of the matrix at the prime p. In the examples computed in Section 9, this loss\nof precision was zero; note that this precision loss can be computed right at the start of the\nalgorithm, before various precisions are chosen. Assuming the loss of precision at this step is\nbounded by some function of logp (h), then one gets a complexity of O(p1+\u03b5 log(q)3+\u03b5 h4+\u03b5 ), for\nany \u03b5 > 0. One must assume here that all of the conditions needed for the various steps are\nmet. For elliptic curves with discriminant of degree 12e it is sufficient that p > 3 and p does\nnot divide e, Q(x, y) = x3 + \u0101(y)x + b\u0304(y) with deg(a) \u2264 deg(b)/2, the discriminant 4\u01013 + 27b\u03042 is\nsquarefree, the affine surface z 2 = Q\u0304(x, y) is smooth, the projective surface defined by the affine\nequation z 6e = Q\u0304(x2e , y) is smooth, and torsion is not encountered during the construction\nof the lattice H(X, kD) in Section 4.3. We stress that the output of the algorithm is always\nprovably correct.\n\n9\n\nRanks of elliptic curves\n\nFor each d \u2208 {6, 12, 18, 24, 30}, the author selected in a verifiably random manner 1000 elliptic\ncurves of the form\nz 2 = x3 + a(y)x + b(y)\nwhere a, b \u2208 F7 [y] with deg(b) = d and deg(a) \u2264 d/2, subject to the condition that the discriminant is squarefree and does not vanish at y = 0. We imposed the further condition that\nthe projective surface defined by the affine equation z d = xd + a(y)xd/3 + b(y) is smooth, see\nNote 9.1. The L-functions of the curves were computed using the fibration method. These are\npolynomials of degree 2d \u2212 4 with all reciprocal roots of complex absolute value 7. The curves\nand their L-functions, along with the details of how the curves were generated, will appear as\nan attachment in the final version of this paper. The table below details the number of curves\nof each analytic rank.\nanalytic\nanalytic\nanalytic\nanalytic\nanalytic\nanalytic\n\nrank\nrank\nrank\nrank\nrank\nrank\n\n0\n1\n2\n3\n4\n>4\n\nd = 6 d = 12 d = 18 d = 24 d = 30\n336\n378\n449\n473\n505\n481\n489\n489\n496\n482\n162\n120\n55\n31\n13\n19\n11\n7\n0\n0\n2\n2\n0\n0\n0\n0\n0\n0\n0\n0\n\nAssuming the Tate conjecture, one observes that the percentage with infinitely many rational\npoints is 66.4%, 62.2% (these are elliptic K3 surfaces, so the Tate conjecture is known here [24,\nTheorem 5.6. (b)]), 55.1%, 52.7% and 49.5%, respectively - neatly flattening from the previous\nexperimentally observed fraction of around two thirds to around the predicted value of one half.\nNote 9.1 The additional generic condition that the projective surface defined by the affine\nequation z d = xd + a(y)xd/3 + b(y) is smooth is an artifact of the method of construction of\nthe W -lattice H(X, kD) in Section 4, and undoubtedly irrelevant to the algorithm and the\ncorrectness of its output. The table for the first 1000 curves chosen without imposing this\ncondition is as follows.\nanalytic\nanalytic\nanalytic\nanalytic\nanalytic\nanalytic\n\nrank\nrank\nrank\nrank\nrank\nrank\n\n0\n1\n2\n3\n4\n>4\n\nd = 6 d = 12 d = 18 d = 24 d = 30\n346\n379\n453\n479\n497\n471\n494\n493\n493\n493\n162\n114\n47\n28\n10\n20\n11\n7\n0\n0\n1\n2\n0\n0\n0\n0\n0\n0\n0\n0\n\nAssuming the Tate conjecture, one observes that the percentage with infinitely many rational\npoints here is 65.4%, 62.1%, 54.7%, 52.1% and 50.3%, respectively.\n\n30\n\n\fNote 9.2 The restriction that deg(a) \u2264 d/2, rather than the more natural deg(a) \u2264 2d/3,\nforces the j-invariants of the curves chosen to vanish to a high degree at infinity. So we have\nnot chosen curves randomly in a dense open subset of all elliptic curves with discriminant of\ndegree 2d. However, the curves are chosen uniformly at random from a dense open subset of a\n\"Weiestrass family\" which for d \u2265 12 has geometric monodromy group the full orthogonal group\nO(2d \u2212 4) [14, Theorem 10.2.13]. What we are really testing experimentally are the predictions\nof Katz for such families as one allows the degree of the conductor to grow [13, Introduction].\nThese predictions include that asymptotically exactly one half will have infinitely many rational\npoints.\n\nReferences\n[1] T.G. Abbot, K.S. Kedlaya, D. Roe, Bounding Picard numbers of surfaces using p-adic\ncohomology, to appear in Arithmetic, Geometry and Coding Theory (AGCT 2005), Societ\u00e9\nMath\u00e9matique de France.\n[2] B. Bektemirov, B. Mazur, W. Stein and M. Watkins, Average ranks of elliptic curves:\ntension between data and conjecture, Bull. A.M.S. 44(2), (2007), 233-254.\n[3] A.A. Bolibrukh, The Riemann-Hilbert problem, Russian Math. Surveys 45 (2), (1990),\n1-47.\n[4] D.A. Cox and S. Katz, Mirror Symmetry and Algebraic Geometry, Mathematical Surveys\nand Monographs 68, A.M.S., 1999.\n[5] W. Dekkers, The matrix of a connection having regular singularities on a vector bundle of\nrank 2 on P 1 (C), L.N.M. Vol. 712, 33-43, Springer, New York, 1979.\n[6] P. Deligne, La conjecture de Weil: II, Pub. I.H.E.S. 52, (1981), 313-428.\n[7] A. Dimca, Singularities and coverings of weighted complete intersections, J. Reine Angew.\nMath. 366 (1986), 184-193.\n[8] A. Dimca, Singularities and Topology of Hypersurfaces, Springer-Verlag, 1992.\n[9] A. Dimca, Sheaves in Topology, Springer-Verlag, 2004.\n[10] R. Gerkmann, Relative rigid cohomology and deformation of hypersurfaces, to appear in\nIntern. Math. Research Papers.\n[11] R. Hartshorne, Algebraic Geometry, Graduate Texts in Mathematics 52, Springer, 1977.\n[12] N.M. Katz, Nilpotent connections and the monodromy theorem: applications of a result\nof Turrittin, Pub. I.H.E.S. 39, (1970), 175-232.\n[13] N.M. Katz, Twisted L-functions and Monodromy, Annals of Mathematics Studies 150,\nPrinceton University Press, 2002.\n[14] N.M. Katz, Moments, Monodromy, and Perversity: A Diophantine Perspective, Annals of\nMathematics Studies 159, Princeton University Press, 2005.\n[15] K. Kedlaya, Counting points on hyperelliptic curves using Monsky-Washnitzer cohomology,\nJ. Ramanujan Math. Soc. 16, (2001), 323-338.\n[16] K. Kedlaya, Finiteness of rigid cohomology with coefficients, Duke Math. J. 134, (2006),\n15-97.\n[17] K. Kedlaya, Search techniques for root-unitary polynomials, arxiv:math/0611835v3, to\nappear in Proceedings of a Special Session on Computational Arithmetic Geometry, A.M.S.\n(K. Lauter and K. Ribet, eds).\n\n31\n\n\f[18] A.G.B. Lauder, A recursive method for computing zeta functions of varieties, L.M.S. J.\nComp. Math. 9, (2006), 222-267.\n[19] A.G.B. Lauder and D. Wan, Counting points on varieties over finite fields of small characteristic, in \"Algorithmic Number Theory: lattices, number fields, curves and cryptography\", J.P. Buhler and P. Stevenhagen (eds), MSRI Publ. 44, to appear.\n[20] B. Le Stum, Rigid cohomology, Cambridge Tracts in Mathematics 172, Cambridge University Press, 2007.\n[21] B. Mazur, Frobenius and the Hodge filtration, Bull. A.M.S. 78 (5), (1972), 653-667.\n[22] J. Steenbrink, Intersection form for quasi-homogeneous singularities, Compositio Mathematica 34, (1977), 211-223.\n[23] J. Tate, Algebraic cycles and poles of zeta functions, Arithmetic Algebraic Geometry,\nHarper and Row, New York, (1965), 93-110.\n[24] J. Tate, Conjectures on algebraic cycles in l-adic cohomology, Proc. Symp. Pure Math. 55\nPart 1, (1994), 71-83.\n[25] N. Tsuzuki, On the Gysin isomorphism in rigid cohomology, Hiroshima Math. J. 29, (1999),\n479-527.\n\n32\n\n\f"}