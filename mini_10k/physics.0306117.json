{"id": "http://arxiv.org/abs/physics/0306117v1", "guidislink": true, "updated": "2003-06-14T03:51:40Z", "updated_parsed": [2003, 6, 14, 3, 51, 40, 5, 165, 0], "published": "2003-06-14T03:51:40Z", "published_parsed": [2003, 6, 14, 3, 51, 40, 5, 165, 0], "title": "A 3-D Track-Finding Processor for the CMS Level-1 Muon Trigger", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=physics%2F0301039%2Cphysics%2F0301082%2Cphysics%2F0301004%2Cphysics%2F0301036%2Cphysics%2F0301032%2Cphysics%2F0301054%2Cphysics%2F0301010%2Cphysics%2F0301031%2Cphysics%2F0301073%2Cphysics%2F0301079%2Cphysics%2F0301005%2Cphysics%2F0301027%2Cphysics%2F0301040%2Cphysics%2F0301062%2Cphysics%2F0301065%2Cphysics%2F0301057%2Cphysics%2F0301066%2Cphysics%2F0301020%2Cphysics%2F0301014%2Cphysics%2F0301028%2Cphysics%2F0301064%2Cphysics%2F0301016%2Cphysics%2F0301058%2Cphysics%2F0301080%2Cphysics%2F0301078%2Cphysics%2F0301075%2Cphysics%2F0301022%2Cphysics%2F0301047%2Cphysics%2F0301055%2Cphysics%2F0301033%2Cphysics%2F0301048%2Cphysics%2F0301069%2Cphysics%2F0301013%2Cphysics%2F0301067%2Cphysics%2F0301074%2Cphysics%2F0301059%2Cphysics%2F0301043%2Cphysics%2F0306161%2Cphysics%2F0306041%2Cphysics%2F0306163%2Cphysics%2F0306058%2Cphysics%2F0306123%2Cphysics%2F0306014%2Cphysics%2F0306079%2Cphysics%2F0306200%2Cphysics%2F0306140%2Cphysics%2F0306006%2Cphysics%2F0306128%2Cphysics%2F0306043%2Cphysics%2F0306144%2Cphysics%2F0306178%2Cphysics%2F0306056%2Cphysics%2F0306162%2Cphysics%2F0306017%2Cphysics%2F0306060%2Cphysics%2F0306018%2Cphysics%2F0306104%2Cphysics%2F0306132%2Cphysics%2F0306199%2Cphysics%2F0306029%2Cphysics%2F0306089%2Cphysics%2F0306189%2Cphysics%2F0306166%2Cphysics%2F0306186%2Cphysics%2F0306021%2Cphysics%2F0306180%2Cphysics%2F0306070%2Cphysics%2F0306003%2Cphysics%2F0306090%2Cphysics%2F0306044%2Cphysics%2F0306159%2Cphysics%2F0306110%2Cphysics%2F0306109%2Cphysics%2F0306059%2Cphysics%2F0306096%2Cphysics%2F0306039%2Cphysics%2F0306143%2Cphysics%2F0306062%2Cphysics%2F0306102%2Cphysics%2F0306008%2Cphysics%2F0306118%2Cphysics%2F0306086%2Cphysics%2F0306051%2Cphysics%2F0306179%2Cphysics%2F0306145%2Cphysics%2F0306052%2Cphysics%2F0306068%2Cphysics%2F0306053%2Cphysics%2F0306034%2Cphysics%2F0306117%2Cphysics%2F0306046%2Cphysics%2F0306119%2Cphysics%2F0306173%2Cphysics%2F0306107%2Cphysics%2F0306035%2Cphysics%2F0306134%2Cphysics%2F0306168%2Cphysics%2F0306009%2Cphysics%2F0306115%2Cphysics%2F0306069%2Cphysics%2F0306160&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "A 3-D Track-Finding Processor for the CMS Level-1 Muon Trigger"}, "summary": "We report on the design and test results of a prototype processor for the CMS\nLevel-1 trigger that performs 3-D track reconstruction and measurement from\ndata recorded by the cathode strip chambers of the endcap muon system. The\ntracking algorithms are written in C++ using a class library we developed that\nfacilitates automatic conversion to Verilog. The code is synthesized into\nfirmware for field-programmable gate-arrays from the Xilinx Virtex-II series. A\nsecond-generation prototype has been developed and is currently under test. It\nperforms regional track-finding in a 60 degree azimuthal sector and accepts 3\nGB/s of input data synchronously with the 40 MHz beam crossing frequency. The\nlatency of the track-finding algorithms is expected to be 250 ns, including\ngeometrical alignment correction of incoming track segments and a final\nmomentum assignment based on the muon trajectory in the non-uniform magnetic\nfield in the CMS endcaps.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=physics%2F0301039%2Cphysics%2F0301082%2Cphysics%2F0301004%2Cphysics%2F0301036%2Cphysics%2F0301032%2Cphysics%2F0301054%2Cphysics%2F0301010%2Cphysics%2F0301031%2Cphysics%2F0301073%2Cphysics%2F0301079%2Cphysics%2F0301005%2Cphysics%2F0301027%2Cphysics%2F0301040%2Cphysics%2F0301062%2Cphysics%2F0301065%2Cphysics%2F0301057%2Cphysics%2F0301066%2Cphysics%2F0301020%2Cphysics%2F0301014%2Cphysics%2F0301028%2Cphysics%2F0301064%2Cphysics%2F0301016%2Cphysics%2F0301058%2Cphysics%2F0301080%2Cphysics%2F0301078%2Cphysics%2F0301075%2Cphysics%2F0301022%2Cphysics%2F0301047%2Cphysics%2F0301055%2Cphysics%2F0301033%2Cphysics%2F0301048%2Cphysics%2F0301069%2Cphysics%2F0301013%2Cphysics%2F0301067%2Cphysics%2F0301074%2Cphysics%2F0301059%2Cphysics%2F0301043%2Cphysics%2F0306161%2Cphysics%2F0306041%2Cphysics%2F0306163%2Cphysics%2F0306058%2Cphysics%2F0306123%2Cphysics%2F0306014%2Cphysics%2F0306079%2Cphysics%2F0306200%2Cphysics%2F0306140%2Cphysics%2F0306006%2Cphysics%2F0306128%2Cphysics%2F0306043%2Cphysics%2F0306144%2Cphysics%2F0306178%2Cphysics%2F0306056%2Cphysics%2F0306162%2Cphysics%2F0306017%2Cphysics%2F0306060%2Cphysics%2F0306018%2Cphysics%2F0306104%2Cphysics%2F0306132%2Cphysics%2F0306199%2Cphysics%2F0306029%2Cphysics%2F0306089%2Cphysics%2F0306189%2Cphysics%2F0306166%2Cphysics%2F0306186%2Cphysics%2F0306021%2Cphysics%2F0306180%2Cphysics%2F0306070%2Cphysics%2F0306003%2Cphysics%2F0306090%2Cphysics%2F0306044%2Cphysics%2F0306159%2Cphysics%2F0306110%2Cphysics%2F0306109%2Cphysics%2F0306059%2Cphysics%2F0306096%2Cphysics%2F0306039%2Cphysics%2F0306143%2Cphysics%2F0306062%2Cphysics%2F0306102%2Cphysics%2F0306008%2Cphysics%2F0306118%2Cphysics%2F0306086%2Cphysics%2F0306051%2Cphysics%2F0306179%2Cphysics%2F0306145%2Cphysics%2F0306052%2Cphysics%2F0306068%2Cphysics%2F0306053%2Cphysics%2F0306034%2Cphysics%2F0306117%2Cphysics%2F0306046%2Cphysics%2F0306119%2Cphysics%2F0306173%2Cphysics%2F0306107%2Cphysics%2F0306035%2Cphysics%2F0306134%2Cphysics%2F0306168%2Cphysics%2F0306009%2Cphysics%2F0306115%2Cphysics%2F0306069%2Cphysics%2F0306160&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "We report on the design and test results of a prototype processor for the CMS\nLevel-1 trigger that performs 3-D track reconstruction and measurement from\ndata recorded by the cathode strip chambers of the endcap muon system. The\ntracking algorithms are written in C++ using a class library we developed that\nfacilitates automatic conversion to Verilog. The code is synthesized into\nfirmware for field-programmable gate-arrays from the Xilinx Virtex-II series. A\nsecond-generation prototype has been developed and is currently under test. It\nperforms regional track-finding in a 60 degree azimuthal sector and accepts 3\nGB/s of input data synchronously with the 40 MHz beam crossing frequency. The\nlatency of the track-finding algorithms is expected to be 250 ns, including\ngeometrical alignment correction of incoming track segments and a final\nmomentum assignment based on the muon trajectory in the non-uniform magnetic\nfield in the CMS endcaps."}, "authors": ["D. Acosta", "V. Golovtsov", "M. Kan", "A. Madorsky", "B. Scurlock", "H. Stoeck", "L. Uvarov", "S. M. Wang"], "author_detail": {"name": "S. M. Wang"}, "author": "S. M. Wang", "arxiv_comment": "7 pages, 5 figures, proceedings for the conference on Computing in\n  High Energy and Nuclear Physics, March 24-28 2003, La Jolla, California", "links": [{"href": "http://arxiv.org/abs/physics/0306117v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/physics/0306117v1", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "physics.ins-det", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "physics.ins-det", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/physics/0306117v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/physics/0306117v1", "journal_reference": null, "doi": null, "fulltext": "Computing in High Energy and Nuclear Physics, La Jolla, California, March 24-28, 2003\n\n1\n\nA 3-D Track-Finding Processor for the CMS Level-1 Muon Trigger\nD.Acosta, B.Scurlock*, A.Madorsky, H.Stoeck, S.M.Wang\nDepartment of Physics, University of Florida, Gainesville, FL 32611, USA\nV.Golovtsov, M.Kan, L.Uvarov\nHigh Energy Physics Division, Petersburg Nuclear Physics Institute, Gatchina, Leningradskaya\noblast, 188300, Russia\n*presented by Bobby Scurlock (bslock@phys.ufl.edu)\nWe report on the design and test results of a prototype processor for the CMS Level-1 trigger that performs 3-D track\nreconstruction and measurement from data recorded by the cathode strip chambers of the endcap muon system. The tracking\nalgorithms are written in C++ using a class library we developed that facilitates automatic conversion to Verilog. The code is\nsynthesized into firmware for field-programmable gate-arrays from the Xilinx Virtex-II series. A second-generation prototype\nhas been developed and is currently under test. It performs regional track-finding in a 60 degree azimuthal sector and accepts 3\nGB/s of input data synchronously with the 40 MHz beam crossing frequency. The latency of the track-finding algorithms is\nexpected to be 250 ns, including geometrical alignment correction of incoming track segments and a final momentum\nassignment based on the muon trajectory in the non-uniform magnetic field in the CMS endcaps.\n\n1. INTRODUCTION\n\n2. TRACK-FINDER LOGIC\n\nThe endcap regions of the Compact Muon Solenoid\n(CMS) experiment will consist of four stations of\nCathode Strip Chambers (CSC). These chambers will\nprovide CMS complete azimuth coverage (in \u03c6), as well\nas 0.9 to 2.4 in pseudo-rapidity (\u03b7). Six cathode strip\nchambers compose a single station in the endcap system.\nThe chambers are trapezoidal in shape, extending 10o or\n20o in \u03c6, and are composed of cathode strips aligned\nradially from the beam axis, and anode wires aligned in\nthe orthogonal direction.\nIn the endcap system, muon track-finding is\nelectronically partitioned into six 60o sectors. A single\nSector Processor (SP) receives trigger primitives from\nfront-end electronics which sit on or near the CSCs. The\nfront-end electronics form Local Charged Tracks (LCTs)\nfrom the six detector layers of a station. A Muon Port\nCard (MPC) collects the LCTs for a given station and\nsector, sorts them, and sends the best three to an SP via\noptical fibers. A single SP collects LCTs sent via fifteen\n1.6 Gbit/s optical links, and is responsible for linking\nLCTs in \u03c6 and \u03b7 in order to form full tracks, and to\nreport the transverse momentum (pt), \u03c6, and \u03b7 for each\ntrack. The entire Track-Finding processor is composed of\ntwelve such SPs housed in a single 9U VME crate. The\nchallenge for the Track-Finding Processor is to report\nmuon candidates with the lowest possible Pt threshold,\nand yet maintain a single muon trigger rate below 1\nkHz/\u03b7 at full Large Hadron Collider (LHC) luminosity.\nThis paper is organized as follows: Section 2 will\ndescribe the Track-Finder (TF) algorithm, Section 3 will\ndiscuss the first prototype, Section 4 will discuss the\nsecond prototype including preliminary test results,\nSection 5 will discuss software used for the SP, and a\nsummary can be found in Section 6.\n\nThe principle of the TF logic [1] is illustrated in\nFigure 1. The Track-Finding process is partitioned into\nseveral steps. A given station within a sector may have\nas many as three LCTs reported to the SP. These LCTs\nare then converted into track-segments, which are\ndescribed in terms of their \u03c6, and \u03b7 coordinates. Each\ntrack-segment in each station should be checked against\nthe other segments in neighboring stations for\nconsistency to share a single track. Thus, each tracksegment is extrapolated through to other stations, and\ncompared against existing segments. If an extrapolation\nis successful, these segments are \"linked\" to form a\nsingle track. Each possible pairwise combination is\ntested in parallel. After extrapolation, doublets are then\nlinked to assemble full tracks. Redundant tracks are\ncancelled, the best three tracks are selected, and the track\nparameters are then measured.\nThe SP has the ability to handle LCTs received out of\nstep from the actual bunch crossing time in which they\noriginated. This is accomplished by the Bunch Crossing\nAnalyzer, which allows the Sector Processor to form\ntracks from LCTs received up to one bunch crossing\nlater than the earliest LCT.\nThe first step in the track-finding process is to\nextrapolate pairwise combinations of track-segments.\nThis is accomplished by requiring the two segments to\nbe consistent with a muon originating from the collision\nvertex and with an appropriate curvature induced by the\nnon-uniform magnetic field. A successful extrapolation\nis assigned when two stubs lie within allowed windows\nof \u03c6 and \u03b7 - neither LCT should parallel to the beam\naxis, and both should appear to originate from the\ninteraction region.\nThe Track Assembler Units (TAUs) examine\nsuccessfully extrapolated track-segment pairs to see if a\nlarger track can be formed. If so, those segments are\n\nTHHT002\n\n\fComputing in High Energy and Nuclear Physics, La Jolla, California, March 24-28, 2003\ncombined and a code is assigned to denote which muon\nstations are involved.\nA list of nine possible tracks is sent to the Final\nSelection Unit (FSU). Since different data streams may\ncontain data from the same muons, the FSU must cancel\nredundant tracks, and select the best three distinct\n\n2\n\npromising technique is to use the \u03c6 information from\nthree stations when it is available. This improves the\nresolution to approximately 22% at low momenta, which\nis sufficient. In order to achieve a three-station PT\nmeasurement, we have developed a scheme that uses the\nminimum number of bits necessary in the calculation.\n\nFigure1: Sector Processor logic principle\ncandidates.\nThe final stage of processing in the TF is the\nmeasurement of the track parameters, which includes the\n\u03c6 and \u03b7 coordinates of the muon, the magnitude of the\ntransverse momentum PT, the sign of the muon, and an\noverall quality which we interpret as the uncertainty of\nthe momentum measurement. The most important\nquantity to calculate accurately is the muon PT , as this\nquantity has a direct impact on the trigger rate and on the\nefficiency. Simulations have shown that the resolution\nof the momentum measurement in the endcap using the\ndisplacement in \u03c6 measured between two stations is\nabout 30% at low momenta, when the first station is\nincluded. (It is worse than 70% without the first station.)\nWe would like to improve this so as to have better\ncontrol on the overall muon trigger rate, and the most\nTHHT002\n\nThe first step is to do some pre-processing in FPGA\nlogic: the difference in \u03c6 is calculated between the first\ntwo track segments of the muon, and between the second\nand third track segments when they exist. Only the\nessential bits are kept from the subtraction. For example,\nwe do not need the same accuracy on the second\nsubtraction because we are only trying to untangle the\nmultiple scattering effects at low momenta. The\nsubtraction results are combined with the \u03b7 coordinate of\nthe track and the track type, and then sent into a 4 MB\nmemory for assignment of the signed PT. Tracks\ncomposed of only two track segments are allowed also in\ncertain cases.\n\n3. FIRST PROTOTYPE SYSTEM\nARCHITECTURE\n\n\fComputing in High Energy and Nuclear Physics, La Jolla, California, March 24-28, 2003\nIn the first prototype [2], the Track-Finder is\nimplemented as 12 Sector Processors that identify up to\nthe three best muons in 60\u00b0 azimuthal sectors. Each\nProcessor is a 9U VME card housed in a crate in the\ncounting house of CMS. Three Sector Receiver (SR)\ncards collect the optical signals from Muon Port Cards of\nthat sector and transmit data to the Sector Processor via a\ncustom point-to-point backplane. The SRs convert local\nCSC data into regional \u03c6 and \u03b7 coordinates to be used by\nthe Track-Finder. A maximum of six track segments are\nsent from the first muon station in that sector, and three\neach from the remaining three stations. In addition, up to\neight track segments from chambers at the ends of the\n\n3\n\nbackplane operating at 280 MHz is used for passing data\nto Sector Processor.\nEach Sector Processor measures the track parameters\n(PT, \u03c6, \u03b7, sign, and quality) of up to the three best muons\nand transmits 60 bits through a connector on the front\npanel. A sorting processor accepts the 36 muon\ncandidates from the 12 Sector Processors and selects the\nbest 4 for transmission to the Global Level-1 Trigger.\nA prototype Sector Processor was built using 15 large\nXilinx Virtex FPGAs, ranging from XCV50 to XCV400,\nto implement the track-finding algorithm, and one\nXCV50 for the VME interface (Figure 2).\n\nFigure 2: First Sector Processor prototype\nbarrel muon system are propagated to a transition board\nin the back of the crate and delivered to each Sector\nProcessor as well.\nA total of nearly 600 bits of information are delivered\nto each Sector Processor at the beam crossing frequency\nof 40 MHz (3 GB/s). To reduce the number of\nconnections, LVDS Channel Link transmitters/receivers\nfrom National Semiconductor [3] are used to compress\nthe data by about a factor of three through\nserialization/de-serialization. A custom point-to-point\n\nTHHT002\n\nThe first prototype was completely debugged and\ntested. Simulated input data or random numbers were\ntransmitted over the custom backplane to the SP, and the\nresults were read from an output FIFO. These results\nwere compared with a C++ model, and were shown to be\nin perfect agreement. The latency from the input of the\nSector Receivers [4] (not including the optical link\nlatency) to the output of the Sector Processor is 21\nclocks, 15 of which are used by Sector Processor logic.\n\n\fComputing in High Energy and Nuclear Physics, La Jolla, California, March 24-28, 2003\n\n4. SECOND (PRE-PRODUCTION)\nPROTOTYPE SYSTEM ARCHITECTURE\nAlthough the first prototype was proven a success,\nimprovements were needed in the overall Level-1\nTrigger design in order to meet the latency allowance of\n3.2 \u03bcs. Recent significant improvements in logic density\n[5] allow implementing all Sector Processor logic onto\none Xilinx Virtex-II FPGA (XC2V4000). Also, the\noptical link components have become smaller and faster;\nthus allowing the merger of three Sector Receivers and\none Sector Processor of the first prototype onto one\nsixteen-layer board (Figure 3).\nThis board accepts fifteen optical links from the\nMuon Port Cards, where each link carries information\n\n4\n\nBecause the track segment information arrives from\n15 different optical links, it is aligned to the proper\nbunch crossing number.\nThe Sector Receiver algorithm is implemented in a\nseries of cascaded look-up memories, using 45 GSI\nSRAMs [6], in order to minimize the size of SRAM\nchips required: chamber specific LCT data is sent to the\nfirst memory, this memory then sends a local\n\u03c6 measurement to two more memories which then use\nthis local \u03c6 measurement along with the original LCT\ndata to form a global \u03c6 and \u03b7 measurement for the given\nsector (figure 4).\nThe angular information for all track segments is then\npassed to the main XC2V4000 FPGA, which executes\nthe entire 3-dimentional tracking algorithm of the Sector\n\nDC-DC Converter\n\nEEPROM\n\nEEPROM\n\nPhi Global\nLUT\n\nVME/\nCCB\nFPGA\n\nEta Global\nLUT\nPhi Local\nLUT\n\nPT LUT\nMain FPGA\n\nTLK2501\nTransceiver\n\n\u2022 Xilinx Virtex-2\nXC2V4000\n\nFront\nFPGA\n\n\u2022 ~800 User I/O\n\u2022 ~4 Million Logic\nGates\n\nOptical\nTransceiver\n\nMezzanine\nCard\n\n\u202215 x 1.6\nGbit/s Links\n\nSP\n\nContains over 64\nMB of memory\n(51 SRAMs)\n\n3 SRs\n\nFigure 3: Second Sector Processor prototype\ncorresponding to one muon track segment, which is\ndescribed by a 32-bit word (two 16-bit frames). Each\nlink transmits a 32-bit word every 25 ns. Finisar's FTRJ8519-1-2.5 transceiver is used by the MPC for\ntransmission, and by the SP for reception of LCT data.\nAdditionally, the board receives up to 8 muon track\nsegments, sent using LVDS synchronous with the 40\nMHz LHC clock, from the Barrel Muon system via a\ntransition card behind the custom backplane.\n\nTHHT002\n\nProcessor. This FPGA sits on a mezzanine card on the\nSP, thus allowing for maximum design flexibility for\nfuture improvements. In the first prototype this algorithm\nrequired 15 FPGAs.\nThe output of the Sector Processor FPGA is sent to\nthe PT assignment lookup tables, also GSI SRAMS [7],\nand the results of the PT assignment for the three best\nmuons are sent via the custom backplane to the Muon\nSorter.\n\n\fComputing in High Energy and Nuclear Physics, La Jolla, California, March 24-28, 2003\nIn the second prototype Track-Finder system, we no\nlonger use Channel Links for the backplane transmission\nbecause of their long serialization/deserialization latency\nof 100 ns; rather, GTLP backplane technology is now\nused. This allows transmitting the data point-to-point\n(from Sector Processor to Muon Sorter) at 80 MHz, with\nno time penalty for serialization since the most timecritical portions of data are sent. The SP will also send\ndata to a DAQ readout board over the SP's sixteenth\noptical link. This board receives the LCT data received\nby the SP from the MPC, and final results completed by\nthe SP. The entire second prototype Track-Finder system\nfits into one 9U VME crate (Figure 5).\nThe second prototype has been designed and built,\nand is now undergoing tests. So far, the FPGAs have\nbeen successfully programmed, and the VME interface\nand the onboard databus have been validated. Successful\ntests have also been completed to verify operation of the\nTLK2501 chips on the SP. These chips have the ability\nto generate pseudo random bit streams to facilitate\ntesting of a single chip (internal loop-back test), or pairs\nof chips. In transmitting these bit streams over optical\nfibres, one TLK2501 is used to send data, and another is\n\nCLCT Patt. - 4\nQuality - 3\n1/2 Strip - 8\nL/R Bend -1\n\nPHIL LUT\n256K x 18\nFlow\nThrough\nSRAM\n\n\u03c6 local -10\n\u03c6 b local - 6\n\n5\n\nCard and a Sector Processor. The MPC sat in the same\nVME crate as the SP using a special test slot designed in\nthe custom backplane. Test routines were written which\nload test LCT patterns into the MPC input buffer, and\ntransmit a subset of these patterns over the optical links\ninto the SP. The output LCTs from the MPC were\nchecked against the SP input LCTs, and were found to be\nin agreement.\nThe original design for the optical links called for a\ncommon clock for the operation of transceivers and for\ntrigger logic; however, it is enough to have a low-jitter\nclock (e.g. from a crystal) operating at the transmitter\nfrequency, which act as a reference for the transceivers,\nand a second clock driving the SP logic; such a design\nwould allow the links to operate more robustly with\nrespect to clock jitter in the distributed LHC clock. More\ntests will be conducted between the MPC and SP to\ndetermine the most optimal clock configuration.\nFuture tests also include: operation of Sector\nReceiver memories and verification of Track-Finding\nlogic. There will also be opportunities to examine the\nfunctionality of the Sector Processor during a possible\n\n\u03c6 b local - 6\n\u03c6 local - 2\nCSC_ID - 4\n\u03b7 appr. - 7\n\nETAG LUT\n512K x 18\nFlow\nThrough\nSRAM\n\n\u03c6 b,CSC - 5\n\nPHIG LUT\n512K x 18\nFlow\nThrough\nSRAM\n\n\u03c6 CSC -12\n\n\u03b7 CSC - 7\n\nCSC_ID \u2013 4\n\u03b7 appr. \u2013 7\n\n\u03c6 local - 10\n\u03b7 appr. - 5\nCSC_ID - 4\n\nFigure 4: Sector Receiver look-up memory scheme. Here \"CLCT Patt\", \"Quality\", \"1\u20442 Strip\", \"L/R\nBend\", \"CSC_ID\", and \"\u03b7 appr.\" are variables that describe a LCT received by the Sector Receiver.\nFrom this data, \u03c6 with respect to the given chamber (\"\u03c6 local\"), and the bend angle (\"\u03c6b local\") are\nfound. These are then sent to more memories from which \u03c6 (\"\u03c6 CSC-12\") and \u03b7 (\"\u03b7 CSC-7\" ) are\nreported.\nused to receive data. Because the SP is equipped with\noptical transceivers, one can transmit and receive these\nbit streams on the same SP by utilizing multiple links.\nSuch tests were also completed between a Muon Port\nTHHT002\n\nfuture beam test, and with the use of cosmic rays.\nAll software used for testing of the second prototype\nwas written using the Hardware Access Library (HAL),\nwhich is part of the XDAQ software package from CMS\n\n\fComputing in High Energy and Nuclear Physics, La Jolla, California, March 24-28, 2003\nDAQ [8]. This library provides a global set of primitive\ncommands independent of the particular bus adapter\nused for VME communication; thus, maximizing the\nportability of command sequences generated to control a\ngiven VME hardware module. All tests performed on the\nMPC and SP used special C++ classes developed from\nthe same primitive commands. This allowed easy\ndevelopment of control scripts for two distinct VME\nmodules each with unique firmware control registers.\nThese SP control classes have been wrapped into\nspecial super-classes to be used within the XDAQ\nenvironment. This will allow communication of VME\nmodules in multiple VME crates, over a network. With\nthese XDAQ classes, one can control multiple modules,\nin multiple crates, with the use of a single interface; thus\nconcealing the control register layer offered by the\nfirmware of each hardware module from the user. These\ntools will ultimately be used for the development of a\nrun-control of the endcap system.\n\n6\n\n\u2022\n\nThe algorithms of the extrapolation and final\nselection units are reworked, and now each of them\nis completed in only one clock.\n\n\u2022\n\nThe Track Assembler Units in the first prototype\nwere implemented as external lookup tables (static\nmemory). For the second prototype, they are\nimplemented as FPGA logic. This saved I/O pins on\nthe FPGA and one clock period of latency.\n\n\u2022\n\nThe preliminary calculations for the PT assignment\nare done in parallel with final selection for all 9\nmuons, so when three best out of nine muons are\nselected, the pre-calculated values are immediately\nsent to the external PT assignment lookup tables.\n\nAll this allowed reducing the latency of the Sector\nProcessor algorithm (FPGA plus PT assignment memory)\ndown to 5 clocks (125 ns) from 15 clocks in the first\nprototype.\nDuring the construction and debugging of the first\nprototype, we encountered many problems related to the\ncorrespondence between hardware and C++ model. In\nparticular, sometimes it is very problematic to provide\n\nFigure 5: New crate layout for the Track-Finding system\n\n5. SECTOR PROCESSOR ALGORITHM\nAND C++ MODEL MODIFICATIONS\nThe Sector Processor algorithm was significantly\nmodified from that used in the first prototype in order to\nfit into one chip and reduce latency. In particular, the\nfollowing modifications were made:\n\nTHHT002\n\nthe exact matching, especially if the model uses the C++\nbuilt-in library modules, such as lists and list\nmanagement routines, etc. To eliminate these problems a\nclass library has been developed that allows one to write\nboth the simulation code and firmware in C++, and then\ntranslate this code into Verilog HDL. Thus, our code\nserves a dual purpose: it can be compiled either for\nsimulation purposes, or as the generator of the Verilog\ncode used for FPGA programming. This guarantees a\n\n\fComputing in High Energy and Nuclear Physics, La Jolla, California, March 24-28, 2003\nbit-for-bit compatible simulation. This Verilog code can\nthen be synthesized by our FPGA vendor tools and is\nused as our SP Firmware. This allows us to verify the SP\nlogic through C++ debugging tools such as MS Visual\nC++. We can also run this code as a part of the CMS\nsimulation and reconstruction framework - thus allowing\nus to use usual analysis tools for verification (e.g.\nROOT); therefore, a line-by-line correspondence is\nmaintained between simulation logic and Firmware\nlogic.\n\n6. SUMMARY\nThe design of a Track-Finder for the Level-1 trigger\nof the CMS endcap muon system is mature and has been\nsuccessfully prototyped. The design is implemented as\n12 identical processors, which cover the pseudo-rapidity\ninterval 0.9 < \u03b7 < 2.4. The track-finding algorithms are\nthree-dimensional, which improves the background\nsuppression. The PT measurement uses data from 3\nendcap stations, when available, to improve the\nresolution to 22%. The input to the Track-Finder can be\nheld for more than one bunch crossing to accommodate\ntiming errors. The latency is expected to be 7 bunch\ncrossings (not including the optical link and timing errors\naccommodation). The design is implemented using\nXilinx Virtex FPGAs and SRAM look-up tables and is\nfully programmable.\nThe first prototype was\nsuccessfully built and tested; the pre-production\nprototype has been built and is currently undergoing\ntests.\n\n7. REFERENCES\n[1] CMS Level-1 Trigger Technical Design Report,\nsection 12.4. CERN/LHCC 2000-038\n[2] D. Acosta et al. \"Development and Test of a\nPrototype Regional Track-Finder for the Level-1 Trigger\nof the Cathode Strip Chamber Muon System of CMS,\"\nNIM A496 (2003) 64\n[3] National Semiconductor, DS90CR285/286 datasheet.\n[4] D. Acosta et al. \"The Track-Finding Processor for the\nLevel-1 Trigger of the CMS Endcap Muon System.\"\nProceedings of the LEB 1999 Workshop.\n[5] Xilinx Inc., www.xilinx.com\n[6] GSI G58320Z18T datasheet\n[7] GSI GS881Z18AT datasheet\n[8] V. Brigljevic et al. \"Using XDAQ in Application\nScenarios of the CMS Experiment.\" CHEP, March 2003,\nLa Jolla, California.\n\nTHHT002\n\n7\n\n\f"}