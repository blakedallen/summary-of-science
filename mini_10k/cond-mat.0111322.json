{"id": "http://arxiv.org/abs/cond-mat/0111322v1", "guidislink": true, "updated": "2001-11-17T22:02:16Z", "updated_parsed": [2001, 11, 17, 22, 2, 16, 5, 321, 0], "published": "2001-11-17T22:02:16Z", "published_parsed": [2001, 11, 17, 22, 2, 16, 5, 321, 0], "title": "Accurate kinetic energy evaluation in electronic structure calculations\n  with localised functions on real space grids", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=cond-mat%2F0111134%2Ccond-mat%2F0111338%2Ccond-mat%2F0111569%2Ccond-mat%2F0111533%2Ccond-mat%2F0111426%2Ccond-mat%2F0111397%2Ccond-mat%2F0111504%2Ccond-mat%2F0111146%2Ccond-mat%2F0111013%2Ccond-mat%2F0111568%2Ccond-mat%2F0111023%2Ccond-mat%2F0111283%2Ccond-mat%2F0111095%2Ccond-mat%2F0111375%2Ccond-mat%2F0111301%2Ccond-mat%2F0111524%2Ccond-mat%2F0111213%2Ccond-mat%2F0111220%2Ccond-mat%2F0111246%2Ccond-mat%2F0111450%2Ccond-mat%2F0111122%2Ccond-mat%2F0111060%2Ccond-mat%2F0111350%2Ccond-mat%2F0111004%2Ccond-mat%2F0111320%2Ccond-mat%2F0111544%2Ccond-mat%2F0111526%2Ccond-mat%2F0111462%2Ccond-mat%2F0111169%2Ccond-mat%2F0111436%2Ccond-mat%2F0111322%2Ccond-mat%2F0111026%2Ccond-mat%2F0111203%2Ccond-mat%2F0111291%2Ccond-mat%2F0111225%2Ccond-mat%2F0111172%2Ccond-mat%2F0111276%2Ccond-mat%2F0111192%2Ccond-mat%2F0111424%2Ccond-mat%2F0111503%2Ccond-mat%2F0111040%2Ccond-mat%2F0111332%2Ccond-mat%2F0111494%2Ccond-mat%2F0111223%2Ccond-mat%2F0111243%2Ccond-mat%2F0111168%2Ccond-mat%2F0111080%2Ccond-mat%2F0111311%2Ccond-mat%2F0111188%2Ccond-mat%2F0111193%2Ccond-mat%2F0111066%2Ccond-mat%2F0111219%2Ccond-mat%2F0111514%2Ccond-mat%2F0111033%2Ccond-mat%2F0111566%2Ccond-mat%2F0111447%2Ccond-mat%2F0111373%2Ccond-mat%2F0111184%2Ccond-mat%2F0111129%2Ccond-mat%2F0111358%2Ccond-mat%2F0111315%2Ccond-mat%2F0111428%2Ccond-mat%2F0111558%2Ccond-mat%2F0111466%2Ccond-mat%2F0111546%2Ccond-mat%2F0111441%2Ccond-mat%2F0111132%2Ccond-mat%2F0111468%2Ccond-mat%2F0111012%2Ccond-mat%2F0111325%2Ccond-mat%2F0111160%2Ccond-mat%2F0111006%2Ccond-mat%2F0111435%2Ccond-mat%2F0111407%2Ccond-mat%2F0111200%2Ccond-mat%2F0111262%2Ccond-mat%2F0111230%2Ccond-mat%2F0111290%2Ccond-mat%2F0111423%2Ccond-mat%2F0111189%2Ccond-mat%2F0111292%2Ccond-mat%2F0111270%2Ccond-mat%2F0111056%2Ccond-mat%2F0111166%2Ccond-mat%2F0111259%2Ccond-mat%2F0111437%2Ccond-mat%2F0111481%2Ccond-mat%2F0111030%2Ccond-mat%2F0111446%2Ccond-mat%2F0111156%2Ccond-mat%2F0111179%2Ccond-mat%2F0111559%2Ccond-mat%2F0111298%2Ccond-mat%2F0111098%2Ccond-mat%2F0111476%2Ccond-mat%2F0111563%2Ccond-mat%2F0111394%2Ccond-mat%2F0111204%2Ccond-mat%2F0111491%2Ccond-mat%2F0111379%2Ccond-mat%2F0111034&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Accurate kinetic energy evaluation in electronic structure calculations\n  with localised functions on real space grids"}, "summary": "We present a method for calculating the kinetic energy of localised functions\nrepresented on a regular real space grid. This method uses fast Fourier\ntransforms applied to restricted regions commensurate with the simulation cell\nand is applicable to grids of any symmetry. In the limit of large systems it\nscales linearly with system size. Comparison with the finite difference\napproach shows that our method offers significant improvements in accuracy\nwithout loss of efficiency.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=cond-mat%2F0111134%2Ccond-mat%2F0111338%2Ccond-mat%2F0111569%2Ccond-mat%2F0111533%2Ccond-mat%2F0111426%2Ccond-mat%2F0111397%2Ccond-mat%2F0111504%2Ccond-mat%2F0111146%2Ccond-mat%2F0111013%2Ccond-mat%2F0111568%2Ccond-mat%2F0111023%2Ccond-mat%2F0111283%2Ccond-mat%2F0111095%2Ccond-mat%2F0111375%2Ccond-mat%2F0111301%2Ccond-mat%2F0111524%2Ccond-mat%2F0111213%2Ccond-mat%2F0111220%2Ccond-mat%2F0111246%2Ccond-mat%2F0111450%2Ccond-mat%2F0111122%2Ccond-mat%2F0111060%2Ccond-mat%2F0111350%2Ccond-mat%2F0111004%2Ccond-mat%2F0111320%2Ccond-mat%2F0111544%2Ccond-mat%2F0111526%2Ccond-mat%2F0111462%2Ccond-mat%2F0111169%2Ccond-mat%2F0111436%2Ccond-mat%2F0111322%2Ccond-mat%2F0111026%2Ccond-mat%2F0111203%2Ccond-mat%2F0111291%2Ccond-mat%2F0111225%2Ccond-mat%2F0111172%2Ccond-mat%2F0111276%2Ccond-mat%2F0111192%2Ccond-mat%2F0111424%2Ccond-mat%2F0111503%2Ccond-mat%2F0111040%2Ccond-mat%2F0111332%2Ccond-mat%2F0111494%2Ccond-mat%2F0111223%2Ccond-mat%2F0111243%2Ccond-mat%2F0111168%2Ccond-mat%2F0111080%2Ccond-mat%2F0111311%2Ccond-mat%2F0111188%2Ccond-mat%2F0111193%2Ccond-mat%2F0111066%2Ccond-mat%2F0111219%2Ccond-mat%2F0111514%2Ccond-mat%2F0111033%2Ccond-mat%2F0111566%2Ccond-mat%2F0111447%2Ccond-mat%2F0111373%2Ccond-mat%2F0111184%2Ccond-mat%2F0111129%2Ccond-mat%2F0111358%2Ccond-mat%2F0111315%2Ccond-mat%2F0111428%2Ccond-mat%2F0111558%2Ccond-mat%2F0111466%2Ccond-mat%2F0111546%2Ccond-mat%2F0111441%2Ccond-mat%2F0111132%2Ccond-mat%2F0111468%2Ccond-mat%2F0111012%2Ccond-mat%2F0111325%2Ccond-mat%2F0111160%2Ccond-mat%2F0111006%2Ccond-mat%2F0111435%2Ccond-mat%2F0111407%2Ccond-mat%2F0111200%2Ccond-mat%2F0111262%2Ccond-mat%2F0111230%2Ccond-mat%2F0111290%2Ccond-mat%2F0111423%2Ccond-mat%2F0111189%2Ccond-mat%2F0111292%2Ccond-mat%2F0111270%2Ccond-mat%2F0111056%2Ccond-mat%2F0111166%2Ccond-mat%2F0111259%2Ccond-mat%2F0111437%2Ccond-mat%2F0111481%2Ccond-mat%2F0111030%2Ccond-mat%2F0111446%2Ccond-mat%2F0111156%2Ccond-mat%2F0111179%2Ccond-mat%2F0111559%2Ccond-mat%2F0111298%2Ccond-mat%2F0111098%2Ccond-mat%2F0111476%2Ccond-mat%2F0111563%2Ccond-mat%2F0111394%2Ccond-mat%2F0111204%2Ccond-mat%2F0111491%2Ccond-mat%2F0111379%2Ccond-mat%2F0111034&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "We present a method for calculating the kinetic energy of localised functions\nrepresented on a regular real space grid. This method uses fast Fourier\ntransforms applied to restricted regions commensurate with the simulation cell\nand is applicable to grids of any symmetry. In the limit of large systems it\nscales linearly with system size. Comparison with the finite difference\napproach shows that our method offers significant improvements in accuracy\nwithout loss of efficiency."}, "authors": ["Chris-Kriton Skylaris", "Arash A. Mostofi", "Peter D. Haynes", "Chris J. Pickard", "Mike C. Payne"], "author_detail": {"name": "Mike C. Payne"}, "author": "Mike C. Payne", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1016/S0010-4655(01)00248-X", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/cond-mat/0111322v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/cond-mat/0111322v1", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "Standard Latex article format, 16 pages, 3 figures. Published in\n  Computer Physics Communications vol.140 (2001) pp. 315-322", "arxiv_primary_category": {"term": "cond-mat.mtrl-sci", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "cond-mat.mtrl-sci", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/cond-mat/0111322v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/cond-mat/0111322v1", "journal_reference": "Comput. Phys. Commun. 140 (2001) 315-322", "doi": "10.1016/S0010-4655(01)00248-X", "fulltext": "arXiv:cond-mat/0111322v1 [cond-mat.mtrl-sci] 17 Nov 2001\n\nAccurate kinetic energy evaluation in electronic\nstructure calculations with localised functions on\nreal space grids\nChris-Kriton Skylaris\u2217, Arash A. Mostofi, Peter D. Haynes\nChris J. Pickard and Mike C. Payne\nTheory of Condensed Matter, Cavendish Laboratory,\nMadingley Road, Cambridge CB3 0HE, UK\n\nAbstract\nWe present a method for calculating the kinetic energy of localised\nfunctions represented on a regular real space grid. This method uses\nfast Fourier transforms applied to restricted regions commensurate\nwith the simulation cell and is applicable to grids of any symmetry. In\nthe limit of large systems it scales linearly with system size. Comparison with the finite difference approach shows that our method offers\nsignificant improvements in accuracy without loss of efficiency.\n\nPublished as Computer Physics Communications 140 (2001) 315-322\n\n1\n\nIntroduction\n\nDensity functional theory (DFT) combined with the pseudopotential method\nhas been established as an important theoretical tool for studying a wide\nrange of problems in condensed matter physics [1]. However, the computational cost of performing a total-energy calculation on a system scales\n\u2217\n\nCorresponding author. Email: cks22@phy.cam.ac.uk. Fax: +44 (0)1223 337356.\n\n1\n\n\fasymptotically as the cube of the system size. Consequently, plane-wave\npseudopotential DFT can only be used to study systems of up to about one\nhundred atoms on a single workstation and up to a few hundred atoms on\nparallel supercomputers. As a result there has been considerable recent effort in the development of methods whose computational cost scales linearly\nwith system size [2].\nA common feature of many of the linear-scaling strategies is the expansion of the single-particle density matrix in terms of a set of localised\nfunctions. We refer to these functions as 'support functions' [3]. A support\nfunction is required to be non-zero only within a spherical region, which\nwe refer to as a 'support region', centred on an atomic position. Here we\nconsider a representation of the support functions in terms of a regular real\nspace grid, which constitutes our basis set. If the set of support functions is\n{\u03c6\u03b1 }, the single-particle density matrix is expressed as\n\u03c1(r\u2032 , r) =\n\nX\n\n\u03c6\u03b1 (r\u2032 )K \u03b1\u03b2 \u03c6\u2217\u03b2 (r) ,\n\n(1)\n\n\u03b1,\u03b2\n\nwhere K \u03b1\u03b2 is the matrix representation of the density matrix in terms of\nthe duals of the support functions. In general the support function set is\nnot orthonormal.\nReal space methods have the advantage that they provide a clear spatial\npartitioning of all quantities encountered in a density functional calculation,\na property that is ideal for code parallelisation. As a result, this approach\nhas gained popularity in recent years and a number of such density functional calculations have been reported by different authors [4, 5, 6]. These\napproaches use finite difference (FD) methods [7] for the calculation of the\nkinetic energy. In terms of the support functions the kinetic energy is\nET [\u03c1] =\n\nX\n\nT\u03b1\u03b2 K \u03b2\u03b1 ,\n\n(2)\n\n\u03b1,\u03b2\n\nwhere T\u03b1\u03b2 denotes kinetic energy matrix elements between support functions, given in Hartree atomic units by\nT\u03b1\u03b2 = \u2212\n\n1\n2\n\nZ\n\n\u03c6\u2217\u03b1 (r)\u22072 \u03c6\u03b2 (r)dr .\n2\n\n(3)\n\n\fThe evaluation of the kinetic energy matrix elements requires the action of\nthe Laplacian operator on the support functions. Here we will show that\nin the case of localised support functions, fast Fourier transform (FFT)\nmethods can be adapted for the application of the Laplacian, providing\nan algorithm with essentially the same computational cost as FD but with\nhigher accuracy and also ready applicability to any grid symmetry.\nIn the following two sections we present the FD method and our new\nFFT-based method and compare them both in theory and in practice.\n\n2\n\nTheory\n\nFor functions represented as values on a regular grid, integrals like the one\nof equation (3) can be calculated, or rather approximated to increasing accuracy, by a sum over grid points, as long as the value of the integrand is\nknown at every grid point:\n1 X \u2217\nT\u03b1\u03b2 \u2243 \u2212 w\n\u03c6 (ri )T\u0302 \u03c6\u03b2 (ri ) ,\n2 ri \u03b1\n\n(4)\n\nwhere T\u0302 is the Laplacian operator in the discrete representation, w is the\nvolume per grid point, and the sum formally goes over all the grid points in\nthe simulation cell.\n\n2.1\n\nFinite Differences\n\nThe most straightforward approach to the evaluation of the Laplacian operator applied to a function at every grid point is to approximate the second\nderivative by finite differences of increasing order of accuracy [7]. For example, the \u2202 2 \u03c6/\u2202x2 part of the Laplacian on a grid of orthorhombic symmetry\nis\nA/2\n\u22022\u03c6\n1 X\n(x\n,\ny\n,\nz\n)\n\u2243\nC (A) \u03c6(xi + nhx , yj , zk ) + O(hA\n(5)\ni\nj\nk\nx) ,\n\u2202x2\nh2x n=\u2212A/2 n\nwhere hx is the grid spacing in the x-direction, A is the order of accuracy\n(A)\nand is an even integer, and the weights Cn are even with respect to n,\n(A)\n(A)\ni.e. Cn = C\u2212n . This equation is exact when \u03c6 is a polynomial of degree\n3\n\n\fless than or equal to A. The leading contribution to the error is of order\nhA\nx . The full Laplacian operator for a single grid point in three dimensions\nconsists of a sum of (3A + 1) terms.\nIn principle, for well behaved functions, the second order form of equation (5) should converge to the exact Laplacian as h \u2192 0. Therefore to\nincrease the accuracy of a calculation one would need to proceed to smaller\ngrid spacings. However, in most cases of interest, this is computationally\nundesirable and instead, formulae of increasing order are used to improve\nthe accuracy at an affordable cost [8]. Chelikowsky et al. [9], in their finite\ndifference pseudopotential method, have tested the finite difference expression for up to A = 18 on calculations of a variety of diatomic molecules and\nhave suggested A = 12 as the most appropriate for their purpose, as the\nhigher orders did not provide any significant improvement.\nAlternative discretisations of the Laplacian operator are possible, such\nas the Mehrstellen discretisation of Briggs et al. [5]. This is a fourth order\ndiscretisation that includes off-diagonal terms, but only nearest neighbours\nto the point of interest. It is more costly to compute than the standard\nfourth order formula of equation (5) and it is still not clear whether its\nfourth order is sufficient. One may also use FD methods on a grid with\nvariable spatial resolution, such as that of Modine et al. [10] which is denser\nnear the ionic positions. Such a scheme, however, has the added overhead of\na transformation of the Laplacian from Cartesian to curvilinear coordinates.\nIn this paper we use only the FD scheme of equation (5).\nThe FD approach has desirable properties, both in terms of computational scaling and parallelisation. The Laplacian in the FD representation\nis a near-local operator, becoming more delocalised with increasing order.\nTherefore, the cost of applying it to N grid points is strictly linear (compared to N log N for Fourier transform methods). Also, as a result of its\nnear-locality, ideal load balancing can be achieved in parallel implementations by partitioning the real space grid into subregions of equal size and\ndistributing them amongst processing elements (PEs) while requiring little\ncommunication for applying the Laplacian at the bordering points of the\nsubregions.\n4\n\n\fIf Ns represents the size of the system, then the number of support functions will be proportional to Ns and so will the total number of grid points\nin the simulation cell, resulting in a total computational cost proportional\nto Ns2 for the application of the Laplacian on all support functions. More\nfavourable scaling can be achieved by predicting the region in space whithin\nwhich the values of a particular function will be of significant magnitude\nand operating only on this region [4, 11]. Linear-scaling can be achieved by\nstrictly restricting from the outset the support functions to spherical regions\ncentred on atoms [12]. In this case, the cost is qNs with q being the cost of\napplying the Laplacian on the points of a spherical region, which is constant\nwith system size.\nFD methods nevertheless have disadvantages that do not appear in the\nplane-wave formalism. Firstly, there is no a priori way of knowing whether\na particular order of FD approximation will be sufficient to represent a particular support function accurately. In addition, while plane-wave methods\ncan handle different symmetry groups trivially through the reciprocal lattice\nvectors of the simulation cell, real space implementations need to consider\nevery symmetry separately and require considerable modifications to the\ncode and higher computational cost. Briggs et al. [5] have demonstrated\nthis difficulty by performing calculations with hexagonal grids while most\ncommon applications of real space methods in the literature are limited to\ngrids of cubic or orthorhombic symmetry [4, 6, 9, 12].\nThe computational cost for the calculation of the Laplacian of a single\nsupport function with the FD method scales as (3A + 1)(1 + A/D)3 Nreg\nwhere Nreg is the number of grid points within the support region, and\nD is the number of grid points along the support region diameter and is\n1/3\nproportional to Nreg . This estimate of cost includes all the nonzero values\nof the Laplacian, which in general occur not only at the grid points inside\nthe support region but also at points outside, up to a distance of A/2 points\nfrom the region's boundary. It is important to include the contribution to\nthe Laplacian from outside the support region in the sum of equation (4) in\norder to obtain the best possible accuracy for a given order A and also to\nensure the Hermiticity of the discretised representation of the Laplacian, T\u0302 ,\n5\n\n\fand hence of the kinetic energy matrix elements T\u03b1\u03b2 .\n\n2.2\n\nLocalised discrete Fourier transform\n\nWe now present an accurate, linear-scaling method for calculating the kinetic energy matrix elements T\u03b1\u03b2 of equation (3). We use a mixed space\nFourier transform approach that is applicable to any Bravais lattice symmetry. Fourier transformation is a natural method to adopt for this task\nsince in a total-energy calculation one computes other terms, such as the\nelectron density and the Hartree energy, using reciprocal space techniques.\nThis implicitly defines the basis set that we use to be plane-waves and for\nconsistency we should calculate the kinetic energy using the same basis set,\ni.e. using Fourier transform methods. Thus we calculate the \u22072 \u03c6 term in\nreciprocal space, where the Laplacian operator is easy to apply, then transform the result back to real space and obtain the matrix elements T\u03b1\u03b2 by\nsummation over grid points (4). One way to achieve this would be to perform a discrete FFT on each support function \u03c6, using the periodicity of the\nentire simulation cell. However, unlike the FD algorithm, the FFT is not\na local operation and the cost of applying the Laplacian to all the support\nfunctions in this way would be proportional to Ns2 log Ns , which clearly does\nnot scale linearly with system size.\nIt is possible to overcome this undesirable scaling without compromising\naccuracy by performing the FFT over a restricted region of the simulation\ncell, which we call the 'FFT box' (figure 1). Before defining the FFT box,\nthere are two points that should be noted. Firstly, the operator T\u0302 must be\nHermitian. This will ensure that the kinetic energy matrix elements, T\u03b1\u03b2\nare Hermitian, and hence the eigenvalues real. Secondly, when calculating\ntwo matrix elements such as T\u03b1\u03b2 and T\u03b3\u03b2 , we require the quantity T\u0302 \u03c6\u03b2\nin both cases. To be consistent, our method for calculating the matrix\nelements must be such that T\u0302 \u03c6\u03b2 is the same in both cases, i.e. we require T\u0302 \u03c6\u03b2\nto have a unique and consistent representation throughout the calculation.\nIt is important that both these conditions are satisfied when it comes to\noptimisation of the support functions during a total-energy calculation, and\nwe shall return to this point later.\n6\n\n\f\u03b1\n\n\u03b2\n\nsupport region\nFFT box\nzero-padding region\n\nsimulation cell\nFigure 1: The simulation cell and an FFT box for a pair of overlapping\nsupport regions.\n\nIn order to fulfil the above requirements, it can be seen that for a given\ncalculation the FFT box must be universal in shape and dimensions. As a\nresult, it must be large enough to enclose any pair of overlapping support\nfunctions within the simulation cell. To define a suitable FFT box, we first\nconsider a box with the same unit lattice vectors as the simulation cell, but\nof dimensions such that it exactly circumscribes the largest support region\npresent in the simulation cell. We then define a box that is commensurate\nwith this, but with sides that are twice as long (and hence a volume eight\ntimes as large). This we define to be the FFT box. It is clear that this FFT\nbox is large enough to enclose any pair of support functions exhibiting any\ndegree of overlap.\nTo calculate a particular matrix element T\u03b1\u03b2 for two overlapping support\nfunctions \u03c6\u03b1 and \u03c6\u03b2 , we imagine them as being enclosed within the FFT\nbox defined above and we treat this region of real space as a miniature\nsimulation cell. We Fourier transform \u03c6\u03b2 using the periodicity of the FFT\n7\n\n\fbox and apply the Laplacian at each reciprocal lattice point using standard\nplane-wave techniques [1]. It is then a simple matter of using one more FFT\nto back-transform \u22072 \u03c6\u03b2 to real space and subsequently calculate T\u03b1\u03b2 by\nsummation over the grid points of the FFT box, according to equation (4).\nThe result obtained by this process is equivalent to performing a Fourier\ntransform of \u03c6\u03b2 over the whole simulation cell, applying the Laplacian and\nthen interpolating to a coarse, but still regular, reciprocal space grid with\nonly Nbox points, Nbox being the number of grid points in the FFT box,\nbefore back-transforming to real space. This coarse sampling in reciprocal\nspace has a negligible influence on the result because each support function\nis strictly localised in real space and therefore smooth in reciprocal space.\nIt is worth noting the implicit approximation that we make in calculating\nthe kinetic energy in the way prescribed above. In general, \u22072 \u03c6\u03b2 is nonzero\noutside the support region of \u03c6\u03b2 itself, and it is essential to take this into\naccount in the calculations. By construction, we neglect contributions to\nthe kinetic energy from support functions whose support regions do not\noverlap as we expect them to be negligibly small. This approximation may\nbe controlled via a single parameter, the FFT box size, with respect to which\nthe calculation may be converged if necessary. The same approximation is\nof course present in the FD method as well.\nWe expect certain advantages to the FFT box algorithm over FD based\nmethods. Firstly, the FFT box method should be more accurate than any\nFD scheme since it takes into account information from every single point of\nthe support function and not only locally. However, it is still perfectly local\nas far as parallelisation is concerned since we only deal with the points within\na single FFT box each time, and this constitutes a very small region of the\nsimulation cell. The parallelisation strategy in this case would still consist\nof partitioning the real space grid of the simulation cell into subregions of\nequal size and distributing them amongst PEs. Then, FFTs local to each PE\nare performed on FFT boxes enclosing pairs of overlapping support regions\nbelonging completely to the simulation cell subregion of the given PE. For\npairs of overlapping support regions containing grid points common to the\nsubregion of more than one PE, the pair would have to be attributed to\n8\n\n\fone PE and copied as a whole to it for the local FFT to proceed. This\nwould involve some communication overhead, as in the FD case for pairs\nof overlapping support functions with points in more than one subregion.\nAnother important advantage of the FFT box method is that it is applicable,\nwithout any modification, to regular grids of any Bravais lattice symmetry.\nThis is not true of FD methods.\nThe number of grid points in a cubic FFT box is Nbox (which is related to\nNreg by Nbox = 8 \u00d7 6Nreg /\u03c0 \u2243 15.3Nreg ). Therefore the computational cost\nof applying the FFT method to a single support function in such an FFT box\nis 2Nbox log Nbox , and thus for all support functions the cost is proportional\nto 2Ns Nbox log Nbox , where Nbox is independent of Ns . In other words the\ncost scales linearly with the number of atoms in the system.\n\n3\n\nTests and discussion\n\nWe have performed tests of the FD and FFT box methods for calculating the\nkinetic energy of localised functions. Choosing a particular type of support\nfunction \u03c6 with spherical symmetry, placing one at R\u03b1 and another at R\u03b2 ,\nwe rewrite the integral of equation (3) as\n1\nT (|R\u03b1 \u2212 R\u03b2 |) = \u2212\n2\n\nZ\n\n\u03c6\u2217 (r \u2212 R\u03b1 )\u22072 \u03c6(r \u2212 R\u03b2 )dr .\n\n(6)\n\nFor our first test we calculate the following quantity as a function of the\ndistance d between the centres R\u03b1 and R\u03b2\n\u03b71 (d) = Tap (d) \u2212 Tex (d) ,\n\n(7)\n\nwhere Tex (d) is the exact value of the integral in the continuous representation of the support functions and Tap (d) is its approximation on the real\nspace grid, either by FD or the FFT box method. We chose \u03c6(r) to be\na 2s valence pseudo-orbital for a carbon atom, generated using an atomic\nnorm-conserving carbon pseudopotential [13] within the local density approximation. The pseudo-orbital is confined in a spherical region of radius\n6.0 a0 , and vanishes exactly at the region boundary [14]. It is initially generated as a linear combination of spherical Bessel functions, which are the\n9\n\n\fenergy eigenfunctions of a free electron inside a spherical box. Our functions\nare limited up to an energy of 800 eV, resulting in a combination of fourteen Bessel functions. The formula for calculating kinetic energy integrals\nbetween Bessel functions is known [15] and we used it to obtain Tex (d) for\nour valence pseudo-orbital. We then calculated \u03b71 (d) with a grid spacing of\n0.4 a0 (corresponding to a plane-wave cut-off of 839 eV) in an orthorhombic\nsimulation cell, as we are restricted to do so by the FD method. With these\nparameters Nbox is 603 , and hence it is trivial to perform the FFT of one\nsupport function on a single node. \u03b71 (d) is plotted for the FFT box method\nand for various orders of the FD method in the top graph of figure 2.\nIt can be seen that low order FD methods are inaccurate as compared to\nthe FFT box method, and only when order 28 FD is used does the accuracy\napproach that of the FFT box method. The A = 12 FD scheme, the highest\norder that has been used in practice for calculations [9], gives an error of\n\u22123.97 \u00d7 10\u22125 Hartree at d = 0 as compared to 1.027 \u00d7 10\u22125 Hartree for\nthe FFT box method. The feature that occurs in the top graph of figure\n2, between d = 5 a0 and d = 7 a0 , is an artefact of the behaviour of our\npseudo-orbitals at the support region boundaries where they vanish exactly,\nbut with a finite first derivative. This causes an enhanced error in all the\nmethods when the edge of one support function falls on the centre of another.\nThe error in the FFT box method is small, yet non-zero, and we attribute this to the inherent discretisation error associated with representing\nfunctions that are not bandwidth limited on a discrete real space grid. Convergence to the exact result is observed as the grid spacing is reduced, as\nexpected.\nAs our next comparison of the FFT box and FD methods we used the\nsame pseudo-orbitals as before, but considered the quantity\n\u03b72 (d) = Tap (d) \u2212 TP W (d)\n\n(8)\n\nas the measure of the error, where TP W is the result obtained by Fourier\ntransforming the support functions using the periodicity of the entire simulation cell. One may think of TP W as being the result that would be\nobtained from a plane-wave code: the support functions may be considered\n10\n\n\f1\n\n40\n\n30\n\n\u03b71(d) / \u03bcHartree\n\n0\n20\n-1\n\n10\n\n1\n\n2\n\n3\n\n4\n\n5\n\n0\nFFT box\nA=28 FD\nA=16 FD\nA=12 FD\nA=4 FD\n\n-10\n\n-20\n0\n\n1\n\n2\n\n3\n\n4\n\n5\n\n7\n\n6\n\n8\n\n9\n\n10\n\n11\n\ndistance between pseudo-orbital centres, d / a0\n40\n\n30\n\n0.2\n0\n\n\u03b72 (d) / \u03bcHartree\n\n20\n\n-0.2\n10\n2\n\n3\n\n4\n\n5\n\n7\n\n6\n\n8\n\n0\n\n-10\n\nFFT box\nA=28 FD\nA=16 FD\nA=12 FD\nA=4 FD\n\n-20\n\n-30\n\n0\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\ndistance between pseudo-orbital centres, d / a0\n\nFigure 2: Top panel: \u03b71 (d) for a carbon 2s valence pseudo-orbital in a\nspherical support region with a radius of 6.0 a0 . Bottom panel: \u03b72 (d) for\nthe same pseudo-orbital. The insets show a magnification of the plots for\nA = 28 FD and the FFT box method.\n11\n\n11\n\n\fas generalised Wannier functions. Calculating the kinetic energy integrals\nby performing a discrete Fourier transform on the support functions over the\nentire simulation cell (an O(Ns2 log Ns ) process for all support functions) is\nequivalent to summing the contributions to the kinetic energy from all of the\nplane-waves up to the cut-off energy determined by the grid spacing. Thus\nour FFT box method can be viewed as equivalent to a plane-wave method\nthat uses a contracted basis set (i.e. a coarse sampling in reciprocal space).\nIn some ways \u03b72 (d) is a better measure of the relative accuracy of the FD\nand FFT box methods as our goal is to converge to the 'exact' result as\nwould be obtained using a plane-wave basis set over the entire simulation\ncell. \u03b72 (d) is plotted in the bottom graph of figure 2.\nTP W was computed using a cell that contained 256 grid points in each\ndimension. Increasing the cell size further had no effect on TP W up to the\neleventh decimal place (10\u221211 Hartree). The plots show that the FFT box\nmethod performs significantly better than all orders of FD that were tested.\nFor example at d = 0 the error for A = 28 FD is \u22123.49 \u00d7 10\u22126 Hartree as\ncompared to \u22121.09 \u00d7 10\u22129 Hartree for the FFT box method. The fact that\nthe FFT box error is so small shows that coarse sampling in reciprocal space\nhas little effect on accuracy, as one would expect for functions localised in\nreal space.\nOur implementation can produce similar FFT box results to the above\nin regular grids of arbitrary symmetry (non-orthogonal lattice vectors) as\nlong as we include roughly the same number of grid points in the support\nregion sphere. As we described earlier the application of the FD method to\ngrids without orthorhombic symmetry is not straightforward.\nFurthermore, in our implementation the kinetic energy matrix elements\nT\u03b1\u03b2 for both the FFT box method and the FD method (of any order) are\nHermitian to machine precision. This is a direct consequence of T\u0302 , our representation of the Laplacian operator \u22072 on the grid, being Hermitian. As\nmentioned earlier, this is an important point. The matrix elements T\u03b1\u03b2 may\nalways be made Hermitian by construction without T\u0302 itself being an Hermitian operator. This would ensure real eigenvalues, as is required. However,\nwhen it comes to optimisation of the support functions during a total-energy\n12\n\n\fcalculation, we require the derivative of the kinetic energy with respect to\nthe support function values [12]:\n\u2202ET\n\u2202ET\n1 X \u03b2\u03b1\n1 X \u03b1\u03b2 \u2217\nK T\u0302 \u03c6\u03b2 (ri ) ,\nK T\u0302 \u03c6\u03b2 (ri ) ,\n=\u2212\n=\u2212\n\u2217\n\u2202\u03c6\u03b1 (ri )\n2 \u03b2\n\u2202\u03c6\u03b1 (ri )\n2 \u03b2\n\n(9)\n\nwhere the ri are grid points belonging to the support region of \u03c6\u03b1 . These\nrelations both hold only if T\u0302 is an Hermitian operator, and support function\noptimisation can only be performed in a consistent manner if there is one\nunique representation of T\u0302 \u03c6\u03b2 for each support function \u03c6\u03b2 . It is also worth\nnoting that the evaluation of these derivatives is the reason why we prefer\nto perform the sum of equation (4) for the FFT box method in real space,\nrather than in its equivalent form in reciprocal space. Applying the FFT\nbox method in reciprocal space would be no more costly as far as integral\nevaluation is concerned but we would require an extra FFT per support\nfunction for the subsequent evaluation of equation (9).\nFor all the methods we describe in this paper we observe variation in the\nvalues of the kinetic energy integrals when we translate the system of the two\nsupport functions with respect to the real space grid. This is to be expected\nas the discrete representation of the support functions changes with the\nposition of the support region with respect to the grid. Such variations may\nhave undesirable consequences when it comes to calculating the forces on the\natoms. In FFT terminology, they result from irregular aliasing of the high\nfrequency components of our support functions as they are translated in real\nspace. Ideally, in order to avoid this effect, the reciprocal representation of\nthe support functions should contain frequency components only up to the\nmaximum frequency that corresponds to our grid spacing, in other words it\nshould be strictly localised in reciprocal space. Unfortunately this constraint\nis not simultaneously compatible with strict real space localisation. It should\nbe possible however to achieve a compromise, thus controlling the translation\nerror by making it smaller than some threshold. Such a compromise should\ninvolve an increase in the support region radii of our functions by a small\nfactor. This situation is similar to the calculation of the integrals of the\nnonlocal projectors of pseudopotentials in real space with the method of\nKing-Smith et al. [16] which requires an increase of the core radii by a\n13\n\n\ffactor of 1.5 to 2. For example, if we consider two carbon valence pseudoorbitals of support radius 6.0a0 and with d = 5.0a0 and translate them both\nin a certain lattice vector direction over a full grid spacing, the maximum\nvariation in the value of the integral with the FFT box method is 8.28\u00d710\u22126\nHartree. If we then do the same with carbon pseudo-orbitals generated with\nprecisely the same parameters but instead with a support radius of 10.0 a0 ,\nthe maximum variation with respect to translation is reduced to 2.05 \u00d7 10\u22128\nHartree.\n\n4\n\nConclusions\n\nIn conclusion, we have presented a new and easy to implement method for\ncalculating kinetic energy matrix elements of localised functions represented\non a regular real space grid. This FFT box method is based on a mixed real\nspace \u2013 reciprocal space approach. We use well established FFT algorithms\nto calculate the action of the Laplacian operator on localised support functions, whilst maintaining linear-scaling with system size and near locality of\nthe operation. This makes our FFT box method suitable for implementation in the order-N code that we are developing. We have performed tests\nof the FFT box method and various orders of FD. Comparing to the exact\nintegrals of the continuous representation, we have demonstrated that our\napproach is more accurate than low order FD approximations and only when\nA = 28 FD is used does the accuracy become comparable to that of the FFT\nbox method. We have also highlighted the connection between the FFT box\nmethod and plane-wave methods and shown that our approach is up to three\norders of magnitude more accurate than A = 28 FD when compared to the\n'exact' result within the plane-wave basis set of the entire simulation cell.\nFurthermore, our approach for calculating the kinetic energy is consistent\nwith the way in which other quantities in a total-energy calculation, such as\nthe electron density and the Hartree energy, are computed as these are also\ncalculated using reciprocal space techniques. Finally, we also note that our\nFFT box method is more versatile than FD as it is applicable to real space\ngrids based on any lattice symmetry whereas FD schemes are usually only\n14\n\n\fapplied to orthorhombic grids.\n\n5\n\nAcknowledgements\n\nC.-K. S. would like to thank the EPSRC (grant number GR/M75525) for\npostdoctoral research funding. A. A. M. would like to thank the EPSRC\nfor a Ph.D. studentship. P. D. H. would like to thank Magdalene College,\nCambridge for a Reseach Fellowship. C. J. P. would like to thank the EPSRC\n(grant number GR/N18567) for a ROPA.\n\nReferences\n[1] Payne, M. C., Teter, M. P., Allan, D. C., Arias, T. A., and Joannopoulos, J. D., Rev. Mod. Phys. 64 (1992) 1045.\n[2] Goedecker, S., Rev. Mod. Phys. 71 (1999) 1085.\n[3] Hern\u00e1ndez, E. and Gillan, M. J., Phys. Rev. B 51 (1995) 10157.\n[4] Chelikowsky, J. R., Troullier, N., Wu, K., and Saad, Y., Phys. Rev. B\n50 (1994) 11335.\n[5] Briggs, E. L., Sullivan, D. J., and Bernholc, J., Phys. Rev. B 54 (1996)\n14362.\n[6] Lee, I.-H., Kim, Y.-H., and Martin, R. M., Phys. Rev. B 61 (2000)\n4397.\n[7] Fornberg, B. and Sloan, D. M., Acta Numerica 1994, Cambridge University Press, 1994, edited by A. Iserles, pp. 203-267.\n[8] Beck, T. L., Rev. Mod. Phys. 72 (2000) 1041.\n[9] Chelikowsky, J. R., Troullier, N., and Saad, Y., Phys. Rev. Lett. 72\n(1994) 1240.\n[10] Modine, N. A., Zumbach, G., and Kaxiras, E., Phys. Rev. B 55 (1997)\n10289.\n15\n\n\f[11] Kim, Y.-H., Lee, I.-H., and Martin, R. M., Comput. Phys. Commun.\n131 (2000) 10.\n[12] Hern\u00e1ndez, E., Gillan, M. J., and Goringe, C. M., Phys. Rev. B 53\n(1996) 7147.\n[13] Troullier, N. and Martins, J. L., Phys. Rev. B 43 (1991) 1993.\n[14] Sankey, O. F. and Niklewski, D. J., Phys. Rev. B 40 (1989) 3979.\n[15] Haynes, P. D. and Payne, M. C., Comput. Phys. Commun. 102 (1997)\n17.\n[16] King-Smith, R. D., Payne, M. C., and Lin, J. S., Phys. Rev. B 44\n(1991) 13063.\n\n16\n\n\f"}