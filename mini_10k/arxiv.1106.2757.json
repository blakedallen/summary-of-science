{"id": "http://arxiv.org/abs/1106.2757v1", "guidislink": true, "updated": "2011-06-14T16:26:39Z", "updated_parsed": [2011, 6, 14, 16, 26, 39, 1, 165, 0], "published": "2011-06-14T16:26:39Z", "published_parsed": [2011, 6, 14, 16, 26, 39, 1, 165, 0], "title": "Bayesian inference from photometric redshift surveys", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1106.3848%2C1106.5332%2C1106.0595%2C1106.2550%2C1106.4007%2C1106.0924%2C1106.6138%2C1106.6324%2C1106.2665%2C1106.3090%2C1106.5712%2C1106.1133%2C1106.1051%2C1106.1586%2C1106.2281%2C1106.2395%2C1106.5575%2C1106.5983%2C1106.1455%2C1106.5168%2C1106.0958%2C1106.4639%2C1106.1171%2C1106.0631%2C1106.1388%2C1106.4111%2C1106.5375%2C1106.0240%2C1106.4719%2C1106.6095%2C1106.1756%2C1106.1417%2C1106.1151%2C1106.5791%2C1106.2757%2C1106.2014%2C1106.3157%2C1106.5560%2C1106.1232%2C1106.6348%2C1106.1946%2C1106.4690%2C1106.5678%2C1106.0900%2C1106.5862%2C1106.4932%2C1106.0167%2C1106.1381%2C1106.5919%2C1106.1218%2C1106.1706%2C1106.3617%2C1106.5584%2C1106.1327%2C1106.3904%2C1106.1194%2C1106.0106%2C1106.4366%2C1106.1163%2C1106.4367%2C1106.1287%2C1106.1976%2C1106.6039%2C1106.4548%2C1106.5306%2C1106.3947%2C1106.2329%2C1106.1582%2C1106.4567%2C1106.5112%2C1106.2869%2C1106.4951%2C1106.1547%2C1106.1559%2C1106.3140%2C1106.6344%2C1106.0284%2C1106.1956%2C1106.3937%2C1106.6064%2C1106.0539%2C1106.1132%2C1106.0385%2C1106.0059%2C1106.5233%2C1106.0569%2C1106.3255%2C1106.0846%2C1106.0457%2C1106.6084%2C1106.3809%2C1106.5430%2C1106.2015%2C1106.0459%2C1106.1300%2C1106.1961%2C1106.2569%2C1106.4029%2C1106.0151%2C1106.1506%2C1106.0505&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Bayesian inference from photometric redshift surveys"}, "summary": "We show how to enhance the redshift accuracy of surveys consisting of tracers\nwith highly uncertain positions along the line of sight. Photometric surveys\nwith redshift uncertainty delta_z ~ 0.03 can yield final redshift uncertainties\nof delta_z_f ~ 0.003 in high density regions. This increased redshift precision\nis achieved by imposing an isotropy and 2-point correlation prior in a Bayesian\nanalysis and is completely independent of the process that estimates the\nphotometric redshift. As a byproduct, the method also infers the three\ndimensional density field, essentially super-resolving high density regions in\nredshift space. Our method fully takes into account the survey mask and\nselection function. It uses a simplified Poissonian picture of galaxy\nformation, relating preferred locations of galaxies to regions of higher\ndensity in the matter field. The method quantifies the remaining uncertainties\nin the three dimensional density field and the true radial locations of\ngalaxies by generating samples that are constrained by the survey data. The\nexploration of this high dimensional, non-Gaussian joint posterior is made\nfeasible using multiple-block Metropolis-Hastings sampling. We demonstrate the\nperformance of our implementation on a simulation containing 2.0 x 10^7\ngalaxies. These results bear out the promise of Bayesian analysis for upcoming\nphotometric large scale structure surveys with tens of millions of galaxies.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1106.3848%2C1106.5332%2C1106.0595%2C1106.2550%2C1106.4007%2C1106.0924%2C1106.6138%2C1106.6324%2C1106.2665%2C1106.3090%2C1106.5712%2C1106.1133%2C1106.1051%2C1106.1586%2C1106.2281%2C1106.2395%2C1106.5575%2C1106.5983%2C1106.1455%2C1106.5168%2C1106.0958%2C1106.4639%2C1106.1171%2C1106.0631%2C1106.1388%2C1106.4111%2C1106.5375%2C1106.0240%2C1106.4719%2C1106.6095%2C1106.1756%2C1106.1417%2C1106.1151%2C1106.5791%2C1106.2757%2C1106.2014%2C1106.3157%2C1106.5560%2C1106.1232%2C1106.6348%2C1106.1946%2C1106.4690%2C1106.5678%2C1106.0900%2C1106.5862%2C1106.4932%2C1106.0167%2C1106.1381%2C1106.5919%2C1106.1218%2C1106.1706%2C1106.3617%2C1106.5584%2C1106.1327%2C1106.3904%2C1106.1194%2C1106.0106%2C1106.4366%2C1106.1163%2C1106.4367%2C1106.1287%2C1106.1976%2C1106.6039%2C1106.4548%2C1106.5306%2C1106.3947%2C1106.2329%2C1106.1582%2C1106.4567%2C1106.5112%2C1106.2869%2C1106.4951%2C1106.1547%2C1106.1559%2C1106.3140%2C1106.6344%2C1106.0284%2C1106.1956%2C1106.3937%2C1106.6064%2C1106.0539%2C1106.1132%2C1106.0385%2C1106.0059%2C1106.5233%2C1106.0569%2C1106.3255%2C1106.0846%2C1106.0457%2C1106.6084%2C1106.3809%2C1106.5430%2C1106.2015%2C1106.0459%2C1106.1300%2C1106.1961%2C1106.2569%2C1106.4029%2C1106.0151%2C1106.1506%2C1106.0505&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "We show how to enhance the redshift accuracy of surveys consisting of tracers\nwith highly uncertain positions along the line of sight. Photometric surveys\nwith redshift uncertainty delta_z ~ 0.03 can yield final redshift uncertainties\nof delta_z_f ~ 0.003 in high density regions. This increased redshift precision\nis achieved by imposing an isotropy and 2-point correlation prior in a Bayesian\nanalysis and is completely independent of the process that estimates the\nphotometric redshift. As a byproduct, the method also infers the three\ndimensional density field, essentially super-resolving high density regions in\nredshift space. Our method fully takes into account the survey mask and\nselection function. It uses a simplified Poissonian picture of galaxy\nformation, relating preferred locations of galaxies to regions of higher\ndensity in the matter field. The method quantifies the remaining uncertainties\nin the three dimensional density field and the true radial locations of\ngalaxies by generating samples that are constrained by the survey data. The\nexploration of this high dimensional, non-Gaussian joint posterior is made\nfeasible using multiple-block Metropolis-Hastings sampling. We demonstrate the\nperformance of our implementation on a simulation containing 2.0 x 10^7\ngalaxies. These results bear out the promise of Bayesian analysis for upcoming\nphotometric large scale structure surveys with tens of millions of galaxies."}, "authors": ["Jens Jasche", "Benjamin D. Wandelt"], "author_detail": {"name": "Benjamin D. Wandelt"}, "author": "Benjamin D. Wandelt", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1111/j.1365-2966.2012.21423.x", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/1106.2757v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/1106.2757v1", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "17 pages, 12 figures", "arxiv_primary_category": {"term": "astro-ph.CO", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "astro-ph.CO", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/1106.2757v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/1106.2757v1", "journal_reference": null, "doi": "10.1111/j.1365-2966.2012.21423.x", "fulltext": "Mon. Not. R. Astron. Soc. 000, 1\u201317 (2006)\n\nPrinted 24 August 2018\n\n(MN LATEX style file v2.2)\n\nBayesian inference from photometric redshift surveys\nJens\nJasche 1 ,Benjamin D. Wandelt 2,3,4\n1\n2\n3\n\narXiv:1106.2757v1 [astro-ph.CO] 14 Jun 2011\n\n4\n\nArgelander-Institut f\u00fcr Astronomie , Auf dem H\u00fcgel 71, D-53121 Bonn, Germany\nUPMC Univ Paris 06, UMR 7095, Institut d'Astrophysique de Paris, 98 bis, boulevard Arago, 75014 Paris, France\nCNRS, UMR 7095, Institut d'Astrophysique de Paris, 98 bis, boulevard Arago, 75014 Paris, France\nDepartments of Physics and Astronomy, 1110 W Green Street, University of Illinois at Urbana-Champaign, Urbana, IL 61801, USA\n\nSubmitted to MNRAS 14.06.2011\n\nABSTRACT\n\nWe show how to enhance the redshift accuracy of surveys consisting of tracers with highly\nuncertain positions along the line of sight. Photometric surveys with redshift uncertainty\n\u03b4z \u223c 0.03 can yield final redshift uncertainties of \u03b4z f \u223c 0.003 in high density regions. This\nincreased redshift precision is achieved by imposing an isotropy and 2-point correlation prior\nin a Bayesian analysis and is completely independent of the process that estimates the photometric redshift. As a byproduct, the method also infers the three dimensional density field,\nessentially super-resolving high density regions in redshift space. Our method fully takes into\naccount the survey mask and selection function. It uses a simplified Poissonian picture of\ngalaxy formation, relating preferred locations of galaxies to regions of higher density in the\nmatter field. The method quantifies the remaining uncertainties in the three dimensional density field and the true radial locations of galaxies by generating samples that are constrained\nby the survey data. The exploration of this high dimensional, non-Gaussian joint posterior is\nmade feasible using multiple-block Metropolis-Hastings sampling. We demonstrate the performance of our implementation on a simulation containing 2 \u00d7 107 galaxies. These results\nbear out the promise of Bayesian analysis for upcoming photometric large scale structure\nsurveys with tens of millions of galaxies.\nKey words: large scale \u2013 reconstruction \u2013Bayesian inference \u2013 cosmology \u2013 observations \u2013\nmethods \u2013 numerical\n\n1\n\nINTRODUCTION\n\nUnderstanding the origin and evolution of the Universe to high\nprecision requires increasing amounts of data. In particular, understanding the nature of the recently observed accelerated expansion,\nmeasuring the Baryon acoustic scale in the matter distribution or\nestablishing new standard rulers require probes of the three dimensional galaxy distribution over large volumes, out to high redshifts.\nA particularly difficult problem in galaxy observations arises from\nthe requirement of accurate redshift measurements as input to high\nprecision cosmology. Spectroscopy is the most accurate method for\nmeasuring the radial distances of galaxies along the line of sight.\nHowever, it is time-intensive and needs high photon fluxes. Therefore spectroscopic redshifts will be unavailable for the vast majority\nof the (tens of) millions of galaxies to be observed by future galaxy\nsurveys (Benjamin et al. 2010). These requirements have paved the\nway for photometric redshift (photo-z) measurements as valuable\nastronomical tools in future observations of the galaxy distribution.\nPhotometric galaxy observations can not only measure redshifts for\nfainter objects than could be yielded with spectroscopy but also\nprovide higher numbers of objects with redshift measurements per\nunit telescope time (Hildebrandt et al. 2010). Consequently, using\nphotometry rather than spectroscopy permits exploring the galaxy\ndistribution to higher redshifts at the expense of increased uncerc 2006 RAS\n\ntainty in the determination of three dimensional galaxy positions\n(Baum 1962; Koo 1986; Connolly et al. 1995; Fern\u00e1ndez-Soto et al.\n2001; Blake & Bridle 2005).\nSince major on-going and future galaxy surveys, such as DES,\nPAU, CFHTLS and the space-based EUCLID mission, will be photometric, redshift uncertainties will play an increasingly important\nrole in future observations of the large scale structure (see e.g.\nCoupon et al. 2009; Ben\u0131\u0301tez et al. 2009; Refregier et al. 2010; Frieman 2011). Nevertheless, precision cosmology requires accurate\ndistance estimates. The impact of redshift uncertainties on the inference of cosmological signals such as the baryon acoustic oscillations, cluster counts or weak lensing has been extensively discussed\nin the literature (see e.g. Huterer et al. 2004; Bernstein & Jain 2004;\nIshak 2005; Huterer et al. 2006; Ma et al. 2006; Zhan & Knox 2006;\nZhan 2006).\nIn this work we present a new Bayesian approach for redshift inference from galaxy redshift surveys with uncertain radial\nlocations of galaxies. We emphasize that our method is independent and complementary to the methods inferring photo-zs from\ncolor or morphology information, and is therefore intended to be\nused in conjunction with those. In order to increase the accuracy\nof galaxy positions our method exploits two physically motivated\nassumptions. The first assumption relies on the cosmological prin-\n\n\f2\n\nJens Jasche1 , Benjamin D. Wandelt\ndata\n\nredshift\nsampling\n\nnew redshift samples\n\nnew density sample\n\ndensity sampling\n\nFigure 1. Flow-chart depicting the two step iterative block sampling procedure. First a set of galaxy redshift reconstructions is sampled conditional on the last\ndensity field. In a second step, a density field sample is generated conditional on the new galaxy redshifts, assuming them to be related to the density field\nthrough log-normal Poisson statistics.\n\nciple which states that the Universe should be homogeneous and\nisotropic. For this reason, the covariance matrix of the matter distribution in Fourier space is of diagonal shape, at least at the largest\nscales, with the diagonal being the cosmological power-spectrum.\nAs a consequence, the sampler searches for galaxy redshift configurations which are compatible with an isotropic matter distribution.\nSecondly, we exploit a simplified physical picture of galaxy formation, which states that galaxies predominantly form in regions of\nhigher density.\nIn practice neither the three dimensional matter field nor the\nexact galaxy positions are known a priori. We must infer the three\ndimensional density field together with the locations of galaxies.\nIn so doing, we account for the mutual dependences and correlated\nuncertainties of the inferred density field and galaxy positions, and\nshow that the joint treatment can enhance their mutual inference.\nIn order to perform a full joint Bayesian analysis of the three\ndimensional density field and the redshifts of galaxies we implement a two step Markov sampling process as depicted in figure 1,\nwhich permits to explore the high dimensional non-Gaussian joint\nposterior distribution in a numerically efficient way. In particular,\nwithin the framework of a multiple block Metropolis-Hastings sampler, we are able to break up the high dimensional problem in a\nset of lower dimensional problems which can then be treated iteratively (Hastings 1970). This sampling approach permits us to\nproduce data-constrained samples of the three dimensional density\nfield and galaxy redshifts for photo-z surveys with tens of millions\nof galaxies in a numerically efficient way.\nIn this work we are particularly interested in the final redshift\nuncertainties, which are output as sampled probability densities of\ngalaxy redshifts constrained by the observations and incorporating\nthe isotropy prior. These results improve estimates for the radial\nlocations of galaxies and quantify the remaining uncertainties.\nThe paper is structured as follows. In section 2 we give a brief\noverview and introduction to the method presented in this work.\nA brief overview of photo-z estimators which generate the input\nneeded for our work is provided in appendix A. The density field\nsampling step and the corresponding log-normal Poissonian model\nfor the density field is briefly discussed in section 3. Since this sampling step has already been solved within the HADES (Hamiltonian Density Estimation and Sampling) algorithm a more detailed\ndescription can be found in Jasche & Kitaura (2010) and Jasche\net al. (2010). The redshift sampling process and the derivation of\n\nthe corresponding conditional redshift posterior distribution is discussed in section 4. In section 5 we describe the generation of the\nmock data used in our tests.\nThe performance of our multi dimensional Metropolis Hastings sampler in a realistic setting is studied in section 6. Here we\nstudy the overall burn-in and convergence behavior of the Markov\nsampler. In section 7 we discuss the results for the inferred redshifts\nand three dimensional density fields. Finally, in section 8, we discuss our results and give an outlook on future improvements and\napplications of our work.\n\n2\n\nMETHOD\n\nThe method presented in this work aims at the joint inference\nof radial locations of galaxies as well as three dimensional density fields from observations with uncertain redshift measurements.\nIn particular, we are interested in exploring the joint probability\nP({si }, {z p }|{zobs\nn }, {\u03b8n }) of the real-space density field {si } and the\ntrue redshift positions of galaxies {z p } conditional on the observed\nredshifts {zobs\nn } and the positions in the sky {\u03b8n }, which is a set containing the declination and right ascension angles for all galaxies.\nThe exploration of the joint probability distribution is numerically\nchallenging partly due to high dimensionality but also because the\nproblem requires non-linear and non-Gaussian inference methods.\nIn situations like this, one usually has to rely on efficient implementations of a Metropolis Hastings sampling scheme. However,\nit may be difficult to construct a single block Markov algorithm\nwhich converges rapidly to the target distribution.\nFortunately, it is possible to break up the parameter space\ninto smaller blocks and to construct transition kernels for each individual block (Hastings 1970). Consequently this multiple block\nsampling framework permits to to build complex transition kernels\nfor the joint problem. This approach greatly simplifies the search\nfor suitable candidate-generating densities and enables us to use\nthe previously developed non-linear log-normal Poissonian density\nsampler, presented in (Jasche & Kitaura 2010; Jasche et al. 2010),\nin conjunction with a new redshift sampler described in this work.\nThis block sampling approach was also at the heart of the Gibbs\nsampler for cosmic microwave background (CMB) power spectrum\ninference originally proposed in Wandelt et al. (2004) and Jewell\net al. (2004) which is now widely used.\nWe can explore the joint posterior distribution by iteratively\nc 2006 RAS, MNRAS 000, 1\u201317\n\n\fBayesian inference from photometric redshift surveys\ngalaxy number counts\n\ngalaxy number counts\n\nx [Mpc]\n\nx [Mpc]\n\nx [Mpc]\n\ny [Mpc]\n\nln(2 + \u03b4)\n\n3\n\nFigure 2. Slices through the mock matter field realization (left panel), the mock galaxy survey generated from the mock matter field without distorted redshifts\n(middle panel) and the redshift distorted mock galaxy survey (right panel). It is clearly visible that all small scale structures are smeared out along the line of\nsight in a survey with photo-z errors of \u223c 0.03.\n\nsampling from the two conditional distributions\n1)\n2)\n\n{z p }\n\n{si }\n\n( j+1)\n\n( j+1)\n\nx P({z p }|{si }\n\n( j)\n\n, {zobs\np }, {\u03b8 p }) ,\n\nx P({si }|{z p }( j+1) , {zobs\np }, {\u03b8 p }) ,\n\n(1)\n\nwhere in the first step we draw a random realization of radial galaxy\npositions {z p } and in a second step we generate a three dimensional\ndensity field sample {si }. The iteration of these two random processes will provide us with samples of the joint posterior distribution. A schematic description of the sampling procedure is depicted\nin figure 1.\n\n3\n\nTHE LOG NORMAL POISSONIAN MODEL\n\nThe log-normal Poissonian posterior distribution is formulated in\nterms of galaxy number counts, rather than in terms of galaxy redshifts and positions in the sky. As demonstrated in appendix B, the\ndensity posterior distribution given in equation (1) can be written\nas a function of galaxy number counts\nn \u0010\n\u0010\n\u0011o\u0011\nP({si }|{z p }, {zobs\n= P {si }| Ni {z p }, {\u03b8 p } ,\n(2)\np }, {\u03b8 p })\n\u0010\n\u0011\nwhere the number counts Ni {z p }, {\u03b8 p } are calculated according to\nequation (B10). Following Jasche & Kitaura (2010), the log normal\nPoissonian posterior distribution can then be expressed as:\n1\n\nP({si }|{Ni })\n\n=\n\ne\u2212 2\n\n\u00d7\n\nP\n\n\u22121\ni j (ln(1+si )+\u03bci )Qi j\n\n\u221a\n|2\u03c0Q|\n\n(ln(1+s j )+\u03bc j ) Y\nl\n\n1\n1 + sl\n\n\u0010\n\u0011N g\nY Rk N\u0304(1 + B(s)k ) k e\u2212Rk N\u0304(1+B(s)k )\nk\n\nNkg !\n\n,\n\n(3)\n\nwhere Q is the covariance matrix of the log-normal distribution, \u03bci\ndescribes a constant mean field, Rk is a linear response operator, incorporating survey geometries and selection effects, N\u0304 is the mean\nnumber of galaxies in the volume and B(x)k is a non-linear, non\nlocal, bias operator at position ~xk . In this fashion the log-normal\nPoissonian distribution accounts for non-linearities in the density\nfield, the local noise structure of the galaxy distribution as well as\nc 2006 RAS, MNRAS 000, 1\u201317\n\nsystematic uncertainties due to survey geometry, selection effects\nor galaxy biasing.\nThe log-normal posterior distribution incorporates essentially\ntwo physically motivated assumptions which are important for the\nmethod described in this work. Due to the cosmological principle\nwe will assume the matter distribution in real-space to be statistically isotropic. This is incorporated in the posterior distribution\nin equation (3) by noting, that the Fourier transform of the covariance matrix Q for the logarithmic density field is assumed to have\na diagonal form with the diagonal being the power-spectrum which\ndepends on the |k| only. This assumption requires the individual\ndensity field samples to be statistically isotropic. In addition the\nPoisson model can be considered as a simplified model for galaxy\nformation, which relates the number of galaxies found at a given\nposition to the underlying density field, and hence singles out preferred locations for galaxies conditional on the underlying density\nfield. Thus, in the absence of additional constraining information,\nthese physical requirements enhance the inferred redshifts from observations with uncertain radial locations of galaxies.\nFor a detailed description on the numerical implementation\nof the large scale structure sampler we refer to Jasche & Kitaura (2010). Unlike conventional Metropolis Hastings algorithms,\nwhich move through the parameter space by a random walk, and\ntherefore require prohibitive amounts of steps to explore high dimensional spaces, the HMC sampler suppresses random walk behavior by introducing persistent motions of the Markov chain\nthrough the parameter space (Duane et al. 1987; Neal 1993, 1996).\nIn this fashion, the Hamiltonian sampler maintains a reasonable efficiency even for high dimensional problems (Hanson 2001).\n\n4\n\nTHE REDSHIFT POSTERIOR DISTRIBUTION\n\nIn the following we will focus on the derivation and implementation of the second sampling step in figure 1, namely of generating\nrandom realizations of true galaxy redshifts {z p } conditional on observations and a realization of the three dimensional density field.\nIn particular we are searching for a numerically efficient implementation of the random process\n{z p } x P({z p }|{si }, {zobs\np }, {\u03b8 p }) .\n\n(4)\n\n\fJens Jasche1 , Benjamin D. Wandelt\n\ny [Mpc]\n\ngalaxy number counts\n\n4\n\nx [Mpc]\n\nx [Mpc]\n\nx [Mpc]\n\nFigure 3. Slices through three successive galaxy count samples, first sample (left panel), fifth sample middle panel and 100th sample (right panel). The first\nsample shows prominent redshift smearing which quickly decay in subsequent samples.\n\nThis problem is numerically challenging due to the high dimensionality, i.e. the number of galaxies in a survey. Additionally, the\nnon-linearity of the problem generally prevents drawing samples\ndirectly from the redshift posterior distribution given in equation\n(4). Hence, in order to explore the space of possible galaxy redshift\nconfigurations we have to rely on a Metropolis-Hastings sampler. A\nnaive implementation of the redshift sampling process might suggest drawing a realization for the whole set {z p } at once. Such a\nscheme will lead to a high rejection rate, rendering such a method\nnumerically unfeasible. Suppose, for example, that the sampler proposes a redshift configuration {z p } which is acceptable except for\none galaxy redshift zn . Although most of the galaxy redshifts could\nbe accepted in this scenario the complete set {z p } would be rejected\nand the sampler stays at its current position in parameter space. For\nthis reason, such a sampling approach would require to construct a\nvery good proposal distribution for P({z p }|{si }, {zobs\np }, {\u03b8 p }) in order\nto yield efficient sampling rates. Generally it is not trivial and may\neven be impossible to construct such a proposal distribution.\nIf it were possible to find conditional redshift posterior distributions for each individual galaxy redshift zn , one could build a\nmultiple block Metropolis-Hastings sampler for the set of galaxy\nredshifts {z p }.\nFortunately, this is possible in our simple, Poissonian\ngalaxy formation model. As demonstrated in appendix B it\nis possible to find a conditional redshift posterior distribution\nP(zn |{u p }, {si }, {zobs\np }, {\u03b8 p }) such that a multiple block MetropolisHastings sampler can be constructed.\nGalaxy redshifts can therefore be updated by sampling\nP({z p }|{si }, {zobs\np }, {\u03b8 p }) using the following random process\n1)\n2)\n3)\n.\n\nz(1j+1) x P(z1 |{u p }1 , {si }, {zobs\nn }, {\u03b8n })\n\nz(2j+1) x P(z2 |{u p }2 , {si }, {zobs\nn }, {\u03b8n })\n\n(6)\n\nwhich is also shown in appendix B. This is particularly interesting\nfor the numerical implementation of the random process given in\nequation (5), since it permits parallel, instead of sequential, sampling.\nThe computational advantage of sampling each galaxy redshift individually can be immediately realized. Even if some individual redshift proposals are rejected, other redshift samples will\nbe accepted leading to an overall larger acceptance probability for\nthe entire set {z p }, compared to the scenario where {z p } would be\nsampled as a whole. Additionally, the multidimensional sampling\napproach can be reduced to a one dimensional sampling problem\nfor each sampling step described in equation (5), as the redshift is\nexplored along each line of sight.\nThe detailed form of the conditional redshift posterior is (Appendix B)\nP(zn |{\u03b8 p }, {si }, {zobs\np })\n\n\u221d\n\n\u2202r(z)\nr(zn )2\n\u2202z z=zn\nX\n\u0010\n\u0011\n\u00d7\nW(~xi \u2212 ~xn ) Ri N\u0304(1 + B(s)i )\ni\n\n.\nz(Nj+1) x P(zN |{u p }N , {si }, {zobs\nn }, {\u03b8n }) ,\n\nobs\nP(zn |{u p }, {si }, {zobs\np }, {\u03b8 p }) = P(zn |{si }, {z p }, {\u03b8 p }) ,\n\n\u00d7 P(zobs\nn |\u03b8n , zn , {si }) .\n\nz(3j+1) x P(z3 |{u p }3 , {si }, {zobs\nn }, {\u03b8n })\n\n.\nN)\n\nof galaxy redshifts {u p } have to be updated after each sampling\nstep, since the next sampling step depends on the new position of\nthe previously sampled galaxy. The conditional redshift posteriors\nP(zn |{u p }, {si }, {zobs\nn }, {\u03b8n }) describes the probability for the redshift\nzn of the nth galaxy redshift conditional on the redshifts of all other\ngalaxies, the density field, the observed redshifts and the positions\nin the sky.\nAt this point an important further simplification occurs. Given\nthe density field s, the redshifts any one galaxy zn is conditionally\nindependent of the redshifts of all the other galaxies, so\n\n(5)\n\nwhere for each transition we use a Metropolis-Hastings update\nstep and {u p } = {z p }/zn is the set of galaxy redshifts containing all redshifts except the redshift zn of the nth galaxy under\nconsideration. The superscripts i at the {u p }i indicate that the set\n\n(7)\n\nwhere r(z) is the radial co-moving distance as a function of redshift\nz and W(~x) is the voxel kernel function, as defined in Appendix B.\nSince the Metropolis-Hastings algorithm does not require a probability distribution to be normalized in order to generate samples,\nwe omitted all normalization constants in equation 7.\nThe first factor in equation (7) is just the Jacobian of the coordinate transformation from spherical redshift to Cartesian comoving coordinates, which is required since the density field is\nc 2006 RAS, MNRAS 000, 1\u201317\n\n\f5\n\nzip\n\nBayesian inference from photometric redshift surveys\n\nzp\n\nzp\n\nzp\n\nFigure 4. Correlation between the true redshift z p and the redshifts of the ith sample zip for three successive samples, tenth sample (left panel), 100th sample\nmiddle panel and 5000th sample (right panel). It can be seen that in successive samples the correlation gets stronger as the galaxies move towards their true\nlocations.\n\ndefined in co-moving Cartesian coordinates. The second factor, is\nessentially the intensity function for the spatial Poisson process, as\ndescribed in section 3. It reflects the naive intuition, that the probability of finding a galaxy at a given spatial location should be related to the underlying density field. Also note, that the conditional\nredshift posterior distribution accounts for non-linear and non-local\ngalaxy biasing B(s)i , as well as for the systematics of the survey\nunder consideration via the survey response operator Ri , which incorporates survey geometry and selection functions. The last factor\nin (7) is the photo-z likelihood encoding the information about the\nredshift zobs\nn for the nth galaxy determined by a a photo-z estimator. Since galaxy redshifts are determined separately for individual\ngalaxies it is reasonable to assume that these likelihoods are independent of the observed redshifts of all other galaxies, meaning the\nredshift likelihood for an individual galaxy does not depend on the\nredshift observations of other galaxies.\nWe emphasize that so far we made no specific assumptions\nregarding the photo-z likelihood. The aim of this work is to find a\nphysically meaningful way of increasing the accuracy of redshift\ninference once all other, color or spatial information has been used.\nThis is achieved by the two first factors in equation (7) which could\nbe considered as a redshift prior once the underlying density field is\nknown. Thus, the joint sampling approach for the density field and\nthe galaxy redshifts described in section 2 provides us with samples\nof the joint distribution. Discarding the density fields then amounts\nto a Monte-Carlo marginalization over the underlying three dimensional density fields and provides us with the redshift posteriors for\nall galaxies conditional only on the data and the isotropy prior.\nIt is important to remark, that since no specific assumptions\non the redshift likelihood are required, and since we are using a\nsampling approach, our method will in principle work with any\nspecified redshift likelihood, or input photo-z pdf. Our method is\ntherefore intended to be used as a complement to any photo-z estimator which use galaxy-specific information such as a photometry\nor morphology to provide a photo-z pdf.\nFor this reason, our method is highly flexible and therefore\nbroadly applicable to various different scenarios and galaxy observations.\nc 2006 RAS, MNRAS 000, 1\u201317\n\n5\n\nGENERATING MOCK OBSERVATIONS\n\nIn the previous sections we presented the derivation and the implementation of our method. Here we will describe the generation of\nartificial mock data sets, which will be used later to test our method.\n5.1\n\nGenerating galaxy redshifts\n\nThe generation of a artificial mock galaxy survey will closely follow the description in Jasche & Kitaura (2010). Since galaxies trace\nthe three dimensional matter distribution and since in this work we\nare interested in recovering the true redshift locations of galaxies\nfrom redshift surveys with uncertain radial locations of galaxies,\nwe prefer using a density field simulated from an N-body simulation rather than a log-normal realization. Such a density field permits us to test our method in a more realistic scenario, since the\nmock density field contains structures, such as voids, filaments and\nclusters.\nFor this reason, we build our mock galaxy observation on a\nmatter field realization calculated by the tree-PM code GADGET2 (Springel 2005), starting from Gaussian initial conditions. The\ndetails of this simulation are described in Pillepich et al. (2010).\nWe estimated the simulated matter density field on a 2563\nCartesian equidistant grid with side length of 1200 Mpc, using the\nCloud in Cell (CIC) kernel and the super-sampling procedure described in Jasche (2008) to account for aliasing effects. Note that\nwe do not take peculiar velocities into account when mapping into\nredshift space, since any such distortion will be negligible for photometric survey data.\nGiven this density field we can then generate Poisson realizations, taking into account several survey properties such as noise,\nsurvey geometry and selection effects. In figure 2 we show slices\nthrough the true underlying matter field realization and the simulated redshift survey.\nThe survey properties are described by the galaxy selection\nfunction F j and the observation Mask M j where the product\nRj = Fj Mj\n\n(8)\n\nyields the linear response operator R j of the galaxy survey at the\njth volume element.\nThe toy selection function, used in our tests, is given by\n\n\fJens Jasche1 , Benjamin D. Wandelt\n\nP(k)\n\n6\n\nk [h/Mpc ]\nFigure 5. Power-spectra P(k) of successive samples during the burn-in phase. It can be seen that the samples move towards the true power-spectrum (black\ncurve) of the matter field realization.\n\n\uf8f1\n1\n\uf8f4\n\uf8f4\n\uf8f2 ( (r j +1\u2212rth )\u03b2 ) for r j >= rth\nFj = \uf8f4\n\uf8f4\n\uf8f3\n1 else\n\n(9)\n\nwhere r j is the co-moving distance from the observer to the center\nof the jth voxel. For our simulation we chose parameters \u03b2 = 0.25\nand rth = 100 Mpc. The observation Mask M j is the same as described in Jasche & Kitaura (2010). It was designed to approximate\nthe most prominent features of the Sloan Digital Sky Survey geometry (Abazajian et al. 2009). As a result of the Poisson sampling of\nthe density field we obtain galaxy number counts N j at each gridpoint in the three dimensional domain.\nNext, in order to assign redshifts to the galaxies, all the N j\ngalaxies inside the jth volume element are uniformly distributed\nover the volume element to offset them from the center position.\nThis process does not destroy the Poissonian process by which the\ngalaxy sample was realized, since it does not change the number of\ngalaxies inside the volume element. Given an assumed cosmology\nwe can then calculate the redshift z p and the two angular positions\n\u03b8n for each galaxy. In particular, we assumed a standard \u039bCDM\ncosmology corresponding to the following set of cosmological parameters (\u03a9m = 0.24, \u03a9\u039b = 0.76, \u03a9b = 0.04, h = 0.73, \u03c38 = 0.74,\nn s = 1 ).\nAt the end of this procedure we obtained a set of real-space\ngalaxy positions {\u03b8n , z p } for Ngal = 21340276 galaxies.\n\n5.2\n\nIntroducing redshift uncertainties\n\nIn the previous section we described how to obtain a set of unperturbed galaxy redshifts given a specific density field. Here we will\ndescribe how to generate the observed photo-z uncertainties.\nNote, that until now we have not specified a specific redshift\nlikelihood. The method presented in this work is general, and does\nnot need to make any specific assumptions about the functional\nshape of the redshift likelihood. This is due to our sampling approach which permits us to use any desired redshift likelihood.\nIn this work we will assume that the uncertainty in the observed redshifts is due to the observational strategy, i.e.. due to the\ninstrument. The redshift likelihood is therefore independent of the\n\nunderlying density field\nP(zobs\nn |\u03b8n , zn , {si })\n\n=\n\nP(zobs\nn |zn ) .\n\n(10)\n\nAlthough it is possible to use an arbitrary redshift likelihood, here\nwe will employ a truncated Gaussian distribution given as\n\nP(zobs\nn |zn )\n\n=\n\n2\nobs\n\u0010 \u0011 \u2212 21 (zn \u2212z2 n )\nobs\n\u03c3z\n\u0398 zn e\n!\n!,\nq\nzn\n\u03c0 2\n\u221a\n\u03c3\nerf\n+\n1\n2 z\n2\n\n(11)\n\n2 \u03c3z\n\nwhere \u03c3z is the photo-z dispersion. This simple distribution permits\nus to test our method and to estimate its general performance. Given\nthe true redshift zn generated via the procedure described in section\n5.1 and by specifying a desired redshift dispersion \u03c3z , the observed\nredshift zobs\ncan be generated by drawing random samples from\nn\nthe truncated Gaussian distribution, given in equation (11), via rejection sampling. We distort the redshift of each individual galaxy\nfollowing this recipe.\nFor the test case considered in this work we treat all galaxies\nwith the same \u03c3z = 0.03. Since we are able to treat each galaxy\nindividually, there is no problem in specifying a different photo-z\nlikelihood for every galaxy. The possibility of modeling heterogenous data sets with photo-z pdfs that differ from galaxy to galaxy\nis very interesting since it allows incorporating detailed uncertainty\ninformation from photo-z estimators which could take into account\ncolor or morphological information. It would also be possible to\nmerge data sets with different redshift accuracies, including spectroscopic surveys. We will explore these promising ideas in future\nwork.\nThe process of generating a galaxy distribution with redshift\ndistortions corresponding to the likelihood given in equation (11) is\nvisualized in figure 2. It can be seen that given a redshift dispersion\nof \u03c3z = 0.03 structures along the line of sight are smeared out on a\nscale of roughly \u223c 100 Mpc.\nIn the following we will apply our method to this mock survey.\nc 2006 RAS, MNRAS 000, 1\u201317\n\n\f7\n\nzip\n\nln(2 + \u03b4)\n\nBayesian inference from photometric redshift surveys\n\nn [1000 samples]\nFigure 6. The plot shows the trajectory of a randomly selected galaxy along the line of sight as a function of the sampling step n in the Markov chain (blue\ndashed line). The background displays the density field along the line of sight in each sampling step. It can be seen that the galaxy jumps preferentially between\ndifferent regions of higher density in the range allowed by the redshift likelihood from a photo-z estimator.\n\n6\n\nTESTING\n\nIn this section we will apply our method to our mock survey in order to estimate its performance. In particular, we focus on the convergence behavior of the sampler which determines the efficiency\nof the method in a realistic setting.\n\n6.1\n\nTesting convergence and correlations\n\nThe Metropolis Hastings Sampler is designed to have the target\ndistribution, in our case the joint posterior distribution, as its stationary distribution (see e.g. Metropolis et al. 1953; Hastings 1970;\nNeal 1993). For this reason, the sampling process will provide us\nwith samples from the specified joint posterior distribution after a\nsufficiently long burn-in phase. However, the theory of Metropolis\nHastings sampling by itself does not provide any burn-in criterion.\nTherefore, this initial burn-in behavior has to be tested using numerical experiments.\nBurn-in manifests itself as a systematic drift of the sampled\nparameters towards the true parameters from which the artificial\ndata set was generated. We monitor it by following the evolution of\nparameters in subsequent samples.\nAs an example, in figure 3 we show slices through galaxy\nnumber counts calculated from successive redshift samples. While\ninitially the galaxy distribution exhibits prominent redshift distortions, successive samples iteratively correct the galaxy positions\ntowards their true real-space positions. Visually, already the 100th\nsample does not seem to be contaminated by redshift distortions. In\norder to demonstrate that galaxies are really moving towards their\ntrue real-space positions during the burn-in phase, we can study the\ncorrelation of the sampled redshifts with the true galaxy redshifts\nfor successive samples. The results of this test is presented in figure\n4. Here it can be seen, that the correlation between the sampled and\nthe true redshifts tightens throughout successive samples. Figure 4\nalso clearly demonstrates the ability of our method significantly to\nenhance the constraints on the true galaxy redshifts from photo-z\nsurveys.\nThese aforementioned diagnostics particularly focus on monc 2006 RAS, MNRAS 000, 1\u201317\n\nitoring the burn-in behavior of the redshift samples. In order to\nprobe the evolution of density samples we monitor power-spectra\nestimated from successive density samples. As the galaxies move\ntowards their true locations these successive power-spectra will\ndrift towards the power-spectrum of the underlying mock matter\nfield realization. These successive power-spectra are depicted in\nfigure 5. As can be clearly seen, successive power-spectra move towards the true power-spectrum of the underlying mock matter field\nrealization. In summary these tests indicate that the initial burn-in\nphase requires on the order of 5000 samples.\nNext we will discuss the general convergence behavior of the\nredshift samples in particular the correlation structure. In general,\nsuccessive samples in a Markov chain are not independent, but are\ncorrelated with previous samples. In order to estimate how many\nindependent samples are generated by the Markov chain one has\nto study this correlation effect. This can be done by following a\nsimilar approach as described in (Eriksen et al. 2004) or (Jasche\net al. 2010) by assuming all individual galaxy redshifts zil in the\nMarkov chain to be independent and estimating their correlation in\nthe chain by calculation of their autocorrelation function\n\nCl (n) =\n\n*\n\n+\n\u2212 hzl i\nzil \u2212 hzl i zi+n\nl\n,\n\u221a\n\u221a\nVar(zl ) Var(zl )\n\n(12)\n\nwhere n is the distance in the chain measured in iterations. In figure 7 we show the autocorrelations of redshift samples for several\nrandomly selected galaxies. We can further define the correlation\nlength of the redshift sampler as the distance in the chain nC beyond\nwhich the correlation coefficient Cl (n) has dropped below 0.1. As\ncan be seen in figure 7 the correlation length is less than 200 samples, which demonstrates the high mixing rate of the sampler.\nDespite the high dimensionality of the problem considered\nhere, these tests demonstrate that the joint posterior of galaxy redshifts and three dimensional density field can be explored in a numerically feasible way by our method.\n\n\fJens Jasche1 , Benjamin D. Wandelt\n\nC l(n)\n\n8\n\nn [distance in the chain]\nFigure 7. Correlation functions Cl (n) as a function of distance in the Markov chain n for ten randomly selected galaxies. It can be seen that the correlation\nlength between the samples in the chain is on the order of 200 samples.\n\n7\n\nRESULTS\n\nIn the previous section we demonstrated the ability of our method\nto efficiently explore the joint parameter space of the three dimensional density field and the true redshifts of galaxies from redshift\nsurveys with uncertain radial location of galaxies.\nThe algorithm will identify high density regions in volume elements where the number counts of galaxies is high. In this fashion,\nthe information of the entire galaxy sample is used to infer the 3D\ndensity field. In turn, the inference of individual galaxy redshifts\nuses this reconstructed 3D density field as described in section 4.\nTherefore information propagates from the entire galaxy sample to\nreduce the redshift uncertainties of each individual galaxy.\nIn successive Markov samples individual galaxies will preferentially move to regions of higher density within the range allowed\nby the photo-z inference. For this reason, a worry might be that the\ngalaxy get stuck and not move any further once it found a density\npeak. We find that this does not occur since our burn-in and autocorrelation tests show that galaxies quickly find and explore their\nredshift range.\nIt is illustrative to follow the trajectory of an individual galaxy\nalong its line of sight throughout successive samples. Generally, in\neach sample step both, the density field along the line of sight and\nthe galaxy redshift, will change. In figure 6 we show the trajectory\nof a random galaxy and the evolution of the corresponding density\nfield along the line of sight for 1000 samples. It can be seen that the\ngalaxy preferentially moves to regions with densities higher than\nthe mean density and avoids underdense regions. Also the galaxy\nstays longer in regions of higher density, which correspond to regions of higher probability, than in other regions.\nThis is the anticipated behavior of the Markov sampler, which\nis supposed to provide more samples of high probability regions\nand less samples in regions of lower probability in order to construct a probability density.\nNext, we want to discuss the final scientific results of the sampling procedure. In particular, we are interested in the accuracy\nof the inferred galaxy redshifts. Intuitively, the accuracy of the inferred redshifts should depend on the environment at the galaxies'\noriginal location. Galaxies born in high density regions will be attracted by a high density peak along their line of sight, while galaxies born in low density regions have fewer constraints. In the limit\n\nof very low density the galaxy will explore the full range allowed\nby the input photo-z likelihood along the line of sight.\nHigh density regions are better sampled by galaxies, which\nfurther decreases the uncertainty for the inferred density field at\nthese positions, which results in an overall higher joint probability\nfor the density field and galaxy redshifts at these locations. For this\nreason, redshifts of galaxies located in high density regions such as\nclusters or super clusters will generally be recovered more precisely\nthan those of galaxies in regions with lower density.\n\n7.1\n\nRedshift samples\n\nTo demonstrate this effect and to see which regions can be best\nrecovered from a redshift survey with uncertain radial locations of\ngalaxies, we study the average redshift standard deviation as a function of the true underlying density field \u03b4true\nP\np\np \u03c3 p K(\u03b4true \u2212 \u03b4true )\n,\n(13)\nh\u03c3z i(\u03b4true ) = P\np\np K(\u03b4true \u2212 \u03b4true )\n\np\nwith \u03b4true\nbeing the true density contrast at true location of the pth\ngalaxy, \u03c3 p is the galaxy redshift standard deviation calculated from\nthe samples and K(x) is the binning kernel as defined in equation\nB9. Equation (13) yields the redshift standard deviation measured\nfrom the Markov chain averaged over density bins of the true underlying mock matter-field realization. This quantity is a measure\nof how well the true redshift can be recovered from an uncertain\ngalaxy redshift survey.\nFigure 8 clearly shows a strong dependence of the average redshift standard deviation on the amplitude of the true density field.\nVery dense structures can be recovered very well. As expected, figure 8 demonstrates that high density regions such as clusters can be\nmuch better recovered from uncertain redshift surveys than regions\nof lower density such as filaments or voids. However, on average\nthe redshift precision has improved for all galaxies compared to the\ninitial uncertainty.\nThe final redshift posterior distributions are generally highly\nnon-Gaussian. We therefore estimate the conditional probability\ndistribution P(\u2206z|\u03b4true ) of redshift departures from the true redshift\n\u2206z = ztrue \u2212 z conditional on the true underlying density field \u03b4true\n\nc 2006 RAS, MNRAS 000, 1\u201317\n\n\f9\n\nh\u03c3zi (\u03b4)\n\nBayesian inference from photometric redshift surveys\n\n1+\u03b4\nFigure 8. Mean standard deviation as a function of density contrast \u03b4.\n\nP(\u2206z|\u03b4true ) =\n\nPNsamp P\nl=1\n\np\n\np\np\n\u03b4D (\u03b4true\n\u2212 \u03b4true ) \u03b4D (\u2206z \u2212 (ztrue\n\u2212 zlp ))\n, (14)\nPNsamp P D p\np \u03b4 (\u03b4true \u2212 \u03b4true )\nl=1\n\nwhich is the probability of finding the departure \u2206z in a region with\ndensity contrast \u03b4true after our method has been applied. Initially\nthis distribution coincides with the redshift likelihood, which is independent of the density field and is basically a Gaussian distribution with redshift dispersion \u03c3z = 0.03. The comparison between\nthe initial distribution P(\u2206z|\u03b4true ) and that obtained by our method\nis shown in figure 9. This plot demonstrates that although the initial redshift likelihood is independent of the true underlying density\nfield, the final redshift posterior distribution strongly depends on it.\nBeyond measures of accuracy, it is instructive to inspect the\nredshift posteriors we derive for individual galaxies. In figure 10\nwe show some randomly selected redshift posterior distributions.\nIn general the inferred redshift posterior distributions are nonGaussian and multimodal. Each mode corresponds to a possible\nassociation of the galaxy with peaks in the density distribution. The\narea under each mode measures the probability for the galaxy to be\nassociated with that density peak. In several cases these modes sit\non top of a broader distribution which for the residual probability\nthat the galaxy is not associated with any of these peaks. It is clear\nthat by any reasonable measure of information, such as Shannon's\nnegentropy, these pdfs are far more informative regarding the redshift of the galaxy than the original photo-z likelihoods.\n7.2\n\nThe density field\n\nIn this section we will discuss the inferred three dimensional density field. As already described in the previous section, the accuracy\nof the inferred redshifts depends on the amplitude of the true underlying density field. In particular, the higher the underlying density\nthe more accurate we can identify the true location of galaxies. For\nthis reason, we expect a similar behavior for the recovered three\ndimensional density field. For example, we expect to recover high\ndensity regions more accurately than low density regions. However, the corresponding joint uncertainty of redshift and density\nestimates can be accurately estimated from the Markov samples.\nAs an example we calculated the ensemble mean and variance for\nthe density field. The results are presented in figure 11 where we\nshow three slices through the ensemble mean density and the ensemble variance field from different sides. The results demonstrate\nc 2006 RAS, MNRAS 000, 1\u201317\n\nthat high density regions are much better localized than lower density or even under dense regions. In particular, the ensemble mean\ndensity field shows elongated structures along the line of sight for\nunder dense objects such as voids. This result was anticipated. It reflects the fact that these objects are poorly constrained by the data.\nTo further quantify this visual impression and to estimate the\naccuracy of the inferred density field we study point to point comparisons between the true underlying density field and the recovered ensemble mean density field smoothed on different scales. The\ndensity fields are smoothed with a spherical top hat filter in Fourier\nspace with different filter radii kth . We can then calculate the corresponding correlation coefficient for the different filter thresholds\nkth\nD\n\nE\nth\n\u03b4ktrue\nh\u03b4ikth\n,\nr(kth ) = q \u0010\n\u00112 q\n\u0001\nth\nh \u03b4ktrue\ni h h\u03b4ikth 2 i\n\n(15)\n\nwhere the superscript denotes that the field has been filtered with\na top hat filter corresponding to kth . The result of this calculation\nis presented in figure 12. To further study the dependence of the\naccuracy of the inferred density field on the true underlying density\nfield, we will also calculate the correlation coefficients only between voxels in the true and the inferred ensemble mean density for\nwhich \u03b4true > \u03b4th . We can therefore study the correlation between\ntrue and recovered density field as a function of smoothing scale\nand density amplitude. As demonstrated by figure 12, the accuracy\nfor the inferred structures in the density field strongly depends on\nthe amplitude of the true underlying density field. As expected, high\ndensity objects can generally be much better constrained than low\ndensity or even under dense regions. It is interesting to point out,\nthat high density objects still show a reasonably high correlation\neven at the shortest scales resolved by the grid (\u223c 4.69 Mpc) although the data corresponds to a density field smeared out on a\nscale of about 100 Mpc due to a redshift variance of \u03c3z = 0.03.\nThese results are therefore in agreement with the results for the estimated redshifts presented in the previous section. In the absence\nof additional information or data the inference of redshifts and three\ndimensional density field strongly depends on the amplitude of the\ntrue underlying density field.\n\n\fP (\u2206z|\u03b4true )\n\nJens Jasche1 , Benjamin D. Wandelt\n\n\u03b4true\n\n10\n\n\u2206z\n\n\u2206z\n\nFigure 9. Probability distribution for the difference \u2206z between measured and true redshift conditional on the true underlying density field \u03b4true . The left panel\nshows the initial Gaussian redshift likelihood which is conditionally independent of the true underlying density field. The right panel shows the a posteriori\nconditional probability density distribution for \u2206z estimated from the Markov samples. It can be seen that the accuracy of inferred redshifts depends on the\ntrue underlying density field. Also note that the resulting probability distribution is non-Gaussian.\n\n8\n\nDISCUSSION AND CONCLUSION\n\nPresent and upcoming photometric galaxy surveys provide us with\n(tens of) millions of galaxies probing the density field out to high\nredshifts. These enormous numbers of galaxies can only be obtained at the expense of low accuracy in the measurement of the radial locations of galaxies along the line of sight. It has been demonstrated that these redshift uncertainties will generally influence the\ninference of cosmological signals such as the baryon acoustic oscillations, cluster counts or weak lensing. For this reason, accurate\ntreatment of redshift uncertainties is required in order to use these\nsurveys to full effect.\nIn this work, we presented a new, fully Bayesian approach\nwhich improves the accuracy of inferred redshifts even if all the\navailable information based on photometry and morphology of individual galaxies has been used to estimate the photo-z. Specifically our method performs a joint inference of the three dimensional density field and the true radial locations of galaxies from\nsurveys with highly uncertain redshift measurements. This joint approach permits us to impose physically motivated constraints on\nthe redshift and density inference, which increase the accuracy of\nthe inferred locations of galaxies, essentially super-resolving highdensity regions in redshift space.\nWhere does the additional information come frome? The\nisotropy and 2-D correlation prior allow improving the inference\nof three-dimensional structure from the highly precise angular information in the radial direction. If the projected density of tracers\non the sky shows a peak then it is likely that this corresponds to\none or more three-dimensional peaks along the line of sight. Many\ngalaxies with imprecise redshifts populate the line of sight. Galaxies in high density regions can be associated with structures that\nare consistent with their photo-z likelihoods and the observed twodimensional density. Each such structure has a relatively accurate\nredshift derived from the averaged redshift of the galaxies it contains.\nIn this work we employed a simplified picture of galaxy formation. The Poisson model of galaxy formation serves to connect\nthe isotropy prior on the underlying density field and the three dimensional locations of galaxies. As demonstrated in section 4, in\nthis picture, the probability of finding a galaxy at a given radial position is proportional to the intensity of the spatial Poisson process.\nAs can be seen from equation (7), ignoring survey systematics and\ngalaxy biasing, the probability of finding a galaxy at a given loca-\n\ntion is essentially proportional to the density, as would be expected\nintuitively. Further, equation (7) also demonstrates that our method\ncan accurately account for survey systematics and can in principle\nbe combined with a non-linear and non-local galaxy biasing model.\nThe joint inference of radial galaxy positions and the three\ndimensional density field as well as the quantification of joint uncertainties require exploring the posterior density conditional on\nobservations. Doing so via Markov Chain Monte Carlo methods is\na numerically challenging problem due to the high dimensionality,\nnon-Gaussianity and non-linearity of the problem.\nWe show that the complex sampling procedure can be split\nup into many simpler sub-sampling steps within the framework of\na multiple block Metropolis-Hastings algorithm. In particular this\npermits us to split the problem into the two tasks of individually\nsampling three dimensional density fields, conditional on the true\ngalaxy locations, and sampling galaxy redshifts, conditional on the\ndensity field. This sampling approach is depicted in figure 1. We explore the log-normal Poissonian posterior distribution for the three\ndimensional density field based on the galaxy distribution using the\nHADES algorithmJasche & Kitaura (2010). In this work we add\nsampling the redshift posterior distribution as shown as the first\nstep in equation (1).\nIn the Poissonian picture of galaxy formation the locations of\nindividual galaxies are conditionally independent of the locations\nof all other galaxies once the underlying density field is given. We\ndemonstrate this intuitively plausible fact in section 4. This fact\ngreatly simplifes the numerical implementation of the redshift sampler, since it allows treating each galaxy individually leading to a\nnumerically efficient, parallel sampling procedure despite the high\ndimensionality and non-linearity of the problem.\nWe extensively tested our method with artificial mock galaxy\nobservations to evaluate the overall performance of the algorithm\nin a realistic scenario with tens of millions of galaxies. The generation of the artificial galaxy survey is described in section 5. In\nthis test all galaxy positions have been distorted corresponding to\na truncated Gaussian with equal redshift dispersion for all galaxies. In particular, we used a redshift dispersion \u03c3z = 0.03 which\namounts to an uncertainty along the line of sight of about \u223c 100\nMpc. However, it should be noted that since our method treats each\ngalaxy individually, it is generally possible to take into account the\nphoto-z information and uncertainties appropriate for each individual galaxy.\nThe primary goal of the tests we conducted was to establish\nc 2006 RAS, MNRAS 000, 1\u201317\n\n\fz\n\nz\n\nz\n\n\u0010\n\u0011\nP z|zobs\n\n\u0011\n\u0010\nP z|zobs\n\n\u0010\n\u0011\nP z|zobs\n\nz\n\n11\n\n\u0010\n\u0011\nP z|zobs\n\n\u0011\n\u0010\nP z|zobs\n\n\u0010\n\u0011\nP z|zobs\n\nBayesian inference from photometric redshift surveys\n\nz\n\nz\n\nFigure 10. Randomly selected marginalized redshift posterior distributions estimated from the Markov samples (black curves). The red vertical lines denote\nthe true redshift of this specific galaxy and the red curve shows the distribution from which the observed redshift was drawn. The green vertical lines are the\nobserved redshifts and the blue vertical lines denote the ensemble mean redshift estimated from the samples.\n\nthe numerical feasibility of our method. In particular we focused\non evaluating the burn-in and convergence behavior of the multiple\nblock Metropolis-Hastings sampler. We studied the burn-in behavior of the sampler by monitoring the systematic drift of various\ninferred quantities towards their true values throughout subsequent\nsampling steps. As described in section 6.1, following the evolution of inferred power spectra, shown in figure 5, and the flow of\ngalaxies towards their true locations, as demonstrated by figure 4,\nindicates a burn-in time of about 5000 samples. Further, we studied the correlation length of individual galaxy redshifts across the\nMarkov Chain. In particular figure 7 demonstrates that the correlation length is typically less than 200 samples. These tests clearly\ndemonstrate the feasibility of the method proposed in this work.\nAs a scientific result the method provides improved photo-zs\nfor each galaxy and the three dimensional density field as well as\nthe corresponding joint uncertainties. In section 7.1 we discuss the\nresults for the inferred galaxy locations. As was anticipated, the\naccuracy of inferred redshifts depends on the density amplitude of\nthe true underlying density field. Figure 8 demonstrates, that on\naverage all galaxy redshifts have been improved with respect to the\noriginal redshift dispersion, up to a factor of 10 in high density\nregions.\nIt can clearly be seen that the accuracy of inferred redshifts\nfor galaxies living in high density regions is generally larger than\nfor galaxies in regions of lower density. This result is further clarified by figure 9 which shows the probability distribution of departures from the true redshifts conditional on the underlying density\nfield. Redshifts of galaxies in high density regions can be particularly well recovered from a survey with uncertain radial galaxy\npositions. These results correspond to our expectation, and simply\nreflect the fact that there are usually many galaxies in high density\nobjects. The joint information of these many observed redshifts permits to accurately infer the position of the high density object and\nhence the locations of galaxies living in this object. The lower the\nc 2006 RAS, MNRAS 000, 1\u201317\n\ndensity the smaller is the number of galaxies contributing to a feature and hence the number of observed redshifts. As a result it is\ngenerally more difficult to constrain the locations of low density\nfeatures than the location of high density features.\nThis effect is also reflected in the inferred density field, see\nsection 7.2. Figure 11 shows the ensemble mean density field and\nthe corresponding ensemble variance estimated from the set of\nMarkov samples. It is visually clear that high density regions can be\nmuch more accurately located than low density or even underdense\nregions. To quantify this impression, we studied the point to point\ncorrelation of the estimated ensemble mean with the true underlying density field for different smoothing scales and different density\nthresholds. The results shown in figure 12 clearly demonstrate that\nhigh density regions can be accurately recovered for all smoothing scales, while the correlation between ensemble mean and true\ndensity field worsens with decreasing density. For this reason, the\nresults of inferred density fields and galaxy redshifts are consistent\nand strongly depend on the density amplitudes of the true underlying density field.\nWe emphasize that the scientific output of our method is not a\nsingle estimate but a sampled representation of the joint posterior of\nthree dimensional density field and galaxy positions. Any desired\nstatistical summary as well as corresponding uncertainties can be\ncalculated from this set of samples.\nFor example, by marginalizing over the density field we are\nable to provide the marginalized redshift posterior distributions, as\ndepicted in figure 10, which permit easy propagation of uncertainties through subsequent analysis stages.\nOur method does not rely on specific assumptions on the\nprovenance of the redshift likelihood. It is therefore applicable generally to surveys of isotropic distributions of tracers with uncertain\nradial positions.\nIn summary, the presented method is a flexible and numerically efficient addition to the analysis toolbox for large scale galaxy\n\n\f12\n\nJens Jasche1 , Benjamin D. Wandelt\nln (2 + h\u03b4i i)\n\nlog10 (Ri )\n\nz [Mpc]\n\nln (2 + h\u03b4i i)\n\nx [Mpc]\n\nx [Mpc]\n\nx [Mpc]\n\nx [Mpc]\n\nx [Mpc]\n\nz [Mpc]\n\nz [Mpc]\n\nz [Mpc]\n\ny [Mpc]\n\ny [Mpc]\n\nx [Mpc]\n\nFigure 11. Three different slices from different sides through ensemble mean density (left panels), ensemble variance (middle panels) and the three dimensional\nresponse operator Ri (right panels). Especially the variance plots demonstrate, that the method accounted for the full Poisonian noise structure introduced by\nthe galaxy sample. One can also see the correlation between high density regions and high variance regions, as expected for Poissonian noise.\n\nsurveys. It improves accuracy of galaxy redshifts and three dimensional density fields from photometric galaxy redshift surveys and\ntherefore has the potential to add substantial value to their scientific\noutput.\n\nACKNOWLEDGMENTS\nWe thank Francisco S. Kitaura, Torsten A. Ensslin and Simon D.\nWhite for useful discussions and encouraging us to pursue the\nproject described in this work. Further, we thank Cristiano Porciani\nfor providing us with the simulated density field and Nina Roth\nfor providing us with required reading routines and information on\nhow to handle the simulation data. Particular thanks go to Rainer\nMoll and Bj\u00f6rn M. Sch\u00e4fer for useful discussions and support with\nc 2006 RAS, MNRAS 000, 1\u201317\n\n\fBayesian inference from photometric redshift surveys\n\n13\n\n\u03b4true > 150\n\u03b4true > 100\n\nr(kth)\n\n\u03b4true > 40\n\n\u03b4true > 10\n\n\u03b4true > 0\n\n\u03b4true > \u22121\n\nkth [h/Mpc ]\nFigure 12. Correlation coefficient r(kth ) as a function of filter scale kth for different density amplitude thresholds \u03b4th as indicated in the plot. It can be seen\nthat the correlation between amplitudes in the true underlying density field and the inferred ensemble mean density field increases on all filter scales with\nincreasing density thresholds \u03b4true > \u03b4th .\n\nmany valuable numerical gadgets. This work has been supported\nby the Deutsche Forschungsgemeinschaft within the Priority Programme 1177 under the project PO 1454/1-1 and by NSF grant\nAST 07-08849.\n\nc 2006 RAS, MNRAS 000, 1\u201317\n\n\f14\n\nJens Jasche1 , Benjamin D. Wandelt\n\nREFERENCES\nAbazajian K. N., et al., 2009, ApJS, 182, 543\nBaum W. A., 1962, in G. C. McVittie ed., Problems of ExtraGalactic Research Vol. 15 of IAU Symposium, Photoelectric\nMagnitudes and Red-Shifts. pp 390\u2013+\nBen\u0131\u0301tez N., 2000, ApJ, 536, 571\nBen\u0131\u0301tez N., et al., 2009, ApJ, 691, 241\nBenjamin J., van Waerbeke L., M\u00e9nard B., Kilbinger M., 2010,\nMNRAS, 408, 1168\nBernstein G., Jain B., 2004, ApJ, 600, 17\nBlake C., Bridle S., 2005, MNRAS, 363, 1329\nBoris N. V., Sodr\u00e9 Jr. L., Cypriano E. S., Santos W. A., de Oliveira\nC. M., West M., 2007, ApJ, 666, 747\nCollister A. A., Lahav O., 2004, PASP, 116, 345\nConnolly A. J., Csabai I., Szalay A. S., Koo D. C., Kron R. G.,\nMunn J. A., 1995, AJ, 110, 2655\nCoupon J., et al., 2009, A&A, 500, 981\nDuane S., Kennedy A. D., Pendleton B. J., Roweth D., 1987,\nPhysics Letters B, 195, 216\nEriksen H. K., O'Dwyer I. J., Jewell J. B., Wandelt B. D., Larson\nD. L., G\u00f3rski K. M., Levin S., Banday A. J., Lilje P. B., 2004,\nApJS, 155, 227\nFern\u00e1ndez-Soto A., Lanzetta K. M., Chen H., Pascarelle S. M.,\nYahata N., 2001, ApJS, 135, 41\nFirth A. E., Lahav O., Somerville R. S., 2003, MNRAS, 339, 1195\nFrieman J., 2011, in American Astronomical Society Meeting Abstracts #217 Vol. 43 of Bulletin of the American Astronomical\nSociety, The Dark Energy Survey. pp 205.01\u2013+\nHanson K. M., 2001, in Sonka M., Hanson K. M., eds, Society of\nPhoto-Optical Instrumentation Engineers (SPIE) Conference Series Vol. 4322 of Society of Photo-Optical Instrumentation Engineers (SPIE) Conference Series, Markov chain Monte Carlo\nposterior sampling with the Hamiltonian method. pp 456\u2013467\nHastings W. K., 1970, Biometrika, 57, 97\nHildebrandt et al., 2010, A&A, 523, A31+\nHuterer D., Kim A., Krauss L. M., Broderick T., 2004, ApJ, 615,\n595\nHuterer D., Takada M., Bernstein G., Jain B., 2006, MNRAS, 366,\n101\nIshak M., 2005, MNRAS, 363, 469\nJasche J., Kitaura F. S., 2010, MNRAS, 407, 29\nJasche J., Kitaura F. S., Li C., Ensslin T. A., 2010, MNRAS, 409,\n355\nJasche J., Kitaura F. S., Wandelt B. D., Ensslin T. A., 2010, MNRAS, 406, 60\nJasche J. K. F. S., 2008, ArXiv e-prints\nJewell J., Levin S., Anderson C. H., 2004, ApJ, 609, 1\nKoo D. C., 1986, in C. Chiosi & A. Renzini ed., Spectral Evolution of Galaxies Vol. 122 of Astrophysics and Space Science\nLibrary, Quests for primeval galaxies - A review of optical surveys. pp 419\u2013438\nMa Z., Hu W., Huterer D., 2006, ApJ, 636, 21\nMetropolis N., Rosenbluth A. W., Rosenbluth M. N., Teller A. H.,\nTeller E. T., 1953, Journal of Chemical Physics, 21, 1087\nNadaraya E. A., 1964, Theory of Probability and its Applications,\n9, 141\nNeal R. M., 1993, Technical Report CRG-TR-93-1, Probabilistic\ninference using Markov chain Monte Carlo methods. University\nof Toronto\nNeal R. M., 1996, Bayesian Learning for Neural Networks (Lecture Notes in Statistics), 1 edn. Springer\n\nPillepich A., Porciani C., Hahn O., 2010, MNRAS, 402, 191\nRefregier A., Amara A., Kitching T. D., Rassat A., Scaramella R.,\nWeller J., Euclid Imaging Consortium f. t., 2010, ArXiv e-prints\nSpringel V., 2005, MNRAS, 364, 1105\nWandelt B. D., Larson D. L., Lakshminarayanan A., 2004, Phys.\nRev. D, 70, 083511\nWang D., Zhang Y. X., Liu C., Zhao Y. H., 2007, MNRAS, 382,\n1601\nWatson G. S., 1964, The Indian Journal of Statistics, Series A, 26,\n359\nWolf C., 2009, MNRAS, 397, 520\nZhan H., 2006, JCAP, 8, 8\nZhan H., Knox L., 2006, ApJ, 644, 663\n\nc 2006 RAS, MNRAS 000, 1\u201317\n\n\fBayesian inference from photometric redshift surveys\nAPPENDIX A: METHODS FOR OBTAINING REDSHIFTS\nFROM PHOTOMETRY\nThe approach we present in this paper uses the output of photo-z\nestimators as its input. We give a short summary of these methods\nand references to relevant work below.\nA variety of different methods to infer accurate redshifts from\nphotometric galaxy observations have been proposed. These techniques can be roughly categorized as kernel regression methods,\nartificial neural networks and \u03c72 model testing Wolf (2009). The\nclass of kernel regression methods utilize sets of model realizations or spectroscopic galaxy samples to approximate the conditional probability density of a galaxy redshift conditional on photometric properties via specified kernel functions. Given this approximate probability density the non-linear mapping between a galaxies\nphotometric properties and its redshift can be established via a kernel regression which provides the conditional expectation value of\na galaxy redshift (Nadaraya 1964; Watson 1964; Boris et al. 2007;\nWang et al. 2007; Wolf 2009).\nArtificial neural networks aim at fitting the non-linear relation between observed photometric parameters and the redshift of\ngalaxies (Collister & Lahav 2004; Firth et al. 2003). In this approach, the non-linear relation between photometry and galaxy redshifts is represented by a multilayer perceptron neural network,\ntrained by a sufficiently large training set for which both photometry and accurate redshifts are known (Collister & Lahav 2004).\nGenerally artificial neural networks provide a single unique parameter estimate. However, if the solution is degenerate, they tend to\nreturn the most likely one (Wolf 2009). It is also possible to estimate uncertainties of the inferred quantities by re sampling the\ninput parameters from their error distributions. The outputs of a artificial neural network will then provide a probability distribution\ncharacterizing the uncertainty in the inferred quantity (Wolf 2009;\nCollister & Lahav 2004).\nAdditionally, Bayesian redshift inference methods have been\nproposed in literature (Wolf 2009; Ben\u0131\u0301tez 2000). These models\nrely on \u03c72 model testing, assuming a parameterized model between\nphotometric properties and redshifts of galaxies (Wolf 2009). Uncertainty information on the observations then permits to determine a probability density distribution for the inferred quantity and\nto provide expectation values and parameter uncertainties (Wolf\n2009).\nImprovements in photo-z determinations help to improve the\ntechnique we describe here. We emphasize that our work begins\nwhere photo-z estimation leaves off.\n\nX\n\n=\n\n{Ni }\n\n15\n\nP({si }|{Ni }) P({Ni }|{z p }, {\u03b8n }) ,\n(B2)\n\nwhere\nwe\nassumed\nthe\nconditional\nindependence\nP({si }|{Ni }, {z p }, {\u03b8n }) = P({si }|{Ni }). Further, the number counts\nare defined in co-moving Cartesian coordinates, we will therefore\nintroduce the set of corresponding co-moving Cartesian galaxy\npositions {~x p } and marginalize over it\nZ\nX\nP({si }|{z p }, {\u03b8n }) =\nP({si }|{Ni })\nd{~x p } P({Ni }, {~x p }|{z p }, {\u03b8n }) ,\n{Ni }\n\nX\n\n=\n\n{Ni }\n\nP({si }|{Ni })\n\nZ\n\nd{~x p } P({Ni }|{~x p })\n\n\u00d7 P({~x p }|{z p }, {\u03b8n }) .\n\n(B3)\n\nSince there exists a unique relation between the co-moving Cartesian and the true redshift coordinates we can write\nY \u0010\n\u0011\n\u03b4D x1p \u2212 r(z p ) cos(\u03b4 p ) cos(\u03b1 p )\nP({~x p }|{z p }, {\u03b8n }) =\np\n\n\u0010\n\u0011\n\u00d7 \u03b4D x2p \u2212 r(z p ) cos(\u03b4 p ) sin(\u03b1 p )\n\u0010\n\u0011\n\u00d7 \u03b4D x3p \u2212 r(z p ) sin(\u03b4 p ) ,\n\n(B4)\n\nwith \u03b1 p and \u03b4 p being the right ascension and declination of the pth\ngalaxy respectively. By introducing the vectors ~y p as\n\uf8ee\n\uf8f9\n\uf8ef\uf8ef\uf8ef cos(\u03b4 p ) cos(\u03b1 p ) \uf8fa\uf8fa\uf8fa\n\uf8ef\uf8ef\uf8ef\n\uf8fa\n~y p = r(z p ) \uf8ef\uf8ef cos(\u03b4 p ) sin(\u03b1 p ) \uf8fa\uf8fa\uf8fa\uf8fa\n(B5)\n\uf8f0\n\uf8fb\nsin(\u03b4 p )\nthe integral in equation (B3) can be solved to yield\nX\nP({si }|{z p }, {\u03b8n }) =\nP({si }|{Ni }) P({Ni }|{~y p }) .\n\n(B6)\n\n{Ni }\n\nAlso note that the probability distribution P({Ni }|{~y p }) can be written as\n\uf8f6\n\uf8eb\nX\nY \uf8ec\uf8ec\uf8ec\n\uf8f7\uf8f7\uf8f7\n(B7)\nW(~xi \u2212 ~y p )\uf8f7\uf8f7\uf8f8\uf8f7 ,\n\u03b4K \uf8ec\uf8ec\uf8ed\uf8ecNi \u2212\nP({Ni }|{~y p }) =\ni\n\np\n\nK\n\nwhere \u03b4 (x) is the Kronecker delta, ~xi is the position of the ith\nvolume and W(~x) is the counting kernel\nW(~x) = K(x1 ) K(x2 ) K(x3 )\n\n(B8)\n\ni\n\nAPPENDIX B: DENSITY POSTERIOR\nThe density posterior distribution given in equation (1) can be written as\nP({si }|{z p }, {zobs\nn }, {\u03b8n }) = P({si }|{z p }, {\u03b8n }) ,\n\n(B1)\n\nby noting that the posterior distribution is conditionally independent of the observed redshifts {zobs\nn } once the true redshifts {z p } are\nknown. In order to relate this distribution to a log normal Poissonian distribution we would like to express it in terms of galaxy\ncounts rather than in terms of galaxy redshifts and positions in the\nsky. We can therefore write equation (B1) as the marginalization\nover all possible galaxy number count configurations {Ni }\nX\nP({si }|{z p }, {\u03b8n }) =\nP({si }, {Ni }|{z p }, {\u03b8n })\n{Ni }\n\nc 2006 RAS, MNRAS 000, 1\u201317\n\nwith x being the components of the Cartesian vector ~x and K(x)\nbeing\n(\nx\n1 for \u2206x\n<1\n(B9)\nK(x) =\n0 else\nand \u2206x is the length of the volume element. Therefore, introducing\nthe galaxy number counts\nX\nNi ({z p }, {\u03b8 p }) =\nW(~xi \u2212 ~y p ) ,\n(B10)\np\n\nwe can solve equation (B11) to yield\nn \u0010\n\u0010\n\u0011o\u0011\nP({si }|{z p }, {\u03b8n }) = P {si }| Ni {z p }, {\u03b8 p } .\n\n(B11)\n\nHence, the density posterior distribution can be described in terms\nof number counts.\n\n\f16\n\nJens Jasche1 , Benjamin D. Wandelt\n\nAPPENDIX C: REDSHIFT POSTERIOR DISTRIBUTION\nIn this section we will derive the expression for the redshift posterior distribution of an individual galaxy. Making frequent use of\nBayes rule we can write the conditional redshift posterior distribution described in section 4 as\nP(zn |{\u03b8 p }, {u p }, {si }, {zobs\np })\n\nP({\u03b8 p }, {u p }, {si }, {zobs\np }|zn )\nP({\u03b8 p }, {u p }, {si }, {zobs\np })\n\n=\n\nP(zn )\n\n=\n\nP(\u03b8n , zn |{\u03be p }, {u p })\nP({si }|{\u03b8 p }, {z p })\n\u00d7\nP({si }|{\u03be p }, {u p })\n\u00d7\n\nP({zobs\np }|{\u03b8 p }, {z p }, {si })\n\nP({zobs\np }, \u0398n |{\u03be p }, {u p }, {si })\n\n,\n(C1)\n\nn \u0010\n\u0011o\nBy noting that {Mi + W(~xi \u2212 ~xn )} = Ni {z p }, {\u03b8 p } = {Ni } we can\nwrite\nP(~xn |{Mi })\n\n=\n\nP({Ni })\nP(~xn |{Ni }) .\nP({Mi })\n\nThe probability P(~xn |{Ni }) is merely the probability of randomly\npicking a particle at a specific position conditional on the set of\nnumber counts. Hence we can write\nX W(~xi \u2212 ~xn ) Ni\nP(~xn |{Ni }) =\n,\n(C6)\n\u2206V\nNtot\ni\nwhere Ntot is the total number of particles and \u2206V is the volume of\nthe volume element. Next we will consider the fraction\n\u0012\nn \u0010\n\u0011o \u0013\nP\n{s\n}\nN\n{z\n},\n{\u03b8\n}\ni\ni\np\np\nP({si }|{\u03b8 p }, {z p })\n\u0012\n=\nn \u0010\n\u0011o \u0013\nP({si }|{\u03be p }, {u p })\nP {s } M {u }, {\u03be }\ni\n\nWe will now consider the probability distribution\nP(\u03b8n , zn |{\u03be p }, {u p }), which basically describes a random draw\nof a particle out of an ensemble of particles. Changing the coordinates from spherical redshift coordinates to co moving Cartesian\ncoordinates yields\nP(\u03b8n , zn |{\u03be p }, {u p })\n\n\u2202r(z)\n\u2202z\n\n=\n\nz=zn\n\nr(zn )2 sin(\u03b4n ) P(~xn |{\u03be p }, {u p })\n(C2)\n\nwhere \u2202r(z)/\u2202z is the derivative of the co-moving radial distance\nwith respect to the redshift z. The Poissonian assumption for the\ngalaxy distribution, assumes, that the number counts, and hence the\nnumber of particles inside individual cells, are independent. Further, the Poissonian model assumes the particles inside a volume\nelement to be homogeneously distributed. We therefore yield\nP(~xn |{\u03be p }, {u p })\n\nX\n\n=\n\n{Mi }\n\nX\n\n=\n\n{Mi }\n\nP({Mi }|{\u03be p }, {u p }) P(~xn |{Mi })\nP\n\nY\ni\n\n\uf8f6\n\uf8eb\nX \u0010\n\uf8ec\uf8ec\uf8ec\n\u0011\uf8f7\uf8f7\uf8f7\nW ~xi \u2212 ~x(\u03be p , u p ) \uf8f7\uf8f7\uf8f7\uf8f8\n\u03b4K \uf8ec\uf8ec\uf8ec\uf8ed Mi \u2212\np\n\n\u00d7P(~xn |{Mi })\n\nP(~xn |{Mi ({\u03be p }, {u p })})\n\n=\n\n=\n\n=\n=\n=\n=\n\ni\n\n=\n\nP({Mi + W(~xi \u2212 ~xn )})\nP(~xn |{Mi + W(~xi \u2212 ~xn )})\nP({Mi })\n(C4)\n\np\n\np\n\n(C7)\n\nwhere we used the result, obtained in appendix B, that the density\nposterior solely depends through the number counts on the set of\ngalaxy coordinates. As can be easily seen by applying Bayes law\nwe can write this fraction as the ratio of the Poissonian likelihoods\nP({si }|{\u03b8 p }, {z p })\nP({si }|{\u03be p }, {u p })\n\nP ({Mi }) P ({Ni } |{si } )\nP ({Ni }) P ({Mi } |{si } )\nP ({Mi }) Y Mi ! Ni \u2212Mi\n=\n\u03bb\n,\n(C8)\nP ({Ni }) i Ni ! i\n\u0010\n\u0011\nwith \u03bbi = Ri N\u0304(1 + B(s)i ) being the intensity of the Poisson process. Since the number densities {Ni } and {Mi } differ only by one at\nthe position ~xn of the galaxy under consideration, the ratios of the\nproduct in equation (C8) are all equal to one except at this particular\ngalaxy position. we can therefore write\n!W(~xi \u2212~xn )\nP({si }|{\u03b8 p }, {z p })\nP ({Mi }) Y \u03bbi\n=\n.\n(C9)\nP({si }|{\u03be p }, {u p })\nP ({Ni }) i Ni\n=\n\nInserting all results into equation (C1) yields\nP(zn |{\u03b8 p }, {u p }, {si }, {zobs\np })\n\n=\n\n(C3)\n\nP(~xn , {Mi })\nP({Mi })\nX\n1\nP({Ni }) P(~xn , {Mi }|{Ni })\nP({Mi }) {N }\ni\nX\n1\nP({Ni }) P(~xn |{Ni })P({Mi }|{Ni }, ~xn )\nP({Mi }) {N }\ni\nX\n1\nP({Ni }) P(~xn |{Ni })\nP({Mi }) {N }\ni\nY\n\u0001\n\u00d7\n\u03b4K Mi \u2212 (Ni \u2212 W(~xi \u2212 ~xn ))\n\ni\n\nP ({si } |{Ni } )\n,\nP ({si } |{Mi } )\n\nIn the following we will omit the arguments of the number counts\n{Mi ({\u03be p }, {u p })} = {Mi }. We can then write\nP(~xn |{Mi })\n\n(C5)\n\n\u2202r(z)\nr(zn )2 sin(\u03b4n )\n\u2202z z=zn\nX W(~xi \u2212 ~xn ) Ni\n\u00d7\n\u2206V\nNtot\ni\n!\nW(~\nx\n\u2212~\nx\n)\nn\ni\nY \u03bbi\n\u00d7\nN\ni\ni\n\u00d7\n\nP({zobs\np }|{\u03b8 p }, {z p }, {si })\n\nP({zobs\np }, \u0398n |{\u03be p }, {u p }, {si })\n\n,\n(C10)\n\nSince the product in the third line of equation (C10) is only different\nfrom one at the galaxy position ~xn we can write\nP(zn |{\u03b8 p }, {u p }, {si }, {zobs\np })\n\n=\n\n\u2202r(z)\nr(zn )2 sin(\u03b4n )\n\u2202z z=zn\nX W(~xi \u2212 ~xn ) \u03bbi\n\u00d7\n\u2206V\nNtot\ni\n\u00d7\n\nP({zobs\np }|{\u03b8 p }, {z p }, {si })\n\nP({zobs\np }, \u0398n |{\u03be p }, {u p }, {si })\n\n,\n(C11)\n\nc 2006 RAS, MNRAS 000, 1\u201317\n\n\fBayesian inference from photometric redshift surveys\nAlso note, since in this work we will use Metropolis-Hastings algorithms to explore the conditional redshift posterior distribution,\nwe do not require to explicitly calculate the normalization constant\nof the probability distribution given in equation (C11). Up to an\noverall normalization constant we can therefore write\nP(zn |{\u03b8 p }, {u p }, {si }, {zobs\np })\n\n\u2202r(z)\nr(zn )2\n\u2202z z=zn\nX\n\u00d7\nW(~xi \u2212 ~xn ) \u03bbi\n\n\u221d\n\ni\n\n\u00d7 P({zobs\np }|{\u03b8 p }, {z p }, {si }) ,\n\n\u2202r(z)\nr(zn )2\n\u2202z z=zn\nX\n\u0010\n\u0011\n\u00d7\nW(~xi \u2212 ~xn ) Ri N\u0304(1 + B(s)i )\n\n=\n\ni\n\n\u00d7 P({zobs\np }|{\u03b8 p }, {z p }, {si }) .\n\n(C12)\n\nThis final result demonstrates that the conditional redshift posterior\nis essentially proportional to the intensity function of the Poissonian likelihood. It is also interesting to note, that the right hand\nside of equation (C15) does not depend on the galaxy coordinates\n{u p } and {\u03be p } of all galaxies. This shows, that given the underlying density field {si } the individual redshift posterior distribution is\nconditionally independent of all other galaxies\nobs\nP(zn |{\u03b8 p }, {u p }, {si }, {zobs\np }) = P(zn |{si }, {z p }) .\n\n(C13)\n\nIf we make the additional assumption, that the statistical process by\nwhich the observed redshifts zobs\np for individual galaxies is independent of the observed redshifts of all other galaxies we may write the\nredshift likelihood as\nY\nP({zobs\nP(zobs\n=\n(C14)\np }|{\u03b8 p }, {z p }, {si })\np |\u03b8 p , z p , {si }) .\np\n\nUsing this definition in equation (C15) and omitting all normalization constants yields\nP(zn |{\u03b8 p }, {u p }, {si }, {zobs\np })\n\n\u221d\n\n\u2202r(z)\nr(zn )2\n\u2202z z=zn\nX\n\u0010\n\u0011\nW(~xi \u2212 ~xn ) Ri N\u0304(1 + B(s)i )\n\u00d7\ni\n\n\u00d7 P(zobs\nn |\u03b8n , zn , {si }) .\n\n(C15)\n\nThis result permits us to sample each galaxy redshift zn individually. This paper has been typeset from a TEX/ LATEX file prepared\nby the author.\n\nc 2006 RAS, MNRAS 000, 1\u201317\n\n17\n\n\f"}