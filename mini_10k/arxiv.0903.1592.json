{"id": "http://arxiv.org/abs/0903.1592v1", "guidislink": true, "updated": "2009-03-09T16:53:27Z", "updated_parsed": [2009, 3, 9, 16, 53, 27, 0, 68, 0], "published": "2009-03-09T16:53:27Z", "published_parsed": [2009, 3, 9, 16, 53, 27, 0, 68, 0], "title": "Monte Carlo sampling given a Characteristic Function: Quantile Mechanics\n  in Momentum Space", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0903.5476%2C0903.0847%2C0903.2735%2C0903.3139%2C0903.4301%2C0903.1500%2C0903.3534%2C0903.0975%2C0903.3381%2C0903.4824%2C0903.4337%2C0903.0494%2C0903.1991%2C0903.1592%2C0903.5321%2C0903.5079%2C0903.4159%2C0903.1229%2C0903.3024%2C0903.0970%2C0903.1086%2C0903.4447%2C0903.1628%2C0903.3917%2C0903.0315%2C0903.2475%2C0903.4632%2C0903.2820%2C0903.5201%2C0903.2713%2C0903.2500%2C0903.3339%2C0903.1476%2C0903.2804%2C0903.5190%2C0903.0868%2C0903.1493%2C0903.2021%2C0903.5388%2C0903.1432%2C0903.4511%2C0903.4410%2C0903.4207%2C0903.0354%2C0903.1274%2C0903.5329%2C0903.1468%2C0903.4582%2C0903.2756%2C0903.2018%2C0903.2463%2C0903.5351%2C0903.5300%2C0903.3083%2C0903.1252%2C0903.4888%2C0903.1704%2C0903.4909%2C0903.2748%2C0903.3965%2C0903.5472%2C0903.1463%2C0903.0260%2C0903.3550%2C0903.3905%2C0903.0808%2C0903.3563%2C0903.4015%2C0903.3756%2C0903.5122%2C0903.2156%2C0903.1983%2C0903.4018%2C0903.2967%2C0903.2229%2C0903.1393%2C0903.2012%2C0903.4523%2C0903.2042%2C0903.0916%2C0903.2897%2C0903.5113%2C0903.1492%2C0903.2193%2C0903.4126%2C0903.2212%2C0903.0340%2C0903.3898%2C0903.4700%2C0903.1862%2C0903.1310%2C0903.3883%2C0903.3031%2C0903.5490%2C0903.4418%2C0903.2720%2C0903.4593%2C0903.0433%2C0903.2355%2C0903.4308%2C0903.2124&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Monte Carlo sampling given a Characteristic Function: Quantile Mechanics\n  in Momentum Space"}, "summary": "In mathematical finance and other applications of stochastic processes, it is\nfrequently the case that the characteristic function may be known but explicit\nforms for density functions are not available. The simulation of any\ndistribution is greatly facilitated by a knowledge of the quantile function, by\nwhich uniformly distributed samples may be converted to samples of the given\ndistribution. This article analyzes the calculation of a quantile function\ndirect from the characteristic function of a probability distribution, without\nexplicit knowledge of the density. We form a non-linear integro-differential\nequation that despite its complexity admits an iterative solution for the power\nseries of the quantile about the median. We give some examples including tail\nmodels and show how to generate C-code for examples.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0903.5476%2C0903.0847%2C0903.2735%2C0903.3139%2C0903.4301%2C0903.1500%2C0903.3534%2C0903.0975%2C0903.3381%2C0903.4824%2C0903.4337%2C0903.0494%2C0903.1991%2C0903.1592%2C0903.5321%2C0903.5079%2C0903.4159%2C0903.1229%2C0903.3024%2C0903.0970%2C0903.1086%2C0903.4447%2C0903.1628%2C0903.3917%2C0903.0315%2C0903.2475%2C0903.4632%2C0903.2820%2C0903.5201%2C0903.2713%2C0903.2500%2C0903.3339%2C0903.1476%2C0903.2804%2C0903.5190%2C0903.0868%2C0903.1493%2C0903.2021%2C0903.5388%2C0903.1432%2C0903.4511%2C0903.4410%2C0903.4207%2C0903.0354%2C0903.1274%2C0903.5329%2C0903.1468%2C0903.4582%2C0903.2756%2C0903.2018%2C0903.2463%2C0903.5351%2C0903.5300%2C0903.3083%2C0903.1252%2C0903.4888%2C0903.1704%2C0903.4909%2C0903.2748%2C0903.3965%2C0903.5472%2C0903.1463%2C0903.0260%2C0903.3550%2C0903.3905%2C0903.0808%2C0903.3563%2C0903.4015%2C0903.3756%2C0903.5122%2C0903.2156%2C0903.1983%2C0903.4018%2C0903.2967%2C0903.2229%2C0903.1393%2C0903.2012%2C0903.4523%2C0903.2042%2C0903.0916%2C0903.2897%2C0903.5113%2C0903.1492%2C0903.2193%2C0903.4126%2C0903.2212%2C0903.0340%2C0903.3898%2C0903.4700%2C0903.1862%2C0903.1310%2C0903.3883%2C0903.3031%2C0903.5490%2C0903.4418%2C0903.2720%2C0903.4593%2C0903.0433%2C0903.2355%2C0903.4308%2C0903.2124&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "In mathematical finance and other applications of stochastic processes, it is\nfrequently the case that the characteristic function may be known but explicit\nforms for density functions are not available. The simulation of any\ndistribution is greatly facilitated by a knowledge of the quantile function, by\nwhich uniformly distributed samples may be converted to samples of the given\ndistribution. This article analyzes the calculation of a quantile function\ndirect from the characteristic function of a probability distribution, without\nexplicit knowledge of the density. We form a non-linear integro-differential\nequation that despite its complexity admits an iterative solution for the power\nseries of the quantile about the median. We give some examples including tail\nmodels and show how to generate C-code for examples."}, "authors": ["William T. Shaw", "Jonathan McCabe"], "author_detail": {"name": "Jonathan McCabe"}, "author": "Jonathan McCabe", "arxiv_comment": "Version 1", "links": [{"href": "http://arxiv.org/abs/0903.1592v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/0903.1592v1", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "q-fin.CP", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "q-fin.CP", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "q-fin.ST", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/0903.1592v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/0903.1592v1", "journal_reference": null, "doi": null, "fulltext": "Monte Carlo sampling given a Characteristic Function:\nQuantile Mechanics in Momentum Space\nWilliam T. Shaw\u2217and J. McCabe\u2020\nMarch 9, 2009\n\narXiv:0903.1592v1 [q-fin.CP] 9 Mar 2009\n\nAbstract\nIn mathematical finance and other applications of stochastic processes, it is frequently the case that\nthe characteristic function may be known but explicit forms for density functions are not available. The\nsimulation of any distribution is greatly facilitated by a knowledge of the quantile function, by which\nuniformly distributed samples may be converted to samples of the given distribution. This article analyzes\nthe calculation of a quantile function direct from the characteristic function of a probability distribution,\nwithout explicit knowledge of the density. We form a non-linear integro-differential equation that despite\nits complexity admits an iterative solution for the power series of the quantile about the median. We give\nsome examples including tail models and show how to generate C-code for examples.\n\n1\n\nIntroduction\n\nThe construction of Monte Carlo samples from a distribution is facilitated if one has a knowledge of the\nquantile function w(u) of a distribution. If F (x) is the cumulative distribution function associated with a\ncontinuous density, then the quantile w(u) is the solution of the equation\nF (w(u)) = u .\n\n(1)\n\nA knowledge of the function w(u) makes Monte Carlo simulation straightforward: given a random sample U\nfrom the uniform distribution, a sample from the target distribution characterized by f (x), F (x) is\nX = w(U ) .\n\n(2)\n\nThis approach is especially useful when the U -variables arise as the components of a sampled copula, as then\none needs the quantile functions of the marginals to create the marginal samples from the copula sample. But\nin general the method is useful, irrespective of whether copulae are involved.\nA full differential theory of quantiles based on a density function has been given recently by Steinbrecher\nand Shaw [11]. The method is particularly easy to apply analytically when the density is of Pearson form\nand various power series solutions may be developed. This new paper addresses the case where the density is\nnot known explicitly but where one just has its characteristic function. Such cases are of increasing interest,\nespecially due to the role of jump diffusions and L\u00e9vy processes in mathematical finance. The methods\ndeveloped here may also be applied to the cases of known density of more complicated form, as working via\nthe characteristic function can turn out to be straightforward. We shall be able to give a detailed development\nhere for the case where all integer moments of the characteristic function exist, i.e. where the probability\ndensity function is analytic about the origin.\n\u2217 Corresponding author: Department of Mathematics King's College, The Strand, London WC2R 2LS, England; E-mail:\nwilliam.shaw@kcl.ac.uk\n\u2020 Department of Mathematics King's College London\n\n1\n\n\f2\n\n2\n\nW.T. Shaw, J. McCabe\n\nQuantile\u2013characteristic function relationships\n\nIf f (x) is the probability density function for a real random variable X, the first order quantile ODE is obtained\nby differentiating Eqn. (1), to obtain:\ndw(u)\nf (w(u))\n= 1,\n(3)\ndu\nwhere w(u) is the quantile function considered as a function of u, with 0 \u2264 u \u2264 1. Applying the product rule\nwith a further differentiation we obtain:\n\u0012\n\u00132\nd2 w(u)\ndw(u)\n0\nf (w(u))\n+ f (w(u))\n= 0.\n(4)\ndu2\ndu\nThis may be reorganized into the second order non-linear ODE given by Steinbrecher and Shaw [11]:\nd2 w(u)\n= H(w(u))\ndu2\n\n\u0012\n\ndw(u)\ndu\n\n\u00132\n,\n\n(5)\n\nwhere\n\nd\nlog{f (w)} .\n(6)\ndw\nand the simple rational form of H(w) for many common distributions, particularly the Pearson family, allows\nanalytical series solutions to be developed [11]. Changes of variable may also be introduced, leading to a\nuseful differential characterization of Cornish-Fisher expansions and candidates for quantile representations\noptimized for GPU computation [8].\nNow suppose we do not have an explicit form for f (w), but rather only have a characteristic function \u03c6X (t)\ndefined by\n\u03c6X (t) = E[eitX ]\n(7)\nH(w) = \u2212\n\nSo the theoretical density f and \u03c6X are related as Fourier transform pairs with the conventions\nZ \u221e\nZ \u221e\n1\n\u03c6X (t)e\u2212itx dt\n\u03c6X (t) =\nf (x)eitx dx , f (x) =\n2\u03c0 \u2212\u221e\n\u2212\u221e\n\n(8)\n\nCombining these definitions allows us to write down the following three links between the quantile function\nand the characteristic function. First, the definition of the characteristic function can be written as\nZ \u221e\n\u03c6X (t) =\neitx dF (x)\n(9)\n\u2212\u221e\n\nwhere F (x) is the cumulative distribution function associated with f (x). We can then change variables to\nu = F (x), with x = w(u), to obtain a first quantile-characteristic link in the form:\nZ\n\u03c6X (t) =\n\n1\n\neitw(u) du\n\n(10)\n\n0\n\nSecond, by using the Fourier inversion theorem, we have, from Eqn. (3),\nZ\ndw(u) \u221e\n\u03c6X (t)e\u2212itw(u) dt = 2\u03c0,\ndu\n\u2212\u221e\n\n(11)\n\nThird, and in the spirit of our previous approach, a further differentiation gives us\nd2 w(u)\ndu2\n\n\u00132 Z \u221e\n\u0012\ndw(u)\n\u03c6X (t)e\u2212itw(u) dt \u2212 i\nt\u03c6X (t)e\u2212itw(u) dt = 0.\ndu\n\u2212\u221e\n\u2212\u221e\n\nZ\n\n\u221e\n\n(12)\n\nThese last two relationships may be combined to give a fourth identity in the form:\nd2 w(u)\n=\ndu2\n\n\u0012\n\ndw(u)\ndu\n\n\u00133\n\n1\n2\u03c0\n\nZ\n\n\u221e\n\n\u2212\u221e\n\nit\u03c6X (t)e\u2212itw(u) dt.\n\n(13)\n\n\fMonte Carlo sampling given a characteristic function\n\n3\n\nThis last equation will be the basis of our further analysis, though it is possible other efficient approaches\nmay be developed from other such identities. We call it the characteristic quantile equation, or CQE. The\nCQE is a direct link between the characteristic and the quantile. If we can solve the CQE we can significantly\nshort-cut what would be the normal three-stage route from the characteristic function to the quantile, and\nobtain Monte Carlo samples, as illustrated in the diagram below.\n\u03c6X (t)\n\uf8e6\n\uf8e6\nCQE solution?y\nw(u)\n\uf8e6\n\uf8e6\nSample uniform U y\n\nInverse Fourier transform\n\n\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2192 f (x)\n\uf8e6\n\uf8e6Integration\ny\n\u2190\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\u2212\nFunctional Inversion\n\nF (x)\n\nX = w(U )\nIt is quite often the case the the first step is analytically intractable, and if it does succeed the third step of\nfunctional inversion may be difficult. The diagonal route from the characteristic function direct to the CDF\nF (x) has been considered, and we turn to this next.\n\n3\n\nFrom the characteristic function to the distribution function\n\nThe diagonal route from \u03c6X (t) to F (x) is a well-trodden one. We refer to reader to Shephard (1991) [9] for\na definitive survey on the results related to the \"Gil-Pelaez inversion\" formula [2]. We will discuss this result\nfor two reasons. First we will need a special case for a result that anchors our quantile functions. Second, we\nwish to bring attention to the danger of using this result outside a carefully defined context - this comes to\nlight if one considers an essentially complex analytic picture.\nThe starting point is the elementary observation that the CDF F (x) can be regarded as the convolution\nof the density f (x) with the Heaviside step function \u03b8(x) that is unity for x > 0 and zero otherwise.\nZ x\nZ \u221e\nF (x) =\nf (y)dy =\n\u03b8(x \u2212 y)f (y)dy\n(14)\n\u2212\u221e\n\n\u2212\u221e\n\nWe therefore wish to exploit the convolution theorem, the Fourier transform of F is given by\nF\u0302 (t) = \u03c6X (t)\u03b8\u0302(t)\n\n(15)\n\nLet us work out \u03b8\u0302(t) carefully:\nZ\n\n\u221e\n\n\u03b8\u0302(t) =\n\u2212\u221e\n\n\u03b8(x)eitx dx =\n\nZ\n\n\u221e\n\n\u03b8(x)eitx dx =\n\n0\n\nZ\n\n\u221e\n\neitx dx\n\n(16)\n\n0\n\nThe last integral is convergent if and only if =(t) > 0, i.e. the transform exists and is holomorphic on the\nstrict upper half-plane. In that case we obtain\n\u03b8\u0302(t) =\n\n1\n(\u2212it)\n\n(17)\n\nIn principle this means that an inversion integral involving \u03b8\u0302(t) should be carried out along a horizontal\ncontour in the upper half plane U = {z : =(z) > 0}. Now consider f\u02c6(t). This might not in fact be holomorphic\n(we will return to this later), but if it is it will normally be holomorphic on a horizontal strip D = {z : B <\n=(z) < T }. Provided D \u2229 U is non-empty we pick a horizontal contour C \u2208 D \u2229 U and the inversion and\nconvolution theorems give us\nZ\ni\n\u03c6X (t)e\u2212itx\nF (x) =\n(18)\n2\u03c0 C\nt\nNote that this whole idea requires that D \u2229 U is non-empty. Furthermore, any attempt to move C to the real\naxis might fail - this is not due to the presence of the factor 1/t, which is in fact easily managed. Two cases\nof notable interest in the wider context of option-pricing are\n\n\f4\n\nW.T. Shaw, J. McCabe\n\u2022 f1 (x) = (ex \u2212 1)+ : the reader may verify by elementary integration that D = {z : 1 < =(z)} and the\nreal axis is well below D \u2229 U = D;\n\u2022 f2 (x) = (1 \u2212 ex )+ : the reader may verify by elementary integration that D = {z : =(z) < 0}, then\nD \u2229 U = \u2205.\n\nIn these two examples f\u02c61 = f\u02c62 = 1/(it \u2212 t2 ) and the consideration of D is all-important. However, the reader is\nright to note that these examples are somewhat pathological with regard to convergence - neither corresponds\nto the transform of a genuine PDF, whatever their wider relevance.\nNow suppose that \u03c6X (t) is holomorphic in a neighbourhood of the real axis. Then D \u2229 U contains C(\u03b5),\nthe horizontal contour {z : z = x + i\u03b5; \u2212\u221e < x < \u221e} traversed from left to right. Then\nZ\n\u03c6X (t)e\u2212itx\ni\n(19)\nF (x) =\n2\u03c0 C(\u03b5)\nt\nWe now deform C(\u03b5) to the contour C(\u000f) (the mousehole contour) that is the union of the intervals\nC1 = {t : \u2212\u221e < t \u2264 \u000f}\nC2 = {t : t = \u000fei\u03b8 ; \u03c0 \u2265 \u03b8 \u2265 0}\nC3 = {t : \u000f \u2264 t < \u221e}\nand where C2 is traversed clockwise. Then we can write\nZ\nZ\nZ\n1\n\u03c6X (t)e\u2212itx\n1\n\u03c6X (t)e\u2212itx\n1\n\u03c6X (t)e\u2212itx\nF (x) =\ndt +\ndt +\ndt\n2\u03c0 C1\n(\u2212it)\n2\u03c0 C2\n(\u2212it)\n2\u03c0 C3\n(\u2212it)\nand using the calculus of residues on C2 , we have\nZ\ni\n\u03c6X (t)e\u2212itx\ni\n1\n1\nlim\ndt =\n[\u2212i\u03c0\u03c6x (0)] = \u03c6X (0) =\n\u000f\u21920 2\u03c0 C\nt\n2\u03c0\n2\n2\n2\nWe now change variables in C3 with t \u2192 \u2212t and establish the result.\nZ \u221e\n1\ni\n\u03c6X (t)e\u2212itx \u2212 \u03c6X (\u2212t)eitx\nF (x) = + lim\ndt\n2 \u000f\u21920 2\u03c0 \u000f\nt\n\n(20)\n\n(21)\n\n(22)\n\n(23)\n\nGiven that we have assumed \u03c6 is holomorphic we can expand the numerator and observe that the limit \u000f \u2192 0\nmay be taken, finally giving us the Gil-Pelaez inversion formula:\nZ \u221e\n1\ni\n\u03c6X (t)e\u2212itx \u2212 \u03c6X (\u2212t)eitx\nF (x) = +\ndt\n(24)\n2 2\u03c0 0\nt\nNote that this result is the \"shadow\", evaluated along the real axis, of the result of equation (18) in a context\nwhere C may be pushed arbitrarily close to the real axis. It is simply not true that this can be done with a\ngeneral Fourier transform, as previously noted.\nThe category of Fourier transforms that we actually wish to deal with the set of transforms that arise\nfrom transforming probability density functions. This is a rather more subtle category, as the characteristic\nfunctions that arise are not necessarily in the category of functions holomorphic in a neighbourhood of the real\naxis. The contrast between the two-sided exponential distribution and the Cauchy distribution is useful. The\ntwo-sided exponential distribution has a transform with nice thick strip containing the real axis and bounded\nby two simple poles. The Cauchy distribution on the other hand has a transform of the form\n\u03c6X (t) = e\u2212\u03bb|t|\n\n(25)\n\nwhich is simply not holomorphic in a neighbourhood of the real axis (cf stable distributions in general).\nHowever, one can reconsider Eqn. (24) in the altogether different setting of transforms of actually probability\ndensity functions, where the transforms are considered along the real axis only. We will not discuss this matter\nfurther here, and refer the reader instead to the work by Shephard [9], which establishes that in this context\nthe G-P inversion still works. However, the temptation to use Eqn. (24) in any wider setting must be resisted,\nfor the reasons already stated.\n\n\fMonte Carlo sampling given a characteristic function\n\n5\n\nWe now turn to the result that we shall need for the direct computation of quantile functions. We need\nthis result to establish an origin for expansions.\nTheorem 1 - the zero quantile location\nThe value of u0 satisfying\nw(u0 ) = 0\nis given by\n1\ni\nu0 = +\n2 2\u03c0\n\nZ\n0\n\n\u221e\n\n(26)\n\n\u03c6X (t) \u2212 \u03c6X (\u2212t)\ndt\nt\n\n(27)\n\nThis resolved is now easily proved by substitution of x = 0 in the inversion formula. We note that as expected\nu0 = 1/2 when f , and hence \u03c6X is symmetric.\n\n3.1\n\nExamples of using the zero location theorem\n\nConsider an elementary case where we have not exploited the location symmetry on the simple Gaussian case\nto set the mean to zero. Then for a distribution with mean \u03bc we have\n2\n\n\u03c6X (t) = ei\u03bct\u2212t\n\n/2\n\nThe location theorem gives us, following some first simplification:\n\u0012\n\u0013\nZ \u221e\n2\n1\n2 sin(\u03bct)\n1 1\n\u03bc\n1\ne\u2212t /2\ndt = \u2212 erf \u221a\n= N (\u2212\u03bc)\nu0 = \u2212\n2 2\u03c0 0\nt\n2 2\n2\n\n(28)\n\n(29)\n\nwhere N (x) is the normal CDF. This of course is the correct result.\n\n3.2\n\nStable distribution\n\nNext, consider a stable distribution with\n\u03c6X (t) = exp{\u2212|t|\u03b1 (1 \u2212 i\u03b2sign(t)\u03a6)}\nand \u03a6 = tan(\u03b1\u03c0/2). The location theorem gives us\nZ\n1 \u221e \u2212t\u03b1 sin(\u03b2\u03a6t\u03b1 )\n1\nu0 = \u2212\ne\n2 \u03c0 0\nt\n\n(30)\n\n(31)\n\nThe integral evaluates to give us\n1\n1\n\u2212\narctan(\u03b2\u03a6) .\n(32)\n2 \u03c0\u03b1\nNote than when \u03b2 = 0 we obtain u0 = 1/2 and that when \u03b2 = 1 we obtain u0 = 0. In the latter case the\ndistribution only exists for non-negative X. When \u03b1 < 1 zero is not an interior point of the support of X.\nOur location formula behaves in the right way and we can also see that as \u03b2 \u2192 \u22121 then u0 \u2192 1.\nThe point of these observations is that we can get a base point for a series expansion of the quantile by the\ncomputation of an integral. In the stable case we can see that the result is a simple \"closed-form\" formula.\nu0 =\n\n4\n\nFormal solution of the characteristic quantile equation\n\nWe have a non-linear integro-differential equation linking the quantile to the characteristic function. Inspection\nof the CQE indicates that we can differentiate it , then eliminate w00 (u) from the right hand side by using\nEqn. (13) again. Let's do this once:\nZ \u221e\nZ \u221e\n1\n1\nw000 (u) = [w0 (u)]3\nit(\u2212it)\u03c6X (t)e\u2212itw(u) dt + 3[w0 (u)]2 w00 (u)\nit\u03c6X (t)e\u2212itw(u) dt.\n(33)\n2\u03c0 \u2212\u221e\n2\u03c0 \u2212\u221e\nUse of the CQE and some simplification leads to\n\u0014\n\u0012Z \u221e\n\u00132 \u0015\nZ \u221e\n1\n1\nw000 (u) = [w0 (u)]4\nt2 \u03c6X (t)e\u2212itw(u) dt + 3w0 (u) 2\nit\u03c6X (t)e\u2212itw(u) dt\n2\u03c0 \u2212\u221e\n4\u03c0\n\u2212\u221e\n\n(34)\n\n\f6\n\nW.T. Shaw, J. McCabe\n\nSome experimentation lead us to write\nw(n) (u) = [w0 (u)]n+1 Pn [w0 (u), w(u)]\n\n(35)\n\nwhere Pn [w0 (u), w(u)] is a polynomial in w0 (u) of degree n \u2212 2 whose coefficients involve integrals of w(u).\nThe operation of differentiation and resubstitution gives the recurrence identity:\nPn+1 [x, w] = (n + 1)xP2 [w]Pn [x, w] + x2 P2 [w]\nwhere\nP2 [x, w] = P2 [w] =\n\n1\n2\u03c0\n\nZ\n\n\u2202\n\u2202\nPn [x, w] +\nPn [x, w]\n\u2202x\n\u2202w\n\n(36)\n\n\u221e\n\nit\u03c6X (t)e\u2212itw dt\n\n(37)\n\n\u2212\u221e\n\nWe can do an inductive verification of this relation and note its correctness when n = 2.\n\n4.1\n\nThe analytic assumption\n\nIn carrying out the repeated differentiation of the CQE we are assuming that all derivatives of w(u) exist and\nthat we may form a convergent power series with which to represent the solution. The operation of repeated\ndifferentiation on the quantile will call up integrals of the form\nZ \u221e\n1\nMk =\ntk \u03c8(t)dt\n(38)\n2\u03c0 \u2212\u221e\nand these are related to the derivatives of the density function (if they exist) by\nf (k) (0) = (\u2212i)k Mk\n\n(39)\n\nfrom the Fourier inversion theorem. What our series solution is using the characteristic function to invert a\nTaylor series for the density about the origin without explicitly calculating it. In our initial solution to the\nproblem, this series must exist in some form - other methods must be used if no such series exists.\n\n4.2\n\nSymmetric distributions on the entire real line\n\nHow might we use this to solve our problem? Let's consider an interesting special but rich case, where the\ndensity is symmetric about the origin, and the random variables X may take all real values. In the symmetric\ncase w(1/2) = 0 and we can consider a power series solution about the median. Inspection of the integrals\nobtained so far gives us w00 (1/2) = 0 and\nZ \u221e\n000\n0\n4 1\nw (1/2) = [w (1/2)]\nt2 \u03c6X (t)dt\n(40)\n2\u03c0 \u2212\u221e\nThe normalization w0 (1/2) is easily determined by the condition:\nZ \u221e\n1\n1\n=\n\u03c6X (t)dt\nw0 (1/2)\n2\u03c0 \u2212\u221e\n\n(41)\n\nOne observes that the formal solution for the quantile as a power series around the median is in principle\ncompletely determined by a knowledge of the even \"moments\" of the characteristic function , as these supply\nthe coefficients of that power series. Furthermore they do so directly, without having to establish the density\nf or CDF F . In this symmetric case we can write down the complete solution for the quantile as the series\nw(u) = v + w0 (1/2)\n\n\u221e\nX\nk=1\n\nP2k+1 [w0 (1/2), 0]\n\nv 2k+1\n(2k + 1)!\n\n(42)\n\nwhere v = w0 (1/2)(u \u2212 1/2). The main issue that remains is the computation of the P -coefficients in terms of\n\"moments\" of the characteristic function, by the solution of the recurrence identity Eqn. (17) with the initial\ncondition of Eqn. (18). One also expects such power series to become increasingly awkward as one moves into\nthe tails, so we expect to have to supplement the model with a special treatment of the tail.\n\n\fMonte Carlo sampling given a characteristic function\n\n4.3\n\n7\n\nLocational invariance of the CQE\n\nThe CQE has a notable, if rather obvious symmetry. It is invariant under the transformations\n\u03c6X (t) \u2192 eita \u03c6X (t) , w(u) \u2192 w(u) + a .\n\n(43)\n\nThis of course corresponds to a shift in the density\nf (x) \u2192 f (x \u2212 a) ,\n\n(44)\n\nt \u2192 ct , \u03c6X (t) \u2192 \u03c6X (ct) , w(u) \u2192 w(u)/c .\n\n(45)\n\nas one would expect.\n\n4.4\n\nScale invariance of the CQE\n\nThe transformation\n\nalso generates a symmetry of the CQE.\nThe scale and location invariance may often be used to transform the problem to one in standard form\nwith fewer parameters.\n\n4.5\n\nAsymmetric distributions on (\u2212\u221e, \u221e)\n\nOnce any relevant locational and scale transformations have been exploited, a distribution may remain asymmetric. In this case the choice of an origin for expansion must be resolved. In the symmetric case w(1/2) = 0\nis the median so we might consider whether the try to still expand about the median or about the point u0\nchosen so that w(u0 ) = 0. The advantage of the latter approach is that we can do the expansion again in\nterms of simple \"moments\" of the characteristic function, and we can compute an expression for u0 . We have\nthe zero quantile location as a special case of the Gil-Pelaez inversion formula\nu0 =\n\n4.6\n\ni\n1\n+\n2 2\u03c0\n\nZ\n\n\u221e\n\n0\n\n\u03c6X (t) \u2212 \u03c6X (\u2212t)\ndt\nt\n\n(46)\n\nFormal solution for the asymmetric case\n\nHaving found u0 using the methods just described, we then have, as before,\nZ \u221e\n1\n1\n=\n\u03c6X (t)dt\nw0 (u0 )\n2\u03c0 \u2212\u221e\nw(u) = v + w0 (u0 )\n\n\u221e\nX\n\nPk [w0 (u0 ), 0]\n\nk=2\n\nvk\nk!\n\n(47)\n\n(48)\n\nwhere v = w0 (u0 )(u \u2212 u0 ).\n\n4.7\n\nExponential asymmetry\n\nFor a significant class of distributions asymmetry in the system is introduced by an exponential scaling. That\nis, for a real parameter \u03b2,\nc(\u03b2)\nfS (x)e\u03b2x\n(49)\nf (x; \u03b2) =\nc(0)\nwhere c() is a normalization function and fS is a symmetric case. It is evident by the shift theorem that\n\u03c8(t; \u03b2) =\n\nc(\u03b2)\n\u03c8S (t \u2212 i\u03b2)\nc(0)\n\n(50)\n\n\f8\n\nW.T. Shaw, J. McCabe\n\nand hence the quantile must be determined only by integrals of the symmetric characteristic function \u03c8S . We\ncan make this explicit by a complex shift of the integration contour1 in the CQE with the change of variables\nt = p + i\u03b2. We obtain the modified CQE linking the full quantile with the symmetric \u03c8S :\n\u0012\n\u00133\nZ\ndw(u)\nd2 w(u)\nc(\u03b2) \u03b2w(u) \u221e\n=\n(ip \u2212 \u03b2)\u03c8S (t)e\u2212ipw(u) dp.\n(51)\ne\ndu2\ndu\n2\u03c0c(0)\n\u2212\u221e\n\n5\n\nSeries solution of the CQE - the symmetric case\n\nLet us summarize the problem in the symmetric case. Given a characteristic function \u03c6X (t), we need to solve\nthe iteration scheme:\nPn+1 [x, w] = (n + 1)xP2 [w]Pn [x, w] + x2 P2 [w]\nwith the initial condition:\n\nZ\n\n1\nP2 [x, w] = P2 [w] =\n2\u03c0\n\n\u2202\n\u2202\nPn [x, w] +\nPn [x, w]\n\u2202x\n\u2202w\n\n(52)\n\n\u221e\n\nit\u03c6X (t)e\u2212itw dt\n\n(53)\n\n\u2212\u221e\n\nThe power series of the quantile function about the median w(1/2) = 0 is then\nw(u) = v + w0 (1/2)\n\n\u221e\nX\n\nP2k+1 [w0 (1/2), 0]\n\nk=1\n\nwhere v = w0 (1/2)(u \u2212 1/2) and\n1\n1\n=\nw0 (1/2)\n2\u03c0\n\nZ\n\nv 2k+1\n(2k + 1)!\n\n(54)\n\n\u221e\n\n\u03c6X (t)dt .\n\n(55)\n\n\u2212\u221e\n\nThe solution of the iteration is a rather mindless process that is best automated in a symbolic computation\nenvironment, and we employed Mathematica to carry out the analysis. We summarize the results. Let\nZ \u221e\n1\nt2k \u03c6X (t)dt\n(56)\nEk =\n2\u03c0 \u2212\u221e\ndenote the k'th normalized even moment. We have already observed that\nP3 [x, 0] = E1\n\n(57)\n\nSymbolic iteration then yields further terms as follows, where we abbreviate Pk [x, 0] = pk ,\np5 = 10xE12 \u2212 E2\np7 = 280x2 E13 \u2212 56xE2 E1 + E3\n\u0001\np9 = 15400x3 E14 \u2212 4620x2 E2 E12 + x 126E22 + 120E1 E3 \u2212 E4\n\u0001\np11 = 1401400x4 E15 \u2212 560560x3 E2 E13 + x2 17160E3 E12 + 36036E22 E1 \u2212 x (792E2 E3 + 220E1 E4 ) + E5\n\u0001\np13 = 190590400x5 E16 \u2212 95295200x4 E2 E14 + x3 3203200E3 E13 + 10090080E22 E12\n(58)\n\u0001\n\u0001\n\u2212 x2 126126E23 + 360360E1 E3 E2 + 50050E12 E4 + x 1716E32 + 2002E2 E4 + 364E1 E5 \u2212 E6\n\u0001\np15 = 36212176000x6 E17 \u2212 21727305600x5 E2 E15 + x4 775975200E3 E14 + 3259095840E22 E13\n\u0001\n+ x3 \u221213613600E4 E13 \u2212 147026880E2 E3 E12 \u2212 102918816E23 E1\n\u0001\n+ x2 123760E5 E12 + 1166880E32 E1 + 1361360E2 E4 E1 + 2450448E22 E3\n+ x (\u221211440E3 E4 \u2212 4368E2 E5 \u2212 560E1 E6 ) + E7\nThe display here of further terms would become rather unwieldy. In any case, such expressions are best stored\nsymbolically for subsequent simplification for a particular distribution. We do note that this is a one-off\ncomputation that once done to high order in a symbolic computation environment can then be transferred to\nanother computer environment for implementation along with computation of the characteristic moments.\n1 We can do this by Cauchy's theorem, given that \u03b2 must be constrained so that f remains L1 integrable and the transform\ndoes not develop singularities\n\n\fMonte Carlo sampling given a characteristic function\n\n5.1\n\n9\n\nTesting the approach with the normal distribution\n\nThis is one where a complete algebraic characterization of the median power series has been given [11].\n2\n\n\u03c6X (t) = e\u2212t\n\n/2\n\n(59)\n\n\u0012\n\u0013\n1 n\u2212 1\n1\n2 2\u0393 n +\n\u03c0\n2\n\n(60)\n\n2\u03c0\n\n(61)\n\nAll the relevant integrals exist:\nEk =\n\n1\n2\u03c0\n\nZ\n\n\u221e\n\n2\n\nt2n e\u2212t\n\n/2\n\ndt =\n\n\u2212\u221e\n\nand in particular\nw0 (1/2) =\n\n\u221a\n\nThen the use of the series above, Eqns. (27)-(31), and some simplification yields the normal quantile in the\nform:\n\u00015\n\u00017\n\u00019\n\u0012\n\u0013\n\u0012\n\u00133\n\u221a\n7\u03c0 5/2 u \u2212 12\n127\u03c0 7/2 u \u2212 12\n4369\u03c0 9/2 u \u2212 12\n1\n1 \u221a 3/2\n1\n\u221a\n\u221a\n\u221a\n2\u03c0 u \u2212\n2\u03c0\n+\n+\nu\u2212\n+\n+\n2\n3\n2\n15 2\n315 2\n11340 2\n(62)\n\u000111\n\u0012\n\u001313 !\n34807\u03c0 11/2 u \u2212 12\n1\n\u221a\n+O\nu\u2212\n+\n2\n89100 2\nMany more terms can be computed using some computer algebra. The generation of this particular series is\nhowever best handled with the methods of [11], where a purely algebraic recursion may be used instead of\nEqn. (27).\n\n5.2\n\nTesting on the Student distribution\n\nFor a Student t distribution with n degrees of freedom the characteristic function is given by\n\u221a\nn+2\n1\nn\n21\u2212 2 n 4 \u2212 2 |t|n/2 K n2 ( n|t|)\n\u0001\n\u03c6Tn (t) =\n\u0393 n2\nSee e.g. the detailed discussion by Hurst [3] for an elegant derivation of this. The normalization is\n\u0001\n\u221a\nn\u03c0\u0393 n2\n0\n\u0001\nx = w (1/2) =\n.\n\u0393 n+1\n2\n\n(63)\n\n(64)\n\nAll the relevant characteristic moments exist in the form\n\u0001\n1\n4k n\u2212k\u2212 2 \u0393 k + 12 \u0393 k +\n\u0001\nEk =\n\u03c0\u0393 n2\n\nn\n2\n\n+\n\n1\n2\n\n\u0001\n(65)\n\nThe method leads to the Student quantile series as given in [7] and as extended in [11].\n\n6\n\nSymmetric Distributions of interest\n\nWe may consider distributions whose density is known, or not known, in explicit form.\n\n6.1\n\nSymmetric stable distribution\n\nThese have been extensively discussed - see Nolan. Employing location and scale invariance allows us to focus\nattention on the symmetric case in standard form:\n\u03b1\n\n\u03c6X (t) = e\u2212|t|\n\n(66)\n\nThe tail behaviour is given to leading order by\nf (x) \u223c\n\n\u03b1 sin(\u03c0\u03b1/2)\u0393(\u03b1)\n\u03c0|x|(1+\u03b1)\n\n(67)\n\n\f10\n\nW.T. Shaw, J. McCabe\n\nAll the relevant integrals exist:\n\u221e\n\nZ\n\n2k \u2212|t|\u03b1\n\nt e\n\nEk =\n\u2212\u221e\n\n\u0012\n\u0013\n2\n2k + 1\ndt = \u0393\n\u03b1\n\u03b1\n\n(68)\n\n\u03c0\n\u0393[1 + 1/\u03b1]\n\n(69)\n\nand in particular\nw0 (1/2) =\n\n6.2\n\nSymmetric Generalized Hyperbolic\n\nThis is a case, SGH, where the density is known in closed form. Nevertheless, while repeated differentiation of\nthe density is possible for certain parameters, it turns out to be much more tractable to work in momentum\nspace. The SGH characteristic function is given by\n\u221a\nK\u03bb (\u03b4 \u03b12 + z 2 )\nK\u03bb (\u03b1\u03b4)\n\n(70)\n\n\u221a\n(\u03b1/\u03b4)\u03bb K\u03bb\u22121/2 (\u03b1 \u03b4 2 + x2 )\n\u221a\nf (x) = \u221a\n2\u03c0K\u03bb (\u03b1\u03b4) ( \u03b4 2 + x2 /\u03b1)1/2\u2212\u03bb\n\n(71)\n\n\u0012\n\u03c6X (t) =\n\n\u03b12\n\u03b12 + z 2\n\n\u0013\u03bb/2\n\nand is associated with the density function\n\nWe assume that \u03b1 \u2265 0 and \u03b4 \u2265 0. There are several special cases:\n\u221a\n\u2022 Student: \u03bb = \u2212\u03bd/2, \u03b4 = \u03bd, \u03b1 \u2192 0+ .\n\u2022 Ordinary hyperbolic: \u03bb = 1;\n\u2022 NIG: \u03bb = \u22121/2;\n\u2022 Symmetric Variance Gamma: \u03b4 \u2192 0+ .\nThe value of the density at the origin is given by\nf (0) = \u221a\n\n(\u03b1/\u03b4)\u03bb K\u03bb\u22121/2 (\u03b1\u03b4)\n=\n2\u03c0K\u03bb (\u03b1\u03b4) (\u03b4/\u03b1)1/2\u2212\u03bb\n\nr\n\n\u03b1 K\u03bb\u22121/2 (\u03b1\u03b4)\n2\u03c0\u03b4 K\u03bb (\u03b1\u03b4)\n\n(72)\n\nand so\nr\n0\n\nw (0) =\n\n2\u03c0\u03b4 K\u03bb (\u03b1\u03b4)\n\u03b1 K\u03bb\u22121/2 (\u03b1\u03b4)\n\n(73)\n\nThe characteristic moments are given by (exploiting the symmetry)\nEk =\n\n1\n\u03c0\n\nZ\n0\n\n\u221e\n\nz 2k\n\n\u0012\n\n\u03b12\n2\n\u03b1 + z2\n\n\u0013\u03bb/2\n\n\u221a\nK\u03bb (\u03b4 \u03b12 + z 2 )\nK\u03bb (\u03b1\u03b4)\n\n\u221a\n\n\u03b12 + z 2\nZ\n1 \u221e 2\nK\u03bb (\u03b4p)\nEk =\n(p \u2212 \u03b12 )(k\u22121/2) \u03b1\u03bb p1\u2212\u03bb\n\u03c0 \u03b1\nK\u03bb (\u03b1\u03b4)\n\nMaking the change of variable p =\n\n(74)\n\n(75)\n\nThis integral can be evaluated by Mathematica [12], which returns the value\nEk = 2k\u22121/2 \u0393(k + 1/2)\n\n\u0012 \u0013k+1/2\nK1/2+k\u2212\u03bb (\u03b1\u03b4)\n\u03b1\n\u03b4\n\u03c0K\u03bb (\u03b1\u03b4)\n\nsubject to computer-generated constraints k > 0, \u03b1 > 0, \u03b4 > 0, \u03bb < 2.\n\n(76)\n\n\fMonte Carlo sampling given a characteristic function\n\n6.3\n\n11\n\nA Harder Example: the Levy Stochastic Area\n\nThe distribution of the Levy Stochastic Area (LSA) is of considerable interest from the point of view of\nstochastic analysis and high order Monte Carlo simulation. We base our analysis on the approach of Schmitz\n[10]. For a pair of Brownian motions spanning a time \u2206t the LSA is given by\n\u2206t\n\nZ\n\n(W1 (t)dW2 (t) \u2212 W2 (t)dW1 (t))\n\nL(\u2206t) =\n\n(77)\n\n0\n\nIts characteristic function, conditional on a known value of R2 = W12 (\u2206t) + W22 (\u2206t), is known and given by\n\u03c6L (z) = \u03c6X (z)\u03c6Y (z)\nz\u2206t\n\u03c6X (z) =\nsinh(z\u2206t)\n\u0015\n\u0014\n\u0003\nR2 \u0002\nz\u2206t coth(z\u2206t) \u2212 1\n\u03c6Y (z) = exp \u2212\n2\u2206t\n\n(78)\n\nwhere Wi (0) = 0. There are two components. When the path goes nowhere (loop) R = 0 and this is given\nby the random variable X. Then there is a further contribution from Y . This split is convenient as X has a\ntrivial quantile function:\n\u0012\n\u0013\n\u2206t\nu\nQX (u) =\nlog\n(79)\n\u03c0\n1\u2212u\nReaders should consult [10] for details and an extensive discussion of this entity and further references. The\ndifficult part is finding QY (u). The characteristic function is clearly symmetric. The properties of the system\nare best understood by first extracting the time-scaling. From the definition L and X are both O(\u2206t) times\nsome time-scale-independent random variable. So we set Y = \u2206tP and R2 = r2 \u2206t, so that r is the distance\ngone by a Brownian motion in unit time. Making the change of variables shows that\n\u0012 \u0013\nx\n1\ng\n(80)\nfY (x) =\n\u2206t \u2206t\nand the characteristic function of P is just\n\u03c6P (s) = exp[\u2212\n\nr2\n(s coth s \u2212 1)]\n2\n\n(81)\n\nand the associated density function is\ngP (p) =\n\n1\n2\u03c0\n\nZ\n\n\u221e\n\nexp[isp \u2212\n\u2212\u221e\n\nr2\n(s coth s \u2212 1)]ds\n2\n\nWhen s is small or p is large the hyperbolic function may be expanded to give\n\u0012 2 2\u0013\nr s\n\u03c6P (s) \u223c exp \u2212\n6\nso that samples of P may be approximately constructed with\nr\n1\nP \u223cr\nZ\n3\nwhere Z is a Gaussian random variable obtained by a quantile or other means.\n\n7\n\nImplementation\n\nThere are a number of issues to address when it comes to implementation. These include\n\u2022 The management of a symbolic differential recursion;\n\n(82)\n\n(83)\n\n(84)\n\n\f12\n\nW.T. Shaw, J. McCabe\n\n\u2022 The choice of a computer language in which to solve the problem;\n\u2022 Tail management;\n\u2022 Error analysis;\n\u2022 Implementation in legacy or specialized computer environments.\nThe implementation of the differential recursion summarized in Section 4 appears to necessitate a modern\nsymbolic computation environment and we have implemented it in a few lines of Mathematica [12]. But it is\nimportant to point out that this needs only to be done once and we have solved it for the symmetric case,\nthe first few terms being given explicitly in Eqn. (58) up to k = 60? The computation becomes labourious for\nk > 50. The solution can be saved and then exploited. We can carry out the remain parts of the calculation\nentirely in Mathematica, as it can evaluate and store the characteristic moments and generate the relevant\npower series for the central portion of the quantile.\nHowever, while this constitutes a complete solution for a truncated central power series, many potential\nusers may need the ability to migrate the model to another computer language. For example, financial\nspecialists may require C/C++ implementations. Statisticians might want an implementation in R. Some\nscientific and engineering applications will require a FORTRANXX, where probably XX \u2265 90. We can\nconsider trying to migrate the solution to another language at various stages. In this first implementation\nwe will consider a late migration model, with C/C++ as a target. This offers the compromise of getting\nMathematica to do all the hard symbolic work, but we can output very simple C code to embed in a function\nto do the work in another program, once the parameters have been fixed. Migration one stage earlier would\nrequire calling a number of special functions in C, in particular various types of Bessel function. There are\nlibraries to do this. Migration a further step back would require the implementation in C of the solution for the\npk . In principle this could be carried out with the CForm command used below in the late migration approach.\nWe have not considered how the symbolic recursion itself might be solved directly in other languages.\nThe error analysis is difficult as we do not know the benchmark, apart from special cases. We can give\nestimates based on this. Furthermore, if some form of expression for the cumulative distribution function\n(CDF), F , is available, we can certainly estimate the round-trip error\nRT E(u) = F [(Q(u)] \u2212 u\n\n(85)\n\nand from this, given a density f , we can estimate the quantile (EQE) error as\nEQE(u) = (F [Q(u)] \u2212 u)/f [Q(u)]\n\n(86)\n\nwhich is of course the Newton-Raphson correction.\nIn each case the central series will almost almost require a tail model. The power series will work well in\na region \u000f < u < 1 \u2212 \u000f but the region 1 \u2212 \u000f \u2265 u \u2265 1 and its mirror will need separate management.\n\n7.1\n\nSolution of the differential recursion\n\nThis takes place as follows. First we define P2 :\nP[2, x_, w_] := 1/(2 Pi) Integrate[I t Phi[t] Exp[-I t w], {t, -Infinity, Infinity}]\nSubsequent terms are then, for the general case without symmetry, given by\nP[n_, x_, w_] :=\nP[n, x, w] = Expand[n*x*P[2, x, w]*P[n - 1, x, w] +\nx^2 D[P[n - 1, x, w], x] P[2, x, w] + D[P[n - 1, x, w], w]\n\n]\n\nThis is the key calculation. Two other operations rewrite the integrals that result in terms of the Ek and apply\nsymmetries. The program that implements all this is given in Appendix A, where we exploit the symmetry\nto give a program to just work out every other term. The results are stored in a file and we have computed\nas far as p71 in symbolic form.\n\n\fMonte Carlo sampling given a characteristic function\n\n7.2\n\n13\n\nExample 1: Symmetric Stable, central series for quantile\n\nThe symbolic computation of the pk may be combined with the evaluation of the Ek and w0 (0) given in Section\n6.1, to give the central power series for the quantile. The first few terms are given by:\n\u0010\n\u0010\n\u0001\n\u0001\n\u00012 \u0011\u0011\n\u00015\n\u0001\n\u0001\n\u00013\n\u0012\n\u00137 !\n\u03c0 5 \u03b15 \u0393 \u03b11 \u0393 \u03b15 \u2212 10\u0393 \u03b13\nu \u2212 12\n\u03c0\u03b1 u \u2212 21\n\u03c0 3 \u03b13 \u0393 \u03b13 u \u2212 12\n1\n\u0001 +\nw(u) =\n\u2212\n+O\nu\u2212\n\u00014\n\u00017\n2\n\u0393 \u03b11\n6\u0393 \u03b11\n120\u0393 \u03b11\n(87)\nThis expression is useful for some basic checking in the central zone but is not accurate enough for serious\nMonte Carlo simulation. One interesting check is to ask the computer to symbolically invert the series, and\nthen differentiate the result. We obtain\n\u0001\n\u0001\n\u0001\n\u0001\n\u0393 \u03b13 x2\n\u0393 \u03b15 x4\n\u0393 \u03b11\n\u2212\n+\n+ O x6\n(88)\nf (x) =\n\u03c0\u03b1\n2(\u03c0\u03b1)\n24\u03c0\u03b1\nReaders may recognize this as Bergstrom's central series [1] for the density function, which is a nice point of\nverification2 For high precision work, we need more terms. The stored internal representation in Mathematica\nmay be used, and in particular to test the precision of the\n\u221a result for the known Gaussian and Cauchy cases.\nIn the Gaussian case the standard normal quantile is 1/ 2 times the stable quantile with \u03b1 = 2. We may\ncompare the results with Mathematica's internal high-precision routines. We will plot the precision in the form\n\u0014\n\u0015\nPower Series f rom Stable Distribution :\u03b1 = 2\nlog10 \u221a\n\u22121\n(89)\n2 \u00d7 (Internal High \u2212 P recision Quantile)\n\n-6\n-8\n-10\n-12\n-14\n-16\n0.5\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\nFigure 1: Precision of the Gaussian stable quantile: 0.5 \u2264 u \u2264 0.95\n\n-4\n-6\n-8\n-10\n-12\n-14\n-16\n0.5\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\nFigure 2: Precision of the Cauchy stable quantile: 0.5 \u2264 u \u2264 0.95\nWe note that the error is about machine precision level for 0.5 \u2264 u < 0.84 and then rises into the tail,\nremaining at an acceptable level until some point around 0.94. Similar results apply to the Cauchy case, where\n2 The use of Mathematica's InverseSeries command to compute the quantile from a density series may also be invoked, but\nis not practical for very large series.\n\n\f14\n\nW.T. Shaw, J. McCabe\n0\n\n-50\n\n-100\n\n-150\n\n-200\n0.5\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1.0\n\nFigure 3: Full precision of the Gaussian stable quantile: 0.5 \u2264 u \u2264 0.95\n\u221a\nno factor of 1/ 2 is needed, and the error grows slightly faster than in the Gaussian case. Note also that\nthe machine precision oscillations in the plot are due to restricting attention to compiled results within the\nplotting routine - the series becomes much more accurate than one part in 1016 as one approaches the median.\nWe can illustrate this by asking for one of the comparisons to be re-done in arbitrary precision mode. The\nresult is shown in Figure 3, with quad- and double-precision limits shown as horizontal lines at \u221232 and \u221216.\n\n7.3\n\nThe stable quantile with \u03b1 = 3/2: migration to C/C++\n\nHaving tested the symbolic stable quantile on known cases \u03b1 = 2, 1, we now consider the intermediate case\n\u03b1 = 3/2. In this case we may take our symbolic representation and convert it into working C/C++ code. There\nare some helpful intermediate steps. First, we introduce variables v = 2u \u2212 1 and w = v 2 . Second, we use the\nsymbolic computation engine to write the system in the standard nested multiplication form for polynomials\n(truncated power series). In Mathematica this involves the use of the HornerForm function. Finally we use\nCForm to output the code. The output of this takes the form:\nv*(1.74002161967547716294123 +\nw*(0.648419685395586217984681 +\nw*(0.452196867009616298571941 +\nw*(0.371651133863068554240291 +\nw*(0.32860784309392901699825 +\nw*(0.302354425634672539752731 +\nw*(0.285017852611712836182585 +\nw*(0.272940090886219734608815 +\nw*(0.264185174645675414204326 +\nw*(0.257629942234930169112297 +\nw*(0.25257672730254977798406 +\nw*(0.248568819726342542363224 +\nw*(0.245294721047639736371026 +\nw*(0.242535016745509439912893 +\nw*(0.240131243639121611881269 +\nw*(0.237966799943489229416831 +\nw*(0.235954779696462330935446 +\nw*(0.234029956041290960707096 +\nw*(0.232143339065715759679999 +\nw*(0.230258380102825285626612 +\nw*(0.228348256742232151582891 +\nw*(0.226393883462430267805038 +\nw*(0.224382419242756015826282 +\nw*(0.2223061215967177252663 +\nw*(0.220161445928088782138854 +\nw*(0.217948321166808082853286 +\nw*(0.215669553853982023082385 +\n\n\fMonte Carlo sampling given a characteristic function\n\n15\n\nw*(0.213330327149878379304031 +\nw*(0.210937771052290678843475 +\nw*(0.208500586950509676634869 +\nw*(0.206028714471339648851334 +\nw*(0.203533032028819495783199 +\nw*(0.201025084985861029012365 +\nw*(0.198516837154295178958399 +\n(0.196020442690960745941278 +\n0.19354803642357645356947*w)*w)))))))))))))\n)))))))))))))))))))))\nand gives a directly usable implementation in C/C++ that can be pasted into a simulation code. Full details\nof how this was generated are given in Appendix B and are also available on-line.\n\n7.4\n\nTail model for the stable quantile\n\nThe power series computed thus far is a power series about the median, and as shown in the example precision\nplot for the Gaussian, loses precision in the tail. In each case we need to augment the quantile model by\nproducing a separate model for the tail. We can of course add more and more terms to the power series,\nbut ultimately we are confronted by the fact that usually such series should diverge as |2u \u2212 1| \u2192 1 and a\npolynomial truncation of the series is not enough.\nThere is an interesting mathematical question here. Should one try to develop a general theory based on\nsome asymptotic analysis of the characteristic quantile equation? Or should one employ known information\nabout particular cases? In this note we will take the latter approach, as there is a great deal of useful\ninformation available.\nIn the symmetric stable case the relevant asymptotic series for the distribution function were established\nover 50 years ago by Bergstr\u00f6m [1], based on earlier work on Laplace transforms by Pollard and others [?].\nAn easily accessible paper [4] has a formula (Eqn 2.9 of [4]) whose integral gives, for x \u2192 \u221e, and \u03b1 6= 2, and\nafter some simplification\n\u0012\n\u0013\nN\nk\u03c0\u03b1\n1\n1 X \u0393(k\u03b1)\nk\u22121\n(\u22121)\nsin\n(90)\nF (x) \u223c 1 \u2212\n\u03c0\nk!\n2\nxk\u03b1\nk=1\n\nWe have found that the formal inversion of this series with N = 4 provides a satisfactory tail model with a\nreasonably kinkless join to the power series. The result takes the form, for \u03b1 < 2,\n\u001a\nw(u) \u223c\n\nc\u22121\n+ c0 + c1 (1 \u2212 u) + c2 (1 \u2212 u)2\n(1 \u2212 u)\n\n\u001b(1/\u03b1)\n(91)\n\nwhere the coefficients are given by\n\u0001\n\u0393(\u03b1) sin \u03c0\u03b1\n2\nc\u22121 =\n\u03c0 \u0001\ncos \u03c0\u03b1\n\u0393(2\u03b1)\n2\nc0 = \u2212\n\u0393(\u03b1)\n\u0001\n\u0001\n\u0001\n\u0001\n\u03c0 csc2 \u03c0\u03b1\n2\u0393(\u03b1)\u0393(3\u03b1) sin 3\u03c0\u03b1\n\u2212 3 csc \u03c0\u03b1\n\u0393(2\u03b1)2 sin2 (\u03c0\u03b1)\n2\n2\n2\nc1 =\n12\u0393(\u03b1)3\n\u0001\n\u0001\n\u0001\n\u03c0 2 cot \u03c0\u03b1\ncsc \u03c0\u03b1\n6(cos(\u03c0\u03b1) + 1)\u0393(2\u03b1)3 \u2212 3(2 cos(\u03c0\u03b1) + 1)\u0393(\u03b1)\u0393(3\u03b1)\u0393(2\u03b1) + cos(\u03c0\u03b1)\u0393(\u03b1)2 \u0393(4\u03b1)\n2\n2\nc2 = \u2212\n6\u0393(\u03b1)5\n(92)\nThe testing of such representations for intermediate \u03b1 requires comparison with specialist models for the stable\ndistribution. In this case we made a comparison of the results with those published on the web by J. Nolan,\nat\n\n\\protect\\vrule width0pt\\protect\\href{http://academic2.american.edu\\string~jpnolan/stable/quantile.dat}\n\n\f16\n\nW.T. Shaw, J. McCabe\n\nWe found that for 0.1 < u < 0.9 the relative error between our results and Nolan's easily is less than 10\u22126 ,\ngiving high confidence in the power series. With the simple tail model the precision over the entire range is\nas shown in the figure.\n\n7.5\n\nNon-analytic density functions\n\nIn the detailed analysis given thus far, we have considered the analytic case. By no means all densities of\ninterest fall into this category, and we must also treat cases where not all of the characteristic moments exist.\nFor example, consider the (symmetric) variance gamma (VG) case. Taking the limit \u03b4 \u2192 0+ in the generalized\nhyperbolic model gives us the characteristic function\n\u0012\n\u03c8(t) =\n\n\u03b12\n2\n\u03b1 + t2\n\n\u0013\u03bb\n(93)\n\nand the density\nf (x) =\n\n\u0010 \u03b1 \u0011\u03bb+1/2\n2\n\n\u221a\n\n1\n|x|\u03bb\u22121/2 K\u03bb\u22121/2 (\u03b1|x|)\n\u03c0\u0393(\u03bb)\n\n(94)\n\nThe full VG model falls into the category of exponential asymmetry, with characteristic function\n\u0012\n\u03c8(t) =\n\n\u03b12 \u2212 \u03b2 2\n\u03b12 + (t \u2212 i\u03b2)2\n\n\u0013\u03bb\n(95)\n\nA careful expansion of the density reveals that it comprises one power series in x2 and a second power series\nin x2 times x(2\u03bb\u22121) , so that a generalization of the methods developed here is needed for general \u03bb. There\nare logarithmic contributions when \u03bb = 1/2. In general \u03c8 \u223c t\u22122\u03bb as t \u2192 \u221e so we can also see that not\nall the characteristic moments exist. One approach to VG is to exploit a non-uniform base distribution, as\ndiscussed in [8] - in particular an exponential base is a convenient starting point for VG, hyperbolic and normal\ndistributions.\n\n8\n\nConclusions\n\nWe have shown in principle how to establish a power series about the median for quantile functions characterized by a characteristic function linked to a smooth but possibly non-explicit density. This has been\nelucidated in sufficient detail for symmetric distributions based on a detailed symbolic solution of a non-linear\nintegro-differential equation. Further work is in progress to treat asymmetric cases and characteristic functions\ncorresponding to non-smooth densities, as well as tail representations.\n\nAcknowledgements\nWe wish to acknowledge useful conversations or correspondence with G. Steinbrecher, J.P. Nolan and D. Scott.\nJ. McCabe is supported by the UK EPSRC.\n\nReferences\n[1] R. Bergstrom, On some expansions of stable distribution functions. Ark. Mat., 2, 375-378.\n[2] J. Gil-Pelaez, 1951, Note on the inversion theorem. Biometrika, 37, 481-481.\n[3] S. Hurst, 1995, The characteristic function of the Student t Distribution, Financial Mathematics Research Report FMRR006-95, ANU Report.\nwwwmaths.anu.edu.au/research.reports/srr/95/044/SRR95-044-scan.pdf\n[4] M. Matsui and A. Takemura, 2006, Some Improvements in Numerical Evaluation of Symmetric Stable\nDensity and its Derivatives, Comm. Stat. - Theory and Methods, 35, 1, 149-172.\n\n\fMonte Carlo sampling given a characteristic function\n\n17\n\n[5] J.P. Nolan, 1997, Numerical calculation of stable densities and distributions. Comm. Statist. Stochastic\nModels, 13, 759-774.\n[6] J.P. Nolan, 1998, Parameterizations and models of stable distributions. Statist. Prob. Lett., 38, 187-195..\n[7] W. T. Shaw, Sampling Student's T distribution - use of the inverse cumulative distribution function.\nJournal of Computational Finance, Vol. 9, No. 4, 2006\n[8] W. T. Shaw and N. Brickman, 2009. Differential equations for Monte Carlo recycling and a GPUoptimized Normal quantile. Working paper. arXiv:0901.0638v3 [q-fin.CP]\n[9] N. G. Shephard, 1991, From characteristic function to distribution function: a simple framework for\nthe theory. Econometric Theory, 7, 519-529.\n[10] K. Schmitz-Abe Pricing Exotic Options using Improved Strong Convergence, D.Phil thesis, University\nof Oxford, 2007.\n\n\\protect\\vrule width0pt\\protect\\href{http://people.maths.ox.ac.uk\\string~schmitz/Download/Projects/\n[11] G. Steinbrecher and W.T. Shaw, Quantile Mechanics. European Journal of Applied Mathematics,\n19(2), pp 87-112, 2008.\n[12] S. Wolfram Mathematica Version 6, 2007.\n\nAppendix A: Mathematica code for the symbolic recursion\nThe actual program used for the symmetric case was as follows. Here we work out every other term, but start\nthe recursion carefully. First we give the starting values:\nPP[2, x_, w_] :=\n1/(2 Pi) Integrate[\nI t \\[CapitalPhi][t] Exp[-I t w], {t, -Infinity, Infinity}]\nPP[3, x, w] =\nExpand[3*x*PP[2, x, w]*PP[2, x, w] +\nx^2 D[PP[2, x, w], x] PP[2, x, w] + D[PP[2, x, w], w]]\n\n;\n\nNext we give a second order iteration based on a repeated application of the first order form:\nPP[n_, x_, w_] :=\nPP[n, x, w] =\nExpand[n*x*\nPP[2, x,\nw]*((n - 1)*x*PP[2, x, w]*PP[n - 2, x, w] +\nx^2 D[PP[n - 2, x, w], x] PP[2, x, w] +\nD[PP[n - 2, x, w], w]) +\nx^2 D[((n - 1)*x*PP[2, x, w]*PP[n - 2, x, w] +\nx^2 D[PP[n - 2, x, w], x] PP[2, x, w] +\nD[PP[n - 2, x, w], w]), x] PP[2, x, w] +\nD[((n - 1)*x*PP[2, x, w]*PP[n - 2, x, w] +\nx^2 D[PP[n - 2, x, w], x] PP[2, x, w] +\nD[PP[n - 2, x, w], w]), w]]\nNext we give the rules that set to zero terms that must vanish by symmetry:\nrulesa = Table[\nIntegrate[\nI*t^(4 k + 1)*\\[CapitalPhi][t], {t, -Infinity, Infinity}] ->\n\n\f18\n\nW.T. Shaw, J. McCabe\n\n0, {k, 0, 100}];\nrulesb = Table[\nIntegrate[-I*t^(4 k - 1)*\\[CapitalPhi][t], {t, -Infinity,\nInfinity}] -> 0, {k, 1, 100}];\nrules = Join[rulesa, rulesb];\nThen we give some results to write integrals in terms of the Ek .\nsrules = Join[\nTable[Integrate[\nt^(2 k) \\[CapitalPhi][t], {t, -Infinity, Infinity}] ->\n2 Pi EE[k], {k, 1, 200}],\nTable[Integrate[-t^(2 k) \\[CapitalPhi][t], {t, -Infinity,\nInfinity}] -> -2 Pi EE[k], {k, 2, 200}]];\nWe initialize an array for solution:\nparr = Array[p, 200];\nWe run the iteration as far as time allows, writing a file every ten steps, or every iteration after 60, to secure\nprogress made so far.\nDo[dummya = PP[k, x, w] /. w -> 0;\ndummyb = (dummya /. rules) /. srules; p[k] = Collect[dummyb, x];\nIf[k >= 7, (PP[k - 2, x, w] = 0)];\nPrint[k, \" Memory in Use = \", N[MemoryInUse[]/10^6]];\nIf[Mod[k + 1, 10] == 0 || k > 60 ,\nSave[ToString[k] <> \"pcoeff\", parr]], {k, 3, 101, 2}]\nIn our case we ran the code on a 2.8GHz Mac Pro and secured terms up to p71 . We would be interested to hear\nabout more efficient solutions. However, this many terms is sufficient for some serious practical applications,\nand we worked with the file 71pcoeff for the computed examples.\nThe Mathematica notebook CharacteristicQuantileSeriesGen to generate the coefficients and the output files xxpcoeffs are available from the links at the web site\nwww.mth.kcl.ac.uk/~shaww/web_page/papers/charquantiles/\n\nAppendix B: Generation of C/C++ code for the stable quantile\nHere we show how to generate C/C++ code in the late migration approach for the case of the stable quantile.\nThe Mathematica notebook CharacteristicQuantileExamples to do this is available from the web site\nwww.mth.kcl.ac.uk/~shaww/web_page/papers/charquantiles/\nThe operations needed are as follows. First we load the general series data:\n<< \"71pcoeff\"\nNext we define the characteristic moments, w0 (0) and some rules:\ng[k_] = 2 Integrate[t^(2 k)*Exp[-Abs[t]^\\[Alpha]], {t, 0, Infinity},\nAssumptions -> {\\[Alpha] > 0, k > -1/2}];\nstablerules = Table[EE[k] -> 1/(2 Pi) g[k], {k, 1, 60}];\nwdash = 1/( 1/(2 Pi) g[0]);\nThe definitions of the rules rulesa, rulesb, rules, srules given in Appendix A are also re-loaded, and\nthe series is then constructed in two steps:\nseries = Table[(((parr[[2 m + 1]] x/(2 m + 1)! ) /. rules) /.\nsrules /. stablerules), {m, 1, 35}];\nStableSeries = series /. x -> wdash;\n\n\fMonte Carlo sampling given a characteristic function\n\n19\n\nCreating the Gaussian example\nThis is now easily done:\nGaussStableSeries = (series /. x -> wdash /. \\[Alpha] -> 2);\nwdashGauss = (wdash /. \\[Alpha] -> 2);\nGaussStableQuantile[u_] =\n1/Sqrt[2] (wdashGauss*(u - 1/2) +\nSum[GaussStableSeries[[k]]*(wdashGauss*(u - 1/2))^(2 k + 1), {k,\n1, 35}]);\n\nCreating the \u03b1 = 3/2 example\nThis is now easily done:\nthreehalfStableSeries = (series /. x -> wdash /. \\[Alpha] -> 3/2);\nwdashthreehalf = (wdash /. \\[Alpha] -> 3/2);\nThreeHalfStableQuantile[\nu_] = (wdashthreehalf*(u - 1/2) +\nSum[threehalfStableSeries[[\nk]]*(wdashthreehalf*(u - 1/2))^(2 k + 1), {k, 1, 35}]);\nThe function ThreeHalfStableQuantile may then be used within Mathematica. Within the late migration\napproach, we convert to C/C++ by first creating a suitable form for export. The following code accomplishes\nthree things\n\u2022 works in terms of 2u \u2212 1 in order to get radius of convergence unity and better control of the scale of\nthe coefficients;\n\u2022 uses variables v = 2u \u2212 1, w = v 2 ;\n\u2022 converts to nested multiplication form.\nexportThreeHalf =\nHornerForm[\nN[(wdashthreehalf*v/2 +\nSum[threehalfStableSeries[[\nk]]*(wdashthreehalf*(v/2))^(2 k + 1), {k, 1, 35}]), 24]] /.\nv^2 -> w;\nThen to generate the C/C++ code listing in Section 7.3 , we merely apply\nCForm[exportThreeHalf]\nto obtain the results shown.\n\n\f"}