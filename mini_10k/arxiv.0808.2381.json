{"id": "http://arxiv.org/abs/0808.2381v2", "guidislink": true, "updated": "2009-07-24T06:52:11Z", "updated_parsed": [2009, 7, 24, 6, 52, 11, 4, 205, 0], "published": "2008-08-18T12:43:02Z", "published_parsed": [2008, 8, 18, 12, 43, 2, 0, 231, 0], "title": "On finite-index extensions of subgroups of free groups", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0808.3603%2C0808.1935%2C0808.2542%2C0808.2608%2C0808.2437%2C0808.1919%2C0808.0820%2C0808.2214%2C0808.2744%2C0808.0512%2C0808.1148%2C0808.1596%2C0808.1669%2C0808.1470%2C0808.2328%2C0808.0075%2C0808.1732%2C0808.0254%2C0808.0831%2C0808.2129%2C0808.2022%2C0808.2837%2C0808.0236%2C0808.2551%2C0808.0112%2C0808.1355%2C0808.1389%2C0808.2540%2C0808.0524%2C0808.3158%2C0808.1387%2C0808.3391%2C0808.1429%2C0808.0225%2C0808.3053%2C0808.1471%2C0808.1330%2C0808.1311%2C0808.0882%2C0808.0936%2C0808.2122%2C0808.2256%2C0808.2875%2C0808.0015%2C0808.0691%2C0808.0992%2C0808.0478%2C0808.1674%2C0808.1731%2C0808.2381%2C0808.3293%2C0808.2770%2C0808.2726%2C0808.2341%2C0808.1727%2C0808.1928%2C0808.0008%2C0808.0276%2C0808.2613%2C0808.0375%2C0808.0865%2C0808.2072%2C0808.3190%2C0808.2681%2C0808.3984%2C0808.3964%2C0808.1484%2C0808.1456%2C0808.2124%2C0808.2759%2C0808.4001%2C0808.1273%2C0808.0162%2C0808.0883%2C0808.1618%2C0808.1117%2C0808.0191%2C0808.1323%2C0808.3041%2C0808.1713%2C0808.2970%2C0808.1398%2C0808.2801%2C0808.4097%2C0808.2554%2C0808.3438%2C0808.0948%2C0808.0098%2C0808.3056%2C0808.1514%2C0808.0527%2C0808.1237%2C0808.2034%2C0808.2985%2C0808.0921%2C0808.3017%2C0808.2408%2C0808.4068%2C0808.3893%2C0808.1889%2C0808.1354&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "On finite-index extensions of subgroups of free groups"}, "summary": "We study the lattice of finite-index extensions of a given finitely generated\nsubgroup $H$ of a free group $F$. This lattice is finite and we give a\ncombinatorial characterization of its greatest element, which is the\ncommensurator of $H$. This characterization leads to a fast algorithm to\ncompute the commensurator, which is based on a standard algorithm from automata\ntheory. We also give a sub-exponential and super-polynomial upper bound for the\nnumber of finite-index extensions of $H$, and we give a language-theoretic\ncharacterization of the lattice of finite-index subgroups of $H$. Finally, we\ngive a polynomial time algorithm to compute the malnormal closure of $H$.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0808.3603%2C0808.1935%2C0808.2542%2C0808.2608%2C0808.2437%2C0808.1919%2C0808.0820%2C0808.2214%2C0808.2744%2C0808.0512%2C0808.1148%2C0808.1596%2C0808.1669%2C0808.1470%2C0808.2328%2C0808.0075%2C0808.1732%2C0808.0254%2C0808.0831%2C0808.2129%2C0808.2022%2C0808.2837%2C0808.0236%2C0808.2551%2C0808.0112%2C0808.1355%2C0808.1389%2C0808.2540%2C0808.0524%2C0808.3158%2C0808.1387%2C0808.3391%2C0808.1429%2C0808.0225%2C0808.3053%2C0808.1471%2C0808.1330%2C0808.1311%2C0808.0882%2C0808.0936%2C0808.2122%2C0808.2256%2C0808.2875%2C0808.0015%2C0808.0691%2C0808.0992%2C0808.0478%2C0808.1674%2C0808.1731%2C0808.2381%2C0808.3293%2C0808.2770%2C0808.2726%2C0808.2341%2C0808.1727%2C0808.1928%2C0808.0008%2C0808.0276%2C0808.2613%2C0808.0375%2C0808.0865%2C0808.2072%2C0808.3190%2C0808.2681%2C0808.3984%2C0808.3964%2C0808.1484%2C0808.1456%2C0808.2124%2C0808.2759%2C0808.4001%2C0808.1273%2C0808.0162%2C0808.0883%2C0808.1618%2C0808.1117%2C0808.0191%2C0808.1323%2C0808.3041%2C0808.1713%2C0808.2970%2C0808.1398%2C0808.2801%2C0808.4097%2C0808.2554%2C0808.3438%2C0808.0948%2C0808.0098%2C0808.3056%2C0808.1514%2C0808.0527%2C0808.1237%2C0808.2034%2C0808.2985%2C0808.0921%2C0808.3017%2C0808.2408%2C0808.4068%2C0808.3893%2C0808.1889%2C0808.1354&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "We study the lattice of finite-index extensions of a given finitely generated\nsubgroup $H$ of a free group $F$. This lattice is finite and we give a\ncombinatorial characterization of its greatest element, which is the\ncommensurator of $H$. This characterization leads to a fast algorithm to\ncompute the commensurator, which is based on a standard algorithm from automata\ntheory. We also give a sub-exponential and super-polynomial upper bound for the\nnumber of finite-index extensions of $H$, and we give a language-theoretic\ncharacterization of the lattice of finite-index subgroups of $H$. Finally, we\ngive a polynomial time algorithm to compute the malnormal closure of $H$."}, "authors": ["Pedro Silva", "Pascal Weil"], "author_detail": {"name": "Pascal Weil"}, "author": "Pascal Weil", "links": [{"href": "http://arxiv.org/abs/0808.2381v2", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/0808.2381v2", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "math.GR", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "math.GR", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "20E05", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/0808.2381v2", "affiliation": "LaBRI", "arxiv_url": "http://arxiv.org/abs/0808.2381v2", "arxiv_comment": null, "journal_reference": "Journal of Group Theory 13, 3 (2010) 365-381", "doi": null, "fulltext": "arXiv:0808.2381v2 [math.GR] 24 Jul 2009\n\nOn finite-index extensions of subgroups of free\ngroups\u2217\nPedro Silva,\n\npvsilva@fc.up.pt\n\nCentro de Matem\u00e1tica, Universidade do Porto\n\nPascal Weil,\n\n\u2020\n\npascal.weil@labri.fr\n\nLaBRI, Universit\u00e9 de Bordeaux, CNRS and CSE Department, IIT Delhi\u2021\n\nAbstract\nWe study the lattice of finite-index extensions of a given finitely generated subgroup H of a free group F . This lattice is finite and we give a\ncombinatorial characterization of its greatest element, which is the commensurator of H. This characterization leads to a fast algorithm to compute the commensurator, which is based on a standard algorithm from\nautomata theory. We also give a sub-exponential and super-polynomial\nupper bound for the number of finite-index extensions of H, and we give a\nlanguage-theoretic characterization of the lattice of finite-index subgroups\nof H. Finally, we give a polynomial time algorithm to compute the malnormal closure of H.\n\nKeywords: free groups, subgroups, finite-index extensions\nMSC: 20E05\nThis paper is part of the study of the lattice of finitely generated subgroups\nof a free group of finite rank F . Like most of the recent work on this topic, our\npaper makes crucial use of the graphical representation of the subgroups of F\nintroduced in the seminal papers of Serre (1977 [8]) and Stallings (1983 [11]).\nThis representation not only makes it easier to form an intuition and to prove\nproperties of subgroups of F , but it also provides a convenient framework to\nefficiently solve algorithmic problems and compute invariants concerning these\nsubgroups.\n\u2217 The first author acknowledges support from Project ASA (PTDC/MAT/65481/2006) and\nC.M.U.P., financed by F.C.T. (Portugal) through the programmes POCTI and POSI, with\nnational and European Community structural funds. Both authors acknowledge support from\nESF project AutoMathA.\n\u2020 Faculdade de Ci\u00eancias, Universidade do Porto, R. Campo Alegre 687, 4169-007 Porto,\nPortugal\n\u2021 LaBRI, 351 cours de la Lib\u00e9ration, 33400 Talence, France.\n\n1\n\n\fThe particular object of study in this paper is the lattice of extensions of a\ngiven finitely generated subgroup H of F , and more specifically the sublattice of\nfinite-index extensions of H. In this paper, all groups are subgroups of a fixed\nfree group, and the notion of extension must be understood in this context.\nIt is elementary to verify that H has only finitely many finite-index extensions, and it is known that if K and L are finite-index extensions of H, then the\nsubgroup they generate, namely hK, Li, has finite index over H as well (Greenberg's theorem, see [11]). Therefore H has a maximum finite-index extension\nHfi , which is effectively constructible, and the finite-index extensions of H form\na full convex sublattice of the lattice of subgroups of F .\nThis paper contains a detailed discussion of the lattice of finite-index extensions of H. Our main contributions are the following.\nWe show that the maximum finite-index extension Hfi of H is the commensurator of H, and we give a combinatorial (graph-theoretic) characterization\nof Hfi . This characterization leads to efficient algorithms to compute all finiteindex extensions of H, and to compute Hfi \u2013 the latter in time O(n log n). We\nalso give a rather tight upper\non the number of finite-index extensions\n\u221a bound\n1\nof H: there are at most O( n n 2 log2 n ) such extensions, where n is the number\nof vertices in the graphical representation of H. Note that this upper bound is\nsub-exponential but super-polynomial.\nThe consideration of the subgroups of the form Hfi , which have no proper\nfinite-index extensions, leads us to the dual study of the lattice of finite-index\nsubgroups of a given subgroup, and we give a combinatorial (language-theoretic)\ncharacterization of each such lattice.\nFinally, we use our better understanding of the lattice of extensions of a\nsubgroup of F , to give a polynomial time algorithm to compute the malnormal\nclosure of a given subgroup.\nAs we already indicated, we use in a fundamental way the graphical representation of finitely generated subgroups of F , including a detailed study of the\ndifferent steps of the computation of this representation (given a set of generators for the subgroup H), whose study was at the heart of an earlier paper by\nthe authors [10]. It is particularly interesting to see that language-theoretic results and arguments play an important role in this paper: that is, we sometimes\nconsider the graphical representation of a subgroup not just as an edge-labeled\ngraph, but as a finite state automaton. Such considerations are present in almost all the results of this paper, but they become crucial at a rather unexpected\njuncture: the design of an efficient algorithm to compute the maximal finiteindex extension Hfi of H. Indeed, the very low complexity we achieve is due\nto the possibility of using a standard automata-theoretic algorithm, namely the\ncomputation of the minimal automaton of a regular language.\nSection 1 summarizes a number of well-known facts about free groups and\nthe representation of their finitely generated subgroups, which will be used freely\nin the sequel (see [11, 12, 5, 7, 10] for more details). Section 2 is the heart of the\npaper: it starts with a technical study of the different steps of the algorithm to\ncompute the graphical representation of a given subgroup, and a description of\nthose steps which preserve finite-index (Section 2.2). These technical results are\n2\n\n\fthen used to characterize the maximal finite-index extension Hfi (Section 2.3),\nto relate the computation of Hfi and the minimization of certain finite-state automata (Section 2.4), to evaluate the maximal number of finite-index extensions\nof a given subgroup (Section 2.5), and to describe an invariant of the lattice of\nfinite-index subgroups of a given subgroup (Section 2.6).\nFinally, we apply the same ideas in Section 3, to study the malnormal closure\nof a subgroup, and to show that it can be computed in polynomial time.\n\n1\n\nSubgroups of free groups and Stallings graphs\n\nLet F be a finitely generated free group and let A = {a1 , . . . , ar } be a fixed\nbasis of F . Let \u0100 = {\u01011 , . . . , \u0101r } be a disjoint copy of A and let \u00c3 = A \u222a \u0100: as\n \u0304 = a if\nusual, we extend the map a 7\u2192 \u0101 from the set A to all words by letting \u0101\n\u2217\na \u2208 A and ua = \u0101\u016b if a \u2208 \u00c3 and u \u2208 \u00c3 . As usual again, the elements of F are\nidentified with the reduced words over the alphabet \u00c3, that is, the words that\ndo not contain a sequence of the form a\u0101 (a \u2208 \u00c3). If u \u2208 \u00c3\u2217 is an arbitrary\nword, we denote by red(u) the corresponding reduced word, that is, the word\nobtained from u by repeatedly deleting all sequences of the form a\u0101 (a \u2208 \u00c3).\nA reduced word u \u2208 F is cyclically reduced if u cannot be written as u = av\u0101\nwith a \u2208 \u00c3 and v \u2208 F . Every reduced word u can be factored in a unique way\nin the form u = xy x\u0304, with y cyclically reduced.\nIf H is a subgroup of F , an extension of H is any subgroup G containing\nH and we write H \u2264 G. If H is finitely generated, we also write H \u2264fg G. If\nH has finite index in G, we say that G is a finite-index extension of H and we\nwrite H \u2264fi G. Finally, we write H \u2264ff G if H is a free factor of G.\n\n1.1\n\nThe graphical representation of a subgroup\n\nIt is well known (since Serre's and Stalling's fundamental work [8, 11]) that every\nfinitely generated subgroup H \u2264fg F admits a unique graphical representation\nof the form A(H) = (\u0393(H), 1), where \u0393(H) is a finite directed graph with Alabeled edges and 1 is a designated vertex of \u0393(H), subject to the combinatorial\nconditions below. Here, a graph is a pair (V, E) where V is the set of vertices\nand E \u2286 V \u00d7A\u00d7V is the set of edges; the in-degree (resp. out-degree) of a vertex\nv \u2208 V is the number of edges in E of the form (v \u2032 , a, v) (resp. (v, a, v \u2032 )); and\nthe degree of v is the sum of its in- and out-degree. Every pair A(H) satisfies\nthe following:\n- the (underlying undirected) graph is connected;\n- for each a \u2208 A, every vertex is the source (resp. the target) of at most one\na-labeled edge;\n- and every vertex, except possibly 1, has degree at least 2.\nMoreover, every pair (\u0393, 1) with these properties is said to be admissible, and it\nis the representation of a finitely generated subgroup of F . In addition, given a\nfinite set of generators of H, the representation of H is effectively computable.\n\n3\n\n\fWe refer the reader to [11, 5, 7, 12, 10] for some of the literature on this construction and its many applications, and to Section 2.1 below on the construction of\nA(H).\nWe sometimes like to view the A-labeled graph \u0393(H) as a transition system\nover the alphabet \u00c3: if p, q are vertices of \u0393(H), a \u2208 A and (p, a, q) is an edge\nof \u0393(H), we say that a labels a path from p to q and \u0101 labels a path from q to\na\n\u0101\np, written p \u2212\u2192 q and q \u2212\u2192 p. If u \u2208 \u00c3\u2217 is a word (reduced or not) and u = va\nu\nv\na\n(a \u2208 \u00c3), we say that p \u2212\u2192 q (u labels a path from p to q) if p \u2212\u2192 p\u2032 \u2212\u2192 q for\n\u2032\nsome vertex p . In particular, a reduced word is in H if and only if it labels a\nu\nloop at vertex 1. Moreover, if we have a path p \u2212\u2192 q, then we also have a path\nred(u)\n\np \u2212\u2192 q.\nIf H \u2264fg G \u2264fg F , then there is a homomorphism from A(H) into A(G),\nthat is, a map \u03c6 from the vertex set of \u0393(H) to the vertex set of \u0393(G) such that\n- \u03c6(1) = 1 and\na\na\n- if p \u2212\u2192 q in \u0393(H) (p, q vertices, a \u2208 \u00c3), then \u03c6(p) \u2212\u2192 \u03c6(q) in \u0393(G).\nIt is not difficult to verify that this morphism, if it exists, is unique, and we\nG\ndenote it by \u03c6G\nH . It is well known (see [8, 11, 5, 7]) that if \u03c6H is one-to-one,\nthen H \u2264ff G.\nFinally, we say that the homomorphism \u03c6G\nH is a cover, if it satisfies\na\nG\n- if p, q are vertices of \u0393(H), a \u2208 \u00c3 and \u03c6G\nH (p) \u2212\u2192 \u03c6H (q) in \u0393(G), then\na\n\u2032\nG\np \u2212\u2192 q \u2032 in \u0393(H) for some vertex q \u2032 such that \u03c6G\nH (q ) = \u03c6H (q). In that case, all\n\u22121\nsets of the form (\u03c6G\n)\n(q)\n(q\na\nvertex\nof\n\u0393(G))\nhave\nthe\nsame cardinality.\nH\nCovers have the following property, which we will use freely in the sequel.\nLemma 1.1 If \u03c6: A(H) \u2192 A(G) is a cover, p is a vertex of A(H) and u \u2208 F\nlabels a loop of A(G) at \u03c6(p), then red(um ) labels a loop of A(H) at p for some\ninteger m > 1.\n\n1.2\n\nCovers, cyclically reduced subgroups and finite-index\nextensions\n\nLet us say that H is cyclically reduced (with respect to the basis A) if every\nvertex of \u0393(H) has degree at least equal to 2. If H is not cyclically reduced, then\nthe designated vertex 1 of \u0393(H) has degree 1 and \u0393(H) consists of two parts:\ntail(\u0393(H)), which contains the designated vertex 1 and all degree 2 vertices that\ncan be connected to vertex 1 through other degree 2 vertices; and the rest of\n\u0393(H), which is called the core of \u0393(H), written cc(\u0393(H)). We let tH (1) be the\nshortest word which labels a path from 1 to a vertex in cc(\u0393(H)) and let \u03c4H (1)\nbe the vertex of cc(\u0393(H)) thus reached (if H is cyclically reduced, then tH (1)\nis the empty word and \u03c4H (1) = 1). We write t(1) and \u03c4 (1) if the subgroup H is\nclear from the context.\nThe tail and the core of \u0393(H) have intrinsic characterizations. The characterization of the core is well-known (see [11, Exercise 7.3(a)]) and that of the\ntail is an elementary consequence.\n\n4\n\n\fRemark 1.2 Let H \u2264fg F and let p be a vertex of \u0393(H). Then p is a vertex\nof cc(\u0393(H)) if and only if some cyclically reduced word u labels a path from p\nto p.\n\u2293\n\u2294\nProof. By definition, if H is not cyclically reduced, then tail(\u0393(H)) consists of\na single path from vertex 1 to vertex t(1) (excluding the latter vertex): it is\ntherefore elementary to verify that no non-empty cyclically reduced word labels\na loop at a vertex in tail(\u0393(H)).\nLet now p be a vertex in cc(\u0393(H)): then p has degree at least 2, and if it\nhas degree exactly 2, then neither of the two edges adjacent to it leads to a\nvertex in tail(\u0393(H)). Therefore, one can find distinct letters a, a\u2032 \u2208 \u00c3 such that\na\u2032\n\na\n\np \u2212\u2192 q and p \u2212\u2192 q \u2032 , with q and q \u2032 in cc(\u0393(H)) as well. Iterating this reasoning,\none can show that there exist arbitrarily long paths within cc(\u0393(H)), starting\nfrom p and labeled by reduced words of the form au and a\u2032 u\u2032 . Since \u0393(H) is\nfinite, vertices are repeated along these paths, and we consider the earliest such\nrepetition after the initial p. If p itself is the first repeated vertex along the\nau\npath labeled au, we have a loop p \u2212\u2192 p such that au is cyclically reduced, and\nwe are done. The situation is similar if p is the first repeated vertex along the\npath labeled a\u2032 u\u2032 . Otherwise, let r and r\u2032 be the first repeated vertices along\nau\nthe two paths. Then r 6= p, r\u2032 6= p, and cc(\u0393(H)) has paths of the form p \u2212\u2192 r,\na\u2032 u\u2032\n\nv\n\nv\u2032\n\np \u2212\u2192 r\u2032 , r \u2212\u2192 r and r\u2032 \u2212\u2192 r\u2032 such that auv\u016b\u0101, a\u2032 u\u2032 v \u2032 \u016b\u2032 \u0101\u2032 are reduced. Then the\nword auv\u016b\u0101a\u2032 u\u2032 v \u2032 \u016b\u2032 \u0101\u2032 is cyclically reduced, and it labels a loop at p in \u0393(H).\nThis concludes the proof.\n\u2293\n\u2294\nRemark 1.3 Let H \u2264fg F . Then t(1) is the maximum common prefix of the\nnon-trivial elements of H.\n\u2293\n\u2294\n\nProof. Since every non-trivial element of H is the label of a loop at 1 in \u0393(H),\nit is clear that t(1) is a common prefix to all these words.\nBy Remark 1.2, there exists a cyclically reduced word u labeling a loop at\n\u03c4 (1). Then both t(1)ut(1) and t(1)\u016bt(1) are reduced words in H, and their\nmaximum common prefix is t(1). This concludes the proof.\n\u2293\n\u2294\nWe can now state the following extension of the classical characterization of\nfinite-index extensions of cyclically reduced subgroups in terms of covers.\nProposition 1.4 Let H \u2264fg G \u2264fg F . Then tG (1) is a prefix of t(H). Moreover, H \u2264fi G if and only if tH (1) = tG (1) and the restriction of \u03c6G\nH is a cover\nfrom (cc(\u0393(H)), \u03c4H (1)) onto (cc(\u0393(G)), \u03c4G (1)). If that is the case, the index\n\u22121\nof H in G is the common cardinality of the subsets \u03c6G\n(q) (q a vertex of\nH\ncc(\u0393(G))).\nProof. Let \u03c6 = \u03c6G\nH . If u is cyclically reduced and labels a loop at a vertex p\nof cc(\u0393(H)), then u labels a loop at \u03c6(p) in \u0393(G), and that vertex is in the core\n5\n\n\fof \u0393(G) by Fact 1.2. It follows that tH (1) labels a path from the origin in \u0393(G)\nto a vertex in cc(\u0393(G)). In particular, tG (1) is a prefix of tH (1).\nIf tG (1) is a proper prefix of tH (1), we have tH (1) = tG (1)at for some a \u2208 \u00c3\nand t \u2208 F . Since \u03c4G (1) is in cc(\u0393(G)), there exist a cyclically reduced word of the\nform bu, with first letter b 6= a, which labels a loop at \u03c4G (1) in cc(\u0393(G)). Then\nthe words tG (1)(bu)n tG (1) are all reduced, and the cosets HtG (1)(bu)n tG (1)\nare all in G. Moreover, these cosets are pairwise disjoint since H contains no\nreduced word of the form tG (1)(bu)d tG (1), d 6= 0. Thus, if H \u2264fi G, then\ntH (1) = tG (1). It follows immediately that \u03c6 maps core vertices to core vertices\nand tail vertices to tail vertices.\nLet us now assume that \u0393(H) and \u0393(G) have the same tails, and let us denote\nby t(1) the word tH (1) = tG (1). Then H \u2032 = t(1)Ht(1) and G\u2032 = t(1)Gt(1) are\ncyclically reduced, and H \u2264fi G if and only if H \u2032 \u2264fi G\u2032 . Thus we may now\nassume that G and H are cyclically reduced. If \u03c6 is not a cover, there exists\na vertex p of \u0393(H) such that \u0393(G) has a loop at \u03c6(p) labeled by a cyclically\nreduced word bu (b \u2208 \u00c3) and \u0393(H) has no b-labeled edge out of p. Let v label\na path from 1 to p in \u0393(H) (and hence in \u0393(G)). By the same reasoning as\nabove, the cosets Hv(bu)n v\u0304 are pairwise distinct, and contained in G. Thus, if\nH \u2264fi G, then \u03c6 is a cover.\nThe converse is verified as follows: if \u03c6 is a cover, let u1 , . . . , ud be reduced\nwords labeling paths in \u0393(H) from 1 to the elements 1 = p1 , . . . , pd of \u03c6\u22121 (1).\nIf g \u2208 G, then g labels a loop at 1 in \u0393(G), and since \u03c6 is a cover, g labels a\npath in \u0393(H) from 1 to pi for some i. Therefore g \u2208 Hui : thus G is the union\nof finitely many H-cosets.\n\u2293\n\u2294\nCorollary 1.5 The extensions, and the finite-index subgroups of a cyclically\nreduced subgroup are cyclically reduced as well.\n\nFinite-index extensions of a subgroup H\n\n2\n\nIt follows from the characterization of finite-index extensions by covers, that if\n1\nH \u2264fi G, then \u03c6G\nH is onto . Therefore H has only a finite number of finiteindex extensions, and that number can be bounded above by the number of\n2\nbinary relations on \u0393(H): if that graph has n vertices, then H has at most 2n\nfinite-index extensions. We give a better upper bound in Section 2.5.\nMoreover, the collection of finite-index extensions of H is effectively computable. In addition, it is elementary to use these graphical representations to\nshow that the join of two finite-index extensions of H is again a finite-index\nextension (see Stalling's proof of Greenberg's theorem [11]). It follows that if\nH \u2264fg F , then H admits an effectively computable maximum finite-index extension Hfi . The results of Section 2.4 below yield an efficient algorithm to\ncompute the set of finite-index extensions of a given subgroup H, and its maximum finite-index extension Hfi .\n1 The\n\n\u03c6G\nH\n\nconverse is not true, see [7] for a detailed study of the extensions H \u2264fg G such that\nis onto.\n\n6\n\n\fRemark 2.1 We just observed that every finitely generated subgroup of F has\na finite number of finite-index extensions. However, it usually has infinitely\nmany finite-index subgroups. More precisely, every non-trivial subgroup H \u2264fg\nF admits a finite-index subgroup of index r for each r \u2265 1. Indeed, let A(H) =\n(\u0393(H), 1) and let Q be the vertex set of \u0393(H). Define \u0393r be the A-labeled graph\nwith vertex set Q \u00d7 {1, . . . , r} and with the following edge set: for each edge\n(p, a, q) of \u0393(H), there is an edge ((p, i), a, (q, i + 1)) for each 1 \u2264 i < r and\nan edge ((p, r), a, (q, 1)). Then \u0393r is an admissible graph, the map \u03c0: (p, i) 7\u2192 p\ndefines a cover from \u0393r to \u0393(H), and if Hr is the subgroup represented by\n(\u0393r , (1, 1)), then Hr has index r in H.\n\u2293\n\u2294\n\n2.1\n\ni-steps and finite-index extensions\n\nLet H \u2264 G be finitely generated subgroups of F and let g1 , . . . , gn be reduced\nwords such that G = hH, g1 , . . . , gn i. Let G0 = H and let Gi = hGi\u22121 , gi i\n(1 \u2264 i \u2264 n). We may of course assume that gi 6\u2208 Gi\u22121 , so Gi\u22121 6= Gi .\nThen A(Gi ) is obtained from A(Gi\u22121 ) by, first, adding sufficiently many\nnew vertices and edges to create a new path from vertex 1 to itself, labeled by\ngi ; and second, by reducing 2 the resulting graph, that is, repeatedly identifying\na\na\nvertices p and p\u2032 such that q \u2212\u2192 p and q \u2212\u2192 p\u2032 for some vertex q and some letter\na \u2208 \u00c3, see for instance [11, 12, 5, 10]. Depending on the length of prefixes of gi\nand \u1e21i that can be read from vertex 1 in \u0393(Gi\u22121 ), this procedure amounts to\none of the two following moves:\n(p,w,q)\n- a reduced expansion, or re-step (we write A(Gi\u22121 ) \u2212\u2192re\nA(Gi )), that\nis, we add a new path labeled by a factor w of gi , from some vertex p to some\nvertex q of \u0393(Gi\u22121 ) in such a way that the resulting graph is admissible (needs\nno reduction);\n- or an i-step (we write A(Gi\u22121 ) \u2212\u2192p=q\nA(Gi )), that is, we identify a pair\ni\nof vertices (p, q) of \u0393(Gi\u22121 ), and we reduce the resulting graph.\nRemark 2.2 Let us comment on these steps, with reference to Stallings's algorithm [11]. If H = hg1 , . . . , gn i, Stallings produces A(H) by reducing (folding) a\nbouquet of n circles, labeled g1 , . . . , gn respectively. For our purpose, we decompose this operation in n steps, adding one generator at a time and producing\nsuccessively the A(hh1 , . . . , hi i) (1 \u2264 i \u2264 n). Each of these steps is either an\nre-step or an i-step.\n\u2293\n\u2294\nWe refer the readers to [10, Section 2] for a detailed analysis of these moves\nand we record the following observation.\nLemma 2.3 Let G, H \u2264fg F . If H \u2264fi G, then only i-steps are involved in the\ntransformation from \u0393(H) to \u0393(G).\n2 This reduction operation is the iteration of Stallings's folding operation [11]; our terminology emphasizes the fact that this is a generalization of the reduction of a word (the iterated\nprocess of deleting factors of the form a\u0101, a \u2208 \u00c3).\n\n7\n\n\fProof. Let H = G0 \u2264 G1 \u2264 . . . \u2264 Gn = G be as in the above discussion. Note\nthat H \u2264fi G if and only if Gi\u22121 \u2264fi Gi for each 1 \u2264 i \u2264 n. If A(Gi\u22121 ) \u2212\u2192re\nGi\nA(Gi ), then the homomorphism \u03c6G\nis one-to-one, so Gi\u22121 \u2264ff Gi and in\ni\u22121\nparticular, Gi is not a finite-index extension of Gi\u22121 .\n\u2293\n\u2294\n\n2.2\n\nWhich i-steps yield finite-index extensions?\n\ne p (H) be the language accepted by cc(\u0393(H)),\nIf p is a vertex of cc(\u0393(H)), we let L\nseen as a finite state automaton with initial state p and all states final: that\nis, the set of (possibly non-reduced) words in \u00c3\u2217 that label a path in cc(\u0393(H))\ne p (H) -\nstarting at vertex p. Let then Lp (H) be the set of reduced words in L\ne p (H)), and also the set of prefixes of\nwhich is also the set of all red(u) (u \u2208 L\nwords in the subgroup represented by the pair (cc(\u0393(H)), p). Let us first record\nthe following elementary remark.\nu\n\nRemark 2.4 If p \u2212\u2192 q is a path in cc(\u0393(H)), then Lq (H) = {red(\u016bx) | x \u2208\nLp (H)}.\n\u2293\n\u2294\nWe now refine the result of Lemma 2.3.\nProposition 2.5 Let H \u2264fg F and let p, q be distinct vertices in \u0393(H). Let G\nA(G). Then H \u2264fi G if and only\nbe the subgroup of F such that A(H) \u2212\u2192p=q\ni\nif p, q are in cc(\u0393(H)) and Lp (H) = Lq (H), if and only if p, q are in cc(\u0393(H))\ne p (H) = L\ne q (H).\nand L\nProof. Let us first assume that H \u2264fi G and let \u03c6 = \u03c6G\nH . By Proposition 1.4,\n\u03c6 is a bijection from tail(H) onto tail(G) and, since \u03c6(p) = \u03c6(q), the vertices p\nand q must both be in cc(\u0393(H)).\ne p (H) 6= L\ne q (H), we consider (without loss of generIf p, q \u2208 cc(\u0393(H)) and L\ne p (H) \\ L\ne q (H), with minimum length, say u = va with a \u2208 \u00c3.\nality) a word u \u2208 L\nv\n\na\n\nv\n\na\n\nBy definition, there exist paths p \u2212\u2192 p\u2032 \u2212\u2192 p\u2032\u2032 and q \u2212\u2192 q \u2032 , but no path q \u2032 \u2212\u2192 q \u2032\u2032\n\u2032\n\u2032\na\nin cc(\u0393(H)). Observe that A(H) \u2212\u2192pi =q A(G). If there is a path q \u2032 \u2212\u2192 q \u2032\u2032 in\np\u2032\u2032 =q\u2032\u2032\n\u0393(H), then we also have A(H) \u2212\u2192i\nA(G) and since p\u2032\u2032 \u2208 cc(\u0393(H)) and\n\u2032\u2032\nq \u2208 tail(\u0393(H)), we conclude to a contradiction by Proposition 1.4. We now\na\nassume that there is no path q \u2032 \u2212\u2192 q \u2032\u2032 in \u0393(H).\nWe claim that there exists w \u2208 F such that aw is cyclically reduced and\naw\nz\np\u2032 \u2212\u2192 q \u2032 in cc(\u0393(H)). Let indeed p\u2032\u2032 \u2212\u2192 q \u2032 be a path of minimal length in\ncc(\u0393(H)) (there exists one by connectedness). Since p\u2032\u2032 \u2208 cc(\u0393(H)), there exists\nb\n\na path p\u2032\u2032 \u2212\u2192 r for some b \u2208 \u00c3, b 6= \u0101, and as in the proof of Remark 1.2, there\nexists a reduced word of the form bt labeling a loop at p\u2032\u2032 . Let w = red(btz):\nw\nthen we have a path p\u2032\u2032 \u2212\u2192 q \u2032 . By minimality of the length of z, t\u0304 b\u0304 is not a\nprefix of z, so w starts with letter b, and hence aw is reduced. In fact, aw is\na\ncyclically reduced since there is no path q \u2032 \u2212\u2192 q \u2032\u2032 .\n8\n\n\ft\n\nLet 1 \u2212\u2192 q \u2032 be a path in \u0393(H). Then red(tawt\u0304) \u2208 G, and hence there exists\na\nm > 1 such that red(t(aw)m t\u0304) \u2208 H. Again, since there is no path q \u2032 \u2212\u2192 q \u2032\u2032 , the\nword ta is reduced. By replacing m by a sufficiently large multiple, we find that\nta is a prefix of red(t(aw)m t\u0304), and hence that ta labels a path from 1 in \u0393(H):\na\nthis contradicts the absence of a path q \u2032 \u2212\u2192 q \u2032\u2032 .\ne p (H) =\nThus we have proved that, if H \u2264fi G, then p, q \u2208 cc(\u0393(H)) and L\ne\nLq (H). The latter condition immediately implies that Lp (H) = Lq (H). We\nnow assume that p, q \u2208 cc(\u0393(H)) and Lp (H) = Lq (H), and we show that\nH \u2264fi G. We first establish a technical fact.\nz\n\ni\nsi+1 (zi \u2208 F , 0 \u2264 i \u2264 k) be paths in cc(\u0393(H)), such\nLemma 2.6 Let ri \u2212\u2192\n\nthat ri , si \u2208 {p, q} for each 1 \u2264 i \u2264 k. Then there exists a path r0\ncc(\u0393(H)).\n\nred(z0 ***zk )\n\n\u2212\u2192\n\nt in\n\nProof. The proof is by induction on k, and is trivial for k = 0. If k > 0, then\nthere is a path r1\n\nred(z1 ***zk )\n\nred(z1 ***zk ) \u2032\n\npath s1 \u2212\u2192\nas required.\n\n\u2212\u2192\n\nt in cc(\u0393(H)). Since Lp (H) = Lq (H), there is also a\n\nt for some t\u2032 \u2208 cc(\u0393(H)), and therefore a path r0\n\nred(z0 ***zk ) \u2032\n\n\u2212\u2192\n\nt\n\u2293\n\u2294\n\nWe want to show that G has finitely many H-cosets. Let u \u2208 G: then u\nlabels a loop at 1 in \u0393(G). Let B be the automaton obtained from \u0393(H) by\nidentifying vertices p and q, but without performing any reduction. Then \u0393(G)\nis the result of the reduction of B. In particular (say, in view of [10, Fact 1.4]),\nu = red(v) for some word v \u2208 \u00c3\u2217 labeling a loop at 1 in B. By definition of B,\nthe word v factors as v = v0 * * * vk , in such a way that \u0393(H) has paths of the form\nvk\nvi\nv0\nsi+1 (1 \u2264 i < k) and rk \u2212\u2192\n1, and the vertices r1 , s1 , * * * , rk , sk\ns1 , ri \u2212\u2192\n1 \u2212\u2192\nare all equal to p or q. As observed in Section 1, \u0393(H) also has paths\nred(v0 )\n\nred(vi )\n\nred(vk )\n\n1 \u2212\u2192 s1 , ri \u2212\u2192 si+1 (1 \u2264 i < k) and rk \u2212\u2192 1.\nIn particular, we have red(v0 ) = t(1)w0 and red(vk ) = wk t\u0304(1) for some w0 , wk \u2208\nt(1)\nt\u0304(1)\nwk\nw0\ns1 and rk \u2212\u2192\n\u03c4 (1) \u2212\u2192 1. Note that the\nF , and there are paths 1 \u2212\u2192 \u03c4 (1) \u2212\u2192\nw\n\nred(vi )\n\nw\n\n0\nk\ns1 , ri \u2212\u2192 si+1 (1 \u2264 i < k) and rk \u2212\u2192\n\u03c4 (1) are set entirely within\npaths \u03c4 (1) \u2212\u2192\ncc(\u0393(H)), since no reduced word-labeled path between vertices in cc(\u0393(H)) can\nvisit a vertex in tail(\u0393(H)).\n\nred(w0 v1 ***vk\u22121 wk )\n\nBy Lemma 2.6, there exists a path \u03c4 (1)\n\u2212\u2192\nt for some vertex t\nh\nin cc(\u0393(H)). Let h be a shortest-length word such that t \u2212\u2192 \u03c4 (1) in cc(\u0393(H)).\nThen z = t(1) red(w0 v1 * * * vk\u22121 wk ) h t\u0304(1) labels a loop at vertex 1 in \u0393(H),\nso red(z) \u2208 H. By construction, we have u = red(t(1)w0 v1 * * * vk\u22121 wk t\u0304(1)), so\nu \u2208 H red(t(1) h\u0304 t\u0304(1)). Since h was chosen to be a geodesic in cc(\u0393(H)), it can\ntake only finitely many values, and this completes the proof that G has finitely\nmany H-cosets.\n\u2293\n\u2294\n9\n\n\fWe note the following consequence of this proof.\nCorollary 2.7 Let H \u2264fg F and let p, q \u2208 cc(\u0393(H)). Then Lp (H) = Lq (H) if\ne p (H) = L\ne q (H).\nand only if L\n\n2.3\n\nThe lattice of finite-index extensions of H\n\nWe further refine Proposition 2.5 as follows: we consider an extension H \u2264fi\nG and a pair (r, s) of vertices of \u0393(H), whose identification yields a finiteindex extension of H. Then we show that identifying the vertices of \u0393(G)\ncorresponding to r and s, also yields a finite-index extension of G.\nLemma 2.8 Let H \u2264fi G \u2264fg F and let \u03c6 = \u03c6G\nH . Let p be a vertex of cc(\u0393(H)).\ne p (H) = L\ne \u03c6(p) (G) and Lp (H) = L\u03c6(p) (G).\nThen L\nu\n\nu\n\nProof. If p \u2212\u2192 r in cc(\u0393(H)), then the \u03c6-image of this path is a path \u03c6(p) \u2212\u2192 \u03c6(r),\ne p (H) \u2286\nwhich is entirely contained in cc(\u0393(G)) by Proposition 1.4. In particular, L\ne \u03c6(p) (G).\nL\nu\nConversely, suppose that \u03c6(p) \u2212\u2192 r\u2032 is a path in cc(\u0393(G)). Since \u03c6 is a cover\nu\nfrom cc(\u0393(H)) onto cc(\u0393(H)), u labels some path p \u2212\u2192 r in cc(\u0393(H)), and hence\ne p (H). Thus L\ne p (H) = L\ne \u03c6(p) (G).\nu\u2208L\n\u2293\n\u2294\nTogether with Proposition 2.5, Lemma 2.8 immediately implies the following\nstatements.\nCorollary 2.9 Let H \u2264fg F .\np=q\n1. Let H \u2264fi G and let \u03c6 = \u03c6G\nH . If p, q are vertices of \u0393(H), A(H) \u2212\u2192i\n\u03c6(p)=\u03c6(q)\nA(K \u2032 ), then H \u2264fi K if and only if G \u2264fi K \u2032 .\nA(K) and A(G) \u2212\u2192i\n\n2. H \u2264fi G if and only if A(G) is obtained from A(H) by identifying some\npairs of vertices (p, q) in cc(\u0393(H)) such that Lp (H) = Lq (H), and then\nreducing the resulting graph.\nThe identification of all pairs of vertices (p, q) such that Lp (H) = Lq (H)\nyields the minimum quotient of A(H) and hence the maximum finite-index\nextension Hfi of H. In addition, we find that Hfi is exactly the commensurator\nof H (the set CommF (H) of all elements g \u2208 F such that H \u2229 H g has finite\nindex in both H and H g ), a fact that can also be deduced from [5, Lemma 8.7].\nTheorem 2.10 Let H \u2264fg F and let Hfi be its maximum finite-index extension.\n1. A(Hfi ) is obtained from A(H) by identifying all pairs of vertices p, q of\ncc(\u0393(H)) such that Lp (H) = Lq (H). No reduction is necessary.\n2. Hfi = CommF (H).\n\n10\n\n\fProof. In view of Corollary 2.9, A(Hfi ) is obtained from A(H) by identifying\nall pairs of vertices p, q of cc(\u0393(H)) such that Lp (H) = Lq (H), and then by\na\na\nreducing the resulting graph B. If p \u2212\u2192 r and q \u2212\u2192 s (a \u2208 \u00c3) are paths in\ncc(\u0393(H)) and if Lp (H) = Lq (H), then Lr (H) = Ls (H) by Remark 2.4. Thus B\nis already reduced, which concludes the proof of the first statement.\nThe fact that Comm(H) is a subgroup and a finite-index extension of H is\nproved, for instance, in [5, Prop. 8.9]. Conversely, suppose that H \u2264fi G and\ng \u2208 G. Since conjugation by g is an automorphism of G, we have H g \u2264fi G. Now\nthe intersection of finite-index subgroups, again has finite index, so H \u2229H g \u2264fi G\nand hence H \u2229 H g \u2264fi H and H \u2229 H g \u2264fi H g . Thus g \u2208 CommF (H), which\nconcludes the proof.\n\u2293\n\u2294\n\n2.4\n\nComputing finite-index extensions\n\nRecall the notion of minimization of a deterministic finite-state automaton (see\n[6] for instance). Let B = (Q, i, E, T ) be such an automaton, over the alphabet\nB, with Q the finite set of states, i \u2208 Q the initial state, E \u2286 Q \u00d7 B \u00d7 Q the set\nof transitions and T \u2286 Q the set of accepting states, and let L be the language\naccepted by B, that is, the set of words in B \u2217 that label a path from p to a state\nin T . Then the minimal automaton of L is obtained by identifying the pairs\nof states (p, q) such that the automata (Q, p, E, T ) and (Q, q, E, T ) accept the\nsame language.\ne p (H) is the language accepted by\nIn our situation, the alphabet is \u00c3 and L\nthe automaton Bp , whose states and transitions are given by cc(\u0393(H)), with\ninitial state p and all states final. Therefore Corollary 2.9 and Theorem 2.10\nshow that the identification of two vertices p, q \u2208 cc(\u0393(H)) yields a finite-index\nextension if and only if p and q are identified when minimizing B\u03c4 (1) . Moreover,\ncc(\u0393(Hfi )) is given by the states and transitions of the minimal automaton of\ne \u03c4 (1) (H).\nL\nThe classical Hopcroft algorithm (see [6]) minimizes an n-state automaton\nin time O(n log n), so we have the following result.\nProposition 2.11 Let H \u2264fg F , and let n be the number of vertices of \u0393(H).\n\u2022 cc(\u0393(Hfi )) is obtained by minimizing the automaton given by the vertices\nand edges of cc(\u0393(H)), with all states final (the initial state does not matter\nin that situation).\n\u2022 One can compute \u0393(Hfi ) in time O(n log n).\n\u2022 One can decide in time O(n log n) whether identifying a given set of pairs\nof vertices of \u0393(H) will produce a finite-index extension of H.\nRemark 2.12 It may be that for the particular automata at hand (over a\nsymmetrized alphabet, with all states final), the complexity of Hopcroft's algorithm might be better than O(n log n), even linear. It has also been observed\nthat in many instances, Myhill's automata minimization algorithm exhibits a\n11\n\n\fbetter performance than Hopcroft's, in spite of a O(n2 ) worst-case complexity.\nBrzozowski's algorithm [2] also performs remarkably well in practice [3].\n\u2293\n\u2294\n\n2.5\n\nCounting finite-index extensions\n\nRecall that, if \u0393 is an A-labeled graph, the product \u0393 \u00d7A \u0393 (also called the\nfiber product, or the pull-back, of two copies of \u0393) is the A-labeled graph whose\nvertex set is the set of pairs (p, q) of vertices of \u0393 and whose edges are the triples\n((p, q), a, (p\u2032 , q \u2032 )) such that (p, a, q) and (p\u2032 , a, q \u2032 ) are edges of \u0393. This graph is\nnot admissible, nor even connected in general (the vertices of the form (p, p)\nform a connected component that is isomorphic to \u0393). Note that there is a\nu\nu-labeled path in \u0393 \u00d7A \u0393 from (p, q) to (p\u2032 , q \u2032 ), if and only if \u0393 has paths p \u2212\u2192 p\u2032\nu\n\u2032\nand q \u2212\u2192 q .\nIf p, q are vertices of cc(\u0393(H)), we let p \u223c q if and only if Lp (H) = Lq (H).\nProposition 2.13 Let H \u2264fg F .\n\u2022 The relation \u223c is a union of connected components of cc(\u0393(H))\u00d7A cc(\u0393(H)).\n\u2022 Let p, q be vertices of cc(\u0393(H)). Then p \u223c q if and only if the first and\nthe second component projections, from the connected component of (p, q)\nin cc(\u0393(H)) \u00d7A cc(\u0393(H)) to cc(\u0393(H)) are both covers.\nProof. The first statement follows directly from Remark 2.4, which shows that\nu\nif p \u223c q and there is a path (p, q) \u2212\u2192(p\u2032 , q \u2032 ), then p\u2032 \u223c q \u2032 .\nLet us now assume that p \u223c q and let us show that the first component\nprojection is a cover from the connected component of (p, q) onto cc(\u0393(H)).\nLet (r, s) be a vertex in that connected component: then there exists u \u2208 F\nu\nu\na\nsuch that p \u2212\u2192 r and q \u2212\u2192 s. Let r \u2212\u2192 r\u2032 (a \u2208 \u00c3) be an edge in \u0393(H). Then\nua \u2208 Lp (H), so ua \u2208 Lq (H), and hence (since \u0393(H) \u00d7A \u0393(H) is deterministic),\na\nthere exists an a-labeled path s \u2212\u2192 s\u2032 . Therefore there exists an a-labeled path\na\n\u2032 \u2032\n(r, s) \u2212\u2192(r , s ). Thus the first component projection is a cover. The proof\nconcerning the second component projection is identical.\nConversely, suppose that the first and the second component projections,\nfrom the connected component of (p, q) in cc(\u0393(H)) \u00d7A cc(\u0393(H)) to cc(\u0393(H))\nu\nare covers, and let u \u2208 Lp (H). Then cc(\u0393(H)) has a path p \u2212\u2192 r. It is\nan elementary property of covers that this path can be lifted to a path in\nu\ncc(\u0393(H)) \u00d7A cc(\u0393(H)), of the form (p, q) \u2212\u2192(r, s). The second component prou\njection of that path yields a path q \u2212\u2192 s in cc(\u0393(H)), and hence u \u2208 Lq (H). \u2293\n\u2294\nLet f (n) be the maximal number of finite-index extensions of a subgroup\nH \u2264fg F such that \u0393(H) has at most n vertices. By Proposition 2.13, every\npair (p, q) such that p \u223c q is in the connected component of a pair of the form\n(1, r) for some r > 1. Moreover, this connected component has elements of\nthe form (i, j) for all 1 \u2264 i \u2264 n, so the graph resulting from the identification\nof 1 and r (or from p and q) has at most n/2 vertices. Thus f (1) = 1 and\n1\nf (n) \u2264 n f (\u230an/2\u230b) for all n \u2265 2. It follows that f (n) \u2264 n 2 (1+log2 n) .\n12\n\n\fProposition 2.14 Let H \u2264fg F . If cc(\u0393(H)) has n vertices, then H has at\n1\nmost n 2 (1+log2 n) finite-index extensions.\nExample 2.15 By means of lower bound, we consider the following example.\nLet e1 , . . . , ek be the canonical basis of the vector space Zk2 , let \u03c6 be the morphism from the free group F over A = {a1 , . . . , ak } into the additive group\nZk2 , mapping ai to ei , and let H = ker \u03c6. Then H is normal and finite-index,\nso all its extensions have finite index and they are in bijection with the set of\nquotients of Zk2 , hence with the set of subgroups of Zk2 , or equivalently with the\nset of subspaces of Zk2 .\nLet ld,k be the number of linearly independent d-tuples in Zk2 (d \u2265 1). Then\nl1,k = 2k \u2212 1. If d \u2265 2, a d-tuple (x1 , . . . , xd ) is linearly independent if and only\nif (x1 , . . . , xd\u22121 ) is linearly independent and xd does not belong to the subspace\ngenerated by x1 , . . . , xd\u22121 , so that ld,k = ld\u22121,k (2k \u2212 2d\u22121 ). Now the set of\ncardinality d linearly independent subsets has md,k = ld,k /d! elements, and the\nnumber of dimension d subspaces of Zk2 is\nsd,k =\n\nld,k\n(2k \u2212 1)(2k \u2212 2)(2k \u2212 4) * * * (2k \u2212 2d\u22121 )\nmd,k\n=\n= d\n.\nmd,d\nld,d\n(2 \u2212 1)(2d \u2212 2)(2d \u2212 4) * * * (2d \u2212 2d\u22121 )\n\nPk\nFinally, the number of subspaces of Zk2 is equal to d=0 sd,k , with s0,k = 1.\nk\n\u22122i\nk\u2212d\n, so that sd,k > 2(k\u2212d)d .\nWe observe that for each 0 \u2264 i < d < k, 22d \u22122\ni > 2\nP\n2\nBy considering d = \u230a k2 \u230b, we find that\nsd,k > 2k /4 .\nFinally, we note that \u0393(H) is the Cayley graph of Zk2 with respect to the basis\ne1 , . . . , ed (a graph known as the dimension k hypercube), so that \u0393(H) has n =\n1\n\u2294\n2k vertices. As a result, H has more than n 4 log2 n finite-index extensions. \u2293\n\n2.6\n\nThe lattice of finite-index subgroups of G\n\nLet us call fi-maximal a subgroup G \u2264fg F which has no proper finite-index\nextension, that is (in view of Theorem 2.10), such that G = CommF (G). If G\nis fi-maximal, let FIS(G) be the set of all finite-index subgroups of G, that is,\nthe set of subgroups H \u2264fg F such that Hfi = G. Note that distinct fi-maximal\nsubgroups yield disjoint lattices of finite-index subgroups.\nRemark 2.16 Let G \u2264fg F be non-trivial and fi-maximal. Then FIS(G) forms a\nconvex sublattice of the lattice of subgroups of F , with greatest element G. This\nsublattice is always infinite (see Remark 2.1) and without a least element. \u2293\n\u2294\nLemma 2.8 provides us with an invariant for every sublattice of the form\nFIS(G) (with G fi-maximal).\nProposition 2.17 Let H, K \u2264fg F . Then Hfi = Kfi if and only if tH (1) =\ne \u03c4 (1) (H) = L\ne \u03c4 (1) (K), if and only if tH (1) = tK (1) and L\u03c4 (1) (H) =\ntK (1) and L\nL\u03c4 (1) (K).\n13\n\n\fProof. If Hfi = Kfi , then H, K \u2264fi Hfi , and Proposition 1.4 and Lemma 2.8\ne \u03c4 (1) (H) = L\ne \u03c4 (1) (Hfi ) = L\ne \u03c4 (1) (K)\nshow directly that tH (1) = tHfi (1) = tK (1), L\nand L\u03c4 (1) (H) = L\u03c4 (1) (Hfi ) = L\u03c4 (1) (K).\nWe now prove the converse. More precisely, we show that if H and K are\nfi-maximal, tH (1) = tK (1) and L\u03c4 (1) (H) = L\u03c4 (1) (K), then H = K. First we\nnote that A(H tH (1) ) = (cc(\u0393(H)), \u03c4 (1)) and in particular, H tH (1) is cyclically\nreduced and fi-maximal. Thus, it suffices to prove the expected result (namely,\nthat H = K) under the hypothesis that H and K are cyclically reduced.\nBy Remark 2.4, the set of all Lp (H) (p \u2208 \u0393(H)) coincides with the set\n{{red(\u016bx) | x \u2208 L1 (H)} | u \u2208 L1 (H)}. In addition, since H is fi-maximal, if\nu\nu\nu, v \u2208 L1 (H) with 1 \u2212\u2192 p and 1 \u2212\u2192 q and {red(\u016bx) | x \u2208 L1 (H)} = {red(v\u0304x) |\nx \u2208 L1 (H)}, then p = q. It also follows from the same fact that, again if H is\nfi-maximal, there is an edge (p, a, q) in \u0393(H) if and only if Lq (H) = {red(\u0101x) |\nx \u2208 Lp (H)}. Thus, the cyclically reduced fi-maximal subgroup H is entirely\ndetermined by the set L1 (H). This concludes the proof.\n\u2293\n\u2294\ne \u03c4 (1) (G)) for some subgroup G \u2264fg F\nThe pairs (t, L) that are equal to (t(1), L\nare characterized as follows. Recall that an i-automaton [9] is a deterministic\nautomaton (Q, i, E, T ) over the alphabet \u00c3 such that, (p, a, q) \u2208 E if and only\nif (q, \u0101, p) \u2208 E for all vertices p, q and a \u2208 A. The automata Bp discussed in\nSection 2.4 are i-automata.\nProposition 2.18 Let t \u2208 F and let L \u2286 \u00c3\u2217 be a rational language. The\nfollowing conditions are equivalent.\ne \u03c4 (1) (H).\n(1) There exists a subgroup H \u2264fg F such that t = t(1) and L = L\n(2) There exists a fi-maximal subgroup H \u2264fg F such that t = t(1) and L =\ne \u03c4 (1) (H).\nL\n(3) L is accepted by an i-automaton with all states accepting and such that,\nfor each state p, there exist transitions (p, a, q) and (p, b, r) for at least\ntwo distinct letters a, b \u2208 \u00c3. In addition, if t is not the empty word, then\nt = t\u2032 a for a letter a \u2208 \u00c3 such that \u0101 6\u2208 L.\n(3') The minimal automaton of L is an i-automaton with all states accepting\nand such that, for each state p, there exist transitions (p, a, q) and (p, b, r)\nfor at least two distinct letters a, b \u2208 \u00c3. In addition, if t is not the empty\nword, then t = t\u2032 a for a letter a \u2208 \u00c3 such that \u0101 6\u2208 L.\n(4) t and L satisfy the following conditions:\n(4.1) L is closed under taking prefixes;\n(4.2) if u, v \u2208 L, then u\u016bv \u2208 L;\n\n(4.3) if uvv\u0304w \u2208 L, then uw \u2208 L;\n\n(4.4) if ua \u2208 L with a \u2208 \u00c3, then uab \u2208 L for some b \u2208 \u00c3 such that b 6= \u0101.\n14\n\n\f(4.5) if t is not the empty word, then t = t\u2032 a for a letter a \u2208 \u00c3 such that\n\u0101 6\u2208 L.\nProof. Conditions (1) and (2) are equivalent by Proposition 2.17.\nProposition 2.11 shows that (1) implies (3'), which in turn implies (3). Let\nus now assume that (3) holds and let \u0393 be the A-labeled graph induced by the\nstates and transitions of the minimal automaton of L. The extra condition given\nshows that every vertex of \u0393 is visited by a loop labeled by a cyclically reduced\nword. It follows that, if G is the subgroup whose graphical representation is\nA(G) = (\u0393, q0 ), with q0 the initial state, then G is cyclically reduced, L =\ne q0 (G). The condition on the word t shows that Condition (1) holds with\nL\nH = Gt .\nCondition (3) easily implies Condition (4). Let us now assume that Condition (4) holds. By [9, Theorem 4.1], Properties (4.2) and (4.3) show that L\nis accepted by an i-automaton. Property (4.1) shows that all states of that\nautomaton are final, and Property (4.4) shows that, for each state p, there exist\ntransitions (p, a, q) and (p, b, r) for at least two distinct letters a, b \u2208 \u00c3. Thus\nCondition (4) implies Condition (3), which concludes the proof.\n\u2293\n\u2294\n\n3\n\nMalnormal closure\n\nA subgroup H of F is malnormal if H g \u2229 H = 1 for each g 6\u2208 H. Malnormality\nwas proved decidable in [1], and a simple decision algorithm was given in [5],\nbased on the following characterization [5, 4].\nProposition 3.1 Let H \u2264fg F . Then H is malnormal if and only if every\nconnected component of \u0393(H) \u00d7A \u0393(H), except for the diagonal complement, is\na tree, if and only if, for every p 6= q \u2208 cc(\u0393(H)), Lp (H) \u2229 Lq (H) is finite.\nThis yields directly an O(n2 log n) decision algorithm, where n is the number\nof vertices of cc(\u0393(H)). It also yields the following corollary.\nCorollary 3.2 Let H \u2264fg F . If H is malnormal, then H is fi-maximal, that is,\nH has no proper finite-index extension.\nProof. By Corollary 2.9, if H is not fi-maximal, then there exist vertices p 6= q\nin cc(\u0393(H)) such that Lp (H) = Lq (H), and hence such that Lp (H) \u2229 Lq (H) =\nLp (H) is infinite. In particular, H is not malnormal.\n\u2293\n\u2294\nIt is shown in [7, Prop. 4.5] that for every finitely generated subgroup\nH \u2264fg F , there exists a least malnormal extension Hmal , called the malnormal\nclosure of H, that Hmal is finitely generated and effectively computable, and\nthat the rank of Hmal is less than or equal to the rank of H [7, Corol. 4.14]. In\nfact, [7] shows that \u0393(Hmal ) is obtained from \u0393(H) by a series of i-steps. The\nalgorithm computing Hmal then consists in computing all the quotients of \u0393(H)\nand verifying, for each of them, whether it represents a malnormal subgroup.\nWe now give a much better, polynomial-time algorithm.\n15\n\n\fTheorem 3.3 Let H \u2264fg Fn . The malnormal closure of H is computed by\nrepeatedly applying the following construction: in \u0393(H), identify all pairs (p, q)\nof distinct vertices in cc(\u0393(H)), such that Lp (H) \u2229 Lq (H) is infinite and reduce\nthe resulting graph.\nProof. Let H0 = H and let Hi+1 be the subgroup of F such that \u0393(Hi+1 ) is\nobtained from \u0393(Hi ) by, first identifying all pairs p, q of vertices of cc(\u0393(Hi ))\nsuch that Lp (Hi ) \u2229 Lq (Hi ) is infinite, and then reducing the resulting graph.\nSince \u0393(Hi+1 ) has less vertices than \u0393(Hi ), this defines a finite sequence of\nsubgroups\nH = H0 < H 1 < . . . < H k ,\nwhere k \u2265 0 and Hk is malnormal. We want to show that Hk is the least\nmalnormal extension of H.\nLet K be any malnormal subgroup of F such that H \u2264 K. By Takahasi's\ntheorem (see for instance [7]), there exists a subgroup G such that H \u2264 G \u2264 K\nsuch that G is obtained from H by a sequence of i-steps, and K is obtained\nfrom G by a sequence of re-steps (this fact can also be deduced from [10, Prop.\n2.6]).\nLet p, q \u2208 cc(\u0393(H)) such that Lp (H) \u2229 Lq (H) is infinite. It is elementary to\nG\nverify that Lp (H) \u2286 L\u03c6G\n(G) \u2286 L\u03c6K\nG\n(K). In particular, \u03c6K\nG (\u03c6H (p)) \u2229\nH (p)\nG (\u03c6H (p))\nG\n\u03c6K\nG (\u03c6H (q)) is infinite. Since K is malnormal, it follows from Proposition 3.1\nK\nG\nK\nG\nthat \u03c6K\nG (\u03c6H (p)) = \u03c6G (\u03c6H (q)). But \u03c6G is one-to-one by definition, so we have\nG\n(q).\nIt\nfollows\nthat\nG\nis\nobtained\nfrom H1 by a sequence of i-steps,\n(p)\n=\n\u03c6\n\u03c6G\nH\nH\nand in particular, H1 \u2264 G \u2264 K. Iterating this reasoning, we find that Hk \u2264 K,\nwhich concludes the proof.\n\u2293\n\u2294\nCorollary 3.4 Let H \u2264 F . If \u0393(H) has n vertices, then one can compute\n\u0393(Hmal ) in time O(n3 log n).\nProof. According to the algorithm given in Proposition 3.3, we first need to\ncompute the connected components of cc(\u0393(H)) \u00d7A cc(\u0393(H)) \u2013 done in time\nO(n2 log n) \u2013, identifying which are trees and which are not \u2013 done in time O(n2 )\n\u2013, identifying the vertices of cc(\u0393(H)) involved in a non-diagonal connected\ncomponent and reducing the resulting graph to obtain \u0393(H1 ) \u2013 which is done\nin time O(n log n). Thus \u0393(H1 ) is computed from \u0393(H0 ) in time O(n2 log n).\nThis part of the algorithm is iterated k times, to compute \u0393(Hk ) = \u0393(Hmal ),\nand we have k < n since the number of vertices of the \u0393(Hi ) forms a properly\ndecreasing sequence. This concludes the proof.\n\u2293\n\u2294\n\nAcknowledgements\nThe authors thank A. Martino and E. Ventura for their help in the computation\nin Example 2.15. They also are indebted to the anonymous referee whose careful\nreading helped improve this paper.\n\n16\n\n\fReferences\n[1] G. Baumslag, A. Miasnikov and V. Remeslennikov. Malnormality is decidable in\nfree groups. Internat. J. Algebra Comput. 9 (1999) 687\u2013692.\n[2] J. Brzozowski. Canonical regular expressions and minimal state graphs for definite\nevents. In MRI Symposia Series 12 (Polytechnic Press, Polytechnic Institute of\nBrooklyn, 1962), pp. 529\u2013561.\n[3] J.-M. Champarnaud and D. Ziadi. Canonical derivatives, partial derivatives and\nfinite automaton constructions. Theoret. Comput. Sci. 289 (2002) 137\u2013163.\n[4] T. Jitsukawa. Malnormal subgroups of free groups. In Computational and statistical group theory (Contemp. Math. 298, Amer. Math. Soc., 2002), pp. 83\u201395.\n[5] I. Kapovich and A.G. Myasnikov. Stallings foldings and subgroups of free groups.\nJ. Algebra 248 (2002) 608\u2013668.\n[6] D. Kozen. Automata and Computability (Springer, 1997).\n[7] A. Miasnikov, E. Ventura, P. Weil. Algebraic extensions in free groups. In Algebra\nand Geometry in Geneva and Barcelona (G.N. Arzhantseva, L. Bartholdi, J.\nBurillo, E. Ventura eds.) (Trends in Mathematics, Birkha\u00fcser, 2007), pp. 225\u2013\n253.\n[8] J.-P. Serre. Arbres, amalgames, SL2 (Ast\u00e9risque 46, Soc. Math. France, 1977).\nEnglish translation: Trees (Springer Monographs in Mathematics, Springer,\n2003).\n[9] P.V. Silva. On free inverse monoid languages. Theoretical Informatics and Applications 30 (1996) 349\u2013378.\n[10] P.V. Silva, P. Weil. On an algorithm to decide whether a free group is a free\nfactor of another. Theor. Inform. Appl. 42 (2008) 395\u2013414.\n[11] J. Stallings. The topology of graphs. Invent. Math. 71 (1983) 551\u2013565.\n[12] P. Weil. Computing closures of finitely generated subgroups of the free group. In\nAlgorithmic Problems in Groups and Semigroups (J.-C. Birget, S. Margolis, J.\nMeakin, M. Sapir eds.) (Birkha\u00fcser, 2000), pp. 289\u2013307.\n\n17\n\n\f"}