{"id": "http://arxiv.org/abs/math/0602039v5", "guidislink": true, "updated": "2006-10-09T18:55:06Z", "updated_parsed": [2006, 10, 9, 18, 55, 6, 0, 282, 0], "published": "2006-02-02T16:58:21Z", "published_parsed": [2006, 2, 2, 16, 58, 21, 3, 33, 0], "title": "The Automorphism Group of a Finite p-Group is Almost Always a p-Group", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=math%2F0602299%2Cmath%2F0602099%2Cmath%2F0602183%2Cmath%2F0602115%2Cmath%2F0602108%2Cmath%2F0602053%2Cmath%2F0602524%2Cmath%2F0602244%2Cmath%2F0602425%2Cmath%2F0602201%2Cmath%2F0602276%2Cmath%2F0602011%2Cmath%2F0602173%2Cmath%2F0602030%2Cmath%2F0602321%2Cmath%2F0602461%2Cmath%2F0602389%2Cmath%2F0602047%2Cmath%2F0602324%2Cmath%2F0602253%2Cmath%2F0602113%2Cmath%2F0602449%2Cmath%2F0602344%2Cmath%2F0602033%2Cmath%2F0602432%2Cmath%2F0602193%2Cmath%2F0602251%2Cmath%2F0602624%2Cmath%2F0602520%2Cmath%2F0602309%2Cmath%2F0602155%2Cmath%2F0602278%2Cmath%2F0602355%2Cmath%2F0602611%2Cmath%2F0602220%2Cmath%2F0602620%2Cmath%2F0602143%2Cmath%2F0602060%2Cmath%2F0602376%2Cmath%2F0602408%2Cmath%2F0602110%2Cmath%2F0602167%2Cmath%2F0602555%2Cmath%2F0602442%2Cmath%2F0602105%2Cmath%2F0602275%2Cmath%2F0602660%2Cmath%2F0602270%2Cmath%2F0602602%2Cmath%2F0602294%2Cmath%2F0602335%2Cmath%2F0602005%2Cmath%2F0602088%2Cmath%2F0602518%2Cmath%2F0602256%2Cmath%2F0602658%2Cmath%2F0602451%2Cmath%2F0602364%2Cmath%2F0602056%2Cmath%2F0602647%2Cmath%2F0602015%2Cmath%2F0602501%2Cmath%2F0602214%2Cmath%2F0602054%2Cmath%2F0602463%2Cmath%2F0602613%2Cmath%2F0602487%2Cmath%2F0602259%2Cmath%2F0602094%2Cmath%2F0602038%2Cmath%2F0602204%2Cmath%2F0602223%2Cmath%2F0602243%2Cmath%2F0602612%2Cmath%2F0602468%2Cmath%2F0602109%2Cmath%2F0602248%2Cmath%2F0602286%2Cmath%2F0602171%2Cmath%2F0602597%2Cmath%2F0602416%2Cmath%2F0602158%2Cmath%2F0602414%2Cmath%2F0602529%2Cmath%2F0602419%2Cmath%2F0602039%2Cmath%2F0602404%2Cmath%2F0602180%2Cmath%2F0602140%2Cmath%2F0602636%2Cmath%2F0602505%2Cmath%2F0602326%2Cmath%2F0006123%2Cmath%2F0006105%2Cmath%2F0006037%2Cmath%2F0006026%2Cmath%2F0006057%2Cmath%2F0006141%2Cmath%2F0006191%2Cmath%2F0006235%2Cmath%2F0006150&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "The Automorphism Group of a Finite p-Group is Almost Always a p-Group"}, "summary": "Many common finite p-groups admit automorphisms of order coprime to p, and\nwhen p is odd, it is reasonably difficult to find finite p-groups whose\nautomorphism group is a p-group. Yet the goal of this paper is to prove that\nthe automorphism group of a finite p-group is almost always a p-group. The\nasymptotics in our theorem involve fixing any two of the following parameters\nand letting the third go to infinity: the lower p-length, the number of\ngenerators, and p. The proof of this theorem depends on a variety of topics:\ncounting subgroups of a p-group; analyzing the lower p-series of a free group\nvia its connection with the free Lie algebra; counting submodules of a module\nvia Hall polynomials; and using numerical estimates on Gaussian coefficients.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=math%2F0602299%2Cmath%2F0602099%2Cmath%2F0602183%2Cmath%2F0602115%2Cmath%2F0602108%2Cmath%2F0602053%2Cmath%2F0602524%2Cmath%2F0602244%2Cmath%2F0602425%2Cmath%2F0602201%2Cmath%2F0602276%2Cmath%2F0602011%2Cmath%2F0602173%2Cmath%2F0602030%2Cmath%2F0602321%2Cmath%2F0602461%2Cmath%2F0602389%2Cmath%2F0602047%2Cmath%2F0602324%2Cmath%2F0602253%2Cmath%2F0602113%2Cmath%2F0602449%2Cmath%2F0602344%2Cmath%2F0602033%2Cmath%2F0602432%2Cmath%2F0602193%2Cmath%2F0602251%2Cmath%2F0602624%2Cmath%2F0602520%2Cmath%2F0602309%2Cmath%2F0602155%2Cmath%2F0602278%2Cmath%2F0602355%2Cmath%2F0602611%2Cmath%2F0602220%2Cmath%2F0602620%2Cmath%2F0602143%2Cmath%2F0602060%2Cmath%2F0602376%2Cmath%2F0602408%2Cmath%2F0602110%2Cmath%2F0602167%2Cmath%2F0602555%2Cmath%2F0602442%2Cmath%2F0602105%2Cmath%2F0602275%2Cmath%2F0602660%2Cmath%2F0602270%2Cmath%2F0602602%2Cmath%2F0602294%2Cmath%2F0602335%2Cmath%2F0602005%2Cmath%2F0602088%2Cmath%2F0602518%2Cmath%2F0602256%2Cmath%2F0602658%2Cmath%2F0602451%2Cmath%2F0602364%2Cmath%2F0602056%2Cmath%2F0602647%2Cmath%2F0602015%2Cmath%2F0602501%2Cmath%2F0602214%2Cmath%2F0602054%2Cmath%2F0602463%2Cmath%2F0602613%2Cmath%2F0602487%2Cmath%2F0602259%2Cmath%2F0602094%2Cmath%2F0602038%2Cmath%2F0602204%2Cmath%2F0602223%2Cmath%2F0602243%2Cmath%2F0602612%2Cmath%2F0602468%2Cmath%2F0602109%2Cmath%2F0602248%2Cmath%2F0602286%2Cmath%2F0602171%2Cmath%2F0602597%2Cmath%2F0602416%2Cmath%2F0602158%2Cmath%2F0602414%2Cmath%2F0602529%2Cmath%2F0602419%2Cmath%2F0602039%2Cmath%2F0602404%2Cmath%2F0602180%2Cmath%2F0602140%2Cmath%2F0602636%2Cmath%2F0602505%2Cmath%2F0602326%2Cmath%2F0006123%2Cmath%2F0006105%2Cmath%2F0006037%2Cmath%2F0006026%2Cmath%2F0006057%2Cmath%2F0006141%2Cmath%2F0006191%2Cmath%2F0006235%2Cmath%2F0006150&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Many common finite p-groups admit automorphisms of order coprime to p, and\nwhen p is odd, it is reasonably difficult to find finite p-groups whose\nautomorphism group is a p-group. Yet the goal of this paper is to prove that\nthe automorphism group of a finite p-group is almost always a p-group. The\nasymptotics in our theorem involve fixing any two of the following parameters\nand letting the third go to infinity: the lower p-length, the number of\ngenerators, and p. The proof of this theorem depends on a variety of topics:\ncounting subgroups of a p-group; analyzing the lower p-series of a free group\nvia its connection with the free Lie algebra; counting submodules of a module\nvia Hall polynomials; and using numerical estimates on Gaussian coefficients."}, "authors": ["Geir T. Helleloid", "Ursula Martin"], "author_detail": {"name": "Ursula Martin"}, "author": "Ursula Martin", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1016/j.jalgebra.2007.01.008", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/math/0602039v5", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/math/0602039v5", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "38 pages, to appear in the Journal of Algebra; improved references,\n  changes in terminology", "arxiv_primary_category": {"term": "math.GR", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "math.GR", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "math.CO", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "20E36 (Primary), 05A16 (Secondary)", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/math/0602039v5", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/math/0602039v5", "journal_reference": "Journal of Algebra 312(2007) 294-329", "doi": "10.1016/j.jalgebra.2007.01.008", "fulltext": "arXiv:math/0602039v5 [math.GR] 9 Oct 2006\n\nThe Automorphism Group of a Finite p-Group is\nAlmost Always a p-Group\nGeir T. Helleloid\nDepartment of Mathematics, Bldg. 380\nStanford University\nStanford, CA 94305-2125\ngeir@math.stanford.edu\nUrsula Martin\nDepartment of Computer Science\nQueen Mary University of London\nMile End Road\nLondon E1 4NS, UK\nUrsula.Martin@dcs.qmul.ac.uk\nOctober 15, 2018\nAbstract\nMany common finite p-groups admit automorphisms of order coprime\nto p, and when p is odd, it is reasonably difficult to find finite p-groups\nwhose automorphism group is a p-group. Yet the goal of this paper is to\nprove that the automorphism group of a finite p-group is almost always\na p-group. The asymptotics in our theorem involve fixing any two of\nthe following parameters and letting the third go to infinity: the lower\np-length, the number of generators, and p. The proof of this theorem\ndepends on a variety of topics: counting subgroups of a p-group; analyzing\nthe lower p-series of a free group via its connection with the free Lie\nalgebra; counting submodules of a module via Hall polynomials; and using\nnumerical estimates on Gaussian coefficients.\n\n1\n\nIntroduction\n\nThe goal of this paper is to prove that, in a certain asymptotic sense, the\nautomorphism group of a finite p-group is almost always a p-group. A weaker\nversion of this result was announced by the second author in [21], but this paper\ncontains the first published proof.\nThe result may not seem entirely plausible at first, as many common finite\np-groups have an automorphism group that is not a p-group. Examples in1\n\n\fOrder\np3\np4\np5\np6\np7\n\np=2\n3 of 5\n9 of 14\n36 of 51\n211 of 267\n2067 of 2328\n\np=3\n0 of 5\n0 of 15\n0 of 67\n30 of 504\n2119 of 9310\n\np=5\n0 of 5\n0 of 15\n1 of 77\n65 of 685\n11895 of 34297\n\nTable 1: The proportion of p-groups of a given\norder whose automorphism group is a p-group.\n\nclude: abelian p-groups, unless p = 2 and the type of the group has repeated\nparts (see Macdonald [19, Chapter II, Theorem 1.6]); the Sylow-p subgroup of\nGL(n, Fp ) for p odd (see Gibbs [8]); and the extraspecial p-groups (see Winter [33]). Furthermore, Bryant and Kov\u00e1cs [3] show that any finite group occurs\nas the quotient A(H) of the automorphism group of some finite p-group H,\nwhere A(H) is as defined below. Our result seems to say that most p-groups\nare complicated and unnatural-looking and that familiar examples are far from\ntypical.\nIt is reasonably easy to find finite 2-groups whose automorphism group is a\n2-group: Z2n , the dihedral 2-group D2n (n \u2265 3), and the generalized quaternion\ngroup Q2n (n \u2265 4) are common examples, while Newman and O'Brien [24] offer\nthree more infinite families. It is more difficult to find finite p-groups whose automorphism groups are p-groups when p is odd. In [14], Horo\u0161evski\u0131\u0306 constructs\nsuch a p-group with nilpotence class n for each n \u2265 2 and such a p-group on\nd generators for each d \u2265 3. Furthermore, Horo\u0161evski\u0131\u0306 shows in [14] and [15]\nthat for any prime p, if H1 , H2 , . . . , Hn are finite p-groups whose automorphism\ngroups are p-groups, then the automorphism group of the iterated wreath product H1 \u2240 H2 \u2240 * * * \u2240 Hn is also a p-group. Otherwise, most known examples arise\nfrom complicated and unnatural-looking constructions (see Webb [30]). A survey on the automorphism groups of finite p-groups, including a comprehensive\nlist of examples in the literature of finite p-groups whose automorphism groups\nare p-groups, can be found in [11].\nIn a computational vein, Eick, Leedham-Green, and O'Brien [4] describe an\nalgorithm for constructing the automorphism group of a finite p-group. This\nalgorithm has been implemented by Eick and O'Brien in the GAP package\nAutPGroup [6]. Compiled with the gracious help of Eamonn O'Brien (personal\ncommunication) and the GAP packages AutPGroup and SmallGroups [6], Table 1 summarizes data on the proportion of small p-groups whose automorphism\ngroup is a p-group. (More information about the SmallGroups package can be\nfound in Besche, Eich and O'Brien [1].)\nOf course, the meaning of the statement \"The automorphism group of a finite\np-group is almost always a p-group\" depends on the asymptotic interpretation of\n\"almost always.\" Probably the most natural interpretation is to consider all pgroups of order at most pn and let n go to infinity. However, this is not the sense\n\n2\n\n\fof our result, and indeed, the question remains open for this interpretation (see\nMann [20, Question 9]). The precise statement of our main theorem depends\non the lower p-series of a group. The lower p-series will be defined in Section 2;\nfor the moment, it suffices to say that the lower p-series is a central series with\nelementary abelian factors and that the lower p-length of a group is the number\nof non-identity terms in the associated lower p-series. The main theorem of this\npaper may be concisely stated as follows.\nTheorem 1.1. Fix a prime p and positive integers d and n. Let rd,n be the\nproportion of p-groups minimally generated by d elements and with lower plength at most n whose automorphism group is a p-group. If n \u2265 2, then\nlim rd,n = 1.\n\nd\u2192\u221e\n\nIf d \u2265 5, then\n\nlim rd,n = 1.\n\nn\u2192\u221e\n\nIf n = 2 and d \u2265 10, or n \u2265 3 and d \u2265 6, or n \u2265 10 and d \u2265 5, then\nlim rd,n = 1.\n\np\u2192\u221e\n\nThe proof of Theorem 1.1 breaks down into three parts, which are presented\nin Sections 2, 5, and 6, and are assembled to prove Theorem 1.1 in Section 7.\nIn the remainder of this section, we will outline the structure of the proof.\nThe first step is to connect the enumeration of finite p-groups to an analysis\nof certain subgroups and quotients of free groups. Let F be the free group on\nd generators and let Fn be the n-th term in the lower p-series of F . It turns\nout that the action of Aut(F/Fn+1 ) on Fn /Fn+1 induces an action of GL(d, Fp )\non Fn /Fn+1 , and the Aut(F/Fn+1 )-orbits on the normal subgroups of Fn /Fn+1\nare also the GL(d, Fp )-orbits.\nFor any finite p-group H, write A(H) for the group of automorphisms of\nH/\u03a6(H) induced by Aut(H), where \u03a6(H) is the Frattini subgroup of H. We\nshall see that if A(H) is a p-group then so is Aut(H); in fact, our main goal is\nto prove, in some sense, that A(H) is usually trivial. In Section 2, after defining\nand investigating the lower p-series, we prove the following theorem.\nTheorem 1.2. Fix a prime p and integers d, n \u2265 2. Let F be the free group on\nd generators and define the following sets:\nAd,n\n\n=\n\nBd,n\n\n=\n\nCd,n\nDd,n\n\n=\n=\n\n{normal subgroups of F/Fn+1 lying in F2 /Fn+1 }\n\n{normal subgroups of F/Fn+1 lying in F2 /Fn+1\nand not containing Fn /Fn+1 }\n\n{normal subgroups of F/Fn+1 lying in Fn /Fn+1 }\n{normal subgroups of F/Fn+1 contained in the\nregular GL(d, Fp )-orbits in Cd,n }\n\n3\n\n\fAd,n\n\n=\n\nBd,n\nCd,n\n\n=\n=\n\nDd,n\n\n=\n\n{Aut(F/Fn+1 )-orbits in Ad,n }\n\n{Aut(F/Fn+1 )-orbits in Bd,n }\n{Aut(F/Fn+1 )-orbits in Cd,n } = {GL(d, Fp )-orbits in Cd,n }\n{regular GL(d, Fp )-orbits in Cd,n }.\n\nThen there is a well-defined map \u03c0d,n : Ad,n \u2192 {finite p-groups} given by\nL/Fn+1 7\u2192 F/L, where L/Fn+1 \u2208 Ad,n . Furthermore \u03c0d,n induces bijections\nAd,n\n\n\u2194 {p-groups of lower p-length at most n\nand minimally generated by d elements}\n\nBd,n\n\n\u2194 {p-groups of lower p-length n\nand minimally generated by d elements}\n\nDd,n\n\n\u2194 {subgroups H in \u03c0d,n (Cd,n ) with A(H) = 1}.\n\nRecall that a regular orbit is one in which every point has trivial stabilizer.\nNote that as a result of Theorem 1.2, it will be enough to show that |Ad,n |/|Dd,n |\ngoes to 1 under the relevant limits.\nSection 3 follows with an examination of the structure of Fn /Fn+1 that will\nbe needed in Section 5. Section 4 contains combinatorial estimates, including\nbounds on Gaussian coefficients, that will be needed in Sections 5 and 6. Finally,\nthe second and third steps of the proof of Theorem 1.1 are summarized in\nTheorems 1.3 and 1.4 and are proved in Sections 5 and 6. The terms C(p) and\nD(p) that appear in Theorems 1.3 and 1.4 are functions of p which tend to 1 as\np \u2192 \u221e.\nTheorem 1.3. Fix a prime p and integers d and n so that either n \u2265 3 and\nd \u2265 6 or n \u2265 10 and d \u2265 5. Let F be the free group on d generators and let dn\nbe the rank of Fn /Fn+1 . Then\n1\u2264\n\n2\n|Ad,n |\n\u2264 1 + C(p)n\u22121 D(p)n\u22122 pdn\u22121 \u2212dn /4+d .\n|Cd,n |\n\nThe proof of Theorem 1.3 uses a theorem estimating the number of normal\nsubgroups of an arbitrary finite p-group, applying it to quotients of free groups.\nTheorem 1.4. Fix a prime p and integers d and n so that either n = 2 and\nd \u2265 10 or n \u2265 3 and d \u2265 3. Let F be the free group on d generators and let dn\nbe the rank of Fn /Fn+1 . Let\n(\nC(p)5 D(p)4 p17/4 : n = 2 and d \u2265 10\nK=\nC(p)2 D(p)p3/4 : n \u2265 3.\nLet\nx=\n\n(\n\n\u2212d\nd2 \u2212 dn /2\n\nThen\n4\n\n:\n:\n\nn=2\nn \u2265 3.\n\n\f(a)\n1\u2264\n\n|Cd,n | * |GL(d, Fp )|\n\u2264 1 + Kpx .\n|Cd,n |\n\n(b)\n1\u2264\n\n1 + Kpx\n|Cd,n |\n.\n\u2264\n|Dd,n |\n1 \u2212 Kpx\n\nIn stating Theorems 1.3 and 1.4, we have judged it more satisfactory to\ngive explicit numerical bounds, even though the proof of Theorem 1.1 requires\nonly asymptotic bounds. However, since we have no expectation that our proof\nmethod gives bounds that are sharp, we have opted for clean explicit bounds\nrather than the best possible.\nAs we will show in Section 7, Theorem 1.1 follows easily from Theorems 1.2,\n1.3, and 1.4. We close Section 7 with some observations and open questions.\n\n2\n\nThe Lower p-Series\n\nIn this section, we define and discuss the lower p-series of a group (also called\nthe lower central p-series or the lower exponent-p central series). Then, in\nTheorems 2.7 and 2.8, we describe how isomorphism classes of finite p-groups\nin a variety may be enumerated, obtaining Theorem 1.2 as a corollary.\n\n2.1\n\nPreliminaries\n\nThe lower p-series was introduced by Skopin [29] and Lazard [17], and it is\ndescribed in detail by Huppert and Blackburn [16, Chapter VIII] (under the\nname \u03bb-series) and by Bryant and Kov\u00e1cs [3]. The lower p-series is particularly\nsuited to computer analysis of finite p-groups and forms the basis of the pgroup generation algorithm of M. F. Newman [23] (this algorithm is described\nin greater detail in, for example, O'Brien [25]). This algorithm was modified\nin [26] and [4] to construct automorphism groups of finite p-groups. It should\nalso be mentioned that some information about the lower p-series has appeared\nin [25] and [4], while the link between the lower p-series and automorphisms\ndescribed in Subsection 2.2 is an extension of results that Higman [13] and\nSims [28] used to count finite p-groups.\nDefinition. Fix a prime p. For any group H, the lower p-series H = H1 \u2265\nH2 \u2265 * * * of H is defined by Hi+1 = Hip [Hi , H] for i \u2265 1. H is said to have\nlower p-length n if Hn is the last non-identity element of the lower p-series.\nNote that if H is a finite p-group, then H2 = \u03a6(H), the Frattini subgroup\nof H. Before we list some basic facts about the lower p-series, recall that a\nsubgroup is fully invariant if every endomorphism of the group restricts to an\nendomorphism of the subgroup. Also, we will write H = \u03b31 (H) \u2265 \u03b32 (H) \u2265 * * *\nto denote the lower central series of H, where \u03b3i+1 (H) = [\u03b3i (H), H]. The\n\n5\n\n\ffollowing proposition states five fundamental properties of the lower p-series;\nthe first four facts are proved in Huppert and Blackburn [16, Chapter VIII,\nTheorem 1.5 and Corollary 1.6] and the fifth fact is obvious by induction.\nProposition 2.1. For all positive integers i and j,\n1. [Hi , Hj ] \u2264 Hi+j .\nj\n\n2. Hip \u2264 Hi+j .\ni\u22121\n\n3. Hi = \u03b31 (H)p\n\ni\u22122\n\n\u03b32 (H)p\n\n* * * \u03b3i (H).\n\n4. Hi+1 is the smallest normal subgroup of H lying in Hi such that Hi /Hi+1\nis an elementary abelian p-group and is central in H/Hi+1 .\n5. Hi is fully invariant in H.\nAs we will see, the fact that Hi /Hi+1 is elementary abelian, and therefore\nan Fp -vector space, is a key reason we are able to prove the main theorem. It\nis easy to see the following proposition.\nProposition 2.2. Let H be a finite group. Then H is a p-group if and only if\nH has finite lower p-length.\nThe lower p-length of a finite p-group is related to the lower p-series of a free\ngroup in the following way. Let F be the free group on d generators; then any\nfinite p-group H that is minimally d-generated is isomorphic to F/U for some\nnormal subgroup U of F . By induction, Hi = Fi U/U :\nHi+1\n\n=\n=\n\n(Fi U/U )p [Fi U/U, F/U ]\nFip [Fi , F ]U/U\n\n=\n\nFi+1 U/U.\n\nSo the lower p-length of H is n, where Fn+1 is the first term in the lower p-series\nof F that is contained in U .\n\n2.2\n\nThe Lower p-Series and Automorphisms\n\nIn this subsection we collect some necessary facts linking the lower p-series and\nautomorphisms. First, suppose that H is a finite p-group that is minimally\nd-generated. Of course, every automorphism of H induces an automorphism of\nHi /Hi+1 for each i. In particular, any automorphism of H induces an element\nof Aut(H/H2 ) \u223c\n= GL(d, Fp ) (by the Burnside Basis Theorem, the rank of H/H2\nis d). Thus we obtain a map from Aut(H) to GL(d, Fp ), and an exact sequence\n1 \u2192 K(H) \u2192 Aut(H) \u2192 A(H) \u2192 1,\nwhere A(H) is a subgroup of GL(d, Fp ). The group K(H) acts trivially on\nH/H2 , and hence on each factor Hi /Hi+1 (see Huppert and Blackburn [16,\nChapter VIII, Theorem 1.7]). As Aut(H) acts on each Hi /Hi+1 and the kernel\nof the action contains K(H), we obtain an action of A(H) on each Hi /Hi+1 .\nThe following key proposition is due to P. Hall [10, Section 1.3].\n6\n\n\fProposition 2.3. If H is a finite p-group, then so is K(H).\nLet F be the free group on d generators y1 , y2 , . . . , yd . We need two observations about the subgroup F2 , first recalling an obvious result on the Frattini\nquotient.\nProposition 2.4. If H is a finite p-group and \u03b8 is an endomorphism of H\nthat induces an automorphism on the Frattini quotient H/H2 , then \u03b8 is an\nautomorphism of H.\nProposition 2.5. F2 is a maximal fully invariant subgroup of F .\nProof. Suppose U > F2 is a fully invariant subgroup of F . The elements\ny1a1 * * * ydad , with 0 \u2264 ai < p, form a complete set of coset representatives for\nthe cosets of F2 in F , so U contains an element y = y1a1 * * * ydad with some ai\nnonzero. Fix 1 \u2264 k \u2264 d and let bi be a multiplicative inverse of ai modulo p.\nThen the endomorphism of F that sends yj to 1 for j 6= i and sends yi to ykbi\nalso sends y to yk , showing that yk \u2208 U . This holds for 1 \u2264 k \u2264 d, and so\nU = F.\nProposition 2.6. Let U be a fully invariant subgroup of F contained in F2\nwith H = F/U a finite p-group. Then any automorphism \u03b8 of F/F2 lifts to an\nautomorphism of H.\nProof. Since F is free, there is an endomorphism \u03b8\u2032 of F such that \u03b8\u2032 (yi ) \u2208\n\u03b8(yi F2 ) for 1 \u2264 i \u2264 d. Therefore \u03b8\u2032 (y) \u2208 \u03b8(yF2 ) for all y \u2208 F . Then \u03b8\u2032 induces\n\u03b8 on F/F2 , and since U is fully invariant, maps U to itself. So \u03b8\u2032 induces\nan endomorphism \u03b8\u2032\u2032 of H. But \u03b8\u2032\u2032 induces \u03b8, an automorphism of F/F2 \u223c\n=\n(F/U )/(F2 /U ) \u223c\n= H/H2 , the Frattini quotient of H. By Proposition 2.4, \u03b8\u2032\u2032 is\nan automorphism of H. Thus \u03b8 lifts to an automorphism \u03b8\u2032\u2032 of H.\nFinally, we note that by Huppert and Blackburn [16, Chapter VIII, Theorem\n11.15], the rank of F/[F, F ], and hence of F/F2 , is d, and the rank of Fn /Fn+1 is\nfinite for each n (in Section 3, we will compute the rank of Fn /Fn+1 in general).\n\n2.3\n\nEnumerating Groups in a Variety\n\nA variety of groups V consists of all groups G satisfying a set of relations w = 1,\nwhere w ranges over a fixed set W of group words (see Neumann [22]). Let F\nbe the free group on d generators. The variety V contains a relatively free group\non d generators, namely F/U , where U is the verbal subgroup of F generated\nby all the values of w \u2208 W . For example, all abelian groups form the variety in\nwhich the relation ab = ba holds for all group elements a and b. Then the free\nabelian group on d generators is the relatively free group on d generators in the\nvariety of abelian groups. We will only be interested in the variety of p-groups\nof lower p-length at most n, but the theorems in this subsection hold in more\ngeneral situations.\nLet U be a fully invariant subgroup of F . Then G = F/U is a relatively\nfree group in some variety V on at most d generators. The relations defining\n7\n\n\fV come from setting each word in U equal to the identity element. Suppose\nthat G is a finite non-trivial p-group. In this setting, we can describe A(G) and\nK(G) more precisely.\nNote that F2 U is a fully invariant subgroup of F , and by Proposition 2.5,\neither F = F2 U or F2 = F2 U . In the first case, F = U , contradicting the\nnon-triviality of G. Thus F2 = F2 U and U \u2264 F2 . Since F/F2 has rank d, both\nF and F/F2 are minimally generated by d elements. It follows that G = F/U\nis also minimally generated by d elements.\nTheorem 2.7. Suppose that G is the relatively free group on d generators in a\nvariety of groups V and that |G| = pg . Then\n1 \u2192 K(G) \u2192 Aut(G) \u2192 GL(d, Fp ) \u2192 1\nis exact and |K(G)| = pd(g\u2212d) . Furthermore, the map L 7\u2192 G/L defines a\nbijection between Aut(G)-orbits of normal subgroups L of G lying in G2 and\nd-generator groups in V . If H = G/L, then\n1 \u2192 B(L) \u2192 NAut(G) (L) \u2192 Aut(H) \u2192 1\nis exact, where B(L) is the subgroup of NAut(G) (L) that acts trivially on H. If\n|L| = pm , then |B(L)| = pdm .\n\u223c G/G2 lifts to an\nProof. By Proposition 2.6, any automorphism \u03b8 of F/F2 =\nautomorphism of G. Thus A(G) is the full automorphism group of F/F2 , which\nis GL(d, Fp ). This proves that 1 \u2192 K(G) \u2192 Aut(G) \u2192 GL(d, Fp ) \u2192 1 is exact.\nLet x1 , . . . , xd be a minimal generating set for G. Also let L be a normal\nsubgroup of G lying in G2 and let u1 , . . . , ud be any elements of L. Since G is\nrelatively free, the map \u03b1 : xi 7\u2192 xi ui for each i is an endomorphism of G (it\nsuffices to check that if a word w in the xi 's equals 1, then w\u03b1 = 1, but every\ntuple of elements of G satisfies the same relations, so when xi is replaced by xi ui\nin w, the new word also equals 1). Furthermore, \u03b1 acts trivially on G/L and is\nan automorphism by Proposition 2.4. Conversely, any automorphism of G that\nacts trivially on G/L must act on each xi as multiplication by an element of\nL. Thus the number of automorphisms of G that act trivially on G/L is |L|d .\nTaking L = G2 gives |K(G)| = pd(g\u2212d) .\nNext, we claim that any group H in V that is minimally generated by d\nelements is isomorphic to G/L for some normal subgroup L of G lying in G2 .\nEvidently H is isomorphic to G/L for some normal subgroup L of G; it suffices\nto show that if L 6\u2264 G2 , then G/L will be generated by fewer than d elements.\nChoose x1 \u2208 L \\ G2 . Extend {x1 } to a generating set {x1 , . . . , xd } of G. Then\nG/L is generated by the images of {x2 , . . . , xd }.\nSuppose M is a normal subgroup of G in the same Aut(G)-orbit as L. Clearly\nG/M \u223c\n= G/L, so the map L 7\u2192 G/L is well-defined on Aut(G)-orbits of normal\nsubgroups of G lying in G2 . To show that this is a bijection, we must show that\nif M is a normal subgroup of G lying in G2 with G/M \u223c\n= G/L, then M is in\nthe same Aut(G)-orbit as L. Let \u03b2 : G/L \u2192 G/M be an isomorphism. By [22,\n8\n\n\fTheorem 44.21], G is projective, as in [22, Definition 44.11]; as the quotient\nmap from G to G/M is surjective, this says that there exists an endomorphism\n\u03b3 : G \u2192 G so that the diagram in Figure 1 commutes. Then \u03b3 induces \u03b2, and\n\u03b2 induces an automorphism on the Frattini quotient of G (since the Frattini\nquotients of G/L and G/M are isomorphic to the Frattini quotient of G). It\nfollows from Proposition 2.4 that \u03b3 is an automorphism of G. From Figure 1,\nit is also clear that L\u03b3 \u2264 M . Thus L\u03b3 = M , and L and M are in the same\nAut(G)-orbit.\n/ G/L\n\nG\n\u03b3\n\n\u000f\nG\n\n\u03b2\n\n\u000f\n/ G/M\nFigure 1\n\nIf we take L = M , we find that any automorphism of H = G/L is induced\nby an automorphism of G, so that Aut(H) \u223c\n= NAut(G) (L)/B(L), where B(L) is\nthe subgroup of NAut(G) (L) that acts trivially on H. By the earlier argument\nin this proof, |B(L)| = |L|d .\nTheorem 2.8. Suppose that G is the relatively free group on d generators in a\nvariety of groups V and suppose that G has lower p-length n. The map L 7\u2192 G/L\ndefines a bijection between GL(d, Fp )-orbits on normal subgroups L of G lying in\nGn and groups H in V that are minimally generated by d elements and satisfy\nH/Hn \u223c\n= G/Gn . If H = G/L, then\n1 \u2192 K(G)/B(L) \u2192 Aut(H) \u2192 NGL(d,Fp ) (L) \u2192 1\nis exact, where B(L) is the subgroup of NAut(G) (L) that acts trivially on H.\nMoreover, K(H) is the image of K(G)/B(L) in Aut(H).\nProof. H/Hn \u223c\n= G/Gn L is isomorphic to G/Gn if and only if L \u2264 Gn . Furthermore, K(G) acts trivially on Gn \u223c\n= Gn /Gn+1 as noted in Subsection 2.2, so\nthe Aut(G)-orbits of normal subgroups of G lying in Gn are just the GL(d, Fp )orbits. This proves the bijection.\nSince K(G) fixes L, it also follows that\n1 \u2192 K(G) \u2192 NAut(G) (L) \u2192 NGL(d,Fp ) (L) \u2192 1\nis exact. Combined with the second exact sequence in Theorem 2.7, we find\nthat\n1 \u2192 K(G)/B(L) \u2192 Aut(H) \u2192 NGL(d,Fp ) (L) \u2192 1\nis exact. Every automorphism in K(G) induces an automorphism in K(H) since\nK(G) fixes L and G/G2 \u223c\n= H/H2 . Conversely, every automorphism in K(H) is\ninduced by an automorphism in K(G). The kernel of the map from K(G) to\nK(H) is B(L), so K(H) is the image of K(G)/B(L).\n\n9\n\n\fWe can now prove Theorem 1.2, restated here for convenience.\nTheorem 1.2. Fix a prime p and integers d, n \u2265 2. Let F be the free group on\nd generators and define the following sets:\nAd,n\n\n=\n\nBd,n\n\n=\n\nCd,n\nDd,n\n\n=\n=\n\nAd,n\n\n=\n\nBd,n\nCd,n\n\n=\n=\n\nDd,n\n\n=\n\n{normal subgroups of F/Fn+1 lying in F2 /Fn+1 }\n\n{normal subgroups of F/Fn+1 lying in F2 /Fn+1\nand not containing Fn /Fn+1 }\n\n{normal subgroups of F/Fn+1 lying in Fn /Fn+1 }\n{normal subgroups of F/Fn+1 contained in the\nregular GL(d, Fp )-orbits in Cd,n }\n\n{Aut(F/Fn+1 )-orbits in Ad,n }\n\n{Aut(F/Fn+1 )-orbits in Bd,n }\n{Aut(F/Fn+1 )-orbits in Cd,n } = {GL(d, Fp )-orbits in Cd,n }\n{regular GL(d, Fp )-orbits in Cd,n }.\n\nThen there is a well-defined map \u03c0d,n : Ad,n \u2192 {finite p-groups} given by\nL/Fn+1 7\u2192 F/L, where L/Fn+1 \u2208 Ad,n . Furthermore \u03c0d,n induces bijections\nAd,n\n\n\u2194 {p-groups of lower p-length at most n\n\nand minimally generated by d elements}\n\nBd,n\n\n\u2194 {p-groups of lower p-length n\nand minimally generated by d elements}\n\nDd,n\n\n\u2194 {subgroups H in \u03c0d,n (Cd,n ) with A(H) = 1}.\n\nProof. Take V to be the variety of p-groups of lower p-length at most n. Then\nF/Fn+1 is the relatively free group on d generators in V . The Aut(F/Fn+1 )and GL(d, Fp )-orbits in Cd,n are the same because of the first exact sequence\nin Theorem 2.7 and the fact that K(F/Fn+1 ) acts trivially on Fn /Fn+1 as in\nSubsection 2.2.\nThe map \u03c0d,n is well-defined and defines bijections for Ad,n and Bd,n by\nTheorem 2.7. A normal subgroup L of F/Fn+1 lying in Fn /Fn+1 is in a regular\nGL(d, Fp )-orbit if NGL(d,Fp) (L) = 1. By Theorem 2.8, L is in a regular orbit if\nand only if A(H) = 1. Thus the bijection for Dd,n is proved.\nNote, by the way, that since Fn /Fn+1 is elementary abelian and central in\nF/Fn+1 , the set Cd,n is just the set of subspaces of the vector space Fn /Fn+1 .\n\n3\n\nThe Lower p-Series of a Free Group\n\nLet F be the free group on d generators y1 , y2 , . . . , yd . To prepare for Sections 5\nand 6, we need to analyze the Fp GL(d, Fp )-module structure of Fn /Fn+1 along\nwith power and commutator maps from Fn /Fn+1 to Fn+1 /Fn+2 . Our main tool\n10\n\n\fwill be the connection between the lower p-series of F and the free Lie algebra\ndescribed in Theorem 3.2. The results of Theorem 3.2 appear several times in\nthe literature with varying degrees of correctness and detail. Our presentation\nfollows Bryant and Kov\u00e1cs [3], while the most complete proofs may be inferred\nfrom Huppert and Blackburn [16, Chapter VIII]. Information about the free Lie\nalgebra can be found in Garsia [7] and Reutenauer [27].\nLet K be any field and let A = {x1 , . . . , xd } be an alphabet on d letters.\nWrite A\u2217 for the collection of all A-words and An for the collection of all Awords of length n. Let K[A\u2217 ] denote the free associative K-algebra on the\ngenerators x1 , x2 , . . . , xd ; equivalently, K[A\u2217 ] is the non-commutative algebra\nof polynomials\nX\nf=\nfw w\nw\u2208A\u2217\n\nwith coefficients fw \u2208 K. The algebra K[A\u2217 ] is graded by degree; let K[An ]\ndenote the homogeneous component of degree n. Also, K[A\u2217 ] is a Lie algebra\nunder the Lie bracket [f, g] = f g \u2212 gf . Let K[\u039b\u2217 ] denote the Lie subalgebra\nof K[A\u2217 ] generated by x1 , . . . , xd and the Lie bracket. Then K[\u039b\u2217 ] is the free\nLie algebra over K on x1 , . . . , xd . It is also graded by degree; let K[\u039bn ] be the\nhomogeneous component of K[\u039b\u2217 ] of degree n.\nIt will be convenient to specify a basis of K[\u039bn ]. Lexicographically order the\nset A\u2217 , where x1 < x2 < * * * < xd . A word w is a Lyndon word if it is smaller\nthan all of its proper non-trivial tails. Let L be the set of Lyndon words, and let\nLn be the set of Lyndon words of length n. Inductively define the right standard\nbracketing b[w] of w \u2208 L by\nb[w] = w\nif w \u2208 A and otherwise by\nb[w] = [b [w1 ] , b [w2 ]] ,\nwhere w = w1 w2 and w2 is the longest proper tail of w that is a Lyndon word.\nTheorem 3.1 (Reutenauer [27, Proof of Theorem 5.1]). If w \u2208 L, then\nX\nb[w] = w +\nfv v\nw<v\n\nfor some fv \u2208 K. The set {b[w] : w \u2208 Ln } forms a basis for K[\u039bn ].\nThe results in this section require many maps; in an attempt to clarify\nmatters, we will define all the maps now, using suggestive names, and postpone\nstating their properties until necessary.\nDefinition. Fix a prime p. Fix integers n \u2265 1, d \u2265 2, and 1 \u2264 j \u2264 d. Let\nfi \u2208 Fi for each i \u2265 1.\n\u2022 pown : Fn /Fn+1 \u2192 Fn+1 /Fn+2\n(a power map on F )\npown : fn Fn+1\n\n7\u2192 fnp Fn+2\n11\n\n\f\u2022 Fcomj,n : Fn /Fn+1 \u2192 Fn+1 /Fn+2\n(a commutator map on F )\nFcomj,n : fn Fn+1\n\n7\u2192\n\n[fn , yj ]Fn+2\n\n\u2022 embn : Fn \u2192 Fp [A\u2217 ]\n\n(an embedding of Fn into Fp [A\u2217 ])\nemb1 :\n\nyj\n\n7\u2192 xj\n\u001a\nemb1 (f1 ) + emb1 (f1 )2 : n = 2 and p = 2\nembn :\n7\u2192\nembn\u22121 (fn\u22121 )\n: otherwise\nembn : [fn\u22121 , f1 ] 7\u2192 [embn\u22121 (fn\u22121 ), emb1 (f1 )]\nembn : fn+1\n7\u2192 0\np\nfn\u22121\n\n\u2022 qembn : Fn /Fn+1 \u2192 Fp [A\u2217 ]\n\n(an embedding of the quotient Fn /Fn+1 into Fp [A\u2217 ])\nqembn is induced by embn\n\n\u2022 com : {subspaces of Fp [A\u2217 ]} \u2192 {subspaces of Fp [A\u2217 ]}\n(a commutator map on Fp [A\u2217 ])\ncom : W\n\n7\u2192 [W, Fp [\u039b1 ]]\n\n\u2022 comj : Fp [A\u2217 ] \u2192 Fp [A\u2217 ]\n\n(a commutator map on Fp [A\u2217 ])\ncomj : f\n\n7\u2192 [f, xj ]\n\n\u2022 comj,n : Fp [An ] \u2192 Fp [An+1 ]\n\n(a commutator map on Fp [An ])\ncomj,n is induced by comj .\n\n\u2022 projn : Fp [A\u2217 ] \u2192 Fp [An ]\n\n(the projection map onto Fp [An ])\n\nTheorem 3.2. The map embn is a well-defined homomorphism. The map\nqembn is an Fp GL(d, Fp )-module embedding of Fn /Fn+1 into Fp [A\u2217 ]. If p is\nodd, the image of qembn is Fp [\u039b1 ] \u2295 * * * \u2295 Fp [\u039bn ], and hence\nFn /Fn+1 \u223c\n= Fp [\u039b1 ] \u2295 * * * \u2295 Fp [\u039bn ]\nas Fp GL(d, Fp )-modules.\nIf p = 2, the image of qemb1 is F2 [\u039b1 ]. The image E of qemb2 satisfies\nE + F2 [A2 ] = F2 [A1 ] \u2295 F2 [A2 ]\n\nand\n\nE \u2229 F2 [A2 ] = F2 [\u039b2 ],\n\nso E is an extension of F2 [\u039b2 ] by F2 [\u039b1 ]. For n \u2265 3, the image of qembn is\nE \u2295 F2 [\u039b3 ] \u2295 * * * \u2295 F2 [\u039bn ], and hence\nFn /Fn+1 \u223c\n= E \u2295 F2 [\u039b3 ] \u2295 * * * \u2295 F2 [\u039bn ].\n12\n\n\f\u223c V \u2227 V \u2227 * * * \u2227 V , the n-fold\nNote that as a Fp GL(d, Fp )-module, Fp [\u039bn ] =\nwedge product where V is the natural Fp GL(d, Fp )-module.\nCorollary 3.3. Unless p = 2 and n = 1, the diagram on the left commutes and\npown is an injective homomorphism. The diagram on the right commutes and\nFcomj,n is a homomorphism.\nqembn\n\n/ Fp [A\u2217 ]\nFn /Fn+1\nNNN\nr\nr\nNNN\nrrr\nN\nr\nr\npown NNN\nN&\nxrrr qembn+1\nFn+1 /Fn+2\n\nFn /Fn+1\nFcomj,n\n\nqembn\n\n/ Fp [A\u2217 ]\ncomj\n\n\u000f\n\u000f\nqembn+1\nFp [An ]\nFn+1 /Fn+2 o\n\nThe dimension of K[\u039bi ] is given by Witt's formula:\n1X\n\u03bc(i/j) * dj ,\ndim(K[\u039bi ]) =\ni\nj|i\n\nwhere \u03bc is the M\u00f6bius function (see [27, Appendix 0.4.2]). Thus Theorem 3.2\ntells us the rank of Fn /Fn+1 .\nCorollary 3.4. The rank of Fn /Fn+1 is\nn\nX\n1X\ni=1\n\ni\n\nj|i\n\n\u03bc(i/j) * dj .\n\nThe remainder of this section is devoted to proving the following theorem\nand corollary. Corollary 3.6 will allow us to count normal subgroups of F/Fn+1\nwhen combined with Theorem 5.1.\nTheorem 3.5. Fix a prime p and integers d \u2265 3 and n \u2265 2. Suppose that U is\na normal subgroup of F lying in F2 . Let\nQ =\nR =\nS =\n\n(U \u2229 Fn )Fn+1 /Fn+1\n\n(U2 \u2229 Fn+1 )Fn+2 /Fn+2\n(U p [U, F ] \u2229 Fn+1 )Fn+2 /Fn+2 .\n\nThen rank(R) \u2265 rank(Q) and rank(S) \u2265 (3/2) rank(Q).\nThe third isomorphism theorem lets us replace F by F/Fn , giving the following corollary.\nCorollary 3.6. Fix a prime p and integers d \u2265 3, n \u2265 3, and 2 \u2264 i < n. Let\nG = F/Fn+1 . Suppose that U is a normal subgroup of G lying in G2 . Let\nQ\nR\n\n=\n=\n\nS\n\n=\n\n(U \u2229 Gi )Gi+1 /Gi+1\n(U2 \u2229 Gi+1 )Gi+2 /Gi+2\n\n(U p [U, F ] \u2229 Gi+1 )Gi+2 /Gi+2 .\n\nThen rank(R) \u2265 rank(Q) and rank(S) \u2265 (3/2) rank(Q).\n13\n\n\fTo prove Theorem 3.5, we will build up to an analogous result for the free\nLie algebra on d generators (Lemma 3.11) and then apply Theorem 3.2.\nLemma 3.7. The following diagram commutes:\nFp [A\u2217 ]\n\ncomj\n\nprojn+1\n\nprojn\n\n\u000f\nFp [An ]\n\n/ Fp [A\u2217 ]\n\n\u000f\n/ Fp [An+1 ]\ncomj,n\n\nIf n = 1, then the kernel of comj,n is spanned by xj . If n > 1, then comj,n is\ninjective.\nProof. The only statements requiring proof are those about the kernel and injectivity of comj,n . Without loss of generality, we may assume that j = 1. Suppose\nthat w \u2208 Ln . Unless n = 1 and w = x1 , we see that x1 w is smaller than w, and\nhence smaller than all of its proper non-trivial tails. So x1 w \u2208 Ln+1 . Furthermore, w is the longest tail of x1 w that is a Lyndon word, so b[x1 w] = \u2212[b[w], x1 ].\nThus the image of b[w] under com1,n is the negative of a basis element in Ln+1 ,\nunique for each w. It follows that the kernel of com1,1 is generated by x1 and\ncom1,n is injective for n > 1.\nLemma 3.8. Fix d \u2265 3 and n \u2265 2. Suppose that W is a subspace of Fp [\u039bn ].\nThen dim(com(W )) \u2265 (3/2) dim(W ).\nProof. Let Fp [\u039b\u2217 ]ij denote the free Lie algebra on two generators xi and xj ;\nthere is a natural embedding of Fp [\u039b\u2217 ]ij into Fp [\u039b\u2217 ]. Let Fp [\u039bn ]ij be the homogeneous component of degree n in Fp [\u039b\u2217 ]ij .\nFirst, we claim that if f and g are distinct elements of Fp [\u039bn ] and [f, xi ] =\n[g, xj ], then in fact f, g \u2208 Fp [\u039bn ]ij . We may assume that i, j > 1. Suppose that\nf\u2208\n/ Fp [\u039bn ]ij . Then writing\nX\nf=\nfw b[w],\nw\u2208Ln\n\nthere must be some word w \u2208 Ln where fw 6= 0 and w contains a letter other\nthan xi and xj . We may assume that w contains the letter x1 . In that case, by\nTheorem 3.1, there is a word beginning with x1 that appears in f with non-zero\ncoefficient. Thus there is a word beginning with x1 and ending with xi that\nappears in [f, xi ] with non-zero coefficient. No such word can appear in [g, xj ],\ncontradicting the fact that [f, xi ] = [g, xj ]. Hence f \u2208 Fp [\u039bn ]ij and similarly\ng \u2208 Fp [\u039bn ]ij .\nNote that Fp [\u039bn ]ij \u2229 Fp [\u039bn ]kl = 0 if {i, j} 6= {k, l} (the letters xi and xj\nappear in every element of Fp [\u039bn ]ij since n > 1). Choose i and j so that\ndim(W \u2229 Fp [\u039bn ]ij ) is as small as possible; in particular this intersection has\ndimension at most (1/2) dim(W ). Let X be a complement to W \u2229 Fp [\u039bn ]ij in\nW.\n14\n\n\fDefine a more restrictive commutator map on subspaces by comij : \u2022 7\u2192\n[\u2022, Fp [\u039b1 ]ij ]. Obviously comij (W ) \u2286 com(W ). Using Lemma 3.7 and the above\nclaim,\ndim(comij (W ))\n\n=\n\u2265\n\n\u2265\n\ndim(comij (W \u2229 Fp [\u039bn ]ij )) + dim(comij (X))\ndim(W \u2229 Fp [\u039bn ]ij ) + 2 dim(X)\n(3/2) dim W.\n\nLemma 3.9. Fix d \u2265 2. Suppose that W be a subspace of Fp [\u039b1 ]. Then\ndim(W + com(W )) \u2265 (3/2) dim(W ).\nProof. Recalling Lemma 3.7, this is clear if dim(W ) = 1, and otherwise\ndim(com1,1 (W )) \u2265 dim(W ) \u2212 1,\nimplying the result since W and com(W ) are disjoint.\nLemma 3.10. Let p = 2. Suppose that W is a subspace of E, where E is\ndefined in Theorem 3.2. Then dim(W + com(W )) \u2265 (3/2) dim(W ).\n\nProof. Let X = W \u2229 F2 [\u039b2 ] and let Y be a complement to X in W . Note that\ndim(Y ) = dim(proj1 (Y )). By Lemma 3.9,\ndim(proj1 (Y ) + com(proj1 (Y ))) \u2265 (3/2) dim(proj1 (Y )).\nBy the commutative diagram in Lemma 3.7, it follows that Y +com(Y ) contains\na subspace of dimension at least (3/2) dim(Y ) that has trivial intersection with\nF2 [\u039b3 ]. By Lemma 3.8, com(X) \u2264 F2 [\u039b3 ] contains a subspace of dimension at\nleast (3/2) dim(X). Then\ndim(W + com(W )) \u2265 (3/2) dim(X) + (3/2) dim(Y ) = (3/2) dim(W ).\nLemma 3.11. Fix d \u2265 3. Let Un = Fp [\u039b1 ] \u2295 * * * \u2295 Fp [\u039bn ] if p is odd or\nUn = E \u2295 F2 [\u039b3 ] \u2295 * * * \u2295 F2 [\u039bn ] if p = 2. Suppose that W is a subspace of Fp [A\u2217 ]\ncontained in Un . Then dim(W + com(W )) \u2265 (3/2) dim(W ).\nProof. The proof will be by induction on n. When p is odd and n = 1,\nLemma 3.9 gives the result. When p = 2 and n = 2, Lemma 3.10 gives the\nresult. So assume that p is odd and n > 1 or that p = 2 and n > 2. Assume\nthe result holds for n \u2212 1. Let X = W \u2229 Un\u22121 . By the inductive hypothesis,\ndim(X + com(X)) \u2265 (3/2) dim(X).\nFurthermore, X + com(X) \u2264 Un . Let Y be a complement to X in W . By the\ncommutative diagram in Lemma 3.7, com(projn (Y )) = projn+1 (com(Y )). By\nthe definition of X and Y , dim(projn (Y )) = dim(Y ). By Lemma 3.8,\ndim(projn+1 (com(Y ))) \u2265 (3/2) dim(projn (Y )).\n15\n\n\fThus com(Y ) contains a subspace of dimension at least (3/2) dim(projn (Y ))\nthat has trivial intersection with Un . Therefore\ndim(W + com(W )) \u2265 (3/2) dim(X) + (3/2) dim(Y ) = (3/2) dim(W ).\nProof of Theorem 3.5. Replacing U by (U \u2229 Fn )Fn+1 does not change Q, R, or\nS, so we may assume that Fn+1 \u2264 U \u2264 Fn . Recall that by Corollary 3.3, pown\nis injective. Since pown (Q) = R, it follows that rank(R) \u2265 rank(Q).\nAlso by Corollary 3.3,\nS = qemb\u22121\nn+1 (qembn (U ) + (com \u25e6 qembn )(U )).\nSince qembn is injective, and\ndim(qembn (U ) + (com \u25e6 qembn )(U )) \u2265 (3/2) dim(qembn (U ))\nby Lemma 3.11, it follows that rank(S) \u2265 (3/2) rank(Q).\n\n4\n\nNumerical Estimates\n\nThe purpose of this section is to prove several estimates needed in Sections 5\nand 6. Most of the estimates involve Gaussian coefficients, and so we will begin\nwith the relevant definitions and bounds on the Gaussian coefficients obtained\nby Wilf [32].\nThe Gaussian coefficient (also called the q-binomial coefficient )\n\u0014 \u0015\nn\n(q n \u2212 1) * * * (q n \u2212 q k\u22121 )\n= k\nk q\n(q \u2212 1) * * * (q k \u2212 q k\u22121 )\nis the number of k-dimensional subspaces of a \u0002vector\nspace of dimension n over\n\u0003\nFq . We shall be concerned with estimates for nk q and for the Galois number\nGn (q) =\n\nn \u0014 \u0015\nX\nn\nk=0\n\nk\n\n,\nq\n\nwhich is the total number of subspaces of a vector space of dimension n over\nFq . (A survey of these numbers is given by Goldman and Rota [9].) First we\nneed a technical lemma.\nLemma 4.1. Let\nC(q) =\n\n\u221e\nX\n\n2\n\nq \u2212r .\n\nr=\u2212\u221e\n\nP\nLet f (x) = \u2212ax + bx + c with a > 0, let |q| > 1, and set A(q) = r q f (r) , where\nthe sum is over all integers r with t \u2264 r \u2264 u. Then A(q) \u2264 C(q a )q f (y) for some\ny \u2208 [t, u].\n2\n\n16\n\n\fProof. Suppose the maximum of f (x) in [t, u] occurs at x = y. The global\nmaximum of f (x) occurs at x = b/2a, so one of three cases holds: b/2a \u2264 y = t,\nu = y \u2264 b/2a, or t \u2264 y = b/2a = u. In each case, for all r \u2208 [t, u],\n=\n=\n\u2265\n\n\u2212a(r \u2212 y)2 \u2212 f (r) + f (y)\n\u2212a(r \u2212 y)2 \u2212 (\u2212ar2 + br + c) + (\u2212ay 2 + by + c)\n(2ay \u2212 b)(r \u2212 y)\n\n0.\n\nThus\nA(q)\n\n=\n\nq f (y)\n\n\u2264\n\nq\n\nf (y)\n\n\u2264\n\nq f (y)\n\nX\n\nq f (r)\u2212f (y)\n\nt\u2264r\u2264u\n\nX\n\nt\u2264r\u2264u\n\u221e\nX\n\nq \u2212a(r\u2212y)\n\n2\n\n2\n\nq \u2212a(r\u2212y) ,\n\nr=\u2212\u221e\n\nand it suffices to show that\ng(y) =\n\n\u221e\nX\n\n2\n\nr=\u2212\u221e\n\ns\u2212(r\u2212y) \u2264 g(0),\n\nwhere s = q a . This is a consequence of Jacobi's functional equation for the\ntheta function\n\u221e\nX\n2\n\u03b83 (z, w) =\ner \u03c0iw e2riz ,\nr=\u2212\u221e\n\nwhere |e\u03c0iw | < 1. Section 21.51 of Whittaker and Watson [31] gives the functional equation\n2\n1\n\u03b83 (z, w) = \u221a\nez /\u03c0iw \u03b83 (z/w, \u22121/w),\n\u2212iw\n\nwhere\n\n\u221a\nei\u03b8 denotes ei\u03b8/2 for 0 \u2264 \u03b8 \u2264 2\u03c0. Now\ng(y) =\n\ns\u2212y\n\n2\n\n\u221e\nX\n\n2\n\ns\u2212r e\u22122ri(iy log s)\n\nr=\u2212\u221e\n\n=\n\ns\n\n\u2212y 2\n\n\u03b83 (\u2212iy log s, w),\n\n17\n\n\fwhere s\u22121 = e\u03c0iw so that \u03c0iw = \u2212 log s. Hence\ng(y) =\n=\n=\n\u2264\n\n2\u221a\ns\u2212y \u03c0 y2 log s\n\u221a\ne\n\u03b83 (\u2212\u03c0y, \u22121/w)\nlog s\nr\nr=\u221e\n\u03c0 X \u2212r2 \u03c02 / log s \u22122ir\u03c0y\ne\ne\nlog s r=\u2212\u221e\nr\n\u221e\nX\n2 2\n\u03c0\n(1 + 2\ne\u2212r \u03c0 / log s cos 2r\u03c0y)\nlog s\nr=1\nr\n\u221e\nX\n2 2\n\u03c0\n(1 + 2\ne\u2212r \u03c0 / log s )\nlog s\nr=1\n\n= g(0).\n\nTo obtain bounds for Gaussian coefficients, let\nD(q) =\nSn (q) =\n\n\u221e\nY\n\nj=1\nn\nX\n\n(1 \u2212 q \u2212j )\u22121\n2\n\nq k(n\u2212k) = q n\n\nk=0\n\n/4\n\nn\nX\n\n2\n\nq \u2212(k\u2212n/2) .\n\nk=0\n\nNote that both C(q) and D(q) decrease to 1 as q \u2192 \u221e. If q \u2265 2, then\nC(q) \u2264 C(2) < 9/4 and D(q) \u2264 D(2) < 7/2. The following estimates on\nGaussian coefficients and Galois numbers were either obtained by Wilf [32] or\nfollow from his work.\nLemma 4.2. Fix q \u2265 2. Then\n\n2\n\nD(q)q n\n\n/4\u22121/4\n\n\u0012\n9q\n2\u2212\n\n\u0014 \u0015\nn\nk q\n\u0013\n(1\u2212n)/2\n2\n\n\u2264 D(q)q k(n\u2212k)\n\n(1)\n\n\u2264 Gn (q)\n\n(2)\n\n\u2264 Sn (q)D(q)\n\n2\n\n\u2264 C(q)D(q)q n\n\n/4\n\nProof. Equation 1 and Gn (q) \u2264 Sn (q)D(q) are proved in [32]. The inequality\n2\nSn (q) \u2264 C(q)q n /4 follows from Lemma 4.1, taking f (x) = x(n \u2212 x) = \u2212x2 + nx\n2\nand noting that x(n \u2212 x) \u2264 n2 /4 for all x. This proves Gn (q) \u2264 C(q)D(q)q n /4 .\nThe lower bound for Gn (q) is slightly more complicated, but it is easy to see\n\n18\n\n\ffrom [32], Lemma 4.1, and the definition of Sn (q) that\nGn (q)\n\n\u2265\n\nSn (q) \u2212\n\n2Sn\u22121 (q) + 2q \u22122n\nq\u22121\n2\n\n2C(q)q (n\u22121) /4\n2q\n\u2212\nq\u22121\n\u0012\n\u0013\n2C(q)q (1\u2212n)/2\nn2 /4\u22121/4\n2\u2212\nq\nq\u22121\n\u0012\n\u0013\n(1\u2212n)/2\n9q\nn2 /4\u22121/4\n2\u2212\nq\n,\n2\nn2 /4\u22121/4\n\n\u2265\n\u2265\n\u2265\n\nwhere the last inequality uses the fact that 2C(q)/(q \u2212 1) < 9/2.\nNext we shall prove Lemma 4.3, which will be needed in Section 5 to bound\nproducts of Gaussian coefficients, and we will finish with Lemma 4.4, which will\nbe used in Section 6.\nLemma 4.3. Fix a prime p and integers n \u2265 3 and d \u2265 6 or n \u2265 10 and d \u2265 5.\nLet F be the free group on d generators, and let dn be the rank of Fn /Fn+1 . For\n1 \u2264 i \u2264 n \u2212 1 and 0 \u2264 ui \u2264 di , let\nAi (ui ) =\n\nX n\u22121\nY\n\np\u2212(uj+1 \u2212dj+1 )(uj+1 \u2212uj /2) ,\n\nj=i\n\nwhere the sum is over all integers ui+1 , . . . , un such that\n0\u2264\nuj\n1 \u2264 un\u22121\n2\u2264\n\nun\n\n\u2264 dj\nfor i + 1 \u2264 j \u2264 n \u2212 2\n\u2264 dn\u22121\n\u2264 dn .\n\nThen for 1 \u2264 i \u2264 n \u2212 2,\n2\n\nAi (ui ) \u2264 C(p)n\u2212i p\u221215/16+dn /4+dn\u22121 \u2212dn /4 p\u2212ui (di+1 \u22121)/2 .\nProof. First note that\nAn\u22121 (un\u22121 ) =\n\ndn\nX\n\np\u2212(un \u2212dn )(un \u2212un\u22121 /2) .\n\nun =2\n\nAs a function of un , the expression \u2212(un \u2212 dn )(un \u2212 un\u22121 /2) is at most (dn \u2212\nun\u22121 /2)2 /4, so that\nAn\u22121 (un\u22121 ) \u2264 C(p)p(dn \u2212un\u22121 /2)\nby Lemma 4.1.\n19\n\n2\n\n/4\n\n\fThe proof of the theorem is by backward induction on i. Note that\nX\np\u2212(ui+1 \u2212di+1 )(ui+1 \u2212ui /2) Ai+1 (ui+1 ).\nAi (ui ) =\nui+1\n\nWhen i = n \u2212 2, using our bound on An\u22121 (un\u22121 ) gives\nAn\u22122 (un\u22122 )\ndn\u22121\n2\n\n\u2264 C(p)pdn /4\n\n2\n\nX\n\npun\u22121 /16\u2212un\u22121 dn /4+(dn\u22121 \u2212un\u22121 )(un\u22121 \u2212un\u22122 /2)\n\nX\n\np\u221215un\u22121 /16+(\u2212dn /4+un\u22122 /2+dn\u22121 )un\u22121 \u2212dn\u22121 un\u22122 /2\n\nun\u22121 =1\ndn\u22121\n\n= C(p)p\n\nd2n /4\n\n2\n\nun\u22121 =1\n\nAs a function of un\u22121 , the polynomial\n\u221215u2n\u22121/16 + (\u2212dn /4 + un\u22122 /2 + dn\u22121 )un\u22121 \u2212 dn\u22121 un\u22122 /2\nis maximized at\nun\u22121 = 8(\u2212dn /4 + un\u22122 /2 + dn\u22121 )/15.\nComputations show that this is at most 1 when n \u2265 3 and d \u2265 6 or n \u2265 10\nand d \u2265 5. So as un\u22121 ranges from 1 to dn\u22121 , the polynomial is maximized at\nun\u22121 = 1. By Lemma 4.1 and the fact that C(p15/16 ) \u2264 C(p),\n2\n\nC(p)2 pdn /4\u221215/16\u2212dn /4+dn\u22121 p(1\u2212dn\u22121 )un\u22122 /2 .\n\nAn\u22122 (un\u22122 ) \u2264\n\nThis proves the theorem for the base case i = n \u2212 2. By induction, for i \u2264 n \u2212 3,\ndi+1\n\nAi (ui )\n\n=\n\nX\n\np\u2212(ui+1 \u2212di+1 )(ui+1 \u2212ui /2) Ai+1 (ui+1 )\n\nui+1 =0\n2\n\n\u2264 C(p)n\u2212i\u22121 p\u221215/16+dn /4+dn\u22121 \u2212dn /4\ndi+1\n\n*\n\nX\n\np\u2212(ui+1 \u2212di+1 )(ui+1 \u2212ui /2)\u2212ui+1 (di+2 \u22121)/2 .\n\nui+1 =0\n\nAs a function of ui+1 , the polynomial\n=\n\n\u2212(ui+1 \u2212 di+1 )(ui+1 \u2212 ui /2) \u2212 ui+1 (di+2 \u2212 1)/2)\n\n\u2212u2i+1 + (di+1 + ui /2 \u2212 (di+2 \u2212 1)/2)ui+1 \u2212 di+1 ui /i\n\nis maximized at\nui+1 = (di+1 + ui /i \u2212 (di+2 \u2212 1)/2))/2.\nComputations show that this is at most 1/2 for d \u2265 3 and i \u2265 1. So as ui+1\nranges from 0 to di+1 , the polynomial is maximized at ui+1 = 0. Thus\n2\n\nAi (ui ) \u2264 C(p)n\u2212i p\u221215/16+dn /4+dn\u22121 \u2212dn /4 p\u2212(di+1 \u22121)ui /i\nand the result is proved by induction.\n20\n\n\fLemma 4.4. Suppose that \u03b11 , . . . , \u03b1s are positive integers with n = \u03b11 +* * *+\u03b1s .\nThen\n\u03b121 + * * * + \u03b12s \u2264 (n \u2212 s + 1)2 + (s \u2212 1),\n(3)\nand this bound is achieved when \u03b11 = \u03b12 = * * * = \u03b1s\u22121 = 1. Furthermore, if\nn \u2265 \u03b5 + 1 and s \u2265 2, then\n\u03b121 + * * * + \u03b12s + \u03b5s \u2264 (n \u2212 1)2 + 1 + 2\u03b5.\n\n(4)\n\nProof. For Equation 3, we use a simple induction argument. It is clearly true\nfor s = 1. Suppose it is true up through s; we will prove it for s + 1.\n\u03b121 + * * * + \u03b12s + \u03b12s+1\n\n\u2264 (n \u2212 \u03b1s+1 \u2212 s + 1)2 + (s \u2212 1) + \u03b12s+1\n\n\u2264 (n \u2212 s + 1 \u2212 \u03b1s+1 )2 + \u03b12s+1 + (s \u2212 1)\n\u2264 (n \u2212 s + 1 \u2212 1)2 + 12 + (s \u2212 1)\n= (n \u2212 s)2 + s,\n\nproving Equation 3. As for Equation 4,\n\u03b121 + * * * + \u03b12s + \u03b5s \u2264\n=\n=\n\n\u2264\n=\n\n(n \u2212 s + 1)2 + (s \u2212 1) + \u03b5s\n\n((n \u2212 1) \u2212 (s \u2212 2))2 + s \u2212 1 + \u03b5s\n(n \u2212 1)2 \u2212 2(n \u2212 1)(s \u2212 2) + (s \u2212 2)2 + s \u2212 1 + \u03b5s\n\n(n \u2212 1)2 \u2212 (\u03b5 + s \u2212 1)(s \u2212 2) + (s \u2212 2)2 + s \u2212 1 + \u03b5s\n(n \u2212 1)2 + 1 + 2\u03b5,\n\nwhere the first inequality follows from Equation 3 and the second inequality\nfollows from the fact that since n \u2265 \u03b5 + 1 and n \u2265 s, we know that n \u2265\n(\u03b5 + s + 1)/2.\n\n5\n\nFrom Subgroups in F2/Fn+1 to Subgroups in\nFn /Fn+1\n\nThe goal of this section is to prove Theorem 1.3, essentially showing that\nmost GL(d, Fp )-orbits of normal subgroups of F/Fn+1 contained in F2 /Fn+1\nare GL(d, Fp )-orbits of normal subgroups of F/Fn+1 contained in Fn /Fn+1 .\nWe will prove Theorem 1.3 by estimating the number of normal subgroups of\nF/Fn+1 contained in F2 /Fn+1 . Theorem 5.1 offers a refined estimate on the\nnumber of normal subgroups of an arbitrary finite p-group. Our estimate depends on certain parameters which are difficult to work out in general, but have\nbeen calculated for F/Fn+1 in Corollary 3.6. This will give us the tools to prove\nTheorem 1.3.\nLet H be a finite p-group of lower p-length n. Given a normal subgroup U\nof H, note that by the second isomorphism theorem,\n(U \u2229 Hi )/(U \u2229 Hi+1 ) \u223c\n= (U \u2229 Hi )Hi+1 /Hi+1 ,\n21\n\n\fand this quotient is elementary abelian. Let\nS(H, ~u) = {U \u22b3 H : dim((U \u2229 Hi )Hi+1 /Hi+1 ) = ui },\nwhere ~u = (u1 , . . . , un ) and each integer ui satisfies\n0 \u2264 ui \u2264 hi = dim(Hi /Hi+1 ).\nTheorem 5.1. Suppose that for each U \u2208 S(H, ~u),\ndim((U2 \u2229 Hi )Hi+1 /Hi+1 ) \u2265 vi\nand\ndim((U p [U, H] \u2229 Hi )Hi+1 /Hi+1 ) \u2265 wi .\nThen\n\u0014\n\nh1\n|S(H, ~u)| \u2264\nu1\n\n\u0015\n\u0015 Y\nn \u0014\nhi \u2212 wi\np(u1 +***+ui\u22121 \u2212v1 \u2212***\u2212vi\u22121 )(hi \u2212ui ) .\np i=2 ui \u2212 wi p\n\nProof. The proof proceeds by induction on n, the lower p-length of H. If n = 1,\nthen\n\u0002h1 \u0003 H is elementary abelian of dimension h1 , so that ~u = (u1 ) and S(H, ~u) =\nu1 p .\nNow suppose that the result holds in J = H/Hn , a group which has lower\np-length n \u2212 1. Any normal subgroup U of H lying in S(H, ~u) determines the\nsubgroup K = U \u2229 Hn of Hn and the normal subgroup L = U Hn /Hn of J. The\nsubgroup K contains U p [U, H] \u2229 Hn , by hypothesis dim(U p [U, H] \u2229 Hn ) \u2265 wn ,\nand dim(K) = dim(U \u2229 Hn ) = un .\nFor 1 \u2264 i \u2264 n \u2212 1, since Ji = Hi /Hn ,\n(L \u2229 Ji )Ji+1 /Ji+1\n\n=\n\u223c\n=\n\u223c\n=\n\n(U Hn /Hn \u2229 Hi /Hn )(Hi+1 /Hn )/(Hi+1 /Hn )\n(U Hn \u2229 Hi )Hi+1 /Hi+1\n\n(5)\n\n(U \u2229 Hi )Hi+1 /Hi+1 .\n\nThus L \u2208 S(J, ~t ), where ~t = (u1 , . . . , un\u22121 ). Furthermore, if M is the inverse\nimage of L in H, then\nM p [M, H] = (U Hn )p [U Hn , H] = U p [U, H],\nsince Hn+1 = Hnp [Hn , H] = 1. Thus L determines U p [U, H] \u2229 Hn .\nGiven L, the subgroup K is a subspace of Hn of dimension un containing\nM p [M, H]\u2229Hn , which has dimension at least wn . Let w = dim(M p [M, H]\u2229Hn ).\nThen there are\n\u0014\n\u0015\n\u0014\n\u0015\nhn \u2212 w\nhn \u2212 w\n=\nun \u2212 w p\nhn \u2212 u n p\nchoices for K. This Gaussian coefficient is a decreasing function of w, so there\nare at most\n\u0015\n\u0014\nhn \u2212 wn\nun \u2212 wn p\n22\n\n\fchoices for K. Hence the number of possible pairs K and L given by subgroups\nin S(H, ~u) is at most\n\u0015\n\u0014\nhn \u2212 wn\n~\n|S(J, t )| *\n.\nun \u2212 wn p\nThere is a bijection between subgroups U \u2208 S(H, ~u) that give K and L and\ncomplements to Hn /K in M/K, given by U 7\u2192 U/K. In the one direction,\nU/K is a complement to Hn /K since U \u2229 Hn = K and U Hn /K = M/K. In\nthe other direction, a complement U/K to Hn /K satisfies U \u2229 Hn = K and\nU Hn /K = M/K, so U gives K and L.\nRecall that in general, if G is a group with normal subgroup N , then the\nnumber of complements to N in G is either 0 or |Der(G/N, N )|. When N is\ncentral, Der(G/N, N ) = Hom(G/N, N ), and if the number of complements is 0,\nthen Hom(G/N, N ) is trivial (see Lubotzky and Segal [18, Lemma 1.3.1]).\nSince Hn /K is central in M/K (Hn \u2208 Z(H)), the number of complements\nto Hn /K in M/K is\n|Hom(M/Hn , Hn /K)| = |Hom(L, Hn /K)| = |Hom(L/L2 , Hn /K)|.\nThe dimension of Hn /K = Hn /(Hn \u2229 U ) is hn \u2212 un . Also,\ndim(L/L2 )\n= dim(L) \u2212 dim(L2 )\n=\n\nn\u22121\nX\ni=1\n\ndim((L \u2229 Ji )Ji+1 /Ji+1 ) \u2212\n\nn\u22121\nX\ni=1\n\ndim((L2 \u2229 Ji )Ji+1 /Ji+1 ).\n\nNote that L2 = U2 Hn /Hn , and a similar calculation to Equation 5 shows that\n(L2 \u2229 Ji )Ji+1 /Ji+1 \u223c\n= (L2 \u2229 Hi )Hi+1 /Hi+1 ,\nwhich by hypothesis has dimension at least vi . Thus\ndim(L/L2 ) \u2264 u1 + * * * + un\u22121 \u2212 (v1 + * * * + vn\u22121 )\nand\n|Hom(L/L2 , Hn /K)| \u2264 p(hn \u2212un )(u1 +***+un\u22121 \u2212v1 \u2212***\u2212vn\u22121 ) .\nUsing the inductive hypothesis gives\n\u0014\n\u0015\nhn \u2212 u n\nS(H, ~u) \u2264 S(J, ~t ) *\n* p(hn \u2212un )(u1 +***+un\u22121 \u2212v1 \u2212***\u2212vn\u22121 )\nun \u2212 wn p\n\u0014 \u0015 Y\n\u0015\nn \u0014\nh1\nhi \u2212 wi\n\u2264\np(u1 +***+ui\u22121 \u2212v1 \u2212***\u2212vi\u22121 )(Hi \u2212ui ) .\nu1 p i=2 ui \u2212 wi p\nWe can now prove Theorem 1.3, restated here for convenience.\n23\n\n\fTheorem 1.3. Fix a prime p and integers d and n so that either n \u2265 3 and\nd \u2265 6 or n \u2265 10 and d \u2265 5. Let F be the free group on d generators and let dn\nbe the rank of Fn /Fn+1 . Then\n1\u2264\n\n2\n|Ad,n |\n\u2264 1 + C(p)n\u22121 D(p)n\u22122 pdn\u22121 \u2212dn /4+d .\n|Cd,n |\n\nProof. To prove this result, we need to apply the estimates of Lemmas 4.2\nand 4.3 to the upper bound for S(H, ~u) obtained in Theorem 5.1 in the case when\nH = F/Fn+1 . By Corollary 3.6, we may choose vi+1 = ui and wi+1 = (3/2)ui .\nIn particular, wi+1 = 0 if ui = 0. By Equation 1 of Lemma 4.2, we have\n\u0014 \u0015\nn\n\u2264 D(p)pk(n\u2212k) .\nk p\nSubstituting in the bound obtained in Theorem 5.1, we find that, if u1 = 0,\nthen\n|S(H, ~u)| \u2264 D(p)n\u22121 ph ,\nwhere\nh\n\n=\n\u2264\n\nu2 (d2 \u2212 u2 ) + (u3 \u2212 w3 )(d3 \u2212 u3 ) + * * * + (un \u2212 wn )(dn \u2212 un )\n\n+u2 (d3 \u2212 u3 ) + * * * + un\u22121 (dn \u2212 un )\n\u2212(u2 \u2212 d2 )u2 \u2212 (u3 \u2212 d3 )(u3 \u2212 u2 /2) \u2212 * * *\n\u2212(un \u2212 dn )(un \u2212 un\u22121 /2).\n\nHence\n|Ad,n | \u2264 |Cd,n | +\n\nX\nu\n~\n\nD(p)n\u22121 ph = |Cd,n | + D(p)n\u22121\n\nX\n\nph ,\n\n~\nu\n\nwhere the sum is taken over all ~u such that U \u2208 S(H, ~u) if and only if U \u2264\nF2 /Fn+1 and U 6\u2264 Fn /Fn+1 . In terms of ~u, this means that un\u22121 \u2265 1 and\nu1 = 0. Since un \u2265 wn > un\u22121 , we know that un \u2265 2. Then by Lemma 4.3, we\nhave\nX\nph = A1 (0),\nu\n~\n\nand\n\n|Ad,n | \u2264 |Cd,n | + D(p)n\u22121 C(p)n\u22121 py ,\nwhere\ny = d2n /4 \u2212 15/16 \u2212 dn /4 + dn\u22121 .\n\nHence, as |Cd,n | = Gdn (p), using Lemma 4.2 and the fact that 2 \u2212 9p(1\u2212dn)/2 /2 >\n1,\n|Ad,n |/|Cd,n | \u2264 1 + D(p)n\u22121 C(p)n\u22121 py /Gdn (p)\n\n\u2264 1 + D(p)n\u22122 C(p)n\u22121 pdn\u22121 \u2212dn /4 .\n24\n\n\fNow by Theorems 2.7 and 2.8, |Ad,n | and |Cd,n | are the number of GL(d, Fp )orbits on Ad,n and Cd,n respectively. Hence\n0 \u2264 |Ad,n | \u2212 |Cd,n | \u2264 |Ad,n | \u2212 |Cd,n |,\nsince |Ad,n | \u2212 |Cd,n | is the number of GL(d, Fp ) orbits in Ad,n \\ Cd,n . Also\n|Cd,n | \u2264 |Cd,n | * |GL(d, Fp )|, since Cd,n falls into |Cd,n | orbits, each of size at most\n|GL(d, Fp )|. Then\n0\n\n|Ad,n |\n\u22121\n|Cd,n |\n\u0012\n\u0013\n|Cd,n | |Ad,n | \u2212 |Cd,n |\n=\n|Cd,n |\n|Cd,n |\n\u0013\n\u0012\n|Ad,n | \u2212 |Cd,n |\n\u2264 |GL(d, Fp )|\n|Cd,n |\n\u2264\n\n2\n\n\u2264 C(p)n\u22121 D(p)n\u22122 pdn\u22121 \u2212dn /4+d .\n\nTherefore\n1\u2264\n\n6\n\n2\n|Ad,n |\n\u2264 1 + C(p)n\u22121 D(p)n\u22122 pdn\u22121 \u2212dn /4+d .\n|Cd,n |\n\nMost Orbits on Subgroups of Fn /Fn+1 are Regular\n\nIn this section we shall prove Theorem 1.4. This depends on estimating |Cd,n |,\nthe number of GL(d, Fp )-orbits on subspaces of Fn /Fn+1 , via the CauchyFrobenius Lemma. To do this, we obtain in Theorem 6.2 an upper bound\nfor the number of subspaces of Fn /Fn+1 fixed by an element of GL(d, Fp ), and\nrefine this in Theorem 6.3 to obtain a stronger bound in the case n = 2.\nSuppose M is an Fp GL(d, Fp )-module. Let g \u2208 GL(d, Fp ). We want to count\nthe number of subspaces of M (viewed as an Fp -vector space) fixed by g, which is\nthe number of submodules of M as a Fp hgi-module. We note that when M is the\nnatural Fp GL(d, Fp )-module, Eick and O'Brien [5] give an explicit formula for\nthis number. The following preliminaries are based on Macdonald [19, Chapter\nIV, Section 2].\nLet \u03a6 be the set of all polynomials in Fp [t] which are irreducible over Fp and\nlet P be the set of all partitions of non-negative\nintegers. Let U be the set of\nP\nall functions \u03bc : \u03a6 \u2192 P such that m = f \u2208\u03a6 deg(f )|\u03bc(f )|, where |\u03bc(f )| is the\nsum of the parts of the partition \u03bc(f ). Then there is a one-to-one correspondence between Fp hgi-modules M of dimension m and functions \u03bc \u2208 U . This\ncorrespondence is given by\nM\n\n\u223c\n=\n\nM M Fp [t]\n,\n(f )\u03bci (f )\nf \u2208\u03a6 i\n25\n\n\fwhere \u03bci (f ) is the i-th part of \u03bc(f ), (f ) is the ideal of Fp [t] generated by f , and\ng acts upon Fp [t]/(f )s as multiplication by t.\nLet\nM Fp [t]\nMf =\n.\n(f )\u03bci (f )\ni\n\nWe call \u03bc(f ) the type of Mf . Any submodule N of M can be written N =\n\u2295f \u2208\u03a6 Nf with Nf \u2286 Mf for each f \u2208 \u03a6. That is, every submodule of M is the\ndirect sum of submodules of the summands Mf . By Macdonald [19, Chapter\nII, 3.1] the type \u03bb of any Fp hgi-submodule or quotient module of Mf satisfies\n\u03bb \u2286 \u03bc(f ).\nFor each f \u2208 \u03a6, let Fp [t]f denote the localization of Fp [t] at the prime ideal\n(f ). Then Fp [t]f is a discrete valuation ring with residue field of order q = pdeg(f )\nand Mf is a finite Fp [t]f -module of type \u03bc(f ).\nBoth Theorems 6.2 and 6.3 depend on Theorem 6.1, where we calculate the\nnumber of submodules of fixed type in a module of fixed type over a discrete\nvaluation ring. This generalizes the formula for the number of subgroups of a\nfinite abelian p-group (see Birkhoff [2]).\nTheorem 6.1. Let a be a discrete valuation ring with maximal ideal p and\nlet k = a/p be the residue field of order q. Let \u03b1 = (\u03b11 , \u03b12 , . . . , \u03b1s ) and \u03b2 =\n(\u03b21 , \u03b22 , . . . , \u03b2r ) be partitions with \u03b2 \u2286 \u03b1 and let M be a finite a-module of type\n\u03b1\u2032 . Then the number of submodules of M of type \u03b2 \u2032 is\n\u2032\n\n\u2032\n\nS(\u03b1 , \u03b2 , q) =\n\n\u0015\nr \u0014\nY\n\u03b1i \u2212 \u03b2i+1\n\ni=1\n\n\u03b2i \u2212 \u03b2i+1\n\nq \u03b2i+1 (\u03b1i \u2212\u03b2i ) .\nq\n\nProof. The proof is by induction on \u03b21 . If \u03b21 = 0, then S(\u03b1\u2032 , \u03b2 \u2032 , q) = 1 and the\nresult holds. Suppose \u03b21 > 0, and let the smallest part of \u03b2 \u2032 be t, so that either\n\u03b21 = * * * = \u03b2t > \u03b2t+1 and t < s, or \u03b21 = * * * = \u03b2s and t = s. Write\n\u03b2 = (\u03b21 \u2212 1, \u03b22 \u2212 1, . . . , \u03b2t \u2212 1, \u03b2t+1 , . . . ).\n\u2032\n\nLet N be any submodule of M of type \u03b2 , and le tx be any element of M\nwith pt x = 0, pt\u22121 x 6= 0, and px \u2229 N = 0. Then hN, xi has type \u03b2 \u2032 . There\n\u2032\nare S(\u03b1\u2032 , \u03b2 , q) choices for N , and for each N it follows from [19, Chapter II,\nEquation 1.8] that the number of choices for x is just\nq \u03b11 +***+\u03b1t (1 \u2212 q \u03b2t \u2212\u03b1t \u22121 ).\n\n(6)\n\nOn the other hand, fix a submodule L of M of type \u03b2 \u2032 ; we can count the number\n\u2032\nof choices of N and x so that L = hN, xi. Here N is a submodule of L of type \u03b2\nwhose quotient has type (t), and by [19, Chapter II, Equation 4.13], the number\nof choices for N is\n1 \u2212 q \u03b2t+1 \u2212\u03b2t P i (\u03b22i )\u2212P i (\u03b22i )\nq\n1 \u2212 q \u22121\n26\n\n=\n\n1 \u2212 q \u03b2t+1 \u2212\u03b2t t(\u03b2t \u22121)\nq\n.\n1 \u2212 q \u22121\n\n\fGiven N , it follows from [19, Chapter II, Equation 1.8] that there are\nq \u03b21 +***+\u03b2t (1 \u2212 q \u22121 )\nchoices for x. Thus any submodule L of M of type \u03b2 \u2032 arises as hN, xi in\nq \u03b21 +***+\u03b2t +t(\u03b2t \u22121) (1 \u2212 q \u03b2t+1 \u2212\u03b2t )\nways. The total number of submodules L of M of type \u03b2 \u2032 is then\n\u2032\n\nS(\u03b1\u2032 , \u03b2 \u2032 , q) =\n\nS(\u03b1\u2032 , \u03b2 , q)q \u03b11 +***+\u03b1t (1 \u2212 q \u03b2t \u2212\u03b1t \u22121 )\nq \u03b21 +***+\u03b2t +t(\u03b2t \u22121) (1 \u2212 q \u03b2t+1 \u2212\u03b2t )\n\u2032\n\n=\n\nS(\u03b1\u2032 , \u03b2 , q)q \u03b11 +***+\u03b1t (1 \u2212 q \u03b2t \u2212\u03b1t \u22121 )\n,\nq 2t\u03b2t \u2212t (1 \u2212 q \u03b2t+1 \u2212\u03b2t )\n\n(7)\n\nwhere the second inequality uses \u03b21 = * * * = \u03b2t . By induction, we know that\n\u0015\nr \u0014\nY\n\u03b1i \u2212 \u03b2 i+1\n\u2032\nq \u03b2 i+1 (\u03b1i \u2212\u03b2 i )\nS(\u03b1\u2032 , \u03b2 , q) =\n\u03b2\n\u2212\n\u03b2\ni\ni+1 q\ni=1\n\u0014\nt\u22121\nY \u03b1i \u2212 \u03b2i+1 + 1\u0015\nq (\u03b2i+1 \u22121)(\u03b1i \u2212\u03b2i +1)\n=\n\u03b2\n\u2212\n\u03b2\ni\ni+1\nq\ni=1\n\u0015\n\u0014\n\u03b1t \u2212 \u03b2t+1\nq \u03b2t+1 (\u03b1t \u2212\u03b2t +1)\n*\n\u03b2t \u2212 \u03b2t+1 \u2212 1 q\n\u0015\n\u0014\nr\nY\n\u03b1i \u2212 \u03b2i+1\nq \u03b2i+1 (\u03b1i \u2212\u03b2i )\n*\n\u03b2\n\u2212\n\u03b2\ni\ni+1\nq\ni=t+1\n\u0015\nr \u0014\nY\n\u03b1i \u2212 \u03b2i+1\nq \u03b2i+1 (\u03b1i \u2212\u03b2i )\n=\n\u03b2\n\u2212\n\u03b2\ni\ni+1\nq\ni=1\n\n=\n\nt\u22121\nY\n\nq \u03b1i \u2212\u03b2i+1 +1 \u2212 1 \u03b2i+1 +\u03b2i \u2212\u03b1i \u22121 q \u03b2t \u2212\u03b2t+1 \u2212 1 \u03b2t+1\nq\n* \u03b1t \u2212\u03b2t +1\nq\nq \u03b1i \u2212\u03b2i +1 \u2212 1\nq\n\u22121\ni=1\n\u0015\nr \u0014\nY\n\u03b1i \u2212 \u03b2i+1\nq \u03b2i+1 (\u03b1i \u2212\u03b2i )\n\u03b2\n\u2212\n\u03b2\ni\ni+1\nq\ni=1\n*\n\n*q 2(t\u22121)\u03b2t \u2212\u03b11 \u2212***\u2212\u03b1t\u22121 \u2212(t\u22121) *\n=\n\n\u0015\nr \u0014\nY\n\u03b1i \u2212 \u03b2i+1\n\ni=1\n\n\u03b2i \u2212 \u03b2i+1\n\nq\n\nq \u03b2i+1 (\u03b1i \u2212\u03b2i ) *\n\nq \u03b2t \u2212\u03b2t+1 \u2212 1 \u03b2t+1\nq\nq \u03b1t \u2212\u03b2t +1 \u2212 1\n\nq 2t\u03b2t\n\nq \u03b11 +***+\u03b1t +t\n\n*\n\n1 \u2212 q \u03b2t+1 \u2212\u03b2t\n.\n1 \u2212 q \u03b2t \u2212\u03b1t \u22121\n\nSubstituting this expression into Equation 7 gives the result.\nUsing Theorem 6.1 and the techniques of Section 4, we can give an upper\nbound for the total number of submodules of a finite Fp hgi-module M . Note\nthat every subspace of M is a Fp hgi-module if and only if g acts as a scalar on\nM , that is, as multiplication by an element of Fp .\n27\n\n\fTheorem 6.2. Fix d \u2265 2 and g \u2208 GL(d, Fp ). Suppose that M is an Fp hgimodule. Let m = dimFp (M ) and let SM be the number of submodules of M .\nThen either g acts as a scalar on M and SM = Gm (p), or g does not act as a\nscalar and\nlogp SM \u2264 (m2 \u2212 2m + 2)/4 + 2\u03b5,\nwhere \u03b5 = logp (C(p)D(p)).\nProof. Write M = \u2295ki=1 Mi , where for each i, Mi = Mfi for some fi \u2208 \u03a6 and\ndimFp Mi = mi .\nCase 1: k \u2265 2.\nEach submodule\nof M is a direct sum of submodules of the summands Mi ,\nQk\nso SM = i=1 SMi \u2264 Gm1 (p)Gm\u2212m1 (p). Then by Lemma 4.2,\n2\n\nSM \u2264 C(p)2 D(p)2 pm1 /4+(m\u2212m1 )\n\n2\n\n/4\n\n\u2264 C(p)2 D(p)2 p(m\n\n2\n\n\u22122m+2)/4\n\n,\n\nsince 0 < m1 < m.\nCase 2: k = 1.\nIn this case, M = Mf for some f \u2208 \u03a6. Let u = deg(f ) and q = pu , and let\nM have type \u03b1\u2032 as a Fp [t]f -module, where \u03b1 = (\u03b11 , . . . , \u03b1s ).\nSubcase 2.1: \u03b1 has at least two parts.\nIf \u03b2 = (\u03b21 , . . . , \u03b2r ) and \u03b2 \u2286 \u03b1, then by Theorem 6.1 and Lemma 4.2 Equation 1, the number of submodules of M of type \u03b2 \u2032 is\nr\nY\n\nS(\u03b1\u2032 , \u03b2 \u2032 , q) \u2264\n\nD(q)q (\u03b2i \u2212\u03b2i+1 )(\u03b1i \u2212\u03b2i )+\u03b2i+1 (\u03b1i \u2212\u03b2i )\n\ni=1\n\nD(q)r\n\n=\n\nr\nY\n\nq \u03b2i (\u03b1i \u2212\u03b2i ) .\n\ni=1\n\nThus\nSM\n\n=\n\nX\n\nS(\u03b1\u2032 , \u03b2 \u2032 , q)\n\n\u03b2 \u2032 \u2286\u03b1\u2032\n\n\u2264 D(q)s\n\u2264 D(q)s\n\nr\nX Y\n\n\u03b2 \u2032 \u2286\u03b1\u2032\n\nq \u03b2i (\u03b1i \u2212\u03b2i )\n\ni=1\n\n\u03b1i\ns X\nY\n\nq bi (\u03b1i \u2212bi )\n\ni=1 bi =0\ns\nY\n\u03b12i /4\ns\ns\n\n\u2264 D(q) C(q)\n\n28\n\nq\n\ni=1\n\n,\n\n\fwhere the last inequality follows from Lemma 4.1. Now D(q) \u2264 D(p) and\nC(q) \u2264 C(p) so, remembering that u(\u03b11 + * * * + \u03b1s ) = m and using Lemma 4.4,\nlogp SM\n\n\u2264\n\nu(\u03b121 + * * * + \u03b12s )/4 + s\u03b5\n\n\u2264\n\u2264\n\n((m \u2212 1)2 + 1 + 8\u03b5)/4\n(m2 \u2212 2m + 2)/4 + 2\u03b5,\n\n\u2264\n\n2\n\n(8)\n2\n\n(4s\u03b5 + (u\u03b11 ) + * * * + (u\u03b1s ) + 4s\u03b5)/4\n\nif m \u2265 4\u03b5 + 1. For m < 4\u03b5 + 1,\nlogp SM\n\n\u2264 m2 /4\n\n\u2264 (m2 \u2212 2m + 2)/4 + (m \u2212 1)/2\n\u2264 (m2 \u2212 2m + 2)/4 + 2\u03b5.\nSubcase 2.2: \u03b1 has one part.\nIn this case, \u03b11 = m/u. If u \u2265 2, then by Lemma 4.2 Equation 1,\nX \u0014\u03b11 \u0015\nSM =\n\u03b21 q\n0\u2264\u03b21 \u2264\u03b11\n\n\u2264 C(q)D(q)q m\n\n2\n\n/4u2\n\n\u2264 C(p)2 D(p)2 pm\n\n2\n\n\u2264 C(p)2 D(p)2 p(m\n\n/4u\n\n2\n\n\u22122m+2)/4\n\n,\n\nsince u \u2265 2. On the other hand, if u = 1, then f = t \u2212 c for some c \u2208 Fp and\nM\u223c\n= \u2295m {Fp [t]/(f )} so that g acts as the scalar c on M and SM = Gm (p).\nThe next theorem strengthens this result when the module structure is\nknown more precisely and will be needed to deal with groups of lower p-length\n2.\nTheorem 6.3. Fix d \u2265 2 and g \u2208 GL(d, Fp ) with g 6= 1. Suppose that V is\nan Fp hgi-module on which g acts non-trivially and that M is an Fp hgi-module\nextension of V \u2227 V by V . Let v = dimFp (V ), let m = dimFp (M ) = v(v + 1)/2,\nand let SM be the number of submodules of M . Then\nlogp SM \u2264 (m \u2212 4)2 /4 + C,\nwhere \u03b5 = logp (C(p)D(p)) and\n\u001a\n\u03b5 + 2m \u2212 4\nC=\n5\u03b5 + 4\n\n:\n:\n\nm \u2264 45\notherwise.\n\nProof. First, if v \u2264 9, then m \u2264 45. In this case,\nSM\n\n\u2264\n\n\u2264\n\n=\n\nGm (p)\n\nC(p)D(p)pm\n\n2\n\n/4\n\nC(p)D(p)p(m\u22124)\n29\n\n2\n\n/4+2m\u22124\n\n,\n\n\fproving the result. So we may assume that v \u2265 10.\nWrite M = \u2295ki=1 Mi , where for each i, Mi = Mfi for some fi \u2208 \u03a6 and\ndimFp Mi = mi ; we may assume that m1 \u2265 m2 \u2265 * * * \u2265 mk . Note that m1 +\n* * * + mk = m. Then V = \u2295m\ni=1 Mi \u03c0 where \u03c0 is the projection from M onto V .\nFix 0 < t < k and set W = M1 \u2295 * * * \u2295 Mt . Also let w = dim W =\nm1 + * * * + mt . Then SM \u2264 Gw (p)GM\u2212w (p) since any submodule of M is a direct\nsum of submodules of the summands Mi . By Lemma 4.2,\nSM \u2264 C(p)2 D(p)2 pw\n\n2\n\n/4+(M\u2212w)2 /4\n\n.\n\nWhen 4 \u2264 w \u2264 M \u2212 4, it follows that\nSM\nlogp SM\n\n\u2264\n\u2264\n\n2\n\nC(p)2 D(p)2 p4+(M\u22124) /4 and\n(M \u2212 4)2 /4 + 2\u03b5 + 4,\n\nproving the result. If we cannot choose t so that 4 \u2264 w \u2264 m \u2212 4, then since\nm > 9 implies that m1 6\u2264 3, it must be that m1 \u2265 m \u2212 3 and k \u2264 4. Write\nY = M2 \u2295 * * * \u2295 Mk ; then y = dim Y \u2264 3. (It is possible that Y is the zero\nmodule and that y = 0.) At this point we need to prove a technical claim which\nwe will use twice.\nClaim: Suppose that V is the direct sum of Fp hgi-modules A and B of\ndimensions a \u2265 4 and v \u2212 a over Fp , and suppose that A \u2282 M1 \u03c0. If g acts as a\nscalar c on A, then c = 1 and A \u2297 B is the direct sum of a copies of B.\n\u223c (A \u2227 A) \u2295 (B \u2227 B) \u2295 (A \u2297 B). If g\nProof of claim: If V = A \u2295 B, then V \u2227 V =\nacts as a scalar c on A, then A \u223c\n= \u2295{Fp [t]/(t\u2212c)}a and M1 = Mf1 with f1 = t\u2212c.\nIn this case g acts as the scalar c2 on A \u2227 A, so A \u2227 A \u223c\n= {Fp [t]/(t \u2212 c2 )}a(a\u22121)/2 .\nIf c 6= 1, then A \u2227 A 6\u2286 M1 and hence A \u2227 A \u2286 Y . But then a(a \u2212 1)/2 =\ndim(A \u2227 A) \u2264 dim Y \u2264 3, which is impossible. Therefore c = 1. Since g acts on\nV non-trivially, the action on B is non-trivial and A \u2297 B is the direct sum of a\ncopies of B.\nNow take A = M1 \u03c0 and B = Y \u03c0 so that V = A \u2295 B. Suppose that g acts\non A as a scalar c. Since v \u2265 7 and dim B \u2264 dim Y \u2264 3, we see that a \u2265 4,\nand by the claim, c = 1 and A \u2297 B is the direct sum of a copies of B. If\nB is the zero module, this contradicts the fact that g acts non-trivially on V .\nOtherwise, v \u2212 a > 0. Since B is the image of Y , it follows that A \u2297 B \u2286 Y ,\nand a(v \u2212 a) \u2264 dim Y \u2264 3, which is false. Therefore g does not act on M1 \u03c0 as\na scalar, and hence does not act on M1 as a scalar.\nWe may assume that M1 = Mf where f has degree u over Fp and M1 and\nM1 \u03c0 have types \u03b1\u2032 and \u03b2 \u2032 respectively, where \u03b2 \u2286 \u03b1. Write \u03b1 = (\u03b11 , . . . , \u03b1s )\nand \u03b2 = (\u03b21 , . . . , \u03b2r ).\nCase 1: u > 1.\n\n30\n\n\fWriting SM1 for the number of submodules of M1 , we have\nSM1\n\n\u2264\n\nGm1 /u (q)\n\n2\n\n2\n\n\u2264\n\nC(q)D(q)q m1 /4u\n\n\u2264\n\nC(p)D(p)pm1 /8 .\n\n\u2264\n\n2\n\nC(p)D(p)pm1 /4u\n2\n\nThen\nSM\n\n\u2264\n\nSM1 Gy (p)\n\n2\n\n\u2264\n\nC(p)2 D(p)2 pm1 /8+y\n\n\u2264\n\nC(p)2 D(p)2 p(m\u22124)\n\n\u2264\n\nC(p)2 D(p)2 pm\n\n2\n\n2\n\n/4\n\n/8+9/4\n2\n\n/4+9/4\n\n,\n\nwhere the last line uses the fact that m \u2265 14. Thus logp SM \u2264 C + (m \u2212 4)2 /4.\nCase 2: u = 1.\nIn this case, f = t \u2212 c for some c \u2208 Fp . Since g does not act as a scalar on\nM1 or M1 \u03c0, \u03b12 \u2265 \u03b22 > 0.\nBy Equation 8,\nlogp SM \u2264 (\u03b121 + * * * + \u03b12s )/4 + s\u03b5,\nso\nlogp SM \u2264 logp SM1 + logp Gy (p) \u2264 (\u03b121 + * * * + \u03b12s + y 2 )/4 + (s + 1)\u03b5.\nSubcase 2.1: \u03b11 \u2264 m \u2212 4\nIf s = 2, then\nlogp SM\n\n\u2264 (\u03b121 + \u03b122 + y 2 )/4 + 3\u03b5\n\n\u2264 ((m \u2212 4)2 + 42 + 02 )/4 + 3\u03b5\n\u2264 (m \u2212 4)2 /4 + C.\nIf s = 3, then\nlogp SM\n\n\u2264 (\u03b121 + \u03b122 + \u03b123 + y 2 )/4 + 4\u03b5\n\n\u2264 ((m \u2212 4)2 + 32 + 12 + 02 )/4 + 4\u03b5\n\u2264 (m \u2212 4)2 /4 + C.\n\nFinally, if 4 \u2264 s \u2264 m, then by Lemma 4.4, we get\nlogp SM\n\n\u2264\n\n((m \u2212 s)2 + s)/4 + (s + 1)\u03b5.\n31\n\n\fThe right-hand side is maximized at s = 4 or s = m. Since m > 45 and\n\u03b5 \u2264 6, it turns out that it is maximized at s = 4, where we get a bound of\n(m \u2212 4)2 /4 + 5\u03b5 + 1.\nSubcase 2.2: \u03b11 \u2265 m \u2212 3.\nSo we may assume that \u03b11 \u2265 m \u2212 3. Then \u03b12 + * * * + \u03b1s + y \u2264 3, and\nso \u03b22 + * * * + \u03b2r + dim(\u03c0Y ) \u2264 3. Since \u03b21 + * * * + \u03b2r + dim(\u03c0Y ) = v \u2265 10,\nit follows that \u03b21 \u2265 7 and \u03b21 \u2212 \u03b22 \u2265 4. Note that \u03b21 \u2212 \u03b22 is the number of\nsummands of M1 \u03c0 that are isomorphic to Fp [t]/(f \u2212 c). So write M1 \u03c0 = A \u2295 C,\nwhere a = dim A = \u03b21 \u2212 \u03b22 and g acts as the scalar c on A and not on C. Set\nB = C \u2295 Y \u03c0. Then V = A \u2295 B and by the claim, c = 1 and A \u2297 B is a direct\nsum of a copies of B. Then A \u2297 B is contained in Y plus the components of\nM1 that g does not act as a scalar on, so that a\u03b22 \u2264 dim (A \u2297 B) \u2264 \u03b12 + y \u2264 3,\nwhich is impossible.\nWe can now prove Theorem 1.4, restated here for convenience.\nTheorem 1.4. Fix a prime p and integers d and n so that either n = 2 and\nd \u2265 10 or n \u2265 3 and d \u2265 3. Let F be the free group on d generators and let dn\nbe the rank of Fn /Fn+1 . Let\n(\nC(p)5 D(p)4 p17/4 : n = 2 and d \u2265 10\nK=\nC(p)2 D(p)p3/4 : n \u2265 3.\nLet\nx=\n\n(\n\n1\u2264\n\n|Cd,n | * |GL(d, Fp )|\n\u2264 1 + Kpx .\n|Cd,n |\n\n\u2212d\nd \u2212 dn /2\n2\n\n:\n:\n\nn=2\nn \u2265 3.\n\nThen\n(a)\n\n(b)\n1\u2264\n\n|Cd,n |\n1 + Kpx\n.\n\u2264\n|Dd,n |\n1 \u2212 Kpx\n\nProof. Recall that Cd,n is the set of GL(d, Fp )-orbits in Cd,n , Dd,n is the set\nof regular orbits in Cd,n (that is, the orbits in which every point has trivial\nstabilizer), and |Cd,n | = Gdn (p). If g \u2208 GL(d, Fp ), then |(Cd,n )g |, the number\nof elements of Cd,n fixed by g, is just the number of submodules of Fn /Fn+1\nviewed as a Fp hgi-module, which we estimated in Theorems 6.2 and 6.3.\nWe explain first why only the identity element of GL(d, Fp ) can act as a\nscalar on Fn /Fn+1 . By Theorem 3.2, Fn /Fn+1 has a Fp GL(d, Fp )-submodule\nM which is isomorphic to an extension of V \u2227 V by V , where V is the natural\nFp GL(d, Fp )-module. If g \u2208 GL(d, Fp ) acts on Fn /Fn+1 as a scalar c \u2208 Fp , then\n32\n\n\fit acts on V as the scalar c, and hence on V \u2227V as the scalar c2 . Thus c = c2 and\nc = 1, so that g is the identity on V , that is, the identity element in GL(d, Fp ).\nSuppose first that n > 2. We know from Theorem 6.2 that if g 6= 1,\n2\n\n|(Cd,n )g | \u2264 C(p)2 D(p)2 p(dn \u22122dn +2)/4 .\n\nBy the Cauchy-Frobenius Lemma,\nX\n|(Cd,n )g |\n|GL(d, Fp )| * |Cd,n | =\ng\u2208GL(d,Fp )\n\n=\n\u2264\n\n|Cd,n | +\n\nX\ng6=1\n\n|(Cd,n )g |\n2\n\n|Cd,n | + (|GL(d, Fp )| \u2212 1)C(p)2 D(p)2 p(dn \u22122dn +2)/4 .\n\nBy Lemma 4.2 Equation 2 and the fact that 2 \u2212 9p(1\u2212dn)/2 /2 > 1,\n2\n\n|Cd,n | \u2265 D(p)pdn /4\u22121/4 .\n\n2\n\nSince |GL(d, Fp )| \u2264 pd , it follows that\n1 \u2264\n\u2264\n\n=\n\n|GL(d, Fp )| * |Cd,n |\n|Cd,n |\n\n2\n\n1 + C(p)2 D(p) p(dn \u22122dn +2)/4+d\n1 + Kpd\n\n2\n\n\u2212dn /2\n\n2\n\n\u2212d2n /4+1/4\n\n.\n\nIf n = 2, then F2 /F3 is an extension of V \u2227 V by V , and using the estimates of\nLemma 6.3 and the argument above we obtain\n1\n\n\u2264\n\n|GL(d, Fp )| * |Cd,n |\n|Cd,n |\n\n\u2264 1 + Kp\u2212d .\n\nThis proves part (a).\nP\n|GL(d, Fp )|/|GL(d, Fp )(w) |,\nTo prove part (b), we observe that |Cd,n | =\nwhere the sum is over all GL(d, Fp )-orbits in Cd,n and |GL(d, Fp )(w) | is the\norder of the stabilizer in GL(d, Fp ) of a typical element w of the orbit under\nconsideration. Now |Dd,n | is just the number of orbits for which |GL(d, Fp )(w) | =\n1, so\n|Cd,n | \u2264 |GL(d, Fp )| * |Dd,n | + |GL(d, Fp )|(|Cd,n | \u2212 |Dd,n |)/2.\nThat is,\n(2/|GL(d, Fp )|)|Cd,n | \u2212 |Cd,n | \u2264 |Dd,n |,\nso that\n\n|Cd,n |\n|Dd,n |\n\n\u2264\n\u2264\n\u2264\n\n|Cd,n |\n2|Cd,n |/|GL(d, Fp )| \u2212 |Cd,n |\n|Cd,n | * |GL(d, Fp )|/|Cd,n |\n2 \u2212 |Cd,n | * |GL(d, Fp )|/|Cd,n |\n1 + Kpx\n.\n1 \u2212 Kpx\n33\n\n\f7\n\nSummary\n\nIn this section we use Theorems 1.2, 1.3, and 1.4 to prove Theorem 1.1 along\nwith two corollaries.\nTheorem 1.1. Fix a prime p and positive integers d and n. Let rd,n be the\nproportion of p-groups minimally generated by d elements and with lower plength at most n whose automorphism group is a p-group. If n \u2265 2, then\nlim rd,n = 1.\n\nd\u2192\u221e\n\nIf d \u2265 5, then\n\nlim rd,n = 1.\n\nn\u2192\u221e\n\nIf\nn = 2 and d \u2265 10, or n \u2265 3 and d \u2265 6, or n \u2265 10 and d \u2265 5,\n\n(9)\n\nthen\nlim rd,n = 1.\n\np\u2192\u221e\n\nProof. The set of p-groups minimally generated by d elements and with lower\np-length at most n is Ad,n . When n = 2, Ad,n = Cd,n . The expression\nC(p)n\u22121 D(p)n\u22122 pdn\u22121 \u2212dn /4+1/4+d\n\n2\n\ngoes to 0 as d \u2192 \u221e if n \u2265 3 or as n \u2192 \u221e if d \u2265 5. If d and n satisfy one of the\nconditions of Equation 9, then the exponent of p is negative. By Theorem 1.3,\nit follows that\n|Ad,n |\n|Cd,n |\n|Ad,n |\nlim\nn\u2192\u221e |Cd,n |\n|Ad,n |\nlim\np\u2192\u221e |Cd,n |\nlim\n\nd\u2192\u221e\n\n=\n\n1 if n \u2265 2,\n\n=\n\n1 if d \u2265 5, and\n\n=\n\n1 if one of the conditions in Equation 9 holds.\n\nThe set Dd,n \u2286 Cd,n is contained in the subset of Ad,n of p-groups whose automorphism group is a p-group. By Theorem 1.4(b),\n|Cd,n |\n|Dd,n |\n|Cd,n |\nlim\nn\u2192\u221e |Dd,n |\n|Cd,n |\nlim\np\u2192\u221e |Dd,n |\nlim\n\nd\u2192\u221e\n\n=\n\n1 if n \u2265 2,\n\n=\n\n1 if d \u2265 5, and\n\n=\n\n1 if one of the conditions in Equation 9 holds.\n34\n\n\fIt follows that |Ad,n |/|Dd,n | goes to 1 under the specified limits, and the theorem\nfollows.\nCorollary 7.1. Fix a prime p and n \u2265 2. Let sd,n be the proportion of pgroups generated by at most d elements and with lower p-length at most n whose\nautomorphism group is a p-group. Then\nlim sd,n = 1.\n\nd\u2192\u221e\n\nProof. This follows directly from Theorem 1.1 and the trivial observation that\nthe number of p-groups generated by at most d elements and with lower p-length\nat most n is finite, while the number of p-groups with lower p-length at most n\nis infinite.\nCorollary 7.2. Fix a prime p and n \u2265 2. Let td,n be the proportion of p-groups\nminimally generated by d elements and with lower p-length n whose automorphism group is a p-group. Then\nlim td,n = 1.\n\nd\u2192\u221e\n\nProof. As Dd,n \u2286 Bd,n \u222a {Fn /Fn+1 } \u2286 Ad,n , it follows from Theorem 1.1 that\nlim\n\nd\u2192\u221e\n\n|Bd,n | + 1\n= 1.\n|Dd,n |\n\nSince |Ad,n | \u2192 \u221e as d \u2192 \u221e, Theorem 1.1 implies that |Dd,n | \u2192 \u221e as d \u2192 \u221e,\nproving that\n|Bd,n |\nlim\n= 1.\nd\u2192\u221e |Dd,n |\nUsing Theorem 1.1, Henn and Priddy [12] prove the following theorem.\nTheorem 7.3 (Henn and Priddy [12]). Fix a prime p and integers d, n \u2265 2.\nLet ud,n be the proportion of p-groups P generated by at most d elements and\nwith lower p-length at most n that satisfy the following property: if H is a finite\ngroup with Sylow p-subgroup P , then H has a normal p-complement. Then\nlimd\u2192\u221e ud,n = 1.\nAs mentioned in the introduction, the following question remains unanswered.\nQuestion. Fix a prime p. Let vn be the proportion of p-groups with order at\nmost pn whose automorphism group is a p-group. Is it true that limn\u2192\u221e vn = 1?\n\n35\n\n\f8\n\nAcknowledgements\n\nWe would like to thank Persi Diaconis for introducing us to each other and\nfor his continued support of this project. We would also like to thank Charles\nLeedham-Green for several illuminating conversations and for his help with the\nexamples in the introduction. Finally, we would like to thank Eamonn O'Brien\nfor his help with references and computational data. For part of this research,\nthe first author was supported by a Department of Defense National Defense\nScience and Engineering Graduate Fellowship.\n\nReferences\n[1] H. U. Besche, B. Eick, and E. A. O'Brien, A millennium project: constructing small groups, Internat. J. Algebra Comput. 12 (2002), no. 5, 623\u2013644.\n[2] G. Birkhoff, Subgroups of abelian groups, Proc. London Math. Soc. (2) 38\n(1934\u201335), 387\u2013401.\n[3] R. M. Bryant and L. G. Kov\u00e1cs, Lie representations and groups of prime\npower order, J. London Math. Soc. (2) 17 (1978), 415\u2013421.\n[4] B. Eick, C. R. Leedham-Green, and E. A. O'Brien, Constructing automorphism groups of p-groups, Comm. Algebra 30 (2002), no. 5, 2271\u20132295.\n[5] B. Eick and E. A. O'Brien, Enumerating p-groups, J. Austral. Math. Soc.\nSer. A 67 (1999), no. 2, 191\u2013205.\n[6] The GAP Group, GAP \u2013 Groups, Algorithms, and Programming, Version 4.4, 2005, packages AutPGrp and SmallGroups\n(http://www.gap-system.org).\n[7] A. M. Garsia, Combinatorics of the free Lie algebra and the symmetric\ngroup, Analysis, et cetera, Academic Press, Boston, MA, 1990, pp. 309\u2013\n382.\n[8] J. A. Gibbs, Automorphisms of certain unipotent groups, J. Algebra 14\n(1970), 203\u2013228.\n[9] J. Goldman and G.-C. Rota, On the foundations of combinatorial theory.\nIV. Finite vector spaces and Eulerian generating functions, Studies in Appl.\nMath. 49 (1970), 239\u2013258.\n[10] P. Hall, A contribution to the theory of groups of prime-power order, Proc.\nLondon Math. Soc. 36 (1934), 29\u201395.\n[11] G. T. Helleloid, A survey on automorphism groups of finite p-groups, available at arXiv:math.GR/0610294.\n\n36\n\n\f[12] H.-W. Henn and S. Priddy, p-nilpotence, classifying space indecomposability, and other properties of almost all finite groups, Comment. Math. Helv.\n69 (1994), no. 3, 335\u2013350.\n[13] G. Higman, Enumerating p-groups. I. Inequalities, Proc. London Math.\nSoc. (3) 10 (1960), 24\u201330.\n[14] M. V. Horo\u0161evski\u0131\u0306, The automorphism groups of finite p-groups, Algebra\ni Logika 10 (1971), 81\u201386, English translation in Algebra and Logic 10\n(1971), 54\u201357.\n[15]\n\n, The automorphism group of wreath products of finite groups,\nSibirsk. Mat. \u017d. 14 (1973), 651\u2013659, 695, English translation in Siberian\nMath. J. 14 (1973), 453\u2013458.\n\n[16] B. Huppert and N. Blackburn, Finite groups. II, Grundlehren der Mathematischen Wissenschaften [Fundamental Principles of Mathematical Sciences], vol. 242, Springer-Verlag, Berlin, 1982.\n[17] M. Lazard, Sur les groupes nilpotents et les anneaux de Lie, Ann. Sci. Ecole\nNorm. Sup. (3) 71 (1954), 101\u2013190.\n[18] A. Lubotzky and D. Segal, Subgroup growth, Progress in Mathematics, vol.\n212, Birkh\u00e4user Verlag, Basel, 2003.\n[19] I. G. Macdonald, Symmetric functions and Hall polynomials, second ed.,\nOxford Mathematical Monographs, The Clarendon Press Oxford University\nPress, New York, 1995.\n[20] A. Mann, Some questions about p-groups, J. Austral. Math. Soc. Ser. A 67\n(1999), no. 3, 356\u2013379.\n[21] U. Martin, Almost all p-groups have automorphism group a p-group, Bull.\nAmer. Math. Soc. (N.S.) 15 (1986), no. 1, 78\u201382.\n[22] H. Neumann, Varieties of groups, Springer-Verlag New York, Inc., New\nYork, 1967.\n[23] M. F. Newman, Determination of groups of prime-power order, Group theory (Proc. Miniconf., Australian Nat. Univ., Canberra, 1975), Springer,\nBerlin, 1977, pp. 73\u201384. Lecture Notes in Math., Vol. 573.\n[24] M. F. Newman and E. A. O'Brien, A CAYLEY library for the groups of\norder dividing 128, Group Theory (Singapore, 1987), de Gruyter, Berlin,\n1989, pp. 437\u2013442.\n[25] E. A. O'Brien, The p-group generation algorithm, J. Symbolic Comput. 9\n(1990), no. 5-6, 677\u2013698, Computational group theory, Part 1.\n\n37\n\n\f[26]\n\n, Computing automorphism groups of p-groups, Computational algebra and number theory (Sydney, 1992), Math. Appl., vol. 325, Kluwer\nAcad. Publ., Dordrecht, 1995, pp. 83\u201390.\n\n[27] C. Reutenauer, Free Lie algebras, London Mathematical Society Monographs. New Series, vol. 7, The Clarendon Press Oxford University Press,\nNew York, 1993.\n[28] C. C. Sims, Enumerating p-groups, Proc. London Math. Soc. (3) 15 (1965),\n151\u2013166.\n[29] A. I. Skopin, The factor groups of an upper central series of free groups,\nDoklady Akad. Nauk SSSR (N.S.) 74 (1950), 425\u2013428.\n[30] U. H. M. Webb, The occurrence of groups as automorphisms of nilpotent\np-groups, Arch. Math. (Basel) 37 (1981), no. 6, 481\u2013498.\n[31] E. T. Whittaker and G. N. Watson, A course of modern analysis, Fourth\nedition. Reprinted, Cambridge University Press, New York, 1962.\n[32] H. S. Wilf, Three problems in combinatorial asymptotics, J. Combin. Theory Ser. A 35 (1983), no. 2, 199\u2013207.\n[33] D. L. Winter, The automorphism group of an extraspecial p-group, Rocky\nMountain J. Math. 2 (1972), no. 2, 159\u2013168.\n\n38\n\n\f"}