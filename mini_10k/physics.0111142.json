{"id": "http://arxiv.org/abs/physics/0111142v1", "guidislink": true, "updated": "2001-11-16T17:48:52Z", "updated_parsed": [2001, 11, 16, 17, 48, 52, 4, 320, 0], "published": "2001-11-16T17:48:52Z", "published_parsed": [2001, 11, 16, 17, 48, 52, 4, 320, 0], "title": "EPICS Software Development for SNS VME-based Timing and RTDL System", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=physics%2F0111022%2Cphysics%2F0111152%2Cphysics%2F0111140%2Cphysics%2F0111051%2Cphysics%2F0111174%2Cphysics%2F0111180%2Cphysics%2F0111089%2Cphysics%2F0111002%2Cphysics%2F0111096%2Cphysics%2F0111098%2Cphysics%2F0111105%2Cphysics%2F0111074%2Cphysics%2F0111169%2Cphysics%2F0111061%2Cphysics%2F0111067%2Cphysics%2F0111151%2Cphysics%2F0111201%2Cphysics%2F0111046%2Cphysics%2F0111056%2Cphysics%2F0111024%2Cphysics%2F0111011%2Cphysics%2F0111186%2Cphysics%2F0111086%2Cphysics%2F0111154%2Cphysics%2F0111210%2Cphysics%2F0111203%2Cphysics%2F0111209%2Cphysics%2F0111092%2Cphysics%2F0111150%2Cphysics%2F0111036%2Cphysics%2F0111184%2Cphysics%2F0111182%2Cphysics%2F0111014%2Cphysics%2F0111142%2Cphysics%2F0111026%2Cphysics%2F0111202%2Cphysics%2F0111062%2Cphysics%2F0111103%2Cphysics%2F0111068%2Cphysics%2F0111199%2Cphysics%2F0111035%2Cphysics%2F0111012%2Cphysics%2F0111066%2Cphysics%2F0111063%2Cphysics%2F0111049%2Cphysics%2F0111052%2Cphysics%2F0111198%2Cphysics%2F0111075%2Cphysics%2F0111124%2Cphysics%2F0111149%2Cphysics%2F0111183%2Cphysics%2F0111116%2Cphysics%2F0111025%2Cphysics%2F0111115%2Cphysics%2F0111077%2Cphysics%2F0301053%2Cphysics%2F0301009%2Cphysics%2F0301037%2Cphysics%2F0301050%2Cphysics%2F0301077%2Cphysics%2F0301042%2Cphysics%2F0301035%2Cphysics%2F0301030%2Cphysics%2F0301019%2Cphysics%2F0301017%2Cphysics%2F0301003%2Cphysics%2F0301045%2Cphysics%2F0301021%2Cphysics%2F0301007%2Cphysics%2F0301076%2Cphysics%2F0301041%2Cphysics%2F0301029%2Cphysics%2F0301038%2Cphysics%2F0301081%2Cphysics%2F0301061%2Cphysics%2F0301063%2Cphysics%2F0301025%2Cphysics%2F0301051%2Cphysics%2F0301056%2Cphysics%2F0301015%2Cphysics%2F0301046%2Cphysics%2F0301070%2Cphysics%2F0301034%2Cphysics%2F0301072%2Cphysics%2F0301052%2Cphysics%2F0301001%2Cphysics%2F0301002%2Cphysics%2F0301071%2Cphysics%2F0301026%2Cphysics%2F0301060%2Cphysics%2F0301006%2Cphysics%2F0301018%2Cphysics%2F0301044%2Cphysics%2F0301012%2Cphysics%2F0301008%2Cphysics%2F0301023%2Cphysics%2F0301024%2Cphysics%2F0301049%2Cphysics%2F0301068%2Cphysics%2F0301011%2Cphysics%2F0301083&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "EPICS Software Development for SNS VME-based Timing and RTDL System"}, "summary": "The Spallation Neutron Source (SNS) timing and Real Time Data Link (RTDL)\nsystems are being designed and developed at Brookhaven National Laboratory\n(BNL), Los Alamos National Laboratory (LANL) and other SNS collaborating labs\n[1]. The VME-based SNS timing system is comprised of a phase locked loop (PLL)\nto generate a 120 Hz power line locked clock, a master timing system including\nup to 4 16-event input modules (V101) and a timing system encoder module\n(V123S), distribution system to all equipment locations, and a timing system\nreceiver module (V124S). The VME-based SNS RTDL system includes an encoder\nmodule (V105), up to 10 8-inputs modules (V206) and an RTDL receiver module.\nThe EPICS [2] software support for the timing and RTDL master VME boards has\nbeen developed at BNL while the software and hardware of the SNS utility module\nare undertaken at LANL. The software is currently under the beta test at the\nSNS collaborating labs. This paper describes the design and the implementation\nof the software.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=physics%2F0111022%2Cphysics%2F0111152%2Cphysics%2F0111140%2Cphysics%2F0111051%2Cphysics%2F0111174%2Cphysics%2F0111180%2Cphysics%2F0111089%2Cphysics%2F0111002%2Cphysics%2F0111096%2Cphysics%2F0111098%2Cphysics%2F0111105%2Cphysics%2F0111074%2Cphysics%2F0111169%2Cphysics%2F0111061%2Cphysics%2F0111067%2Cphysics%2F0111151%2Cphysics%2F0111201%2Cphysics%2F0111046%2Cphysics%2F0111056%2Cphysics%2F0111024%2Cphysics%2F0111011%2Cphysics%2F0111186%2Cphysics%2F0111086%2Cphysics%2F0111154%2Cphysics%2F0111210%2Cphysics%2F0111203%2Cphysics%2F0111209%2Cphysics%2F0111092%2Cphysics%2F0111150%2Cphysics%2F0111036%2Cphysics%2F0111184%2Cphysics%2F0111182%2Cphysics%2F0111014%2Cphysics%2F0111142%2Cphysics%2F0111026%2Cphysics%2F0111202%2Cphysics%2F0111062%2Cphysics%2F0111103%2Cphysics%2F0111068%2Cphysics%2F0111199%2Cphysics%2F0111035%2Cphysics%2F0111012%2Cphysics%2F0111066%2Cphysics%2F0111063%2Cphysics%2F0111049%2Cphysics%2F0111052%2Cphysics%2F0111198%2Cphysics%2F0111075%2Cphysics%2F0111124%2Cphysics%2F0111149%2Cphysics%2F0111183%2Cphysics%2F0111116%2Cphysics%2F0111025%2Cphysics%2F0111115%2Cphysics%2F0111077%2Cphysics%2F0301053%2Cphysics%2F0301009%2Cphysics%2F0301037%2Cphysics%2F0301050%2Cphysics%2F0301077%2Cphysics%2F0301042%2Cphysics%2F0301035%2Cphysics%2F0301030%2Cphysics%2F0301019%2Cphysics%2F0301017%2Cphysics%2F0301003%2Cphysics%2F0301045%2Cphysics%2F0301021%2Cphysics%2F0301007%2Cphysics%2F0301076%2Cphysics%2F0301041%2Cphysics%2F0301029%2Cphysics%2F0301038%2Cphysics%2F0301081%2Cphysics%2F0301061%2Cphysics%2F0301063%2Cphysics%2F0301025%2Cphysics%2F0301051%2Cphysics%2F0301056%2Cphysics%2F0301015%2Cphysics%2F0301046%2Cphysics%2F0301070%2Cphysics%2F0301034%2Cphysics%2F0301072%2Cphysics%2F0301052%2Cphysics%2F0301001%2Cphysics%2F0301002%2Cphysics%2F0301071%2Cphysics%2F0301026%2Cphysics%2F0301060%2Cphysics%2F0301006%2Cphysics%2F0301018%2Cphysics%2F0301044%2Cphysics%2F0301012%2Cphysics%2F0301008%2Cphysics%2F0301023%2Cphysics%2F0301024%2Cphysics%2F0301049%2Cphysics%2F0301068%2Cphysics%2F0301011%2Cphysics%2F0301083&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "The Spallation Neutron Source (SNS) timing and Real Time Data Link (RTDL)\nsystems are being designed and developed at Brookhaven National Laboratory\n(BNL), Los Alamos National Laboratory (LANL) and other SNS collaborating labs\n[1]. The VME-based SNS timing system is comprised of a phase locked loop (PLL)\nto generate a 120 Hz power line locked clock, a master timing system including\nup to 4 16-event input modules (V101) and a timing system encoder module\n(V123S), distribution system to all equipment locations, and a timing system\nreceiver module (V124S). The VME-based SNS RTDL system includes an encoder\nmodule (V105), up to 10 8-inputs modules (V206) and an RTDL receiver module.\nThe EPICS [2] software support for the timing and RTDL master VME boards has\nbeen developed at BNL while the software and hardware of the SNS utility module\nare undertaken at LANL. The software is currently under the beta test at the\nSNS collaborating labs. This paper describes the design and the implementation\nof the software."}, "authors": ["Johnny Tang"], "author_detail": {"name": "Johnny Tang"}, "author": "Johnny Tang", "arxiv_comment": "3 pages poster to ICALEPCS 2001 in November 2001, San Jose,\n  California", "links": [{"href": "http://arxiv.org/abs/physics/0111142v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/physics/0111142v1", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "physics.acc-ph", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "physics.acc-ph", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/physics/0111142v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/physics/0111142v1", "journal_reference": "eConf C011127 (2001) TUAP068", "doi": null, "fulltext": "TUAP068\n\nEPICS Software Development for SNS VME Based Timing and RTDL System*\nJ. Y. Tang\u2020, H. Hartmann, L. Hoff, T. Kerner, B. Oerter and J. Smith\nBrookhaven National Laboratory, Upton, NY, USA\nP. McGehee and P. Stein, Los Alamos National Laboratory, Los Alamos, NM, USA\nAbstract\nThe Spallation Neutron Source (SNS) timing and Real\nTime Data Link (RTDL) systems are being designed\nand developed at Brookhaven National Laboratory\n(BNL), Los Alamos National Laboratory (LANL) and\nother SNS collaborating labs [1]. The VME-based SNS\ntiming system is comprised of a phase locked loop\n(PLL) to generate a 120 Hz power line locked clock, a\nmaster timing system including up to 4 16-event input\nmodules (V101) and a timing system encoder module\n(V123S), distribution system to all equipment\nlocations, and a timing system receiver module\n(V124S). The VME-based SNS RTDL system includes\nan encoder module (V105), up to 10 8-inputs modules\n(V206) and an RTDL receiver module. The EPICS [2]\nsoftware support for the timing and RTDL master VME\nboards has been developed at BNL while the software\nand hardware of the SNS utility module are undertaken\nat LANL. The software is currently under the beta test\nat the SNS collaborating labs. This paper describes the\ndesign and the implementation of the software.\n\n1 INTRODUCTION\nThe design of the SNS beam synchronous timing\n\nsystem is based on the existing model for the\nBrookhaven National Laboratory's Relativistic Heavy\nIon Collider (RHIC). Adapting the RHIC system for\nSNS reduces the development time and takes advantage\nof proven technology reducing the engineering risk.\nModifications to the RHIC system to meet SNS\nrequirements would be minor. For the same reasons,\nthe most of related RHIC and APS timing control\nsoftware has been ported and re-engineered. The SNS\ntiming software development is currently being\ndeveloped on the SNS timing system test stand at BNL.\nIts configuration is shown in Figure 1. The software\nwill be installed and used for the SNS control system\ncommissioning at Oak Ridge National Laboratory.\n\n2 SNS TIMING SYSTEM HARDWARE\n2.1 Beam Synchronous Event Encoder System\nThe design of SNS beam synchronous event encoder\nis adapted from the RHIC system [3] and it is contained\nin a single VME chassis utilizing five dedicated slots,\none for the V123S module and four for V101 modules.\nThe slots are fixed by the dedicated P2 backplane. The\n\n* Work performed under the auspices of the U.S. Department of Energy\n\n\u2020 jtang@bnl.gov\n\n\fbeam synchronous event link carrier varies around\n16.92 MHz, derived from 16 x the SNS ring LLRF\nfrequency. The source of this RF clock is created by\ndirect digital synthesizer (DDS) and a power line\ntracking (PLL) VME board. The beam synchronous\nevent link is initiated and fanned out as differential\nPECL, and distributed by fiber optics.\nThe purpose of the SNS beam synchronous event\nsystem is:\n* Transmit the 600 Hz Line sync Event to\nestablish spill and fill cycle delineation\npoints accurate to 1 ns\n* Synchronize the above signals to the 1 MHz\nring rotation tick\n* Synchronize the neutron choppers to the\nring extraction time\n* Synchronize the linac beam chopper\ninjection pulse to the accumulator ring\nphase\n* Provide beam synchronous events to the\ninstrumentation triggers, beam position\nmonitors, and profilers\n* Track variations in injection energy from\n842 MeV to 1.3 GeV or B field corrections\nrequiring rotation frequency adjustments\n\n2.2 The Beam Synchronous Trigger Module\nThe beam synchronous trigger module (V124S) is a\ngeneral-purpose VME bus controlled module and is\ndesigned to provide clocks and triggers for data\nacquisition systems and experiments. The V124S\nmodule provides eight identical channels that can be\nconfigured independently and a buffered recovered RF\nClock output. The design of this module is based on the\nRHIC's version [4]. The primary function of this\nmodule is the trigger delay function.\n\n2.3 SNS Real Time Data Link System\nThe SNS RTDL system is comprised of two module\ntypes: the Encoder Module (V105) and the Input\nModule (V206). There is only one V105 module, but\nmany (up to 10) Input Modules. The design of the SNS\nRTDL system is based on the RHIC's version [5]. The\nRTDL system distributes to all locations around the\nSNS machine parameters of general interest to\naccelerator systems and users. The RTDL machine\nparameter frames are transmitted on a serial selfclocking link using a modified Manchester code. The\ntransmission rate is 10Mb/s and about 4.3 us are\nrequired to transmit each parameter data frame. A\ntypical application of using the system is to distribute a\nGPS time stamp to all the IOCs around the SNS\nmachine.\n\n2.4 The Utility Module\nThe SNS utility module is a multi-purpose circuit\nboard used to provide an Input/Output Controller (IOC)\nwith interfaces to SNS event and RTDL links,\ninput/output capability, and chassis environment\ninformation. The utility module, designed to reside in a\nVME chassis, occupies one VME board slot. It has the\nfollowing main features and functions:\n* SNS event link decoder and event link\nfilter used to generate VME interrupts\n* SNS RTDL utility link receiver and data\nframe buffer\n* RTDL utility link error monitor\n* Status indication for event link, SNS utility\nlink and board initialization\n* Power supply, fan and temperature\nmonitoring for the VME chassis\n* Interrupt generation from failed links,\npower supplies, fans and over temperature\n* Remote reset of VME chassis via the\nRTDL utility link\n* VME interrupts from two external signal\nsources\n\n3 SOFTWARE SUPPORT\n3.1 VxWorks Driver Development\nThe VxWorks drivers for the SNS timing hardware\nprovide EPICS device support layer or high-level\napplication software the access to the hardware\nregisters and the capability of the hardware module\nconfiguration. The driver development strategy taken\nwas Wind River VxWorks driver compliant: top-down\ndesign and bottom-up implementation and testing. The\noriginal RHIC drivers were used as template files for\nthe SNS timing drivers.\nbsyncDrv() \u2013 This driver provides an interface to the\nv123s, the SNS beam-synchronous encoder module and\nthe 16-channel v101 event code input module. 20\nroutines implemented in this driver are accessible\nthrough the VxWorks I/O system for I/O access to\nspecific registers. The interrupt service routine\nimplemented accumulates input errors from various\nsources.\nrtdlDrv() \u2013 This driver controls the SNS RTDL system.\n25 routines implemented in this driver are accessible\nthrough the VxWorks I/O system for controls of the\nRTDL encoder, v105 module and the input module,\nv106 via their registers. In addition to the IOCTL\nroutines, the read and write functions of the driver are\nprovided for reading or writing from the parameter ID\n\n\ftable within the encoder module. The interrupts are\ngenerated when the encoder module does not get a\nresponse from a particular input channel, as well as\nwhen no event line carrier has been detected for 1 us.\nThe Parameter ID on the encoder module is read by the\ninterrupt handler when a NO RESPONSE interrupt\noccurs in order to decipher which channel is at fault.\nThe interrupts are generated on the input module when\nthe carrier on the local serial link has not been detected\nfor 2 us, when a frame has been received with a data\nintegrity (CRC) error, and when a frame error occurs.\nbsTrigDrv() \u2013 This driver provides an interface to the\nv124s 8-channel, beam-synchronous trigger module.\nThe driver allows configuring each of the 8-channel\nindividually. 38 IOCTL routines implemented in this\ndriver are accessible through the I/O system for\nconfiguring the module.\nutilityDrv() \u2013 This driver consists of read and write\naccess to specific registers in addition to handling of\nthree distinct interrupt sources. With the exception of\nthe RTDL frames all registers are accessed as 8-bit\nquantities. The driver reads error counts and status for\nthe event and RTDL links, the RTDL frames,\nenvironmental parameters associated with the power\nsupply and temperature control, and the hardware\nselected remote reset address. Write access to the utility\nboard allows control of which event codes generate\nlocal interrupts, temperature high limit set point, and\nvarious initialization functions. Interrupt service\nroutines are attached to interrupts stemming from the\nEvent Link, from the monitoring of the board\nenvironment, and from external sources.\n\n3.2 EPICS Device Support Layer\nEPICS device support layer for the SNS timing\nsystem hardware serves the interface between the\nVxWorks drivers and EPICS control system. After\ncareful review of APS' timing system EPICS support,\ninstead of creating a new set of record types, a group of\nrecord templates with a new set of device support\nroutines has been designed and implemented for the\nSNS timing system EPICS support. This choice has\nbeen found to be more flexible for a prototyping\nhardware system and easier for the future EPICS\nupgrading effort. Three major function components of\nthe SNS timing system EPICS support are the basic I/O\ninterface, synchronized time stamp support and\n\ntriggering of EPICS database processing in response to\nevent link activity.\nThe basic I/O interface - this provides a mapping\nbetween the EPICS database records and the device\ndriver I/O functions over the board registers. The board\nconfiguration can be accomplished via EPICS database\nrecords.\nThe synchronized time stamp support \u2013 this is\naccomplished by using the synchronized time stamp\nsupport interface originally defined at APS and makes\nuse of three RTDL parameters updated at 60 Hz by a\nRTDL master. To support this feature, the device\nsupport for the utility module enables the interrupt\ngenerated by the \"RTDL Valid\" event at initialization.\nThe triggering of EPICS database processing in\nresponse to the event link activity - The device support\nlayer allows the application developer to define records\nthat will be processed when a specific combination of\nan event and type of beam pulse profile occurs.\n\n3\n\nSUMMARY\n\nBoth hardware and software for the SNS timing\nsystem are currently in beta test at the SNS partner\nlabs. The first application of the software will be\nconducted at LBNL for SNS Front-End diagnostic\nsystem around the end of this year. On-going effort on\nhardware and software will be continued until the\ncommissioning of the SNS at ORNL in 2004 or 2005.\n\n5 ACKNOWLEGEMENTS\nThe authors wish to thank Marty Kraimer of APS for\nthe meaningful discussions on using record templates\nvs. creating new record types.\n\nREFERENCES\n[1]\n\nB. Oerter, et al, \"SNS Timing System\",\nICALEPCS'01, San Jose, (2001)\n[2] L. R. Dalesio, et al., \"EPICS\", Nuclear Instruments\n& Methods in Physics Research A 352 (1994),\n179-184\n[3] T. Kerner, et al, \"V123 Beam Synchronous Encoder\nModule\", PAC'99, New York, (1999)\n[4] H. Hartmann, et al, \"RHIC Beam Synchronous\nTrigger Module\", PAC'99, New York, (1999)\n[5] H. Hartmann, \"The RHIC Real Time Data Link\nSystem\", PAC'97, Vancouver, Canada, (1997)\n\n\f"}