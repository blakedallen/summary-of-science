{"id": "http://arxiv.org/abs/0912.0465v2", "guidislink": true, "updated": "2010-03-03T15:58:26Z", "updated_parsed": [2010, 3, 3, 15, 58, 26, 2, 62, 0], "published": "2009-12-02T16:57:52Z", "published_parsed": [2009, 12, 2, 16, 57, 52, 2, 336, 0], "title": "Constructing smooth potentials of mean force, radial, distribution\n  functions and probability densities from sampled data", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0912.1967%2C0912.4342%2C0912.3986%2C0912.4025%2C0912.1354%2C0912.0838%2C0912.4691%2C0912.0015%2C0912.3642%2C0912.1466%2C0912.3351%2C0912.3682%2C0912.0863%2C0912.0121%2C0912.5517%2C0912.0498%2C0912.2825%2C0912.0181%2C0912.1256%2C0912.1705%2C0912.2469%2C0912.1245%2C0912.4258%2C0912.0837%2C0912.0513%2C0912.3951%2C0912.4949%2C0912.4700%2C0912.1293%2C0912.3375%2C0912.1102%2C0912.4110%2C0912.1428%2C0912.4313%2C0912.1327%2C0912.2838%2C0912.2939%2C0912.3683%2C0912.4011%2C0912.1655%2C0912.1298%2C0912.4176%2C0912.0854%2C0912.5213%2C0912.4765%2C0912.3398%2C0912.1089%2C0912.4497%2C0912.4925%2C0912.3446%2C0912.4205%2C0912.4717%2C0912.1209%2C0912.0035%2C0912.0020%2C0912.4467%2C0912.1669%2C0912.0732%2C0912.1268%2C0912.1539%2C0912.2130%2C0912.2345%2C0912.5391%2C0912.1292%2C0912.1550%2C0912.0664%2C0912.2393%2C0912.2397%2C0912.1075%2C0912.2521%2C0912.2424%2C0912.3818%2C0912.3412%2C0912.3712%2C0912.1626%2C0912.1966%2C0912.1221%2C0912.5232%2C0912.4267%2C0912.0465%2C0912.1809%2C0912.2538%2C0912.3927%2C0912.0767%2C0912.2775%2C0912.2674%2C0912.0673%2C0912.2270%2C0912.1427%2C0912.5034%2C0912.0120%2C0912.1774%2C0912.2718%2C0912.5350%2C0912.1822%2C0912.4684%2C0912.3947%2C0912.3764%2C0912.5032%2C0912.0429%2C0912.1038&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Constructing smooth potentials of mean force, radial, distribution\n  functions and probability densities from sampled data"}, "summary": "In this paper a method of obtaining smooth analytical estimates of\nprobability densities, radial distribution functions and potentials of mean\nforce from sampled data in a statistically controlled fashion is presented. The\napproach is general and can be applied to any density of a single random\nvariable. The method outlined here avoids the use of histograms, which require\nthe specification of a physical parameter (bin size) and tend to give noisy\nresults. The technique is an extension of the Berg-Harris method [B.A. Berg and\nR.C. Harris, Comp. Phys. Comm. 179, 443 (2008)], which is typically inaccurate\nfor radial distribution functions and potentials of mean force due to a\nnon-uniform Jacobian factor. In addition, the standard method often requires a\nlarge number of Fourier modes to represent radial distribution functions, which\ntends to lead to oscillatory fits. It is shown that the issues of poor sampling\ndue to a Jacobian factor can be resolved using a biased resampling scheme,\nwhile the requirement of a large number of Fourier modes is mitigated through\nan automated piecewise construction approach. The method is demonstrated by\nanalyzing the radial distribution functions in an energy-discretized water\nmodel. In addition, the fitting procedure is illustrated on three more\napplications for which the original Berg-Harris method is not suitable, namely,\na random variable with a discontinuous probability density, a density with long\ntails, and the distribution of the first arrival times of a diffusing particle\nto a sphere, which has both long tails and short-time structure. In all cases,\nthe resampled, piecewise analytical fit outperforms the histogram and the\noriginal Berg-Harris method.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0912.1967%2C0912.4342%2C0912.3986%2C0912.4025%2C0912.1354%2C0912.0838%2C0912.4691%2C0912.0015%2C0912.3642%2C0912.1466%2C0912.3351%2C0912.3682%2C0912.0863%2C0912.0121%2C0912.5517%2C0912.0498%2C0912.2825%2C0912.0181%2C0912.1256%2C0912.1705%2C0912.2469%2C0912.1245%2C0912.4258%2C0912.0837%2C0912.0513%2C0912.3951%2C0912.4949%2C0912.4700%2C0912.1293%2C0912.3375%2C0912.1102%2C0912.4110%2C0912.1428%2C0912.4313%2C0912.1327%2C0912.2838%2C0912.2939%2C0912.3683%2C0912.4011%2C0912.1655%2C0912.1298%2C0912.4176%2C0912.0854%2C0912.5213%2C0912.4765%2C0912.3398%2C0912.1089%2C0912.4497%2C0912.4925%2C0912.3446%2C0912.4205%2C0912.4717%2C0912.1209%2C0912.0035%2C0912.0020%2C0912.4467%2C0912.1669%2C0912.0732%2C0912.1268%2C0912.1539%2C0912.2130%2C0912.2345%2C0912.5391%2C0912.1292%2C0912.1550%2C0912.0664%2C0912.2393%2C0912.2397%2C0912.1075%2C0912.2521%2C0912.2424%2C0912.3818%2C0912.3412%2C0912.3712%2C0912.1626%2C0912.1966%2C0912.1221%2C0912.5232%2C0912.4267%2C0912.0465%2C0912.1809%2C0912.2538%2C0912.3927%2C0912.0767%2C0912.2775%2C0912.2674%2C0912.0673%2C0912.2270%2C0912.1427%2C0912.5034%2C0912.0120%2C0912.1774%2C0912.2718%2C0912.5350%2C0912.1822%2C0912.4684%2C0912.3947%2C0912.3764%2C0912.5032%2C0912.0429%2C0912.1038&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "In this paper a method of obtaining smooth analytical estimates of\nprobability densities, radial distribution functions and potentials of mean\nforce from sampled data in a statistically controlled fashion is presented. The\napproach is general and can be applied to any density of a single random\nvariable. The method outlined here avoids the use of histograms, which require\nthe specification of a physical parameter (bin size) and tend to give noisy\nresults. The technique is an extension of the Berg-Harris method [B.A. Berg and\nR.C. Harris, Comp. Phys. Comm. 179, 443 (2008)], which is typically inaccurate\nfor radial distribution functions and potentials of mean force due to a\nnon-uniform Jacobian factor. In addition, the standard method often requires a\nlarge number of Fourier modes to represent radial distribution functions, which\ntends to lead to oscillatory fits. It is shown that the issues of poor sampling\ndue to a Jacobian factor can be resolved using a biased resampling scheme,\nwhile the requirement of a large number of Fourier modes is mitigated through\nan automated piecewise construction approach. The method is demonstrated by\nanalyzing the radial distribution functions in an energy-discretized water\nmodel. In addition, the fitting procedure is illustrated on three more\napplications for which the original Berg-Harris method is not suitable, namely,\na random variable with a discontinuous probability density, a density with long\ntails, and the distribution of the first arrival times of a diffusing particle\nto a sphere, which has both long tails and short-time structure. In all cases,\nthe resampled, piecewise analytical fit outperforms the histogram and the\noriginal Berg-Harris method."}, "authors": ["Ramses van Zon", "Jeremy Schofield"], "author_detail": {"name": "Jeremy Schofield"}, "author": "Jeremy Schofield", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1063/1.3366523", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/0912.0465v2", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/0912.0465v2", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "14 pages, 15 figures. To appear in J. Chem. Phys", "arxiv_primary_category": {"term": "cond-mat.stat-mech", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "cond-mat.stat-mech", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "cond-mat.soft", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/0912.0465v2", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/0912.0465v2", "journal_reference": "J. Chem.Phys. 132, 154110 (2010)", "doi": "10.1063/1.3366523", "fulltext": "Constructing smooth potentials of mean force, radial distribution functions and\nprobability densities from sampled data\nRamses van Zon and Jeremy Schofield\n\narXiv:0912.0465v2 [cond-mat.stat-mech] 3 Mar 2010\n\nChemical Physics Theory Group, Department of Chemistry, University of Toronto,\n80 Saint George Street, Toronto, Ontario M5S 3H6, Canada\n(Dated: March 3, 2010)\nIn this paper a method of obtaining smooth analytical estimates of probability densities, radial\ndistribution functions and potentials of mean force from sampled data in a statistically controlled\nfashion is presented. The approach is general and can be applied to any density of a single random\nvariable. The method outlined here avoids the use of histograms, which require the specification\nof a physical parameter (bin size) and tend to give noisy results. The technique is an extension\nof the Berg-Harris method [B.A. Berg and R.C. Harris, Comp. Phys. Comm. 179, 443 (2008)],\nwhich is typically inaccurate for radial distribution functions and potentials of mean force due to\na non-uniform Jacobian factor. In addition, the standard method often requires a large number of\nFourier modes to represent radial distribution functions, which tends to lead to oscillatory fits. It\nis shown that the issues of poor sampling due to a Jacobian factor can be resolved using a biased\nresampling scheme, while the requirement of a large number of Fourier modes is mitigated through\nan automated piecewise construction approach. The method is demonstrated by analyzing the radial\ndistribution functions in an energy-discretized water model. In addition, the fitting procedure is\nillustrated on three more applications for which the original Berg-Harris method is not suitable,\nnamely, a random variable with a discontinuous probability density, a density with long tails, and\nthe distribution of the first arrival times of a diffusing particle to a sphere, which has both long\ntails and short-time structure. In all cases, the resampled, piecewise analytical fit outperforms the\nhistogram and the original Berg-Harris method.\nPACS numbers: 05.20.Jj, 82.20.Wt, 02.70.Rr, 02.50.-r\n\nI.\n\nINTRODUCTION\n\nIn many situations the probability to find a particle\nat a certain distance from a given other particle is of\ninterest. This probability is given by the radial distribution function. In addition to providing detailed information on the local structure of a system, one can often\nexpress thermodynamic quantities such as the pressure,\nenergy and compressibility in terms of the radial distribution functions.1 Furthermore, the radial distribution\nfunction can be reformulated in terms of a potential of\nmean force, which is of great importance in multi-scale\nsimulations that take the potential of mean force as input\nin Langevin or Brownian dynamics simulations.2,3\nRadial distribution functions are usually constructed\nin simulations by forming a histogram of sampled interparticle distances.2 However, histograms contain the bin\nsize as a free parameter, and can be rather noisy for\na poorly selected value of this parameter. For probability densities, an alternative method recently proposed by Berg and Harris avoids histograms and yields\na smooth analytical form for the probability density\nwhich describes the sample data statistically at least as\nwell as the noisy histogram.4 This method has already\nproved useful in the context of the computation of quantum free energy differences from non-equilibrium work\ndistributions,5 the determination of the density in BoseEinstein condensates,6 and in the distribution of a reaction coordinate in simulations of chemical reactions.7\nHaving a similar method for potentials of mean force\n\nand radial distribution functions would have many advantages. As in the Berg-Harris method, such an approach would avoid the noise that accompanies the standard histogram method, while no a priori choice of bin\nsize is required. Furthermore, a smooth radial distribution would give a better representation of the potential of\nmean force (which is related to the logarithm of the radial\ndistribution function), and allows the function to be evaluated at any point in the range over which it is defined.\nFinally, the expressions for the pressure, energy and compressibility in terms of the radial distribution functions\ninvolve integrals of the radial distribution function over\nr. Such integrals can be evaluated more accurately from\nan analytic form than from a histogram, whose accuracy\nis restricted by the bin size.\nThe purpose of this paper is to develop an approach to\nobtain smooth radial distribution functions and potentials of mean force from sampled inter-particle distances.\nThe resulting method turns out to be suitable not just\nfor radial distribution functions and potentials of mean\nforce, but for a large class of densities of single random\nvariables.\nThe paper is structured as follows. Sec. II presents a\nmodel of water in which rigid molecules interact through\na discretized potential. Construction of radial distribution functions from data derived from this model will be\nused as a running test case. This section also contains\nsome details on the generation of sampled data through\nsimulation. The Berg-Harris method for smoothing probability densities in a statistically controlled fashion, and\nthe connection between probability distribution functions\n\n\f2\nand radial distribution functions, are briefly reviewed in\nSec. III. In Sec. IV, simulation results are presented that\nshow the shortcoming of the Berg-Harris method for radial distribution functions. The extended method is developed in Sec. V, with Sec. V A containing an explanation for the poor performance and its solution through\nstatistical resampling. Sec. V B addresses an additional\nproblem related to the particular shape of radial distribution functions, which is solved by extending the method\nto use piecewise analytic functions. In Sec. VI, the generality of the method is illustrated by presenting the results\nof applying the method to data drawn from three different probability densities which are problematic for the\noriginal Berg-Harris method. The paper concludes with\na discussion in Sec. VII.\n\nII.\n\nSYSTEM: A DISCRETE WATER MODEL\n\nIn the development of the smooth approximation\nmethod below, a model of rigid water molecules subject to a discretized interaction potential between the\nmolecules will be used as a running test case for the construction of radial distribution functions. Since a water\nmolecule consists of two kinds of atoms (oxygen and hydrogen), there are three radial distribution functions in\nthis system, gOO , gOH and gHH , which turn out to have\nquite different character and therefore give a more stringent test of the smooth fitting methods than a singleatom model would.\nThe relative distances between the atomic sites in\nmolecules are fixed, making the molecules rigid bodies.\nEach state of each body i can therefore be described by\nits center-of-mass position ri , its orientation or attitude\nmatrix Ai that transforms coordinates from the lab frame\nto a body-fixed frame for molecule i, and the associated\nlinear and angular momenta. Here the body-fixed frame\nis chosen so that the third row of the matrix Ai corresponds to the direction of the molecule's dipole \u03bci , whose\nmagnitude is fixed at a value \u03bc.\nThe interaction potential between a pair of molecules\ni and j is a discrete version of the soft sticky dipole\npotential8\u201311\nvij = v LJ (ri \u2212rj )+v dp (ri \u2212rj , Ai , Aj )+v sp (ri \u2212rj , Ai , Aj ),\n(1)\nwhere the Lennard-Jones, dipole, and sticky parts of the\npotential are, respectively, given by\n\u0014\u0010 \u0011\n\u0015\n\u03c3 12 \u0010 \u03c3 \u00116\nlj\nv (r) = 4\u000f\n\u2212\n(2)\nr\nr\n\u03bci * \u03bcj\n\u03bci * r \u03bcj * r\nv dp (r, Ai , Aj ) =\n\u2212\n(3)\n3\nr\"\nr5\nv0\nv sp (r, Ai , Aj ) =\ns(r){sin \u03b8ij sin 2\u03b8ij cos 2\u03c6ij\n2\n+ sin \u03b8ji sin 2\u03b8ji cos 2\u03c6ji }\n0\n\n+s (r){(cos \u03b8ij \u2212 0.6)2 (cos \u03b8ij + 0.8)2\n\n+(cos \u03b8ji \u2212 0.6)2 (cos \u03b8ji + 0.8)2\n#\n\u22122\u03c9 0 }\n\n(4)\n\nwhere \u03b8ij and \u03c6ij are the conventional spherical angles of\nthe vector Ai r, and \u03b8ji and \u03c6ji are those of Aj r. Finally,\nthe switching function s(r) is defined as\n\ns(r) =\n\n\uf8f1\n\uf8f21\n\n(rU \u2212r)2 (rU +2r\u22123rL )\n(rU \u2212rL )3\n\n\uf8f3\n\n0\n\nfor r < rL\nfor rL < r < rU ,\nfor r > rU\n\n(5)\n\nwhile s0 (r) is given by the same form with primed pa0\n0\nrameters rL\nand rU\n.\nHere, the so-called SSD/E reparameterization of the\nmodel was used, for which the parameter values are \u000f =\n0.152 kcal/mol, \u03c3 = 3.035 \u00c5, \u03bc = 2.42 D, v0 = 3.90\nkcal/mol, and \u03c9 0 = 0.07715, while the cut-off parameters\nin the functions s and s0 are taken to be rL = 2.4 \u00c5,\n0\n0\n= 3.35 \u00c5.11\n= 2.75 \u00c5 and rU\nrU = 3.8 \u00c5, rL\nThe discontinuous interaction potential in our system\nis obtained from the smooth potential by the controlled\nenergy discretization method presented in Ref. 12. In this\ndiscretization, a cut-off naturally arises, and therefore no\nreaction field was included.\nThe natural simulation technique for systems with discretized potentials is discontinuous molecular dynamics,\nor DMD.12\u201314 In DMD, the dynamics of the system is free\n(no forces or torques are present) in between interaction\nevents at which linear and angular momenta change. By\nits very nature, the energy-discretization scheme used in\nDMD is symplectic, time-reversible and strictly conserves\nthe total (discretized) energy. It has no fixed time-step,\nbut moves from event to event. The event frequency,\nwhich sets the efficiency of the method to a large degree,\nis determined by the level of discretization of the potential energy: the finer the discretization, the more events\noccur. One typically finds that a discretization of the\norder of 21 kB T already suffices for a reasonably accurate\nsimulation of the smooth system.12 In the simulations of\nwhich the results are presented below, the discretization\nof the potential energy was set to 41 kB T .\nThe orientational dynamics of free rigid bodies is\nan important aspect in the calculation of interaction\ntimes.13,14 The solution of the equations of motion for the\nangular momenta and attitude matrix A depends on the\nsymmetry of the body through the principal moments of\ninertia. Although any value of the principal moments can\nbe utilized to sample configurations of a system of rigid\nmolecules, the DMD simulations presented here made use\nof the exact solution of the equations of motion for a free,\nasymmetric rigid rotor,13,15 and hence were based on the\nexact dynamics of the system.\nAt the time of a distance measurement in the simulation, the forces and torques are most likely zero, since\nthese quantities are non-zero only at discrete time points.\nThis makes alternative smoothing methods, such as the\n\n\f3\nweighted residual method16 and methods based on equilibrium identities using (smooth) forces,17,18 not applicable here. Since only the inter-particle distances are available as input for the determination of the analyticallyfitted radial distribution functions, the comparison with\nhistogram-based radial distribution functions is more equitable.\nIII.\nA.\n\nREVIEW\n\nSmoothing probability densities with the\nBerg-Harris method\n\nConsider a random variable r which has a probability density p(r). Suppose that one has a sample of n\ndata points {ri } that are independently drawn from the\ndensity p(r). How can one estimate p(r) from the data\npoints? One way is to bin the data points into a histogram. Because histograms are quite sensitive to statistical noise, Berg and Harris developed the following alternative procedure to obtain an analytical estimate for\nthe probability density from the data.4\nIn the Berg-Harris method, the data are first sorted\nsuch that ri < ri+1 . Using the sorted data, the empirical\ncumulative distribution function F\u0304 is defined in the range\n[r1 , rn ] as\nF\u0304 (r) =\n\ni\nn\n\nfor ri \u2264 r < ri+1 .\n\n(6)\n\nAlthough F\u0304 becomes a better approximation\nto the true\nRr\ncumulative distribution F (r) =\np(r0 ) dr0 with increasing sample size n, it is a function with many steps for\nany finite value of n so that its derivative is not analytic\nbut rather consists of delta functions.\nThe next step consists of writing the function F\u0304 as\na sum of a linear term and a Fourier expansion. The\nexpansion is truncated at the mth term:\nF\u0304 (r) \u2248 Fm (r) \u2261 F0 (r) +\n\nm\nX\n\ndj sin[j\u03c0F0 (r)],\n\n(7)\n\nBecause F\u0304 \u2212 F0 is zero at the end points of the interval\n[r1 , rn ], and the Fourier modes form a complete orthonormal basis of the space of such functions, the empirical\ncumulative distribution F\u0304 and the associated probability\ndensity are reconstructed exactly by Eqs. (7) and (10) as\nm \u2192 \u221e. However, as mentioned above, this limit would\nyield a series of delta functions for the probability density p\u0304 = p\u221e . The aim is to truncate the series at a level\nm which is not too high that one is fitting the noise, but\nhigh enough to give a good smooth approximation to F\u0304\nand p\u0304.\nThe final step of the procedure is therefore to find the\nappropriate number of Fourier terms m in a statistically\ncontrolled fashion. The value of m is determined here\nusing the Kolmogorov-Smirnov (K-S) test.4,19 This test\ndetermines how likely it is that the difference between\nthe empirical cumulative distribution function F\u0304 and its\nanalytical approximation Fm is due to noise.20 The test\ntakes the maximum variation Dm between F\u0304 and Fm over\nthe sampled points (Dm = maxi=1...n |Fm (ri ) \u2212 F\u0304 (ri )|),\nand returns a probability Qm = Q(Dm ) that the difference between the two cumulative distribution functions\nis due to chance. The functional dependence of Q on D\nis known to a good (asymptotic) approximation.21\nA small value of Qm indicates that the difference between the cumulative distribution functions is statistically significant, i.e. the quality of the expansion Fm is\ninsufficient to represent the data. One therefore carries\nout a process of progressively increasing the number of\nFourier modes m and evaluating Fm as well as Qm until\nthe value of Qm is larger than some convergence threshold Qcut . A reasonable value for this convergence value\nis Qcut = 0.6.\nIn Ref. 5, errors were estimated using the jackknife\nalgorithm,22 and the same method will be used here.\nHowever, since the inter-particle distance data naturally\ncome in blocks, each corresponding to a single configuration, not all data points are independent. To account for\nthis, we use a block-version of the jackknife method, in\nwhich a single block of data is omitted in each jackknife\nsample.23\n\nj=1\n\nwhere the linear term is defined as\nr \u2212 r1\nF0 (r) =\n.\nrn \u2212 r1\n\nB.\n\n(8)\n\nFurthermore, the Fourier coefficients dj in Eq. (7) are\ndetermined from\nZ rn\n2\ndj =\n[F\u0304 (r) \u2212 F0 (r)] sin[j\u03c0F0 (r)] dr. (9)\nrn \u2212 r1 r1\nWhen F\u0304 is approximated by Fm , the probability density\np is approximately\n\uf8f1\n\uf8fc\nm\n\uf8f2\n\uf8fd\nX\n1\npm (r) =\n1+\u03c0\ndj j cos[j\u03c0F0 (r)] . (10)\n\uf8fe\nrn \u2212 r1 \uf8f3\nj=1\n\nFrom probability densities to potentials of mean\nforce\n\nTo be able to apply the above smoothing method to radial distributions, for which histograms are presently the\nmethod of choice, one has to make the connection between a probability density on the one hand, and the radial distribution function and potentials of mean force on\nthe other hand. This connection will be briefly reviewed\nhere because some of the details are needed below.\nConsider a system of a single type of particle, in which\nthe number of particles is N and the volume of the system is V . The radial distribution function, denoted by\ng(r), is the density of particles at a distance r away from\na chosen first particle relative to the mean density N/V .\n\n\f4\n(a)\n4\n\n(b)\n2.5\n\nhistogram result\nBerg-Harris method\n\n3.5\n\n1.2\n1\n\n1\n\ngHH\n\n1.5\n\n1\n\n3\n\n3.5\n\n4\n\n4.5\n\n5\n\n5.5\n\n6\n\n0.6\n0.2\n0\n\n0\n2.5\n\n0.8\n0.4\n\n0.5\n\n0.5\n\nhistogram result\nBerg-Harris method\n\n1.4\n\n1.5\n\n2\n\ngOH\n\ngOO\n\n2.5\n\n0\n\nhistogram result\nBerg-Harris method\n\n2\n\n3\n\n(c)\n\n2\n\n2.5\n\n3\n\nr\n\n3.5\n\n4\nr\n\n4.5\n\n5\n\n5.5\n\n6\n\n1.5\n\n2\n\n2.5\n\n3\n\n3.5\nr\n\n4\n\n4.5\n\n5\n\n5.5\n\n6\n\nFIG. 1: Performance of the straightforward application of the Berg-Harris smoothing methods applied to the radial distribution\nfunctions gOO (a), gOH (b), and gHH (c) of the discretized water model. For comparison, the results from the histogram method\nare also shown (with error bars representing 95% confidence intervals at selected points). Here the range over which the radial\ndistribution functions are analyzed is defined to be [0, L/2], with L/2 = 12.4 \u00c5\n\nThe true density at a distance r from a first particle is\nthus (N/V )g(r). The mean number of particles at a distance between r and dr from a given particle is then\nn(r) = (N/V )g(r)4\u03c0r2 dr. The Jacobian factor 4\u03c0r2 ,\nwhich is, of course, the surface area of a sphere with radius r, will play an important role below. The probability\nof a particle being at a distance r is equal to the number\nof particles with this r, divided by the total number of\nparticles, N , i.e. p(r)dr = n(r)/N = g(r)4\u03c0r2 dr/V , so\none has the relation\ng(r) =\n\nV\np(r).\n4\u03c0r2\n\n(11)\n\nSystems with different types of particles give rise to\ndifferent radial distribution functions gij (r), where i and\nj label the kinds of particles. A similar argument to that\nabove leads to the relation,\ngij (r) =\n\nV\npij (r),\n4\u03c0r2\n\n(12)\n\nwhere pij (r) is the probability density of distances between a particle j and a particle i. Once gij (r) is known,\nthe potential of mean force \u03a6ij is found from1\n\u03a6ij (r) = \u2212kB T ln gij (r),\n\n(13)\n\nwhere T is the temperature of the system and kB is Boltzmann's constant.\nA further consideration for the applicability of the\nBerg-Harris method to radial distribution functions is\nwhether the K-S test may be used at all. The K-S test\nassumes that the samples are independently drawn. Correlation between the samples may result in a bias in the\nradial distribution functions. Since nearby particles in an\ninstantaneous configuration of the system are correlated,\nthis is potentially an issue. If, however, the system is sufficiently large, only a small fraction of the samples in a\nsingle configuration will be spatially correlated, making\nthe K-S test applicable to a very good approximation.\nFurthermore, if one ensures that the configurations are\ntaken from the simulation at sufficiently large time intervals, time correlations do not pose a problem either.\n\nIV. POOR PERFORMANCE OF THE\nSTRAIGHTFORWARD SMOOTHING APPLIED\nTO RADIAL DISTRIBUTION FUNCTIONS\n\nUsing the Berg-Harris method to get a smooth probability densities p(r) from a sample of inter-particle distances, one expects to obtain a good, smooth fit to g(r)\nby using Eq. (12). To test this expectation, the system of pure water in which rigid water molecules interact via a discretized potential energy derived from the\nsoft sticky dipole model described in Sec. II was simulated. For all simulation results presented in this section,\nthe parameters of the water model were as follows. The\ntemperature is set at T = 298 K, the number of particles is N = 512, the cubic simulation box has sides of\nlength L = 24.8\u00c5, so that the density is 1.0 kg/l. The\nprincipal moments of inertia of a rigid water molecule\nare Ix = 0.0337365 mH2 O \u00c52 , Iy = 0.0635040 mH2 O \u00c52 ,\nand Iz = 0.0972405 mH2 O \u00c52 , where mH2 O is the molecular mass of water. After equilibration, the simulations\nwere run for 8 picoseconds, in which the inter-particle distances were sampled every 2 picoseconds (long enough for\nthe system to decorrelate), for a total of 4 configurations.\nFrom these data, the radial distributions gOO , gOH\nand gHH were determined in the simulations through histograms and by following the smoothing procedure of\nSec. III A, using a value for Qcut of 0.6. The results\nfor the three radial distribution functions are shown in\nFig. 1. Clearly, the two methods do not agree very well\nat short inter-particle separations, despite the fact that\nthe smooth distance distributions are statistically good\ndescriptions of the distance data according to the K-S\ntest. In particular, note that the peak heights defining\nthe first solvation shell are not well-described.\n\nV.\n\nEXTENDING THE BERG-HARRIS METHOD\n\nGiven these unsatisfactory results, the histogram\nmethod would be preferred over the straightforward application of the Berg-Harris method. But there is a\n\n\f5\nway to fix the smoothing method to the extent that\nthe smoothing method becomes preferable over the histogram method. To understand how to fix the problem,\none first needs to understand its underlying causes.\n\nA.\n\nOver-represented large distances\n1.\n\nProblematic Jacobian\n\nThe convergence criterion of the smooth approximation relies on the K-S test.4,19 This test is based only\non the maximum variation Dm between F\u0304 and Fm and\nis more sensitive to typical data points than to outliers.\nAlthough this may appear to be a contradiction at first\nglance, it is important that the K-S test depends on the\nmaximum deviation in the cumulative distribution function, rather than on the deviation of the random variable\nfrom the mean. To see that outliers do not constitute\nvery deviant points in the cumulative distribution, suppose that, by chance, an outlier xout from the far left tail\nof a distribution is found in a sample of size n. This would\nyield an increase of magnitude of 1/n for the empirical\ncumulative distribution F\u0304 at xout , while the cumulative\ndistribution F (x) is practically zero since x is in the region where the distribution is very small. If Fm is not\ntoo bad an approximation to F , F\u0304 \u2212 Fm will also be of\norder 1/n at xout . However, the deviation between Fm\nand F\u0304 at other points x depends more on the goodness\nof fit than on the sample size, at least for points x in regions that contain a sizable fraction of the samples: these\nare the 'typical points'. For these points, there is little\nsample size dependence, so that to first order in n, one\nhas F\u0304 \u2212 Fm = O(n0 ). Since O(n\u22121 ) < O(n0 ) for large\nenough sample sizes, the outlier xout will not be seen as\nthe most deviant point in the K-S test, but rather, some\ntypical value x will have the most deviant cumulative\ndistribution.24\nThe above argument holds when the quality of the fit\nin the typical region is poor. However, as the number of\nFourier modes used to fit F\u0304 is increased, the quality of\nthe fit of the cumulative distribution F improves in the\ntypical region, and the maximum deviation shifts to less\nprobable values. Because the probability density function is small in the tails, this maximum deviation of the\ndistribution is not that large and the convergence criterion (the K-S test) is met, resulting in a good fit in the\ntypical region with a poor fit in the tails.\nThe Berg-Harris method of Sec. III A therefore works\nwell for probability densities without \"long tails,\" since\ntypical values of the variable will be the values of interest. However, for radial distribution functions, the focus\non typical values is the origin of the difficulties getting\nthe straightforward Berg-Harris method to work for radial distribution functions (cf. Fig. 1). Typical values of\nr are of no interest in radial distribution functions. In\na homogeneous system such as a fluid, the typical distances between any two particles is on the order of half\n\nthe system size, L/2. The length scales of interest in the\nradial distribution functions to describe local structure\nare typically much smaller than that.\nTo make this point clearer, consider a dilute gas of\nhard spheres with diameter \u03c3. In the limit of infinite\ndilution, the radial distribution function g(r) is zero for\nr < \u03c3 and unity otherwise. The probability density p(r)\nof inter-particle distances is then [cf. Eq. (11)]\n\u001a\n0\nfor r < \u03c3\npdilute (r) =\n(14)\n4\u03c0r2 /V for r \u2265 \u03c3.\nBecause of the Jacobian factor of 4\u03c0r2 , the most likely\nvalues of r are of the order of the largest possible r, which\nis L/2. This means that in a sample of inter-particle distances in the dilute hard sphere system, the large distance samples (ri = O(L/2)) are much more abundant\nthan the small distance samples (ri = O(\u03c3)). Thus, when\napproximating p(r) by a smooth function using the K-S\ntest, the long-distance part will be fitted very well, but\nthe short-distance behavior (r = O(\u03c3)) will not, because\nthe test used is sensitive to the typical values of r, which\nare O(L/2).\nThe conclusion that large distance values overwhelm\nthe smaller ones in which one is interested is valid beyond\nthe dilute hard sphere case, since the Jacobian factor in\nEq. (14) acts on long length scales and is therefore also\npresent in systems of higher density with non-negligible\ninteractions.\nA crude attempt at solving the large distance problem\nis to impose a cut-off rcut on the allowed values of r in the\nsample of inter-particle distances. This cut-off should be\nof the order of the distance over which g(r) differs from\none. But to determine that distance one has to measure g(r). Thus, one would have to guess a value of the\ncut-off distance and adjust it until g(r) approaches one\nwithin a certain accuracy for r < rcut . Unfortunately,\neven when the cut-off is chosen in this way, the results,\nalthough better than those in Fig. 1, are still not very\nimpressive, as Fig. 2 for the oxygen-oxygen radial distribution function shows with rcut set to 7.44 \u00c5(using\nagain Qcut = 0.6). One sees a lot of spurious oscillations in the smooth radial distribution functions, which\nare due to the high number of Fourier modes needed to\nfit the radial distribution function (m = 18 in this case).\nFurthermore, these oscillations do not even agree within\nthe 95% confidence interval with the histogram result,\ndeviating especially for small distances r. The explanation is that the Jacobian factor 4\u03c0r2 in Eq. (12) is still\npresent within the restricted sample r < rcut , and causes\nthe peaks at larger r values to be fitted better than the\npeaks at smaller r values.\n\n2.\n\nOvercoming over-representation through resampling\n\nTo remove the troublesome Jacobian factor in Eqs. (11)\nand (12) altogether, one can resample the inter-particle\n\n\f6\n4\n\n1\n\nhistogram result\ncut-off Berg-Harris method\n\n3.5\n\n0.8\n\n3\n\n0.6\n\n2\n\nFm\n\ngOO\n\n2.5\n\n0.4\n\n1.5\n1\n\n0.2\n\n0.5\n0\n\nBerg-Harris cdf\nresampled Berg-Harris cdf\n\n2\n\n3\n\n4\n\n5\n\n6\n\n0\n\n7\n\n2\n\n4\n\n6\n\n8\n\nr\n\n10\n\n12\n\nr\n\nFIG. 2: Result for gOO of using a cut-off in the straightforward\nBerg-Harris smoothing, i.e., with the distance data restricted\nto r < rcut = 7.44 \u00c5. For comparison, the results from the histogram method are also shown (with error bars representing\n95% confidence intervals shown at selected points).\n\nFIG. 3: The resampled and the standard Berg-Harris cumulative distributions associated with the radial distribution function gOO of the discrete water model.\n\nwith\ndistances found in the simulation. The idea is to draw\nfrom the original sample of distances, {ri } such that\nsmaller values of r are more likely than larger values by\nintroducing a relative bias weight w(ri ) for each distance\nri in the sample to construct a new, resampled set {r\u0303i }.25\nGiven that the probability densities of the original sample\npoints is p(r) = 4\u03c0r2 g(r)/V [cf. Eq. (11)], and provided\nthat subsequent resampled data points are chosen independently with weight w(ri ), the probability density of\nthe resampled points is given by\np\u0303(r) = k \u22121 w(r)p(r) = z \u22121 r2 w(r)g(r),\n(15)\nR\nwhere k = w(r)p(r) dr and z = kV /(4\u03c0) are constants.\nNote that z may be determined from\nZ\nV\nV\np(r)w(r)dr =\nhwi,\n(16)\nz=\n4\u03c0\n4\u03c0\nwhich may be approximated by the average of the weight\nover the samples:\nn\n\n1X\nhwi \u2248\nw(ri ).\nn i=1\n\n(17)\n\nIn the application to the radial distribution functions below, we also obtained hwi from a numerical integration\nusing the biased analytic approximation for p\u0303, the result\nof which differed from that given by the simpler expression in Eq. (17) by less than 0.1%.\nThe simplest way to counter the Jacobian factor 4\u03c0r2\nin Eq. (15) is to choose a weight\nw(r) =\n\n1\n,\nr2\n\n(18)\n\nwhich gives\ng(r) = z p\u0303(r),\n\n(19)\n\nn\n\nz\u2248\n\n4\u03c0 X 1\n.\nV n i=1 ri2\n\n(20)\n\nIn detail, the resampling leading to data with a probability density p\u0303 can be performed as follows: Given the\noriginal set {ri } one determines the weight for each data\npoint as\nwi = w(ri ) =\n\n1\n.\nri2\n\n(21)\n\nOne also determines the maximum weight,\nwmax = max wi\ni=1...n\n\n(22)\n\nto convert the weights into probabilities\npi =\n\nwi\n,\nwmax\n\n(23)\n\nwhich, by construction, lie between 0 and 1. Next, one\ntakes one of the original sample points ri at random (with\nequal weight), draws a random number \u03be uniformly from\nthe interval [0,1] and if \u03be < pi , one adds ri to the resampled data set {r\u0303i }. The procedure is repeated until\nenough resampled points have been gathered. There is\nsome choice into what number of resampled points is to\nbe taken. In our implementation, the number of resampled points is chosen to be the same as the number of\npoints in the original sample.\nNote that Eq. (19) shows that the resampled probability density p\u0303 and the radial distribution function g\nare proportional to one another. Since g approaches\none for large r, the large values of r are no longer overrepresented in p\u0303.\nFor the resampled data {r\u0303i }, one can use the BergHarris smoothing method of Sec. III A to obtain a smooth\n\n\f7\n4\n\n1\n\nhistogram result\nbiased analytic\n\n3.5\n\nF\n\n0\n\n3\ngOO\n\n2.5\n2\n\nf 1+ f 2+ f 3\n\n0.2\n\n1.5\n\nf 1+ f 2\n\n1\n0.5\n0\n\n2.5\n\n3\n\n3.5\n\n4\nr\n\n4.5\n\n5\n\n5.5\n\n6\n\nFIG. 4: The radial distribution function gOO of the discrete water model, using the resampled smoothing method\ndescribed. For comparison, the results from the histogram\nmethod are also shown (with error bars representing 95% confidence intervals at selected points).\n\napproximation to p\u0303. Fig. 3 shows the effect of resampling\non the cumulative distribution functions associated with\ngOO of the water model, using Qcut = 0.6. It is evident\nthat the small-r tail of the unweighted (Berg-Harris) cumulative distribution is much enhanced in the resampled\ncumulative distribution, and therefore more relevant to\nthe K-S test. Note that we have plotted only the fits,\nand not the empirical cumulative distributions, because\nthe fits are hard to distinguish from the empirical cumulative distributions. The differences are easier to see in\nthe associated radial distributions, which are plotted in\nFig. 4. In contrast to Fig. 2, the smooth approximation\nnow follows the result of the histogram within error bars\nfor the whole range of r values. But like in Fig. 2, the\nsupposedly smooth gOO (r) exhibits fast oscillatory behavior within those error bars. This oscillatory behavior\nwill be addressed next.\n\nB.\n\nHard-to-fit distribution functions\n1.\n\n0\n\nf1\n\na1 a2 a3a4\n\nr\n\na5\n\nFIG. 5: Illustration of a piecewise approximation F0 to the\ncumulative distribution. The function F0 (the solid line) is\nlinear between the split points a1 , . . . a5 (indicated by the\ndash vertical lines). The function increases by an amount\nf\u03bc between split points a\u03bc and a\u03bc+1 . The values of a\u03bc and\nf\u03bc used in this sketch roughly correspond to the piecewise\nanalytic fit for the oxygen-oxygen radial distribution function,\nwhich requires k = 4 intervals to achieve convergence.\n\nIt is conceivable that there are expansions other than\nthe Fourier expansion that are more suitable for describing a sharply increasing function followed by a more moderate behavior. However, it is not clear at present what\nthis specialized expansion should be. Therefore, a systematic and generic way will now be presented which\navoids high-frequency modes in parts of g(r) that do not\nrequire them. This will also make the method more generally applicable to discontinuous and other hard-to-fit\ndensities.\nWe note that in the following section, the resampling\nexplained in the previous section is supposed to have been\nperformed on the data already, and that the resampled\ndata have been sorted (r\u0303i \u2264 r\u0303i+1 ). For notational convenience, the tildes on r, p and F are omitted below.\n\n2.\n\nResolving the oscillation problem using a piecewise\napproach\n\nUnphysical oscillations\n\nIt is hard to reconcile the aim of having a smooth approximation to the radial distribution functions and the\nlarge number of Fourier modes needed to approximate\nthe shape of g(r), which starts out as a very flat function\nat small r, then increases sharply, reaches a maximum not\nfar beyond this sharp rise, and then decays on a larger\nscale to 1 in an oscillatory fashion. The peculiar shape\nof g(r) leads to the oscillatory behavior seen in Figures 2\nand 4. Even when the oscillations lie within error bars\nof the histogram results, they reintroduce a remnant of\nthe noise similar in magnitude to that present in the histograms that one is trying to avoid.\n\nThe decomposition of F\u0304 in Eq. (7) can be adjusted\nto incorporate hard-to-fit radial distributions by allowing\nthe Fourier decomposition to be different on sub-intervals\nwithin the total interval [r1 , rn ]. Let the full interval be\ndivided into k sub-intervals [a1 , a2 ], [a2 , a3 ], [a3 , a4 ], . . . ,\n[ak , ak+1 ], where a1 = r1 and ak+1 = rn . The intervals\nwill be labelled by a Greek index, which can run from 1 to\nk. How to choose the points a\u03bc (where \u03bc = 2 . . . k, with\na1 = r1 fixed) will be discussed later. Different intervals\ncan have different numbers of samples that fall within\nits range. The fraction of the samples that fall within a\ngiven interval \u03bc is denoted by f\u03bc .\nOn each sub-interval, F\u0304 (r) is approximated by a linear\n\n\f8\n4\n\nwhere\n\nhistogram result\npiecewise analytic\n\n3.5\n\nF\u0304\u03bc (r) = f\u03bc\u22121 [F\u0304 (r) \u2212 F\u0304 (a\u03bc )].\n\n3\ngOO\n\n2.5\n2\n1.5\n1\n0.5\n0\n\n2.5\n\n3\n\n3.5\n\n4\nr\n\n4.5\n\n5\n\n5.5\n\n6\n\nFIG. 6: The radial distribution function gOO of the discrete\nwater model, using the first piecewise resampled smoothing\nmethod described in Sec. V B 2. For comparison, the results\nfrom the histogram method are also shown (error bars were\nomitted to make the comparison clearer).\n\n(30)\n\nThe function F\u0304\u03bc (r) is the conditional empirical cumulative probability distribution function for data points\nwithin interval \u03bc. Eq. (27) represents a piecewise analytic\napproximation to the cumulative distribution. Since the\nFourier modes form a complete orthonormal basis, the\napproximation becomes exact as m\u03bc \u2192 \u221e for all \u03bc. As\nbefore, however, the m\u03bc should not become too large\nto avoid spurious oscillations, which only amounts to fitting the noise. One therefore defines a maximum number\nmmax of Fourier modes allowed in each sub-interval and\nsub-divides intervals if the maximum number of modes is\nnot sufficient for convergence, as determined by the K-S\ntest.\nThe division of the original interval is chosen dynamically as follows:\n1. Start with one interval;\n2. Increase m until Q > Qcut ;\n\npart and a truncated Fourier transform of the remainder.\nAnalogously to Eq. (8), the linear part in interval \u03bc is\ngiven by\n\n3. If m exceeds mmax , find the most deviant point a\naccording to the K-S test;\n\nr \u2212 a\u03bc\n.\nF0\u03bc (r) =\na\u03bc+1 \u2212 a\u03bc\n\n5. Repeat for the conditional distribution for each interval left and right of a.\n\n(24)\n\nNote that F0\u03bc ranges from 0 to 1 in the interval \u03bc. The\npiecewise linear approximation to F\u0304 for r in interval \u03bc is\nthen\nF0 (r) = F\u0304 (a\u03bc ) + f\u03bc F0\u03bc (r).\n\n(25)\n\nwhere it should be noted that\nF\u0304 (a\u03bc ) =\n\n\u03bc\u22121\nX\n\nf\u03bd .\n\n(26)\n\n\u03bd=1\n\nAn example of such F0 (r) is shown in Fig. 5, based on\ndata from the oxygen-oxygen radial distribution function\nin the water model (as explained below). Approximations\nto F\u0304 beyond F0 are found by adding Fourier modes for\neach interval,\nF\u0304 (r) \u2248 F0 (r) +\n\nk\nX\n\u03bc=1\n\nf\u03bc \u03c7\u03bc (r)\n\nm\u03bc\nX\n\nd\u03bcj sin[j\u03c0F0\u03bc (r)]. (27)\n\nj=1\n\nHere, \u03c7\u03bc is the characteristic function on interval \u03bc, i.e.,\n\u001a\n1 for a\u03bc < r < a\u03bc+1\n\u03c7\u03bc (r) =\n(28)\n0 otherwise,\nand d\u03bcj is given by\nZ a\u03bc+1\n2\nd\u03bcj =\n[F\u0304\u03bc (r) \u2212 F0\u03bc (r)] sin[j\u03c0F0\u03bc (r)],\na\u03bc+1 \u2212 a\u03bc a\u03bc\n(29)\n\n4. Split the interval in two at the point a;\n\nBecause the procedure is recursive, in each step the original one-interval procedure is used, which one exception:\nthe allowable value of Q may be set to a lower value in a\nsub-interval, since there are fewer points in the interval\nand therefore the interval carries less statistical weight.\nWe have not found a unique, statistically controlled way\nto adjust the Qcut for sub-intervals, but found heuristically that scaling the Qcut for interval \u03bc by f\u03bc avoids fitting the noise and leads to a satisfactory overall Q value.\nThe recursive, multi-interval procedure is found to\ngreatly speed up the convergence of the approximation\nscheme, leading to much lower m\u03bc , and thus fewer oscillations. It should be stressed that splitting at the most\ndeviant point a in the K-S test is found to be essential\nhere: choosing a different splitting point does not improve the convergence because the most deviant point\nis then still difficult to fit and the Q value for the subinterval containing the most deviant point remains the\nsame.\nOnce the approximation in Eq. (27) has been obtained,\nthe probability density is given by\n\uf8f1\n\uf8fc\nm\u03bc\n\uf8f2\n\uf8fd\nX\nf\u03bc\np(r) \u2248\n1+\u03c0\nd\u03bcj j cos[j\u03c0F0\u03bc (r)]\n(31)\n\uf8fe\na\u03bc+1 \u2212 a\u03bc \uf8f3\nj=1\nwhere \u03bc is such that r \u2208 [a\u03bc , a\u03bc+1 ].\nThe results of applying the piecewise procedure to the\ngOO of the water model are shown in Fig. 6 (remembering that g = zp), with mmax = 14 and the initial Qcut set\n\n\f9\n(b)\n\nhistogram result\nsmoothed piecewise analytic\n\n(c)\n\nhistogram result\nsmoothed piecewise analytic\n\n2.5\n\n1.2\n1\ngHH\n\n1.5\n1\n\n3.5\n\n4\n\n4.5\n\n5\n\n5.5\n\n6\n\n0.6\n0.2\n0\n\n0\n3\n\n0.8\n0.4\n\n0.5\n2.5\n\nhistogram result\nsmoothed piecewise analytic\n\n1.4\n\n2\ngOH\n\ngOO\n\n(a)\n4.5\n4\n3.5\n3\n2.5\n2\n1.5\n1\n0.5\n0\n\n2\n\n2.5\n\n3\n\nr\n\n3.5\n\n4\n\n4.5\n\n5\n\n5.5\n\n6\n\n1\n\n2\n\nr\n\n3\n\n4\n\n5\n\n6\n\nr\n\nFIG. 7: The resampled, piecewise-analytic method applied to the radial distribution functions gOO (panel a), gOH (panel b)\nand gHH (panel c) of the discretized water model, using the patched piecewise resampled smoothing method. For comparison,\nthe results from the histogram method are also shown, while error bars were omitted for clarity.\n\nto 0.6. While the method now works better than without\nthe piecewise approach, it has one drawback: the derivative of the approximate cumulative distribution function,\nwhich gives g(r), need not be a smooth function across\nthe different intervals. As a consequence, the result in\nFig. 6 shows artificial discontinuities. These discontinuities at the boundaries of the intervals fall within the 95%\nconfidence intervals (not shown in Fig. 6).\n\n3.\n\nDealing with spurious discontinuities\n\nProvided the underlying probability distribution of the\nsamples is continuous, the spurious discontinuities that\nare present in the piecewise-analytic fit will get smaller\nas the number of sample points increases. Nevertheless,\nfor cases with poor statistics, one would like to have an\napproach that gives a continuous piecewise analytic fit to\nthe distribution. In fact, for some applications, having a\n\n4\n\nhistogram result\nsplined histogram\nsmoothed piecewise analytic\n\n3.5\n3\n\ncontinuous radial distribution function is essential, such\nas for Brownian simulations that take the potential of\nmean force as input. Even though the discontinuities are\nwithin the statistical noise, they would lead to sudden,\nunphysical changes in energy in such applications.\nThere are many ways to get a continuous curve out\nof the discontinuous one, but it should be remembered\nthat one is working within the statistical noise. We can\ntherefore choose any method as long as the \"patch\" is\nstill statistically reasonable. To determine the statistical\nsuitability, one can once again use the K-S test on the\npatched fit.\nWe have chosen the following simple procedure: We\napply a quadratic patch function around each discontinuity at a\u03bc ,\n\u001a\n\nb\u03bc [r \u2212 (a\u03bc \u2212 c\u03bc )]2 if r \u2208 [a\u03bc \u2212 c\u03bc , a\u03bc ]\n.\nb\u03bc [r \u2212 (a\u03bc + c\u03bc )]2 if r \u2208 [a\u03bc , a\u03bc + c\u03bc ]\n(32)\nThe width c\u03bc of the patch is adjustable, while the prefactor b\u03bc follows from\nPthe requirement that the cumulative\ndistribution F + \u03bc F\u03bcpatch has a continuous derivative\nat r = a\u03bc . Provided the different patches do not overlap,\nthis leads to a value of\nF\u03bcpatch (r)\n\n=\n\ngOO\n\n2.5\n\nb\u03bc =\n\n2\n\n\u2206p\n.\n4c\u03bc\n\n(33)\n\n1.5\n1\n\nwhere \u2206p is the height of the jump in the unpatched\ndistribution function.\n\n0.5\n0\n\n2.5\n\n3\n\n3.5\n\n4\n\n4.5\n\n5\n\n5.5\n\n6\n\nr\n\nFIG. 8: Comparison between the radial distribution function\ngOO of the discrete water model obtained using the resampled piece-wise analytic method, and using a spline fit to the\nhistogram results (error bars were omitted to make the comparison clearer).\n\nInitially, each width c\u03bc is set equal to half the minimum interval size on either side of the corresponding split\npoint a\u03bc to avoid overlap between the patches. The Q\nvalue of the patched distribution is then determined, and\nif it is not smaller than the Q value for the unpatched\ndistribution, the patch is accepted. Otherwise, the width\nof the patch is reduced by a factor of two, until the Q\nvalue is acceptable.26 It will be demonstrated below that\nthis solves the problem of spurious oscillations and discontinuities.\n\n\f10\n(b)\n6\n\nhistogram result\nsmoothed piecewise analytic\n\n(c)\n\nhistogram result\nsmoothed piecewise analytic\n\n5\n\n\u03a6HH/kBT\n\n4\n\u03a6OH/kBT\n\n\u03a6OO/kBT\n\n(a)\n3.5\n3\n2.5\n2\n1.5\n1\n0.5\n0\n-0.5\n-1\n-1.5\n\n3\n2\n1\n0\n\n2.5\n\n3\n\n3.5\n\n4\n\n4.5\n\n5\n\n5.5\n\n6\n\n-1\n\n2\n\n2.5\n\n3\n\nr\n\n3.5\n\n4\n\n4.5\n\n5\n\n5.5\n\n6\n\n5\n4.5\n4\n3.5\n3\n2.5\n2\n1.5\n1\n0.5\n0\n-0.5\n\nhistogram result\nsmoothed piecewise analytic\n\n1\n\n2\n\n3\n\n4\n\nr\n\n5\n\n6\n\nr\n\nFIG. 9: The resampled, piecewise-analytic method applied to the potentials of mean force \u03a6OO (panel a), \u03a6OH (panel b) and\n\u03a6HH (panel c) of the discretized water model. For comparison, the results from the histogram method are also shown.\n\nVI.\n\nFinal results\n\nFigs. 7 show the result of the resampled, piecewise procedure for the three radial distribution functions of the\nwater model, gOO , gOH and gHH , with mmax = 14 and\nQcut = 0.6. It is clear that the piecewise analytic fit\nis now smoother than the histogram, hardly shows any\noscillations and is continuous. Furthermore, while error\nbars were omitted in Fig. 7 for clarity, it was found that\nthe histogram and the patched, piecewise analytic results\nare in mutual agreement within the 95% confidence intervals.\nIt may be argued that plotting the histograms using\nbars is an unfair way of representing the histogram results. One often takes the histograms and applies a cubic\nspline fit19 to the results, which makes the graph seem\nsmoother. There is of course no a priori reason why the\nsplined histogram should represent the radial distribution\nfunction better. For this reason, we have shown only 'unsplined' histograms so far. The comparison between the\nhistograms and smooth approximations in these curves\nshould really only be done at the mid-point of the histogram bins. Now that the piecewise analytic smoothing\napproach is fully developed, however, it is interesting to\nsee how it compares to a smoothed spline fit of the histogram results. Figure 8 shows a plot of these two types\nof smooth results for gOO . The bin size for the histograms\nhas been chosen such that the first peak of the radial distribution is well resolved. One sees that the cubic spline\nfit does a reasonable job for the first peak, but that in\nthe second peak in the radial distribution function the\nspline fit is still noisy, while the statistically controlled\npiecewise analytic result is not. Thus, the splines cannot\nfix the roughness of the histogram method, at least not\nwhen bin sizes are uniform.\nTo show how the piecewise analytic method performs\nfor potentials of mean force, the smooth potentials of\nmean force between the different species corresponding to\nthe radial distributions in Figs. 7 [cf. Eq. (13)], have been\nplotted in Figs. 9. The results from the piecewise analytic\nmethod are considerably smoother than the histogram\nresults, but still exhibit some roughness since they were\nbased only on four configurations.\n\nFURTHER APPLICATIONS\n\nThe piecewise approximation method is not specific to\nradial distribution functions, but can help to fit any probability density that is hard to fit with a truncated Fourier\nseries. Below, we will give several examples of such densities and show the advantages of using the piecewise analytical approximation method.\n\nA.\n\nA discontinuous density\n\nConsider a random variable r with a distribution p\ngiven by\n\uf8f1\n0 if r < 0\n\uf8f4\n\uf8f4\n\uf8f2\n1 if 0 < r < 12\np(r) =\n.\n(34)\n1\nif 12 < r < 32\n\uf8f4\n\uf8f4\n\uf8f3 2\n3\n0 if r > 2\n\nhistogram result\nBerg-Harris\npiecewise analytic\n\n1\n0.9\n0.8\np\n\nC.\n\n0.7\n0.6\n0.5\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\nr\n\n1\n\n1.2\n\n1.4\n\n1.6\n\nFIG. 10: The piecewise-analytic method applied to 50, 000\nsamples drawn from the discontinuous distribution of\nSec. VI A. Also shown for comparison are the results from\nthe histogram method and the Berg-Harris method. For clarity, error-bars on the smoothing methods and the histogram\nhave been omitted.\n\n\f11\n0.4\n\nhistogram result\nexact distribution\npiecewise analytic\n\n0.35\n\n0.1\n\n0.3\np/pexact-1\n\np\n\n0.25\n0.2\n0.15\n\n0\n\n-0.1\n\n0.05\n-6\n\n-4\n\n-2\n\n0\nr\n\n2\n\n4\n\n6\n\n8\n\n-0.15\n-10 -8\n\n10\n\nFIG. 11: The piecewise-analytic method applied to 50, 000\nsamples drawn from the Cauchy distribution (cf. Sec. VI B).\nFor comparison, the results from the histogram method and\nthe exact result are also shown. For clarity, error-bars have\nbeen omitted. Because the piece-wise analytic result is hard to\ndistinguish from the exact distribution, the difference between\nthe two is plotted in Fig. 12.\n\nNote that within the domain of this function [0, 23 ], there\nis a discontinuity at r = 12 . Discontinuities are very\npoorly represented by truncated Fourier series.27\nFrom the above distribution, 50,000 samples were\ndrawn and used as input to the piecewise analytic approximation (with mmax = 14 and the initial Qcut = 0.6), as\nwell as to the one-interval analytic approximation (with\nthe same Qcut = 0.6 and unrestricted mmax ) and the\nhistogram method. The results are shown in Fig. 10.\nOne clearly sees the trouble that the Berg-Harris oneinterval approximation has in capturing the discontinuity, while the histogram is very noisy. The piecewise analytic expansion, on the other hand, beautifully captures\nthe whole distribution; the automated procedure divides\nthe interval [0, 23 ] in two at r = 12 and then needs zero\nFourier modes to approximate the separate pieces.\nB.\n\n0.05\n\n-0.05\n\n0.1\n0\n-10 -8\n\nBerg-Harris error\npiecewise analytic error\n\n0.15\n\n-6\n\n-4\n\n-2\n\n0\nr\n\n2\n\n4\n\n6\n\n8\n\n10\n\nFIG. 12: The error in the piecewise-analytic method applied to 50, 000 samples drawn from the Cauchy distribution\n(cf. Sec. VI B) as compared to the exact form in Eq. (35). The\nerror is here defined as the deviation from the exact result.\nFor comparison, the errors in the Berg-Harris method are also\nshown.\n\nNot plotted in Fig. 11 were the results of the original\nBerg-Harris method, which, surprisingly, are so similar to\nthe piecewise approach that they would be hard to make\nout in the figure. The only statistically significant difference between the two results is apparent in the height of\nthe maximum, which the Berg-Harris fit slightly underestimates.\nThe success of both methods is illustrated further in\nFig. 12, in which the errors in the piecewise and the oneinterval results are compared; the piecewise analytic error is overall slightly smaller than that of the Berg-Harris\nmethod, but not by much. This success seems to contradict Berg and Harris' warning against using the smoothing method for densities with long tails. It is possible the\nrelatively high quality of the fit in the simple approach is\ndue to the symmetric nature of the Cauchy density and\nits relative lack of structure.\nA more stringent test of the method applied to longtailed distributions will be presented next.\n\nThe standard Cauchy distribution\n\nAccording to Berg and Harris,4 the original smoothing\nmethod has trouble with densities with long tails. It\nis therefore interesting to see if the piecewise approach\nhelps for these kinds of densities as well. As an example,\nwe consider the standard Cauchy distribution\np(r) =\n\n1\n.\n\u03c0(1 + r2 )\n\n(35)\n\nFrom this distribution, 50,000 samples were randomly\ndrawn and used in the piece-wise approach (with mmax =\n14 and the initial Qcut = 0.6). The results are contrasted\nwith those of the histogram in Fig. 11. The piecewise\nsmooth approximation performs so well that it can hardly\nbe distinguished from the Cauchy distribution.\n\nC.\n\nFirst arrival time distribution of a diffusing\nparticle to a sphere\n\nConsider a particle undergoing diffusion, starting at a\ndistance R0 from the origin, i.e. anywhere on a sphere\nof radius R0 . The distribution function p(r, t) of the\ndiffusing particle satisfies \u2202t p = D\u22072 p, where D the\nself-diffusion constant. Investigating the time t required\nto arrive anywhere on the surface of a sphere of radius\nRmin for the first time is a classic case of a first passage\nproblem.28 Such problems have applications in the rate\nof molecules finding each other in a solution, and are a\nmajor determining factor of reaction rates in diffusion\nlimited reactions.\n\n\f12\nhistogram result\nexact distribution\npiecewise analytic\n\n0.012\n0.01\n\n1\np/pexact-1\n\np\n\n0.008\n0.006\n0.004\n\n0.5\n0\n-0.5\n\n0.002\n0\n\nBerg-Harris error\npiecewise analytic error\n\n1.5\n\n0\n\n50\n\n100\nt\n\n150\n\n200\n\n-1\n\n200\n\n600\n\n1000\nt\n\n1400\n\n1800\n\nFIG. 13: The piecewise-analytic method applied to 100, 000\nsamples drawn from the first passage time distribution of\nSec. VI C. Also shown for comparison are the results from\nthe histogram method and the Berg-Harris method, as well\nas the exact result.\n\nFIG. 14: The relative error in the piecewise-analytic method\napplied to 100, 000 samples drawn from the first passage time\ndistribution of Sec. VI C, compared to the relative error in\nthe Berg-Harris method. The errors are defined here as the\ndeviation from the exact result.\n\nIt turns out that the first arrival times are distributed\naccording to29\n\u0012\n\u0013\nx2\nx\nexp \u2212\n,\n(36)\np(t) = \u221a\n4Dt\n4\u03c0Dt3\n\n{ti } are available from numerical simulation, the piecewise approach would give the best description of p(t):\none that is less noisy than the histogram construction\nand with fewer oscillations than the one-interval BergHarris method.\n\nwhere x = R0 \u2212 Rmin . This distribution function has\nboth short time structure and a long tail.\nFrom the distribution in Eq. (36), 100,000 samples\nwere randomly drawn, with parameters set at D = 1,\nRmin = 1 (these choices set the time and length units)\nand R0 = 10Rmin . The piece-wise approach was used to\nobtain an estimate of the probability distribution (with\nmmax = 14 and Qcut = 0.6), as well as the one-interval\nanalytic approximation (Qcut = 0.6 and unrestricted\nmmax ) and the histogram method. The results are compared in Figs. 13 and 14.\nWhile all methods work to some extent, the histogram\nmethod would have to be tailored to the function in question in order to be useful, with differently sized bins for\ndifferent values of t. The Berg-Harris method works reasonably well without subdivisions, but exhibits fast oscillations in the tails of the density, as becomes very apparent from Fig. 14. The appearance of oscillations is\nnot surprising when one considers that m = 390 Fourier\nmodes were needed for the Berg-Harris fit! The piecewise analytic result does not exhibit fast oscillations in\nthe tail. Furthermore, the piecewise fit only required a\ntotal of 28 Fourier modes distributed over 8 intervals. Although the piecewise result does have some modulation\nwithin the error bars, we have checked that almost all of\nthese disappear when one takes 10 times as many data\npoints. At that level of statistics, the Berg-Harris results\nstill have oscillations in the tails, and still require over\n350 Fourier modes.\nWhen the analytical form of p(t) is not known, such as\nfor absorption in non-spherical geometries, but samples\n\nVII.\n\nCONCLUSIONS\n\nIn this paper, a method to obtain smooth analytical estimates of probability densities, radial distribution functions and potentials of mean force in a statistically controlled fashion without using histograms was\npresented. This method only uses direct samples of data\n(distance samples in the case of radial distribution functions). Since this method is expected to be generally useful, we have made our implementation, coded in c and\nc++, available on the web.30\nWhile the method is based on the Berg-Harris method,\nthe statistical criterion used in that method is most sensitive to the most common samples, which for radial distribution functions are not the ones of physical interest. To\nmake the method work for radial distribution functions,\na weighted resampling of this data was required. Spurious oscillations, allowed by the statistical noise, were\neliminated using a piecewise approach. In addition, one\ncan optionally patch the piecewise-analytic form to avoid\ndiscontinuities within the errors, if desired. The resampled, piecewise smoothing method was demonstrated on\ndata from event-driven DMD simulations of water, and\nproved to give a much smoother result than the histogram\nmethod.\nIf the purpose of a simulation is just to get a good\nsmooth result for the radial distribution functions of a\nwater model, one could use the histogram method with\nlonger simulation runs to reduce the statistical uncer-\n\n\f13\n16\n\nBerg-Harris error distribution\npiecewise analytic error distribution\n\n14\n\ndistribution\n\n12\n10\n8\n6\n4\n2\n0\n\n-0.1\n\n-0.05\n\n0\nerror\n\n0.05\n\n0.1\n\nFIG. 15: The distribution of the relative errors in the\npiecewise-analytic method applied to 100, 000 samples drawn\nfrom the first passage time distribution of Sec. VI C, compared to the distribution of the relative error in the BergHarris method. The errors are defined here as the deviation\nfrom the exact result. The points with error bars are found\nby applying the piecewise analytic method to the deviations\nplotted in Fig. 14 (with errors from the jackknife procedure),\nwhile the drawn lines are fits to Gaussians with a zero mean.\n\ntainties to some predetermined limit. However, the histogram would still be biased and known just at a lattice\nof points if a uniform bin size is used. To get a smoother\nand less biased curve from the histogram, one would also\nhave to decrease the bin size by hand. The piecewise\nanalytic method makes such tuning unnecessary. The\nmethod also make much longer runs unnecessary, since\nwhat appears to be very poor statistics for the histogram\nmethod turns out to be quite reasonable statistics for the\npiecewise analytic method. Remember that the same set\nof inter-atom distance are used in both methods. Apparently, there is much more statistics in the sample than\nthe histogram is using (something that Berg and Harris\nalso noticed4 ).\nFor the test case considered here, the computational\ncost of doing longer runs is not that large, so the advantages of the piecewise analytic method may seem to be\nnice but not necessary. In other applications, however,\nsuch as in studies of the distribution of water molecules\nnear a polymer or a bio-molecule (or near one of their\npolymer units), better statistical information is costly\nto obtain because such systems are not only computationally more demanding, but there are far less samples\navailable in a single configuration since only the water\nmolecules near the polymer or the bio-molecule are involved. The simulation run times would have to be much\nlarger to compensate for this poor statistics, if histograms\nare used. In such cases, the piecewise analytic method\nis expected to be advantageous since it appears able to\nuse more of the information present in the inter-particle\ndistance sample.\nThe piecewise analytic method yields a smooth approx-\n\nimation to the probability density function, and the deviations of the empirical distribution from this smooth\ncurve are supposed to be due to statistical noise. If this is\ntrue and the methods are unbiased, then for large enough\nsample size n, one would expect the distribution of errors\nin the probability density functions to be Gaussian with\na zero mean. To test whether this is the case, the probability densities of the relative errors plotted in Fig. 14\nwere determined, both for the Berg-Harris and for the\npiecewise analytic method.31 The results are shown in\nFig. 15. Within statistical uncertainty, both distributions were found to be unbiased. Furthermore, for the\npiecewise analytic results, the error densities are roughly\nGaussian. The errors from the Berg-Harris method, on\nthe other hand, seem to show deviations from Gaussian\nbehavior. The non-Gaussian nature of the errors of the\nBerg-Harris method might be due to the fact that the\nsample noise is fitted too closely since a large number\nof Fourier modes are necessary, which means the distribution of errors follows the distribution of the finite\nsample-size errors rather than being truly random. The\nGaussian nature of the errors in the piecewise analytic\nmethod might be a confirmation that in the smooth approximation, enough Fourier modes have be taken into\naccount for the remainder to be due to a random statistical noise.\nOne of the nice features of the piecewise analytic\nmethod is that one does not have to choose a bin size\na priori, as one has to do in the histogram method. It is\nnonetheless true that within the smoothing method, one\nis to some extent free to choose the cut-off value Qcut\nof the 'quality' parameter Q and the maximum number\nmmax of basis functions allowed in the expansion of each\ninterval. Note that both Qcut and mmax are dimensionless numbers, and do not contain physical parameters, in\ncontrast to the bin size parameter required in the histogram approach. Setting Qcut too low may result in a\nbad fit to the data, while setting mmax too large may\nresult in noise fitting and artificial oscillations. We have\nfound that Qcut \u2248 0.6 and mmax \u2248 14 are reasonable\nchoices, and these values were used in all the applications presented above.\nThere is also some freedom in the choice of the set of\nbasis functions, as long as they form a complete set. The\nFourier basis used here is convenient and familiar, but\nothers are possible. For instance, in Ref. 5, a Chebyshev\nexpansion was used. This expansion was chosen over\nthe Fourier expansion because it gave fewer oscillations.\nThe piecewise approach present in this paper, however,\nresolves the oscillation problem as well, and is expected to\nbe less sensitive to the choice of basis functions than the\noriginal Berg-Harris method. Furthermore, the method\nwas shown to also be applicable to other potentials of\nmean force and other probability densities with a hardto-fit character.\n\n\f14\nAcknowledgments\n\nences and Engineering Research Council of Canada.\n\nWe would like to thank Prof. P. N. Roy for useful discussions. This work was supported by the National Sci-\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\nD. A. McQuarrie, Statistical Mechanics (Harper Collins\nPublishers, 1976).\nD. Frenkel and B. Smit, Understanding molecular simulation: From Algorithms to Applications (Academic Press,\nSan Diego, 2002).\nH. J. C. Berendsen, Simulating the Physical World: Hierarchical Modeling from Quantum Mechanics to Fluid\nDynamics (Cambridge University Press, Cambridge, UK,\n2007).\nB. A. Berg and R. C. Harris, Comp. Phys. Comm. 179,\n443 (2008).\nR. van Zon, L. Hern\u00e1ndez de la Pe\u00f1a, G. H. Peslherbe, and\nJ. Schofield, Phys. Rev. E 78, 041103 (2008).\nT. Gericke, P. W\u00fcrtz, D. Reitz, T. Langen, and H. Ott,\nNature Physics 4, 949 (2008).\nL. Mones, P. Kulh\u00e1nek, I. Simon, A. Laio, and M. Fuxreiter, J. Phys. Chem. B 113, 7867 (2009).\nY. Liu and T. Ichiye, J. Phys. Chem. 100, 2723 (1996).\nA. Chandra and T. Ichiye, J. Chem. Phys. 111, 2701\n(1999).\nM.-L. Tan, J. T. Fisher, A. Chandra, B. R. Brooks, and\nT. Ichiye, Chem. Phys. Lett. 376, 646 (2003).\nC. J. Fennell and J. D. Gezelter, J. Chem. Phys. 120, 9175\n(2004).\nR. van Zon and J. Schofield, J. Chem. Phys. 128, 154119\n(2008).\nL. Hern\u00e1ndez de la Pe\u00f1a, R. van Zon, J. Schofield, and\nS. B. Opps, J. Chem. Phys. 126, 074105 (2007).\nL. Hern\u00e1ndez de la Pe\u00f1a, R. van Zon, J. Schofield, and\nS. B. Opps, J. Chem. Phys. 126, 074106 (2007).\nR. van Zon and J. Schofield, J. Comp. Phys. 225, 145\n(2007).\nE. C. Cyr and S. D. Bond, J. Comput. Phys. 225, 714729\n(2007).\nA. B. Adib and C. Jarzynski, J. Chem. Phys. 122, 14114\n(2005).\nJ. E. Basner and C. Jarzynski, J. Phys. Chem. B 112,\n\n19\n\n20\n\n21\n22\n23\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n30\n31\n\n12722 (2008).\nW. H. Press, S. A. Teukolsky, W. T. Vetterling, and B. P.\nFlannery, Numerical Recipes in Fortran, The Art of Scientific Computing (Cambridge University Press, Cambridge,\nUK, 1992), 2nd ed.\nAlternatively, one can use other tests such as the Kuiper\ntest, but these are less convenient for the piecewise approach presented later, since they involve several \"hardto-fit\" points.\nM. A. Stephens, J. Royal Stat. Soc. B 32, 115 (1970).\nB. Efron, The Annals of Statistics 7, 1 (1979).\nH. R. K\u00fcnsch, The Annals of Statistics 17, 1217 (1989).\nAnother good explanation of the sensitivity of the K-S test\nto values near the median can be found in Ref. 19, Ch. 4,\nSec. 3.\nOne could imagine performing the reweighting at the level\nof K-S test instead, but this would modify the q statistic.\nThe problem is that it would then not be known what a\nreasonable testing criterion for this new q statistic should\nbe, or even whether it allows a simple formulation such as\nq > qcut .\nA procedure in which the piecewise Fourier series is restricted to be continuous across the interval boundaries\nwas also considered but found to lead to undesirable oscillations near discontinuities, reminiscent of the Gibbs\nphenomenon.27\nH. Jeffreys and B. S. Jeffreys, Methods of Mathematical\nPhysics (Cambridge University Press, Cambridge, UK,\n1956), 3rd ed.\nS. Redner, A Guide to First-Passage Processes (Cambridge\nUniversity Press, Cambridge, UK, 1991).\nThis is the Laplace inverse of Eq. (6.4.8) in Ref. 28.\nhttp://www.chem.utoronto.ca/ \u0303rzon/Code.html.\nThis analysis was also attempted for the deviations plotted in Fig. 12 but the error bars on the resulting distributions were too large to tell whether they are biased or\nnon-Gaussian.\n\n\f"}