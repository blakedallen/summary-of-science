{"id": "http://arxiv.org/abs/1004.0282v2", "guidislink": true, "updated": "2010-06-05T04:59:28Z", "updated_parsed": [2010, 6, 5, 4, 59, 28, 5, 156, 0], "published": "2010-04-02T04:23:10Z", "published_parsed": [2010, 4, 2, 4, 23, 10, 4, 92, 0], "title": "Six Little Squares and How Their Numbers Grow", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1004.0787%2C1004.4300%2C1004.4164%2C1004.1906%2C1004.2521%2C1004.2013%2C1004.2987%2C1004.5019%2C1004.5296%2C1004.1407%2C1004.0953%2C1004.0029%2C1004.2853%2C1004.3230%2C1004.4363%2C1004.4407%2C1004.3896%2C1004.5251%2C1004.3598%2C1004.4777%2C1004.0185%2C1004.5222%2C1004.0653%2C1004.1901%2C1004.1751%2C1004.2396%2C1004.2791%2C1004.1441%2C1004.2878%2C1004.0196%2C1004.0174%2C1004.0897%2C1004.0235%2C1004.2716%2C1004.0132%2C1004.5281%2C1004.4384%2C1004.2092%2C1004.0930%2C1004.1612%2C1004.4084%2C1004.1668%2C1004.5590%2C1004.0157%2C1004.1448%2C1004.3614%2C1004.4329%2C1004.0600%2C1004.0040%2C1004.2563%2C1004.0839%2C1004.1728%2C1004.4161%2C1004.1852%2C1004.5138%2C1004.0424%2C1004.0991%2C1004.2681%2C1004.0078%2C1004.1701%2C1004.0222%2C1004.4660%2C1004.4475%2C1004.1078%2C1004.2795%2C1004.3461%2C1004.4429%2C1004.1844%2C1004.5458%2C1004.0868%2C1004.4591%2C1004.3329%2C1004.0800%2C1004.3852%2C1004.3042%2C1004.4143%2C1004.4835%2C1004.2537%2C1004.2435%2C1004.0609%2C1004.0282%2C1004.3195%2C1004.0163%2C1004.5255%2C1004.2074%2C1004.5132%2C1004.2441%2C1004.3177%2C1004.0042%2C1004.0221%2C1004.3948%2C1004.1727%2C1004.2472%2C1004.4374%2C1004.1306%2C1004.3469%2C1004.5131%2C1004.4980%2C1004.0824%2C1004.1769%2C1004.2835&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Six Little Squares and How Their Numbers Grow"}, "summary": "We find the numbers of $3 \\times 3$ magic, semimagic, and magilatin squares,\nas functions either of the magic sum or of an upper bound on the entries in the\nsquare. Our results on magic and semimagic squares differ from previous ones in\nthat we require the entries in the square to be distinct from each other and we\nderive our results not by \\emph{ad hoc} reasoning but from the general\ngeometric and algebraic method of our paper \"An enumerative geometry for magic\nand magilatin labellings\". Here we illustrate that method with a detailed\nanalysis of $3\\times3$ squares.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1004.0787%2C1004.4300%2C1004.4164%2C1004.1906%2C1004.2521%2C1004.2013%2C1004.2987%2C1004.5019%2C1004.5296%2C1004.1407%2C1004.0953%2C1004.0029%2C1004.2853%2C1004.3230%2C1004.4363%2C1004.4407%2C1004.3896%2C1004.5251%2C1004.3598%2C1004.4777%2C1004.0185%2C1004.5222%2C1004.0653%2C1004.1901%2C1004.1751%2C1004.2396%2C1004.2791%2C1004.1441%2C1004.2878%2C1004.0196%2C1004.0174%2C1004.0897%2C1004.0235%2C1004.2716%2C1004.0132%2C1004.5281%2C1004.4384%2C1004.2092%2C1004.0930%2C1004.1612%2C1004.4084%2C1004.1668%2C1004.5590%2C1004.0157%2C1004.1448%2C1004.3614%2C1004.4329%2C1004.0600%2C1004.0040%2C1004.2563%2C1004.0839%2C1004.1728%2C1004.4161%2C1004.1852%2C1004.5138%2C1004.0424%2C1004.0991%2C1004.2681%2C1004.0078%2C1004.1701%2C1004.0222%2C1004.4660%2C1004.4475%2C1004.1078%2C1004.2795%2C1004.3461%2C1004.4429%2C1004.1844%2C1004.5458%2C1004.0868%2C1004.4591%2C1004.3329%2C1004.0800%2C1004.3852%2C1004.3042%2C1004.4143%2C1004.4835%2C1004.2537%2C1004.2435%2C1004.0609%2C1004.0282%2C1004.3195%2C1004.0163%2C1004.5255%2C1004.2074%2C1004.5132%2C1004.2441%2C1004.3177%2C1004.0042%2C1004.0221%2C1004.3948%2C1004.1727%2C1004.2472%2C1004.4374%2C1004.1306%2C1004.3469%2C1004.5131%2C1004.4980%2C1004.0824%2C1004.1769%2C1004.2835&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "We find the numbers of $3 \\times 3$ magic, semimagic, and magilatin squares,\nas functions either of the magic sum or of an upper bound on the entries in the\nsquare. Our results on magic and semimagic squares differ from previous ones in\nthat we require the entries in the square to be distinct from each other and we\nderive our results not by \\emph{ad hoc} reasoning but from the general\ngeometric and algebraic method of our paper \"An enumerative geometry for magic\nand magilatin labellings\". Here we illustrate that method with a detailed\nanalysis of $3\\times3$ squares."}, "authors": ["Matthias Beck", "Thomas Zaslavsky"], "author_detail": {"name": "Thomas Zaslavsky"}, "author": "Thomas Zaslavsky", "arxiv_comment": "39 pages", "links": [{"href": "http://arxiv.org/abs/1004.0282v2", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/1004.0282v2", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "math.CO", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "math.CO", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "Primary 05B15, Secondary 05A15, 52B20, 52C35", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/1004.0282v2", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/1004.0282v2", "journal_reference": "Journal of Integer Sequences 13 (2010), Article 10.6.2. MR 2659218\n  (2011j:05052). Zbl 1230.05062", "doi": null, "fulltext": "SIX LITTLE SQUARES AND HOW THEIR NUMBERS GROW\n\narXiv:1004.0282v2 [math.CO] 5 Jun 2010\n\nMATTHIAS BECK\nSAN FRANCISCO STATE UNIVERSITY\nAND THOMAS ZASLAVSKY\nBINGHAMTON UNIVERSITY (SUNY)\nAbstract. We find the numbers of 3 \u00d7 3 magic, semimagic, and magilatin squares, as\nfunctions either of the magic sum or of an upper bound on the entries in the square. Our\nresults on magic and semimagic squares differ from previous ones in that we require the\nentries in the square to be distinct from each other and we derive our results not by ad hoc\nreasoning but from the general geometric and algebraic method of our paper \"An enumerative geometry for magic and magilatin labellings\". Here we illustrate that method with a\ndetailed analysis of 3 \u00d7 3 squares.\n\nContents\n1. Introduction\n2. The technique\n2.1. General method\n2.2. How we apply the method\n2.3. Checks\n2.4. Feasibility\n2.5. Notation\n3. Magic squares of order 3\n3.1. Magic squares: Cubical count (by upper bound)\n3.1.1. Reduced magic squares\n3.2. Magic squares: Affine count (by magic sum)\n3.2.1. Reduced magic squares\n4. Semimagic squares of order 3\n4.1. Semimagic squares: Cubical count (by upper bound)\n4.1.1. Counting the weak squares\n4.1.2. Reduction of the number of strong squares\n4.1.3. Geometrical analysis of the reduced normal polytope\n4.1.4. Generating functions and the quasipolynomial\n4.1.5. Another method: Direct counting\n4.2. Semimagic squares: Affine count (by magic sum)\n\n2\n3\n4\n6\n7\n7\n8\n8\n8\n10\n11\n12\n13\n14\n14\n14\n15\n17\n20\n20\n\n2000 Mathematics Subject Classification. Primary 05B15; Secondary 05A15, 52B20, 52C35.\nKey words and phrases. Magic square, semimagic square, magic graph, latin square, magilatin square,\nlattice-point counting, rational convex polytope, arrangement of hyperplanes.\nThe authors are grateful to an anonymous referee for several helpful suggestions. The research of the\nfirst author was partially supported by National Science Foundation grant DMS-0810105. The research of\nthe second author was partially supported by National Science Foundation grant DMS-0070729 and by the\nSGPNR. .\n1\n\n\f4.2.1. The Birkhoff polytope\n4.2.2. Affine weak semimagic\n4.2.3. Reduction\n4.2.4. The reduced, normalized weak polytopal quasipolynomial\n4.2.5. Geometrical analysis of the reduced, normalized polytope\n4.2.6. Generating functions and the quasipolynomial\n4.2.7. Alternative methods: Direct counting and direct computation\n5. Magilatin squares of order 3\n5.1. Magilatin squares: Cubical count (by upper bound)\n5.1.1. Magilatin squares by upper bound\n5.1.2. Symmetry types of magilatin squares, counted by upper bound\n5.1.3. Some real numbers\n5.2. Magilatin squares: Affine count (by magic sum)\n5.2.1. Magilatin squares by magic sum\n5.2.2. Symmetry types of magilatin squares, counted by magic sum\n5.2.3. Some numbers\n6. Observations and conjectures\nReferences\n\n20\n20\n21\n21\n21\n23\n26\n26\n29\n29\n31\n33\n33\n33\n36\n37\n38\n38\n\n1. Introduction\n\"Today, the study of magic squares is not regarded as a subject of mathematics, but many\nearlier mathematicians in China and Japan studied it.\" These words from Shigeru's history of\nold Japanese mathematics [14, p. 435] are no longer completely true. While the construction\nof magic squares remains for the most part recreational, their counting has become part of\nthe mainstream of enumerative combinatorics, as an example of quasipolynomial counting\nformulas and as an application of Ehrhart's theory of lattice points in polytopes. There are\nseveral classical [12, 11, 16] and recent [1, 2] mathematical works on counting something like\nmagic squares, but without the requirement that the entries be distinct, and often omitting\nthe diagonals. In previous articles [5, 6] we established the groundwork for an enumerative\ntheory of magic squares with distinct entries. Here we apply those geometrical and algebraic\nmethods to solve the problem of counting three kinds of magical 3 \u00d7 3 squares.\nEach square x = (xjk )3\u00d73 has positive integral entries that satisfy certain line-sum equations and distinctness conditions. In a weakly semimagic square every row and column sum\nis the same (their common value is called the magic sum); in a weakly magic square each of\nthe two diagonals also adds up to the magic sum. Such squares have been studied before (see,\ne.g., Beck et al. [2] and Stanley [17]); the difference here is that we count strongly magic or\nsemimagic squares, where all entries of the square are distinct. (Since strongly magic squares\nare closest to what are classically known as \"magic squares\"-see the introduction to our\ngeneral magic article [6]-we call strong squares simply \"magic\" or \"semimagic\" without\nqualification.) The third type we count is a magilatin square; this is a weakly semimagic\nsquare with the restriction that the entries be distinct within a row or column. The numbers\nof standard magic squares (with entries 1, 2, . . . , n2 ) and latin squares (in which each row or\ncolumn has entries 1, 2, . . . , n) are special evaluations of our counting functions.\n2\n\n\fWe count the squares in two ways: by magic sum (an affine count), and by an upper\nbound on the numbers in the square (a cubic count). Letting N(t) denote the number of\nsquares in terms of a parameter t which is either the magic sum or a strict upper bound on\nthe entries, we know by our previous work [6] that N is a quasipolynomial, that is, there are\na positive integer p and polynomials N0 , N1 , . . . , Np\u22121 so that\nN(t) = Nt\n\n(mod p) (t)\n\n.\n\nThe minimal such p is the period of N; the polynomials N0 , N1 , . . . , Np\u22121 are the constituents\nof N, and N0 is the principal constituent. Here we find an\nof constituents\nPexplicit list\nt\nand also the explicit rational generating function N(x) =\nt>0 N(t)x (from which the\nquasipolynomial is easily extracted).\nEach magic and semimagic square also has an order type, which is the arrangement of\nthe cells in order of increasing value of their entries. The order type is a linear ordering of\nthe cells because all entries are distinct in these squares. There are 9! = 362880 possible\nlinear orderings but only a handful are order types of squares. Our approach finds the actual\nnumber of order types for each kind of square; it is the absolute value of the constant term\nof the principal constituent, that is, |N0 (0)|. (See Theorems 3.4 and 3.14 and Examples\n3.11, 3.12, and 3.21 in our paper on magic labellings [6].) Obviously, this number will be the\nsame for cubic and affine counts of the same kind of square. (There is also an order type for\nmagilatin squares, which is a linear ordering only within each row and column. As it is not\na simple permutation of the cells, we shall not discuss it any further.)\nOne of our purposes is to illustrate the technique of our general treatment [6]. Another is\nto provide data for the further study of magic squares and their relatives; to this end we list\nthe exact numbers of each type for small values of the parameter and also the numbers of\nsymmetry types, reduced squares, and reduced symmetry types of each type (and we refer to\nthe On-Line Encyclopedia of Integer Sequences (OEIS) [15] for the first 10,000 values of each\ncounting sequence). A square is reduced by subtracting the smallest entry from all entries;\nthus, the smallest entry in a reduced square is 0. A square is normalized by being put into\na form that is unique in each symmetry class. Clearly, the number of normalized squares,\ni.e., of equivalence classes under symmetry, is fundamental; and the number of reduced,\nnormalized squares is more fundamental yet.\nThere are other ways to find exact formulas. Xin [18] tackles 3 \u00d7 3 magic squares, counted\nby by magic sum, using MacMahon's partition calculus. He gets a generating function that\nagrees with ours (thereby confirming both). Stanley's idea of M\u00f6bius inversion over the\npartition lattice [17, Exercise 4.10] is similar to ours in spirit, but it is less flexible and\nrequires more computation. Beck and van Herick [3] have counted 4 \u00d7 4 magic squares using\nthe same basic geometrical setup as ours but with a more direct counting method.\nOur paper is organized as follows. Section 2 gives an outline of our theoretical and computational setup, as well as some comments on checks and feasibility. In Section 3 we give\na detailed analysis of our computations for counting magic 3 \u00d7 3 squares. Sections 4 and 5\ncontain the setup and the results of similar computations for 3 \u00d7 3 semimagic and magilatin\nsquares. We conclude in Section 6 with some questions and conjectures.\nWe hope that these results, and still more the method, will interest both magic squares\nenthusiasts and mathematicians.\n2. The technique\n3\n\n\f2.1. General method. The means by which we solve the specific examples of 3 \u00d7 3 magic,\nsemimagic, and magilatin squares is inside-out Ehrhart theory [5]. That means counting the\nnumber of 1/t-fractional points in the interior of a convex polytope P that do not lie in any\nof a certain set H of hyperplanes. The number of such points is a quasipolynomial function\nEP\u25e6 \u25e6 ,H (t), the open Ehrhart quasipolynomial of the open inside-out polytope (P \u25e6 , H). The\nexact polytope and hyperplanes depend on which of the six problems it is, but we can describe\nthe general picture. First, there are the equations of magic; they determine a subspace s of\nall 3 \u00d7 3 real matrices which we like to call the magic subspace-though mostly we work in\na smaller overall space Rd that results from various reductions. Then there is the polytope\n2\nP of constraints, which is the intersection with s of either a hypercube [0, 1]3 or a standard\nP\n2\nsimplex {x \u2208 R3 : x \u2265 0,\nxjk = 1}: the former when we impose an upper bound on the\nmagic square entries and the latter when we predetermine the magic sum. The parameter t\nis the strict upper bound in the former case (which we call cubical due to the shape of P ), the\nmagic sum in the latter (which we call affine as P lies in a proper affine subspace). Finally\nthere are the strong magical exclusions, the hyperplanes that must be avoided in order to\nensure the entries are distinct-or in the magilatin examples, as distinct as they ought to be.\nThese all have the form xij = xkl . The combination of P and the excluded hyperplanes forms\nthe vertices of (P, H), which are all the points of intersection of facets of P and hyperplanes\nin H that lie in or on the boundary of P . Thus, we count as a vertex every vertex of P itself,\neach point that is the intersection of some facets and some hyperplanes in H, and any point\nthat is the intersection of some hyperplanes and belongs to P , but not intersection points\nthat are outside P . (Points of each kind do occur in our examples.) The denominator of\n(P, H) is the least common denominator of all the coordinates of all the vertices of (P, H).\nThe period of EP\u25e6 \u25e6 ,H (t) divides the denominator; this gives us a known bound on it.\nThis geometry might best be explained with an example. Let us consider magic 3 \u00d7 3\nsquares,\n\uf8ee\n\uf8f9\nx11 x12 x13\n2\n\uf8f0 x21 x22 x23 \uf8fb \u2208 Z3>0\n.\nx31 x32 x33\nThe magic subspace is\n\uf8f1\n\uf8fc\n\uf8ee\n\uf8f9\nx11 + x12 + x13 = x21 + x22 + x23\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f2 x11 x12 x13\n\uf8fd\n2\n=\nx\n+\nx\n+\nx\n=\nx\n+\nx\n+\nx\n31\n32\n33\n11\n21\n31\n3\n\uf8f0\n\uf8fb\nx21 x22 x23 \u2208 R :\ns=\n.\n= x12 + x22 + x32 = x13 + x23 + x33 \uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f3 x31 x32 x33\n\uf8fe\n= x11 + x22 + x33 = x13 + x22 + x31\nThe hyperplane arrangement H that captures the distinctness of the entries is\nH = {(x11 = x12 ) \u2229 s, (x11 = x21 ) \u2229 s, . . . , (x32 = x33 ) \u2229 s} .\nFinally, there are two polytopes associated to magic 3 \u00d7 3 squares, depending on whether\nwe count them by an upper bound on the entries:\n2\n\nPc = s \u2229 [0, 1]3 ,\nor by magic sum:\n\uf8f1\uf8ee\n\uf8fc\n\uf8f9\n\uf8f2 x11 x12 x13\n\uf8fd\n2\nPa = s \u2229 \uf8f0 x21 x22 x23 \uf8fb \u2208 R3\u22650 : x11 + x12 + x13 = 1 .\n\uf8f3\n\uf8fe\nx31 x32 x33\n4\n\n\fOur cubical counting function computes the number of magic squares all of whose entries\nsatisfy 0 < xij < t, in terms of an integral parameter t. These squares are the lattice points\nin\n[ \u0001\n\u000132\nPc\u25e6 \\\nH \u2229 1t Z .\n\nOur second, affine, counting function computes the number of magic squares with positive\nentries and magic sum t. These squares are the lattice points in\n[ \u0001\n\u000132\nPa\u25e6 \\\nH \u2229 1t Z .\n\nIn general, the number of squares we want to count, N(t), is the Ehrhart quasipolynomial EP\u25e6 \u25e6 ,H (t) of an open inside-out polytope (P \u25e6 , H). We obtain the necessary Ehrhart\nquasipolynomials by means of the computer program LattE [9]. It computes the closed\nEhrhart generating function\n\u221e\nX\n\u0001d \u0001\nEP (x) := 1 +\nEP (t)xt\nof the values\nEP (t) := # P \u2229 1t Z .\nt=1\n\nCounting only interior points gives the open Ehrhart quasipolynomial EP \u25e6 (t) and its generating function\n\u221e\nX\n\u25e6\nEP \u25e6 (t)xt .\nEP (x) :=\nt=1\n\nP\n\u25e6\nt\nSince we want the open inside-out Ehrhart generating function E\u25e6P \u25e6 ,H (x) = \u221e\nt=1 EP \u25e6 ,H (t)x ,\nwe need several transformations. One is Ehrhart reciprocity [10], which is the following\nidentity of rational generating functions:\nEP \u25e6 (t) = (\u22121)1+dim P EP (x\u22121 ) .\n\n(1)\n\nThe inside-out version [5, Equation (4.6)] is\nE\u25e6P \u25e6 ,H (x) = (\u22121)1+dim P EP,H (x\u22121 ) .\n\n(2)\n\nWe need to express the inside-out generating functions in terms of ordinary Ehrhart generating functions. To do that we take the intersection poset\n\b\n\b\nT\nL(P \u25e6 , H) := P \u25e6 \u2229 S : S \u2286 H \\ \u2205 ,\n\nwhich is ordered by reverse inclusion. Note that L(P \u25e6 , H) and L(P, H), defined similarly\nbut with P instead of P \u25e6 , are isomorphic posets because H is transverse to P ; specifically,\nL(P, H) = {\u016b : u \u2208 L(P \u25e6 , H)}, where \u016b is the (topological) closure of u. Now we have the\nM\u00f6bius inversion formulas [5, Equations (4.7) and (4.8)]\nX\nE\u25e6P \u25e6 ,H (x) =\n\u03bc(0\u0302, u) Eu (x)\n(3)\nu\u2208L(P \u25e6 ,H)\n\nand\n\nEP,H (x) =\n\nX\n\n|\u03bc(0\u0302, u)| Eu(x)\n\n(4)\n\nu\u2208L(P,H)\n\n(since H is transverse to P ; see our general paper [6]). Here \u03bc is the M\u00f6bius function of\nL(P \u25e6 , H) [17].\nThus we begin by getting all the cross-sectional generating functions Eu (x) from LattE.\nThen we either sum them by (4) and apply inside-out reciprocity (2), or apply ordinary reciprocity (1) first and then sum by (3). (We did whichever of these seemed more convenient.)\n5\n\n\fIn the semimagic and magilatin counts we need a third step because the generating functions we computed pertain to a reduced problem; those of the original problem are obtained\nthrough multiplication by another generating function.\nOnce we have the generating function we extract the quasipolynomial, essentially by the\nbinomial series. If an Ehrhart quasipolynomial q of a rational convex polytope has period\np and degree d, then its generating function q can be written as a rational function of the\nform\nX\nap(d+1) xp(d+1) + ap(d+1)\u22121 xp(d+1)\u22121 + * * * + a1 x\n(5)\nq(x) :=\nq(t) xt =\n(1 \u2212 xp )d+1\nt\u22651\n\nfor some nonnegative integers a1 , a2 , . . . , ap(d+1) . Grouping the terms in the numerator of (5)\naccording to the residue class of the degree modulo p and expanding the denominator, we\nget\n\" d\nPp Pd\n\u0013#\n\u0012\np\npj+r\nX\nX X\nd+k\u2212j\nj=0 apj+r x\nr=1\nq(x) =\nxpk+r .\napj+r\n=\nd\n(1 \u2212 xp )d+1\nr=1 k\u22650 j=0\nHence the rth constituent of the quasipolynomial q is\n\u0013\n\u0012\nd\nX\n\u2212j\nd + t\u2212r\np\nfor r = 1, . . . , p.\nqr (t) =\napj+r\nd\nj=0\n\n2.2. How we apply the method. The initial step is always to reduce the size of the\nproblem by applying symmetry. Each problem has a normal form under symmetry, which\nis a strong square. The number of all magic or semimagic squares is a constant multiple of\nthe number of symmetry types, because every such square has the same symmetry group.\nFor magilatin squares, there are several symmetry types with symmetry groups of different\nsizes, so each type must be counted separately.\nSemimagic and magilatin squares also have an interesting reduced form, in which the values\nare shifted by a constant so that the smallest cell contains 0; and a reduced normal form; the\nlatter two are not strong but are aids to computation. Reduced squares are counted either\nby magic sum (the \"affine\" counting rule) or by the largest cell value (the \"cubic\" count).\nAll reduced normal semimagic squares correspond to the same number of unreduced squares,\nwhile the different symmetry types of magilatin square give reduced normal squares whose\ncorresponding number of unreduced squares depends on the symmetry type.\nThe total number of squares, N(t), and\nP the number of reduced squares, R(t), are connected by a convolution identity N(t) = s f (t \u2212 s)R(s), where f is a periodic constant (by\nwhich we mean a quasipolynomial of degree 0; we say constant term for the degree-0 term of\na quasipolynomial, even though the \"constant term\" may\nP vary periodically) or a linear polynomial. P\nWriting for the generating functions N(x) := t>0 N(t)xt and similarly R(x), and\nf(x) := t\u22650 f (t)xt , we have N(x) = f(x)R(x). It follows from the form of the denominator\nin Equation (5) that the period of N divides the product of the periods of f and R. The\nreduced number R(t) is, in the semimagic case, a constant multiple of the number n(t) of\nreduced, normal semimagic squares; in the magilatin case it is a sum of different multiples,\ndepending on a symmetry group, of the number of reduced, normal magilatin squares of each\ndifferent type T . Each n(t) is the open Ehrhart quasipolynomial EQ\u25e6 \u25e6 ,I (t) of an inside-out\npolytope (Q, I) which is smaller than the original polytope P .\n6\n\n\fP\nt\nWe compute n(x) :=\nt>0 n(t)x from the Ehrhart generating functions Eu (x) of the\nnonvoid sections u of Q\u25e6 by flats of I through the following procedure:\n(1) We calculate the flats and sections by hand.\n(2) We feed each u into the computer program LattE [9], which returns the closed generating function E\u016b (x), whose constant term equals 1 because u is nonvoid and convex.\n(3) With semimagic squares, by Equations (1)\u2013(4) we have the M\u00f6bius-inversion formulas\nX\nn(x) = E\u25e6Q\u25e6 ,I (x) =\n\u03bcL (0\u0302, u)Eu (x)\nu\u2208L\n\n= (\u22121)1+dim Q\n\nX\n\n|\u03bcL (0\u0302, u)| E\u016b(x\u22121 ).\n\n(6)\n\nu\u2208L\n\n\u25e6\n\nwhere L := L(Q , I), the intersection poset of (Q\u25e6 , I).\nThe procedure for magilatin squares is similar but taking account of the several types.\n2.3. Checks. We check our results in a variety of ways.\nThe degree is the dimension of the polytope, or the number of independent variables in\nthe magic-sum equations.\nThe leading coefficient is the volume of the polytope. (The volume is normalized so that\na fundamental domain in the affine space spanned by the polytope has unit volume.) This\ncheck is also not difficult. The volume is easy to find by hand in the magic examples. In affine\nsemimagic the polytope is the Birkhoff polytope B3 , whose volume is well known (Section\n4.2). The cubical semimagic volume is not well known but it was easy to find (Section 4.1.1).\nThe magilatin polytopes are the same as the semimagic ones.\nThe firmest verification is to compare the results of the generating function approach\nwith those of direct enumeration. If we count the squares individually for t \u2264 t1 where\nt1 \u2265 pd, only the correct quasipolynomial can agree with the counts (given that we know\nthe degree d and period p from the geometry). Though t1 = pd is too large to reach in\nsome of the examples, still we gain considerable confidence if even a smaller value of t1 yields\nnumbers that agree with those derived from the quasipolynomial or generating function. We\nperformed this check in each case.\n2.4. Feasibility. Based on our solutions of the six 3 \u00d7 3 examples we believe our counting\nmethod is practical. The calculations are simple and readily verified. Linear algebra tells us\nthe degree, geometry tells us the period; we obtain the generating function using the Ehrhart\npackage LattE [9] and then apply reciprocity (Equation (1) or (2)) and M\u00f6bius inversion\n(Equation (3) or (4)), and extract the constituents, all with Maple. The programming is not\ntoo difficult.\nIn the magic square problems we found the denominator by calculating the vertices of\nthe inside-out polytope. Then we took two different routes. In one we applied LattE and\nEquation (3). In the other we calculated N(t) for small values of t by generating all magic\nsquares, taking enough values of t that we could fit the quasipolynomial constituents to the\ndata. This was easy to program accurately and quick to compute, and it gave the same\nanswer. The programs can be found at our \"Six Little Squares\" Web site [7].\nIn principle the semimagic and magilatin problems can be solved in the same two ways.\nThe geometrical method with M\u00f6bius inversion gave complete answers in a few minutes\nof computer time after a simple hand analysis of the geometry (see Section 4). Direct\nenumeration on the computer proved unwieldy (at best), especially in the affine case, where\n7\n\n\fthe period is largest. A straightforward computer count of semimagic squares by magic\nsum (performed in Maple-admittedly not the language of choice-on a personal computer)\nseemed destined to take a million years. Switching to a count of reduced normal squares, the\ncalculation threatened to take only a thousand years. These programs are at our \"Six Little\nSquares\" Web site [7], as is a complicated \"supernormalized formula\" that greatly speeds up\naffine semimagic counting (see Section 4.2.7).\n2.5. Notation. We use a lot of notation. To keep track of it we try to be reasonably\nsystematic.\nM, m refer to magic squares (Section 3).\nS, s and subscript s refer to semimagic squares (Section 4).\nL, l and subscript ml refer to magilatin squares (Section 5).\nR, r refer to reduced squares (the minimum entry is 0), while M, S, L, et al. refer to\nordinary squares (all positive entries).\nc refers to \"cubic\" counting, by an upper bound on the entries.\na refers to \"affine\" counting, by a specified magic sum.\nX (capital) refers to all squares of that type.\nx (minuscule) refers to symmetry types of squares, or equivalently normalized\nsquares.\n3. Magic squares of order 3\nThe standard form of a magic square of order 3 is well known; it is\n\u03b1+\u03b3\n\n\u2212\u03b1 \u2212 \u03b2 + \u03b3\n\n\u03b2+\u03b3\n\n\u2212\u03b1 + \u03b2 + \u03b3\n\n\u03b3\n\n\u03b1\u2212\u03b2+\u03b3\n\n\u2212\u03b2 + \u03b3\n\n\u03b1+\u03b2+\u03b3\n\n\u2212\u03b1 + \u03b3\n\n(7)\n\nwhere the magic sum is s = 3\u03b3. Taking account of the 8-fold symmetry, under which we may\nassume the largest corner value is \u03b1 + \u03b3 and the next largest is \u03b2 + \u03b3, and the distinctness\nof the values, we have \u03b1 > \u03b2 > 0 and \u03b1 6= 2\u03b2. One must also have \u03b3 > \u03b1 + \u03b2 to ensure\npositivity.\nIn this pair of examples, the dimension of the problem is small enough that there is no\nadvantage in working with the reduced normal form (where \u03b3 = 0).\n3.1. Magic squares: Cubical count (by upper bound). Here we count by a strict\nupper bound t on the permitted values; since the largest entry is \u03b1 + \u03b2 + \u03b3, the bound is\n\u03b1 + \u03b2 + \u03b3 < t. The number of squares\nS with upper bound t is Mc (t). We think of each magic\n\u22121\n\u25e6\nsquare as a t -lattice point in Pc \\ Hc , the (relative) interior of the inside-out polytope\nPc := {(x, y, z) : 0 \u2264 y \u2264 x, x + y \u2264 z, x + y + z \u2264 1},\n8\n\n\fHc := {h} where h : x = 2y,\nbut multiplied by t to make the entries integers. Here we use normalized coordinates x = \u03b1/t,\ny = \u03b2/t, and z = \u03b3/t. The semilattice of flats is L(Pc\u25e6 , Hc ) = {Pc\u25e6 , h \u2229 Pc\u25e6 } with Pc\u25e6 < h \u2229 Pc\u25e6 .\nThe vertices are\nO = (0, 0, 0),\n\nC = (0, 0, 1),\n\nD = ( 21 , 0, 12 ),\n\nE = ( 31 , 61 , 12 ),\n\nF = ( 14 , 41 , 21 ),\n\nof which O, C, D, F are the vertices of Pc and O, C, E are those of h \u2229 Pc . (Both these\npolytopes are simplices.) From Equation (3),\n\u0002\n\u0003\nMc (x) = 8E\u25e6Pc\u25e6,Hc (x) = 8 EPc\u25e6 (x) \u2212 Eh\u2229Pc\u25e6 (x)\nwhich we evaluate by LattE and Ehrhart reciprocity, Equation (1):\n\u0014\n\u0015\nx8\nx8\n=8\n\u2212\n(1 \u2212 x)2 (1 \u2212 x2 )(1 \u2212 x4 ) (1 \u2212 x)2 (1 \u2212 x6 )\n=\n\n8x10 (2x2 + 1)\n(1 \u2212 x)2 (1 \u2212 x4 )(1 \u2212 x6 )\n\n=\n\n8x10 (2x2 + 1)(x4 \u2212 x2 + 1)(x11 + x10 + * * * + x + 1)2 (x10 + x8 + * * * + x2 + 1)\n.\n(1 \u2212 x12 )4\n\nFrom this generating function we extract the quasipolynomial\n\uf8f1 t3 \u221216t2 +76t\u221296\n= (t\u22122)(t\u22126)(t\u22128)\n,\nif t \u2261 0, 2, 6, 8 (mod 12);\n\uf8f4\n6\n6\n\uf8f4\n\uf8f4\n\uf8f4\n2\n\uf8f4\nt3 \u221216t2 +73t\u221258\n\uf8f4\n\uf8f4\n= (t\u22121)(t \u221215t+58)\n, if t \u2261 1 (mod 12);\n\uf8f4\n6\n6\n\uf8f4\n\uf8f4\n\uf8f4\n2\n\uf8f4\n\uf8f2 t3 \u221216t2 +73t\u2212102 = (t\u22123)(t \u221213t+34) , if t \u2261 3, 11 (mod 12);\n6\n6\nMc (t) =\n3 \u221216t2 +76t\u2212112\n(t\u22124)(t2 \u221212t+28)\nt\n\uf8f4\n\uf8f4\n=\n, if t \u2261 4, 10 (mod 12);\n\uf8f4\n6\n6\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\nt3 \u221216t2 +73t\u221290\n\uf8f4\n= (t\u22122)(t\u22125)(t\u22129)\n,\nif t \u2261 5, 9 (mod 12);\n\uf8f4\n6\n6\n\uf8f4\n\uf8f4\n\uf8f4\n2\n\uf8f3 t3 \u221216t2 +73t\u221270\n= (t\u22127)(t 6\u22129t+10) ,\nif t \u2261 7 (mod 12);\n6\n\n(8)\n\nand the first few nonzero values for t > 0:\nt 10 11 12 13 14 15 16 17 18 19 20 21 22 23\n24\nMc (t) 8 16 40 64 96 128 184 240 320 400 504 608 744 880 1056\nmc (t) 1 2 5 8 12 16 23 30 40 50 63 76 93 110 132\n\nThe last row is the number of symmetry classes, or normal squares, i.e., Mc (t)/8. The rows\nare sequences A108576 and A108577 in the OEIS [15].\nThe symmetry of the constituents about residue 1 is curious.\nThe principal constituent is\n(t \u2212 2)(t \u2212 6)(t \u2212 8)\nt3 \u2212 16t2 + 76t \u2212 96\n=\n.\n6\n6\nIts unsigned constant term, 16, is the number of linear orderings of the cells that are induced\nby magic squares. Thus, up to the symmetries of a magic square, there are just two order\ntypes, even allowing arbitrarily large cell values. (The order types are illustrated in Example\n3.11 of our general magic article, [6].)\n9\n\n\fWe confirmed these results by direct enumeration, counting the strongly magic squares\nfor t \u2264 60 [7].\nCompare this quasipolynomial to the weak quasipolynomial:\n\uf8f1\n\uf8f2 t3 \u22123t2 +5t\u22123 = (t\u22121)(t2 \u22122t+3) , if t is odd;\nwith generating function\n\n\uf8f3\n\n6\n\n6\n\nt3 \u22123t2 +8t\u22126\n\n(t\u22121)(t2 \u22122t+6)\n6\n\n6\n\n=\n\n, if t is even;\n\n(x2 + 2x \u2212 1)(2x3 \u2212 x2 + 1)\n.\n(1 \u2212 x)2 (1 \u2212 x2 )2\n\n3.1.1. Reduced magic squares. A more fundamental count than the number of magic squares\nwith an upper bound is the number of reduced squares. Let Rmc (t) be the number of\n3 \u00d7 3 reduced magic squares with maximum cell value t, and rmc (t) the number of reduced\nsymmetry types, or equivalently of normalized reduced squares with maximum t. Then we\nhave the formulas\nt\u22121\nt\u22121\nX\nX\nMc (t) =\n(t \u2212 1 \u2212 k)Rmc (k) and mc (t) =\n(t \u2212 1 \u2212 k)rmc (k),\nk=0\n\nk=0\n\nsince every reduced square with maximum k gives t\u22121\u2212k unreduced squares with maximum\n< t (and positive entries) by adding l to each entry where 1 \u2264 l \u2264 t \u2212 1 \u2212 k. In terms of\ngenerating functions,\nx2\nRmc (x)\n(1 \u2212 x)2\nWe deduce the generating functions\nMc (x) =\n\nrmc (x) =\n\nand\n\nmc (x) =\n\nx2\nrmc (x).\n(1 \u2212 x)2\n\n(9)\n\nx8 (2x2 + 1)\n(1 \u2212 x4 )(1 \u2212 x6 )\n\nand Rmc (x) = 8rmc (x), and from the latter the quasipolynomial\n\uf8fc\n\uf8f1\n2t \u2212 16, if t \u2261 0\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8fd\n\uf8f4\n2t\n\u2212\n4,\nif\nt\n\u2261\n2,\n10\n\uf8f4\n\uf8f2\nmod 12;\nRmc (t) = 2t \u2212 8, if t \u2261 4, 8 \uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8fe\n\uf8f4\n\uf8f4 2t \u2212 12, if t \u2261 6\n\uf8f4\n\uf8f4\n\uf8f3\n0,\nif t is odd\n\n(10)\n\n(1/8-th of these for rmc (t)) as well as the first few nonzero values:\n\nt 8 10 12 14 16 18 20 22 24 26 28 30 32 34 36 38 40 42\nRmc (t) 8 16 8 24 24 24 32 40 32 48 48 48 56 64 56 72 72 72\nrmc (t) 1 2 1 3 3 3 4 5 4 6 6 6 7 8 7 9 9 9\nThe sequences are A174256 and A174257 in the OEIS [15].\nThe principal constituent is 2t \u2212 16, whose constant term in absolute value, 16, is the\nnumber of linear orderings of the cells that are induced by magic squares-necessarily, the\nsame number as with Mc (t).\nWe confirmed the constituents by testing them against the coefficients of the generating\nfunction for several periods.\n10\n\n\fOur way of reasoning, from all squares to reduced squares, is backward; logically, one\nshould count reduced squares and then deduce the ordinary magic square numbers from\nthem via Equation (9). Counting magic squares is not hard enough to require that approach,\nbut in treating semimagic and magilatin squares we follow the logical progression since then\nreduced squares are much easier to handle.\n3.2. Magic squares: Affine count (by magic sum). The number of magic squares with\nmagic sum t = 3\u03b3 is Ma (t). We take the normalized coordinates x = \u03b1/t and y = \u03b2/t. The\ninside-out polytope is\nPa : 0 \u2264 y \u2264 x, x + y \u2264 31 ,\nHa : {h} where h : x = 2y.\nThe semilattice of flats is L(Pa\u25e6 , Ha ) = {Pa\u25e6 , h \u2229 Pa\u25e6} with Pa\u25e6 < h \u2229 Pa\u25e6 . The vertices are\nO = (0, 0),\n\nD = ( 13 , 0),\n\nE = ( 29 , 19 ),\n\nF = ( 16 , 61 ),\n\nof which O, D, F are the vertices of Pa and O, E are the vertices of h \u2229 Pa . From Equations\n(1)\u2013(3),\n\u0002\n\u0003\nMa (x) = 8E\u25e6Pa\u25e6,Ha (x) = 8 EPa\u25e6 (x) \u2212 Eh\u2229Pa\u25e6 (x)\n\u0015\n\u0014\nx12\nx12\n\u2212\n=8\n(1 \u2212 x3 )2 (1 \u2212 x6 ) (1 \u2212 x3 )(1 \u2212 x9 )\n=\n\n8x15 (2x3 + 1)\n(1 \u2212 x3 )(1 \u2212 x6 )(1 \u2212 x9 )\n\n=\n\n8x15 (2x3 + 1)(x9 + 1)(x12 + x6 + 1)(x15 + x12 + * * * + x3 + 1)\n.\n(1 \u2212 x18 )3\n\nFrom this generating function we extract the quasipolynomial\n\uf8f1 2t2 \u221232t+144\n= 92 (t2 \u2212 16t + 72), if t \u2261 0 (mod 18);\n\uf8f4\n\uf8f4\n9\n\uf8f4\n\uf8f4\n\uf8f4\n2t2 \u221232t+78\n\uf8f4\n\uf8f4\n= 92 (t \u2212 3)(t \u2212 13), if t \u2261 3 (mod 18);\n\uf8f4\n9\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n2t2 \u221232t+120\n\uf8f4\n= 92 (t \u2212 6)(t \u2212 10), if t \u2261 6 (mod 18);\n\uf8f4\n9\n\uf8f4\n\uf8f2\n2\nMa (t) = 2t \u221232t+126\n= 92 (t \u2212 7)(t \u2212 9),\nif t \u2261 9 (mod 18);\n9\n\uf8f4\n\uf8f4\n\uf8f4\n2t2 \u221232t+96\n\uf8f4\n\uf8f4\n= 92 (t \u2212 4)(t \u2212 12), if t \u2261 12 (mod 18);\n\uf8f4\n9\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n2t2 \u221232t+102\n\uf8f4\n= 92 (t2 \u2212 16t + 51), if t \u2261 15 (mod 18);\n\uf8f4\n9\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f3\n0,\nif t 6\u2261 0 (mod 3);\n\nand the first few nonzero values\nt 15 18 21 24\nMa (t) 8 24 32 56\nma (t) 1 3 4 7\n\n(11)\n\nfor t > 0:\n27 30 33 36 39 42 45 48 51 54\n80 104 136 176 208 256 304 352 408 472\n10 13 17 22 26 32 38 44 51 59\n\nThe last row is the number of symmetry classes, or normalized squares, which is Ma (t)/8.\nThe two sequences are A108578 and A108579 in the OEIS [15].\n11\n\n\fThe principal constituent is\n2\n2t2 \u2212 32t + 144\n= (t2 \u2212 16t + 72),\n9\n9\nwhose constant term, 16, is the number of linear orderings of the cells that are induced by\nmagic squares-the same number as with Mc (t).\nWe verified our results by direct enumeration, counting the strong magic squares for t \u2264 72\n[7].\nCompare the magic-square quasipolynomial to the weak quasipolynomial:\n( 2\n2t \u22126t+9\n, if t \u2261 0 (mod 3);\n9\n0,\nif t 6\u2261 0 (mod 3);\ndue to MacMahon [12, Vol. II, par. 409, p. 163], with generating function\n5x6 \u2212 2x3 + 1\n.\n(1 \u2212 x3 )3\n3.2.1. Reduced magic squares. Let Rma (t) be the number of 3 \u00d7 3 reduced magic squares\nwith magic sum t, and rma (t) the number of reduced symmetry types, or equivalently of\nnormalized reduced squares with magic sum t. Then\nX\nX\nrma (s),\nRma (s) and ma (t) =\nMa (t) =\n0<s<t\ns\u2261t (mod 3)\n\n0<s<t\ns\u2261t (mod 3)\n\nsince every reduced square with sum s = t \u2212 3k, where 0 < 3k \u2264 t \u2212 3, gives one unreduced\nsquare with sum t (and positive entries) by adding 3k to each entry. In terms of generating\nfunctions,\nx3\nma (x) =\nrma (x) ;\n1 \u2212 x3\nthus,\nx12 (2x3 + 1)\nrma (x) =\n;\n(1 \u2212 x6 )(1 \u2212 x9 )\nand Rma (x) = 8rma (x). The quasipolynomial is\n\uf8fc\n\uf8f14\n4\nt\n\u2212\n16\n=\n(t\n\u2212\n12),\nif\nt\n\u2261\n0\n\uf8f4\n\uf8f4\n3\n3\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n4\n4\n\uf8f4\n\uf8fd\nt\n\u2212\n4\n=\n(t\n\u2212\n3),\nif\nt\n\u2261\n3,\n15\n\uf8f4\n3\n3\n\uf8f4\n\uf8f4\n\uf8f2\nmod 18;\n4\n4\n\uf8f4\n\uf8f4\nt\n\u2212\n8\n=\n(t\n\u2212\n6),\nif\nt\n\u2261\n6,\n12\n(12)\nRma (t) = 8rma (t) =\n\uf8f4\n3\n3\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8fe\n\uf8f4\n\uf8f4 43 t \u2212 12 = 43 (t \u2212 9), if t \u2261 9\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f3\n0,\nif t 6\u2261 0\nmod 18.\nThe initial nonzero values:\nt 12 15 18 21 24 27 30 33 36 39 42 45 48 51 54 57 60 63\nRma (t) 8 16 8 24 24 24 32 40 32 48 48 48 56 64 56 72 72 72\nrma (t) 1 2 1 3 3 3 4 5 4 6 6 6 7 8 7 9 9 9\n\nThese sequences are A174256 and A174257 in the OEIS [15].\n12\n\n\fOne of the remarkable properties of magic squares of order 3 is that Rmc (2k) = Rma (3k).\nThe reason is that the middle term of a reduced 3 \u00d7 3 magic square equals s/3, if s is the\nmagic sum, and the largest entry is 2s/3. Thus, the reduced squares of cubic and affine\ntype, allowing for the difference in parameters, are the same, and although the counts of\nmagic squares by magic sum and by upper bound differ, the only reason is that the reduced\nsquares are adjusted differently to get all squares.\nThe principal constituent 34 t \u2212 16 has constant term whose absolute value is the same as\nwith all other reduced magic quasipolynomials.\nWe confirmed the constituents by comparing their values to the coefficients of the generating function for several periods.\n4. Semimagic squares of order 3\nNow we apply our approach to counting semimagic squares. Here is the general form of a\nreduced, normalized 3 \u00d7 3 semimagic square, in which the magic sum is s = 2\u03b1 + 2\u03b2 + \u03b3:\n0\n\n\u03b2\n\n2\u03b1 + \u03b2 + \u03b3\n\n\u03b1+\u03b2\n\n\u03b1+\u03b2+\u03b3 \u2212\u03b4\n\n\u03b4\n\n\u03b1+\u03b2+\u03b3\n\n\u03b1+\u03b4\n\n\u03b2\u2212\u03b4\n\n(13)\n\nProposition 1. A reduced and normalized 3 \u00d7 3 semimagic square has the form (13) with\nthe restrictions\n0 < \u03b1, \u03b2, \u03b3;\n(14)\n0 < \u03b4 < \u03b2;\nand\n\uf8f1\n\u03b2\u2212\u03b1 \u03b2\n\u03b2+\u03b3\n\u03b2+\u03b1+\u03b3\n\uf8f4\n;\n\uf8f2 2 , 2, 2 ,\n2\n\u03b4 6= \u03b2 \u2212 \u03b1, \u03b1 + \u03b3;\n(15)\n\uf8f4\n\uf8f3\u03b3.\n\nThe largest entry in the square is w := x13 = 2\u03b1 + \u03b2 + \u03b3.\nEach reduced normal square with largest entry w corresponds to exactly 72(t \u2212 w \u2212 1)\ndifferent magic squares with entries in the range (0, t), for 0 < w < t. Each reduced normal\nsquare with magic sum s corresponds to exactly 72 different magic squares with magic sum\nequal to t, if t \u2261 s (mod 3), and none otherwise, for 0 < s < t.\nProof. By permuting rows and columns we can arrange that x11 = min xij and that the top\nrow and left column are increasing. By flipping the square over the main diagonal we can\nfurther force x21 > x12 . By subtracting the least entry from every entry we ensure that\nx11 = 0. Thus we account for the 72(t \u2212 w \u2212 1) semimagic squares that correspond to each\nreduced normal square.\n13\n\n\fThe form of the top and left sides in (13) is explained by the fact that x11 < x12 <\nx21 < x31 < x13 . The conditions xij > x11 for i, j = 2, 3, together with the row-sum and\ncolumn-sum equations, imply that x13 is the largest entry and that x23 < x12 .\nThe only possible equalities amongst the entries are ruled out by the following inequations:\nx22 =\n6 x12 , x21 , x23 ;\nx32 =\n6 x12 , x22 ;\nx33 =\n6 x23 , x32 .\nThese correspond to the restrictions (15):\nx22 6= x12 \u21d0\u21d2 \u03b4 6= \u03b1 + \u03b3;\nx22 6= x21 \u21d0\u21d2 \u03b4 6= \u03b3;\n\u03b2+\u03b1+\u03b3\nx22 6= x23 \u21d0\u21d2 \u03b4 6=\n;\n2\nx32 6= x12 \u21d0\u21d2 \u03b4 6= \u03b2 \u2212 \u03b1;\nx32 6= x22 \u21d0\u21d2 \u03b4 6= \u03b2 + \u03b3 \u2212 \u03b4 \u21d0\u21d2 \u03b4 6=\nx33 6= x23 \u21d0\u21d2 \u03b4 6= \u03b2 \u2212 \u03b4 \u21d0\u21d2 \u03b4 6=\n\n\u03b2+\u03b3\n;\n2\n\n\u03b2\n;\n2\n\nx33 6= x32 \u21d0\u21d2 \u03b4 6= \u03b1 + \u03b4 6= \u03b2 \u2212 \u03b4 \u21d0\u21d2 \u03b4 6=\n\n\u03b2\u2212\u03b1\n.\n2\n\n\u0004\n\n4.1. Semimagic squares: Cubical count (by upper bound). We are counting squares\nby a strict upper bound on the allowed value of an entry; this bound is the parameter t. Let\nSc (t), for t > 0, be the number of semimagic squares of order 3 in which every entry belongs\nto the range (0, t).\n4.1.1. Counting the weak squares. The polytope Pc is the 5-dimensional intersection of [0, 1]9\nwith the semimagic subspace in which all row and column sums are equal. This polytope is\nintegral because it is the intersection with an integral polytope of a subspace whose constraint\nmatrix is totally unimodular; so the quasipolynomial is a polynomial. By contrast, the\ninside-out polytope (P, H) for enumerating strong semimagic squares has denominator 60.\nWe verified by computer counts for t \u2264 18 that the weak polynomial is\n3t5 \u2212 15t4 + 35t3 \u2212 45t2 + 32t \u2212 10\n(t \u2212 1)(t2 \u2212 2t + 2)(3t2 \u2212 6t + 5)\n=\n10\n10\nwith generating function\n(7x2 \u2212 2x + 1)(2x3 + x2 + 4x \u2212 1)\n.\n(1 \u2212 x)6\nWe conclude that Pc has volume 3/10.\n4.1.2. Reduction of the number of strong squares. We compute Sc (t) via Rc (w), the number\nof reduced squares with largest entry equal to w. The formula is\nSc (t) =\n\nt\u22121\nX\n\n(t \u2212 1 \u2212 w)Rc (w).\n\nw=0\n\n14\n\n(16)\n\n\fThe value Rc (w) = 72rc (w) where rc (w) is the number of normal reduced squares (in which\nwe know the largest entry to be x13 ). Thus rc (s) counts the number of 1s -integral points in\nthe interior of the 3-dimensional polytope Qc defined by\n1\n(17)\n0 \u2264 x, y;\n0 \u2264 z \u2264 y;\nx+y \u2264\n2\nwith the seven excluded (hyper)planes\ny \u2212 x y 1 \u2212 y \u2212 2x 1 \u2212 x \u2212 y\n, ,\n,\n, y \u2212 x, 1 \u2212 x \u2212 2y, 1 \u2212 2x \u2212 2y ,\n(18)\n2\n2\n2\n2\nthe three coordinates being x = \u03b1/w, y = \u03b2/w, and z = \u03b4/w.\nThe hyperplane arrangement for reduced normal squares is that of (18). We call it Ic .\nThus rc (s) = EQ\u25e6 \u25e6c ,Ic (s).\nz=\n\n4.1.3. Geometrical analysis of the reduced normal polytope. We apply M\u00f6bius inversion,\nEquation (3), over the intersection poset L(Q\u25e6c , Ic ). We need to know not only L(Q\u25e6c , Ic )\nbut also all the vertices of (Qc , Ic ), since they are required for computing the Ehrhart generating function and estimating the period of the reduced normal quasipolynomial.\nWe number the planes:\n\u03c01\n\u03c02\n\u03c03\n\u03c04\n\u03c05\n\u03c06\n\u03c07\n\n: x \u2212 y + 2z = 0,\n:\ny \u2212 2z = 0,\n:\n2x + 2z = 1,\n:\nx + 2z = 1,\n: x \u2212 y + z = 0,\n: x + y + z = 1,\n: 2x + y + z = 1.\n\nThe intersection of two planes, \u03c0j \u2229 \u03c0k , is a line we call ljk ; \u03c03 \u2229 \u03c05 \u2229 \u03c06 is a line we also\ncall l356 . The intersection of three planes is, in general, a point but not usually a vertex of\n(Qc , Ic ).\nOur notation for the line segment with endpoints X, Y is XY , while XY denotes the\nentire line spanned by the points. The triangular convex hull of three noncollinear points\nX, Y, Z is XY Z. We do not need quadrilaterals, as the intersection of each plane with Q is\na triangle.\nWe need to find the intersections of the planes with Q\u25e6c , separately and in combination.\nHere is a list of significant points; we shall see it is the list of vertices of (Qc , Ic ). The first\ncolumn has the vertices of Qc , the second the vertices of (Qc , Ic ) that lie in open edges, the\nthird the vertices that lie in open facets, and the last is the sole interior vertex.\nO = (0, 0, 0),\n\nDc = (0, 21 , 21 ) \u2208 OC,\n\nFc = (0, 23 , 31 ) \u2208 OBC,\n\nA = ( 21 , 0, 0),\n\nEc = ( 13 , 31 , 0) \u2208 AB,\n\nGc = ( 41 , 12 , 41 ) \u2208 ABC,\n\nBc = (0, 1, 0),\n\nEc\u2032 = ( 13 , 31 , 31 ) \u2208 AC,\n\nG\u2032c = ( 51 , 35 , 51 ) \u2208 ABC,\n\nCc = (0, 1, 1),\n\nEc\u2032\u2032 = (0, 1, 12 ) \u2208 BC,\n\nG\u2032\u2032c = ( 51 , 35 , 52 ) \u2208 ABC,\n\nHc = ( 15 , 52 , 51 ).\n(19)\n\nThe denominator of (Qc , Ic ) is the least common denominator of all the points; it evidently\nequals 4 * 3 * 5 = 60.\n15\n\n\fPlane\n\nIntersection with edge\nOA OB OC AB\n\nIntersection\n\nAC\n\nBC\n\nwith Q\n\n\u03c01\n\nO\n\nO\n\nO\n\nE\n\n\u2208\n/Q\n\nE \u2032\u2032\n\nOEE \u2032\u2032\n\n\u03c02\n\nOA\n\nO\n\nO\n\nA\n\nA\n\nE \u2032\u2032\n\nOAE \u2032\u2032\n\n\u03c03\n\nA\n\n\u2205\n\nD\n\nA\n\nA\n\nE \u2032\u2032\n\nADE \u2032\u2032\n\n\u03c04\n\n\u2208\n/Q\n\n\u2205\n\nD\n\n\u2208\n/Q\n\nE\u2032\n\nE \u2032\u2032\n\nDE \u2032\u2032 E \u2032\n\n\u03c05\n\nO\n\nO\n\nOC\n\nE\n\nC\n\nC\n\nOCE\n\n\u03c06\n\n\u2208\n/Q\n\nB\n\nD\n\nB\n\nE\u2032\n\nB\n\nBDE \u2032\n\n\u03c07\n\nA\n\nB\n\nD\n\nAB\n\nA\n\nB\n\nABD\n\nTable 1. Intersections of planes of I with edges of Q. A vertex of Q contained\nin \u03c0j will show up three times in the row of \u03c0j . In order to clarify the geometry,\nwe distinguish between a plane's meeting an edge line outside Q and not\nmeeting it at all (i.e., their being parallel).\nThe intersections of the planes with the edges of Qc are in Table 1. The subscript c is\nomitted.\nTable 2 shows the lines generated by pairwise intersection of planes.\n\n\u03c01\n\u03c02\n\u03c03\n\u03c04\n\n\u03c02\n\n\u03c03\n\n\u03c04\n\n\u03c05\n\nx=0\ny = 2z\n\nx + z = 12\ny \u2212 z = 12\ny = 2z\nx + z = 12\n\ny=1\nx + 2z = 1\ny = 2z\nx+y =1\nx=0\nz = 21\n\nz =0\nx=y\ny = 2z\nx=z\n\n\u03c06\n\nz = 2y \u2212 1\nx = 2 \u2212 3y\ny = 2z\nx + 3z = 1\nx + z = 21\nl356 :\ny = 21\nx = 1 \u2212 2z\nx = 1 \u2212 2z\ny =1\u2212z\ny=z\n\n\u03c05\n\nl356\n\n\u03c06\n\n\u03c07\nx + z = 13\ny \u2212 z = 31\ny = 2z\n2x + 3z = 1\nx + z = 12\ny=z\nx = 1 \u2212 2z\ny = 3z \u2212 1\nx = 1 \u2212 2y\nz = 3y \u2212 1\nx=0\ny+z =1\n\nTable 2. The equations of the pairwise intersections of planes of Ic .\nIn Table 3 we describe the intersection of each line with Qc and with its interior. The\nsubscript c is omitted.\nLast, we need the intersection points of three planes of Ic ; or, of a plane and a line. Some\nare not in Qc at all; them we can ignore. Some are on the boundary of Qc ; they are necessary\n16\n\n\f\u03c01\n\u03c02\n\u03c03\n\n\u03c02\n\n\u03c03\n\n\u03c04\n\n\u03c05\n\n\u03c06\n\n\u03c07\n\nOE \u2032\u2032\n(OBC)\n\nE \u2032\u2032\n(BC)\nAE \u2032\u2032\n(ABC)\n\nE \u2032\u2032\n(BC)\nE \u2032\u2032\n(BC)\nDE \u2032\u2032\n(OBC)\n\nOE\n(OAB)\n\nF G\u2032\n\nEF\n\nOG\n\nFG\n\nAF\n\nDG\u2032\u2032\n\n\u03c04\n\nDE \u2032\n(OAC)\n\nAD\n(OAC)\nD\n(OC)\n\nl356\n\nED\n\nl356 : DG\n\n\u03c05\n\nBD\n(OBC)\n\n\u03c06\n\nTable 3. The intersections of lines with Q and Q\u25e6 . The second (parenthesized) row in each box shows the smallest face of Q to which the intersection\nbelongs, if that is not Q itself; these intersections are not part of the intersection poset of (Q\u25e6 , I).\n\nin finding the denominator, but all of them are points already listed in (19). It turns out\nthat\n\u03c02 \u2229 \u03c05 \u2229 \u03c07 = Hc\nis the only vertex in Q\u25e6c , so it is the only one we need for the intersection poset.\nHere, then, is the intersection poset (Figure 1). The subscript c is omitted. In the figure,\nfor simplicity, we write \u03c0j , etc., when the actual element is the simplex \u03c0j \u2229 Q\u25e6 , etc.; we also\nstate the vertices of the simplex. The M\u00f6bius function \u03bc(0\u0302, u) equals (\u22121)codim u with the\nexception of \u03bc(0\u0302, l356 ) = 2.\n\n4.1.4. Generating functions and the quasipolynomial. That was the first half of the work.\n\u25e6\nThe second half begins with finding rc (w) = E(Q\n\u25e6 ,I ) (w) from the Ehrhart generating funcc c\ntions Eu (t) of the intersections by means of (6). The next step, then, is to calculate all\nnecessary generating functions. This is done by LattE. rc (x) is the result of applying reciprocity to the sum of all these rational functions (with the appropriate M\u00f6bius-function\n17\n\n\fg replacements\n\nL(Q\u25e6, I)\n\nH\n\nl45 (DG\u2032\u2032 ) l16 (F G\u2032 ) l17 (EF )\n\n\u03c04 (DE \u2032\u2032 E \u2032 )\n\n\u03c01 (OEE \u2032\u2032 )\n\nl356 (DG)\n\n\u03c06 (BDE \u2032 )\n\nl26 (F G)\n\n\u03c05 (OCE)\n\nl57 (ED) l25 (OG) l27 (AF )\n\n\u03c03 (ADE \u2032\u2032 )\n\n\u03c07 (ABD)\n\n\u03c02 (OAE \u2032\u2032 )\n\nR3 (OABC)\nFigure 1. The intersection poset L(Q\u25e6 , I) for semimagic squares. The diagram shows both the flats and (in parentheses) their intersections with Q.\n\nmultiplier \u22121, excepting EDG\u25e6 (x) whose multiplier is \u22122). The result is:\n\u2212rc (1/x) = EOABC (x) + EOEE \u2032\u2032 (x) + EOAE \u2032\u2032 (x)\n+ EADE \u2032\u2032 (x) + EDE \u2032E \u2032\u2032 (x) + EOCE (x)\n+ EBDE \u2032 (x) + EABD (x) + EF G\u2032 (x)\n+ EEF (x) + EOG (x) + EF G (x)\n+ EAF (x) + 2EDG (x) + EDG\u2032\u2032 (x)\n+ EDE (x) + EH (x)\n1\n1\n1\n+\n+\n=\n3\n2\n2\n3\n(1 \u2212 x) (1 \u2212 x ) (1 \u2212 x)(1 \u2212 x )(1 \u2212 x ) (1 \u2212 x)(1 \u2212 x2 )2\n1\n1\n1\n+\n+\n+\n2\n3\n2\n2\n3\n2\n(1 \u2212 x )\n(1 \u2212 x ) (1 \u2212 x ) (1 \u2212 x) (1 \u2212 x3 )\n1\n1\n1\n+\n+\n+\n2\n3\n2\n2\n3\n(1 \u2212 x)(1 \u2212 x )(1 \u2212 x ) (1 \u2212 x)(1 \u2212 x )\n(1 \u2212 x )(1 \u2212 x5 )\n1\n1\n1\n+\n+\n+\n(1 \u2212 x3 )2 (1 \u2212 x)(1 \u2212 x4 ) (1 \u2212 x3 )(1 \u2212 x4 )\n1\n1\n1\n+2\n+\n+\n2\n3\n2\n4\n2\n(1 \u2212 x )(1 \u2212 x )\n(1 \u2212 x )(1 \u2212 x ) (1 \u2212 x )(1 \u2212 x5 )\n1\n1\n+\n+\n.\n2\n3\n(1 \u2212 x )(1 \u2212 x ) 1 \u2212 x5\n18\n\n(20)\n\n\fThen by (16) the generating function for cubically counted semimagic squares is\nSc (x) = 72\n\nx2\nrc (x)\n(1 \u2212 x)2\n\n72x10 [18 x9 + 46 x8 + 69 x7 + 74 x6 + 65 x5 + 46 x4 + 26 x3 + 11 x2 + 4 x + 1]\n.\n(1 \u2212 x2 )2 (1 \u2212 x3 )2 (1 \u2212 x4 )(1 \u2212 x5 )\n(21)\nFrom the geometrical denominator 60 or the (standard-form) algebraic denominator (1 \u2212\nx60 )5 we know the period of Sc (t) divides 60. We compute the constituents of Sc (t) by the\nmethod of Section 2.1; the result is that\n\uf8f1\n3 5 75 4 331 3 5989 2\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f2 10 t \u2212 8 t + 3 t \u2212 10 t + c1 (t)t \u2212 c0 (t), if t is even;\nSc (t) =\n(22)\n\uf8f4\n\uf8f4\n3\n75\n331\n11933\n\uf8f4\n\uf8f3 t5 \u2212 t4 +\nt3 \u2212\nt2 + c1 (t)t \u2212 c0 (t), if t is odd;\n10\n8\n3\n20\nwhere c1 varies with period 6, given by\n\uf8f1\n1464, if t \u2261 0, 2\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f21456, if t \u2261 4\n(mod 6);\nc1 (t) = 2831\n\uf8f4\n, if t \u2261 1\n\uf8f4\n2\n\uf8f4\n\uf8f3 2847\n, if t \u2261 3, 5\n2\n=\n\nand c0 , given by Table 4, varies with period 60. (It is curious that the even constant terms\nhave half the period of the odd terms.) Thus the period of Sc turns out to be 60, the largest\nit could be.\nThe principal constituent (for t \u2261 0) is\n3 5 75 4 331 3 5989 2\nt \u2212 t +\nt \u2212\nt + 1464t \u2212 1296.\n10\n8\n3\n10\nIts unsigned constant term, 1296, is the number of order types of semimagic squares. Allowing for the 72 symmetries of a semimagic square, there are just 18 symmetry classes of\norder types.\nFor the first few nonzero values of Sc (t) see the following table. (This is sequence A173546\nin the OEIS [15].) The third row is the number of normalized squares, or symmetry classes\n(sequence A173723), which equals Sc (t)/72. The other lines give the numbers of reduced\nsquares (sequence A173727) and of reduced normal squares (i.e., symmetry types of reduced\nsquares; sequence A173724), which may be of interest.\nt\nSc (t)\nsc (t)\nRc (t)\nrc (t)\n\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n0\n0\n72 288 936 2592 5760 11520 20952 35712 57168 88272\n0\n0\n1\n4\n13\n36\n80\n160\n291\n496\n794\n1226\n72 144 432 1008 1512 2592 3672 5328 6696 9648 11736 15552\n1\n2\n6\n14\n21\n36\n51\n74\n93\n134\n163\n216\n\nCompare the strong to the weak quasipolynomial. The leading coefficients agree and\nthe strong coefficient of t4 is constant. These facts, of which we made no use in deducing\nthe quasipolynomial, provide additional verification of the correctness of the counts and\nconstituents.\n19\n\n\ft\n\nc0 (t)\n\nt\n\nc0 (t)\n\nt\n\nc0 (t)\n\nt\n\nc0 (t)\n\nt\n\nc0 (t)\n\n0\n\n1296\n\n12\n\n1296\n\n24\n\n36\n\n110413\n120\n3824\n3\n47727\n40\n18152\n15\n25705\n24\n6192\n5\n25193\n24\n19552\n15\n44847\n40\n3544\n3\n130253\n120\n\n13\n\n120781\n120\n19552\n15\n9315\n8\n16856\n15\n25705\n24\n6624\n5\n129421\n120\n3824\n3\n41391\n40\n3544\n3\n140621\n120\n\n25\n\n6192\n5\n23465\n24\n19552\n15\n47727\n40\n3544\n3\n121613\n120\n\n48\n\n1\n\n6624\n5\n23465\n24\n18256\n15\n9315\n8\n18152\n15\n131981\n120\n\n30\n\n1296\n\n42\n\n1296\n\n54\n\n31\n\n119053\n120\n3824\n3\n44847\n40\n18152\n15\n27433\n24\n\n43\n\n129421\n120\n19552\n15\n8739\n8\n16856\n15\n27433\n24\n\n55\n\n6624\n5\n120781\n120\n3824\n3\n44271\n40\n3544\n3\n131981\n120\n6624\n5\n25193\n24\n18256\n15\n8739\n8\n18152\n15\n140621\n120\n\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n26\n27\n28\n29\n\n32\n33\n34\n35\n\n37\n38\n39\n40\n41\n\n44\n45\n46\n47\n\n49\n50\n51\n52\n53\n\n56\n57\n58\n59\n\nTable 4. Constant terms (without the negative sign) of the constituents of\nthe semimagic cubical quasipolynomial Sc (t).\n\n4.1.5. Another method: Direct counting. We checked the constituents by directly counting\n(in Maple) all semimagic squares for t \u2264 100. The numbers agreed with those derived from\nthe generating function and quasipolynomial above.\n4.2. Semimagic squares: Affine count (by magic sum). Now we count squares by\nmagic sum: we compute Sa (t), the number of squares with magic sum t.\n4.2.1. The Birkhoff polytope. The polytope P for semimagic squares of order 3, counted by\nmagic sum, is 4-dimensional and integral. (It is the polytope of doubly stochastic matrices\nof order 3, i.e., a Birkhoff polytope [8, 4].)\n4.2.2. Affine weak semimagic. The polytope for weak semimagic squares of order 3 is the\nsame P .\nThe weak quasipolynomial, or rather, polynomial, first computed by MacMahon [12, Vol.\nII, par. 407, p. 161], is\nt4 \u2212 6t3 + 15t2 \u2212 18t + 8\n(t \u2212 1)(t \u2212 2)(t2 \u2212 3t + 4)\n=\n8\n8\nwith generating function\n6x4 \u2212 9x3 + 10x2 \u2212 5x + 1\n.\n(1 \u2212 x)5\n20\n\n\f4.2.3. Reduction. The count is via Ra (s), the number of reduced squares with magic sum s.\nThe formula is\nX\nSa (t) =\nRa (s)\nif t > 0.\n(23)\n0<s\u2264t\u22123\ns\u2261t (mod 3)\n\nWe have Ra (s) = 72ra (w), where ra (s) is the number of reduced, normalized squares with\nmagic sum s, equivalently the number of 1s -integral points in the interior of the 3-dimensional\npolytope Qa defined by\n1\n(24)\n0 \u2264 x, y;\n0 \u2264 z \u2264 y;\nx+y \u2264\n2\nwith the seven excluded (hyper)planes\ny \u2212 x y 1 \u2212 y \u2212 2x 1 \u2212 x \u2212 y\nz=\n, ,\n,\n, y \u2212 x, 1 \u2212 x \u2212 2y, 1 \u2212 2x \u2212 2y ,\n(25)\n2\n2\n2\n2\nthe three coordinates being x = \u03b1/s, y = \u03b2/s, and z = \u03b4/s.\nThe hyperplane arrangement for reduced, normalized squares is that of (25). We call it\nIa . Thus ra (s) = EQ\u25e6 \u25e6a ,Ia (s).\n4.2.4. The reduced, normalized weak polytopal quasipolynomial.\nThis function simply counts\nP P P\n1\n\u25e6\n-lattice points in Qa . The counting formula is \u03b1 \u03b2 \u03b4 1, summed over all triples that\ns\nsatisfy (14). It simplifies to\nX \u0012\u230a s\u22121 \u230b \u2212 \u03b1\u0013\n2\n,\n2\n\u03b1\nwhich gives the Ehrhart quasipolynomial\n\uf8f1\u0012 s\u22121 \u0013\n\uf8f4\n\uf8f4 2\n=\n\uf8f4\n\u0012 s\u22121 \u0013 \uf8f4\n\uf8f2 3\n\u230a 2 \u230b\n=\nEQ\u25e6a (s) =\n\u0012 s\u22122 \u0013\n\uf8f4\n3\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f3 2\n=\n3\n\n1\n(s\n48\n\n\u2212 1)(s \u2212 3)(s \u2212 5), for odd s;\n(26)\n\n1\n(s\n48\n\n\u2212 2)(s \u2212 4)(s \u2212 6), for even s.\n\nThe leading coefficient is vol Qa .\nWe deduce from (26) that\n\nEP \u25e6 (x) =\n\nx7 (1 + x)\n(1 \u2212 x2 )4\n\nEP (x) =\n\n1+x\n.\n(1 \u2212 x2 )4\n\nand by reciprocity that\n\n4.2.5. Geometrical analysis of the reduced, normalized polytope. We apply M\u00f6bius inversion,\nEquation (6), over the intersection poset L(Q\u25e6a , I).\nWe number the planes:\n\u03c01\n\u03c02\n\u03c03\n\u03c04\n\n: x \u2212 y + 2z\n:\ny \u2212 2z\n: 2x + y + 2z\n: x + y + 2z\n21\n\n= 0,\n= 0,\n= 1,\n= 1,\n\n\f\u03c05 :\nx \u2212 y + z = 0,\n\u03c06 : x + 2y + z = 1,\n\u03c07 : 2x + 2y + z = 1.\nThe intersection of two planes, \u03c0j \u2229 \u03c0k , is a line we call ljk ; \u03c03 \u2229 \u03c05 \u2229 \u03c06 is a line we also\ncall l356 . The intersection of three planes is, in general, a point but not usually a vertex of\n(Qa , Ia ). Our geometrical notation is as in the cubical analysis.\nWe need to find the intersections of the planes with Q\u25e6a , separately and in combination.\nHere is a list of significant points; we shall see it is the list of vertices of (Qa , Ia ). The first\ncolumn has the vertices of Qa , the second the vertices of (Qa , Ia ) that lie in open edges, the\nthird the vertices that lie in open facets, and the last is the sole interior vertex.\nO = (0, 0, 0),\n\nDa = (0, 13 , 31 ) \u2208 OC,\n\nFa = (0, 25 , 51 ) \u2208 OBC,\n\nA = ( 21 , 0, 0),\n\nEa = ( 14 , 14 , 0) \u2208 AB,\n\nGa = ( 61 , 62 , 16 ) \u2208 ABC,\n\nBa = (0, 21 , 0),\n\nEa\u2032 = ( 41 , 14 , 41 ) \u2208 AC,\n\nG\u2032a = ( 81 , 83 , 18 ) \u2208 ABC,\n\nCa = (0, 21 , 21 ),\n\nEa\u2032\u2032 = (0, 21 , 41 ) \u2208 BC,\n\nG\u2032\u2032a = ( 81 , 83 , 28 ) \u2208 ABC.\n\nHa = ( 71 , 27 , 71 ),\n(27)\n\nThe least common denominator of O, A, Ba , Ca explains the period 2 of EQ\u25e6a . The denominator of (Qa , Ia ) is the least common denominator of all the points; it evidently equals\n8 * 3 * 5 * 7 = 840.\nThe intersections of the planes with the edges of Qa are in Table 1. Table 5 shows the\nlines generated by pairwise intersection of planes. Table 3 describes the intersection of each\nline with Qa and with Q\u25e6a .\n\u03c02\n\u03c01\n\u03c02\n\u03c03\n\n\u03c03\n\nx=0\n\nx=\n\ny = 2z\n\ny=\nx+y\n\n1\u22124z\n3\n1+2z\n3\n= 21\n\ny = 2z\n\n\u03c04\n\n\u03c05\n\n\u03c06\n\nx=y\n\nx = 2 \u2212 5y\n\nx=\n\nz =0\n\nz = 3y \u2212 1\n\ny=\n\nx = 1 \u2212 2y\n\nx=z\n\nx = 1 \u2212 5z\n\nx=\n\ny = 2z\n\ny = 2z\n\ny = 2z\n\ny = 2z\n\nx + 2z =\ny=\n\n1\n2\n1\n2\n\nx=0\n\nl356 :\n\ny = 1 \u2212 2z\n\n\u03c04\n\u03c05\n\nx+z =\ny=\n\n1\n3\n1\n3\n\nx = 3y \u2212 1\n\nx = 1 \u2212 3y\n\nz = 1 \u2212 2y\n\nz =y\nl356\n\n\u03c07\n1\u22125z\n4\n1+3z\n4\n1\u22125z\n2\n\n2x + 3y = 1\nz =y\nx+y =\nz=\n\n1\n3\n1\n3\n\nx = 1 \u2212 3y\nz = 4y \u2212 1\nx=0\n\n\u03c06\n\nz = 1 \u2212 2y\nTable 5. The equations of the pairwise intersections of planes of Ia .\n\nLast, we need the intersection points of three planes of Ia ; or, of a plane and a line. Some\nare not in Qa at all; them we can ignore. Some are on the boundary of Qa ; they are necessary\n22\n\n\fin finding the denominator, but all of them are points already listed in (27). It turns out\nthat\n\u03c02 \u2229 \u03c05 \u2229 \u03c07 = Ha\nis the only vertex in Q\u25e6a , so it is the only one we need for the intersection poset.\nThe combinatorial structure and the intersection poset (Figure 1) for the affine count are\nidentical to those for the cubical count. The reason is that the affine polytope Pa is the\n4-dimensional section of Pc by the flat in which the magic sum equals 1, and this flat is\northogonal to the line of intersection of the whole arrangement Ha .\n4.2.6. Generating functions and the quasipolynomial. The second half of the affine solution is\nto find ra (s) = E\u25e6(Q\u25e6a ,Ia ) (s) by applying Equations (1)\u2013(4) after finding the Ehrhart generating\nfunctions Eu (s) for u \u2208 L(Q\u25e6a , Ia ). The next step, then, is to calculate those generating\nfunctions. This is done by LattE. Then (\u22121)3 ra (x\u22121 ) is the sum of all these rational functions;\nthat is,\n\u2212ra (1/x) = EOABC (x) + EOEE \u2032\u2032 (x) + EOAE \u2032\u2032 (x)\n+ EADE \u2032\u2032 (x) + EDE \u2032\u2032E \u2032 (x) + EOCE (x)\n+ EBDE \u2032 (x) + EABD (x) + EF G\u2032 (x)\n+ EEF (x) + EOG (x) + EF G (x)\n+ EAF (x) + 2EDG (x) + EDG\u2032\u2032 (x)\n+ EDE (x) + EH (x)\n1\n1\n1\n=\n+\n+\n2\n3\n4\n2\n(1 \u2212 x)(1 \u2212 x )\n(1 \u2212 x)(1 \u2212 x )\n(1 \u2212 x)(1 \u2212 x2 )(1 \u2212 x4 )\n1\n1\n1\n+\n+\n+\n2\n3\n4\n3\n4\n2\n(1 \u2212 x )(1 \u2212 x )(1 \u2212 x ) (1 \u2212 x )(1 \u2212 x )\n(1 \u2212 x)(1 \u2212 x2 )(1 \u2212 x4 )\n1\n1\n1\n+\n+\n+\n2\n3\n4\n2\n2\n3\n5\n(1 \u2212 x )(1 \u2212 x )(1 \u2212 x ) (1 \u2212 x ) (1 \u2212 x ) (1 \u2212 x )(1 \u2212 x8 )\n1\n1\n1\n+\n+\n+\n4\n5\n6\n5\n(1 \u2212 x )(1 \u2212 x ) (1 \u2212 x)(1 \u2212 x ) (1 \u2212 x )(1 \u2212 x6 )\n1\n1\n1\n+\n+\n2\n+\n(1 \u2212 x2 )(1 \u2212 x5 )\n(1 \u2212 x3 )(1 \u2212 x6 ) (1 \u2212 x3 )(1 \u2212 x8 )\n1\n1\n+\n.\n+\n(1 \u2212 x3 )(1 \u2212 x4 ) 1 \u2212 x7\n(28)\nThe generating function for the affine count of semimagic squares, by (23), is\nSa (x) = 72\n72x15\n\n(\n\nx3\nra (x) =\n1 \u2212 x3\n\n18x21 + 5x20 + 15x19 + 11x17 \u2212 8x16 + x15 \u2212 23x14 \u2212 13x13 \u2212 22x12 \u2212 9x11\n\u2212 16x10 + x9 \u2212 3x8 + 7x7 + 7x6 + 9x5 + 7x4 + 6x3 + 4x2 + 2x + 1\n(1 \u2212 x3 )2 (1 \u2212 x4 )(1 \u2212 x5 )(1 \u2212 x6 )(1 \u2212 x7 )(1 \u2212 x8 )\n\n)\n\n.\n(29)\n\n23\n\n\fFrom the geometrical or generating-function denominator we know that the period of\nSa (t) divides 840 = lcm(3, 4, 6, 7, 8). This is long, but it can be simplified. The factor 7 in\nthe period is due to a single term in (28). If we treat it separately we have ra as a sum\nx7\nof the H-term x7 /(1 \u2212 x7 ) and a \"truncated\" generating function for ra (x) + 1\u2212x\n7 , and a\ncorresponding truncated expression\nx10\n=\n(1 \u2212 x3 )(1 \u2212 x7 )\n)\n(\n17x19 + 5x18 + 15x17 + x16 + 12x15 \u2212 7x14 + 2x13 \u2212 7x12\n\nSa (x) \u2212 72\n\u221272x10\n\n\u2212 8x11 \u2212 9x10 \u2212 9x9 \u2212 6x8 \u2212 6x7 \u2212 x6 + x4 + x3 \u2212 1\n\n(1 \u2212 x3 )2 (1 \u2212 x4 )(1 \u2212 x5 )(1 \u2212 x6 )(1 \u2212 x8 )\n\n.\n\nWe extract the constituents from this expression as in Section 2.1, separately for the two\nparts of the generating function. The constituents are all of the form\n9\n1\nSa (t) = t4 \u2212 t3 + a2 (t)t2 \u2212 a1 (t)t + a0 (t) \u2212 72S7 (t),\n8\n2\nwhere S7 (t) is a correction, to be defined in a moment, and\n\uf8f1 243\n, if t \u2261 0\n\uf8f4\n\uf8f4\n4\n\uf8f4\n\uf8f2 218 , if t \u2261 1, 5\n4\n(mod 6);\na2 (t) = 227\n\uf8f4\n, if t \u2261 2, 4\n\uf8f4\n4\n\uf8f4\n\uf8f3 234\n, if t \u2261 3\n4\n\uf8f1 1968\n,\n\uf8f4\n5\n\uf8f4\n\uf8f4 1158\n\uf8f4\n\uf8f4\n,\n\uf8f4\n5\n\uf8f4\n\uf8f4\n1383\n\uf8f4\n,\n\uf8f4\n\uf8f4\n5\n\uf8f4 1653\n\uf8f2\n,\n5\na1 (t) = 1428\n\uf8f4\n,\n\uf8f4\n5\n\uf8f4\n\uf8f4\n1923\n\uf8f4\n,\n\uf8f4\n\uf8f4\n5\n\uf8f4\n\uf8f4\n1113\n\uf8f4\n,\n\uf8f4\n5\n\uf8f4\n\uf8f3 1698\n,\n5\n\nif\nif\nif\nif\nif\nif\nif\nif\n\nt\u22610\nt \u2261 1, 5\nt \u2261 2, 10\nt\u22613\nt \u2261 4, 8\nt\u22616\nt \u2261 7, 11\nt\u22619\n\n(30)\n\n(mod 12);\n\nand a0 (t) is given in Table 6.\nWe call the constituents of the quasipolynomial\n1\n9\nSa (t) + 72S7 (t) = t4 \u2212 t3 + a2 (t)t2 \u2212 a1 (t)t + a0 (t)\n8\n2\nthe truncated constituents of Sa (t), since they correspond to the truncated generating function mentioned just above. The S7 term that undoes the truncation is\n\u0017 (\n\u0016\nt\u22121\n1, if t \u2261 10, 13, 16, 17, 19, 20 (mod 21);\n+\nS7 (t) :=\n21\n0, otherwise\n=\n\nt \u2212 t\u0304\n+ s7 (t),\n21\n24\n\n\fwhere t\u0304 := the least positive residue of t modulo 7 and\n(\n1, if t \u2261 10, 13, 16, 17, 19, 20 (mod 21);\ns7 (t) :=\n0, otherwise.\nNote that t\u0304 = 21 if t \u2261 0, so that S7 (0) = \u22121 and in general S7 (21k) = k \u2212 1.\nt a0 (t)\n\nt a0 (t)\n\nt a0 (t)\n\nt a0 (t)\n\nt a0 (t)\n\nt a0 (t)\n\n0 1224\n\n20\n\n524\n\n40\n\n584\n\n60 1188\n\n80\n\n560\n\n100\n\n548\n\n21\n\n31419\n40\n1741\n5\n827\n40\n5832\n5\n2143\n8\n1513\n5\n26523\n40\n2164\n5\n8891\n40\n\n41\n\n29979\n40\n1921\n5\n\u2212613\n40\n5652\n5\n2431\n8\n1333\n5\n27963\n40\n2344\n5\n7451\n40\n\n101\n\n69\n\n8699\n40\n1621\n5\n24507\n40\n2632\n5\n1951\n8\n4833\n5\n3803\n40\n2044\n5\n32571\n40\n\n81\n\n49\n\n6299\n40\n5121\n5\n347\n40\n2332\n5\n6975\n8\n1453\n5\n4283\n40\n5544\n5\n8411\n40\n\n61\n\n9\n\n7259\n40\n1801\n5\n23067\n40\n2452\n5\n2239\n8\n4653\n5\n5243\n40\n2224\n5\n31131\n40\n\n109\n\n7739\n40\n4941\n5\n1787\n40\n2512\n5\n6687\n8\n1633\n5\n2843\n40\n5364\n5\n9851\n40\n\n10\n\n413\n\n30 1017\n\n50\n\n389\n\n70\n\n377\n\n90 1053\n\n110\n\n353\n\n11\n\n539\n40\n5796\n5\n7547\n40\n1477\n5\n5823\n8\n2488\n5\n8603\n40\n4689\n5\n2651\n40\n\n31\n\n2939\n40\n2656\n5\n28827\n40\n1777\n5\n799\n8\n5508\n5\n11003\n40\n1189\n5\n26811\n40\n\n51\n\n24219\n40\n2596\n5\n6587\n40\n4797\n5\n1279\n8\n2368\n5\n32283\n40\n1489\n5\n1691\n40\n\n71\n\n1979\n40\n5976\n5\n6107\n40\n1657\n5\n5535\n8\n2308\n5\n10043\n40\n4509\n5\n4091\n40\n\n91\n\n1499\n40\n2476\n5\n30267\n40\n1597\n5\n1087\n8\n5688\n5\n9563\n40\n1369\n5\n25371\n40\n\n111\n\n25659\n40\n2776\n5\n5147\n40\n4977\n5\n991\n8\n2188\n5\n33723\n40\n1309\n5\n3131\n40\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n12\n13\n14\n15\n16\n17\n18\n19\n\n22\n23\n24\n25\n26\n27\n28\n29\n\n32\n33\n34\n35\n36\n37\n38\n39\n\n42\n43\n44\n45\n46\n47\n48\n\n52\n53\n54\n55\n56\n57\n58\n59\n\n62\n63\n64\n65\n66\n67\n68\n\n72\n73\n74\n75\n76\n77\n78\n79\n\n82\n83\n84\n85\n86\n87\n88\n89\n\n92\n93\n94\n95\n96\n97\n98\n99\n\n102\n103\n104\n105\n106\n107\n108\n\n112\n113\n114\n115\n116\n117\n118\n119\n\nTable 6. Constant terms of the truncated constituents of Sa (t).\nThe period of the constant term of the truncated constituents is 120. It follows that Sa (t)\nhas period 7 * 840, that is, 840.\nThe principal constituent of Sa (t) (that is, for t \u2261 0) is\n1 4 9 3 243 2 13896\nt \u2212 t +\nt \u2212\nt + 1296.\n8\n2\n4\n35\n25\n\n\f(This incorporates the effect of the term \u221272S7 .) The constant term is the same as in the\ncubic count, as it is the number of order types of semimagic squares.\nWe give the first few nonzero values of Sa (t) in the following table. (This sequence is\nA173547 in the OEIS [15].) The third row is the number of normalized squares, or symmetry\nclasses (sequence A173725); this is Sa (t)/72. The last rows are the numbers of reduced\nsquares (sequence A173728) and of reduced, normalized squares (sequence A173726) with\nmagic sum t.\nt 12 13 14 15 16\n17\n18\n19\n20\n21\n22\n23\n24\nSa (t) 0\n0\n0\n72 144 288 576 864 1440 2088 3024 3888 5904\nsa (t) 0\n0\n0\n1\n2\n4\n8\n12\n20\n29\n42\n54\n82\nRa (t) 72 144 288 504 720 1152 1512 2160 2448 3816 3960 5544 6264\nra (t) 1\n2\n4\n7\n10\n16\n21\n30\n34\n53\n55\n77\n87\n4.2.7. Alternative methods: Direct counting and direct computation. We verified our formulas\nby computing Sa (t) for t \u2264 100 through direct enumeration of normal squares. The results\nagree with those computed by expanding the generating function.\nWe also applied Proposition 1 to derive a formula, independent of all other methods, by\nwhich we calculated numbers (which we are not describing; see the \"Six Little Squares\" Web\npage [7]) that allowed us to find the 840 constituents by interpolation. These interpolated\nconstituents fully agreed with the ones given above.\n5. Magilatin squares of order 3\nA magilatin square is like a semimagic square except that entries may be equal if they\nare in different rows and columns. The inside-out polytope is the same as with semimagic\nsquares except that we omit those hyperplanes that prevent equality of entries in different\nrows and columns. Thus, in our count of reduced squares, we have to count the fractional\nlattice points in some of the faces of the polytope.\nThe reduced normal form of a magilatin square is the same as that of a semimagic square\nexcept that the restrictions are weaker. It might be thought that this would introduce\nambiguity into the standard form because the minimum can occur in several cells, but it\nturns out that it does not.\nProposition 2. A reduced, normal 3 \u00d7 3 magilatin square has the form (13) with the restrictions\n0 < \u03b2, \u03b3;\n0 \u2264 \u03b1;\n(31)\n0 \u2264 \u03b4 \u2264 \u03b2;\nand (15). Each reduced square with w in the upper right corner corresponds to exactly\nt \u2212 w \u2212 1 different magilatin squares with entries in the range (0, t), for 0 < w < t. Each\nreduced square with magic sum s corresponds to one magilatin square with magic sum equal\nto t, if t \u2261 s (mod 3), and none otherwise, for 0 < s < t.\nProof. The proof is similar to that for semimagic squares; we can arrange the square by\npermuting rows and columns and by reflection in the main diagonal so that x11 is the\nsmallest entry, the first row and column are each increasing, and x21 \u2265 x12 . We cannot say\nx21 > x12 because entries that do not share a row or column may be equal. Still, we obtain\n26\n\n\fthe form (13) with the bounds (31) and the same inequations (15) as in semimagic because\nall the latter depend on having no two equal values in the same line (row or column).\n\u0004\nEach reduced, normal magilatin square gives rise to a family of true magilatin squares by\nadding a positive constant to each entry and by symmetries, which are generated by row\nand column permutations and reflection in the main diagonal. Call the set of symmetries\nG. As with semimagic, |G| = 2(3!)2 = 72. Each normal, reduced square S gives rise to\n|G/GS | = 72/|GS | squares via symmetries, where GS is the stabilizer subgroup of S. If all\nentries are distinct, then the square is semimagic, GS is trivial, and everything is as with\nsemimagic squares. However, if \u03b1 = 0 or \u03b4 = 0 or \u03b4 = \u03b2, the stabilizer is nontrivial. We\nconsider each case in turn.\nThe case \u03b1 = 0 < \u03b4. Here \u03b4 < \u03b2 because no line can repeat a value. To fix the square we\ncannot permute any rows or columns but we can reflect in the main diagonal, so |GS | = 2.\nMoreover, (15) reduces to\n\u03b2 \u03b2+\u03b3\n\u03b4 6= \u03b3, ,\n.\n2\n2\nWe are in OBC, the x = 0 facet of Q, with the induced arrangement of three lines, Ix=0 .\nThe number of reduced magilatin squares of this kind is 36rOBC (t), where rOBC (t) is the\nnumber of 1t -lattice points in the open facet and, equivalently, the number of symmetry types\nof reduced magilatin squares of this kind. We apply Equations (1)\u2013(4) to the intersection\nposet L(OBC \u25e6 , Ix=0), which is found in Figure 2. The M\u00f6bius function \u03bc(OBC, u) equals\n(\u22121)codim u .\nThe case \u03b4 = 0 < \u03b1. In this case a nontrivial member of GS can only exchange the two\nzero positions. Such a symmetry that preserves the increase of the first row and column is\nunique (as one can easily see); thus |GS | = 2. Furthermore, (15) reduces to\n\u03b1 6= \u03b2.\nWe are in OAB, the z = 0 facet, with the induced arrangement Iz=0 of one line. The number\nof reduced magilatin squares of this kind is 36rOAB (t), where rOAB (t) is the number of 1t lattice points in the open facet and, equivalently, the number of symmetry types of reduced\nsquares. We apply Equations (1)\u2013(4) to the intersection poset L(OAB \u25e6 , Iz=0), shown in\nFigure 2. The M\u00f6bius function \u03bc(OAB, u) equals (\u22121)codim u .\nThe case \u03b4 = \u03b2. Here we must have \u03b1 > 0. There are two zero positions in opposite\ncorners. A symmetry that exchanges them and preserves increase in the first row and column\nis uniquely determined, so |GS | = 2. The inequations reduce to\n\u03b2 6= \u03b3, \u03b1 + \u03b3.\nWe are in OAC, the facet where y = z, with the two-line induced arrangement Iy=z . The\nnumber of reduced magilatin squares of this kind is 36rOAC (t), where rOAC (t) is the number\nof 1t -lattice points in the open facet, equally the number of reduced symmetry types. We\napply Equations (1)\u2013(4) to the intersection poset L(OAC \u25e6 , Iy=z ) in Figure 2. The M\u00f6bius\nfunction \u03bc(OAC, u) equals (\u22121)codim u .\nThe case \u03b1 = 0 = \u03b4. In these squares there are three zero positions and the whole square\nis a cyclic latin square. Any symmetry that fixes the zero positions also fixes the rest of\nthe square. There are 3! symmetries that permute the zero positions, generated by row\nand column permutations. They all preserve the entire square. Therefore |GS | = 6. The\ninequations disappear. We are in the edge OB, which is the face where x = z = 0, with the\n27\n\n\fPSfrag replacements\n\nF\nOE\n\nAD\n\nDE\n\n\u2032\n\nOE \u2032\u2032\nOAB\n\nBD\n\nDE \u2032\u2032\n\nOAC\nOBC\n\nL(OAB \u25e6, Iz=0)\n\nL(OAC \u25e6, Iy=z )\n\nG\u2032\n\nL(ABC \u25e6, Ix+y=1/2)\n\nEE \u2032\u2032\n\nL(OBC \u25e6, Ix=0)\n\nG\u2032\u2032\n\nG\n\nBE \u2032\n\nAE \u2032\u2032\n\nCE\n\nE \u2032 E \u2032\u2032\n\nABC\nFigure 2. The four facet intersection posets of (Q\u25e6 , I).\n\nempty arrangement, Ix=z=0 = \u2205. The number of reduced magilatin squares of this kind is\n12rOB (t), where rOB (t) is the number of 1t -lattice points in the open edge, also the number\nof reduced symmetry types. The intersection poset L(OB \u25e6 , \u2205) consists of the one element\nOB, whose M\u00f6bius function \u03bc(OB, OB) = 1.\nTo get the intersection posets we may examine Tables 1 and 3 to find the edges and vertices\nof (Q\u25e6 , I) in each closed facet. We also need to know which vertex is in which edge; this is\neasy. Although we do not need the fourth facet, ABC, we include it for the interest of its\nmore complicated geometry.\nOf course all the functions rs and Rml depend on whether we are counting cubically or\naffinely (thus, subscripted c or a); the two types will be treated separately. But the general\nconclusions hold that\nRml (x) = 72rs (x) + 36[rOAB (x) + rOAC (x) + rOBC (x)] + 12rOB (x),\n\n(32)\n\nand for the number of reduced symmetry types, rml (t) with generating function rml (x),\nrml (x) = rs (x) + rOAB (x) + rOAC (x) + rOBC (x) + rOB (x),\n28\n\n(33)\n\n\fwhere rs (x) is from semimagic and, by Equation (4) since |\u03bc(X, Y )| = 1 for every lower\ninterval in each facet poset (except facet ABC, which we do not use),\n(\u22121)3 rOAB (1/x) = EOAB (x) + EOE (x),\n(\u22121)3 rOAC (1/x) = EOAC (x) + EAD (x) + EDE \u2032 (x),\n(\u22121)3 rOBC (1/x) = EOBC (x) + EOE \u2032\u2032 (x) + EBD (x) + EDE \u2032\u2032 (x) + EF (x),\n\n(34)\n\n(\u22121)2 rOB (1/x) = EOB (x);\nthe sign and reciprocal on the left result from Equation (6).\nThere is also the generating function of the number of cubical or affine symmetry classes,\nl(t), whose generating function is l(x). This is obtained from rml (t) in the same way as L(t)\nis from Rml (t), the exact way depending on whether the count is affine or cubic.\n5.1. Magilatin squares: Cubical count (by upper bound). The weak quasipolynomial\nis exactly as in the semimagic cubical problem.\n\n5.1.1. Magilatin squares by upper bound. The number of 3 \u00d7 3 magilatin squares with strict\nupper bound t is Lc (t). We count them via Rmlc (w), the number of reduced magilatin squares\nwith largest entry (which we know to be x13 ) equal to w. The formula is\nLc (t) =\n\nt\u22121\nX\n\n(t \u2212 1 \u2212 w)Rmlc(w).\n\n(35)\n\nw=0\n\nEquivalently, Rmlc (w) counts w1 -integral points in the interior and part of the boundary of\nthe inside-out polytope (Qc , Ic ) of Section 4.1, weighted variably by 72/|GS |.\nNow we must calculate the closed Ehrhart generating function for each necessary face.\nThis is done by LattE; here are the results. First, OABc :\n(\u22121)3 rOABc (1/x) = EOABc (x) + EOEc (x)\n1\n1\n+\n=\n2\n2\n(1 \u2212 x) (1 \u2212 x ) (1 \u2212 x)(1 \u2212 x)3\nx+2\n=\n.\n(1 \u2212 x)(1 \u2212 x2 )(1 \u2212 x3 )\n\n(36)\n\n(\u22121)3 rOACc (1/x) = EOACc (x) + EADc (x) + EDc Ec\u2032 (x)\n1\n1\n1\n+\n+\n=\n2\n2\n2\n2\n2\n(1 \u2212 x) (1 \u2212 x ) (1 \u2212 x )\n(1 \u2212 x )(1 \u2212 x3 )\nx2 + 2x + 3\n=\n.\n(1 \u2212 x2 )2 (1 \u2212 x3 )\n\n(37)\n\nNext is OACc:\n\n29\n\n\fThe last facet is OBc Cc :\n(\u22121)3 rOBc Cc (1/x) = EOBcCc (x) + EOEc\u2032\u2032 (x) + EBc Dc (x) + EDc Ec\u2032\u2032 (x) + EFc (x)\n=\n\n1\n1\n1\n+\n+\n3\n2\n(1 \u2212 x)\n(1 \u2212 x)(1 \u2212 x ) (1 \u2212 x)(1 \u2212 x2 )\n+\n\n=\n\n(38)\n\n2x2 + 1\n1\n+\n(1 \u2212 x2 )2 1 \u2212 x3\n\n\u22122x5 + 4x2 + 5x + 5\n.\n(1 \u2212 x2 )2 (1 \u2212 x3 )\n\nFinally, the edge OBc :\n1\n.\n(1 \u2212 x)2\nNow Rmlc(x) results from (32), and then from (35) we see that\n(\u22121)2 rOBc (1/x) = EOBc (x) =\n\nLc (x) =\n12x4\n\n(\n\n(39)\n\nx2\nRmlc(x) =\n(1 \u2212 x)2\n\n79x15 + 190x14 + 260x13 + 250x12 + 211x11 + 179x10 + 181x9\n\n)\n\n(40)\n\n+ 198x8 + 210x7 + 181x6 + 125x5 + 61x4 + 22x3 + 8x2 + 4x + 1\n\n.\n(1 \u2212 x4 )(1 \u2212 x5 )(1 \u2212 x3 )2 (1 \u2212 x2 )2\nThe constituents of Lc are extracted as described in Section 2.1, and here they are:\n\uf8f1\n3 5 51 4 202 3 3769 2\n\uf8f4\n\uf8f4\n\uf8f2 10 t \u2212 8 t + 3 t \u2212 10 t + c1 (t)t \u2212 c0 (t), if t is even;\nLc (t) =\n(41)\n\uf8f4\n3\n51\n202\n7493\n\uf8f4\n5\n4\n3\n2\n\uf8f3 t \u2212 t +\nt \u2212\nt + c1 (t)t \u2212 c0 (t), if t is odd;\n10\n8\n3\n20\nwhere c1 varies with period 6, given by\n\uf8f1\n994,\nif t \u2261 0, 2\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f2986,\nif t \u2261 4\n(mod 6);\nc1 (t) = 1909\n\uf8f4\n, if t \u2261 1\n\uf8f4\n2\n\uf8f4\n\uf8f3 1925\n, if t \u2261 3, 5\n2\n\nand c0 , given by Table 7, varies with period 60. Thus the period of Lc turns out to be 60,\njust like that of Sc (not a surprise). However, again as with Sc , the even constant terms have\nhalf the period of the odd constant terms. That means Lc (2t) has period equal to half the\ndenominator of the corresponding inside-out polytope (2P, H). We have no explanation for\nthis.\nThe principal constituent, that for t \u2261 0 (mod 60), is\n3 5 51 4 202 3 3769 2\nt \u2212 t +\nt \u2212\nt + 994t \u2212 948.\n10\n8\n3\n10\nThe constant term for magilatin squares does not have the simple interpretation as a number\nof linear orderings that it does for magic and semimagic squares, because the entries in the\nsquare need not all be different. (Still, there is an interpretation as a number of partial\norderings of the nine cells; see Theorem 4.1 in our general magic and magilatin paper [6],\n30\n\n\ft c0 (t)\n\nt\n\nc0 (t)\n\nt c0 (t)\n\n42\n\n948\n\n54\n\n31\n\n43\n\n95941\n120\n14332\n15\n6315\n8\n11996\n15\n20161\n24\n\n55\n\n1\n\n76933\n120\n2780\n3\n35607\n40\n13292\n15\n18433\n24\n4452\n5\n18497\n24\n14332\n15\n32727\n40\n2572\n3\n93893\n120\n\n13\n\n87301\n120\n14332\n15\n6891\n8\n11996\n15\n18433\n24\n4884\n5\n95941\n120\n2780\n3\n29271\n40\n2572\n3\n104261\n120\n\n25\n\n5\n6\n7\n8\n9\n10\n11\n\n16\n17\n18\n19\n20\n21\n22\n23\n\n4884\n5\n87301\n120\n2780\n3\n32151\n40\n2572\n3\n95621\n120\n4884\n5\n18497\n24\n13036\n15\n6315\n8\n13292\n15\n104261\n120\n\n948\n\n24\n\n4\n\n48\n\n85573\n120\n2780\n3\n32727\n40\n13292\n15\n20161\n24\n\n948\n\n15\n\n4452\n5\n16769\n24\n14332\n15\n35607\n40\n2572\n3\n85253\n120\n\n30\n\n12\n\n3\n\nc0 (t)\n\n36\n\n948\n\n14\n\nt\n\n4884\n5\n16769\n24\n13036\n15\n6891\n8\n13292\n15\n95621\n120\n\n0\n2\n\nt c0 (t)\n\n26\n27\n28\n29\n\n32\n33\n34\n35\n\n37\n38\n39\n40\n41\n\n44\n45\n46\n47\n\n49\n50\n51\n52\n53\n\n56\n57\n58\n59\n\nTable 7. Constant terms of the constituents of Lc (t), counting all magilatin\nsquares by upper bound.\n\nand recall that an acyclic orientation of a graph can be represented by a partial ordering of\nthe vertices.)\nWe confirmed the formulas by generating all magilatin squares and comparing the count\nwith the coefficients of Lc (x) up to t = 91.\n5.1.2. Symmetry types of magilatin squares, counted by upper bound. The number of symmetry types with strict bound t is lc (t). We count them via rmlc (w), given by Equation (33);\nthen\nt\u22121\nX\nlc (t) =\n(t \u2212 1 \u2212 w) rmlc(w).\n(42)\nw=0\n\nEquivalently, rmlc (w) counts the w1 -integral points in the interior and part of the boundary\nof the inside-out polytope (Qc , Ic ) of Section 4.1.\nWe get rmlc (x) from (33); then from (42) we see that\nlc (x) =\nx4\n\n(\n\nx2\nrmlc(x) =\n(1 \u2212 x)2\n9x15 + 20x14 + 23x13 + 16x12 + 10x11 + 13x10 + 27x9 + 43x8\n7\n\n6\n\n5\n\n4\n\n3\n\n2\n\n+ 54x + 52x + 41x + 25x + 14x + 8x + 4x + 1\n(1 \u2212 x2 )2 (1 \u2212 x3 )2 (1 \u2212 x4 )(1 \u2212 x5 )\n31\n\n)\n\n(43)\n.\n\n\fThe constituents of lc are:\n\uf8f1\n3 4\n1 5\n\uf8f4\n\uf8f4\nt\n\u2212\nt +\n\uf8f4\n\uf8f2 240\n64\nlc (t) =\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f3 1 t5 \u2212 3 t4 +\n240\n64\n\n97 3 2029 2\nt \u2212\nt + \u01091 (t)t \u2212 \u01090 (t), if t is even;\n216\n720\n97 3 4013 2\nt \u2212\nt + \u01091 (t)t \u2212 \u01090 (t), if t is odd;\n216\n1440\n\nwhere \u01091 varies with period 6, given by\n\uf8f1 17\n,\n\uf8f4\n\uf8f4\n2\n\uf8f4\n\uf8f2 151 ,\n18\n\u01091 (t) = 1163\n\uf8f4\n,\n\uf8f4\n144\n\uf8f4\n\uf8f3 131\n,\n16\n\nif\nif\nif\nif\n\nt \u2261 0, 2\nt\u22614\nt\u22611\nt \u2261 3, 5\n\n(mod 6),\n\nand \u01090 , given by Table 8, varies with period 60. Thus the period of lc turns out to be 60. As\nt \u01090 (t)\n\nt \u01090 (t)\n\nt \u01090 (t)\n\n36\n\n29\n\n47\n5\n11225\n1728\n1067\n135\n539\n64\n1144\n135\n65021\n8640\n\n30\n31\n\n0\n\n9\n\n12\n\n9\n\n24\n\n1\n\n49213\n8640\n235\n27\n2823\n320\n1144\n135\n12313\n1728\n41\n5\n12953\n1728\n1229\n135\n2503\n320\n218\n27\n63293\n8640\n\n13\n\n59581\n8640\n1229\n135\n539\n64\n982\n135\n12313\n1728\n47\n5\n68221\n8640\n235\n27\n2119\n320\n218\n27\n73661\n8640\n\n25\n\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\nt \u01090 (t)\n\n26\n27\n28\n\n32\n33\n34\n35\n\nt \u01090 (t)\n48\n\n41\n\n41\n5\n11225\n1728\n1229\n135\n2823\n320\n218\n27\n54653\n8640\n\n9\n\n42\n\n9\n\n54\n\n57853\n8640\n235\n27\n2503\n320\n1144\n135\n14041\n1728\n\n43\n\n68221\n8640\n1229\n135\n475\n64\n982\n135\n14041\n1728\n\n55\n\n37\n38\n39\n40\n\n44\n45\n46\n47\n\n49\n50\n51\n52\n53\n\n56\n57\n58\n59\n\n47\n5\n59581\n8640\n235\n27\n2439\n320\n218\n27\n65021\n8640\n47\n5\n12953\n1728\n1067\n135\n475\n64\n1144\n135\n73661\n8640\n\nTable 8. Constant terms of the constituents of lc (t), counting symmetry\ntypes of magilatin squares by upper bound.\n\nwith Sc and Lc , the period of the even constant terms is half that of the odd constant terms.\nThe principal constituent of lc is\n1 5\n3\n97 3 2029 2 17\nt \u2212 t4 +\nt \u2212\nt + t \u2212 9.\n240\n64\n216\n720\n2\n32\n\n\f5.1.3. Some real numbers. For the first several nonzero values of the numbers of magilatin\nsquares and of symmetry types, consult this table:\nt\nLc (t)\nlc (t)\nRmlc (t)\nrmlc (t)\n\n4 5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n12 48 120 384 1068 2472 4896 9072 15516 25608 40296 61608\n1 4 10 24\n53\n106 191 328\n528\n822\n1230 1794\n12 24 36 192 420 720 1020 1752 2268 3648 4596 6624\n1 2\n3\n8\n15\n24\n32\n52\n63\n94\n114\n156\n\nThe third line contains the number of symmetry classes of 3 \u00d7 3 magilatin squares, counted\nby upper bound. The main numbers, Lc (t) and lc (t), are sequences A173548 and A173729\nin the OEIS [15]. The reduced numbers, Rmlc (t) and rmlc (t), are sequences A174018 and\nA174019. In contrast to the semimagic case, the number of squares is not a simple multiple\nof the number of symmetry types.\n5.2. Magilatin squares: Affine count (by magic sum). The last example is 3 \u00d7 3\nmagilatin squares, counted affinely. Let La (t) be the number of 3 \u00d7 3 magilatin squares with\nmagic sum t > 0.\nThe weak quasipolynomial is the same as in affine semimagic.\n5.2.1. Magilatin squares by magic sum. We compute La (t), the number of squares with magic\nsum t, via Rmla (s), the number of reduced squares with magic sum s. The formula is\nLa (t) =\n\nX\n\nRmla (s)\n\nif t > 0.\n\n(44)\n\n0<s\u2264t\u22123\ns\u2261t (mod 3)\n\nEquivalently, Rmla (s) counts 1s -integral points in the interior and part of the boundary of the\ninside-out polytope (Qa , Ia ) of Section 4.2, each weighted by 72/|GS |.\nNow we calculate (by LattE) the closed Ehrhart generating function for each necessary\nface. First, OABa :\n(\u22121)3 rOABa (1/x) = EOABa (x) + EOEa (x)\n1\n1\n=\n+\n2\n2\n(1 \u2212 x)(1 \u2212 x )\n(1 \u2212 x)(1 \u2212 x4 )\n2\n.\n=\n(1 \u2212 x)(1 \u2212 x2 )(1 \u2212 x4 )\n\n(45)\n\nNext is OACa:\n(\u22121)3 rOACa (1/x) = EOACa (x) + EADa (x) + EDa Ea\u2032 (x)\n1\n1\n1\n+\n+\n=\n2\n2\n2\n3\n3\n(1 \u2212 x)(1 \u2212 x )\n(1 \u2212 x )(1 \u2212 x ) (1 \u2212 x )(1 \u2212 x4 )\nx3 + x2 + x + 3\n=\n.\n(1 \u2212 x2 )(1 \u2212 x3 )(1 \u2212 x4 )\n33\n\n(46)\n\n\fThe last facet is OBa Ca :\n(\u22121)3 rOBa Ca (1/x) = EOBa Ca (x) + EOEa\u2032\u2032 (x) + EBa Da (x)\n+ EDa Ea\u2032\u2032 (x) + EFa (x)\n1\n1\n1\n=\n+\n+\n2\n2\n4\n2\n(1 \u2212 x)(1 \u2212 x )\n(1 \u2212 x)(1 \u2212 x ) (1 \u2212 x )(1 \u2212 x3 )\n1\n1\n+\n+\n3\n4\n(1 \u2212 x )(1 \u2212 x ) 1 \u2212 x5\n=\n\n(47)\n\nx5 + 4x4 + 6x3 + 7x2 + 7x + 5\n.\n(1 \u2212 x5 )(1 \u2212 x3 )(1 \u2212 x4 )(1 + x)\n\nFinally, the edge OBa :\n(\u22121)2 rOBa (1/x) = EOBa (x) =\n\n1\n.\n(1 \u2212 x)(1 \u2212 x2 )\n\n(48)\n\nNow we get Rmla(x) from (32); then by (44) we deduce that\nx3\nRmla(x)\n1 \u2212 x3\n\uf8f1\n\uf8fc\n2\n3\n4\n5\n6\n7\n8\n1\n+\n3x\n+\n7x\n+\n15x\n+\n33x\n+\n65x\n+\n128x\n+\n208x\n+\n316x\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f2 + 434x9 + 566x10 + 676x11 + 784x12 + 852x13 + 911x14 + 936x15 \uf8f4\n\uf8fd\n6\n12x\n\uf8f4\n\uf8f4\n+ 967x16 + 967x17 + 1001x18 + 995x19 + 1000x20 + 955x21\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f3\n22\n23\n24\n25\n26\n27\n28 \uf8fe\n+ 893x + 752x + 624x + 456x + 322x + 174x + 79x\n.\n=\n(1 + x)(1 + x + x2 )(1 + x2 )(1 \u2212 x3 )(1 \u2212 x5 )(1 \u2212 x6 )(1 \u2212 x7 )(1 \u2212 x8 )\n\nLa (x) =\n\nThe constituents of La are the following:\n1\nLa (t) = t4 \u2212 3t3 + a2 (t)t2 \u2212 a1 (t)t + a0 (t) \u2212 72S7 (t),\n8\nwhere a2 varies with period 6, given by\n\uf8f1 151\n, if t \u2261 0\n\uf8f4\n\uf8f4\n4\n\uf8f4\n\uf8f2 135 , if t \u2261 2, 4\n(mod 6);\na2 (t) = 634\n\uf8f42 ,\nif t \u2261 1, 5\n\uf8f4\n\uf8f4\n\uf8f3 71\n,\nif t \u2261 3\n2\n\nthe linear coefficient varies with period 12, given by\n\uf8f1 1296\n, if t \u2261 0\n\uf8f4\n5\n\uf8f4\n\uf8f4 1347\n\uf8f4\n\uf8f4\n, if t \u2261 1, 5\n\uf8f4\n10\n\uf8f4\n\uf8f4\n831\n\uf8f4\n,\nif t \u2261 2, 10\n\uf8f4\n\uf8f4\n5\n\uf8f4\n\uf8f2 2097 , if t \u2261 3\n10\na1 (t) = 876\n\uf8f4\n,\nif t \u2261 4, 8\n\uf8f4\n5\n\uf8f4\n\uf8f4\n1251\n\uf8f4\n, if t \u2261 6\n\uf8f4\n\uf8f4\n5\n\uf8f4\n\uf8f4\n1257\n\uf8f4\n, if t \u2261 7, 11\n\uf8f4\n10\n\uf8f4\n\uf8f3 2187\n, if t \u2261 9\n10\n34\n\n(mod 12);\n\n(49)\n\n(50)\n\n\fthe constant term a0 , given by Table 9, varies with period 120; and S7 is as in the affine\nsemimagic count.\nt a0 (t)\n\nt a0 (t)\n\nt a0 (t)\n\nt a0 (t)\n\nt a0 (t)\n\nt a0 (t)\n\n0\n\n876\n\n20\n\n340\n\n40\n\n400\n\n60\n\n840\n\n80\n\n376\n\n100\n\n364\n\n1\n\n21\n\n89\n\n20403\n40\n1217\n5\n\u22121901\n40\n3984\n5\n1655\n8\n701\n5\n19251\n40\n1568\n5\n4147\n40\n\n101\n\n69\n\n5683\n40\n917\n5\n16659\n40\n1784\n5\n1175\n8\n3381\n5\n1651\n40\n1268\n5\n22707\n40\n\n81\n\n49\n\n3283\n40\n3597\n5\n\u2212941\n40\n1484\n5\n4887\n8\n821\n5\n2131\n40\n3948\n5\n5107\n40\n\n61\n\n29\n\n21843\n40\n1037\n5\n\u2212461\n40\n4164\n5\n1367\n8\n881\n5\n17811\n40\n1388\n5\n5587\n40\n\n41\n\n9\n\n4243\n40\n1097\n5\n15219\n40\n1604\n5\n1463\n8\n3201\n5\n3091\n40\n1448\n5\n21267\n40\n\n109\n\n4723\n40\n3417\n5\n499\n40\n1664\n5\n4599\n8\n1001\n5\n691\n40\n3768\n5\n6547\n40\n\n10\n\n265\n\n30\n\n705\n\n50\n\n241\n\n70\n\n229\n\n90\n\n741\n\n110\n\n205\n\n11\n\n\u22121037\n40\n4092\n5\n4819\n40\n809\n5\n4023\n8\n1676\n5\n5011\n40\n3273\n5\n787\n40\n\n31\n\n1363\n40\n1772\n5\n19539\n40\n1109\n5\n311\n8\n3876\n5\n7411\n40\n593\n5\n18387\n40\n\n51\n\n16083\n40\n1712\n5\n3859\n40\n3309\n5\n791\n8\n1556\n5\n22131\n40\n893\n5\n\u2212173\n40\n\n71\n\n403\n40\n4272\n5\n3379\n40\n989\n5\n3735\n8\n1496\n5\n6451\n40\n3093\n5\n2227\n40\n\n91\n\n\u221277\n40\n1592\n5\n20979\n40\n929\n5\n599\n8\n4056\n5\n5971\n40\n773\n5\n16947\n40\n\n111\n\n17523\n40\n1892\n5\n2419\n40\n3489\n5\n503\n8\n1376\n5\n23571\n40\n713\n5\n1267\n40\n\n2\n3\n4\n5\n6\n7\n8\n\n12\n13\n14\n15\n16\n17\n18\n19\n\n22\n23\n24\n25\n26\n27\n28\n\n32\n33\n34\n35\n36\n37\n38\n39\n\n42\n43\n44\n45\n46\n47\n48\n\n52\n53\n54\n55\n56\n57\n58\n59\n\n62\n63\n64\n65\n66\n67\n68\n\n72\n73\n74\n75\n76\n77\n78\n79\n\n82\n83\n84\n85\n86\n87\n88\n\n92\n93\n94\n95\n96\n97\n98\n99\n\n102\n103\n104\n105\n106\n107\n108\n\n112\n113\n114\n115\n116\n117\n118\n119\n\nTable 9. Constant terms of the truncated constituents of La (t), counting\nmagilatin squares by magic sum.\nThe period of La turns out to be 840-the period of the constant terms, due to the\ncombination of a0 (t) and the constant term of S7 (t). This is equal to the denominator.\nThe principal constituent of La , that is, for t \u2261 0 (mod 840), is\n1 4\n151 2 9192\nt \u2212 3t3 +\nt \u2212\nt + 948\n8\n4\n35\n(incorporating the \u221272S7 term). (As with the cubical magilatin count, there is an interpretation of the constant term 948 in terms of partial orderings; see Theorem 4.7 in our general\npaper [6].)\n35\n\n\fWe verified the results by comparing an actual count of magilatin squares with magic sum\nt \u2264 100 to the coefficients in La .\n5.2.2. Symmetry types of magilatin squares, counted by magic sum. We compute la (t), the\nnumber of symmetry types of squares with magic sum t, via rmla (s), the number of reduced\nsymmetry types with magic sum s. The formula is\nX\nla (t) =\nrmla (s)\nif t > 0.\n(51)\n0<s\u2264t\u22123\ns\u2261t (mod 3)\n\nEquivalently, rmla (s) counts 1s -integral points in the interior and part of the boundary of the\ninside-out polytope(Qa , Ia ) of Section 4.2.\nFrom (32) we get rmla(x) and then from (51) we see that\nla (x) =\n\nx3\nrmla (x)\n1 \u2212 x3\n\n\uf8f1\n\uf8fc\n2\n3\n4\n5\n6\n7\n8\n9\n1\n+\n3x\n+\n7x\n+\n13x\n+\n23x\n+\n37x\n+\n60x\n+\n86x\n+\n118x\n+\n149x\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f2 + 180x10 + 199x11 + 212x12 + 208x13 + 196x14 + 171x15\n\uf8fd\n6\nx\n\uf8f4\n\uf8f4\n+ 145x16 + 115x17 + 96x18 + 79x19 + 72x20 + 67x21\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f3\n\uf8fe\n22\n23\n24\n25\n26\n27\n28\n+ 66x + 59x + 54x + 43x + 33x + 19x + 9x\n=\n.\n(1 + x)(1 + x + x2 )(1 + x2 )(1 \u2212 x3 )(1 \u2212 x5 )(1 \u2212 x6 )(1 \u2212 x7 )(1 \u2212 x8 )\nThe constituents of la are:\n1\n1 4\nt \u2212 t3 + \u00e22 (t)t2 \u2212 \u00e21 (t)t + \u00e20 (t) \u2212 S7 (t),\nla (t) =\n576\n48\nwhere the quadratic term varies with period 6, given by\n\uf8f1 25\n,\nif t \u2261 0\n\uf8f4\n\uf8f4\n96\n\uf8f4\n\uf8f2 25 , if t \u2261 1, 5\n\u00e22 (t) = 144\n(mod 6);\n59\n\uf8f4\n, if t \u2261 2, 4\n\uf8f4\n288\n\uf8f4\n\uf8f3 11\n,\nif t \u2261 3\n48\n\nthe linear term varies with period 12, given by\n\uf8f1 31\n,\nif t \u2261 0\n\uf8f4\n15\n\uf8f4\n\uf8f4\n103\n\uf8f4\n\uf8f4\n, if t \u2261 1, 5\n\uf8f4\n120\n\uf8f4\n\uf8f4\n133\n\uf8f4\n, if t \u2261 2, 10\n\uf8f4\n\uf8f4\n120\n\uf8f4\n\uf8f2 47 ,\nif t \u2261 3\n\u00e21 (t) = 30\n37\n\uf8f4 30 ,\nif t \u2261 4, 8\n\uf8f4\n\uf8f4\n\uf8f4\n233\n\uf8f4\n, if t \u2261 6\n\uf8f4\n\uf8f4\n120\n\uf8f4\n\uf8f4\n11\n\uf8f4 ,\nif t \u2261 7, 11\n\uf8f4\n\uf8f4\n\uf8f3 15\n203\n, if t \u2261 9\n120\n\n(mod 12);\n\nand \u00e20 , given by Table 10, varies with period 120.\nThe period of la is 840. The principal constituent, that for t \u2261 0 (mod 840), is\n1 4\n1\n25\n74\nt \u2212 t3 + t2 \u2212 t + 9.\n576\n48\n96\n35\n36\n\n(52)\n\n\ft \u00e20 (t)\n\nt \u00e20 (t)\n\n0\n\n8\n\n20\n\n1\n\n2027\n2880\n553\n360\n979\n320\n229\n90\n847\n576\n221\n40\n1739\n2880\n104\n45\n1427\n320\n149\n72\n\u22121813\n2880\n73\n10\n2891\n2880\n301\n360\n279\n64\n128\n45\n2219\n2880\n233\n40\n\u2212277\n2880\n\n21\n\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n47\n18\n1523\n320\n493\n360\n\u2212949\n2880\n38\n5\n751\n576\n409\n360\n1171\n320\n193\n90\n3083\n2880\n49\n8\n587\n2880\n131\n45\n1299\n320\n601\n360\n\u221217\n576\n69\n10\n4619\n2880\n157\n360\n1267\n320\n\nt \u00e20 (t)\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n\n31\n9\n1067\n2880\n257\n40\n\u22121429\n2880\n199\n90\n343\n64\n349\n360\n779\n2880\n36\n5\n2603\n2880\n125\n72\n1043\n320\n247\n90\n1931\n2880\n229\n40\n463\n576\n113\n45\n1491\n320\n457\n360\n\u22121237\n2880\n\nt \u00e20 (t)\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n\n15\n2\n3467\n2880\n373\n360\n1139\n320\n137\n45\n559\n576\n241\n40\n299\n2880\n163\n90\n1587\n320\n113\n72\n\u2212373\n2880\n39\n5\n1451\n2880\n481\n360\n247\n64\n211\n90\n3659\n2880\n213\n40\n1163\n2880\n\nt \u00e20 (t)\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n\n28\n9\n1363\n320\n673\n360\n\u22122389\n2880\n71\n10\n1039\n576\n229\n360\n1331\n320\n119\n45\n1643\n2880\n53\n8\n\u2212853\n2880\n217\n90\n1459\n320\n421\n360\n271\n576\n37\n5\n3179\n2880\n337\n360\n1107\n320\n\nt \u00e20 (t)\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n\n53\n18\n2507\n2880\n237\n40\n11\n2880\n122\n45\n311\n64\n529\n360\n\u2212661\n2880\n67\n10\n4043\n2880\n89\n72\n1203\n320\n146\n45\n491\n2880\n249\n40\n175\n576\n181\n90\n1651\n320\n277\n360\n203\n2880\n\nTable 10. Constant terms of the truncated constituents of la (t), the number\nof symmetry types of magilatin squares with given magic sum.\n\n(This incorporates the \u2212S7 term.)\n5.2.3. Some numbers. The first several nonzero values are given in the table. The third line\ngives the number of symmetry classes of squares.\nt\nLa (t)\nla (t)\nRmla (t)\nrmla (t)\n\n6 7 8 9 10 11 12 13\n14\n15\n16\n17\n18\n19\n12 12 24 72 156 240 552 600 1020 1548 2004 2568 4008 4644\n1 1 2 4\n7\n10 20 22\n35\n50\n63\n78\n116 131\n12 12 24 60 144 216 480 444 780 996 1404 1548 2640 3696\n1 1 2 3\n6\n8\n16 15\n25\n30\n41\n43\n66\n68\n37\n\n\fThe sequences La (t) and la (t) are A173549 and A173730 in the OEIS [15]. The numbers\nRmla (t) of reduced magilatin squares and rmla (t) of normalized, reduced squares with largest\nvalue t are sequences A174020 and A174021.\n6. Observations and conjectures\nA remarkable fact is that the period of every one of our strong Ehrhart quasipolynomials\nequals the denominator, when it could be much smaller.\nFor some small values of t we calculated Ma (t) = EP\u25e6 \u25e6 ,H (t) by hand, which is feasible because the problem is 2-dimensional. The process of counting lattice points in a diagram drew\nour attention to some remarkable phenomena that apply to the semimagic and magilatin\nproblems as well. Let \u03b4 := dim s; let ck be the coefficient in the quasipolynomial EP\u25e6 \u25e6 ,H (t)\nw\nand let cw\nk be that in the Ehrhart quasipolynomial of P , and let pk , pk be their periods. We\nw\nobserve that the variation in c\u03b4\u22121 is exactly the same as that in c\u03b4\u22121 , i.e.,\nw\nc\u03b4\u22121 (t) \u2212 c\u03b4\u22121 (t \u2212 1) = cw\n\u03b4\u22121 (t) \u2212 c\u03b4\u22121 (t \u2212 1),\n\nbut that is not so for most lower coefficients, especially c0 . The reason is that adding each\nnew excluded hyperplane results in a constant deduction in degree \u03b4 \u2212 1 (as we discussed at\nEquation (4.9) in our first article [5]) but a more irregular one in lower terms. We observe\nthat pk increases-that is, there is longer-term variation in ck -as k decreases in every case.\nThus we propose some daring conjectures.\nConjecture 1. In an inside-out counting problem, let \u03b4 := dim P .\nw\nw\n(a) pw\nk | pk for 0 \u2264 k \u2264 \u03b4. (We know that p\u03b4\u22121 = p\u03b4\u22121 because c\u03b4\u22121 and c\u03b4\u22121 have the\nsame variation.)\nw\n(b) If pj = pw\nj for all j \u2265 k, then the variation in ck is the same as that in ck .\n(c) The period ratios increase by a multiplicative factor as k decreases:\npk pk\u22121\nfor 0 \u2264 k \u2264 \u03b4.\npw\npw\nk\nk\u22121\nWe do not suggest pk | pk+1 because that is false in general in ordinary Ehrhart theory,\naccording to McAllister and Woods [13]. However, it might be true for the kinds of insideout polytopes that arise in cubical and affine counting.\nReferences\n[1] Maya Ahmed, Jes\u00fas De Loera, and Raymond Hemmecke, Polyhedral cones of magic cubes and squares,\nin Boris Aronov et al., eds., Discrete and Computational Geometry: The Goodman\u2013Pollack Festschrift,\nAlgorithms Combin., Vol. 25, Springer-Verlag, 2003, pp. 25\u201341. MR 2004m:05016. Zbl 1077.52506.\n[2] Matthias Beck, Moshe Cohen, Jessica Cuomo, and Paul Gribelyuk, The number of \"magic\" squares and\nhypercubes, Amer. Math. Monthly 110 (2003), 707\u2013717. MR 2004k:05009. Zbl 1043.05501.\n[3] Matthias Beck and Andrew van Herick, Enumeration of 4 \u00d7 4 magic squares, Math. Comp., to appear.\n[4] Matthias Beck and Dennis Pixton, The Ehrhart polynomial of the Birkhoff polytope, Discrete Comput.\nGeom. 30 (2003), 623\u2013637. MR 2004g:52015. Zbl 1065.52007.\n[5] Matthias Beck and Thomas Zaslavsky, Inside-out polytopes, Adv. Math. 205 (1) (2006), 134\u2013162. MR\n2007e:52017. Zbl 1107.52009.\n[6] --, An enumerative geometry for magic and magilatin labellings, Ann. Combin. 10 (2006), 395\u2013413.\nMR 2007m:05010. Zbl 1116.05071.\n[7] --, \"Six Little Squares and How their Numbers Grow\" Web Site: With a detailed version (as of\nJanuary 25, 2007) of this paper, Maple worksheets, and supporting documentation.\nURL http://www.math.binghamton.edu/zaslav/Tmath/SLSfiles/\n38\n\n\f[8] Garrett Birkhoff, Three observations on linear algebra (in Spanish), Rev. Univ. Nac. Tucum\u00e1n, Ser. A\n5 (1946), 147\u2013151. MR 8, 561a. Zbl 60, 79f (e: 060.07906).\n[9] Jes\u00fas A. De Loera, David Haws, Raymond Hemmecke, Peter Huggins, Jeremy Tauzer, and Ruriko\nYoshida, A User's Guide for LattE v1.1, Univ. of California at Davis, 2003,\nURL http://www.math.ecdavis.edu/~\nlatte/\n[10] Eug\u00e8ne Ehrhart, Sur un probl\u00e8me de g\u00e9ometrie diophantienne lin\u00e9aire. I: Poly\u00e8dres et r\u00e9seaux. II:\nSyst\u00e8mes diophantiens lin\u00e9aires, J. reine angew. Math. 226 (1967), 1\u201329; 227 (1967), 25\u201349. Correction,\nibid. 231 (1968), 220. MR 35 #4184, 36 #105. Zbl 155.37503, 164.05304.\n[11] --, Sur les carr\u00e9s magiques, C. R. Acad. Sci. Paris S\u00e9r. A\u2013B 277 (1973), A651\u2013A654. MR 48 #10859.\nZbl 267.05014.\n[12] Percy A. MacMahon, Combinatory Analysis, Vols. I and II, Cambridge University Press, 1915\u20131916.\nReprinted in one volume by Chelsea, 1960. MR 25 #5003. Zbl 101, 251 (e: 101.25102).\n[13] Tyrrell B. McAllister and Kevin M. Woods, The minimum period of the Ehrhart quasi-polynomial of a\nrational polytope, J. Combin. Theory Ser. A 109 (2005), 345\u2013352. MR 2005i:52018. Zbl 1063.52006.\n[14] Jochi Shigeru, The dawn of wasan (Japanese mathematics), in Helaine Selin and Ubiratan D'Ambrosio,\neds., Mathematics Across Cultures: The History of Non-Western Mathematics, Science Across Cultures: The History of Non-Western Science, Vol. 2, Kluwer, 2000, pp. 423\u2013454. MR (book) 1805670\n(2002a:01001). Zbl 981.01005.\n[15] N. J. A. Sloane, The On-Line Encyclopedia of Integer Sequences,\nURL http://www.research.att.com/~\nnjas/sequences/\n[16] Richard P. Stanley, Linear homogeneous Diophantine equations and magic labelings of graphs, Duke\nMath. J. 40 (1973), 607\u2013632. MR 47 #6519. Zbl 269.05109.\n[17] Richard P. Stanley, Enumerative Combinatorics, Vol. I, Wadsworth & Brooks/Cole, 1986. MR 87j:05003.\nZbl 608.05001. Corrected reprint, Cambridge Stud. Adv. Math., Vol. 49, Cambridge University Press,\n1997. MR 98a:05001. Zbl 889.05001, 945.05006.\n[18] Guoce Xin, Constructing all magic squares of order three, Discrete Math. 308 (2008), 3393\u20133398. MR\n2423421 (2009e:05039). Zbl 1145.05012.\n\n(Concerned with sequences A108576\u2013A108579, A173546\u2013A173549, A173723\u2013A173730, A174018\u2013\nA174021, A174256\u2013A174257.)\nDepartment of Mathematics, San Francisco State University, 1600 Holloway Avenue, San\nFrancisco, CA 94132, U.S.A.\nE-mail address: beck@math.sfsu.edu\nDepartment of Mathematical Sciences, Binghamton University, Binghamton, NY 139026000, U.S.A.\nE-mail address: zaslav@math.binghamton.edu\n\n39\n\n\f3a+2c\n\n3a+c\n\n2a+2c\n\n2a+c\n\n2a\n\na+2c\n\na+c\n\n2c\n\n\fbac2\n\nbc2\n\nac\n\nbgac\nba\n\nb2\n\nc\nbgc\n\nba2\nbla\n\nallb\n\n\f"}