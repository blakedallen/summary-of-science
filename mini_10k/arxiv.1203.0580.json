{"id": "http://arxiv.org/abs/1203.0580v1", "guidislink": true, "updated": "2012-03-02T21:56:08Z", "updated_parsed": [2012, 3, 2, 21, 56, 8, 4, 62, 0], "published": "2012-03-02T21:56:08Z", "published_parsed": [2012, 3, 2, 21, 56, 8, 4, 62, 0], "title": "Discrete Variational Optimal Control", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1203.5487%2C1203.0580%2C1203.2373%2C1203.6430%2C1203.3928%2C1203.2893%2C1203.5027%2C1203.6085%2C1203.4764%2C1203.1034%2C1203.0054%2C1203.3585%2C1203.3787%2C1203.3410%2C1203.3103%2C1203.1789%2C1203.5647%2C1203.2829%2C1203.3151%2C1203.4013%2C1203.5009%2C1203.0907%2C1203.2669%2C1203.3874%2C1203.4892%2C1203.1458%2C1203.2665%2C1203.5048%2C1203.0153%2C1203.0451%2C1203.3686%2C1203.0822%2C1203.5846%2C1203.2640%2C1203.0656%2C1203.1169%2C1203.6693%2C1203.1036%2C1203.3801%2C1203.4093%2C1203.4311%2C1203.0452%2C1203.5311%2C1203.6110%2C1203.5853%2C1203.1214%2C1203.5408%2C1203.3345%2C1203.2479%2C1203.2702%2C1203.1474%2C1203.3905%2C1203.5727%2C1203.6839%2C1203.3447%2C1203.3676%2C1203.2160%2C1203.6676%2C1203.4712%2C1203.4421%2C1203.1290%2C1203.2291%2C1203.4973%2C1203.4899%2C1203.6065%2C1203.5156%2C1203.3027%2C1203.0760%2C1203.1201%2C1203.6342%2C1203.2384%2C1203.2420%2C1203.3012%2C1203.1114%2C1203.3227%2C1203.1873%2C1203.6310%2C1203.0239%2C1203.4850%2C1203.6679%2C1203.0154%2C1203.5751%2C1203.3805%2C1203.6507%2C1203.1985%2C1203.1531%2C1203.2007%2C1203.2497%2C1203.5795%2C1203.5925%2C1203.4635%2C1203.3919%2C1203.5691%2C1203.2369%2C1203.0867%2C1203.1179%2C1203.2405%2C1203.3218%2C1203.4148%2C1203.6500%2C1203.3983&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Discrete Variational Optimal Control"}, "summary": "This paper develops numerical methods for optimal control of mechanical\nsystems in the Lagrangian setting. It extends the theory of discrete mechanics\nto enable the solutions of optimal control problems through the discretization\nof variational principles. The key point is to solve the optimal control\nproblem as a variational integrator of a specially constructed\nhigher-dimensional system. The developed framework applies to systems on\ntangent bundles, Lie groups, underactuated and nonholonomic systems with\nsymmetries, and can approximate either smooth or discontinuous control inputs.\nThe resulting methods inherit the preservation properties of variational\nintegrators and result in numerically robust and easily implementable\nalgorithms. Several theoretical and a practical examples, e.g. the control of\nan underwater vehicle, will illustrate the application of the proposed\napproach.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1203.5487%2C1203.0580%2C1203.2373%2C1203.6430%2C1203.3928%2C1203.2893%2C1203.5027%2C1203.6085%2C1203.4764%2C1203.1034%2C1203.0054%2C1203.3585%2C1203.3787%2C1203.3410%2C1203.3103%2C1203.1789%2C1203.5647%2C1203.2829%2C1203.3151%2C1203.4013%2C1203.5009%2C1203.0907%2C1203.2669%2C1203.3874%2C1203.4892%2C1203.1458%2C1203.2665%2C1203.5048%2C1203.0153%2C1203.0451%2C1203.3686%2C1203.0822%2C1203.5846%2C1203.2640%2C1203.0656%2C1203.1169%2C1203.6693%2C1203.1036%2C1203.3801%2C1203.4093%2C1203.4311%2C1203.0452%2C1203.5311%2C1203.6110%2C1203.5853%2C1203.1214%2C1203.5408%2C1203.3345%2C1203.2479%2C1203.2702%2C1203.1474%2C1203.3905%2C1203.5727%2C1203.6839%2C1203.3447%2C1203.3676%2C1203.2160%2C1203.6676%2C1203.4712%2C1203.4421%2C1203.1290%2C1203.2291%2C1203.4973%2C1203.4899%2C1203.6065%2C1203.5156%2C1203.3027%2C1203.0760%2C1203.1201%2C1203.6342%2C1203.2384%2C1203.2420%2C1203.3012%2C1203.1114%2C1203.3227%2C1203.1873%2C1203.6310%2C1203.0239%2C1203.4850%2C1203.6679%2C1203.0154%2C1203.5751%2C1203.3805%2C1203.6507%2C1203.1985%2C1203.1531%2C1203.2007%2C1203.2497%2C1203.5795%2C1203.5925%2C1203.4635%2C1203.3919%2C1203.5691%2C1203.2369%2C1203.0867%2C1203.1179%2C1203.2405%2C1203.3218%2C1203.4148%2C1203.6500%2C1203.3983&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "This paper develops numerical methods for optimal control of mechanical\nsystems in the Lagrangian setting. It extends the theory of discrete mechanics\nto enable the solutions of optimal control problems through the discretization\nof variational principles. The key point is to solve the optimal control\nproblem as a variational integrator of a specially constructed\nhigher-dimensional system. The developed framework applies to systems on\ntangent bundles, Lie groups, underactuated and nonholonomic systems with\nsymmetries, and can approximate either smooth or discontinuous control inputs.\nThe resulting methods inherit the preservation properties of variational\nintegrators and result in numerically robust and easily implementable\nalgorithms. Several theoretical and a practical examples, e.g. the control of\nan underwater vehicle, will illustrate the application of the proposed\napproach."}, "authors": ["Fernando Jimenez", "Marin Kobilarov", "David Martin de Diego"], "author_detail": {"name": "David Martin de Diego"}, "author": "David Martin de Diego", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1007/s00332-012-9156-z", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/1203.0580v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/1203.0580v1", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "30 pages, 6 figures", "arxiv_primary_category": {"term": "math.OC", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "math.OC", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "49M25, 49N99, 65K10, 70Q05", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/1203.0580v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/1203.0580v1", "journal_reference": null, "doi": "10.1007/s00332-012-9156-z", "fulltext": "DISCRETE VARIATIONAL OPTIMAL CONTROL\n\narXiv:1203.0580v1 [math.OC] 2 Mar 2012\n\nFERNANDO JIM\u00c9NEZ, MARIN KOBILAROV, AND DAVID MART\u00cdN DE DIEGO\n\nAbstract. This paper develops numerical methods for optimal control\nof mechanical systems in the Lagrangian setting. It extends the theory\nof discrete mechanics to enable the solutions of optimal control problems through the discretization of variational principles. The key point\nis to solve the optimal control problem as a variational integrator of a\nspecially constructed higher-dimensional system. The developed framework applies to systems on tangent bundles, Lie groups, underactuated\nand nonholonomic systems with symmetries, and can approximate either smooth or discontinuous control inputs. The resulting methods inherit the preservation properties of variational integrators and result in\nnumerically robust and easily implementable algorithms. Several theoretical and a practical examples, e.g. the control of an underwater\nvehicle, will illustrate the application of the proposed approach.\n\n1. Introduction\nThe goal of this paper is to develop, from a geometric point of view, numerical methods for optimal control of Lagrangian mechanical systems. Our\napproach employs the theory of discrete mechanics and variational integrators [31] to derive both an integrator for the dynamics and an optimal control\nalgorithm in a unified manner. This is accomplished through the discretization of the Lagrange-d'Alembert variational principle on manifolds. An integrator for the mechanics is derived using a standard Lagrangian function\nand virtual work done by control forces, while control optimality conditions\nare derived using a special Lagrangian defined on a higher-dimensional space\nwhich encodes the dynamics and a desired cost function. The resulting integration and optimization schemes are symplectic, respect the state space\nstructure, and momentum preserving. These qualities are associated with\nnumerical stability which motivate the development of practical algorithms\nthat can be applied to robotic or aerospace vehicles.\nThe proposed framework is general and applies to unconstrained systems, as well systems with symmetries, underactuation, and nonholonomic\nconstraints. In particular, our construction is appropriate for controlled\nLagrangian systems that evolve on a general tangent bundle T Q with associated discrete state space Q \u00d7 Q, where Q is a differentiable manifold\n([31, 35]). In addition we focus on underactuated systems evolving on a Lie\ngroup G ([4, 6, 18, 21]) that are applicable for systems consisting of rigid\nbodies. Finally, the theory extends to the more general principle bundle\nThis work has been partially supported by MEC (Spain) Grants MTM 2010-21186C02-01, MTM2009-08166-E, and IRSES-project \"Geomech-246981\".\n1\n\n\f2\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nsetting with discrete analog Q \u00d7 Q \u00d7 G (or more generally (Q \u00d7 Q)/G) assuming that the action of a Lie group G of symmetry leaves the control\nsystem invariant ([9, 11, 19]).\nThe main idea is the following: we take an approximation of the Lagranged'Alembert principle for forced Lagrangian systems, which models control\ninputs and external forces such as gravity or drag. In principle, we admit\nthe possibility of piecewise continuous control forces, as happens in real applications. We observe that the discrete equations of motion for this type of\nsystems are interpreted as the discrete Euler-Lagrange equations of a new\nLagrangian defined in an augmented discrete phase space. Next, we apply\ndiscrete variational calculus techniques to derive the discrete optimality conditions. After this, we recover two sequences of discrete controls modeling\na piecewise control trajectory.\nAdditionally we show how to derive the equations for different reduced\nsystems. We specifically develop numerical methods for systems on Lie\ngroups that lead to practical algorithm implementation. One such example\nsystem\u2013an underactuated underwater vehicle\u2013is used to illustrate the developed methodology. The resulting algorithm is simple to implement and has\nthe ability to quickly converge to a solution which is close to the optimal\nsolution and to the true system dynamics. We also extend our techniques to\nmore general reduced systems like optimal control problems in trivial principal bundles and we show how to introduce nonholonomic constraints in\nour framework.\nMoreover, since we are reducing the optimality conditions to discrete\nEuler-Lagrange equations, the geometric preservation properties like symplectic-momentum preservation in the standard case or Poisson bracket and\nmomentum preservation for reduced systems are automatically guaranteed\nusing the results in [25, 31].\nThe paper is structured as follows: \u00a72 introduces variational integrators.\n\u00a73 formulates optimal control problems for Lagrangian systems defined on\ntangent bundles, in the continuous and discrete setting, and for both fully\nand underactuated systems. A simple control problem for a mechanical Lagrangian on Rn illustrates these developments. In \u00a74, discrete mechanics on\nLie groups is introduced. Specifically, discrete Euler-Poincar\u00e9 equations and\ntheir Hamiltonian version, the discrete Lie-Poisson equations, are obtained.\nSections \u00a75 and \u00a78 develop the discretization procedure and the numerical\naspects of the proposed approach. The developed algorithm is illustrated\nwith an application to an unmanned underwater vehicle evolving on SE(3).\nFinally, \u00a77 deals with reduced systems on a trivial principal bundle and with\nnonholonomic mechanics.\n\n2. Discrete Mechanics and Variational Integrators\nLet Q be a n-dimensional differentiable manifold with local coordinates\n(q i ), 1 \u2264 i \u2264 n. Denote by T Q its tangent bundle with induced coordinates (q i , q\u0307 i ). Given a Lagrangian function L : T Q \u2192 R the Euler\u2013Lagrange\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n3\n\nequations are\n\u0012\n\u0013\nd \u2202L\n\u2202L\n\u2212 i = 0, 1 \u2264 i \u2264 n.\n(1)\ni\ndt \u2202 q\u0307\n\u2202q\nThese equations are a system of implicit second order differential equations.\nIn the sequel,\n\u0011 will assume that the Lagrangian is regular, that is, the\n\u0010 2 we\n\u2202 L\nmatrix \u2202 q\u0307i \u2202 q\u0307j is non-singular. It is well known that the origin of these\nequations is variational (see [1, 30]).\nVariational integrators retain this variational character and also some of\nmain geometric properties of the continuous system, such as symplecticity\nand momentum conservation (see [12] and references therein).\nIn the following we will summarize the main features of this type of numerical integrators [31]. A discrete Lagrangian is a map Ld : Q \u00d7 Q \u2192 R,\nwhich may be considered as an approximation of the integral action defined\nRh\nby a continuous Lagrangian L : T Q \u2192 R: Ld (q0 , q1 ) \u2248 0 L(q(t), q\u0307(t)) dt\nwhere q(t) is a solution of the Euler-Lagrange equations for L, where q(0) =\nq0 and q(h) = q1 and h > 0 is enough small.\nRemark 2.1. The Cartesian product Q \u00d7 Q is equipped with an interesting\ndifferential structure, the Lie groupoid structure which allows us to extend\nthe construction of variational calculus to another interesting situations (Lie\ngroupoids). See [25] for more details.\nDefine theP\naction sum Sd : QN +1 \u2192 R, corresponding to the Lagrangian\nLd by Sd = N\nk=1 Ld (qk\u22121 , qk ), where qk \u2208 Q for 0 \u2264 k \u2264 N , and N is the\nnumber of steps. The discrete variational principle states that the solutions\nof the discrete system determined by Ld must extremize the action sum\ngiven fixed endpoints q0 and qN . By extremizing Sd over qk , 1 \u2264 k \u2264 N \u2212 1,\nwe obtain the system of difference equations\nD1 Ld (qk , qk+1 ) + D2 Ld (qk\u22121 , qk ) = 0,\n\n(2)\n\nor, in coordinates,\n\u2202Ld\n\u2202Ld\n(qk , qk+1 ) +\n(qk\u22121 , qk ) = 0,\ni\n\u2202x\n\u2202y i\nwhere 1 \u2264 i \u2264 n, 1 \u2264 k \u2264 N \u2212 1 and x, y denote the n-first and n-second\nvariables of the function L respectively.\nThese equations are usually called the discrete Euler\u2013Lagrange equations. Under some regularity hypotheses (the matrix (D12 Ld (qk , qk+1 )) is\nregular), it is possible to define a (local) discrete flow \u03a5Ld : Q \u00d7 Q \u2192 Q \u00d7 Q,\nby \u03a5Ld (qk\u22121 , qk ) = (qk , qk+1 ) from (2). Define the discrete Legendre transformations associated to Ld as\nF\u2212 Ld : Q \u00d7 Q \u2192\n(q0 , q1 ) \u2212\n7 \u2192\n+\nF Ld : Q \u00d7 Q \u2192\n(q0 , q1 ) 7\u2212\u2192\n\nT \u2217Q\n(q0 , \u2212D1 Ld (q0 , q1 )),\nT \u2217Q\n(q1 , D2 Ld (q0 , q1 )) ,\n\nand the discrete Poincar\u00e9\u2013Cartan 2-form \u03c9d = (F+ Ld )\u2217 \u03c9Q = (F\u2212 Ld )\u2217 \u03c9Q ,\nwhere \u03c9Q is the canonical symplectic form on T \u2217 Q. The discrete algorithm\ndetermined by \u03a5Ld preserves the symplectic form \u03c9d , i.e., \u03a5\u2217Ld \u03c9d = \u03c9d .\n\n\f4\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nMoreover, if the discrete Lagrangian is invariant under the diagonal action\nof a Lie group G, then the discrete momentum map Jd : Q \u00d7 Q \u2192 g\u2217 defined\nby\nhJd (qk , qk+1 ), \u03bei = hD2 Ld (qk , qk+1 ), \u03beQ (qk+1 )i\nis preserved by the discrete flow. Therefore, these integrators are symplecticmomentum preserving. Here, \u03beQ denotes the fundamental vector field determined by \u03be \u2208 g, where g is the Lie algebra of G. (See [31] for more\ndetails.)\n3. Discrete optimal control on tangent bundles\nConsider a mechanical system which configuration space is a n-dimensional\ndifferentiable manifold Q and which dynamics is determined by a Lagrangian\nL : T Q \u2192 R. The control forces are modeled as a mapping f : T Q \u00d7 U \u2192\nT \u2217 Q, where f (vq , u) \u2208 Tq\u2217 Q, vq \u2208 Tq Q and u \u2208 U , being U the control\nspace. Observe that this last definition also covers configuration and velocity dependent forces such as dissipation or friction (see [35]). For greater\ngenerality we consider control variables that are only piecewise continuous\nto account for impulsive controls.\nThe motion of the mechanical system is described by applying the principle of Lagrange-D'Alembert, which requires that the solutions q(t) \u2208 Q\nmust satisfy\nZ T\nZ T\n\u03b4\nL(q(t), q\u0307(t)) dt +\nf (q(t), q\u0307(t), u(t)) \u03b4q(t) dt = 0,\n(3)\n0\n\n0\n\nwhere (q , q\u0307) are the local coordinates of T Q and where we consider arbitrary\nvariations \u03b4q \u2208 Tq(t) Q with \u03b4q(0) = 0 and \u03b4q(T ) = 0 (since we are prescribing\nfixed initial and final conditions (q(0), q\u0307(0)) and (q(T ), q\u0307(T ))).\nGiven that we are considering an optimal control problem, the forces f\nmust be chosen, if they exist, as the ones that extremize the cost functional:\nZ\nT\n\nC(q(t), q\u0307(t), u(t)) dt,\n\n(4)\n\n0\n\nwhere C : T Q \u00d7 U \u2192 R.\nThe optimal equations of motion can now be derived using Pontryagin\nmaximum principle. Generally, it is not possible to explicitly integrate these\nequations and, consequently, it is necessary to apply a numerical method.\nIn this work, using discrete variational techniques, we will first discretize\nthe Lagrange-d'Alembert principle and then the cost functional. We obtain\na numerical method that preserves some geometric features of the original\ncontinuous system as we will see in the sequel.\nTo discretize this problem we replace the tangent space T Q by the Cartesian product Q \u00d7 Q and the continuous curves by sequences q0 , q1 , . . . qN\n(we are using N steps, with time step h fixed, in such a way tk = kh and\nN h = T ). The discrete Lagrangian Ld : Q \u00d7 Q \u2192 R is constructed as an\napproximation of the action integral in a single time step (see [31]), that is\nZ (k+1)h\nLd (qk , qk+1 ) \u2248\nL(q(t), q\u0307(t)) dt.\nkh\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n5\n\nWe choose the following discretization for the external forces: fk\u00b1 : Q \u00d7 Q \u00d7\nU \u2192 T \u2217 Q, where U \u2282 Rm , m \u2264 n, such that\n\u2217\nfk\u2212 (qk , qk+1 , u\u2212\nk ) \u2208 Tqk Q,\n\u2217\nfk+ (qk , qk+1 , u+\nk ) \u2208 Tqk+1 Q.\n\nObserve that, as mentioned above,\nwe have\n\b\n\b +introduced the discrete controls as two different sequences u\u2212\nand\nuk . In the notation followed\nk\nthrough this paper, the time interval between [k, k + 1] is denoted as the\nk-th interval, while the controls in k + and (k + 1)\u2212 are denoted by u\u2212\nk and\nu+\nrespectively.\nThis\nchoice\nallows\nus\nto\nmodel\npiecewise\ncontinuous\nconk+1\ntrols, admitting discrete jumps at the time steps tk = hk. Our notation is\ncompletely depicted in the following figure:\n\nu+\nk\n\nr\n\nr\n\nr u\u2212\n@k+1\n@\n@\nu\u2212\nk\n\nr\n\nu\u2212\nk+2\n\nu+\nk+2\n\nr\n\n@\n@\n@\n@\nu+ @r\nk+1\n\n-\n\n|\n\n{z\n\n}|\n\n(k)\u2212th\nhk\n\n{z\n\n}|\n\n(k+1)\u2212th\nh(k+1)\n\n{z\n\ntk\n\n}\n\n(k+2)\u2212th\nh(k+2)\n\nh(k+3)\n\nMoreover, we have that\n+\n+\nfk\u2212 (qk , qk+1 , u\u2212\nk ) \u03b4qk + fk (qk , qk+1 , uk ) \u03b4qk+1 \u2248\nZ (k+1)h\n\u2248\nf (q(t), q\u0307(t), u(t))\u03b4q(t) dt\nkh\n\u0001\n+\n+\n\u2217\n\u2217\nwhere fk\u2212 (qk , qk+1 , u\u2212\nk ), fk (qk , qk+1 , uk ) \u2208 Tqk Q \u00d7 Tqk+1 Q (see [31]).\nTherefore, we derive a discrete version of the Lagrange-D'Alembert\nprinciple given in (3):\n\n\u03b4\n\nN\n\u22121\nX\nk=0\n\nLd (qk , qk+1 ) +\n\nN\n\u22121\nX\n\n\u0001\n+\n+\nfk\u2212 (qk , qk+1 , u\u2212\nk ) \u03b4qk + fk (qk , qk+1 , uk ) \u03b4qk+1 = 0,\n\nk=0\n\nfor all variations {\u03b4qk }k=0,...N with \u03b4qk \u2208 Tqk Q such that \u03b4q0 = \u03b4qN = 0.\nFrom this principle is easy to derive the system of difference equations:\nD2 Ld (qk\u22121 , qk ) + D1 Ld (qk , qk+1 )\n+\n\u2212\n\u2212\n+fk\u22121\n(qk\u22121 , qk , u+\nk\u22121 ) + fk (qk , qk+1 , uk ) = 0,\n\n(5)\n\n\f6\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nwhere k = 1, . . . , N \u2212 1. Equations (5) are called the forced discrete\nEuler-Lagrange equations (see [35]).\nWe can also approximate the cost functional (4) in a single time step h\nby\nZ (k+1)h\n\u2212\n+\nCd (qk , uk , qk+1 , uk ) \u2248\nC(q(t), q\u0307(t), u(t)) dt,\nkh\n\nyielding the discrete cost functional:\nN\n\u22121\nX\n\n+\nCd (qk , u\u2212\nk , qk+1 , uk ) .\n\nk=0\n\nObserve that Cd : Q \u00d7 U \u00d7 Q \u00d7 U \u2192 R.\n3.1. Fully-actuated Systems. In this section we assume the following\ncondition\nDefinition 3.1. (Fully actuated discrete system) We say that the discrete mechanical control system is fully actuated if the mappings\nfk\u2212\nfk+\n\n(qk ,qk+1 )\n\n(qk ,qk+1 )\n\n: U \u2192 Tq\u2217k Q,\n\nfk\u2212\n\n: U \u2192 Tq\u2217k+1 Q,\n\n(u) = fk\u2212 (qk , qk+1 , u),\n\n(qk ,qk+1 )\n+\nfk (q ,q ) (u)\nk k+1\n\n= fk+ (qk , qk+1 , u),\n\nare both diffeomorphisms.\nDefine the momenta (see [31, 35])\npk = \u2212D1 Ld (qk , qk+1 ) \u2212 fk\u2212 (qk , qk+1 , u\u2212\nk ),\npk+1 = D2 Ld (qk , qk+1 ) +\n\nfk+ (qk , qk+1 , u+\nk ).\n\n(6)\n(7)\n\nSince both fk\u00b1 (q ,q ) are diffeomorphisms we can express u\u00b1\nk in terms of\nk k+1\n(qk , pk , qk+1 , pk+1 ) using (6) and (7). Next, we define a new Lagrangian\nLd : T \u2217 Q \u00d7 T \u2217 Q \u2192 R by\nLd (qk , pk , qk+1 , pk+1 ) =\n= Cd (qk , (fk\u2212\n\n(qk ,qk+1 )\n\n)\u22121 (\u2212D1 Ld \u2212 pk ) , qk+1 ,\n\n(fk+ (q ,q ) )\u22121 (\u2212D2 Ld\nk k+1\n\n(8)\n\n+ pk+1 )).\n\nThe system is fully-actuated, consequently the Lagrangian Ld is well defined on the entire discrete space T \u2217 Q \u00d7 T \u2217 Q.\nNow the discrete phase space is the Cartesian product T \u2217 Q \u00d7 T \u2217 Q of two\ncopies of the cotangent bundle. The definition (6), (7) gives us a matching\nof momenta (see [31]) which automatically implies\n+\n\u2212\n\u2212\nD2 Ld (qk\u22121 , qk ) + fk\u22121\n(qk\u22121 , qk , u+\nk\u22121 ) = \u2212D1 Ld (qk , qk+1 ) \u2212 fk (qk , qk+1 , uk ),\n\nk = 1, . . . , N \u2212 1, which are the forced discrete Euler-Lagrange equations\n(5). In other words, the matching condition enforces that the momentum at\ntime k should be the same when evaluated from the lower interval [k \u2212 1, k]\nor the upper interval [k, k + 1]. Consequently, along a solution curve there\nis a unique momentum at each time tk , which can be called pk .\nThe discrete Euler-Lagrange equations of motion for the Lagrangian Ld :\nT \u2217 Q \u00d7 T \u2217 Q \u2192 R are\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n7\n\nD3 Ld (qk\u22121 , pk\u22121 , qk , pk ) + D1 Ld (qk , pk , qk+1 , pk+1 ) = 0,\nD4 Ld (qk\u22121 , pk\u22121 , qk , pk ) + D2 Ld (qk , pk , qk+1 , pk+1 ) = 0 .\n\n(9)\n(10)\n\nIn summary, we have obtained the discrete equations of motion for a\nfully-actuated mechanical optimal control problem as the discrete EulerLagrange equations for a Lagrangian defined on the product of two copies\nof the cotangent bundle. Therefore, all the preservation properties of the\ndiscrete equations (9) and (10) are now a direct consequence of the theory\nof variational integrators [31].\n3.2. Example: optimal control problem for a mechanical Lagrangian\nwith configuration space Rn . Consider the case Q = Rn and assume that\nM is an n \u00d7 n constant and symmetric matrix. The mechanical Lagrangian\nL : R2n \u2192 R is defined by L(x, \u1e8b) = 21 \u1e8bT M \u1e8b \u2212 V (x), where V : Rn \u2192 R\nis the potential function and x \u2208 R. The system is fully actuated and\nthere exist no velocity constraints. The optimal control problem is typically in terms of boundary conditions (x(0), \u1e8b(0)) and (x(T ), \u1e8b(T )) for a\ngiven final time T . Note that in the continuous setting we can define the\nmomentum by the continuous Legendre transformation FL : T Q \u2192 T \u2217 Q,\nT\n(q, q\u0307) 7\u2192 (q, p): p = \u2202L\n\u2202 \u1e8b , i.e. p(t) = \u1e8b (t) M . In consequence, we can define\nboundary constraints also in the phase space: (x(0) , p(0) = \u1e8b(0)T M ) and\n(x(T ) , p(T ) = \u1e8b(T )T M ).\nWe set the Trapezoidal discretization for the Lagrangian (see [12]), that\nx\n\u2212x\nx\n\u2212x\nis, Ld (xk , xk+1 ) = h2 L(xk , k+1h k ) + h2 L(xk+1 , k+1h k ) where, as above, h\nis the fixed time step and x1 , x2 , . . . , xN is a sequence of elements on Rn .\nOur concrete discrete Lagrangian is\nLd (xk , xk+1 ) =\n\nh\n1\n(xk+1 \u2212 xk )T M (xk+1 \u2212 xk ) \u2212 (V (xk ) + V (xk+1 )) .\n2h\n2\n\n+\n+\n\u2217\nn\nThe control forces are fk\u2212 (xk , xk+1 , u\u2212\nk ) \u2208 Txk R and fk (xk , xk+1 , uk ) \u2208\n\u2217\nn\nTxk+1 R . For sake of clarity, we are going to fix the control forces in the\n\u00b1\nfollowing manner f \u00b1 (xk , xk+1 , u\u00b1\nk ) = uk . Looking at equations (6) and (7)\nis easy to obtain the associated momenta pk and pk+1 , namely\n\n1\nh\n(xk+1 \u2212 xk )T M + Vx (xk )T \u2212 u\u2212\nk,\nh\n2\n1\nh\npk+1 =\n(xk+1 \u2212 xk )T M \u2212 Vx (xk+1 )T + u+\nk.\nh\n2\n\u0003\nP \u22121 \u0002 \u2212 2\n+ 2\nLet Cd = h4 N\nbe a discrete approximation of the cost\nk=0 (uk ) + (uk )\nfunction. Consequently, the Lagrangian over T \u2217 Rn \u00d7 T \u2217 Rn is\npk =\n\nLd (xk , pk , xk+1 , pk+1 ) =\n!2\n\u0012\n\u0013\nN \u22121\n1X\nxk+1 \u2212 xk T\nh\nM \u2212 Vx (xk )T\n=\npk \u2212\n4\nh\n2\nk=0\n\n1\n+\n4\n\nN\n\u22121\nX\nk=0\n\n\u0012\npk+1 \u2212\n\nxk+1 \u2212 xk\nh\n\n\u0013T\n\nh\nM + Vx (xk+1 )T\n2\n\n!2\n,\n\n\f8\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nwhere Vx represents the derivative of V with respect to the variable x. Applying equations (9) and (10) to Ld we obtain the following equations:\n\u0012\npk \u2212\n\nxk+1 \u2212 xk\u22121\n2h\n\n\u0013T\nM = 0,\n\n(11)\n\n\u0013\u0012\n\u0013\nxk+1 \u2212 xk T\nh\nh2\nT\nT\npk \u2212 (\n) M \u2212 Vx (xk )\nM\u2212\nVxx (xk )\n(12)\nh\n2\n2\n\u0012\n\u0013\u0012\n\u0013\nxk \u2212 xk\u22121 T\nh\nh2\n\u2212 pk \u2212 (\n) M + Vx (xk )T\nM\u2212\nVxx (xk )T = 0,\nh\n2\n2\n\n\u0012\n\nwhere both set of equations are defined for k = 1, ..., N \u2212 1. It is quite\nclear that we could remove the pk dependence in equation (12). However,\nwe prefer to keep it in order to stress that the discrete variational EulerLagrange equations (9) and (10) are defined in T \u2217 Q \u00d7 T \u2217 Q (T \u2217 Rn \u00d7 T \u2217 Rn\nin the particular case we are considering in this example).\nExpressions (11) and (12) give 2(N \u2212 1)n equations for the 2(N + 1)n\nN\nunknowns {xk }N\nk=0 , {pk }k=0 . Nevertheless, the boundary conditions\nx0 = x(0), p0 = p(0),\nxN = x(T ), pN = p(T ),\ncontribute 4n extra equations that convert eqs. (11) and (12) in a nonlinear\nroot finding problem of 2(N \u2212 1)n and the same amount of unknowns.\n3.3. Underactuated Systems. In this section, we examine the case of\nunderactuated systems defined as follows:\nDefinition 3.2. (Underactuated discrete system) We say that the discrete mechanical control system is underactuated if the mappings\nfk\u2212\nfk+\n\n(qk ,qk+1 )\n\n(qk ,qk+1 )\n\n: U \u2192 Tq\u2217k Q,\n\n: U \u2192 Tq\u2217k+1 Q,\n\nfk\u2212\n\n(u) = fk\u2212 (qk , qk+1 , u),\n\n(qk ,qk+1 )\n+\nfk (q ,q ) (u)\nk k+1\n\n= fk+ (qk , qk+1 , u),\n\nare both embeddings, that is, they are one-to-one immersions that are homeomorphisms of U to its image.\n\u2212\nUnder this hypothesis we deduce that M\u2212\n(qk ,qk+1 ) = fk\n\n(U ),\n\n(qk ,qk+1 )\n= fk+ (q ,q ) (U ) are submanifolds of Tq\u2217k Q and Tq\u2217k+1 Q, respeck k+1\ntively. Therefore, fk\u00b1 (q ,q ) are diffeomorphisms onto its image. Moreover,\nk k+1\n+\ndim M\u2212\n=\ndim\nM\n(qk ,qk+1 )\n(qk ,qk+1 ) = dim U .\n+\nThe set of admissible forces is restricted to the space M\u2212\n(qk ,qk+1 ) \u00d7M(qk ,qk+1 )\nTq\u2217k Q \u00d7 Tq\u2217k+1 Q. As a consequence, the set of admissible momenta defined\n\nM+\n(qk ,qk+1 )\n\nin (6) and (7) satisfy\n\u2217\n(qk , \u2212D1 Ld (qk , qk+1 ) \u2212 pk ) \u2208 M\u2212\n(qk ,qk+1 ) \u2282 Tqk Q,\n\u2217\n(qk+1 , \u2212D2 Ld (qk , qk+1 ) + pk+1 ) \u2208 M+\n(qk ,qk+1 ) \u2282 Tqk+1 Q.\n\nThus, the Lagrangian function defined in (8) is restricted to these points\nonly. Thus, it is necessary to apply constrained variational calculus to derive\nthe corresponding equations (see [2]). This is typically performed by means\n\n\u2282\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n9\n\n+\n\u2217\n\u2217\nof constraint functions \u03a6\u2212\n\u03b1 , \u03a6\u03b1 : T Q \u00d7 T Q \u2192 R, 1 \u2264 \u03b1 \u2264 n \u2212 dim U .\nTherefore the solutions of the optimal control problem are now viewed as\nthe solutions of the discrete constrained problem determined by an extended\n\u00b1\nLagrangian Ld and the constraints \u03a6\u00b1\n\u03b1 . Since f (qk ,qk+1 ) are embeddings,\nas established in definition (3.2), the number of constraints is determined\nby n minus the dimension of U . Note that the total number of constraints,\n\u03a6\u00b1\n\u03b1 , is therefore 2(n \u2212 dim U ).\n+ \u03b1\n\u03b1\nTo solve this problem we introduce Lagrange multipliers (\u03bb\u2212\nk ) ,(\u03bbk ) and\nconsider discrete variational calculus using the augmented Lagrangian\n+\nLed (qk , pk , \u03bb\u2212\nk , qk+1 , pk+1 , \u03bbk ) =Ld (qk , pk , qk+1 , pk+1 )\n\u03b1 \u2212\n+ (\u03bb\u2212\nk ) \u03a6\u03b1 (qk , pk , qk+1 , pk+1 )\n\u03b1 +\n+ (\u03bb+\nk ) \u03a6\u03b1 (qk , pk , qk+1 , pk+1 ).\n\nObserve that, in spite the constraints are functions of the Cartesian product\n\u2217\n\u2217\nof two copies of the cotangent bundle i.e. \u03a6\u00b1\n\u03b1 : T Q \u00d7 T Q \u2192 R, neither\n+\n\u2212\n\u03a6\u03b1 depends on pk+1 nor \u03a6\u03b1 on pk . The discrete Euler-Lagrange equations\ngives us the solutions of the underactuated problem.\nTypically, the underactuated systems appear in an affine way that is\n\u2212\n\u2212\n\u2212\nfk\u2212 (qk , qk+1 , u\u2212\nk ) = Ak (qk , qk+1 ) + Bk (qk , qk+1 )(uk )\n+\n+\n+\nfk+ (qk , qk+1 , u+\nk ) = Ak (qk , qk+1 ) + Bk (qk , qk+1 )(uk )\n\u2212\n+\n\u2217\n\u2217\nwhere A\u2212\nk (qk , qk+1 ) \u2208 Tqk Q, Ak (qk , qk+1 ) \u2208 Tqk+1 Q. Moreover Bk (qk , qk+1 ) \u2208\nLin(U, Tq\u2217k Q) and Bk+ (qk , qk+1 ) \u2208 Lin(U, Tq\u2217k+1 Q) are linear maps (we assume that U is a vector space and Lin(E1 , E2 ) is the set of all linear\n\u2217\nmaps between E1 and E2 ). In consequence Bk\u2212 (qk , qk+1 )(u\u2212\nk ) \u2208 Tqk Q and\n+\n+\n\u2217\nBk (qk , qk+1 )(uk ) \u2208 Tqk+1 Q.\nThen the constraints are deduced using the compatibility conditions:\n\u0001\nrank Bk\u2212 = rank Bk\u2212 ; \u2212D1 Ld (qk , qk+1 ) \u2212 pk \u2212 A\u2212\nk (qk , qk+1 ) ,\n\u0001\nrank Bk+ = rank Bk+ ; \u2212D2 Ld (qk , qk+1 ) + pk+1 \u2212 A+\nk (qk , qk+1 ) ,\n\nwhich imply constraints in (qk , qk+1 , pk ) and (qk , qk+1 , pk+1 ), respectively.\nThe fact that fk\u00b1 (q ,q ) are both embeddings implies furthermore that\nk\n\nk+1\n\nrank Bk\u2212 = rank Bk+ = dim U .\n4. Discrete optimal control on Lie groups\nAn indispensable tool in the study of mechanical systems is reduction\ntheory. Therefore, in this work we consider its discrete analogue. This is\nprecisely the motivating idea of the work by Moser and Veselov [34], i.e.\nto give a discrete analogue of Euler-Poincar\u00e9 reduction. The approach is\nto reduces the standard second order Euler-Lagrange equations when the\nconfiguration space is a Lie group G to first order equations on the Lie\nalgebra g.\nFollowing the developments in \u00a7 2 assume that the Lagrangian defined by\nLd : G \u00d7 G \u2192 R is invariant so that\nLd (gk , gk+1 ) = Ld (\u1e21gk , \u1e21gk+1 )\n\n\f10\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nfor any element \u1e21 \u2208 G and (gk , gk+1 ) \u2208 G \u00d7 G. According to this, we can\ndefine a reduced Lagrangian ld : G \u2192 R by\nld (Wk ) = Ld (e, gk\u22121 gk+1 )\nwhere Wk = gk\u22121 gk+1 and e is the identity of the Lie group G.\nThe reduced action sum is given by\nSd :\n\nGN \u22121 \u2192 R\nPN \u22121\n(W0 , . . . , WN \u22121 ) 7\u2212\u2192\nk=0 ld (Wk ).\n\nTaking variations of Sd and noting that\n\u03b4Wk = \u2212gk\u22121 (\u03b4gk )gk\u22121 gk+1 + gk\u22121 \u03b4gk+1 = \u2212\u03b7k Wk + Wk \u03b7k+1 ,\nwhere \u03b7k = gk\u22121 \u03b4gk , we arrive to the discrete Euler-Poincar\u00e9 equations:\n\u2217\n\u2217\n(rW\ndld )(Wk ) \u2212 (lW\nk\n\nk\u22121\n\ndld )(Wk\u22121 ) = 0,\n\nk = 1, ..., N \u2212 1,\n\nwhere l : G \u00d7 G \u2192 G and r : G \u00d7 G \u2192 G are respectively the left and the\nright translations of the group (see also [6]).\n\u2217 dl )(W ) then the discrete Euler-Poincar\u00e9 equaIf we denote by \u03bck = (rW\nd\nk\nk\ntions are rewritten as\n\u03bck+1 = Ad\u2217W \u03bck ,\n(13)\nk\n\nwhere Ad : G \u00d7 g \u2192 g is the adjoint action of G on g. Typically this\nequations are known as the discrete Lie-Poisson equations (see [6, 28, 29]).\nConsider a mechanical system determined by a Lagrangian l : g \u2192 R,\nwhere g is the Lie algebra of a Lie group G, which also is a n-dimensional\nvector space. The continuous external forces are defined as follows f : g \u00d7\nU \u2192 g\u2217 . The motion of the mechanical system is described applying the\nfollowing principle\nZ T\nZ T\n\u03b4\nl(\u03be(t)) dt +\nhf (\u03be(t), u(t)), \u03b7(t)i dt = 0,\n(14)\n0\n\n0\n\nfor all variations \u03b4\u03be(t) of the form \u03b4\u03be(t) = \u03b7\u0307(t) + [\u03be(t), \u03b7(t)], where \u03b7(t) is an\narbitrary curve on the Lie algebra with \u03b7(0) = 0 and \u03b7(T ) = 0 (see [30]). In\naddition h*, *i is the natural pairing between g and g\u2217 . These equations give\nus the controlled Euler-Poincar\u00e9 equations:\n\u0012 \u0013\n\u0012 \u0013\n\u03b4l\nd \u03b4l\n\u2217\n= ad\u03be\n+ f,\ndt \u03b4\u03be\n\u03b4\u03be\nwhere ad\u03be \u03b7 = [\u03be, \u03b7].\nThe optimal control problem consists of minimizing a given cost functional:\nZ T\nC(\u03be(t), u(t))) dt,\n(15)\n0\n\nwhere C : g \u00d7 U \u2212\u2192 R.\nNow, we consider the associated discrete problem. First we replace the\nLie algebra g by the Lie group G and the continuous curves by sequences\nW0 , W1 , . . . WN (since the Lie algebra is the infinitesimal version of a Lie\ngroup, its proper discretization is consequently that Lie group [29, 31]).\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n11\n\nThe discrete Lagrangian ld : G \u2192 R is constructed as an approximation\nof the action integral, that is\nZ (k+1)h\nld (Wk ) \u2248\nl(\u03be(t)) dt.\nkh\n\nLet define the discrete external forces in the following way: fk\u00b1 : G\u00d7U \u2192 g\u2217 ,\nwhere U \u2282 Rm for m \u2264 n = dim g. In consequence\nZ (k+1)h\n+\n+\nhf (\u03be(t), u(t)), \u03b7(t)i dt,\nhfk\u2212 (Wk , u\u2212\n)\n,\n\u03b7\ni\n+\nhf\n(W\n,\nu\n)\n,\n\u03b7\ni\n\u2248\nk\nk k\nk+1\nk\nk\nkh\n\n+\n+\n\u2217\n\u2217\nwhere (fk\u2212 (Wk , u\u2212\nk ), fk (Wk , uk )) \u2208 g \u00d7 g and \u03b7k \u2208 g,\n\u03b70 = \u03b7N = 0 and h*, *i is the natural pairing between g\n\nfor all k. In addition\nand g\u2217 .\nFor sake of simplicity we are sometimes going to omit the dependence on\nG \u00d7 U of both fk+ and fk\u2212 .\nTaking all the previous into account, we derive a discrete version of\nthe Lagrange-D'Alembert principle for Lie groups:\n\u03b4\n\nN\n\u22121\nX\n\nld (Wk ) +\n\nN\n\u22121\nX\n\n\u0001\nhfk\u2212 , \u03b7k i + hfk+ , \u03b7k+1 i = 0,\n\n(16)\n\nk=0\n\nk=0\n\nfor all variations {\u03b4Wk }k=0,...N \u22121 verifying the relation \u03b4Wk = \u2212\u03b7k Wk +\nWk \u03b7k+1 with {\u03b7k }k=1,...N \u22121 an arbitrary sequence of elements of g which\nsatisfies \u03b70 , \u03b7N = 0 (see [18, 21]).\nFrom this principle is easy to derive the system of difference equations:\n\u2217\nlW\n\nk\u22121\n\n+\n\n\u2217\ndld (Wk\u22121 ) \u2212 rW\ndld (Wk )\nk\n\n+\n(Wk\u22121 , u+\nfk\u22121\nk\u22121 )\n\n+ fk\u2212 (Wk , u\u2212\nk ) = 0,\n\n(17)\n\nfor k = 1, . . . , N \u2212 1, which are called the controlled discrete EulerPoincar\u00e9 equations.\nThe cost functional (15) is approximated by\nZ (k+1)h\n+\n,\nW\n,\nu\n)\n\u2248\nC(\u03be(t), u(t)) dt,\n(18)\nCd (u\u2212\nk k\nk\nkh\n\nyielding the discrete cost functional:\nJ =\n\nN\n\u22121\nX\n\n+\nCd (u\u2212\nk , Wk , uk ) .\n\n(19)\n\nk=0\n\nObserve that now Cd : U \u00d7 G \u00d7 U \u2192 R.\n4.1. Fully Actuated Systems. In the fully actuated case the mappings\nfk\u00b1 W : U \u2192 g\u2217 defined by fk\u00b1 (u) = fk\u00b1 (W, u) are diffeomorphisms for all\nW\nW \u2208 G, therefore, we can construct the Lagrangian Ld : g\u2217 \u00d7 G \u00d7 g\u2217 \u2212\u2192 R\nby\nLd (\u03bdk , Wk , \u03bdk+1 )\n= Cd ((fk\u2212\n\nWk\n\n\u2217\n)\u22121 (rW\ndld (Wk )\u2212\u03bdk ), Wk , (fk+\nk\n\nWk\n\n\u2217\n)\u22121 (\u2212lW\ndld (Wk ) + \u03bdk+1 )),\nk\n\n(20)\n\n\f12\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nwhere the variables \u03bdk , \u03bdk+1 \u2208 g\u2217 are defined by\n\u2217\n\u03bdk = rW\ndld (Wk ) \u2212 fk\u2212 (Wk , u\u2212\nk ),\nk\n\n(21)\n\n\u2217\n\u03bdk+1 = lW\ndld (Wk ) + fk+ (Wk , u+\nk ),\nk\n\nThe discrete phase space g\u2217 \u00d7 G \u00d7 g\u2217 is now a mixture of two copies of the\nLie algebra g\u2217 and a Lie group G. This is also an example of a Lie groupoid\n([25]).\nThe discrete optimal control problem defined in (16) and (18) has been\nreduced to a Lagrangian one, with Lagrangian function Ld : g\u2217 \u00d7G\u00d7g\u2217 \u2192 R.\nIn consequence, we are able to apply discrete variational calculus to obtain\nthe discrete equations of motion in the phase space g\u2217 \u00d7 G \u00d7 g\u2217 .\nLet us show how to derive these equations from a variational point of view\n(see [25] for further details). Define first the discrete action sum\nSd =\n\nN\n\u22121\nX\n\nLd (\u03bdk , Wk , \u03bdk+1 ).\n\nk=0\n\nConsider sequences of the type {(\u03bdk , Wk , \u03bdk+1 )}k=0,...,N \u22121 with boundary\nconditions: \u03bd0 , \u03bdN and the composition W\u0304 = W0 W1 * * * WN \u22122 WN \u22121 fixed.\nTherefore an arbitrary variation of this sequence has the form\n{\u03bdk (\u000f) , h\u22121\nk (\u000f) Wk hk+1 (\u000f) , \u03bdk+1 (\u000f)}k=0,...,N \u22121 ,\nwith \u000f \u2208 (\u2212\u03b4, \u03b4) \u2208 R (both \u000f and \u03b4 > 0 are real parameters) and \u03bd0 (\u000f) = \u03bd0 ,\n\u03bdk (0) = \u03bdk , \u03bdN (\u000f) = \u03bdN , hk (\u000f) \u2208 G and h0 (\u000f) = hN (\u000f) = e, for all \u000f.\nAdditionally hk (0) = e for all k.\nThe critical points of the discrete action sum subjected to the previous\nboundary conditions are characterized by\n!\nN\n\u22121\nX\nd\n\u22121\nLd (\u03bdk (\u000f) , hk (\u000f) Wk hk+1 (\u000f) , \u03bdk+1 (\u000f))\n0 =\nd\u000f \u000f=0\nk=0\n\n\b\nd\n=\nLd (\u03bd0 , W0 h1 (\u000f), \u03bd1 (\u000f)) + Ld (\u03bd1 (\u000f) , h\u22121\n1 (\u000f) W1 h2 (\u000f) , \u03bd2 (\u000f))\nd\u000f \u000f=0\n+ . . . + Ld (\u03bdN \u22122 (\u000f) , h\u22121\nN \u22122 (\u000f) WN \u22122 hN \u22121 (\u000f) , \u03bdN \u22121 (\u000f))\n+Ld (\u03bdN \u22121 (\u000f) , h\u22121\nN \u22121 (\u000f) WN \u22121 , \u03bdN ) .\nTaking derivatives we obtain\n0 =\n\nN\n\u22121 h\nX\n\n\u2217\nlW\n\nk\u22121\n\nk=1\nN\n\u22121 h\nX\n\n+\n\ndLd\n\nD2 Ld\n\n(\u03bdk\u22121 ,\u03bdk\n\n(Wk\u22121\n\n\u2217\n(Wk\u22121 ) \u2212 rW\ndLd\n)\nk\n\n(\u03bd , \u03bd ) + D1 Ld\n) k\u22121 k\n\n(\u03bdk ,\u03bdk+1\n\n(Wk\n\ni\n(W\n)\nk \u03b4hk\n)\n\ni\n(\u03bd\n,\n\u03bd\n)\n\u03b4\u03bdk ,\n) k k+1\n\nk=1\n\nwhere Ld\nLd\n\n(\u03bd,\u03bd 0 )\n\n(W )\n\n: g\u2217 \u00d7g\u2217 \u2192 R and Ld\n\n(\u03bd,\u03bd 0 )\n\n: G \u2192 R are defined by Ld\n\n(W )\n\n(\u03bd, \u03bd 0 ) =\n\n(W ) = Ld (\u03bd, W, \u03bd 0 ), where W \u2208 G and \u03bd, \u03bd 0 \u2208 g\u2217 . Since \u03b4hk (which\n\nis defined as\n\nd hk\nd\u000f |\u000f=0 )\n\nand \u03b4\u03bdk (which is defined as\n\nd \u03bdk\nd\u000f |\u000f=0 ),\n\nk = 1, . . . , N \u2212 1\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n13\n\nare arbitrary, we deduce the following discrete equations of motion:\n\u2217\nlW\n\nk\u22121\n\ndLd\n\n(\u03bdk\u22121 ,\u03bdk )\n\n\u2217\ndLd\n(Wk\u22121 ) \u2212 rW\nk\n\n(\u03bdk ,\u03bdk+1 )\n\n(Wk ) = 0,\n(22)\n\nD2 L d\n\n(Wk\u22121 )\n\n(\u03bdk\u22121 , \u03bdk ) + D1 Ld\n\n(Wk )\n\n(\u03bdk , \u03bdk+1 ) = 0,\n\nfor k = 1, . . . , N \u2212 1. Similarly to \u00a73.1 we obtain the control inputs u\u2212\nk and\nu+\nusing\n(21).\nk\n4.2. Underactuated Systems. The underactuated case can now be considered by adding of constraints. Similarly to \u00a73.3 underactuation restricts\nthe control forces to lie in a subspace spanned by vectors {es } of the basis\n{es , e\u03c3 } of g\u2217 , where {s, \u03c3} = 1, ..., n. Then\n\u2212\n\u2212\n\u2212\ns\nfk\u2212 (Wk , u\u2212\nk ) = ak (Wk ) + (bk (Wk , uk ))s e ,\n+\n+\n+\ns\nfk+ (Wk , u+\nk ) = ak (Wk ) + (bk (Wk , uk ))s e ,\n+\n\u2212\n\u2212\n+\n+\n\u2217\nwhere a\u2212\nk (Wk ), ak (Wk ) \u2208 g and (bk (Wk , uk ))s , (bk (Wk , uk ))s \u2208 R, for all\n+\ns. Additionally, the embedding condition implies that rank b\u2212\nk = rank bk =\ndim U . Then, taking the dual basis {es , e\u03c3 }, we induce the following constraints:\n\u2212\n\u2217\n\u03a6\u2212\n\u03c3 (\u03bdk , Wk , \u03bdk+1 ) = hrW dld (Wk ) \u2212 \u03bdk \u2212 ak (Wk ), e\u03c3 i = 0,\n\n(23a)\n\n+\n\u2217\n\u03a6+\n\u03c3 (\u03bdk , Wk , \u03bdk+1 ) = h\u03bdk+1 \u2212 lW dld (Wk ) \u2212 ak (Wk ), e\u03c3 i = 0.\n\n(23b)\n\nk\n\nk\n\n\u2217\nObserve in (23) that, even though the constraints are functions \u03a6\u00b1\n\u03c3 : g \u00d7\n+\n\u2217\n\u2212\nG \u00d7 g \u2192 R, neither \u03a6\u03c3 depends on \u03bdk+1 nor \u03a6\u03c3 on \u03bdk . Once we have\ndefined the constraints we can implement the Lagrangian multiplier rule in\norder to solve the underactuated problem. Namely, we define de extended\nLagrangian as:\nL \u0303d (\u03bdk , \u03bb\u2212 , Wk , \u03bdk+1 , \u03bb+ ) =Ld (\u03bdk , Wk , \u03bdk+1 )\nk\n\nk\n\n\u03c3 \u2212\n+ (\u03bb\u2212\nk ) \u03a6\u03c3 (\u03bdk , Wk , \u03bdk+1 )\n\n+\n\n(24)\n\n\u03c3 +\n(\u03bb+\nk ) \u03a6\u03c3 (\u03bdk , Wk , \u03bdk+1 ).\n\nDefining the discrete action sum\nSdunder\n\n=\n\nN\n\u22121\nX\n\n+\nL\u0303d (\u03bdk , \u03bb\u2212\nk , Wk , \u03bdk+1 , \u03bbk ),\n\nk=0\n\nwe obtain the underactuated discrete equations of motion\n\u2217\nlW\n\n\u2217\ndLd (\u03bd ,\u03bd ) (Wk\u22121 ) \u2212 rW\ndLd (\u03bd ,\u03bd ) (Wk )\nk\u22121 k\nk k+1\nk\u22121\n\u0010\n\u0011\n\u2212\n\u2217\n\u03c3\n\u2212\n\u03c3\n+\n+ lW\n(\u03bbk\u22121 ) d \u03a6\u03c3 (\u03bd ,\u03bd ) (Wk\u22121 ) + (\u03bb+\n)\nd\n\u03a6\n(W\n)\nk\u22121\n\u03c3 (\u03bdk\u22121 ,\u03bdk )\nk\u22121\nk\u22121 k\nk\u22121\n\u0010\n\u0011\n+ \u03c3\n\u2217\n\u03c3\n\u2212\n+\n\u2212 rW\n(\u03bb\u2212\n)\nd\n\u03a6\n(W\n)\n+\n(\u03bb\n)\nd\n\u03a6\n(W\n)\n= 0,\nk\nk\n\u03c3 (\u03bdk ,\u03bdk+1 )\n\u03c3 (\u03bdk ,\u03bdk+1 )\nk\nk\nk\u22121\n\u0002 + \u03c3\n\u0003\n\u03c3\nD2 Ld (W ) (\u03bdk\u22121 , \u03bdk ) + D1 Ld (W ) (\u03bdk , \u03bdk+1 ) + (\u03bbk\u22121 ) \u2212 (\u03bb\u2212\ne\u03c3 = 0,\nk)\nk\u22121\n\nk\u22121\n\nk\n\n\u03a6\u2212\n\u03c3 (\u03bdk , Wk , \u03bdk+1 ) = 0,\n\u03a6+\n\u03c3 (\u03bdk , Wk , \u03bdk+1 ) = 0,\n(25)\n\n\f14\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nwhere the subscripts (Wk\u22121 ), (Wk ), (\u03bdk\u22121 , \u03bdk ), (\u03bdk , \u03bdk+1 ) denoted variables\nthat are fixed.\n\n5. Numerical Methods for Systems on Lie Groups\nWe now put the discrete optimal control equations (22) and (25) into a\nform suitable for algorithmic implementation. The numerical methods are\nconstructed using the following guidelines:\n(1)\n(2)\n(3)\n(4)\n\ngood approximation of the dynamics and optimality,\navoid issues with local coordinates\nguarantee for numerical robustness and convergence,\nnumerical efficiency.\n\nThe discrete mechanics approach provides an accurate approximation of the\ndynamics (requirement 1) through momentum and symplectic form preservation and good energy behavior. In addition, we will satisfy requirement 2\nfor systems on Lie groups by lifting the optimization to the Lie algebra\nthrough a retraction map that will be defined in this section. The resulting algorithms are numerically robust in the sense that there are no issues\nwith coordinate singularities and the dynamics and optimality conditions\nremain close to their continuous counterparts even at big time steps. Yet,\nas with any other nonlinear optimization scheme it is difficult to formally\nclaim that the algorithm will always converge (requirement 3). Nevertheless,\nin practice there are only isolated cases for underactuated systems that fail\nto converge. A remedy for such cases has been suggested in [18]. In general,\nthe resulting algorithms require a small number of iterations, e.g. between\n10 and 20 to converge (requirement 4).\nThe optimization variables Wk are regarded as small displacements on the\nLie group. Thus, it is possible to express each term through a Lie algebra\nelement that can be regarded as the averaged velocity of this displacement.\nThis is accomplished using a retraction map \u03c4 : g \u2192 G which is an\nanalytic local diffeomorphism around the identity such that \u03c4 (\u03be)\u03c4 (\u2212\u03be) = e,\nwhere \u03be \u2208 g. Two standard choices for \u03c4 are employed in this work: the\nexponential map, and the Cayley map.\nRegarding \u03be as a velocity we set the discrete Lagrangian ld : G \u2192 R to\nld (Wk ) = h l(\u03bek ),\nwhere \u03bek = \u03c4 \u22121 (gk\u22121 gk+1 )/h = \u03c4 \u22121 (Wk )/h. The difference gk\u22121 gk+1 \u2208 G,\nwhich is an element of a nonlinear space, can now be represented by the\nvector \u03bek in order to enable unconstrained optimization in the linear space\ng for optimal control purposes.\nThe variational principle will now be expressed in terms of the chosen\nmap \u03c4 . The resulting discrete mechanics will thus involve the derivatives of\nthe map which we define next (see also [7, 15, 18]):\nDefinition 5.1. Given a map \u03c4 : g \u2192 G, its right trivialized tangent\nd\u03c4\u03be : g \u2192 g and is inverse d\u03c4\u03be\u22121 : g \u2192 g, are such that for g = \u03c4 (\u03be) \u2208 G\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n15\n\nand \u03b7 \u2208 g, the following holds\n\u2202\u03be \u03c4 (\u03be) \u03b7 = d\u03c4\u03be \u03b7 \u03c4 (\u03be),\n\u2202\u03be \u03c4 \u22121 (g) \u03b7 = d\u03c4\u03be\u22121 (\u03b7 \u03c4 (\u2212\u03be)).\nUsing these definitions, variations \u03b4\u03be and \u03b4g are constrained by\n\u22121\n\u03b4\u03bek = d\u03c4h\u03be\n(\u2212\u03b7k + Ad\u03c4 (h\u03bek ) \u03b7k+1 )/h,\nk\n\nwhere \u03b7k = gk\u22121 \u03b4gk , which is obtained by straightforward differentiation of\n\u03bek = \u03c4 \u22121 (gk\u22121 gk+1 )/h.\nThe retraction map \u03c4 choices are:\na) The exponential map exp : g \u2192 G, defined by exp(\u03be) = \u03b3(1), with\n\u03b3 : R \u2192 G in the integral curve through the identity of the vector field\nassociated with \u03be \u2208 g (hence, with \u03b3\u0307(0) = \u03be). The right trivialized derivative\nand its inverse are defined by\ndexpx y =\n\n\u221e\nX\nj=0\n\ndexp\u22121\nx y =\n\n1\nadj y,\n(j + 1)! x\n\n\u221e\nX\nBj\nj=0\n\nj!\n\nadjx y,\n\nwhere Bj are the Bernoulli numbers (see [12]). Typically, these expressions\nare truncated in order to achieve a desired order of accuracy.\nb) The Cayley map cay : g \u2192 G is defined by cay(\u03be) = (e \u2212 2\u03be )\u22121 (e + 2\u03be )\nand is valid for a general class of quadratic groups (see [12]) that include the\ngroups of interest in this paper (e.g. SO(3), SE(2) and SE(3)). Its right\ntrivialized derivative and inverse are defined by\nx\nx\ndcayx y = (e \u2212 )\u22121 y (e + )\u22121 ,\n2\n2\nx\nx\n\u22121\ndcayx y = (e \u2212 ) y (e + ).\n2\n2\nNext, the discrete forces and cost function are defined through a trapezoidal approximation, i.e.\nfk\u00b1 (\u03bek , u\u00b1\nk)=\n\nh\nf (\u03bek , u\u00b1\nk ),\n2\n\nand\nh\nh\nC(\u03bek , u\u2212\n) + C(\u03bek , u+\nk\nk ),\n2\n2\nrespectively. With the choice of a retraction map and the trapezoidal rule\nthe equations of motion (13) become\n+\nCd (u\u2212\nk , \u03bek , uk ) =\n\n\u03bck \u2212 Ad\u2217\u03c4 (h\u03bek\u22121 ) \u03bck\u22121 =\n\u22121 \u2217\n\u03bck = (d\u03c4h\u03be\n) \u2202\u03be l(\u03bek ),\nk\n\ngk+1 = gk \u03c4 (h\u03bek ),\n\nh\nh\n+\nf (\u03bek , u\u2212\nk ) + 2 f (\u03bek\u22121 , uk\u22121 ),\n2\n\n\f16\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nwhile the momenta defined in (21) take the form\nh\nf (\u03bek , u\u2212\nk ),\n2\nh\n\u03bdk+1 = Ad\u2217\u03c4 (h\u03bek ) \u03bck + f (\u03bek , u+\nk ).\n2\nFinally, define the Lagrangian `d : g\u2217 \u00d7 g \u00d7 g\u2217 \u2192 R such that\n\u03bdk = \u03bck \u2212\n\n(26)\n(27)\n\n`d (\u03bd, \u03be, \u03bd 0 ) = Ld (\u03bd, \u03c4 (h\u03be), \u03bd 0 ).\nNote that the Lagrangian is well-defined only on g\u2217 \u00d7U\u00d7g\u2217 , where U \u2282 g is an\nopen neighborhood around the identity for which \u03c4 is a diffeomorphism. To\nmake the notation as simple as possible we retain the Lagrangian definition\nto the full space g\u2217 \u00d7 g \u00d7 g\u2217 .\nThe optimality conditions corresponding to (22) become\n\u22121\n(d\u03c4\u2212h\u03be\n)\u2217 d `d\nk\u22121\n\n(\u03bdk\u22121 ,\u03bdk )\n\nD2 `d\n\n\u22121 \u2217\n(\u03bek\u22121 ) \u2212 (d\u03c4h\u03be\n) d `d\nk\n\n(\u03bek\u22121 )\n\n(\u03bdk\u22121 , \u03bdk ) + D1 `d\n\n(\u03bdk ,\u03bdk+1 )\n\n(\u03bek )\n\n(\u03bek ) = 0, (28)\n\n(\u03bdk , \u03bdk+1 ) = 0, (29)\n\nfor k = 0, ..., N \u2212 1. Here, `d (\u03be) (\u03bd, \u03bd 0 ) = `d (\u03bd,\u03bd 0 ) (\u03be) = `d (\u03bd, \u03be, \u03bd 0 ). Equations\n(28) and (29) can be also obtained from (22) employing Lemma 8.2 and\nLemma 8.3 in Appendix A.\nIn the underactuated case we define\n` \u0303d (\u03bd, \u03be, \u03bd 0 , \u03bb\u2212 , \u03bb+ ) =Ld (\u03bd, \u03c4 (h\u03be), \u03bd 0 )\n+ (\u03bb\u2212 )\u03c3 \u03a6\u2212\n\u03c3\n\n(\u03bd,\u03bd 0 )\n\n(\u03c4 (h\u03be)) + (\u03bb+ )\u03c3 \u03a6+\n\u03c3\n\n(\u03bd,\u03bd 0 )\n\n(\u03c4 (h\u03be)),\n(30)\n\nand from (25) obtain the equations\n\u22121\n)\u2217 d ` \u0303d\n(d\u03c4\u2212h\u03be\nk\u22121\n\nD2 Ld\n\n\u03c4 (h\u03bek\u22121 )\n\n(\u03bdk\u22121 ,\u03bdk ,\u03bb\u00b1\nk\u22121 )\n\n\u22121 \u2217  \u0303\n) d `d\n(\u03bek\u22121 ) \u2212 (d\u03c4h\u03be\nk\n\n(\u03bdk\u22121 , \u03bdk ) + D1 Ld\n\n\u03c4 (h\u03bek )\n\n(\u03bdk ,\u03bdk+1 ,\u03bb\u00b1\nk)\n\n(\u03bek ) = 0,\n\n\u2212\n(\u03bdk , \u03bdk+1 ) + \u03bb+\nk\u22121 \u2212 \u03bbk = 0,\n\n\u03a6\u2212\n\u03c3 (\u03bdk , \u03c4 (h\u03bek ), \u03bdk+1 ) = 0,\n\n(31)\n\n\u03a6+\n\u03c3 (\u03bdk , \u03c4 (h\u03bek ), \u03bdk+1 ) = 0,\nwhere we employed the notation \u03bb\u00b1 := (\u03bb\u00b1 )\u03c3 e\u03c3 .\nBoundary Conditions.: Establishing the exact relationship between the\ndiscrete and continuous momenta, \u03bck and \u03bc(t) = \u2202\u03be l(\u03be(t)), respectively, is\nparticularly important for properly enforcing boundary conditions that are\ngiven in terms of continuous quantities. The following equations relate the\nmomenta at the initial and final times t = 0 and t = T and are used to\ntransform between the continuous and discrete representations:\nh\nf (\u03be(0), u\u2212\n0 ),\n2\nh\nf (\u03be(T ), u+\n\u2202\u03be l(\u03be(T )) \u2212 Ad\u2217\u03c4 (h\u03beN \u22121 ) \u03bcN \u22121 =\nN ).\n2\nwhich also corresponds to the relations \u03bd0 = \u2202\u03be l(\u03be(0)) and \u03bdN = \u2202\u03be l(\u03be(T )).\nThese equations can also be regarded as structure-preserving velocity boundary conditions, i.e., for given fixed velocities \u03be(0) and \u03be(T ).\n\u03bc0 \u2212 \u2202\u03be l(\u03be(0)) =\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n17\n\nThe exact form of the previous equations depends on the choice of \u03c4 .\nThis choice will also influence the computational efficiency of the optimization framework when the above equalities are enforced as constraints. The\nnumerical procedure to compute the trajectory is summarized as follows:\nAlgorithm 5.2. Optimal control\nData: group G; mechanical Lagrangian l; control functions a, b; cost\nfunction C; final time T ; number of segments N .\n(1)\nInput: boundary conditions (g(0), \u03be(0)) and (g(T ), \u03be(T )).\n(2)\nSet momenta \u03bd0 = \u2202\u03be l(\u03be(0)) and \u03bdN = \u2202\u03be l(\u03be(T ))\n\u00b1\n(3)\nSolve for (\u03be0 , ..., \u03beN \u22121 , \u03bd1 , ..., \u03bdN \u22121 , \u03bb\u00b1\n1 , ..., \u03bbN \u22121 ) the relations:\n\u001a\nequations (31) for all k = 1, ..., N \u2212 1, \u0001\n\u03c4 \u22121 \u03c4 (h\u03beN \u22121 )\u22121 ...\u03c4 (h\u03be0 )\u22121 g(0)\u22121 g(T ) = 0\n(4)\nOutput: optimal sequence of velocities \u03be0 , ..., \u03beN \u22121 .\n(5) Reconstruct path g0 , ..., gN by gk+1 = gk \u03c4 (h\u03bek ) for k = 0, ..., N \u2212 1.\nThe solution is computed using root-finding procedure such as Newton's\nmethod. If the initial guess does not satisfy the dynamics we recommend\nto use a Levenberg-Marquardt algorithm which has slower but more robust\nconvergence.\n5.1. Example: optimal control effort. Consider a Lagrangian consisting\nof the kinetic energy only\n1\nl(\u03be) = hI(\u03be) , \u03bei,\n2\nfull unconstrained actuation, no potential or external forces and no velocity\nconstraint. The map I : g \u2192 g\u2217 is called the inertia tensor and is assumed\nfull rank.\n\u00b1\nIn the fully actuated case we have f (\u03bek , u\u00b1\nk ) \u2261 uk . We consider a minimum effort control problem, i.e.\n1\nC(\u03be, u) = kuk2 .\n2\nThe optimal control problem for fixed initial and final states (g(0) , \u03be(0))\nand (g(T ) , \u03be(T )) can now be summarized as:\nCompute: \u03be0:N \u22121 , u\u00b1\n0:N ,\nminimizing:\n\nh\n4\n\nPN \u22121\nk=0\n\n\u0001\n+ 2\n2\nk u\u2212\nk k + k uk k ,\n\nsubject to:\n\u03bc0 \u2212 I(\u03be(0)) =\n\nh\n2\n\nu\u2212\n0,\n\n+\n\u03bck \u2212 Ad\u2217\u03c4 (h\u03bek\u22121 ) \u03bck\u22121 = h(u\u2212\nk + uk\u22121 ),\n\nI(\u03be(T )) \u2212 Ad\u2217\u03c4 (h\u03beN \u22121 ) \u03bcN \u22121 =\n\nh\n2\n\nk = 1, ..., N \u2212 1,\n\nu+\nN,\n\n\u2217\n\u03bck = (d\u03c4h\u22121\n\u03bek ) I(\u03bek ),\n\ngk+1 = gk \u03c4 (h\u03bek ),\n\u22121\n\u03c4 \u22121 (gN\ng(T )) = 0.\n\nk = 0, ...N \u2212 1,\n\n\f18\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nThe optimality conditions for this problem are derived as follows. The\nLagrangian becomes\n`d (\u03bdk , \u03bek , \u03bdk+1 ) =\n\nN \u22121\n\u0011\n1 X\u0010\n\u22121 \u2217\n\u22121\n2\n\u2217\n2\nk \u03bdk \u2212 (d \u03c4h\u03be\n)\nI(\u03be\n)\nk\n+\nk\n\u03bd\n\u2212\n(d\n\u03c4\n,\n)\nI(\u03be\n)\nk\nk\nk+1\nk\n\u2212h\u03bek\nk\n4h\nk=0\n\nwhere the momentum has been computed according to\n\u0011\n1\u0010\n\u22121 \u2217\n\u22121\n\u2217\n(d \u03c4h\u03be\n)\nI(\u03be\n)\n+\n(d\n\u03c4\n)\nI(\u03be\n)\n,\n\u03bdk =\nk\nk\u22121\n\u2212h\u03bek\u22121\nk\n2\n\n(32)\n\nThus the optimality conditions become\n\u22121 \u2217\n(d \u03c4h\u03be\n) d`d\nk\n\n(\u03bdk ,\u03bdk+1 )\n\n\u22121\n(\u03bek ) \u2212 (d \u03c4\u2212h\u03be\n)\u2217 d`d\nk\u22121\n\n(\u03bdk\u22121 ,\u03bdk )\n\n(\u03bek\u22121 ) = 0,\n\nk = 1, ..., N \u2212 1,\n\u0001\n\u03c4 \u22121 \u03c4 (h\u03beN \u22121 )\u22121 ...\u03c4 (h\u03be0 )\u22121 g0\u22121 g(T ) = 0.\nIt is important to note that these last two equations define N * n equations\nin the N \u1e45 unknowns \u03be0:N \u22121 . A solution can be found using nonlinear root\nfinding. Once \u03be0:N have been computed, is possible to obtain the final configuration gN by reconstructing the curve by these velocities. Beside, the\n\u22121\nboundary condition g(T ) is enforced through the relation \u03c4 \u22121 (gN\ng(T )) = 0\nwithout the need to optimize over any of the configurations gk .\n5.2. Extension: the configuration-dependent case. The developed framework can be extended to a configuration-dependent Lagrangian L : G \u00d7 g \u2192\nR, for instance defined in terms of a kinetic energy K : g \u2192 R and potential\nenergy V : G \u2192 R according to\nL(g, \u03be) = K(\u03be) \u2212 V (g),\nwhere g \u2208 G and \u03be \u2208 g. The controlled Euler-Poincar\u00e9 equations are in this\ncase\n\u03bc\u0307 \u2212 ad\u2217\u03be \u03bc = \u2212lg\u2217 \u2202g V (g) + f,\n\u03bc = \u2202\u03be K(\u03be),\n\u0121 = g \u03be,\nwhere the external forces are defined as f : G \u00d7 g \u00d7 U \u2192 g\u2217 . Our discretization choice Ld : G \u00d7 G \u2192 R will be (recall that \u03bek = \u03c4 \u22121 (gk\u22121 gk+1 )/h)\nh\nh\nL(gk , \u03bek ) + L(gk+1 , \u03bek )\n2\n2\nV (gk ) + V (gk+1 )\n= h K(\u03bek ) \u2212 h\n,\n2\n\nLd (gk , gk+1 ) =\n\nwhile the G-dependent discrete forces now become\nfk\u2212 (gk , \u03bek , u\u2212\nk)=\n\nh\nf (gk , \u03bek , u\u2212\nk ),\n2\n\nfk+ (gk+1 , \u03bek , u+\nk)=\n\nh\nf (gk+1 , \u03bek , u+\nk ).\n2\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n19\n\nThis leads to the discrete equations\n\u03bck \u2212 Ad\u2217\u03c4 (h\u03bek\u22121 ) \u03bck\u22121 = \u2212h lg\u2217k \u2202g V (gk )\nh\nh\n+ f (gk , \u03bek , u\u2212\n) + f (gk , \u03bek\u22121 , u+\nk\nk\u22121 ),\n2\n2\n\u22121 \u2217\n\u03bck = (d\u03c4h\u03be\n) \u2202\u03be K(\u03bek ),\nk\n\ngk+1 = gk \u03c4 (h\u03bek ).\nThe momenta become\nh\nh\n\u03bdk = \u03bck + lg\u2217k \u2202g V (gk ) \u2212 f (gk , \u03bek , u\u2212\nk ),\n2\n2\nh\nh\n\u03bdk+1 = Ad\u2217\u03c4 (h\u03bek ) \u03bck \u2212 lg\u2217k+1 \u2202g V (gk+1 ) + f (gk+1 , \u03bek , u+\nk ).\n2\n2\nIn consequence, we can define a discrete Lagrangian\nLd : g\u2217 \u00d7 G \u00d7 g \u00d7 g\u2217 \u2192 R,\ndepending on the variables (\u03bdk , gk , \u03bek , \u03bdk+1 ) which discrete equations of motion will be a mixture between (22) and (28), (29), namely\nD2 Ld (g ,\u03be ) (\u03bdk\u22121 , \u03bdk ) + D1 Ld (g ,\u03be ) (\u03bdk , \u03bdk+1 ) = 0,\nk\u22121 k\u22121\nk k\n\u0011\n\u0010\nlg\u2217 d Ld (\u03bd ,\u03be ,\u03bd ) (gk\u22121 ) + rg\u2217 d Ld (\u03bd ,\u03be ,\u03bd ) (gk )\nk k k+1\nk\u22121 k\u22121 k\nk\nk\u22121\n\u0010\n\u22121\n\u22121 \u2217\n+ (d\u03c4\u2212h\u03be\n)\u2217 d Ld (\u03bd ,g ,\u03bd ) (\u03bek\u22121 ) \u2212 (d\u03c4h\u03be\n) d Ld (\u03bd\nk\u22121\nk\nk\u22121\n\nk\u22121\n\nk\n\nk ,gk ,\u03bdk+1\n\n\u0011\n(\u03be\n)\n= 0.\nk\n)\n\n6. Applications\n6.1. Underwater Vehicle. We illustrate the developed algorithm with an\napplication to a simulated unmanned underwater vehicle. Figure (1) shows\nthe model equipped with five thrusters which produce forces and torques\nin all directions but the body-fixed \"y\"-axis. Since the input directions\nspan only a five-dimensional subspace the problem is solved through the\nunderactuated framework.\nThe vehicle configuration space is G = SE(3). We make the identification\nSE(3) \u223c SO(3) \u00d7 R3 using elements R \u2208 SO(3) and x \u2208 R3 through\n\u0012\n\u0013\n\u0012\n\u0013\nR\nx\nRT \u2212RT x\n\u22121\n,\ng=\n, g =\n03\u00d73 1\n03\u00d73\n1\nwhere g \u2208 SE(3). Elements of the Lie algebra \u03be \u2208 se(3) are identified\nwith body-fixed angular and linear velocities denoted \u03c9 \u2208 R3 and v \u2208 R3 ,\nrespectively, through\n\u0012\n\u0013\n\u03c9\u0302\nv\n\u03be=\n,\n03\u00d73 0\nwhere the map \u02c6* : R3 \u2192 so(3) is defined by\n\uf8eb\n\uf8f6\n0\n\u2212\u03c93 \u03c92\n0\n\u2212\u03c91 \uf8f8 .\n\u03c9\u0302 = \uf8ed \u03c93\n\u2212\u03c92 \u03c91\n0\n\n(33)\n\n\f20\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nz\n\nx\nreconfigurations\n\nu5\n\ny\n\nu4\n\nd\n\nu3\nc\npropellers\n\nflip\nu1\n\nu2\n\nparallel\nparking\n\ndrag\n\na)\n\nb)\n\nFigure 1. An underwater vehicle model (a) and a various computed\noptimal trajectories between chosen states (b). Only a few frames along\nthe path are shown for clarity.\nAngular velocity\n\n5\n\n4\nvx\n\n\u03c9x\nm/s\n\n\u03c9z\n\n0\n\n1\n2\n\nvy\n\n2\n\ny\n\nvz\n\n0\n\nN\n\n\u03c9\nrad/s\n\nControl inputs\n\nLinear velocity\n\n5\n\n3\n\n0\n\n4\n5\n\n\u22125\n0\n\n2\n\nsec.\n\n4\n\n6\n\n\u22122\n0\n\n2\n\nsec.\n\n4\n\n6\n\n\u22125\n0\n\n2\n\nsec.\n\n4\n\n6\n\nFigure 2. Details of the computed optimal path for the reconfiguration maneuver given in Figure (1).\n\nThe algorithm is thus implemented in terms of vectors in R6 rather than\nmatrices in se(3).\nThe map \u03c4 = cay : se(3) \u2192 SE(3) is chosen, instead of the exponential, since it results in more computationally efficient implementation. It is\ndefined by\n\u0012\n\u0013\ncay(\u03c9\u0302) dcay\u03c9 v\ncay(\u03be) =\n,\n0\n1\nwhere cay : so(3) \u2192 SO(3) is given\ncay(\u03c9\u0302) = I3 +\n\n1\n\nby\n\n4\n4+ k \u03c9 k2\n\n\u0012\n\u0013\n\u03c9\u0302 2\n\u03c9\u0302 +\n,\n2\n\n(34)\n\nwhere In is the n \u00d7 n identity matrix and dcay : R3 \u2192 R3 is defined by\ndcay\u03c9 =\n\n2\n(2I3 + \u03c9\u0302).\n4+ k \u03c9 k2\n\n(35)\n\n1note that cay denotes a map to either SO(3) or SE(3) which should be clear from its\nargument.\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n21\n\nThe matrix representation of the right-trivialized tangent inverse d\u03c4 \u22121\n(\u03c9,v) :\n3\n3\n3\n3\nR \u00d7 R \u2192 R \u00d7 R becomes\n\u0014\n\u0015\nT\nI3 \u2212 12 \u03c9\nb + 41 \u03c9\u03c9\n0\n3\n\u22121\n\u0001\n[dcay(\u03c9,v) ] =\n.\n(36)\nb vb I3 \u2212 12 \u03c9\nb\n\u2212 12 I3 \u2212 12 \u03c9\nThe vehicle inertia tensor I is computed assuming cylindrical mass distribution with mass m = 3kg. The control basis vectors are {es }5s=1 =\n{e1 , e2 , e3 , e4 , e5 }, while the non-actuated direction is e\u03c3 = e6 , where ei is\nthe i-th standard basis vector of R6 . The control functions take the form\nb(W, u)1 = d(u5 \u2212 u4 ),\nb(W, u)2 = c((u1 + u2 )/2 \u2212 u3 ),\n\u03c0\nb(W, u)3 = (c sin )(u2 \u2212 u1 ),\n3\nb(W, u)4 = u1 + u2 + u3 ,\nb(W, u)5 = u4 + u5 ,\na(W ) = H\u03c4 \u22121 (W ),\nhere H is a negative definite viscous drag matrix and the constants c, d are\nthe lengths of the thrusting torque moment arms (see Figure 1).\nWe are interested in computing a minimum control effort trajectory between two given boundary states, i.e. conditions on both the configurations\nand velocities. Such a cost function is defined in \u00a75.1. The optimal control\nproblem is solved using equations (31). The computation is performed using Algorithm 5.2. Figure 2 shows the computed velocities and controls for\nthe \"reconfiguration\" trajectory shown in Figure 1. The algorithms requires\nbetween 10-20 iterations depending on the boundary conditions and when\napplied to N = 32 segments.\n\nForces\n0.4\n\nux\nuy\n\nN\n\n0.2\n0\n\u22120.2\n\u22120.4\n0\n\na)\n\n5\nsec.\n\n10\n\nb)\n\nFigure 3. An optimal trajectory of an underactuated rigid body\non SO(3) (a). The body is controlled using two force inputs around\nthe body-fixed x and y axes. An L1 -control cost function results in a\ndiscontinuous optimal trajectory (b) which our algorithm can handle.\n\n6.2. Discontinuous Control. One of the advantages of employing the discrete variational framework is the treatment of discontinuous control inputs\nas illustrated in \u00a73. The nature of the control curve depends on the cost\nfunction. In the standard squared control effort case (i.e. L2 control curve\n\n\f22\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nnorm employed in \u00a76.1) the resulting control is smooth. Another cost funcRT\ntion of interest is 0 ku(t)kdt (i.e. the L1 control curve norm) which is\ntypically imposed along with the constraints umin \u2264 u(t) \u2264 umax . This\ncase results in a discontinuous optimal control curve. Our formulation can\n+\nhandle such problems easily since the terms u\u2212\nk and uk are regarded as the\nforces before and after time tk , respectively. A computed scenario of a rigid\nbody actuated with two control torques around its principles axes of inertia\n(Fig. 3) illustrates the discontinuous case.\n7. Extensions\nThe methods developed in the previous sections are easily adapted to\nother cases which are of great interest in real applications. In particular, this\nsection will be devoted to the discussion of two important extensions: the\ncase of optimal control problems for Lagrangians of the type l : T M \u00d7g \u2192 R\n(that is, reduction by symmetries on a trivial principal fiber bundle) and\nthe case of nonholonomic systems. Here, M denotes a smooth manifold.\nObserve that the phase space T M \u00d7 g unifies the previously studied cases\nof a tangent bundle and a Lie algebra.\nThe notion of principal fiber bundle is present in many locomotion and\nrobotic systems [5, 8, 27]. When the configuration manifold is Q = M \u00d7 G,\nthere exists a canonical splitting between variables describing the position\nand variables describing the orientation of the mechanical system. Then,\nwe distinguish the pose coordinates g \u2208 G (the elements in the Lie algebra\nwill be denoted by \u03be \u2208 g), and the variables describing the internal shape\nof the system, that is x \u2208 M (in consequence (x, \u1e8b) \u2208 T M ). Observe that\nthe Lagrangians of the type l : T M \u00d7 g \u2192 R mainly appears as reduction of\nLagrangians of the type L : T (M \u00d7 G) \u2192 R, which are invariant under the\naction of the Lie group G. Under the identification T (M \u00d7 G)/G \u2261 T M \u00d7 g\nwe obtain the reduced Lagrangian l. We first develop the discrete optimal\ncontrol problem for systems in an unconstrained principle bundle setting\nin \u00a77.1. Nonholonomic constraints are then added to treat the more general\ncase of locomotion systems in \u00a77.2.\n7.1. Discrete Optimal Control on Principle Bundles. The discrete\ncase is modeled by a Lagrangian ld : M \u00d7 M \u00d7 G \u2192 R which is an approximation of the action integral in one time step\nZ h(k+1)\nld (xk , xk+1 , Wk ) '\nl (x(t), \u1e8b(t), \u03be(t)) dt,\nhk\n\nwhere (xk , xk+1 ) \u2208 M \u00d7 M and Wk \u2208 G. Again, we make an election for the\ndiscrete control forces fk\u00b1 : M \u00d7 M \u00d7 G \u00d7 U \u2192 T \u2217 M \u00d7 g\u2217 , where U \u2282 Rm :\n\u0011\n\u0010\n \u0304\u2212 (xk , xk+1 , Wk , u\u2212 ), f\u02c6\u2212 (xk , xk+1 , Wk , u\u2212 ) ,\nf\nfk\u2212 (xk , xk+1 , Wk , u\u2212\n)\n=\nk\nk\nk\nk\nk\n\u0010\n\u0011\n \u0304+ (xk , xk+1 , Wk , u+ ), f\u02c6+ (xk , xk+1 , Wk , u+ ) ,\nfk+ (xk , xk+1 , Wk , u+\n)\n=\nf\nk\nk\nk\nk\nk\nhere fk\u2212 \u2208 Tx\u2217k M \u00d7 g\u2217 and fk+ \u2208 Tx\u2217k+1 M \u00d7 g\u2217 (more concretely f \u0304k\u2212 \u2208 Tx\u2217k M ,\nf \u0304+ \u2208 T \u2217 M , f\u02c6\u2212 \u2208 g\u2217 , f\u02c6+ \u2208 g\u2217 ).\nk\n\nxk+1\n\nk\n\nk\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n23\n\nSimilarly to the developments in \u00a7 3 and \u00a7 4.1 we can formulate the\ndiscrete Lagrange-D'Alembert principle:\n\n\u03b4\n\nN\n\u22121\nX\n\nld (xk , xk+1 , Wk ) +\n\nk=0\n\n+\n\nN\n\u22121\nX\n\nhfk\u2212 , (\u03b4xk , \u03b7k )i\n\nk=0\nN\n\u22121\nX\n\nhfk+ , (\u03b4xk+1 , \u03b7k+1 )i = 0,\n\nk=0\n\nwhich can be rewritten as\n\u03b4\n\nN\n\u22121\nX\n\nld (xk , xk+1 , Wk ) +\n\nk=0\n\n+\n\nN\n\u22121\nX\n\nf \u0304k\u2212 \u03b4xk +\n\nN\n\u22121\nX\n\nf \u0304k+ \u03b4xk+1\n\nk=0\nN\n\u22121\nX\n\nk=0\nN\n\u22121\nX\n\nk=0\n\nk=0\n\nhf\u02c6k\u2212 , \u03b7k i +\n\nhf\u02c6k+ , \u03b7k+1 i = 0,\n\nfor all variations {\u03b4xk }N\nk=0 with \u03b4xk \u2208 Txk M and \u03b4x0 = \u03b4xN = 0; also\nN\n{\u03b4Wk }k=0 with \u03b4Wk \u2208 Tgk G, such that \u03b4Wk = \u2212\u03b7k Wk + Wk \u03b7k+1 , being\n{\u03b7k }N\nk=0 a sequence of independent elements of g such that \u03b70 = \u03b7N = 0.\nApplying variations in the last expression and rearranging the sum, we\nfinally obtain the complete set of forced discrete Euler-Lagrange equations:\n+\n= 0,\nD1 ld (xk , xk+1 , Wk ) + D2 ld (xk\u22121 , xk , Wk\u22121 ) + f \u0304k\u2212 + f \u0304k\u22121\nl\u2217\nD3 ld (xk\u22121 , xk , Wk\u22121 ) \u2212 r\u2217 D3 ld (xk , xk+1 , Wk ) + f\u02c6\u2212 + f\u02c6+\nWk\u22121\n\nWk\n\nk\n\nk\u22121\n\n(37)\n= 0,(38)\n\nwith k = 1, . . . , N \u22121. Since we are dealing with an optimal control problem,\nwe introduce a discrete cost function Cd : M \u00d7 G \u00d7 M \u00d7 U \u00d7 U \u2192 R. As in\nprevious cases, our objective is to extremize the following sum\nN\n\u22121\nX\n\n+\nCd (xk , Wk , xk+1 , u\u2212\nk , uk ),\n\nk=0\n\nsubjected to equations (37) and (38). Let us initially restrict our attention\nto the case of fully actuated systems.\nDefinition 7.1. (Fully actuated discrete system) We say that the discrete mechanical control system is fully actuated if the mappings\nfk\u2212\n\n(x0 ,x1 ,W1 )\n\n: U \u2192 Tx\u22170 M \u00d7 g\u2217 ,\n\nfk\u2212\n\n(x0 ,x1 ,W1 )\n\nfk+\n\n(x0 ,x1 ,W1 )\n\n: U \u2192 Tx\u22171 M \u00d7 g\u2217 ,\n\nfk+\n\n(x0 ,x1 ,W1 )\n\nare both diffeomorphisms.\n\n(u) = fk\u2212 (x0 , x1 , W1 , u),\n(u) = fk+ (x0 , x1 , W1 , u)\n\n\f24\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nAccording to equations (37) and (38), we can introduce the momenta by\nmeans of the following discrete Legendre transforms:\npk = \u2212D1 ld (xk , xk+1 , Wk ) \u2212 f \u0304\u2212 ,\nk\n\npk+1 = D2 ld (xk , xk+1 , Wk ) + f \u0304k+ ,\n\u2217\n\u03bck = rW\nD3 ld (xk , xk+1 , Wk ) \u2212 f\u02c6k\u2212 ,\nk\n\u03bck+1 = l\u2217 D3 ld (xk , xk+1 , Wk ) + f\u02c6+ .\nWk\n\nk\n\nIn the fully actuated case, is possible to find the value of all control forces\nin terms of xk , xk+1 , Wk , pk , pk+1 , \u03bck , \u03bck+1 , that is:\nu\u2212\n= u\u2212\nk\nk (xk , xk+1 , Wk , pk , \u03bck ),\n\n(39)\n\nu+\nk\n\n(40)\n\n=\n\nu+\nk (xk , xk+1 , Wk , pk+1 , \u03bck+1 ).\n\nReplacing (39) and (40) into Cd , we finally obtain the discrete Lagrangian\nthat completely describes our system:\nLd : T \u2217 M \u00d7 g\u2217 \u00d7 G \u00d7 g\u2217 \u00d7 T \u2217 M \u2212\u2192 R.\nThe associated discrete cost functional is\nN\n\u22121\nX\nLd (xk , pk , \u03bck , Wk , \u03bck+1 , xk+1 , pk+1 ).\nJd =\n\n(41)\n\nk=0\n\nAs usual, we take now variations in (41) in order to obtain the discrete\nEuler-Lagrange equations for our optimal control problem (with some abuse\nof notation we denote Q\u0302k = (xk , pk , \u03bck , Wk , \u03bck+1 , xk+1 , pk+1 ) the whole set\nof coordinates in the new phase space):\nD6 Ld (Q\u0302k\u22121 ) + D1 Ld (Q\u0302k ) = 0 ,\nD7 Ld (Q\u0302k\u22121 ) + D2 Ld (Q\u0302k ) = 0 ,\nD5 Ld (Q\u0302k\u22121 )\n\u2217\nlWk\u22121 D4 Ld (Q\u0302k\u22121 )\n\n+ D3 Ld (Q\u0302k ) = 0 ,\n\u2217\n\u2212 rW\nD4 Ld (Q\u0302k ) = 0,\nk\n\ntogether with the forced discrete Euler-Lagrange equations (37) and (38).\nTypically, actuation is achieved by controlling only a subset of the shape\nvariables. In our setting this is can be regarded as underactuation \u2013\nthe mappings in definition 7.1 become embeddings. If this is the case, it is\nnecessary to introduce constraints and apply constrained variational calculus\nas in \u00a7 3.2 and \u00a7 4.1.\n7.2. Discrete Optimal Control of Nonholonomic Systems. This subsection is devoted to add nonholonomic constraints to the picture. Holonomic constraints might be considered as a pacticular case of the nonholonomic ones (see [23] for further details). With this extension it would be\npossible consider examples of optimal control of robotic vehicles. In the following we will expose the theoretical framework, leaving for future research\nthe application to concrete examples.\nA controlled discrete nonholonomic system on M \u00d7 M \u00d7 G is given by the\nfollowing quadruple (see [14, 20]):\ni) A regular discrete Lagrangian ld : M \u00d7 M \u00d7 G \u2192 R.\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n25\n\nii) A discrete constraint embedded submanifold Mc of M \u00d7 M \u00d7\nG.\niii) A constraint distribution, Dc , which is a vector subbundle of the\nvector bundle \u03c4T M \u00d7g : T M \u00d7 g \u2192 M , such that dim Mc = dim Dc .\nTypically, there is a relation between the constraint distribution and\nthe discrete constraint, since from Mc we induce for every x \u2208 M ,\nthe subspace Dc (x) of Tx M \u00d7 g given by\nDc (x) = T(x,x,e) Mc \u2229 (Tx M \u00d7 g) ,\nwhere we are identifying Tx M \u00d7 g \u2261 0x \u00d7 Tx M \u00d7 Te G, with e being\nthe identity element of the Lie group G.\niv) The discrete control forces fk\u00b1 : Mc \u00d7U \u2192 T \u2217 M \u00d7g\u2217 where U \u2282 Rm\n(again, forces fk\u00b1 split into f \u0304k\u00b1 and f\u02c6k\u00b1 as in the previous section).\nWe have the following discrete version of the Lagrange-D'Alembert\nprinciple for controlled nonholonomic systems:\n\u03b4\n\nN\n\u22121\nX\n\nld (xk , xk+1 , Wk ) +\n\nk=0\n\n+\n\nN\n\u22121\nX\n\nhfk\u2212 , (\u03b4xk , \u03b7k )i\n\nk=0\nN\n\u22121\nX\n\nhfk+ , (\u03b4xk+1 , \u03b7k+1 )i = 0,\n\nk=0\n\n{\u03b4xk }N\nk=0 ,\n\nfor all variations\nwith \u03b4x0 = \u03b4xN = 0; and {\u03b4Wk }N\nk=0 , such that\nN\n\u03b4Wk = \u2212\u03b7k Wk + Wk \u03b7k+1 , being {\u03b7k }k=0 , verifying (\u03b4xk , \u03b7k ) \u2208 Dc (xk ) \u2286\nTxk M \u00d7 g such that \u03b70 = \u03b7N = 0. Moreover, (xk , xk+1 , Wk ) \u2208 Mc , k =\n0, . . . , N \u2212 1 (see [14]).\nTake a basis of sections {(X a , \u03b7\u0303 a )} of the vector bundle \u03c4Dc : Dc \u2212\u2192 M ,\nwhere X a \u2208 X(M ) and \u03b7\u0303 a : M \u2192 g for a = 1, ..., rank(Dc ). Hence, the equations of motion derived from the discrete Lagrange-D'Alembert principle for\ncontrolled nonholonomic systems are:\n+\n0 = hD1 ld (xk , xk+1 , Wk ) + D2 ld (xk\u22121 , xk , Wk\u22121 ) + f \u0304k\u2212 + f \u0304k\u22121\n, X a (xk )i\n\n(42)\n\u2217\n+hlW\nD3 ld (xk\u22121 , xk , Wk\u22121 )\nk\u22121\n\n\u2212\n\n\u2217\nrW\nD3 ld (xk , xk+1 , Wk )\nk\n\n0 = \u03a8\u03b1 (xk , xk+1 , Wk ),\n\n+\n\nf\u02c6k\u2212\n\n+\n\n+\nf\u02c6k\u22121\n\na\n\n, \u03b7\u0303 (xk )i,\n(43)\n\n\u03a8\u03b1 (x\n\nwhere\nk , xk+1 , Wk ) = 0 are the constraints which locally determine\nMd .\nIn a more geometric way, we can write equations (42) and (43) as follows\n\u0010\n+\n0 = (iDc )\u2217 D1 ld (xk , xk+1 , Wk ) + D2 ld (xk\u22121 , xk , Wk\u22121 ) + f \u0304k\u2212 + f \u0304k\u22121\n,\n\u0011\n\u2217\n\u2217\n\u02c6\u2212 + f\u02c6+ ,\nlW\nD\nl\n(x\n,\nx\n,\nW\n)\n\u2212\nr\nD\nl\n(x\n,\nx\n,\nW\n)\n+\nf\n3\n3\nd\nk\u22121\nk\nk\u22121\nd\nk\nk+1\nk\nW\nk\nk\u22121\nk\u22121\nk\nwhere(xk , xk+1 , Wk ) \u2208 Mc and iDc : Dc ,\u2192 T M \u00d7g is the canonical inclusion.\nGiven a discrete cost function Cd : U \u00d7 Mc \u00d7 U \u2212\u2192 R and the optimal\ncontrol problem is to minimize the action sum\nN\n\u22121\nX\nk=0\n\n+\nCd (u\u2212\nk , xk , Wk , xk+1 , uk )\n\n\f26\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nsubject to equations (42) and (43) and to some given boundary conditions.\nWe next distinguish between the fully and under\u2013actuated case using the\nfollowing definition:\nDefinition 7.2. (Fully actuated nonholonomic discrete system) We\nsay that the discrete nonholonomic mechanical control system is fully actuated if the mappings\nFk\u2212\n\n(x0 ,x1 ,W1 )\n\n: U \u2192 Dc\u2217 ,\n\nFk\u2212\n\n(x0 ,x1 ,W1 )\n\n(u) = (iDc )\u2217 (fk\u2212 (x0 , x1 , W1 , u)),\n\nFk+\n\n(x0 ,x1 ,W1 )\n\n: U \u2192 Dc\u2217 ,\n\nFk+\n\n(x0 ,x1 ,W1 )\n\n(u) = (iDc )\u2217 (fk+ (x0 , x1 , W1 , u)),\n\nare both diffeomorphisms for all (x0 , x1 , W1 ) \u2208 Mc .\nRegarding equation (42) and its geometric redefinition just below, let\nintroduce the following momenta:\n\u0010\n\u0011\n\u2217\n\u02c6\u2212 ,\n\u03c0k = (iDc )\u2217 \u2212D1 ld (xk , xk+1 , Wk ) \u2212 f \u0304k\u2212 , rW\nD\nl\n(x\n,\nx\n,\nW\n)\n\u2212\nf\n3\nd\nk\nk+1\nk\nk\nk\n\u0010\n\u0011\n+\n\u2217\n\u2217\n\u03c0k+1 = (iDc ) D2 ld (xk , xk+1 , Wk ) + f \u0304k , lWk D3 ld (xk , xk+1 , Wk ) + f\u02c6k+ ,\nwhere both \u03c0k and \u03c0k+1 belong to Dc\u2217 . In the fully actuated case, the value of\nall control forces can be completely determined in terms of xk , xk+1 , Wk , \u03c0k , \u03c0k+1 ,\nwhere the coordinates (xk , xk+1 , Wk ) always belong to Mc . Therefore we\ncan re-express the cost function in terms of these variables and, in consequence, derive the discrete Lagrangian\nLd : (Dc\u2217 ) \u03c4D\u2217 \u00d7pr1 (Mc ) pr2 \u00d7\u03c4 \u2217 (Dc\u2217 ) \u2192 R,\nDc\n\nc\n\nwhere pri : Md \u2286 M \u00d7 M \u00d7 G \u2192 M are the projections onto the first and\nsecond arguments and \u03c4Dc\u2217 : Dc\u2217 \u2192 M the vector bundle projection.\nObserve that we can consider this case as a constrained discrete variational\nproblem taking an extension\nfd : Dc\u2217 \u00d7 G \u00d7 Dc\u2217 \u2192 R\nL\nof Ld subjected to the constraints \u03a8\u03b1 (xk , xk+1 , Wk ) = 0.\nTherefore, denoting Q\u0302k = (xk , \u03c0k , Wk , xk+1 , \u03c0k+1 ) as the whole set of\ncoordinates of the new phase space Dc\u2217 \u00d7G\u00d7Dc\u2217 , we deduce that the equations\nof motion are\nfd (Q\u0302k\u22121 ) + D1 L\nfd (Q\u0302k ) = \u03bbk\u22121 D2 \u03a8\u03b1 (xk\u22121 , xk , Wk\u22121 )\nD4 L\n\u03b1\n\n+\u03bbk\u03b1 D1 \u03a8\u03b1 (xk , xk+1 , Wk ),\nfd (Q\u0302k\u22121 ) + D2 L\nfd (Q\u0302k ) = 0 ,\nD5 L\n\u2217\n\u2217\n\u03b1\nfd (Q\u0302k\u22121 ) \u2212 rW\nfd (Q\u0302k ) = \u03bbk\u22121 l\u2217\nlW\nD3 L\nD3 L\n\u03b1\nWk\u22121 D3 \u03a8 (xk\u22121 , xk , Wk\u22121 )\nk\u22121\nk\n\u2217\n\u2212\u03bbk\u03b1 rW\nD3 \u03a8\u03b1 (xk , xk+1 , Wk ),\nk\n\n\u03a8\u03b1 (xk , xk+1 , Wk ) = 0 ,\nwhere \u03bbk\u03b1 are the Lagrange multipliers of the new constrained problem. The\nunderactuated case can be handled by adding new constraints and applying\ndiscrete constrained variational calculus similarly to \u00a74.\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n27\n\nA natural framework that simplifies the previous construction is based\non discrete mechanics on Lie groupoids [25]. The Lie groupoid structure\ngeneralizes the case of Q \u00d7 Q, the Lie group G and also many intermediate\nsituations. In particular, many of the examples studied in this paper can be\nmodeled using Lie groupoid techniques adapted to our formalism (see [16]).\n\n8. Conclusions\nThis paper develops numerical methods for optimal control of Lagrangian\nmechanical systems defined on tangent bundles, Lie groups, trivial principal\nbundles, and nonholonomic systems. The proposed approach preserves the\ngeometry and variational structure of mechanics through the discretization\nof the variational principles on manifolds. The key point is to solve the optimal control through discrete mechanics, i.e. by formulating the optimization\nas the solution of an action principle of a higher-dimensional system in a new\nLagrangian phase space, i.e. T \u2217 Q \u00d7 T \u2217 Q in the general case and g\u2217 \u00d7 G \u00d7 g\u2217\nin the Lie group case. The optimal control algorithm is then derived as a\nvariational integrator subject to boundary conditions. We thus expect that\nboth the dynamics and optimal control solutions will have accurate and stable numerical behavior (due to symplectic-momentum preservation) even at\nlarge time-steps (which allows for improved run-time efficiency).\nSimulations of an underactuated underwater vehicle illustrate an application of the method. Yet, further numerical studies and comparisons would\nbe necessary to exactly quantify the advantages and the limitations of the\nproposed algorithm. An important future direction is thus to study the convergence properties of the optimal control system. Convergence for general\nnonlinear systems is a complex issue. In this respect, it is interesting to note\nthat the discrete mechanics and optimal control on Lie groups such as the\nexample in using the Cayley map results in polynomial form without further\napproximation or Taylor series truncation. A useful future direction is then\nto study the regions of attraction of the numerical continuation using tools\nfrom algebraic geometry.\nMore generally, the theoretical framework introduced in \u00a77 can serve as\na basis for deriving algorithms for control systems such as multi-body locomotion systems or robotic vehicles with nonholonomic constraints. Furthermore, the developed classes of systems can be unified through the recently\ndeveloped groupoid framework [14, 37]. Each of the considered product\nspaces (e.g. Q\u00d7Q) can be regarded as a single groupoid space with equations\nof motion resulting from a single generalized discrete variational principle.\nThis will enable the automatic solution of optimal control problems for various complex systems and a convenient unified framework for implementing\npractical optimization schemes such as [4, 18, 21, 35]. More importantly,\nthis viewpoint can be used to apply standard discrete Lagrangian regularity\nconditions (e.g. [31]) to optimal control problems evolving on the groupoid\nspace. This would provide a deeper insight into the solvability of the resulting optimization schemes.\n\n\f28\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nAppendix A: Lemmae\nLemma 8.1. (see [30]) Let g \u2208 G, \u03bb \u2208 g and \u03b4f denote the variation of\na function f with respect to its parameters. Assuming \u03bb is constant, the\nfollowing identity holds\n\u03b4(Adg \u03bb) = \u2212Adg [\u03bb , g \u22121 \u03b4g],\nwhere [* , *] : g \u00d7 g \u2192 R denotes the Lie bracket operating or equivalently\n[\u03be , \u03b7] \u2261 ad\u03be \u03b7, for given \u03b7, \u03be \u2208 g.\nLemma 8.2. (see [7]) The following identity holds\nd\u03c4\u03be \u03b7 = Ad\u03c4 (\u03be) d\u03c4\u2212\u03be \u03b7,\nfor any \u03be, \u03b7 \u2208 g.\nLemma 8.3. (see [7]) The following identity holds\n\u0001\n\u22121\nd\u03c4\u03be\u22121 \u03b7 = d\u03c4\u2212\u03be\nAd\u03c4 (\u2212\u03be) \u03b7 ,\nfor any \u03be, \u03b7 \u2208 g.\nReferences\n[1] Abraham R and Marsden JE, \"Foundations of Mechanics\". Addison-Wesley, Second Edition, Benjamin, New York, (1978).\n[2] Benito R and Mart\u0131\u0301n de Diego D, \"Discrete vakonomic mechanics.\" J. Math.\nPhys. 46(8), (2005).\n[3] Bloch AM, \"Nonholonomic Mechanics and Control\". Interdisciplinary Applied\nMathematics Series 24, Springer-Verlag New-York, (2003).\n[4] Bloch AM, Hussein I, Leok M and Sanyal AK, \"Geometric structure-preserving\noptimal control of a rigid body\". Journal of Dynamical and Control Systems, 15,\n(2009).\n[5] Bloch AM, Krishnaprasad PS, Marsden JE and Murray R, \"Nonholonomic\nmechanical systems with symmetry\" Arch. Rational Mech. Anal. 136, pp. 21-99,\n(1996).\n[6] Bobenko AI and Suris YB, \"Discrete Lagrangian reduction, discrete EulerPoincar\u00e9 equations and semidirect products\". Lett. Math. Phys. 49, (1999).\n[7] Bou-Rabee N and Marsden JE, \"Hamilton-Pontryagin Integrators on Lie Groups:\nIntroduction and Structure-Preserving Properties\". Foundations of Computational\nMathematics, 9 (2), (2009).\n[8] Bullo F and Lewis AD, \"Geometric control of mechanical systems: Modeling,\nAnalysis, and Design for Simple Mechanical Control Systems\". Texts in Applied\nMathematics, Springer Verlang, New York, (2005).\n[9] Cort\u00e9s J, \"Geometric, control and numerical aspects of nonholonomic systems\".\nSpringer, (2002).\n[10] Cort\u00e9s J and Mart\u0131\u0301nez E, \"Mechanical control systems on Lie algebroids\". IMA\nJ. Math. Control. Inform. 21 (2004).\n[11] Ferraro S, Iglesias D, and Mart\u0131\u0301n de Diego D, \"Momentum and energy preserving integrators for nonholonomic dynamics\". Nonlinearity, 21, (2008).\n[12] Hairer E, Lubich C and Wanner G, \"Geometric Numerical Integration, StructurePreserving Algorithms for Ordinary Differential Equations\". Springer Series in Computational Mathematics, 31 (2002), Springer-Verlag Berlin.\n[13] Hussein I, Leok M, Sanyal A and Bloch A, \"A Discrete Variational Integrator\nfor Optimal Control Problems on SO(3)\". Proceedings of the 45th IEEE Conference\non Decision and Control, San Diego CA, (2006).\n[14] Iglesias D, Marrero JC, Mart\u0131\u0301n de Diego and Mart\u0131\u0301nez E, \"Discrete Nonholonomic Lagrangian Systems on Lie Groupoids\". Journal of Nonlinear Sciences 18\n(2008).\n\n\fDISCRETE VARIATIONAL OPTIMAL CONTROL\n\n29\n\n[15] Iserles A, Munthe-Kaas H, Norsett S and Zanna A, \"Lie-group methods\".\nActa Numerica (2005).\n[16] Jim\u00e9nez F and Mart\u0131\u0301n de Diego D, \"A geometric approach to Discrete mechanics\nfor optimal control theory, Proceedings of the IEEE Conference on Decision and\nControl\". Atlanta, Georgia, USA, 2010.\n[17] Kobilarov M, \"Discrete Geometric Motion Control of Autonomous Vehicles\". Thesis, University of Southern California, Computer Science, (2008).\n[18] Kobilarov M and Marsden JE, \"Discrete Geometric Optimal Control on Lie\nGroups\". IEEE Transactions on Robotics, (2010).\n[19] Kobilarov M, Marsden JE and Sukhatme GS,\"Geometric discretization of nonholonomic systems with symmetries\". Discrete and Continuous Dynamical Systems Series S (DCDS-S), 5, (2010).\n[20] Kobilarov M, Mart\u0131\u0301n de Diego D and Ferraro S, \"Simulating Nonholonomic\nDynamics\". Bolet\u0131\u0301n de la Sociedad Espanola de Matem\u00e1tica Aplicada (S~eMA), 50,\n(2010).\n[21] Lee T, McClamroch N and Leok M, \"Optimal control of a rigid body using\ngeometrically exact computations on SE(3)\". Proc. IEEE Conf. on Decision and\nControl, (2006).\n[22] Leok M, \"Foundations of Computational Geometric Mechanics, Control and Dynamical Systems\". Thesis, California Institute of Technology, (2004). Available in\nhttp://www.math.lsa.umich.edu/ \u0303mleok.\n[23] Leyendecker S, Ober-Bl\u00f6baum S, Marsden JE and Ortiz M, \"Discrete mechanics and optimal control for constrained systems\". Optimal Control Appl. Methods, 31(6), pp. 505-528, (2010).\n[24] Mackenzie K, \"General Theory of Lie Groupoids and Lie Algebroids\" London Mathematical Society Lecture Note Series: 213, Cambridge University Press, (2005).\n[25] Marrero JC, Mart\u0131\u0301n de Diego D and Mart\u0131\u0301nez E, \"Discrete Lagrangian and\nHamiltonian Mechanics on Lie groupoids\". Nonlinearity 19 (2006). Corrigendum:\nNonlinearity 19 (2006).\n[26] Marrero JC, Mart\u0131\u0301n de Diego D and Stern A,\"Lagrangian submanifolds and\ndiscrete constrained mechanics on Lie groupoids\".Preprint, (2010).\n[27] Marsden JE and Ostrowski J, \"Symmetries in motion: Geometric foundations of\nmotion control.\" Nonlinear Sci. Today, (1998).\n[28] Marsden JE, Pekarsky S and Shkoller S, \"Discrete Euler-Poincar\u00e9 and LiePoisson equations\". Nonlinearity 12 (1999).\n[29] Marsden JE, Pekarsky S and Shkoller S, \"Symmetry reduction of discrete\nLagrangian mechanics on Lie groups\". J. Geom. Phys. 36 (1999).\n[30] Marsden JE and Ratiu TS, \"Introduction to mechanics and symmetry\". Texts in\nApplied Mathematics, 17. Springer-Verlag, New York, (1999).\n[31] Marsden JE and West M, \"Discrete Mechanics and variational integrators\". Acta\nNumerica 10, (2001).\n[32] Mart\u0131\u0301nez E, \"Reduction in optimal control theory\". Rep. Math. Phys. 53 (2004).\n[33] Mart\u0131\u0301nez E, \"Lie algebroids in classical mechanics and optimal control\". SIGMA\nSymmetry Integrability Geom. Methods Appl. 3 (2007),(electronic).\n[34] Moser J and Veselov AP, \"Discrete versions of some classical integrable systems\nand factorization of matrix polynomials\". Comm. Math. Phys. 139, (1991).\n[35] Ober-Bl\u00f6baum S, Junge O and Marsden JE, \"Discrete Mechanics and Optimal\nControl: an Analysis\"ESAIM Control Optim. Calc. Var. 17, (2011).\n[36] Saunders D, \"Prolongations of Lie groupoids and Lie algebroids\". Houston J. Math.\n30 (3), (2004).\n[37] Weinstein A, \"Lagrangian Mechanics and groupoids\". Fields Inst. Comm. 7 (1996).\n\n\f30\n\nF. JIM\u00c9NEZ, M. KOBILAROV, AND D. MART\u00cdN DE DIEGO\n\nF. Jim\u00e9nez: Instituto de Ciencias Matem\u00e1ticas, CSIC-UAM-UC3M-UCM,\nCampus de Cantoblanco, UAM, C/Nicol\u00e1s Cabrera, 15 28049 Madrid, Spain\nE-mail address: fernando.jimenez@icmat.es\nM. Kobilarov: California Institute of Technology, Control and Dynamical Systems, Pasadena, CA 91125, USA\nE-mail address: marin@cds.caltech.edu\nD. Mart\u0131\u0301n de Diego: Instituto de Ciencias Matem\u00e1ticas, CSIC-UAM-UC3MUCM, Campus de Cantoblanco, UAM, C/Nicol\u00e1s Cabrera, 15 28049 Madrid,\nSpain\nE-mail address: david.martin@icmat.es\n\n\f"}