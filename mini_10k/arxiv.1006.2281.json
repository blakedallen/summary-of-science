{"id": "http://arxiv.org/abs/1006.2281v2", "guidislink": true, "updated": "2013-03-13T15:51:33Z", "updated_parsed": [2013, 3, 13, 15, 51, 33, 2, 72, 0], "published": "2010-06-11T12:40:35Z", "published_parsed": [2010, 6, 11, 12, 40, 35, 4, 162, 0], "title": "Exact and high order discretization schemes for Wishart processes and\n  their affine extensions", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1006.0960%2C1006.0197%2C1006.1438%2C1006.3891%2C1006.0595%2C1006.0559%2C1006.5195%2C1006.4198%2C1006.3010%2C1006.0719%2C1006.5814%2C1006.2506%2C1006.1381%2C1006.5651%2C1006.3628%2C1006.3804%2C1006.2101%2C1006.2697%2C1006.0910%2C1006.0136%2C1006.2933%2C1006.2216%2C1006.5044%2C1006.5250%2C1006.2058%2C1006.0942%2C1006.2199%2C1006.3999%2C1006.2125%2C1006.2964%2C1006.3962%2C1006.3468%2C1006.0398%2C1006.1929%2C1006.1011%2C1006.0302%2C1006.5249%2C1006.4997%2C1006.1698%2C1006.2281%2C1006.5100%2C1006.4400%2C1006.5547%2C1006.0622%2C1006.0929%2C1006.0839%2C1006.1864%2C1006.2311%2C1006.5692%2C1006.2440%2C1006.1112%2C1006.5383%2C1006.2791%2C1006.4112%2C1006.5949%2C1006.4123%2C1006.4894%2C1006.2259%2C1006.4866%2C1006.2627%2C1006.2324%2C1006.2683%2C1006.2235%2C1006.0521%2C1006.3055%2C1006.1206%2C1006.2704%2C1006.1904%2C1006.1911%2C1006.0119%2C1006.4185%2C1006.1602%2C1006.5116%2C1006.1513%2C1006.1477%2C1006.5470%2C1006.3125%2C1006.0534%2C1006.4926%2C1006.4202%2C1006.2441%2C1006.0809%2C1006.5599%2C1006.3399%2C1006.4572%2C1006.1555%2C1006.5074%2C1006.5669%2C1006.2717%2C1006.1552%2C1006.1303%2C1006.1001%2C1006.1258%2C1006.1115%2C1006.4719%2C1006.0525%2C1006.4111%2C1006.5033%2C1006.3108%2C1006.4001%2C1006.5329&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Exact and high order discretization schemes for Wishart processes and\n  their affine extensions"}, "summary": "This work deals with the simulation of Wishart processes and affine\ndiffusions on positive semidefinite matrices. To do so, we focus on the\nsplitting of the infinitesimal generator, in order to use composition\ntechniques as Ninomiya and Victoir or Alfonsi. Doing so, we have found a\nremarkable splitting for Wishart processes that enables us to sample exactly\nWishart distributions, without any restriction on the parameters. It is related\nbut extends existing exact simulation methods based on Bartlett's\ndecomposition. Moreover, we can construct high-order discretization schemes for\nWishart processes and second-order schemes for general affine diffusions. These\nschemes are in practice faster than the exact simulation to sample entire\npaths. Numerical results on their convergence are given.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1006.0960%2C1006.0197%2C1006.1438%2C1006.3891%2C1006.0595%2C1006.0559%2C1006.5195%2C1006.4198%2C1006.3010%2C1006.0719%2C1006.5814%2C1006.2506%2C1006.1381%2C1006.5651%2C1006.3628%2C1006.3804%2C1006.2101%2C1006.2697%2C1006.0910%2C1006.0136%2C1006.2933%2C1006.2216%2C1006.5044%2C1006.5250%2C1006.2058%2C1006.0942%2C1006.2199%2C1006.3999%2C1006.2125%2C1006.2964%2C1006.3962%2C1006.3468%2C1006.0398%2C1006.1929%2C1006.1011%2C1006.0302%2C1006.5249%2C1006.4997%2C1006.1698%2C1006.2281%2C1006.5100%2C1006.4400%2C1006.5547%2C1006.0622%2C1006.0929%2C1006.0839%2C1006.1864%2C1006.2311%2C1006.5692%2C1006.2440%2C1006.1112%2C1006.5383%2C1006.2791%2C1006.4112%2C1006.5949%2C1006.4123%2C1006.4894%2C1006.2259%2C1006.4866%2C1006.2627%2C1006.2324%2C1006.2683%2C1006.2235%2C1006.0521%2C1006.3055%2C1006.1206%2C1006.2704%2C1006.1904%2C1006.1911%2C1006.0119%2C1006.4185%2C1006.1602%2C1006.5116%2C1006.1513%2C1006.1477%2C1006.5470%2C1006.3125%2C1006.0534%2C1006.4926%2C1006.4202%2C1006.2441%2C1006.0809%2C1006.5599%2C1006.3399%2C1006.4572%2C1006.1555%2C1006.5074%2C1006.5669%2C1006.2717%2C1006.1552%2C1006.1303%2C1006.1001%2C1006.1258%2C1006.1115%2C1006.4719%2C1006.0525%2C1006.4111%2C1006.5033%2C1006.3108%2C1006.4001%2C1006.5329&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "This work deals with the simulation of Wishart processes and affine\ndiffusions on positive semidefinite matrices. To do so, we focus on the\nsplitting of the infinitesimal generator, in order to use composition\ntechniques as Ninomiya and Victoir or Alfonsi. Doing so, we have found a\nremarkable splitting for Wishart processes that enables us to sample exactly\nWishart distributions, without any restriction on the parameters. It is related\nbut extends existing exact simulation methods based on Bartlett's\ndecomposition. Moreover, we can construct high-order discretization schemes for\nWishart processes and second-order schemes for general affine diffusions. These\nschemes are in practice faster than the exact simulation to sample entire\npaths. Numerical results on their convergence are given."}, "authors": ["Abdelkoddousse Ahdida", "Aur\u00e9lien Alfonsi"], "author_detail": {"name": "Aur\u00e9lien Alfonsi"}, "author": "Aur\u00e9lien Alfonsi", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1214/12-AAP863", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/1006.2281v2", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/1006.2281v2", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "math.PR", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "math.PR", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "q-fin.CP", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/1006.2281v2", "affiliation": "CERMICS", "arxiv_url": "http://arxiv.org/abs/1006.2281v2", "arxiv_comment": null, "journal_reference": "Annals of Applied Probability 2013, Vol. 23, No. 3, 1025-1073", "doi": "10.1214/12-AAP863", "fulltext": "arXiv:1006.2281v2 [math.PR] 13 Mar 2013\n\nThe Annals of Applied Probability\n2013, Vol. 23, No. 3, 1025\u20131073\nDOI: 10.1214/12-AAP863\nc Institute of Mathematical Statistics, 2013\n\nEXACT AND HIGH-ORDER DISCRETIZATION SCHEMES FOR\nWISHART PROCESSES AND THEIR AFFINE EXTENSIONS1\nBy Abdelkoddousse Ahdida and Aur\u00e9lien Alfonsi\nUniversit\u00e9 Paris-Est\nThis work deals with the simulation of Wishart processes and\naffine diffusions on positive semidefinite matrices. To do so, we focus\non the splitting of the infinitesimal generator in order to use composition techniques as did Ninomiya and Victoir [Appl. Math. Finance\n15 (2008) 107\u2013121] or Alfonsi [Math. Comp. 79 (2010) 209\u2013237]. Doing so, we have found a remarkable splitting for Wishart processes\nthat enables us to sample exactly Wishart distributions without any\nrestriction on the parameters. It is related but extends existing exact simulation methods based on Bartlett's decomposition. Moreover,\nwe can construct high-order discretization schemes for Wishart processes and second-order schemes for general affine diffusions. These\nschemes are, in practice, faster than the exact simulation to sample\nentire paths. Numerical results on their convergence are given.\n\nIntroduction. This paper focuses on simulation methods for Wishart\nprocesses and more generally for affine diffusions on positive semidefinite\nmatrices. Before explaining our motivations and our main results, we start\nwith a short introduction to these processes. Even though we use rather standard notation for matrices, they are recalled at the end of the Introduction,\nand we invite the reader to first give a quick look at it. Wishart processes\nhave been initially introduced by Bru [4, 5]. They are also named because\ntheir marginal laws follow Wishart distributions. Very recently, Cuchiero et\nal. [7] have introduced a general framework for affine processes on positive\nsemidefinite matrices Sd+ (R) that embeds Wishart processes and includes\npossible jumps. In this paper, we only consider continuous processes of this\nReceived April 2011; revised March 2012.\nSupported by the Credinext project from Finance Innovation, of the Eurostars E!5144TFM project, and of the \"Chaire Risques Financiers\" of Fondation du Risque.\nAMS 2000 subject classifications. 65C30, 60H35, 91B70.\nKey words and phrases. Wishart processes, affine processes, exact simulation, discretization schemes, weak error, Bartlett's decomposition.\n1\n\nThis is an electronic reprint of the original article published by the\nInstitute of Mathematical Statistics in The Annals of Applied Probability,\n2013, Vol. 23, No. 3, 1025\u20131073. This reprint differs from the original in\npagination and typographic detail.\n1\n\n\f2\n\nA. AHDIDA AND A. ALFONSI\n\nkind. Such processes solve the following SDE:\nZ t p\nZ t\np\nx\nx\n(1) Xt = x +\n( Xsx dWs a + aT dWsT Xsx ).\n(\u1fb1 + B(Xs )) ds +\n0\n\n0\n\nHere, and throughout the paper, (Wt , t \u2265 0) denotes a d-by-d square matrix\nmade of independent standard Brownian motions and\n(2)\n\nx, \u1fb1 \u2208 Sd+ (R),\n\na \u2208 Md (R) and B \u2208 L(Sd (R))\n\nis a linear mapping on Sd (R). Wishart processes correspond to the case\nwhere\n(3)\n\n\u2203\u03b1 \u2265 0,\n\n\u1fb1 = \u03b1aT a\n\nand\n\n\u2203b \u2208 Md (R), \u2200x \u2208 Sd (R)\n\nB(x) = bx + xbT .\n\nWhen d = 1, (1) is simply the SDE of the Cox\u2013Ingersoll\u2013Ross (CIR) process\nthat has been broadly studied, and we will implicitly assume that d \u2265 2\nthroughout the paper. Weak and strong uniqueness of SDE (1) has been\nstudied by Bru [5], Cuchiero et al. [7] and Mayerhofer, Pfaffel and Stelzer\n[22]. Here we sum up their results.\nTheorem 1. If x \u2208 Sd+ (R), \u1fb1 \u2212 (d \u2212 1)aT a \u2208 Sd+ (R) and B satisfies the\nfollowing condition:\n(4)\n\n\u2200x1 , x2 \u2208 Sd+ (R)\n\nTr(x1 x2 ) = 0\n\n=\u21d2\n\nTr(B(x1 )x2 ) \u2265 0,\n\nthere is a unique weak solution to the SDE (1) in Sd+ (R). We denote by\nAFFd (x, \u1fb1, B, a) the law of (Xtx )t\u22650 and AFFd (x, \u1fb1, B, a; t) the marginal\nlaw of Xtx . If we assume, moreover, that \u1fb1 \u2212 (d + 1)aT a \u2208 Sd+ (R) and x \u2208\nSd+,\u2217 (R), there is a unique strong solution to the SDE (1).\nUnder the parametrization of Wishart processes (3), condition (4) is satisfied and weak uniqueness holds as soon as \u03b1 \u2265 d \u2212 1. In that case, we denote\nby WISd (x, \u03b1, b, a) the law of the Wishart process (Xtx )t\u22650 and WISd (x, \u03b1, b,\na; t) the law of Xtx .\nThroughout the paper, when we use the notation AFFd (x, \u1fb1, B, a) or\nAFFd (x, \u1fb1, B, a; t) [resp., WISd (x, \u03b1, b, a) or WISd (x, \u03b1, b, a; t)], we implicitly assume that \u1fb1 \u2212 (d \u2212 1)aT a \u2208 Sd+ (R) (resp., \u03b1 \u2265 d \u2212 1) and B satisfies\n(4) so that weak uniqueness holds.\nIn her Ph.D. thesis [4], Bru introduced Wishart processes and used them\nin biology to study perturbed experimental data. Recently, great attention\nhas been paid to Wishart processes for applications in finance. Namely,\nGourieroux and Sufana [14] and Da Fonseca, Grasselli and Tebaldi [8] have\nsuggested the use of these processes to model the instantaneous covariance matrix of d assets. It naturally extends stochastic volatility models\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n3\n\nfor only one asset like the Heston model [16]. Obviously, processes on positive semidefinite matrices are really interesting to model the evolution of a\ndependence structure because they can describe a covariance matrix. However, when dealing with applications, it is, in general, crucial to be able to\nsample paths of such processes and make Monte Carlo algorithms.\nTo the best of our knowledge, there is minimal literature on simulation\nmethods for Wishart and general affine processes (1). Wishart distributions\nhave been intensively studied in statistics when \u03b1 \u2208 N. In this case, exact\nsimulation methods have been proposed by Odell and Feiveson [25], Smith\nand Hocking [26] and Gleser [12], to mention a few. Concerning discretization schemes, the usual Euler\u2013Maruyama scheme is not well defined because\nof the square-root. This already happens for the CIR process (d = 1). One\nhas then to find specific schemes. Recently, Benabid et al. [3] and Gauthier\nand Possamai [10] have proposed numerical approximations for Wishart processes that are well defined under some restrictions on the parameters. However, there is no result on the accuracy of their methods. Currently, Teichmann [29] is working on dedicated schemes for general affine processes by\napproximating their characteristic functions. Our study here is only dedicated to the diffusion (1).\nInitially, our goal was to find high-order discretization schemes for Wishart\nprocesses by splitting operators and using scheme compositions. Indeed, this\napproach has already proved to be very efficient for other affine diffusions\n(see [2]). The main difficulty here was to find a splitting that involves infinitesimal generators of diffusions that are well defined on Sd+ (R) and that\ncan be simulated. Doing so, we incidentally have found a remarkable splitting for some canonical Wishart processes: the infinitesimal generator of\nWISd (x, \u03b1, 0, Idn ) is the sum of commuting operators that are associated to\nelementary SDEs that can be sampled exactly. With the help of a simple\nbut useful law identity, this enables us to sample exactly Wishart processes\nfor any admissible parameter. In particular, our result extends the Bartlett's\ndecomposition that is commonly used to sample central Wishart distributions. This splitting is not only interesting for the exact simulation method.\nIt is also useful to construct high-order discretization schemes for Wishart\nprocesses that are, in practice, faster to generate full paths. In fact, it allows\nus to get a high-order scheme that preserves the domain Sd+ (R). We provide\na rigorous analysis of the weak error in this framework. Still, by using the\nsplitting technique, we also get a second-order scheme for any affine diffusion\n(1) without any restriction on the parameters.\nThis paper is structured as follows. First, we present some general results\non affine diffusions. We calculate their infinitesimal generator and obtain\ninteresting identities in law that are intensively used next for the different\nsimulation methods. Section 2 is devoted to the exact simulation of Wishart\nprocesses. It exhibits the remarkable splitting of the infinitesimal genera-\n\n\f4\n\nA. AHDIDA AND A. ALFONSI\n\ntor and shows how it can be used to sample exactly any Wishart distribution. Section 3 deals with high-order schemes for affine diffusions. Thanks to\nthe remarkable splitting, we are able to construct a third-order scheme for\nWishart processes and second-order schemes for affine diffusions. Last, we\ngive numerical illustrations of our convergence results in Section 4. We compare the time required by each method and also give a possible application\nof our results in finance.\nNotation for real matrices.\n\u2022 For d, d\u2032 \u2208 N\u2217 , Md (R) denotes the real d square matrices and Md\u00d7d\u2032 (R)\nthe real matrices with d rows and d\u2032 columns.\n\u2022 Sd (R), Sd+ (R), Sd+,\u2217 (R) and Gd (R) denote, respectively, the set of symmetric, symmetric positive semidefinite, symmetric positive definite and\nnonsingular matrices.\n\u2022 For x \u2208 Md (R), xT , adj(x), det(x), Tr(x) and Rk(x) are, respectively, the\ntranspose, the adjugate,\nthe determinant, the trace and the rank of x.\n\u221a\n+\n\u2022 For x \u2208 Sd (R), x\n\u221a denotes the unique symmetric positive semidefinite\nmatrix such that ( x)2 = x.\n\u2022 The identity matrix is denoted by Id and\nset for n \u2264 d, Idn = (1i=j\u2264n )1\u2264i,j\u2264d\nPwe\nn\nn\nn\nand ed = (1i=j=n )1\u2264i,j\u2264d , so that Id = i=1 eid . We also set for 1 \u2264 i, j \u2264 d,\nei,j\nd = (1k=i,l=j )1\u2264k,l\u2264d .\n\u2022 For x \u2208 Sd (R), we denote by x{i,j} the value of xi,j , so that\nX\nj,i\nx=\nx{i,j} (ei,j\nd + 1i6=j ed ).\n1\u2264i\u2264j\u2264d\n\nWe use both notation in the paper: notation (xi,j )1\u2264i,j\u2264d is more convenient for matrix calculations while (x{i,j} )1\u2264i\u2264j\u2264d is preferred to emphasize that we work on symmetric matrices.\n\u2022 For \u03bb1 , . . . , \u03bbd \u2208 R, diag(\u03bb1 , . . . , \u03bbd ) denotes the diagonal matrix such that\ndiag(\u03bb1 , . . . , \u03bbd )i,i = \u03bbi .\n1. Some properties of affine processes on positive semidefinite matrices.\n1.1. The infinitesimal generator on Md (R) and Sd (R). We start with a\nsimple lemma. It is useful to calculate the infinitesimal generator of processes\non matrices.\nLemma 2. Let (Ft )t\u22650 denote the filtration generated by (Wt , t \u2265 0). We\nconsider continuous (Ft )-adapted processes (At )t\u22650 , (Bt )t\u22650 and (Ct )t\u22650 ,\nrespectively, valued in Md (R), Md (R) and Sd (R), and a process (Yt )t\u22650\nthat admits the following semimartingale decomposition:\n(5)\n\ndYt = Ct dt + Bt dWt At + ATt dWtT BtT .\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n5\n\nThen, for i, j, m, n \u2208 {1, . . . , d}, the quadratic covariation of (Yt )i,j and (Yt )m,n\nis\ndh(Yt )i,j , (Yt )m,n i\n(6)\n\n= [(Bt BtT )i,m (ATt At )j,n + (Bt BtT )i,n (ATt At )j,m\n+ (Bt BtT )j,m (ATt At )i,n + (Bt BtT )j,n (ATt At )i,m ] dt.\n\nIt is worth noticing that the quadratic covariation given by (5) depends\non At and Bt only through the matrices ATt At and Bt BtT . Lemma 2 enables\nus to easily calculate the infinitesimal generator for the affine process (1)\nwhich is defined by\nE[f (Xtx )] \u2212 f (x)\nLM f (x) = lim\nx \u2208 Sd+ (R),\nt\nt\u21920+\nfor f \u2208 C 2 (Md (R), R) with bounded derivatives.\n\nIn fact, we get that the generator of AFFd (x, \u1fb1, B, a) is given by\nLM = Tr([\u1fb1 + B(x)]D M )\n(7)\n\n+ 21 {2 Tr(xD M aT aD M ) + Tr(x(D M )T aT aD M )\n\n+ Tr(xD M aT a(D M )T )},\n\nwhere D M = (\u2202i,j )1\u2264i,j\u2264d . Since we know that the affine process (Xtx )t\u22650\ntakes values in Sd+ (R) \u2282 Sd (R), we can also look at the infinitesimal generator of this diffusion on Sd (R), which is defined by\nx \u2208 Sd+ (R),\n\nLS f (x) = lim\n\nt\u21920+\n\nE[f (Xtx )] \u2212 f (x)\nt\n\nfor f \u2208 C 2 (Sd (R), R) with bounded derivatives.\n\nFor x \u2208 Sd (R), we denote by x{i,j} = xi,j = xj,i the value of the coordiP\nj,i\nnates (i, j) and (j, i), so that x = 1\u2264i\u2264j\u2264d x{i,j} (ei,j\nd + 1i6=j ed ). For f \u2208\nC 2 (Sd (R), R), we then denote by \u2202{i,j} f its derivative with respect to x{i,j} .\nFor x \u2208 Md (R), we set \u03c0(x) = (x + xT )/2. It is such that \u03c0(x) = x for\nx \u2208 Sd (R), and we have\nLS f (x) = LM f \u25e6 \u03c0(x).\n\nBy the chain rule, we have for x \u2208 Sd (R), \u2202i,j f \u25e6\u03c0(x) = (1i=j + 12 1i6=j )\u2202{i,j} f (x)\nand get from (7) the following result.\nProposition 3. The infinitesimal generator on Sd (R) associated to\nAFFd (x, \u1fb1, B, a) is given by\n(8)\n\nLS = Tr([\u1fb1 + B(x)]D S ) + 2 Tr(xD S aT aD S ),\n\n1\nS = (1\nwhere D S is defined by Di,j\ni=j + 2 1i6=j )\u2202{i,j} , for 1 \u2264 i, j \u2264 d.\n\n\f6\n\nA. AHDIDA AND A. ALFONSI\n\nOf course, the generators LM and LS are equivalent; one can be deduced\nfrom the other. However, LS already embeds the fact that the process lies\nin Sd (R), which reduces the dimension from d2 to d(d + 1)/2 and gives, in\npractice, shorter formulas. This is why we will mostly work in the sequel\nwith infinitesimal generators on Sd (R). Unless it is necessary to make the\ndistinction with LM , we will simply denote L = LS .\n1.2. The characteristic function of Wishart processes. As for other affine\nprocesses, the characteristic function of affine processes on positive semidefinite matrices can be obtained by solving two ODEs. In the case of Wishart\nprocesses, it is possible to solve explicitly these ODEs by solving a matrix\nRiccati equation (see Levin [20]). Here, we give the closed formula for the\nLaplace transform and a precise description of its set of convergence.\nRt\nProposition 4. Let Xtx \u223c WISd (x, \u03b1, b, a; t), qt = 0 exp(sb)aT a exp(s \u00d7\nbT ) ds and mt = exp(tb). We introduce the set of convergence of the Laplace\ntransform of Xtx , Db,a;t = {v \u2208 Sd (R), E[exp(Tr(vXtx ))] < \u221e}. This is a convex open set that is given explicitly by\n(9)\n\nDb,a;t = {v \u2208 Sd (R), \u2200s \u2208 [0, t], Id \u2212 2qs v \u2208 Gd (R)}.\n\nBesides, the Laplace transform of Xtx is well defined for v = vR + ivI with\nvR \u2208 Db,a;t , vI \u2208 Sd (R) and is given by\n(10)\n\nE[exp(Tr(vXtx ))] =\n\nexp(Tr[v(Id \u2212 2qt v)\u22121 mt xmTt ])\n.\ndet(Id \u2212 2qt v)\u03b1/2\n\nThe characteristic function corresponds to the case vR = 0 that clearly\nbelongs to Db,a;t . The proof of this result is given in Appendix B.1. The\nformula (10) is well known in the literature, and our contribution is to characterize precisely the set of convergence. In particular, let us observe that\n\u03c1Id \u2208 Db,a;t when \u03c1 > 0 is small enough, which will help us to study the\nCauchy problem (Proposition 14).\nLast, let us remark here that for X\u0303tx \u223c WISd (x, \u03b1, 0, Idn ; t), the formula\nabove becomes even simpler and we have for v = vR + ivI such that vR \u2208\nDb,a;t , vI \u2208 Sd (R),\n(11)\n\nE[exp(Tr(v X\u0303tx ))] =\n\nexp(Tr[v(Id \u2212 2tIdn v)\u22121 x])\n.\ndet(Id \u2212 2tIdn v)\u03b1/2\n\n1.3. Some identities in law for affine processes. This section gives simple\nbut interesting identities in law for affine processes. First, we observe that\ntheir infinitesimal generator (8) only depends on a through aT a and get\n\u221a\n(12)\nAFFd (x, \u1fb1, B, a) = AFFd (x, \u1fb1, B, aT a).\nLaw\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n7\n\nAlso, it is natural to look at linear transformations of affine processes. Let\nq \u2208 Gd (R) and define Bq \u2208 L(Sd (R)) by Bq (x) = (q T )\u22121 B(q T xq)q \u22121 . One\neasily has that B satisfies (4) iff Bq satisfies (4), and we get\n(13)\n\nAFFd (x, \u1fb1, B, a) = q T AFFd ((q \u22121 )T xq \u22121 , (q \u22121 )T \u1fb1q \u22121 , Bq , aq \u22121 )q,\nLaw\n\nsince both processes solve the same martingale problem. An interesting consequence is given in the following proposition: any affine process can be\nobtained as a linear transformation of an affine process for which \u1fb1 is a\ndiagonal matrix and a = Idn . Since our main goal here is to sample paths of\nsuch processes, this says to us that it is sufficient to focus on this special\ncase.\nProposition 5. Let n = Rk(a) be the rank of aT a. Then, there exist a\ndiagonal matrix \u03b4\u0304 and a nonsingular matrix u \u2208 Gd (R) such that \u1fb1 = uT \u03b4\u0304u\nand aT a = uT Idn u and we have\nAFFd (x, \u1fb1, B, a) = uT AFFd ((u\u22121 )T xu\u22121 , \u03b4\u0304, Bu , Idn )u,\nwhere \u2200y \u2208 Sd (R), Bu\n\nLaw\n(y) = (u\u22121 )T B(uT yu)u\u22121 .\n\nThe proof of this result consists of algebraic arguments and is found in\nAppendix B.2. It gives, in particular, a general way to compute u and \u03b4\u0304. Let\nus notice, however, that in the case of Wishart processes, u can directly be\nobtained by using a single extended Cholesky decomposition (Lemma 23).\nUp to now, we have stated identities for the law of affine processes. Thanks\nto the explicit characteristic function of Wishart processes, we are also able\nto get another interesting identity on the marginal laws.\nProposition 6. Let t > 0, a, b \u2208 Md (R) and \u03b1 \u2265 d\u22121. Let mt = exp(tb),\nRt\nqt = 0 exp(sb)aT a exp(sbT ) ds and n = Rk(qt ). Then there is \u03b8t \u2208 Gd (R) such\nthat qt = t\u03b8t Idn \u03b8tT , and we have\n(14)\n\nWISd (x, \u03b1, b, a; t) = \u03b8t WISd (\u03b8t\u22121 mt xmTt (\u03b8t\u22121 )T , \u03b1, 0, Idn ; t)\u03b8tT .\nLaw\n\nThis proposition plays a crucial role for the exact simulation of Wishart\nprocesses. Thanks to (14), we can sample any Wishart distribution if we\nare able to simulate exactly the distribution WISd (x, \u03b1, 0, Idn ; t) for any x \u2208\nSd+ (R). In Section 2, we focus on this and give a way to sample exactly\nWISd (x, \u03b1, 0, Idn ; t). Let us stress here that we can compute the matrix \u03b8t by\nusing the extended Cholesky decomposition of qt /t, as it is explained in the\nproof below.\nProof of Proposition 6. We apply Lemma 23 to qt /t \u2208 Sd+ (R) and\nconsider (p, cn , kn ) an extended Cholesky decomposition of qt /t. We set \u03b8t =\n0\n). Then \u03b8t is invertible and it is easy to check that qt = t\u03b8t Idn \u03b8tT .\np\u22121 ( kcnn Id\u2212n\n\n\f8\n\nA. AHDIDA AND A. ALFONSI\n\nNow, let us observe that for v \u2208 Sd (R),\n\ndet(Id \u2212 2iqt v) = det(\u03b8t (\u03b8t\u22121 \u2212 2itIdn \u03b8tT v)) = det(Id \u2212 2itIdn \u03b8tT v\u03b8t ),\nTr[iv(Id \u2212 2iqt v)\u22121 mt xmTt ]\n\n= Tr[i(\u03b8t\u22121 )T \u03b8tT v(\u03b8t \u03b8t\u22121 \u2212 2it\u03b8t Idn \u03b8tT v\u03b8t \u03b8t\u22121 )\u22121 mt xmTt ]\n= Tr[i\u03b8tT v\u03b8t (Id \u2212 2itIdn \u03b8tT v\u03b8t )\u22121 \u03b8t\u22121 mt xmTt (\u03b8t\u22121 )T ].\n\nLet Xtx \u223c WISd (x, \u03b1, b, a; t) and X\u0303tx \u223c WISd (x, \u03b1, 0, Idn ; t). Then, from (10)\nand (11), we get that\n\u22121 T\n\u03b8 \u22121 mt xmT\nt (\u03b8t )\n\nE[exp(i Tr(vXtx ))] = E[exp(i Tr(\u03b8tT v\u03b8t X\u0303t t\n\n))]\n\n\u22121 T\n\u03b8 \u22121 mt xmT\nt (\u03b8t )\n\u03b8tT ))].\n\n= E[exp(i Tr(v\u03b8t X\u0303t t\n\n\u0003\n\nLast, let us mention that (14) extends a usual identity between CIR and\nsquared Bessel distribution. It gives when d = 1,\n\u0013\n\u0012\n2bt \u2212 1\n2btx\n2e\nWIS1 (x, \u03b1, b, a; t) = a\nWIS1 2\n, \u03b1, 0, 1; t .\nLaw\n2bt\na (1 \u2212 e\u22122bt )\nIn that case, this identity can also be obtained directly from the SDE.\nXtx /a2 is a time-changed\nLet (Xtx )t\u22650 \u223c WIS1 (x, \u03b1, b, a). Then, Yt = e\u22122bt \u221a\n\u22122bt\nBessel squared process since dYt = \u03b1(e\ndt) + 2 Yt (e\u2212bt dWt ). We obtain\n\u22122bt\nWIS1 (x, \u03b1, b, a; t) = a2 e2bt WIS1 (x/a2 , \u03b1, 0, 1; 1\u2212e2b ). A linear time-change\nLaw\n\nalso gives that WIS1 (x, \u03b1, 0, 1; \u03bbt) = \u03bb WIS1 (x/\u03bb, \u03b1, 0, 1; t), which leads to\nLaw\n\n(14) by taking \u03bb = (1 \u2212 e\u22122bt )/(2bt).\n\n2. Exact simulation of Wishart processes. In this section, we present\na new method to simulate exactly a Wishart process. To the best of our\nknowledge, this is the first exact simulation method for noncentral Wishart\ndistributions that works for any \u03b1 \u2265 d \u2212 1. Wishart distributions have been\nthoroughly studied in statistics when \u03b1 \u2208 N (which is then called the number of degrees of freedom). Exact simulation methods have already been\nproposed in that case. For instance, Odell and Feiveson [25] and Smith and\nHocking [26] have proposed an exact simulation method for central Wishart\ndistributions based on the Bartlett's decomposition. Gleser [12] extends it\nto any (noncentral) Wishart distribution. Bru [5] also explains, when \u03b1 \u2208 N,\nhow Wishart processes can be obtained as a square of Ornstein\u2013Uhlenbeck\nprocesses on matrices.\nHere, our method relies on the identity in law (14) that enables us to\nfocus on the case b = 0, a = Idn . Then we show a remarkable splitting of the\ninfinitesimal generator as the sum of commuting operators. These operators\nare associated to SDE that can be solved explicitly on Sd+ (R), which enables\nus to sample any Wishart distribution.\n\n\f9\n\nSIMULATION SCHEMES FOR WISHART PROCESSES\n\n2.1. A remarkable splitting for WISd (x, \u03b1, 0, Idn ). The following theorem\nexplains how to split the infinitesimal generator of WISd (x, \u03b1, 0, Idn ) as the\nsum of commutative infinitesimal generators. This result is the keystone of\nthe paper and will play a crucial role in the sequel both for the exact and\ndiscretization schemes.\nTheorem 7. Let L be the generator associated to the Wishart process\nWISd (x, \u03b1, 0, Idn ) and Lei be the generator associated to WISd (x, \u03b1, 0, eid ) for\nd\ni \u2208 {1, . . . , d}. Then, we have\n(15)\n\nL=\n\nn\nX\n\n\u2200i, j \u2208 {1, . . . , d}\n\nand\n\nLe i\n\nd\n\ni=1\n\nLe i Le j = Le j Le i .\nd\n\nd\n\nd\n\nd\n\nP\nP\nProof. From (8), we easily get that L = ni=1 Lei since Idn = ni=1 eid .\nd\nThe commutativity property comes from a tedious but simple calculation.\n\u0003\nBeyond the commutativity property, two other features of (15) are important to notice:\n\u2022 The operators Lei and Lej are the same up to the exchange of coordinates\nd\nd\ni and j.\n\u2022 The processes WISd (x, \u03b1, 0, eid ) and WISd (x, \u03b1, 0, Idn ) are well defined on\nSd+ (R) under the same hypothesis, namely, \u03b1 \u2265 d \u2212 1 and x \u2208 Sd+ (R).\nThis second property makes possible the composition that we explain now.\nLet us consider t > 0 and x \u2208 Sd+ (R). We define, iteratively,\nXt1,x \u223c WISd (x, \u03b1, 0, e1d ; t),\n\n2,Xt1,x\n\nXt\n\n\u223c WISd (Xt1,x , \u03b1, 0, e2d ; t),\n..\n.\n\n1,x\nXt\n\nXtn,...\n\n1,x\nXt\n\n\u223c WISd (Xtn\u22121,...\n1,x\nXt\n\nThus, conditionally to Xti\u22121,...\n\n1,x\nXt\n\n, Xti,...\n\n, \u03b1, 0, end ; t).\n\nis sampled according to the dis1,x\nXt\n\ntribution at time t of a Wishart process starting from Xti\u22121,...\nparameters (\u03b1, 0, eid ). We have the following result.\nProposition 8.\n\n1,x\nXt\n\nLet Xtn,...\n\n1,x\nXt\n\nXtn,...\n\nbe defined as above. Then\n\n\u223c WISd (x, \u03b1, 0, Idn ; t).\n\nand with\n\n\f10\n\nA. AHDIDA AND A. ALFONSI\n\nThanks to this proposition, we can generate a sample according to WISd (x,\n\u03b1, 0, Idn ; t) as soon as we can simulate WISd (x, \u03b1, 0, eid ; t). These laws are the\nsame as WISd (x, \u03b1, 0, e1d ; t), up to the permutation of the first and ith coordinates. In the next subsection, it is explained how to draw such random\nvariables.\nIt is really easy to give a formal proof of Proposition 8. Let Xtx \u223c WISd (x,\n\u03b1, 0, Idn ; t) and f be a smooth function on Sd+ (R) such that the series below\nconverge absolutely. By iterating It\u00f4's formula, we have that E[f (Xtx )] =\nP\u221e k k\nk=0 t L f (x)/k!. Similarly, we also get by using the tower property of the\nconditional expectation that\n1,x\nXt\n\n(16)\n\nE[f (Xtn,...\n\n1,x\nXt\n\n)] = E[E[f (Xtn,...\n=\n\n1,x\nXt\n\n)|Xtn\u22121,...\n\n]]\n\n+\u221e kn\n1,x\nX\nXt\nt\n)].\nE[Lkenn f (Xtn\u22121,...\nd\nkn !\n\nkn =0\n\nSimply by repeating this argument, we get that\n+\u221e\nX\n\n1,x\n\nXt\nE[f (Xtn,...\n\n)] =\n\nPn\n\nk1 ,...,kn =0\n\n(17)\n=\n\n\u221e k\nX\nt\nk=0\n\nk!\n\nt i=1 ki k1\nL 1 * * * Lkenn f (x)\nd\nk1 ! * * * kn ! ed\n\n(Le1 + * * * + Lend )k f (x) = E[f (Xtx )].\nd\n\nTo get the second equality, we identify a Cauchy product and use that the\noperators Le1 , . . . , Lend commute. To make this formal proof correct, one\nd\nhas to check that the series are well defined and can be switched with the\nexpectation. This check is made in the Appendix C.1 for our framework and\nremains valid as soon as the operator Lei and L are of affine type.\nd\n\n2.2. Exact simulation for WISd (x, \u03b1, 0, e1d ; t). For the sake of clarity, we\nstart with the case of d = 2 that avoids complexities due to matrix decompositions. We deal with the general case just after.\n2.2.1. The case d = 2. We start by writing explicitly the infinitesimal\ngenerator Le12 of WIS2 (x, \u03b1, 0, e12 ). From (8), we get\nx \u2208 S2+ (R),\n\n(18)\n\n2\nLe12 f (x) = \u03b1\u2202{1,1} f (x) + 2x{1,1} \u2202{1,1}\nf (x)\n\n+ 2x{1,2} \u2202{1,1} \u2202{1,2} f (x) +\n\nx{2,2} 2\n\u2202{1,2} f (x).\n2\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n11\n\nWe now show that this operator is in fact associated to an SDE that can be\nexplicitly solved. We will denote by (Zt1 , t \u2265 0) and (Zt2 , t \u2265 0) two independent standard Brownian motions in R.\nWhen x{2,2} = 0, we also have x{1,2} = 0 since x is nonnegative. In that\ncase,\nq\nX0x = x,\nd(Xtx ){1,1} = \u03b1 dt + 2 (Xtx ){1,1} dZt1 ,\n(19)\nd(Xtx ){1,2} = 0,\nd(Xtx ){2,2} = 0\nhas the infinitesimal generator (18), which is one of a CIR process (or of a\nsquared Bessel process of dimension \u03b1 to be more precise). By using an algorithm that samples exactly a noncentral chi-square distribution (see, e.g.,\nGlasserman [11]), we can then sample WIS2 (x, \u03b1, 0, e12 ; t) when x{2,2} = 0.\nWhen x{2,2} > 0, it easy to check that the SDE\ns\n((Xtx ){1,2} )2\ndZt1\nd(Xtx ){1,1} = \u03b1 dt + 2 (Xtx ){1,1} \u2212\n(Xtx ){2,2}\n\n(20)\nd(Xtx ){1,2} =\n\n(Xtx ){1,2}\ndZt2 ,\n+ 2q\nx\n(Xt ){2,2}\n\nq\n(Xtx ){2,2} dZt2 ,\n\nd(Xtx ){2,2} = 0,\n\nstarting from X0x = x, has an infinitesimal generator equal to Le12 . To solve\n(20), we set\n(Utu ){1,1} = (Xtx ){1,1} \u2212\n(21)\n\n(Xtx ){1,2}\n(Utu ){1,2} = \u221a\n,\nx{2,2}\n\n((Xtx ){1,2} )2\n,\n(Xtx ){2,2}\n(Utu ){2,2} = x{2,2} .\n\nHere, u stands for the initial condition, that is, u = U0u . We get by using It\u00f4\ncalculus that\nq\nd(Utu ){1,1} = (\u03b1 \u2212 1) dt + 2 (Utu ){1,1} dZt1 ,\n(22)\nd(Utu ){1,2} = dZt2 and d(Utu ){2,2} = 0.\nTherefore, (Utu ){1,2} and (Utu ){1,1} can be sampled, respectively, by independent Gaussian and noncentral chi-square variables. Then, we can get back\n\n\f12\n\nA. AHDIDA AND A. ALFONSI\n\nXtx by inverting (21),\n(23)\n\n(Xtx ){1,1} = (Utu ){1,1} + (Utu )2{1,2} ,\nq\nx\nu\n(Xt ){1,2} = (Ut ){1,2} (Utu ){2,2} ,\n\n(Xtx ){2,2} = (Utu ){2,2} .\n\nThis result gives an interesting way to figure out the dynamics associated\nto the operator Le12 by using a change of variable. It is worth noticing that\nthe CIR process (Utu ){1,1} is well defined as soon as its degree \u03b1 \u2212 1 is\nnonnegative, which coincides with the condition under which the Wishart\nprocess WIS2 (x, \u03b1, 0, e12 ) is well defined. Last, we notice that the solution of\nthe operator Le12 involves a CIR process in the diagonal term and a Brownian\nmotion in the nondiagonal one. A similar structure holds for larger d.\n2.2.2. The general case. We now present a general way to sample exactly WISd (x, \u03b1, 0, e1d ; t). We first write explicitly from (8) the infinitesimal\ngenerator of WISd (x, \u03b1, 0, e1d ) for x \u2208 Sd+ (R)\n(24)\n\n2\nLe1 f (x) = \u03b1\u2202{1,1} f (x) + 2x{1,1} \u2202{1,1}\nf (x)\nd\nX\n+2\nx{1,m} \u2202{1,m} \u2202{1,1} f (x)\n1\u2264m\u2264d\nm6=1\n\n+\n\n1\n2\n\nX\n\nx{m,l} \u2202{1,m} \u2202{1,l} f (x).\n\n1\u2264m,l\u2264d\nm6=1,l6=1\n\nAs for d = 2, we will construct an SDE that has the same infinitesimal\ngenerator Le1 and that can be solved explicitly. To do so however, we need to\nd\nuse further matrix decomposition results. In the case d = 2, we have already\nnoticed that we choose different SDEs whether x2,2 = 0 or not. Here, the\nSDE will depend on the rank of the submatrix (xi,j )2\u2264i,j\u2264d , and we set\nr = Rk((xi,j )2\u2264i,j\u2264d ) \u2208 {0, . . . , d \u2212 1}.\n\nFirst, we consider the case where\n(25)\n\n\u2203cr \u2208 Gr lower triangular,\nkr \u2208 Md\u22121\u2212r\u00d7r (R),\n\u0012\n\u0013\u0012 T\n\u0013\ncr 0\ncr krT\n(x)2\u2264i,j\u2264d =\n=: ccT .\nkr 0\n0\n0\n\nWith a slight abuse of notation, we consider that this decomposition also\nholds when r = 0 with c = 0. When r = d \u2212 1, c = cr is simply the usual\nCholesky decomposition of (xi,j )2\u2264i,j\u2264d . As it is explained in Corollary 11,\nwe can still get such a decomposition up to a permutation of the coordinates\n{2, . . . , d}.\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n13\n\nTheorem 9. Let us consider x \u2208 Sd+ (R) such that (25) holds. Let (Ztl )1\u2264l\u2264r+1\nbe a vector of independent standard Brownian motions. Then, the following\nP\nSDE [convention rk=1 (* * *) = 0 when r = 0]\nv\n!2\nu\nr\nr\nu\nX\nX\nx\n(c\u22121\ndZt1\nd(Xtx ){1,1} = \u03b1 dt + 2t(Xtx ){1,1} \u2212\nr )k,l (Xt ){1,l+1}\nk=1\n\n+2\n\nl=1\n\nr\nr X\nX\nk+1\nx\n,\n(c\u22121\nr )k,l (Xt ){1,l+1} dZt\nk=1 l=1\n\n(26)\nd(Xtx ){1,i} =\n\nr\nX\n\nci\u22121,k dZtk+1 ,\n\ni = 2, . . . , d,\n\nk=1\n\nd((Xtx ){l,k} )2\u2264k,l\u2264d\n\n=0\n\nhas a unique strong solution starting from x. It takes values in Sd+ (R) and\nhas the infinitesimal generator Le1 . Moreover, this solution is given explicitly\nd\nby\n\uf8eb\n\uf8f6\n1 0\n0\nXtx = \uf8ed 0 cr\n0 \uf8f8\n0 kr Id\u2212r\u22121\n\uf8f6\n\uf8eb\nr\nX\nT\n2\nu\nu\nu\n((Ut ){1,k+1} ) ((Ut ){1,l+1} )1\u2264l\u2264r 0 \uf8f7\n\uf8ec (Ut ){1,1} +\n\uf8f7\n\uf8ec\nk=1\n(27)\n\u00d7\uf8ec\n\uf8f7\nu\n\uf8ed\n((Ut ){1,l+1} )1\u2264l\u2264r\nIr\n0\uf8f8\n0\n0\n0\n\uf8eb\n\uf8f6\n1 0\n0\n\u00d7 \uf8ed 0 cTr\nkrT \uf8f8 ,\n0 0 Id\u2212r\u22121\n\nwhere\n\nq\nd(Utu ){1,1} = (\u03b1 \u2212 r) dt + 2 (Utu ){1,1} dZt1 ,\nu{1,1} = x{1,1} \u2212\n(28)\n\nr\nX\nk=1\n\n(u{1,k+1} )2 \u2265 0,\n\nd((Utu ){1,l+1} )1\u2264l\u2264r = (dZtl+1 )1\u2264l\u2264r ,\n(u{1,l+1} )1\u2264l\u2264r = c\u22121\nr (x{1,l+1} )1\u2264l\u2264r .\n\n\f14\n\nA. AHDIDA AND A. ALFONSI\n\nOnce again, we have made a slight abuse of notation when r = 0, and (27)\nshould be simply read as\n\uf8eb u\n\uf8f6\n(Ut ){1,1} 0 0\nXtx = \uf8ed\n0\n0 0\uf8f8\n0\n0 0\n\nin that case. In the statement above, it may seem weird that we use for u\nand Utu the same indexation as the one for symmetric matrices while we\nonly use its first row (or column). The reason is that we can, in fact, see Xtx\nas a function of Utu by setting\n(29)\n\n(Utu ){i,j} = u{i,j} = x{i,j}\n(Utu ){1,i} = u{1,i} = 0\n\nfor i, j \u2265 2 and\nfor r + 1 \u2264 i \u2264 d.\n\nThus, (cr , kr , Id\u22121 ) is an extended Cholesky decomposition of ((Utu )i,j )2\u2264i,j\u2264d\nand can be seen as a function of Utu . We get from (27) that\n(30)\n\nXtx = h(Utu )\n\nwith h(u) =\n\nd\u22121\nX\n\n1r=Rk[(ui,j )2\u2264i,j\u2264d ] hr (u)\n\nand\n\nr=0\n\n\uf8eb\n\n\uf8f6\n1\n0\n0\nhr (u) = \uf8ed 0 cr (u)\n0 \uf8f8\n0 kr (u) Id\u2212r\u22121\n\uf8eb\nr\nX\n(u{1,k+1} )2 (u{1,l+1} )T1\u2264l\u2264r\nu\n+\n\uf8ec {1,1}\n\uf8ec\nk=1\n\u00d7\uf8ec\n\uf8ed\n(u{1,l+1} )1\u2264l\u2264r\nIr\n0\n0\n\uf8eb\n\uf8f6\n1\n0\n0\n\u00d7 \uf8ed 0 cr (u)T kr (u)T \uf8f8 ,\n0\n0\nId\u2212r\u22121\n\n\uf8f6\n\n0\uf8f7\n\uf8f7\n\uf8f7\n0\uf8f8\n0\n\nwhere (cr (u), kr (u), Id\u22121 ) is the extended Cholesky decomposition of (ui,j )2\u2264i,j\u2264d\ngiven by some algorithm (e.g., Golub and Van Loan [13], Algorithm 4.2.4).\nEquation (30) will later play an important role in analyzing discretization\nschemes.\nThe proof of Theorem 9 is given in Appendix C.2. It enables us to simulate\nexactly the distribution WISd (x, \u03b1, 0, e1d ; t) simply by sampling one noncentral chi-square distribution for (Utu ){1,1} (see Glasserman [11]) and r other\nindependent Gaussian random variables. As in the d = 2 case, we notice that\nthe condition which ensures that the CIR process ((Utu ){1,1} , t \u2265 0) is well\ndefined for any r \u2208 {0, . . . , d \u2212 1}, namely, \u03b1 \u2212 (d \u2212 1) \u2265 0, is the same as the\none required for the definition of WISd (x, \u03b1, 0, e1d ).\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n15\n\nRemark 10. From (27), we easily get by a calculation made in (47)\nthat Rk(Xtx ) = Rk((xi,j )2\u2264i,j\u2264d ) + 1(Utu ){1,1} 6=0 , and therefore,\nRk(Xtx ) = Rk((xi,j )2\u2264i,j\u2264d ) + 1\n\na.s.\n\nIn particular, Xtx is almost surely positive definite if x \u2208 Sd+,\u2217 (R).\nTheorem 9 assumes that the initial value x \u2208 Sd+ (R) satisfies (25). Now\nwe explain why it is still possible, up to a permutation of the coordinates,\nto be in such a case. This relies on the extended Cholesky decomposition\nwhich is stated in Lemma 23.\nCorollary 11. Let x \u2208 Sd+ (R) and (cr , kr , p) be an extended Cholesky\ndecomposition of (xi,j )2\u2264i,j\u2264d (Lemma 23). Then, \u03c0 = ( 10 0p ) is a permutation\nmatrix, WISd (x, \u03b1, 0, e1d ) = \u03c0 T WISd (\u03c0x\u03c0 T , \u03b1, 0, e1d )\u03c0 and ((\u03c0x\u03c0 T )i,j )2\u2264i,j\u2264d =\nLaw\n\n( kcrr\n\n0 cT\nr\n0 )( 0\n\nkrT\n0\n\n) satisfies (25).\n\nProof. The result comes directly from (13), since \u03c0 T = \u03c0 \u22121 and\n= e1d . \u0003\n\n\u03c0e1d \u03c0 T\n\nTherefore, by a combination of Corollary 11 and Theorem 9, we get a\nsimple way to explicitly construct a process that has the infinitesimal generator Le1 for any initial condition x \u2208 Sd+ (R). In particular, this enables us\nd\nto sample exactly the Wishart distribution WISd (x, \u03b1, 0, e1d ; t). Algorithm 1\nbelow sums up the whole procedure.\nLet us now discuss the complexity of Algorithm 1. The number of operations required by the extended Cholesky decomposition is of order O(d3 ).\nFrom a computational point of view, the permutation is handled directly\nand does not require any matrix multiplication so that we can consider\nw.l.o.g. that \u03c0 = Id . Since cr is lower triangular, the calculation of u{1,i} ,\ni = 1, . . . , r + 1, only requires O(d2 ) operations. Also, we do not perform in\npractice the matrix product (27), but only compute the values of X{1,i} for\ni = 1, . . . , d, which also requires O(d2 ) operations. Last, d samples are at\nmost required. To sum up, it comes out that the complexity of Algorithm 1\nis of order O(d3 ).\n2.3. Exact simulation for Wishart processes. We have now shown all the\nmathematical results that enable us to give an exact simulation method for\ngeneral Wishart processes. This is made in two steps.\nFirst, we know how to sample exactly WISd (x, \u03b1, 0, e1d ; t) thanks to Theorem 9 and Corollary 11. By a simple permutation of the first and kth coordinates, we are then also able to sample according to WISd (x, \u03b1, 0, ekd ; t) for\nk \u2208 {1, . . . , d}. Thus, we get by Proposition 8 an exact simulation method to\nsample WISd (x, \u03b1, 0, Idn ; t). It is given explicitly in Algorithm 2. Then we get\n\n\f16\n\nA. AHDIDA AND A. ALFONSI\n\nAlgorithm 1: Exact simulation WISd (x, \u03b1, 0, e1d ; t)\nInput: x \u2208 Sd+ (R), d, \u03b1 \u2265 d \u2212 1 and t > 0.\nOutput: X, sampled according to WISd (x, \u03b1, 0, e1d ; t).\nCompute the extended Cholesky decomposition (p, kr , cr ) of\n(xi,j )2\u2264i,j\u2264d given by Lemma 23, r \u2208 {0, . . . , d \u2212 1} (see Golub and Van\nLoan [13] for an algorithm);\nSet \u03c0 = ( 10 0p ), x\u0303 = \u03c0x\u03c0 T , (u{1,l+1} )1\u2264l\u2264r = (cr )\u22121 (x\u0303{1,l+1} )1\u2264l\u2264r and\nP\nu{1,1} = x\u0303{1,1} \u2212 rk=1 (u{1,k+1} )2 \u2265 0;\nSample independently r normal variables G2 , . . . , Gr+1 \u223c N (0, 1) and\n(Utu ){1,1} as a CIR process at time t starting from u{1,1} solving\nq\nd(Utu ){1,1} = (\u03b1 \u2212 r) dt + 2 (Utu ){1,1} dZt1 (see Glasserman [11]).\n\u221a\nSet (Utu ){1,l+1} = u{1,l+1} + tGl+1 ;\nreturn\n\uf8eb\n\uf8f6\n1 0\n0\nX = \u03c0 T \uf8ed 0 cr\n0 \uf8f8\n0 kr Id\u2212r\u22121\n\uf8f6\n\uf8eb\nr\nX\n2\nT\nu\nu\nu\n((Ut ){1,k+1} ) ((Ut ){1,l+1} )1\u2264l\u2264r 0 \uf8f7\n\uf8ec (Ut ){1,1} +\n\uf8f7\n\uf8ec\nk=1\n\u00d7\uf8ec\n\uf8f7\nu\n\uf8ed\n((Ut ){1,l+1} )1\u2264l\u2264r\nIr\n0\uf8f8\n0\n0\n0\n\uf8eb\n\uf8f6\n1 0\n0\nkrT \uf8f8 \u03c0.\n\u00d7 \uf8ed 0 cTr\n0 0 Id\u2212r\u22121\nan exact simulation scheme for WISd (x, \u03b1, b, a; t) by using the law identity\n(14) (see Algorithm 3).\nLet us analyze the overall complexity of Algorithm 3. Since it basically\nruns n times Algorithm 1, it requires a complexity of order O(nd3 ) and\ntherefore at most of order O(d4 ). As we have seen, the \"bottleneck\" of Algorithm 1 is the extended Cholesky decomposition which is in O(d3 ). All\nthe other steps in Algorithm 1 require at most O(d2 ) operations. A natural\nquestion for Algorithm 2 is to wonder if we can reuse the Cholesky decomposition between the loops instead of calculating it from scratch. For example,\nif it were possible to get the Cholesky decomposition of loop k + 1 from the\none of loop k at a cost O(d2 ), the complexity of Algorithms 2 and 3 would\nthen drop to O(d3 ). Despite our investigations, we have not been able to do\nso up to now.\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n17\n\nAlgorithm 2: Exact simulation for WISd (x, \u03b1, 0, Idn ; t)\nInput: x \u2208 Sd+ (R), n \u2264 d, \u03b1 \u2265 d \u2212 1 and t > 0.\nOutput: X, sampled according to WISd (x, \u03b1, 0, Idn ; t)\ny=x\nfor k = 1 to n do\nSet pk,1 = p1,k = pi,i = 1 for i \u2208\n/ {1, k} and pi,j = 0 otherwise\n(permutation of the first and kth coordinates).\ny = pY p where Y is sampled according to WISd (pyp, \u03b1, 0, e1d ; t) by\nusing Algorithm 1.\nend\nreturn X = y.\n\nAlgorithm 3: Exact simulation for WISd (x, \u03b1, b, a; t)\nInput: x \u2208 Sd+ (R), \u03b1 \u2265 d \u2212 1, a, b \u2208 Md (R) and t > 0.\nOutput: X, sampled according to WISd (x, \u03b1, b, a; t).\nRt\nCalculate qt = 0 exp(sb)aT a exp(sbT ) ds and (p, cn , kn ) an extended\nCholesky decomposition of qt /t.\n0\n) and mt = exp(tb).\nSet \u03b8t = p\u22121 ( kcnn Id\u2212n\n\nreturn X = \u03b8t Y \u03b8tT , where Y \u223c WISd (\u03b8t\u22121 mt xmTt (\u03b8t\u22121 )T , \u03b1, 0, Idn ; t) is\nsampled by Algorithm 2.\n\nRemark 12. When \u03b1 \u2265 2d\u22121, it is possible to sample WISd (x, \u03b1, 0, Idn ; t)\nin O(d3 ) by another mean. If Xt1 \u223c WISd (x, d, 0, Idn ; t) and Xt2 \u223c WISd (0, \u03b1 \u2212\nd, 0, Idn ; t) are independent, we can check that Xt1 + Xt2 \u223c WISd (x, \u03b1, 0, Idn ; t).\nThen, Xt1 can be sampled by using Proposition 21 and Xt2 by using Bartlett's\ndecomposition (31) since Xt2 = t WISd (0, \u03b1 \u2212 d, 0, Idn ; 1) from (11).\nLaw\n\n2.4. The Bartlett's decomposition revisited. Now we would like to illustrate our exact simulation method on the particular case WISd (0, \u03b1, 0, Idn ; 1),\nwhich is known in the literature as the central Wishart 1,0\ndistribution. In that\nX\n\ncase, we can perform explicitly the composition X1n,...\ngiven by Proposition 8. We will show by an induction on n that\n\u0012\n\u0013\u0012 T\n\u0013\n1,0\n(Li,j )1\u2264i,j\u2264n 0\n(Li,j )1\u2264i,j\u2264n 0\nn,...X1\nX1\n(31)\n=\n,\n0\n0\n0\n0\n1\n\nwhere (Li,j )1\u2264j<i\u2264d and Li,i are independent random variables such that\nLi,j \u223c N (0, 1) and (Li,i )2 \u223c \u03c72 (\u03b1 \u2212 i + 1) and Li,j = 0 for i < j. This re-\n\n\f18\n\nA. AHDIDA AND A. ALFONSI\n\nsult is known as the Bartlett's decomposition and dates back to 1933 (see\nKshirsagar [18] or Kabe [17]).\n1,0\n2\nFor n = 1, we know\nq from Theorem 9 that (X1 )1,1 \u223c \u03c7 (\u03b1) since\n\nd(Xt1,0 )1,1 = \u03b1 dt + 2 (Xt1,0 )1,1 dZt1 with (X01,0 )1,1 = 0, and all the other\nelements are equal to 0. Let us assume now that the induction hypothesis is\nsatisfied for n \u2212 1. Then, we can apply once again Theorem 9 (up to the perX\n\n1,0\n1\n\nmutation of the first and nth coordinates). We have Rk(X1n\u22121,...\n) = n \u2212 1,\na.s., and the Cholesky decomposition is directly given by (Li,j )1\u2264i,j\u2264n\u22121 .\nThen, we get from (27) that there are independent variables L2n,n \u223c \u03c72 (\u03b1 \u2212\nn + 1) and Ln,i \u223c N (0, 1) for i \u2208 {1, . . . , n \u2212 1} such that\n\uf8eb\n\uf8f6\n(L\n)\n0\n0\n1,0\ni,j\n1\u2264i,j\u2264n\u22121\nX\n1\nX1n,...\n=\uf8ed\n0\n1\n0 \uf8f8\n0\n0 Id\u2212n\n\uf8f6\n\uf8eb\nIn\u22121\n(Ln,i )1\u2264i\u2264n\u22121 0\nn\nX\n\uf8f7\n\uf8ec\nT\n\u00d7\uf8ec\nL2n,i\n0\uf8f7\n(L\n)\n\uf8f8\n\uf8ed n,i 1\u2264i\u2264n\u22121\ni=1\n\n0\n\n\uf8eb\n\nSince\n\uf8eb\n\nIn\u22121\n\n\uf8ec\n\uf8ec\n\uf8ec (Ln,i )T1\u2264i\u2264n\u22121\n\uf8ed\n0\n\n(Li,j )T1\u2264i,j\u2264n\u22121\n\n\u00d7\uf8ed\n\n0\n0\n\n(Ln,i )1\u2264i\u2264n\u22121\nn\nX\nL2n,i\n\n0\n\ni=1\n\n0\n\nwe conclude by induction on n.\n\n0\n1\n0\n\n0\n\n0\n\n\uf8f6\n\n0\n0 \uf8f8.\n\nId\u2212n\n\n\uf8f6\n\n\uf8eb\n\uf8f6\nIn\u22121\n0\n0\n\uf8f7\n\uf8f7\n0 \uf8f7 = \uf8ed (Ln,i )T1\u2264i\u2264n\u22121 Ln,n 0 \uf8f8\n\uf8f8\n0\n0\n0\n0\n\uf8eb\n\uf8f6\nIn\u22121 (Ln,i )1\u2264i\u2264n\u22121 0\n\u00d7\uf8ed 0\nLn,n\n0\uf8f8,\n0\n0\n0\n\n3. High-order discretization schemes for Wishart and semidefinite positive affine processes. In this section, we switch from exact sampling to approximate schemes. First, this will enable us to simulate not only Wishart\nprocesses, but also general affine processes. More importantly, the discretization schemes that we introduce are in practice faster than the exact simulation scheme, especially if one has to sample entire paths. This will be\nillustrated in Section 4.\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n19\n\nWhen dealing with discretization schemes, splitting operators is a powerful technique to construct schemes for SDEs from other schemes obtained\non simpler SDEs. This idea of splitting originates from the seminal work\nof Strang [27] in the field of ODEs. As pointed out by Ninomiya and Victoir [24] or Alfonsi [2], it is rather easy to analyze the weak error (i.e., the\nerror made on marginal distributions) of schemes obtained by splitting. Indeed, this can be done simply by using the same arguments as Talay and\nTubaro [28] for the Euler\u2013Maruyama scheme. Nonetheless, when we use the\nsplitting technique for SDEs that are defined on a given domain [Sd+ (R) in\nour case], one has to be careful that the discretization scheme remains in it.\nFor example, in the case of the CIR diffusion (i.e., d = 1), general splitting\nmethods such as Ninomiya and Victoir [24] fail to preserve the domain R+ .\nIt is, in fact, only well defined for \u03b1 \u2265 1, while the CIR process exists for\nany \u03b1 \u2265 0 (see Alfonsi [2]). Of course, the same remark holds for Wishart\nand affine processes. This is why we will use the ad hoc splitting (7) instead\nof general splitting methods, which enables us to get schemes that preserve\nSd+ (R) and are defined without any restriction on the parameters.\nThe analysis of the strong error of our schemes is beyond the scope of\nthis paper. In fact, behind the term \"strong error\" we have in mind here\ntwo different things. First, it can be the error made on pathwise expectations between the discretization scheme and the exact scheme. This kind of\nerror is illustrated numerically in the next section (Figure 3) and seems to\nbe of the same order as the weak error, even though we are not at all able to\nmathematically show this result. Second, \"strong error\" can also mean the\npathwise error between the discretization scheme and the exact solution for\na given Brownian motion (Wt , t \u2265 0). The rate of convergence for this kind\nof error has been analyzed for the CIR in Alfonsi [1] and is really low. This\nis mainly due to the fact that the square root is not Lipschitz near 0. Fortunately, discretization schemes are mostly used to compute expectations with\na Monte Carlo algorithm. In this context, pathwise error is not so relevant.\nTo our knowledge, there are very few papers in the literature that deal\nwith discretization schemes for Wishart processes. Recently, Benabid, Bensusan and Karoui [3] have proposed a Monte Carlo method to calculate\nexpectations on Wishart processes which is based on a Girsanov change\nof probability. Gauthier and Possamai [10] introduce a moment-matching\nscheme for Wishart processes. Both methods are well defined under some\nrestrictions on the parameters, and there is no theoretical result on their\naccuracy. Currently, Teichmann [29] is working on dedicated schemes for\ngeneral affine processes by approximating their characteristic functions.\nThis section is structured as follows. First, we recall basic results on\nthe splitting technique to get discretization schemes for SDEs. We will\ntake the same framework as Alfonsi [2] since it is somehow designed for\naffine processes. Then we will explain how to get high-order schemes for\nWISd (x, \u03b1, 0, e1d ) from the construction given by Theorem 9. The remarkable\n\n\f20\n\nA. AHDIDA AND A. ALFONSI\n\nsplitting (15) will then enable us to get high-order schemes for WISd (x, \u03b1,\n0, Idn ). From this result, we will be able to get a second-order scheme for any\nsemidefinite positive affine processes and a third-order scheme for Wishart\nprocesses.\n3.1. Weak error analysis and splitting methods. Let us start with some\nnotation. We consider a time horizon T > 0 and the regular time grid defined\nby tN\ni = iT /N , i = 0, . . . , N . When considering a Markovian process on a\ndomain D, a discretization scheme is a way to sample the value at a given\ntime step t > 0, starting from the current value x \u2208 D. It is thus described\nby a probability measure p\u0302x (t)(dz) on D, and we denote by X\u0302tx a random\nvariable that follows this law. Then the full discretization on the regular time\ngrid associated to this scheme from x \u2208 D is simply a sequence (X\u0302tNN , 0 \u2264 i \u2264\ni\n\nN ) of random variables such that:\n\u2022 X\u0302tNN = x,\n0\n\n\u2022 the law of X\u0302tNN\n\ni+1\n\nis sampled according to p\u0302X\u0302 N (T /N )(dz) independently\ntN\ni\n\nfrom the previous samples, that is, E[f (X\u0302tNN )|(X\u0302tNN , 0 \u2264 j \u2264 i)] =\nj\ni+1\nR\n(T\n/N\n)(dz)\nfor\nany\nbounded\nmeasurable\nfunction\nf : D \u2192 R.\nf\n(z)p\u0302\nN\nD\nX\u0302\ntN\ni\n\nNow we focus on the analysis of the weak error E[f (XTx )] \u2212 E[f (X\u0302tNN )].\nN\n\nThere is a huge literature on this topic. Talay and Tubaro [28] have obtained\nan expansion error for Euler\u2013Maruyama and Milstein schemes. This error\nhas also been studied on other schemes: we cite the articles of Kusuoka [19],\nLyons and Victoir [21], Ninomiya and Victoir [24], and Ninomiya and Ninomiya [23], to mention a few. However, to our knowledge, most of these\npapers make regularity assumptions on the SDE coefficients that are not\nsatisfied by affine diffusions. Typically, they assume that these coefficients\nare C \u221e with bounded derivatives. This is not satisfied by general affine diffusions because of the square root diffusion term. For this reason, Alfonsi [2]\nintroduced a framework that allows us to rigorously analyze the weak error\nfor affine diffusions. In this paper, we will naturally work under this framework. Unfortunately, this requires us to introduce some definitions, and we\npresent here only the main ones.\nWe consider a domain D \u2282 R\u03b6 , \u03b6 \u2208 N\u2217 , and L an operator associated to\nan SDE defined on D. Mainly (but not only), we consider in this paper\nD = Sd+ (R) \u2282 Sd (R) \u2243 Rd(d+1)/2 . For \u03b3 = (\u03b31 , . . . , \u03b3\u03b6 ) \u2208 N\u03b6 , we define \u2202\u03b3 =\nP\n\u03b3\n\u22021\u03b31 , . . . , \u2202\u03b6 \u03b6 and |\u03b3| = \u03b6i=1 \u03b3i and set\n\u221e\nCpol\n(D) = {f \u2208 C \u221e (D, R), \u2200\u03b3 \u2208 N\u03b6 , \u2203C\u03b3 > 0, e\u03b3 \u2208 N\u2217 ,\n\n\u2200x \u2208 D, |\u2202\u03b3 f (x)| \u2264 C\u03b3 (1 + kxke\u03b3 )},\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n21\n\nwhere k * k is a norm on R\u03b6 . We say that (C\u03b3 , e\u03b3 )\u03b3\u2208N\u03b6 is a good sequence for\n\u221e (D) if one has |\u2202 f (x)| \u2264 C (1 + kxke\u03b3 ). The operator L is said to\nf \u2208 Cpol\n\u03b3\n\u03b3\nP\nsatisfy the required assumptions if it can be written as L = 0<|\u03b3|\u22642 a\u03b3 (x)\u2202\u03b3 ,\n\u221e (D). This property holds for affine diffusions since any a is\nwith a\u03b3 \u2208 Cpol\n\u03b3\nan affine function. We will say that X\u0302tx is a potential weak \u03bdth-order scheme\n\u221e (D) with a good sequence\nfor the operator L if for any function f \u2208 Cpol\n(C\u03b3 , e\u03b3 )\u03b3\u2208N\u03b6 , there exist positive constants C, E and \u03b7 depending only on\n(C\u03b3 , e\u03b3 )\u03b3\u2208N\u03b6 such that\n(32)\n\n\u2200t \u2208 (0, \u03b7)\n\n#\n\u03bd\nX\n1\ntk Lk f (x) \u2264 Ct\u03bd+1 (1 + kxkE ).\nE[f (X\u0302tx )] \u2212 f (x) +\nk!\n\"\n\nk=1\n\nRoughly speaking, this is the main assumption that a discretization scheme\nshould satisfy to get a weak error of order \u03bd. This is precised by the following theorem given in [2] that relies on the idea developed by Talay and\nTubaro [28] for the Euler\u2013Maruyama scheme.\nTheorem 13. Let L be an operator satisfying the required assumptions\non D. We assume that:\n(1) X\u0302tx is a potential weak \u03bdth-order scheme for L, and the scheme has\nuniformly bounded moments, that is,\n(33)\n\n\u2203n0 \u2208 N\u2217 , \u2200q \u2208 N\u2217\n\nsup\nN \u2265n0 ,0\u2264i\u2264N\n\nE[kX\u0302tNN kq ] < \u221e;\ni\n\n(2) f : D \u2192 R is a function such that u(t, x) = E[f (XTx \u2212t )] is defined on\n[0, T ] \u00d7 D, C \u221e , solves \u2200t \u2208 [0, T ], \u2200x \u2208 D, \u2202t u(t, x) = \u2212Lu(t, x) and satisfies\n(34)\n\n\u2200l \u2208 N, \u03b3 \u2208 N\u03b6 , \u2203Cl,\u03b3 , el,\u03b3 > 0, \u2200x \u2208 D, t \u2208 [0, T ]\n|\u2202tl \u2202\u03b3 u(t, x)| \u2264 Cl,\u03b3 (1 + kxkel,\u03b3 ).\n\nThen, there is K > 0, N0 \u2208 N, such that |E[f (X\u0302tNN )] \u2212 E[f (XTx )]| \u2264 K/N \u03bd for\nN\nN \u2265 N0 .\nIt is really important to notice that only assumption (1) depends on the\ndiscretization scheme. Assumption (2) just depends on the underlying diffusion. Since we only have a hold over the discretization scheme, this means\nfrom a numerical point of view that we mainly have to focus on assumption\n(1) to construct an accurate scheme. From a mathematical point of view,\nthe regularity of the Cauchy problem which is required by assumption (2)\nis a tough problem that is interesting in its own. General results have been\nobtained in Talay and Tubaro [28] when b and \u03c3 are C \u221e with bounded\nderivatives. In the case of Wishart processes, we are able to get (34) when\n\u221e (S (R)).\nf \u2208 Cpol\nd\n\n\f22\n\nA. AHDIDA AND A. ALFONSI\n\nProposition 14. Let (Xtx )t\u22650 \u223c WISd (x, \u03b1, b, a) and L the associated\n\u221e (S (R)), x \u2208 S + (R) and T > 0. Then, \u0169(t, x) = E[f (X x )]\ngenerator. Let f \u2208 Cpol\nd\nt\nd\nis C \u221e on [0, T ] \u00d7 Sd+ (R), solves \u2202t \u0169(t, x) = L\u0169(t, x) and its derivatives satisfy\n(35)\n\n\u2200l \u2208 N, \u2200n \u2208 Nd(d+1)/2 , \u2203Cl,n , el,n > 0, \u2200x \u2208 Sd+ (R), \u2200t \u2208 [0, T ]\n\u2202tl\n\nY\n\n1\u2264i\u2264j\u2264d\n\nn\n\n{i,j}\n\u2202{i,j}\n\u0169(t, x) \u2264 Cl,n (1 + kxkel,n ).\n\nThe proof of this result is made in Appendix D.1. It relies on the explicit\nformula of the characteristic function (10) and, more exactly, on the property stated in Lemma 26. Unfortunately, we have not been able to show an\nanalogous result for general affine processes AFFd (x, \u1fb1, B, a). We deem that\n(35) also holds in that case, but this remains an open question.\nLet us now turn to assumption (1) of Theorem 13. Usually, the boundedness of moments is not a big issue and requires, in general, tedious calculations. This basically holds when the drift and the diffusion coefficients\nhave a sublinear growth, which is the case here. Conversely, it is much more\ndifficult to find a scheme which is a potential \u03bd-order scheme and stays at\nthe same time in the domain Sd+ (R). For example, the Euler\u2013Maruyama\nscheme is, generally speaking, a potential first-order scheme. However, it\ndoes not stay in Sd+ (R) even for the CIR case (d = 1). Still, for the CIR process, higher-order schemes such as Ninomiya and Victoir [24] or Ninomiya\nand Ninomiya [23] stay in R+ only under additional restrictions on the parameters. To solve this problem and get high-order schemes that remain in\nSd+ (R), we will construct ad hoc discretization schemes by taking advantage\nof the remarkable splitting (15). In fact, the property of being a potential\n\u03bdth-order schemes is really easy to handle by scheme composition, especially when \u03bd = 2. This kind of result dates back to Strang [27] in the field\nof ODEs. In our framework, we recall a result that is stated in [2].\nProposition 15. Let L1 , L2 be the generators of SDEs defined on D that\nsatisfy the required assumption on D. Let X\u0302t1,x and X\u0302t2,x denote, respectively,\ntwo potential weak \u03bdth-order schemes on D for L1 and L2 .\n2,X\u0302 1,x\n\n(1) If L1 L2 = L2 L1 , X\u0302t t is a potential weak \u03bdth-order discretization\nscheme for L1 + L2 .\n(2) Let B be an independent Bernoulli variable of parameter 1/2. If \u03bd \u2265 2,\n(a)\n\n2,X\u0302 1,x\nB X\u0302t t\n\n1,X\u0302 2,x\n+ (1 \u2212 B)X\u0302t t\n\n1,X\u0302\n\nand\n\n(b)\n\n2,X\u0302\nX\u0302t/2 t\n\nare potential weak second-order schemes for L1 + L2 .\n\n2,x\nt/2\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n23\n\n2,X\u0302t1,x\n\nLet us explain the notation above. The composition X\u0302t2 1 means that\nwe first use the scheme 1 with time step t1 and then, conditionally to X\u0302t1,x\n,\n1\n1,x\nwe sample the schemeR2 with initial value X\u0302t1 and time step t2 . To be\nexplicit, it has the law D p\u03022y (t2 )(dz)p\u03021x (t1 )(dy), where p\u0302ix (ti )(dz) denotes the\nlaw of X\u0302ti,x\n, i = 1, 2.\ni\n3.2. High-order schemes for Wishart processes. In this paragraph, we\nwill give a way to get weak \u03bdth-order schemes for any Wishart processes. The\nconstruction is similar to the one used for the exact scheme. First, we obtain\na \u03bdth-order scheme for WISd (x, \u03b1, 0, e1d ). Then, we get a \u03bdth-order scheme for\nWISd (x, \u03b1, 0, Idn ) from the splitting (15) and Proposition 15. Last, we use the\nidentity in law (14) to get a weak \u03bdth-order scheme for any Wishart process.\nLet us start then by introducing a potential weak \u03bdth-order scheme for\nWISd (x, \u03b1, 0, e1d ). Roughly speaking, we obtain this scheme from the exact\nscheme given by Theorem 9 and Corollary 11 by replacing the Gaussian\nrandom variables with moment matching variables and the exact CIR distribution with a sample according to a potential weak \u03bdth-order scheme for\nthe CIR.\nTheorem 16. Let x \u2208 Sd+ (R) and (cr , kr , p) be an extended Cholesky\ndecomposition of (xi,j )2\u2264i,j\u2264d . We set \u03c0 = ( 10 0p ) and x\u0303 = \u03c0x\u03c0 T , so that\n(x\u0303i,j )2\u2264i,j\u2264d = ( kcrr\n\n0 cT\nr\n0 )( 0\n\nkrT\n0\n\n). As in Theorem 9, we have\n\nu{1,1} = x\u0303{1,1} \u2212\nwhere\n\nr\nX\nk=1\n\n(u{1,k+1} )2 \u2265 0,\n\n(u{1,l+1} )1\u2264l\u2264r = c\u22121\nr (x\u0303{1,l+1} )1\u2264l\u2264r ,\nand we set u{1,i} = 0 if r +2 \u2264 i \u2264 d and u{i,j} = x\u0303{i,j} if i, j \u2265 2. Let (\u011ci )1\u2264i\u2264r\nbe a sequence of independent real variables with finite moments of any order\nsuch that\n\u2200i \u2208 {1, . . . , r}, \u2200k \u2264 2\u03bd + 1\n\nE[(\u011ci )k ] = E[Gk ]\n\nwhere G \u223c N (0, 1).\n\nLet hr be the function defined by (30). Let (\u00dbtu ){1,1} be sampled independently according to a potential\nq weak \u03bdth-order scheme for the CIR process\nu\nd(Ut ){1,1} = (\u03b1 \u2212 r) dt + 2 (Utu ){1,1} dZt1 starting from u{1,1} . We set\n\u221a\n(\u00dbtu ){1,i} = u{1,i} + t\u011ci ,\n2 \u2264 i \u2264 r + 1,\n(\u00dbtu ){1,i} = 0,\n(\u00dbtu ){i,j} = u{i,j}\n\nr + 2 \u2264 i \u2264 d,\nif i, j \u2265 2.\n\n\f24\n\nA. AHDIDA AND A. ALFONSI\n\nThen, the scheme X\u0302tx = \u03c0 T hr (\u00dbtu )\u03c0 is a potential \u03bdth-order scheme for Le1\nd\nand takes values in Sd+ (R).\nLet us give the idea of the proof. By construction, we have X\u0302tx \u2208 Sd+ (R)\nsince an analogous formula to (27) holds for X\u0302tx . The tedious part is to\ncheck that it is a potential \u03bdth-order scheme. We know from Theorem 9,\nequation (30) and Corollary 11 that we have Xtx = \u03c0 T hr (Utu )\u03c0. It is easy to\ncheck that \u00dbtu is a potential \u03bdth-order scheme for the operator associated to\n\u221e (S (R)). Then,\nthe diffusion Utu . Let us suppose for a while that hr (u) \u2208 Cpol\nd\nT\n\u221e\n\u221e\nu 7\u2192 f (\u03c0 hr (u)\u03c0) is also in Cpol (Sd (R)), and for any f \u2208 Cpol (Sd+ (R)), there\nare constants C, E, \u03b7 > 0 depending only on a good sequence of f such that\n|E[f (\u03c0 T hr (\u00dbtu )\u03c0)] \u2212 E[f (Xtx )]| \u2264 Ct\u03bd+1 (1 + kxkE ),\n\n\u221e (S (R)).\nwhich basically gives the desired result. Unfortunately, hr is not in Cpol\nd\nIn fact, hr is only smooth with respect to the coefficients of the first row and\nthe first columns. However, these coefficients are also the only ones that are\nchanged by \u00dbtu [the submatrix ((\u00dbtu )i,j )2\u2264i,j\u2264d = (ui,j )2\u2264i,j\u2264d is constant],\nand it comes out that the regularity on hr is sufficient to get a potential\n\u03bdth-order scheme for Le1 . This is shown rigorously in the preprint version\nd\nof this paper at the cost of additional technical definitions such as the \"immersion property\" that we do not reproduce here.\nNow we briefly comment on the practical implementation of Theorem 16.\nSecond and third-order schemes for the CIR process satisfying can be found\nin Alfonsi [2]. We can therefore get second (resp., third) order schemes for\nLe1 by taking any variables that matches the five (resp., the seven) first\nd\nmoments of N (0, 1). This can be obtained by taking\n\u221a\n\u221a\nP(\u011ci = 3) = P(\u011ci = \u2212 3) = 16 and P(\u011ci = 0) = 23 ,\n(36)\n\nrespectively,\n\n\u221a\nq\n\u221a\n6\u22122\nP(\u011c = \u03b5 3 + 6) = \u221a ,\n4 6\n(37)\n\u221a\nq\n\u221a\n6\u22122\n1\ni\nP(\u011c = \u03b5 3 \u2212 6) = \u2212 \u221a ,\n\u03b5 \u2208 {\u22121, 1}.\n2\n4 6\nWe focus now on the construction of a potential weak \u03bdth-order scheme\nfor WISd (x, \u03b1, 0, Idn ). Let X\u0302t1,x denote a potential weak \u03bdth-order scheme for\nWISd (x, \u03b1, 0, e1d ). For i \u2208 {2, . . . , d}, WISd (x, \u03b1, 0, eid ) and WISd (x, \u03b1, 0, e1d )\nhave the same law up to the permutation of the first and ith coordinate. Let\n\u03c0 1\u2194i denote the associated permutation matrix. Then, we easily get that\ni\n\nX\u0302ti,x = \u03c0 1\u2194i X\u0302t1,\u03c0\n\n1\u2194i x\u03c0 1\u2194i\n\n\u03c0 1\u2194i\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n25\n\nis a potential \u03bdth-order scheme for WISd (x, \u03b1, 0, eid ). Last, we get from Theorem 7 and the point 1 of Proposition 15 that\n1,x\nX\u0302t\n\n(38) X\u0302tn,...\n\nis a potential weak \u03bdth-order scheme for WISd (x, \u03b1, 0, Idn ).\n\nNow we are in position to construct a scheme for any Wishart process WISd (x, \u03b1, b, a) thanks to the identity (14). Let \u03b8t \u2208 Gd (R) be such\nas in Proposition 6 and \u0176ty denote a potential weak \u03bdth-order scheme for\nWISd (y, \u03b1, 0, Idn ). Then we consider the following scheme for WISd (x, \u03b1, b, a):\n(39)\n\n\u22121 T\n\u03b8t\u22121 mt xmT\nt (\u03b8t )\n\u03b8tT .\n\nX\u0302tx = \u03b8t \u0176t\n\nUnfortunately, we need to make some technical restrictions on a and b\n[namely, a \u2208 Gd (R) or baT a = aT ab] to show that we get like this a potential \u03bdth-order scheme. We, however, believe that this is rather due to\nour analysis of the error and that the scheme converges as well without\nthis restriction. In addition, we mention that we give in the next section\na second-order scheme based on Proposition 5 for which we can make our\nerror analysis for any parameters.\nProposition\nR t 17. Let t > 0, a, b \u2208 Md (R) and \u03b1 \u2265 d \u2212 1. Let mt =\nexp(tb), qt = 0 exp(sb)aT a exp(sbT ) ds and n = Rk(aT a). We assume that\neither a \u2208 Gd (R) or b and aT a commute. We define:\n\u2022 if n = d, \u03b8t as q\nthe (usual) Cholesky decomposition of qt /t,\nRt\n0\n) where (cn , kn , p) is\n\u2022 if n < d, \u03b8t = 1t 0 exp(sb) exp(sbT ) dsp\u22121 ( kcnn Id\u2212n\nT\nthe extended Cholesky decomposition of a a otherwise.\nIn both cases, \u03b8t \u2208 Gd (R) and the scheme (39) is a potential weak \u03bdth-order\nscheme for WISd (x, \u03b1, b, a).\nThe proof of Proposition 17 is left in Appendix D.2. From Theorem 13,\nwe finally get the following result by using Propositions 14, 17.\nTheorem 18. Let (Xtx )t\u22650 \u223c WISd (x, \u03b1, b, a) such that either a \u2208 Gd (R)\n\u221e (S (R)). Let (X\u0302 N , 0 \u2264 i \u2264 N ) be sampled with\nor aT ab = baT a and f \u2208 Cpol\nd\ntN\ni\nthe scheme defined by Proposition 17 and Theorem 16 with the third-order\nscheme for the CIR given in [2]. Then,\n\u2203C, N0 > 0, \u2200N \u2265 N0\n\n|E[f (X\u0302tNN )] \u2212 E[f (XTx )]| \u2264 C/N 3 .\nN\n\n3.3. Second-order schemes for affine diffusions on Sd+ (R). In this part,\nwe present a potential second-order scheme for AFFd (x, \u1fb1, B, a). Thanks\nto Proposition 5, there is u \u2208 Gd (R) and a diagonal matrix \u03b4\u0304 such that\n\n\f26\n\nA. AHDIDA AND A. ALFONSI\n\n\u1fb1 = uT \u03b4\u0304u, aT a = uT Idn u and we have\n(u\u22121 )T xu\u22121\n\n(uT Yt\n\nu)t\u22650 \u223c AFFd (x, \u1fb1, B, a)\n\nwhere (Yty )t\u22650 \u223c AFFd (y, \u03b4\u0304, Bu , Idn ).\n\nUsing the same linear transformation, we can get a potential \u03bdth-order\nscheme for AFFd (x, \u1fb1, B, a) from a potential \u03bdth-order scheme for AFFd (y, \u03b4\u0304,\nBu , Idn ) as stated below.\nLemma 19.\n\nIf \u0176ty is a potential \u03bdth-order scheme for AFFd (y, \u03b4\u0304, Bu , Idn ),\n\n(u\u22121 )T xu\u22121\n\nthen uT \u0176t\n\nu is a potential \u03bdth-order scheme for AFFd (x, \u1fb1, B, a).\n\n\u221e (S + (R)). We then have x 7\u2192 f (uT xu) \u2208 C \u221e (S + (R)).\nProof. Let f \u2208 Cpol\npol d\nd\nSince u is fixed, there are constants C, \u03b7, E depending only on a good se(u\u22121 )T xu\u22121\nu)] \u2212 E[f (Xtx )]| =\nquence of f such that for t \u2208 (0, \u03b7), |E[f (uT \u0176t\n(u\u22121 )T xu\u22121\n\n(u\u22121 )T xu\u22121\n\nu)]| \u2264 Ct\u03bd+1 (1 + k(u\u22121 )T x \u00d7\nu)] \u2212 E[f (uT Yt\n|E[f (uT \u0176t\nu\u22121 kE ) \u2264 C \u2032 t\u03bd+1 (1 + kxkE ), for some constant C \u2032 > C. \u0003\n\nWe now focus on finding a scheme for AFFd (y, \u03b4\u0304, Bu , Idn ), and we will\nconstruct it from the second-order scheme for WISd (x, \u03b1, 0, Idn ) obtained in\n(38). Since \u03b4\u0304 is a diagonal matrix such that \u03b4\u0304 \u2212 (d \u2212 1)Idn \u2208 Sd+ (R), we have\n\u03b4min := min \u03b4\u0304i,i \u2265 d \u2212 1.\n1\u2264i\u2264n\n\nWe rewrite the infinitesimal generator of Yty as follows:\n(40)\n\nL = Tr([\u03b4\u0304 + Bu (x)]D S ) + 2 Tr(xD S Idn D S )\n= Tr([\u03b4\u0304 \u2212 \u03b4min Idn + Bu (x)]D S ) + \u03b4min Tr(Idn D S ) + 2 Tr(xD S Idn D S ).\n|\n{z\n} |\n{z\n}\nLODE\n\nLWISd (x,\u03b4min ,0,I n )\nd\n\nIt is the sum of the infinitesimal generator of WISd (x, \u03b4min , 0, Idn ) and of the\ngenerator of the affine ODE\ndXtODE,x = [\u03b4\u0304 \u2212 \u03b4min Idn + Bu (XtODE,x )] dt,\n\nX0ODE,x = x \u2208 Sd+ (R).\n\nWe know by Lemma 27 that XtODE,x \u2208 Sd+ (R) for any t \u2265 0 since assumption\n(4) holds for Bu and \u03b4\u0304 \u2212 \u03b4min Idn \u2208 Sd+ (R). Besides, this ODE can be solved explicitly [see formula (52)]. Let X\u0302tx denote the potential second-order scheme\nfor WISd (x, \u03b4min , 0, Idn ) obtained by (38) that uses the nested second-order\nscheme for the CIR given in [2]. By using Proposition 15, the schemes\nX\n\n(41)\n\n\u0176tx\n\nODE,X\u0302t\n= Xt/2\n\nODE,x\nt/2\n\nor\n\nXtODE,x\n\n\u0176tx = (1 \u2212 B)X\u0302t\n\nODE,X\u0302tx\n\n+ BXt\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n27\n\nare potential second-order schemes for AFFd (x, \u03b4\u0304, Bu , Idn ). In the numerical\nX\n\nODE,X\u0302t\nXt/2\n\nODE,x\nt/2\n\neven though the other\nexperiments in Section 4, we have used\nscheme would have worked as well; it is, in fact, a computational tradeoff between solving a deterministic ODE and drawing a Bernoulli variable.\nThanks to Lemma 19, Proposition 14 and Theorem 13, we finally get the\nfollowing result.\nTheorem 20. The scheme defined by Lemma 19 and equation (41) is a\npotential second-order scheme for AFFd (x, \u1fb1, B, a). In the Wishart case (3),\n\u221e (S (R)),\nwe have for f \u2208 Cpol\nd\n\u2203C, N0 > 0, \u2200N \u2265 N0\n\n|E[f (X\u0302tNN )] \u2212 E[f (XTx )]| \u2264 C/N 2 .\nN\n\n3.4. A faster second-order scheme for AFFd (x, \u1fb1, B, a) when \u1fb1 \u2212 daT a \u2208\nIn this section, we focus on the complexity of the discretization\nschemes with respect to the dimension d. Up to now, the discretization\nschemes that we have considered in Theorems 18 and 20 have a complexity\nof O(d4 ). Indeed, both schemes rely on the construction (38) to sample\nWISd (x, \u03b1, 0, Idn ), which requires n Cholesky decompositions, like the exact\nsampling. This requires at most O(d4 ) operations. Here, we present a secondorder scheme whose complexity is O(d3 ), provided that \u1fb1 \u2212 daT a \u2208 Sd+ (R)\nor \u03b1 \u2265 d in the Wishart case. The practical relevance of such a scheme will\nbe illustrated in Section 4.\nTo do so, we use the same construction as in Section 3.3, and we remark\nthat different splitting from (40) are possible. In fact, we could have chosen\ninstead L = Tr([\u03b4\u0304 \u2212 \u03b2Idn + Bu (x)]D S )+ \u03b2 Tr(Idn D S )+ 2 Tr(xD S Idn D S ) for any\n\u03b2 \u2208 [d \u2212 1, \u03b4min ]: the first part is the operator of an affine ODE which is well\ndefined on Sd+ (R) by Lemma 27 while the second part is the generator of\nWISd (x, \u03b2, 0, Idn ). When \u03b4min \u2265 d, which is equivalent to \u1fb1 \u2212 daT a \u2208 Sd+ (R),\nthe following splitting obtained with \u03b2 = d\nSd+ (R).\n\n(42)\n\nL = Tr([\u03b4\u0304 \u2212 dIdn + Bu (x)]D S ) + d Tr(Idn D S ) + 2 Tr(xD S Idn D S )\n|\n{z\n} |\n{z\n}\nLWISd (x,d,0,I n )\n\nL\u0303ODE\n\nd\n\nis really interesting. Indeed it is known from Bru [5] that Wishart processes\nwith \u03b1 \u2208 N can be seen as the square of an Ornstein\u2013Uhlenbeck process on\nmatrices and can be simulated very efficiently. More precisely, we will use\nthe following result that is shown in Appendix D.3.\nProposition 21.\nWe have\n\nLet x \u2208 Sd+ (R) and c \u2208 Md (R) be such that cT c = x.\n\n((c + Wt Idn )T (c + Wt Idn ), t \u2265 0) = WISd (x, d, 0, Idn ).\nLaw\n\n\f28\n\nA. AHDIDA AND A. ALFONSI\n\nIf \u011c denote a d-by-d\n\u221a independent elements sampled according\n\u221a matrix with\nto (36), X\u0302tx = (c + t\u011cIdn )T (c + t\u011cIdn ) is a potential second-order scheme\nfor WISd (x, d, 0, Idn ).\nTo compute X\u0302tx , one has to sample d2 random variables and to make one\nmatrix product, which requires O(d3 ) operations. This is faster than the\nscheme obtained by (38). Then we follow the same line as in Section 3.3 and\nset\ndX\u0303tODE,x = [\u03b4\u0304 \u2212 \u03b4min Idn + Bu (X\u0303tODE,x )] dt,\n\nX\u03030ODE,x = x \u2208 Sd+ (R).\n\nThis ODE is well defined on Sd+ (R) and can be solved explicitly. By Proposition 15,\nX\u0303\n\n(43)\n\nODE,X\u0302t\n\u0176tx = X\u0303t/2\n\nODE,x\nt/2\n\nor\n\nX\u0303tODE,x\n\n\u0176tx = (1 \u2212 B)X\u0302t\n\nODE,X\u0302tx\n\n+ B X\u0303t\n\nis a potential second-order scheme for AFFd (x, \u03b4\u0304, Bu , Idn ) that have still an\nO(d3 ) complexity. Thanks to Lemma 19, Proposition 14 and Theorem 13,\nwe get a similar result to Theorem 20.\nTheorem 22. Let us assume that \u1fb1 \u2212 daT a \u2208 Sd+ (R). The scheme defined by Lemma 19 and equation (43) is a potential second-order scheme for\nAFFd (x, \u1fb1, B, a) that requires at most O(d3 ) operations. In the Wishart case\n\u221e (S (R)),\n(3), we have for f \u2208 Cpol\nd\n|E[f (X\u0302tNN )] \u2212 E[f (XTx )]| \u2264 C/N 2 .\n\n\u2203C, N0 > 0, \u2200N \u2265 N0\n\nN\n\n4. Numerical results on the simulation methods. The scope of this section is to compare the different simulation methods given in this paper. We\nstill consider a time horizon T and the regular time-grid tN\ni = iT /N , for\ni = 0, . . . , N . In addition, we want to compare our schemes to a standard\none, and we will consider the following corrected Euler\u2013Maruyama scheme\nfor AFFd (x, \u1fb1, B, a):\nX\u0302tNN = x,\n0\n\n(44)\n\nX\u0302tNN\ni+1\n\n= X\u0302tNN\ni\n\nT\n+ (\u1fb1 + B(X\u0302tNN ))\ni\nN\n\n+ aT (WtN \u2212 WtN )T\ni+1\n\ni\n\nr\n\n+\n\nr\n\n(X\u0302tNN )+ (WtN \u2212 WtN )a\n\n(X\u0302tNN )+ ,\ni\n\ni\n\ni+1\n\ni\n\n0 \u2264 i \u2264 N \u2212 1.\n\nHere, x+ denotes the matrix that has the same eigenvectors as x with the\nsame eigenvalue if it is positive and a zero eigenvalue otherwise. Namely,\n+ T\nT\n+\nwe set x+ = o diag(\u03bb+\n1 , . . . , \u03bbd )o for x = o diag(\u03bb1 , . . . , \u03bbd )o . Thus, x is\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n29\n\nby construction a positive semidefinite matrix and its square root is well\ndefined. Without this positive part, the scheme above is not well defined for\nany realization of W .\nFirst, we compare the time required by the different schemes and the\nexact simulation. Then, we present numerical results on the convergence of\nthe different schemes. Last, we give an application of our scheme to the\nGourieroux\u2013Sufana model in finance.\n4.1. Time comparison between the different algorithms. In this paragraph, we compare the time required by the different schemes given in this\npaper. As it has already been mentioned, the complexity of the exact scheme\nas well as the one of the second-order scheme (given by Theorem 20) and\nthe third-order scheme (given by Theorem 18) is in O(d4 ) for one time-step.\nTo be more precise, they require O(d4 ) operations that mainly correspond\nto d Cholesky decompositions, O(d2 ) generations of Gaussian (or momentmatching) variables and O(d) generations of noncentral chi-square distributions (or second or third-order schemes for the CIR). The time saved by\nthe second and third-order schemes with respect to the exact scheme only\ncomes from the generation of random variables. For example, the generation of the moment-matching variables (36) and (37) is 2.5 faster than the\ngeneration of N (0, 1) on our computer. The gain between the second or\nthird-order schemes for the CIR given in Alfonsi [2] and the exact sampling\nof the CIR given by Glasserman [11] is much greater, but it depends on\nthe parameters of the CIR. When the dimension d gets larger, the absolute\ngain in time between the discretization schemes and the exact scheme is,\nof course, increased. However, the relative gain instead decreases to 1, because more and more time is devoted to matrix operations and Cholesky\ndecompositions that are the same in both cases. Let us now quickly analyze the complexity of the other schemes. The second-order scheme given by\nTheorem 22 (called \"second-order bis\" later) has a complexity in O(d3 ) operations for one Cholesky decomposition and matrix multiplications, with\nO(d2 ) generations of Gaussian variables. The complexity of the corrected\nEuler scheme is of the same kind. At each time-step, O(d3 ) operations are\nneeded for matrix multiplications and for diagonalizing the matrix in order\nto compute the square root of its positive part. However, diagonalizing a\nsymmetric matrix is, in practice, much longer than computing a Cholesky\ndecomposition even though both algorithms are in O(d3 ). Also, one has to\nsample O(d2 ) Gaussian variables for the Brownian increments.\nIn Table 1, we have calculated by a Monte Carlo method one value of the\ncharacteristic function of a Wishart process. It is also known analytically\nthanks to (10), and we have indicated in each case the exact value. We have\nconsidered dimensions d = 3 and d = 10. We have given in each case an\nexample where \u03b1 \u2265 d and another one where d \u2212 1 \u2264 \u03b1 < d. We have used\nthe different algorithms presented in this paper: \"2nd-order bis\" stands for\n\n\f30\n\nA. AHDIDA AND A. ALFONSI\n\nTable 1\nE[exp(\u2212 Tr(iv X\u0302tNN ))] calculated by a Monte Carlo with 106 samples for a Wishart process\nN\nwith a = Id , b = 0, x = 10Id , v = 0.09Id and T = 1. The starred numbers are those for\nwhich the exact value is outside the 95% confidence interval, and \u2206R (resp., \u2206I ) gives\nthe two standard deviations value on the real (resp., imaginary) part\nN = 10\nSchemes\n\nR. value\n\nIm. value\n\nN = 30\nTime\n\u22123\n\nR. value\n\nIm. value\n\nTime\n\n\u22120.229078\n\u22120.228133\n\u22120.228376\n\u22120.227729\n\u22120.231449\u2217\n\n125\n229\n244\n369\n687\n\n\u22123\n\n\u03b1 = 3.5, d = 3, \u2206R = 10 , \u2206Im = 10 ,\nexact value R. = \u22120.527090 and Im. = \u22120.228251\nExact (1 step)\n2nd-order bis\n2nd order\n3rd order\nExact (N steps)\nCorrected Euler\n\n\u22120.526852\n\u22120.526229\n\u22120.526577\n\u22120.527021\n\u22120.526963\n\u22120.525627\u2217\n\n\u22120.227962\n\u22120.228663\n\u22120.228923\n\u22120.227286\n\u22120.228303\n\u22120.233863\u2217\n\n12\n41\n76\n82\n123\n225\n\n\u22120.526486\n\u22120.526574\n\u22120.527613\n\u22120.526891\n\u22120.525638\u2217\n\n\u03b1 = 2.2, d = 3, \u2206R = 0.9 \u00d7 10\u22123 , \u2206Im = 1.3 \u00d7 10\u22123 ,\nexact value R. = \u22120.591411 and Im. = \u22120.036346\nExact (1 step)\n2nd order\n3rd order\nExact (N steps)\nCorrected Euler\n\n\u22120.591579\n\u22120.590444\n\u22120.591234\n\u22120.591169\n\u22120.589735\u2217\n\n\u22120.037651\n\u22120.037024\n\u22120.034847\n\u22120.036618\n\u22120.042002\u2217\n\n12\n77\n82\n174\n223\n\n\u22120.590808\n\u22120.590818\n\u22120.592145\n\u22120.590079\u2217\n\n\u22120.036487\n\u22120.036210\n\u22120.037411\n\u22120.039937\u2217\n\n229\n246\n920\n680\n\n\u03b1 = 10.5, d = 10, \u2206R = 1.4 \u00d7 10\u22123 , \u2206Im = 1.3 \u00d7 10\u22123 ,\nexact value R. = 0.063960 and Im. = \u22120.063544\nExact (1 step)\n2nd-order bis\n2nd order\n3rd order\nExact (N steps)\nCorrected Euler\n\n0.062712\n0.064237\n0.064922\n0.064620\n0.063418\n0.068298\u2217\n\n\u22120.063757\n\u22120.063825\n\u22120.064103\n\u22120.064543\n\u22120.064636\n\u22120.058491\u2217\n\n181\n921\n1431\n1446\n1806\n2312\n\n0.064573\n0.063534\n0.064120\n0.063469\n0.061732\u2217\n\n\u22120.062747\n\u22120.063280\n\u22120.063122\n\u22120.064380\n\u22120.056882\u2217\n\n2762\n4283\n4343\n5408\n7113\n\n\u03b1 = 9.2, d = 10, \u2206R = 1.4 \u00d7 10\u22123 , \u2206Im = 1.4 \u00d7 10\u22123 ,\nexact value R. = \u22120.036064 and Im. = \u22120.093275\nExact (1 step)\n2nd order\n3rd order\nExact (N steps)\nCorrected Euler\n\n\u22120.036869\n\u22120.036246\n\u22120.035408\n\u22120.036478\n\u22120.028685\u2217\n\n\u22120.094156\n\u22120.094196\n\u22120.093479\n\u22120.092860\n\u22120.094281\u2217\n\n177\n1430\n1441\n1866\n2321\n\n\u22120.035944\n\u22120.036277\n\u22120.036145\n\u22120.030118\u2217\n\n\u22120.092770\n\u22120.093178\n\u22120.093003\n\u22120.088988\u2217\n\n4285\n4327\n6385\n7144\n\nthe scheme given by Theorem 22 [with the moment-matching variables (36)],\n\"2nd order\" stands for the scheme given by Theorem 20 (with (36) and the\nsecond-order scheme for the CIR given by [2]), \"3rd order\" stands for the\nscheme given by Theorem 18 (with (37) and the third-order scheme for the\nCIR given by [2]) and \"Corrected Euler\" stands for the corrected Euler\u2013\n\n\f31\n\nSIMULATION SCHEMES FOR WISHART PROCESSES\n\nMaruyama scheme (44). For the exact scheme, we have considered both\nthe cases with one time-step T and N time-steps T /N . Of course, the first\ncase is sufficient to calculate an expectation that only depends on XT , but\nthe second case allows us to also compute pathwise expectations. For each\nmethod, we have given the value obtained and the time needed (in seconds)\non our computer (3000 MHz CPU).\nFirst, let us mention that the exact value is in each case in the confidence\ninterval except for the corrected Euler scheme. As one can expect, the exact\nmethod with one time-step is by far the quickest method to compute an\nexpectation that only depends on the final value. We put aside this case and\nfocus now on the generation of the whole path. We see from Table 1 that the\nsecond and the third-order schemes require roughly the same computation\ntime. As expected, the second-order scheme bis is much faster when it is\ndefined (i.e., when \u03b1 \u2265 d). On the contrary, the Euler scheme is much slower\nthan the second and third-order scheme. This is due to the cost of the matrix\ndiagonalization. Let us mention that the time required by the discretization\nschemes is proportional to N and do not depend on the parameters when the\ndimension is given. On the contrary, the time needed by the exact scheme\nmay change according to \u03b1 and can increase considerably when \u03b1 is close to\nd \u2212 1. To be more precise, the exact simulation method for the CIR given\nby Glasserman [11] uses a rejection sampling when the degree of freedom\nis lower than 1, which corresponds to the case d \u2212 1 \u2264 \u03b1 < d. The rejection\nrate can in fact be rather high, notably when the time-step gets smaller. For\nN = 30, d = 3 and \u03b1 = 2.2, the exact scheme is four times slower than the\nsecond-order scheme and 2.5 slower than the exact scheme with \u03b1 = 3.5.\nLet us draw a conclusion from this time comparison between the different schemes. Obviously, we recommend the use of the exact scheme when\ncalculating expectations that depend on one or few dates. Instead, when\ncalculating pathwise expectations of affine processes by Monte Carlo, we\nwould recommend the use of, in general, the second-order bis scheme when\n\u03b1 \u2265 d and the second order (or third order for Wishart processes) when\nd \u2212 1 \u2264 \u03b1 < d.\n4.2. Numerical results on the convergence. Now we want to illustrate\nthe theoretical results of convergence obtained in this paper for the different\nschemes. To do so, we have plotted for each scheme E[exp(\u2212 Tr(iv X\u0302tNN ))] in\nN\n\nfunction of the time step T /N . This expectation is calculated by a Monte\nCarlo method. As for the time comparison, we illustrate the convergence\nfor d = 3 in Figure 1 and d = 10 in Figure 2. Each time, we consider a case\nwhere \u03b1 \u2265 d and a case where d \u2212 1 \u2264 \u03b1 < d, which is in general tougher. In\nthese figures:\n\u2022 scheme 1 denotes the value obtained by the exact scheme with one timestep,\n\n\f32\n\nA. AHDIDA AND A. ALFONSI\n\nFig. 1. d = 3, 107 Monte Carlo samples, T = 10. The real value of E[exp(\u2212 Tr(iv X\u0302tNN ))]\nN\nin function of the time-step T /N . Left: v = 0.05Id and Wishart parameters x = 0.4Id ,\n\u03b1 = 4.5, a = Id and b = 0. Exact value: 0.054277. Right: v = 0.2Id + 0.04q and Wishart\nparameters x = 0.4Id + 0.2q, \u03b1 = 2.22, a = Id and b = \u22120.5Id . Exact value: 0.239836.\nHere, q is the matrix defined by: qi,j = 1i6=j . The width of each point represents the 95%\nconfidence interval.\n\n\u2022 scheme 2 stands for the second-order scheme given by Theorem 20,\n\u2022 scheme 3 denotes the third-order scheme given by Theorem 18,\n\u2022 scheme 4 is the corrected Euler scheme (44).\nHere, we have not plotted the convergence of the second-order (bis) scheme\ngiven by Theorem 22 because it would have given almost the same convergence as the other second-order scheme.\nAs expected, we observe in both Figures 1 and 2 convergences that fit\nour theoretical results. Namely, scheme 2 converges in O(1/N 2 ) and scheme\n3 converges faster in O(1/N 3 ). In some cases, such as Figure 2, scheme\n3 already matches the exact value from N = 2. Even though it seems to\nconverge at an O(1/N ) speed, the corrected Euler scheme is clearly not\ncompetitive with respect to the other schemes. In the tough case d \u2212 1 \u2264\n\u03b1 \u2264 d, the values obtained by the Euler scheme are in fact outside the figures,\nand we have put the corresponding values in Table 2.\nWe want to conclude this section by numerically testing the convergence\nof our schemes when we calculate pathwise expectations. Of course, our\ntheoretical results only bring on the weak error, but we may hope that\nour schemes converge also quickly when considering more intricate expectations. In Figure 3, we approximate E[max0\u2264t\u2264T Tr(Xtx )] with the different\nschemes by computing the \u221a\nmaximum on the time-grid. The convergence\nseems to be roughly in O(1/ N ) for all the schemes (see Figure 3, left), including the exact scheme. However, the main error seems to come from the\n\n\f33\n\nSIMULATION SCHEMES FOR WISHART PROCESSES\n\nFig. 2. d = 10, 107 Monte Carlo samples, T = 10. Left: imaginary value of\nE[exp(\u2212 Tr(iv X\u0302tNN ))] with v = 0.009Id in function of the time-step T /N . Wishart paramN\neters: x = 0.4Id , \u03b1 = 12.5, b = 0 and a = Id . Exact value: \u22120.361586. Right: real value of\nE[exp(\u2212 Tr(iv X\u0302tNN ))] with v = 0.009Id in function of T /N . Wishart parameters: x = 0.4Id ,\nN\n\u03b1 = 9.2, b = \u22120.5Id and a = Id . Exact value 0.572241. The width of each point represents\nthe 95% confidence interval.\n\napproximation of max0\u2264t\u2264T Tr(Xtx ) by max0\u2264k\u2264N Tr(XtxN ). In fact, we have\nk\n\nplotted in Figure 3 (right) the difference between E[max0\u2264k\u2264N Tr(X\u0302tNN )] and\nk\n\nE[max0\u2264k\u2264N Tr(XtxN )]. Then, we find convergences that are very similar to\nk\nthose obtained for the weak error: schemes 2 and 3 converge at a speed\nwhich is, respectively, compatible with O(1/N 2 ) and O(1/N 3 ). Scheme 4\nseems also to give an O(1/N ) convergence. It would be hasty to draw a\nglobal conclusion from this simple example. Nonetheless, the convergence\nof schemes 2 and 3 is really encouraging on pathwise expectations, if we\nput aside the problem of approximating a function of (Xtx , 0 \u2264 t \u2264 T ) by a\nfunction of (XtxN , 0 \u2264 k \u2264 N ).\nk\n\n4.3. An application in finance to the Gourieroux and Sufana model. In\nthis paragraph, we want to give a possible application of our schemes in\nfinance. More precisely, we will consider the model introduced by Gourieroux\nTable 2\nValues obtained by the Euler scheme in the numerical experiments of Figures 1 and 2\nN\nFigure 1, right\nFigure 2, right\n\n2\n\n4\n\n8\n\n10\n\n16\n\n30\n\n\u22120.000698\n0.494752\n\n0.000394\n\u22120.464121\n\n0.033193\n0.657041\n\n0.111991\n0.643042\n\n0.185128\n0.637585\n\n0.210201\n0.619553\n\n\f34\n\nA. AHDIDA AND A. ALFONSI\n\nFig. 3. d = 3, 107 Monte Carlo samples, T = 1. Wishart parameters x = 0.4Id + 0.2q\nwith qi,j = 1i6=j , \u03b1 = 2.2, b = 0 and a = Id . Left: E[max0\u2264k\u2264N Tr(X\u0302tNN )]. Right:\nk\n\nE[max0\u2264k\u2264N Tr(X\u0302tNN )] \u2212 E[max0\u2264k\u2264N Tr(XtxN )] in function of T /N . The width of each\nk\nk\npoint gives the precision up to two standard deviations.\n\nand Sufana [14]. This is a model for d risky assets St1 , . . . , Std . Let (Bt , t \u2265 0)\ndenote a standard Brownian motion on Rd that is independent from (Wt , t \u2265\n0). Then, we consider the following dynamics for the assets:\nZ t\nZ t\np\nl\nl\nl\n(45) t \u2265 0, 1 \u2264 l \u2264 d,\nSul ( Xu dBu )l ,\nSu du +\nSt = S0 + r\n0\n0\nRt \u221a\nT\nT\nT\nu + Xu b ) du+ 0 ( Xu dWu a+ a\n0 (\u03b1a a+ bX\u221a\n\n\u221a\nwhere Xt = X0 +\ndWuT Xu )\nis a Wishart\n\u221a process. Here, ( Xu dBu )l is simply the lth coordinates of\nthe vector Xu dBu . We can easily check that the instantaneous quadratic\ncovariation matrix between the log-prices of the assets is Xt . Last, r denotes\nthe instantaneous interest rate.\nTo simulate both assets and the Wishart matrix, we proceed as follows.\nWe observe that the generator of (St , Xt ) can be written as\nRt\n\nL = LS + LX\n\nwhere LS =\n\nd\nX\ni=1\n\nLX\n\nrsi \u2202si +\n\nd\n1 X\nsi sj xi,j \u2202si \u2202sj ,\n2\ni,j=1\n\nand\nis the generator of the Wishart process \u221a\nWISd (x, \u03b1, b, a). The operator LS is associated to the SDE dStl = rStl + Stl ( x dBt )l that can be solved\n\u221a\nexplicitly. We\u221ahave indeed Stl = S0l exp[(r \u2212 xl,l /2)t + ( xBt )l ]. Let us also\nremark that xBt = cBt if we have ccT = x; both are centered Gaussian\nLaw\n\nvectors with the same covariance matrix. In practice, it is more efficient to\nuse Stl = S0l exp[(r \u2212 xl,l /2)t + (cBt )l ] where c is computed\n\u221a with an extended\nCholesky decomposition of x rather than calculating x, which requires\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\nFig. 4.\n\n2,N +\nE[e\u2212rT (K \u2212 max (\u015ct1,N\nN , \u015ctN )) ] in function of T /N . d = 2, T = 1, K = 120,\nN\n\nS01\n\n35\n\nN\n\nS02\n\n=\n= 100 and r = 0.02. Wishart parameters: x = 0.04Id + 0.02q with qi,j = 1i6=j ,\na = 0.2Id , b = 0.5Id and \u03b1 = 4.5 (left), \u03b1 = 1.05 (right). The width of each point gives the\nprecision up to two standard deviations (106 Monte Carlo samples).\n\na diagonalization. Then we consider the scheme given by 2(a) in Proposition 15, where we take the second-order scheme for WISd (x, \u03b1, b, a) and the\nexact scheme for LS . This construction is known to preserve the second-order\nconvergence. To be consistent with Section 4.2, this scheme will be denoted\nby scheme 2 in this paragraph. To compare this scheme with a more basic\none, we consider the Euler\u2013Maruyama scheme defined by (44) and\nl\n\u015ctl,N\nN = S0 ,\n0\n\n\u015ctl,N\nN\ni+1\n\n=\n\n\u015ctl,N\nN (1 + rT /N\ni\n\nr\n+ ( (X\u0302tNN )+ (BtN \u2212 BtN ))l ),\ni\n\ni+1\n\ni\n\n0 \u2264 i \u2264 N \u2212 1.\n\nIt is denoted by scheme 4 as in Section 4.2.\nWe have plotted in Figure 4 the price of a put option on the maximum\nof two risky assets (d = 2). The Gourieroux and Sufana model is an affine\nmodel, and the characteristic function of St is explicitly known (see [14]).\nThus, it is possible to adapt the method proposed by Carr and Madan [6] and\nto calculate by numerical integration (which is possible for small dimensions)\nthe value of this put option. We have given in Figure 4 the exact value\nobtained by this method. As one might have guessed, we observe a quadratic\nconvergence for scheme 2 and a linear convergence for scheme 4. The benefit\nof using scheme 2 is clear since it already fits with the exact value from\nN = 5 in both cases; its convergence is really satisfactory.\n5. Conclusion and prospects. Let us draw a brief summary of this paper.\nThanks to a remarkable splitting of the infinitesimal generator of Wishart\nprocesses, we have been able to sample exactly any Wishart distribution.\n\n\f36\n\nA. AHDIDA AND A. ALFONSI\n\nWe have also proposed a third-order scheme for Wishart processes and a\nsecond-order scheme for general affine diffusions. We have confirmed these\nrates of convergence with numerical tests and analyzed the time complexity\nof each method. It comes out that we recommend to use the exact scheme\nto compute expectations that depend on one (or few) times. To calculate\npathwise expectations, we instead recommend generally to use discretization\nschemes. More precisely, the second-order scheme given by Theorem 22 has\nto be preferred when \u03b1 \u2265 d. Otherwise, we recommend to use the thirdorder scheme given by Theorem 18 for Wishart processes or the second-order\nscheme given by Theorem 20 for general affine diffusions.\nLet us give now some prospects of this work. As a possible continuation\nof this paper, it is natural to study how it is possible to extend our schemes\nto affine diffusions on positive semidefinite matrices that include jumps (see\nCuchiero et al. [7]). From a modeling point of view, we believe that Wishart\nprocesses could be used in a wide range of applications. In fact, they can\nbe used as soon as one has to model dependence dynamics. Thus, we hope\nthat the possibility of sampling such processes will stimulate different kinds\nof dependence models.\nAPPENDIX A: THE EXTENDED CHOLESKY DECOMPOSITION\nLemma 23. Let q \u2208 Sd+ (R) be a matrix with rank r. Then there is a\npermutation matrix p, an invertible lower triangular matrix cr \u2208 Gr (R) and\nkr \u2208 Md\u2212r\u00d7r (R) such that\n\u0012\n\u0013\ncr 0\nT\nT\npqp = cc ,\nc=\n.\nkr 0\n\nThe triplet (cr , kr , p) is called an extended Cholesky decomposition of q. Be0\n) \u2208 Gd (R), and we have\nsides, c\u0303 = ( kcrr Id\u2212r\nq = (c\u0303T p)T Idr c\u0303T p.\n\nThe proof and a numerical procedure to get such a decomposition can be\nfound in Golub and Van Loan ([13], Algorithm 4.2.4). When r = d, we can\ntake p = Id , and cr is the usual Cholesky decomposition.\nAPPENDIX B: PROOFS OF SECTION 1\nB.1. Proof of Proposition 4. We will need in the proof the following\nbasic lemma.\nLemma 24. Let b, c \u2208 Sd (R). If either b \u2208 Sd+ (R) or c \u2208 Sd+ (R), then\nId + ibc is invertible. In particular, if b \u2208 Sd+,\u2217 (R), b + ic is invertible.\nProof. Let v \u2208 Sd (R) such that \u2200s \u2208 [0, t], Id \u2212 2qs v \u2208 Gd (R). As it is\nusual for affine diffusions, the Laplace transform can be formulated with\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n37\n\nODE solutions. Namely, we will show that E[exp(Tr(vXtx ))] = exp[\u03c6(t, v) +\nTr(\u03c8(t, v)x)], where \u03c8 and \u03c6 solve the following ODEs (see, e.g., Cuchiero\net al. [7]):\n\u2202t \u03c8(t, v) = \u03c8(t, v)b + bT \u03c8(t, v) + 2\u03c8(t, v)aT a\u03c8(t, v);\n\u2202t \u03c6(t, v) = \u03b1 Tr(\u03c8(t, v));\n\n\u03c8(0, v) = v,\n\n\u03c6(0, v) = 0.\n\nThe function \u03c8 solves an usual matrix Riccati ODE. As shown by Levin [20],\n\u03c8 can be obtained explicitly by the mean of an exponential matrix, and we\nget\n\u03c8(t, v) = exp(tbT )(Id \u2212 2vqt )\u22121 v exp(tb),\n\nprovided that Id \u2212 2qs v is invertible for s \u2208 [0, t], which holds by assumption.\nTherefore we get, for x \u2208 Sd (R),\nTr(\u03c8(t, v)x) = Tr((Id \u2212 2vqt )\u22121 v exp(tb)x exp(tbT ))\n\n= Tr(v(Id \u2212 2qt v)\u22121 exp(tb)x exp(tbT )),\n\nsince v(Id \u2212 2qt v)\u22121 = (Id \u2212 2vqt )\u22121 v. As explained by Grasselli and Tebaldi\n([15], Section 4.2), \u03c6 can also be calculated explicitly by the mean of the\nexponential matrix above, and we get\n\u03b1\n\u03c6(t, v) = \u2212 Tr(log[(Id \u2212 2vqt ) exp(tbT )] \u2212 t Tr(b)).\n2\nBy using that exp(Tr(log(A))) = det(A) for A \u2208 Gd (R), we deduce then that\n\u0012\n\u0013\n\u03b1\nexp(\u03c6(t, v)) = exp\nt Tr(b) (det{(Id \u2212 2vqt )} det{exp(tbT )})\u2212\u03b1/2\n2\n=\n\n1\n.\ndet(Id \u2212 2qt v)\u03b1/2\n\nNow it remains to show that (10) indeed holds. By It\u00f4 calculus, we get\nthat for s \u2208 (0, t),\nd exp[\u03c6(t \u2212 s, v) + Tr(\u03c8(t \u2212 s, v)Xsx )]\n\n(46)\n\n= exp[\u03c6(t \u2212 s, v) + Tr(\u03c8(t \u2212 s, v)Xsx )]\np\np\n\u00d7 Tr[\u03c8(t \u2212 s, v)( Xsx dWs a + aT dWsT Xsx )].\n\nThus, exp[\u03c6(t \u2212 s, v) + Tr(\u03c8(t \u2212 s, v)Xsx )] is a positive local martingale and\ntherefore a supermartingale, which gives that E[exp(Tr(vXtx ))] \u2264 exp[\u03c6(t, v)+\nTr(\u03c8(t, v)x)] < \u221e, that is, Db,a;t \u2282 D\u0303x,\u03b1,b,a;t , where\nDb,a;t := {v \u2208 Sd (R), \u2200s \u2208 [0, t], Id \u2212 2qs v \u2208 Gd (R)}\n\nand\nD\u0303x,\u03b1,b,a;t := {v \u2208 Sd (R), E[exp(Tr(vXtx ))] < \u221e}.\n\n\f38\n\nA. AHDIDA AND A. ALFONSI\n\nOn the other hand, when \u2212v \u2208 Sd+,\u2217 (R), we can check that exp[\u03c6(t \u2212\u221a\ns, v) +\nx )] \u2264 1 by observing that det(I \u2212 2q v) = det(I + 2 \u2212v \u00d7\nTr(\u03c8(t\n\u2212\ns,\nv)X\nt\nd\ns\n\u221a\n\u221ad\n\u22121 exp(tb)x exp(tbT )) = \u2212 Tr( \u2212v(I + 2 \u00d7\nq\u221at \u2212v)\u221a\u2265 1 and\nTr(v(I\n\u2212\n2q\nv)\nt\nd\nd\n\u221a\n\u2212vqt \u2212v)\u22121 \u2212v exp(tb)x exp(tbT )) \u2264 0. In that case, exp[\u03c6(t \u2212 s, v) +\nTr(\u03c8(t \u2212 s, v)Xsx )] is a martingale from (46), and (10) holds.\nLet us now observe that Db,a;t is convex. In fact, we have det(Id \u2212 2qs v) =\n\u221a \u221a\ndet(Id \u2212 2 qs v qs ), and therefore, Db,a;t = {v \u2208 Sd (R), \u2200s \u2208 [0, t], Id \u2212\n\u221a \u221a\n2 qs v qs \u2208 Sd+,\u2217 (R)} which is obviously convex. The Laplace transform v 7\u2192\nE[exp(Tr(vXtx ))] is an analytic function on Db,a;t (see, e.g., [9], Lemma 10.8).\nThe right-hand side of (10) is also analytic on Db,a;t and coincides with the\nLaplace transform when \u2212v \u2208 Sd+,\u2217 (R). Therefore, (10) holds for v \u2208 Db,a;t\nsince Db,a;t is convex. Now, we can extend to complex values of v. Indeed,\nthe right-hand side of (10) is well defined for v = vR + ivI with vR \u2208 Db,a;t ,\nthanks to Lemma 24. Since both-hand sides are analytic functions of v, (10)\nholds for v = vR + ivI .\nLast, we want to show that Db,a;t = D\u0303x,\u03b1,b,a;t . We first consider the case\nb = 0 and assume by a way of contradiction that there is v \u2208 D\u0303x,\u03b1,0,a;t \\ D0,a;t\nfor some x, \u03b1, a and t > 0. Let t\u0303 = min{s \u2208 [0, t], Id \u2212 2qs v \u2208\n/ Gd (R)} \u2208 (0, t].\nOn the one hand, we have v \u2208\n/ D0,a;t\u0303 and v \u2208 D0,a;s for s \u2208 [0, t\u0303). On the other\nhand, we have, by Jensen's inequality\ns \u2208 [0, t],\n\nexp(\u03b1(t \u2212 s) Tr(vaT a)) exp(Tr(vXsx )) \u2264 E[exp(Tr(vXtx ))|Fs ],\n\nwhich gives s \u2208 [0, t] 7\u2192 exp(\u2212\u03b1s Tr(vaT a))E[exp(Tr(vXsx ))] is nondecreasing\nand finite. Since (10) holds for s < t\u0303, we get that E[exp(Tr(vXt\u0303x ))] = +\u221e,\nwhich leads to a contradiction. Let us now consider the case b 6= 0. From\nProposition 6 (which is a consequence of the characteristic function obtained\nabove), we have\nv \u2208 D\u0303x,\u03b1,b,a;t\n\n\u21d0\u21d2\n\n\u03b8tT v\u03b8t \u2208 D0,Idn ;t\n\n\u21d0\u21d2\n\n\u2200s \u2208 [0, t]\n\ndet(Id \u2212 2(s/t)qt v) 6= 0.\n\nIn particular, D\u0303x,\u03b1,b,a;t is an open set. For v \u2208 Gd (R), we have det(Id \u2212\n2(s/t)qt v) 6= 0 \u21d0\u21d2 det(v \u22121 \u2212 2(s/t)qt ) 6= 0 [resp., det(Id \u2212 2qs v) 6= 0 \u21d0\u21d2\ndet(v \u22121 \u2212 2qs ) 6= 0]. Since sqt \u2264 s\u2032 qt (resp., qs \u2264 qs\u2032 ) for s \u2264 s\u2032 , we know from\nTheorem 8.1.5 in [13] that the (real) eigenvalues of v \u22121 \u2212 2(s/t)qt (resp.,\nv \u22121 \u2212 2qs ) are nonincreasing w.r.t. s. Since they are also continuous, and\nv \u22121 \u2212 2(s/t)qt = v \u22121 \u2212 2qs for s \u2208 {0, t}, we get that \u2200s \u2208 [0, t], det(v \u22121 \u2212\n2(s/t)qt ) 6= 0 \u21d0\u21d2 \u2200s \u2208 [0, t], det(v \u22121 \u2212 2qs ) 6= 0 and thus D\u0303x,\u03b1,b,a;t \u2229 Gd (R) =\nDb,a;t \u2229 Gd (R). Let v \u2208 D\u0303x,\u03b1,b,a;t . Since D\u0303x,\u03b1,b,a;t is an open set, there is \u03b5 > 0\nsuch that v \u00b1 \u03b5Id \u2208 D\u0303x,\u03b1,b,a;t \u2229 Gd (R). Since Db,a;t is convex, v = (v + \u03b5Id +\nv \u2212 \u03b5Id )/2 \u2208 Db,a;t . \u0003\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n39\n\nB.2. Proof of Proposition 5. Once u is given, the identity in law comes\ndirectly from (13). We now give a constructive proof of the existence of\nu, which takes back the arguments given by Golub and Van Loan ([13],\nTheorem 8.7.1). Nonetheless, we explain it entirely since it gives a practical\nway to get u.\nLet us consider \u1fb1 + aT a \u2208 Sd+ (R). From the extended Cholesky decomposition given in Lemma 23 there is a matrix v \u2208 Gd (R) such that v T \u1fb1v +\nv T aT av = Idr , where r = Rk(\u1fb1 + aT a). Since v T \u1fb1v \u2208 Sd+ (R), v T aT av \u2208 Sd+ (R)\nand z T Idr z = 0 for z \u2208 Rd such that z1 = * * * = zr = 0, there are s1 , s2 \u2208 Sn+ (R)\nsuch that\n\u0012\n\u0013\n\u0012\n\u0013\ns1 0\ns2 0\nT\nT T\nv \u1fb1v =\nand v a av =\n.\n0 0\n0 0\nLet o2 be an orthogonal matrix such that oT2 s2 o2 is a diagonal matrix. We assume without loss of generality that only the first n elements of this diagonal\n0\nare positive: oT2 s2 o2 = diag(\u03b71 , . . . , \u03b7n , 0, . . . , 0). We set o = ( o02 Id\u2212r\n) and get\n\nIdr = oT v T \u1fb1vo + oT v T aT avo, which gives that oT v T \u1fb1vo is a diagonal matrix.\n\u221a\n\u221a\nThus, we get the desired result by taking u=diag( \u03b71 , . . . , \u03b7n , 1, . . . , 1)o\u22121 v \u22121 .\nAPPENDIX C: PROOFS OF SECTION 2\nC.1. Proof of Proposition 8. Let Xtx \u223c WISd (x, \u03b1, 0, Idn ; t). We will check\nthat for any polynomial function f of the matrix elements, we have E[f (Xtx )] =\n1,x\nXt\n\nE[f (Xtn,...\n\n)]. Let us consider a polynomial function f of degree m,\nX\nx \u2208 Sd (R),\nf (x) =\na\u03b3 x\u0304\u03b3 ,\n\u03b3\u2208Nd(d+1)/2 ,|\u03b3|\u2264m\n\nP\nQ\n\u03b3{i,j}\n. Since the operators\nwhere |\u03b3| = 1\u2264i\u2264j\u2264d |\u03b3{i,j} | and x\u0304\u03b3 = 1\u2264i\u2264j\u2264d x{i,j}\nare affine, it is easy to check that Lf (x) and Lei f (x) are also polynomial\nd\nfunctions of degree m. We set\nX\nkf kP =\n|a\u03b3 | and |L| =\nmax\nkLx\u0304\u03b3 kP ,\n\u03b3\u2208Nd(d+1)/2 ,|\u03b3|\u2264m\n\n\u03b3\u2208Nd(d+1)/2 ,|\u03b3|\u2264m\n\nP\nk k\nso that kLk f kP \u2264 |L|k kf kP for any k \u2208 N. Therefore, the series \u221e\nk=0 t L f (x)/\nk! converges absolutely. By using l + 1 times It\u00f4's formula, we get\nZ t\nl\nX\ntk k\n(t \u2212 s)l\nx\nE[f (Xt )] =\nL f (x) +\nE[Ll+1 f (Xsx )] ds.\nk!\nl!\n0\nk=0\n\nWishart processes have bounded moments since the drift and\ndiffusion coefficients have a sublinear growth. Thus, C =\n\n\f40\n\nA. AHDIDA AND A. ALFONSI\n\u03b3\n\nmax\u03b3\u2208Nd(d+1)/2 ,|\u03b3|\u2264m sups\u2208[0,t] E[|X\u0304sx |] < \u221e and we obtain that\nRt\nl\nl+1 f (X x )] ds| \u2264 Ckf k (t|L|)l+1 /(l + 1)! \u2192 0. Thus, we have\n| 0 (t\u2212s)\nP\ns\nl! E[L\nl\u2192+\u221e\nP\n\u221e\nE[f (Xtx )] = k=0 tk Lk f (x)/k! and similarly we get that\n1,x\nXt\n\nE[f (Xtn,...\n\n1,x\nXt\n\n)|Xtn\u22121,...\n\n+\u221e kn\n1,x\nX\nXt\nt\n).\nLkenn f (Xtn\u22121,...\nkn ! d\n\n]=\n\nkn =0\n\n\u03b3\n\nNow, we remark that C\u0303 = max\u03b3\u2208Nd(d+1)/2 ,|\u03b3|\u2264m sups\u2208[0,t] max(E[|X\u0304t1,x |], . . . ,\n1,x\u03b3\n\nXt\nE[|X\u0304tn,...\n\n|]) < \u221e by using once again that Wishart processes have bounded\n1,x\nXt\n\nmoments. Since E[|Lkenn f (Xtn\u22121,...\nd\n\n)|] \u2264 C\u0303kf kP |Lend |kn , we can switch the\n\nexpectation with the series and get (16). Then, since Lkenn f (x) are polynod\nmial function of degree m, we can iterate this argument and finally get (17),\nwhich gives the result.\n\nC.2. Proof of Theorem 9. The proof is divided into two parts. First, we\nprove that the SDE (26) has a unique strong solution which is given by\n(27) and is well defined on Sd+ (R). Second, we show that its infinitesimal\ngenerator is equal to the operator Le1 defined in (18).\nd\nFirst step. Let us assume that (Xtx )t\u22650 is a solution to (26). We use the\nmatrix decomposition of (xi,j )2\u2264i,j\u2264d given by (25) and set\n(Ut ){1,l+1} =\n\nr\nX\nx\n(c\u22121\nr )l,i (Xt ){1,i+1} ,\ni=1\n\nl \u2208 {l, . . . , r},\n\nr\nr\nX\nX\nx\n(Ut ){1,1} = (Xtx ){1,1} \u2212\n(c\u22121\nr )l,i (Xt ){1,i+1}\ni=1\n\nl=1\n\n= (Xtx ){1,1} \u2212\nWe get by using Lemma 25 that\n\uf8f6\n1 0\n0\n\uf8ed 0 cr\n0 \uf8f8\n0 kr Id\u2212r\u22121\n\uf8eb\nr\nX\n\nr\nX\n\n((Ut ){1,l+1} )2 .\n\nl=1\n\n\uf8eb\n\n2\n\n((Ut ){1,k+1} )\n\uf8ec (Ut ){1,1} +\nk=1\n\u00d7\uf8ec\n\uf8ed\n((Ut ){1,l+1} )1\u2264l\u2264r\n0\n\nT\n((Ut ){1,l+1} )1\u2264l\u2264r\n\nIr\n0\n\n\uf8f6\n\n0\uf8f7\n\n0\n0\n\n\uf8f7\n\uf8f8\n\n!2\n\n\f41\n\nSIMULATION SCHEMES FOR WISHART PROCESSES\n\n\uf8eb\n\n1 0\n\u00d7 \uf8ed 0 cTr\n0 0\n\uf8eb\n\n0\nkrT\nId\u2212r\u22121\n\n\uf8ec (Ut ){1,1} +\n\n\uf8ec\n=\uf8ec\n\uf8ed\n\n\uf8f6\n\uf8f8\n\nr\nX\n2\n((Ut ){1,k+1} )\n\nT\n\n((Ut ){1,l+1} )1\u2264l\u2264r cTr\n\nk=1\n\ncr cTr\nkr cTr\n\ncr ((Ut ){1,l+1} )1\u2264l\u2264r\n\nkr ((Ut ){1,l+1} )1\u2264l\u2264r\n\nT\n\ncr krT\n0\n\n= Xtx .\nSince\n\n\uf8eb\n\nis invertible,\n\nXtx\nd\n\n\u2200z \u2208 R\n\n(47)\n\n\u2208 Sd+ (R)\n\n\uf8eb\n\n1 0\n\uf8ed 0 cr\n0 kr\n\n0\n0\nId\u2212r\u22121\n\nif, and only if\n\nr\nX\n2\n(U\n)\n+\n((Ut ){1,i+1} )\nt\n{1,1}\n\uf8ec\n\nzT \uf8ec\n\uf8ed\n\n\uf8f6\n\uf8f8\n\n((Ut ){1,l} )2\u2264l\u2264r+1\n\ni=1\n\n((Ut ){l,1} )2\u2264l\u2264r+1\n0\n\n= z12 (Ut ){1,1}\n\nIr\n0\n\nr\nX\n(zi+1 + (Ut ){1,i+1} z1 )2\n+\n\n\uf8f6\n\n0\uf8f7\n0\n0\n\n\uf8f7z\n\uf8f8\n\ni=1\n\n\u22650\n\n\u21d0\u21d2\n\n(Ut ){1,1} \u2265 0.\n\nIn particular, we get that (U0 ){1,1} = u{1,1} \u2265 0 since x \u2208 Sd+ (R). Now, by\nIt\u00f4 calculus, we get from (26) that\nr\nr X\nX\nk+1\n(c\u22121\n= dZtl+1\nd(Ut ){1,l+1} =\nr )l,i (cr )i,k dZt\ni=1 k=1\n\nand\n\nq\nd(Ut ){1,1} = (\u03b1 \u2212 r) dt + 2 (Ut ){1,1} dWt1\n\nr\nr X\nX\nl+1\n(c\u22121\n+2\nr )l,k (Xt ){1,k+1} dWt\nl=1 k=1\n\n\u2212\n\nr\nX\n\n2((Ut ){1,l+1} ) dWtl+1\n\nl=1\n\nq\n= (\u03b1 \u2212 r) dt + 2 (Ut ){1,1} dWt1 .\n\n\uf8f6\n\n((Ut ){1,l+1} )1\u2264l\u2264r krT \uf8f7\n\n\uf8f7\n\uf8f7\n\uf8f8\n\n\f42\n\nA. AHDIDA AND A. ALFONSI\n\nThus, the solution (Xtx )t\u22650 is necessarily the one given by (27) [pathwise\nuniqueness holds for ((Utu ){1,l} )1\u2264l\u2264r+1 , and especially for the CIR diffusion\n(Utu ){1,1} since \u03b1 \u2265 d \u2212 1 \u2265 r]. Reciprocally, it is easy to check by It\u00f4 calculus\nthat (27) solves (26).\nSecond step. Now we want to show that Le1 is the infinitesimal operator\nd\nassociated to the process (Xtx )t\u22650 . It is sufficient to compare the drift and\nthe quadratic covariation of the process Xtx with Le1 . Since the drift part of\nd\n(Xtx )t\u22650 clearly corresponds to the first order of Le1 , we study directly the\nd\nquadratic part. From (26), we have for i, j \u2208 {2, . . . , d}2 ,\ndh(Xtx ){1,1} , (Xtx ){1,1} i\n\n\" r\n#2\nr\nX\nX\nx\n= 4 (Xtx ){1,1} \u2212\n(c\u22121\nr )k,l (Xt ){1,l+1}\nk=1 l=1\n\n\" r\n#2 !\nr\nX\nX\n\u22121\nx\n+\n(cr )k,l (Xt ){1,l+1}\n\nk=1 l=1\nx\n= 4(Xt ){1,1} dt,\ndh(Xtx ){1,i} , (Xtx ){1,j} i\n\n=\n\nr\nX\n(cr )i\u22121,k (cr )j\u22121,k dt = (ccT )i\u22121,j\u22121 dt\n\nk=1\n= (Xtx ){i,j} dt,\ndh(Xtx ){1,1} , (Xtx ){1,i} i\n\n=2\n\nr\nr X\nX\n\nx\n(cr )i\u22121,k (c\u22121\nr )k,l (Xt ){1,l+1} dt\n\nk=1 l=1\n= 2(Xtx ){1,i} dt\n\nif i \u2264 r + 1,\n\ndh(Xtx ){1,1} , (Xtx ){1,i} i\n=2\n\nr X\nr\nX\nx\n(kr )i\u22121\u2212r,k (c\u22121\nr )k,l (Xt ){1,l+1} dt\nk=1 l=1\n\n=2\n\nr\nX\nx\n(kr c\u22121\nr )i\u22121\u2212r,l (Xt ){1,l+1} dt\n\nl=1\n= 2(Xtx ){1,i} dt\n\nif i > r + 1\n\nby Lemma 25.\n\nThus, we deduce that Le1 is the infinitesimal generator of (Xtx )t\u22650 .\nd\n\n\f43\n\nSIMULATION SCHEMES FOR WISHART PROCESSES\n\nLemma 25. Let y \u2208 Sd+ (R). We set r = Rk((yi,j )2\u2264i,j\u2264d ), y1r = (y1,i+1 )1\u2264i\u2264r\nand y1r,d = (y1,i+1 )r+1\u2264i\u2264d . We assume that there are an invertible matrix cr\nand a matrix kr defined on Md\u2212r\u22121\u00d7r (R), such that\n\u0013\n\u0012\n\u0013\u0012 T\ncr 0\ncr krT\n.\n(yi,j )2\u2264i,j\u2264d =\n0\n0\nkr 0\nr\nThen, we have y1r,d = kr c\u22121\nr y1 .\n\nProof. We set\n\uf8f6\n\uf8eb\n0\n1 0\np = \uf8ed 0 cr\n0 \uf8f8\n0 kr Id\u2212r\u22121\n\nand have\n\nSince the matrix\n\n\uf8eb\n\n0\n1\np\u22121 = \uf8ed 0 c\u22121\nr\n0 \u2212kr c\u22121\nr\n\n\uf8eb\n\nr T\ny1,1\n(c\u22121\nr y1 )\n\u22121\n\u22121 T\nr\n\u22121\np y(p ) = \uf8ed\ncr y1\nIr\nr,d\nr\n\u22121\n0\ny1 \u2212 kr cr y1\n\n0\n0\nId\u2212r\u22121\n\n\uf8f6\n\n\uf8f8.\n\n\uf8f6\nr T\n(y1r,d \u2212 kr c\u22121\nr y1 )\n\uf8f8\n0\n0\n\nr\nis positive semidefinite, we necessarily have y1r,d \u2212 kr c\u22121\nr y1 = 0. \u0003\n\nAPPENDIX D: PROOFS OF SECTION 3\nD.1. Proof of Proposition 14.\nLemma 26.\n\nLet (Xtx )t\u22650 \u223c WISd (x, \u03b1, b, a) and v = vR + ivI such that\nLaw\n\nvR \u2208 Db,a;t and vI \u2208 Sd (R). We denote by \u03c6(t, \u03b1, x, v) the Laplace transform\nof Xtx given by (10), the other parameters a, b being fixed. Then, the derivative w.r.t. x{k,l} satisfies the equality\n{k,l}\n\n\u2202{k,l} \u03c6(t, \u03b1, x, v) = \u03c6(t, \u03b1 + 2, x, v)pt\n{k,l}\n\nwhere pt\ndefined by\n\n(v),\n\nis a polynomial function of the matrix elements of degree d\n{k,l}\n\npt\n\nl,k\nT\n(v) = Tr[v adj(Id \u2212 2qt v)mt (ek,l\nd + 1k6=l ed )mt ]\nX\n\u03b3,{k,l} \u03b3\n=:\nat\nv\u0304 ,\n\u03b3\u2208Nd(d+1)/2 ,|\u03b3|\u2264d\n\nwhere\nv\u0304 \u03b3 =\n\nY\n\n{i,j}\n\n\u03b3\n\n{i,j}\n.\nv{i,j}\n\n\f44\n\nA. AHDIDA AND A. ALFONSI\n\nMoreover, its coefficients are bounded uniformly in time,\n\u2203Kt > 0, \u2200s \u2208 [0, t]\n\nmax\n\n(|a\u03b3,{k,l}\n|) \u2264 Kt .\ns\n\n\u03b3\u2208Nd(d+1)/2 ,|\u03b3|\u2264d\n\nProof. We get from (10)\n\u2202{k,l} \u03c6(t, \u03b1, x, v) =\n\nl,k\nT\nTr[v adj(Id \u2212 2qt v)mt (ek,l\nd + 1k6=l ed )mt ]\ndet(Id \u2212 2qt v)\n\n\u00d7\n\nexp(Tr[v(Id \u2212 2qt v)\u22121 mt xmTt ])\ndet(Id \u2212 2qt v)\u03b1/2\n\nl,k\nT\n= \u03c6(t, \u03b1 + 2, x, v) Tr[v adj(Id \u2212 2qt v)mt (ek,l\nd + 1k6=l ed )mt ].\n\nSince s 7\u2192 kms k and s 7\u2192 kqs k are continuous functions on [0, t], we obtain\nthe bounds on the polynomial coefficients. \u0003\n\u221e (S (R)). First, let us observe\nProof of Proposition 14. Let f \u2208 Cpol\nd\n\u221e (S (R)),\nthat (35) is obvious when l = |n| = 0. Since we have \u2200l \u2208 N, Ll f \u2208 Cpol\nd\nand \u2202tl \u0169(t, x) = E(Ll f (Xtx )), it is sufficient to prove (35) only for the derivatives w.r.t. x.\nWe first focus on the case |n| = 1 and want to show that \u2202{k,l} \u0169(t, x)\nsatisfies (35). The sketch of this proof is to write f as the inverse Fourier\ntransform of its Fourier transform and then use Lemma 26. Unfortunately,\nf has not a priori the required integrability to do that, and we have to\nintroduce an auxiliary function f\u03c1 .\nDefinition of the new function f\u03c1 . Since Db,a;T given by (9) is an open\nset and 0 \u2208 Db,a;T , there is \u03c1 > 0 such that \u03c1Id \u2208 Db,a;T . Let \u03bc : R \u2192 R be\n1\nthe function such that \u03bc(x) = 0 if x \u2264 \u22121 or x \u2265 0, \u03bc(x) = exp( x(x+1)\n) if\n\u221e\n\u22121 < x < 0. We have \u03bc \u2208 C (R).\nThenRwe consider he cutoff function \u03b6 : R \u2192 R \u2208 C \u221e (R) defined as \u2200x \u2208 R,\n\n\u03b6(x) =\n\nx\n\u03bc(y) dy\n\u2212\u221e\nR\nR\n\n\u03bc(y) dy\n\n. It is nondecreasing, such that 0 \u2264 \u03b6(x) \u2264 1, \u03b6(x) = 0 if\n\n\u221e (R) since all its\nx \u2264 \u22121 and \u03b6(x) = 1 if x \u2265 0. Besides, we have \u03b6 \u2208 Cpol\n\u221e (S (R)) as\nderivatives have a compact support. Now, we define a \u03b8 \u2208 Cpol\nd\n\n\u03b8 : Sd (R) \u2192 R,\n\nx 7\u2192\n\nd\nY\ni=1\n\n\u03b6(x{i,i} )\n\nY\ni6=j\n\n\u03b6(x{j,j} x{i,i} \u2212 x2{i,j} ).\n\nIt is important to notice that 0 \u2264 \u03b8 \u2264 1, \u03b8(x) = 1 if x \u2208 Sd+ (R) and \u03b8(x) = 0\nif there is i \u2208 {1, . . . , d} such that x{i,i} < \u22121 or i < j \u2208 {1, . . . , d} such that\n\u221e (S (R)), there are\nx2{i,j} > 1 + x{i,i} x{i,i} . Let \u03b3 \u2208 Nd(d\u22121)/2 . Since f \u2208 Cpol\nd\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n45\n\nconstants K, E > 0 and K \u2032 , E \u2032 > 0 such that, \u2200x \u2208 Sd (R)\n|\u2202 \u03b3 (\u03b8f )(x)| \u2264 K(1 + kxkE )\n\nd\nY\n(1{|x{i,i} |>\u22121} )\ni=1\n\nY\n\n1\u2264i<j\u2264d\n\nE1\n\n\u2032\n\n(1{x2\n\n{i,j}\n\n\u22641+x{i,i} x{j,j} } )\n\n\u2264 K (1 + k(x{i,i} )1\u2264i\u2264d k )\nd\nY\n\u00d7 (1{|x{i,i} |>\u22121} )\ni=1\n\nY\n\n(1{x2\n\n1\u2264i<j\u2264d\n\n{i,j}\n\n\u22641+x{i,i} x{j,j} } ).\n\nHere, the upper bound only involves the diagonal coefficients. We define\nx \u2208 Sd (R),\n\nf\u03c1 (x) := \u03b8(x)f (x) exp(\u2212 Tr(\u03c1x))\n\nand obtain from the last inequality that f\u03c1 belongs to the Schwartz space\nof rapidly decreasing functions since \u03c1 > 0. Thus, its Fourier transform also\nbelongs to the Schwartz space and we have\nZ\n1\nf\u03c1 (x) =\nexp(\u2212 Tr(ivx))F(f\u03c1 )(v) dv,\n(2\u03c0)d(d+1)/2 Rd(d+1)/2\nwhere\nZ\nexp(Tr(ivx))f\u03c1 (x) dx\nF(f\u03c1 )(v) =\nRd(d+1)/2\nf\u03c1 , F(f\u03c1 ) \u2208 L1 (Sd (R)) \u2229 L\u221e (Sd (R)).\n\nand, in particular,\nA new representation of \u0169(t, x). We have f (x) = exp(\u03c1 Tr(x))f\u03c1 (x) for\nx \u2208 Sd+ (R), and therefore\n\u0169(t, x) = E[exp(Tr(\u03c1Xtx ))f\u03c1 (Xtx )]\n\u0015\n\u0014Z\n1\nx\n=\nexp(Tr[(\u2212iv + \u03c1Id )Xt ])F(f\u03c1 )(v) dv\nE\n(2\u03c0)d(d+1)/2\nRd(d+1)/2\nZ\n1\nE[exp(Tr[(\u2212iv + \u03c1Id )Xtx ])]F(f\u03c1 )(v) dv.\n=\n(2\u03c0)d(d+1)/2 Rd(d+1)/2\nThe last equality holds since\nZ\n|E[exp(Tr[(\u2212iv + \u03c1Id )Xtx ])]||F(f\u03c1 )(v)| dv\nRd(d+1)/2\n\n\u2264 \u03c6(t, \u03b1, x, \u03c1Id )kF(f\u03c1 )k1 < \u221e.\n\nHere we have used that \u03c1Id \u2208 Db,a;T to get \u03c6(t, \u03b1, x, \u03c1Id ) < \u221e.\nDerivation with respect to x{k,l} , k, l \u2208 {1, . . . , d}. From Lemma 26, we\nhave by Lebesgue's theorem\nZ\n1\n\u03c6(t, \u03b1 + 2, x, \u2212iv + \u03c1Id )\n\u2202{k,l} \u0169(t, x) =\n(2\u03c0)d(d+1)/2 Rd(d+1)/2\n(48)\n{k,l}\n\u00d7 pt (\u03c1Id \u2212 iv)F(f\u03c1 )(v) dv\n\n\f46\n\nA. AHDIDA AND A. ALFONSI\n{k,l}\n\nx\nsince |\u2202{k,l}\n\u03c6(t, \u03b1, x, \u2212iv + \u03c1Id )F(f\u03c1 )(v)| \u2264 |\u03c6(t, \u03b1 + 2, x, \u03c1Id )||pt\n{k,l}\npt (\u03c1Id\n\n(\u03c1Id \u2212\n\niv)F(f\u03c1 )(v)| and\n\u2212 iv)F(f\u03c1 )(v) is a rapidly\ndecreasing function.\nR\nLet 1 \u2264 k\u2032 , l\u2032 \u2264 d. An integration by part gives R (\u03c1Id \u2212iv){k\u2032 ,l\u2032 } exp(Tr[x(iv \u2212\nR\n1 \u2032 \u2032\n\u03c1Id )])\u03b8(x)f (x) dx{k\u2032 ,l\u2032 } = ( k 26=l +1k\u2032=l\u2032 ) R exp (Tr[x(iv \u2212 \u03c1Id )])\u2202{k\u2032 ,l\u2032 } (\u03b8(x) \u00d7\nf (x)) dx{k\u2032 ,l\u2032 } , and thus\n(\u03c1Id \u2212 iv){k\u2032 ,l\u2032 } F(exp[\u2212\u03c1 Tr(x)]\u03b8(x)f (x))(v)\n\u0012\n\u0013\n1k\u2032 6=l\u2032\n\u2032\n\u2032\n=\n+ 1k =l F(exp[\u2212\u03c1 Tr(x)]\u2202{k\u2032 ,l\u2032 } [\u03b8(x)f (x)])(v).\n2\nQ\n1 \u2032 \u2032\nWe set \u03c6(\u03b3) = 1\u2264k\u2032 \u2264l\u2032 \u2264d ( k 26=l + 1k\u2032 =l\u2032 )\u03b3{k\u2032 ,l\u2032 } for \u03b3 \u2208 Nd(d+1)/2 and get by\niterating the argument that\nY\n\u03b3 \u2032 \u2032\n(\u03c1Id \u2212 iv){k{k\u2032 ,l,l\u2032 }} F(f\u03c1 )(v)\n1\u2264k \u2032 \u2264l\u2032 \u2264d\n\n(49)\n\n= \u03c6(\u03b3)F(exp[\u2212\u03c1 Tr(x)]\u2202\u03b3 (\u03b8 \u00d7 f )(x))(v).\nP\n\u03b3{k\u2032 ,l\u2032 }\n\u03b3,{k,l} Q\n{k,l}\nSince pt (\u03c1Id \u2212 iv) = \u03b3\u2208Nd(d+1)/2 ,|\u03b3|\u2264d at\n1\u2264k \u2032 \u2264l\u2032 \u2264d (\u03c1Id \u2212 iv){k \u2032 ,l\u2032 } ,\nwe get from (48) and (49)\nX \u03b3,{k,l}\n\u03c6(\u03b3)E(\u2202\u03b3 (f \u00d7 \u03b8)(Ytx ))\n\u2202{k,l} u(t, x) =\nat\n|\u03b3|\u2264d\n\n(50)\n\n=\n\nX\n\n\u03b3,{k,l}\n\nat\n\n\u03c6(\u03b3)E(\u2202\u03b3 f (Ytx )),\n\n|\u03b3|\u2264d\n\nwhere\n\n(Ytx )t\u22650\n\n\u223c WISd (x, \u03b1 + 2, b, a). Here we have used that \u2202\u03b3 (\u03b8 \u00d7 f )(y) =\n\nLaw\n\u2208 Sd+ (R).\n\n\u03b3,{k,l}\n\n\u2202\u03b3 f (y) for y\nFrom Lemma 26 (at\n)\u03b3\u2208Nd(d+1)/2 ,|\u03b3|\u2264d is bounded\n\u221e (S (R)). Thanks to\nfor t \u2208 [0, T ], and we get (35) when |n| = 1 since \u2202\u03b3 f \u2208 Cpol\nd\n(50), a derivative of order |n|, can be seen as a (bounded) linear combination\nof derivatives of order |n| \u2212 1, and we easily get (35) by an induction on |n|.\nIt remains to check that we have indeed \u2202t \u0169(t, x) = Lu(t, x). Let t, h > 0.\nBy the Markov property, we have \u0169(t + h, x) = E[\u0169(t, Xhx )]. From (35) and\nIt\u00f4's formula, we get [\u0169(t + h, x) \u2212 u(t, x)]/h \u2192 Lu(t, x). \u0003\nh\u21920+\n\nLemma 27. Let \u03b1, x \u2208 Sd+ (R), B \u2208 L(Sd+ (R)) that satisfies (4), and x(t)\nbe the solution of the ODE\nZ t\n(51)\n(\u03b1 + B(x(s))) ds.\nx(t) = x +\n0\n\nThen we have\n\nx(t) \u2208 Sd+ (R)\n\nfor t \u2265 0.\n\n\f47\n\nSIMULATION SCHEMES FOR WISHART PROCESSES\n\nProof. The ODE (51) is affine and has unique solution on Sd+ (R) which\nis given by\nZ t\n(52)\nt \u2265 0,\nx(t) = exp(tB)(x) +\nexp(sB)(\u03b1) ds,\n0\n\nwhere \u2200t \u2208 R+ , \u2200x \u2208 Sd (R), exp(tB)(x) =\n\nP\u221e\n\nk=0\n\ntk B k (x)\n,\nk!\n\nB k (x) = B\n* * \u25e6 B}(x)\n| \u25e6 *{z\nk times\n\nsuch that B 0 (x) = x.\nWe first assume that \u03b1, x \u2208 Sd+,\u2217 (R) and consider \u03c4 = inf{t \u2265 0, x(t) \u2208\n/\nSd+ (R)}, with the convention inf \u2205 = +\u221e. We have \u03c4 > 0. Let us assume\nby a way of contradiction that \u03c4 < \u221e. Then x(\u03c4 ) cannot be invertible and\nthere is y \u2208 Sd+ (R) such that y 6= 0 and Tr(yx(\u03c4 )) = 0. From (52) and (4),\nwe get\nTr(x\u2032 (\u03c4 )y) = Tr([B(x(\u03c4 )) + \u03b1]y) > 0,\n\nsince \u03b1 is positive definite. Therefore, there is \u01eb \u2208 (0, \u03c4 ) such that Tr(yx(\u03c4 \u2212\n\u01eb)) < 0. Let us now recall that z \u2208 Sd+ (R) \u21d0\u21d2 \u2200y \u2208 Sd+ (R), Tr(yz) \u2265 0. Thus,\nx(\u03c4 \u2212 \u01eb) \u2208\n/ Sd+ (R), which contradicts the definition of \u03c4 .\nIn the general case \u03b1, x \u2208 Sd+ (R), we observe that the solution (52) is\ncontinuous w.r.t. x and \u03b1, and thus \u2200t \u2265 0, x(t) \u2208 Sd+ (R) since Sd+ (R) is a\nclosed set. \u0003\nD.2. Proof of Proposition 17. First, let us check that \u03b8t \u2208 Gd (R) is well\ndefined, such that qt /t = \u03b8t Idn \u03b8tT and satisfies\n\u2203K, \u03b7 > 0, \u2200t \u2208 (0, \u03b7)\n\n(53)\n\nmax(k\u03b8t k, k\u03b8t k\u22121 ) \u2264 K.\n\nWhen n = d, qt /t is definite positive as a convex combination of definite positive matrices and the usual Cholesky decomposition is well defined. Moreover, (53) holds since qt /t goes to aT a which is invertible when t \u2192 0+ . When\nn < d, weR have assumed, in addition, that b and aRT a commute. Therefore,\nt\nt\nqt = aT a( 0 exp(sb) exp(sbT ) ds/t). Since aT a and ( 0 exp(sb) exp(sbT ) ds/t)\nare positive semidefinite matrices that commute, we have\ns\ns\nZ\nZ\n1 t\n1 t\nT\nT\nexp(sb) exp(sb ) ds a a\nexp(sb) exp(sbT ) ds.\nqt =\nt 0\nt 0\nRt\nOnce again, 1t 0 exp(sb) exp(sbT ) ds is definite positive as a convex combinaq R\nt\ntion of definite positive matrices and we get that \u03b8t = 1t 0 exp(sb) exp(sbT ) ds \u00d7\np\u22121 ( kcnn\n\n0\nId\u2212n )\n\n\u2208 Gd (R) satisfies qt /t = \u03b8t Idn \u03b8tT by Lemma 23. Similarly, (53)\nq R\nt\ncn\n0\n\u22121\nholds since p ( kn Id\u2212n ) does not depend on t and 1t 0 exp(sb) exp(sbT ) ds\ngoes to Id when t \u2192 0+ .\n\n\f48\n\nA. AHDIDA AND A. ALFONSI\n\n\u221e (S + (R)). Let X x \u223c WIS (x, \u03b1, b, a; t). Since the exact scheme\nLet f \u2208 Cpol\nd\nt\nd\nis a potential \u03bdth-order scheme, there are constants C, E, \u03b7 > 0 depending\nonly on a good sequence of f such that\n\n(54)\n\nE[f (Xtx )] \u2212\n\n\u2200t \u2208 (0, \u03b7)\n\n\u03bd\nX\ntk\nk=0\n\nk!\n\nLk f (x) \u2264 Ct\u03bd+1 (1 + kxkE ).\n\nOn the other hand, we have from Proposition 6,\n(55)\n\nE[f (X\u0302tx )] \u2212 E[f (Xtx )]\n\u22121 T\n\u03b8t\u22121 mt xmT\n\u03b8 \u22121 m xmT (\u03b8 \u22121 )T T\nt (\u03b8t )\n\u03b8tT )] \u2212 E[f (\u03b8t Yt t t t t\n\u03b8t )].\n\n= E[f (\u03b8t \u0176t\n\n\u221e (S + (R)). By the chain rule, we\nLet us introduce f\u03b8t (y) := f (\u03b8t y\u03b8tT ) \u2208 Cpol\nd\n\nj,i T\nT\nhave \u2202{i,j} f\u03b8t (y) = Tr[\u03b8t (ei,j\nd + 1i6=j ed )\u03b8t \u2202f (\u03b8t y\u03b8t )], where (\u2202f (x))k,l =\ni,j\n(1k=l + 21 1k6=l )\u2202{k,l} f (x) and ed = (1k=i,l=j )1\u2264k,l\u2264d . From (53), we see that\nthere is a good sequence (C\u03b3 , e\u03b3 )\u03b3\u2208Nd(d+1)/2 that can be obtained from a good\nsequence of f such that\n\n\u2200t \u2208 (0, \u03b7), \u2200y \u2208 Sd+ (R)\n\n|\u2202\u03b3 f\u03b8t (y)| \u2264 C\u03b3 (1 + kyke\u03b3 ).\n\nTherefore, we get that there are constants still denoted by C, E, \u03b7 > 0 such\nthat\n\u2200t \u2208 (0, \u03b7)\n(56)\n\n\u22121 T\n\u03b8t\u22121 mt xmT\n\u03b8 \u22121 m xmT (\u03b8 \u22121 )T T\nt (\u03b8t )\n\u03b8tT )] \u2212 E[f (\u03b8t Yt t t t t\n\u03b8t )]|\n\u22121\nT \u22121 T E\n\u03bd+1\n\u2264 Ct (1 + k\u03b8t mt xmt (\u03b8t ) k ).\n\n|E[f (\u03b8t \u0176t\n\nFrom (53), we get that there is a constant K \u2032 > 0 such that k\u03b8t\u22121 mt x \u00d7\nmTt (\u03b8t\u22121 )T kE \u2264 K \u2032 kxkE for t \u2208 (0, \u03b7). Thus, we get the result by gathering\n(54), (55) and (56).\nD.3. Proof of Proposition 21. We have, by using It\u00f4 calculus, dXtx =\n(c + Wt Idn )T dWt Idn + Idn dWtT (c + Wt Idn ) + dIdn dt. By using Lemma 2, the\nquadratic covariation of (Xtx )i,j and (Xtx )m,n is given by dh(Xtx )i,j , (Xtx )m,n i =\n(Xtx )i,m (Idn )j,n + (Xtx )i,n (Idn )j,m + (Xtx )j,m (Idn )i,n + (Xtx )j,n (Idn )i,m . Therefore,\n(Xtx )t\u22650 solves the same martingale problem as WISd (x, d, 0, Idn ), which is\nknown to have a unique solution from Cuchiero et al. [7].\nLet\nshow that X\u0302tx is a potential second-order scheme. We can see\n\u221a us now\nn\nc + t\u011cId as the Ninomiya\u2013Victoir scheme with moment-matching variP P\n2 on M (R). Let\nables (see [2], Theorem 1.18) associated to 12 di=1 nj=1 \u2202i,j\nd\n+\nT\n\u221e\n\u221e\nf \u2208 Cpol (Sd (R)). Then, x \u2208 Md (R) 7\u2192 f (x x) \u2208 Cpol (Md (R)) and there are\n\n\fSIMULATION SCHEMES FOR WISHART PROCESSES\n\n49\n\nconstants C, E, \u03b7 > 0 depending only on a good sequence of f such that\n\u2200t \u2208 (0, \u03b7)\n|E[f ((c +\n\n\u221a\n\u221a\nt\u011cIdn )T (c + t\u011cIdn ))] \u2212 E[f ((c + Wt Idn )T (c + Wt Idn ))]|\n\n\u2264 Ct\u03bd+1 (1 + kckE ).\n\np\np\nT c) =\nLet\nus\nnow\nobserve\nthat\nthe\nFrobenius\nnorm\nof\nc\nis\nTr(c\nTr(x) \u2264\n\u221a\np\np\n2\n2\nd + Tr(x ) \u2264 d + Tr(x ). Therefore, for any norm, there is a constant\nK > 0 such that kck \u2264 K(1 + kxk), which gives the result.\nREFERENCES\n[1] Alfonsi, A. (2005). On the discretization schemes for the CIR (and Bessel squared)\nprocesses. Monte Carlo Methods Appl. 11 355\u2013384. MR2186814\n[2] Alfonsi, A. (2010). High order discretization schemes for the CIR process: Application to affine term structure and Heston models. Math. Comp. 79 209\u2013237.\nMR2552224\n[3] Benabid, A., Bensusan, H. and El Karoui, N. (2010). Wishart stochastic volatility: Asymptotic smile and numerical framework. Preprint.\n[4] Bru, M. F. (1987). Th\u00e8se 3\u00e8me cycle. R\u00e9sistence d'Escherichie coli aux antibiotiques. Sensibilit\u00e9s des analyses en composantes principales aux perturbations\nBrowniennes et simulation. Ph.D. thesis, Univ. Paris Nord.\n[5] Bru, M.-F. (1991). Wishart processes. J. Theoret. Probab. 4 725\u2013751. MR1132135\n[6] Carr, P. and Madan, A. (1999). Option pricing and the fast Fourier transform.\nJ. Comput. Finance 2 61\u201373.\n[7] Cuchiero, C., Filipovi\u0107, D., Mayerhofer, E. and Teichmann, J. (2011). Affine\nprocesses on positive semidefinite matrices. Ann. Appl. Probab. 21 397\u2013463.\nMR2807963\n[8] Da Fonseca, J., Grasselli, M. and Tebaldi, C. (2008). Option pricing when\ncorrelations are stochastic: An analytical framework. Review of Derivatives Research 10 151\u2013180.\n[9] Filipovi\u0107, D. (2009). Term-Structure Models: A Graduate Course. Springer, Berlin.\nMR2553163\n[10] Gauthier, P. and Possamai, D. (2009). Efficient simulation of the Wishart model.\nSSRN eLibrary.\n[11] Glasserman, P. (2004). Monte Carlo Methods in Financial Engineering: Stochastic\nModelling and Applied Probability. Applications of Mathematics (New York) 53.\nSpringer, New York. MR1999614\n[12] Gleser, L. J. (1976). A canonical representation for the noncentral Wishart distribution useful for simulation. J. Amer. Statist. Assoc. 71 690\u2013695. MR0433717\n[13] Golub, G. H. and Van Loan, C. F. (1996). Matrix Computations, 3rd ed. Johns\nHopkins Univ. Press, Baltimore, MD. MR1417720\n[14] Gourieroux, C. and Sufana, R. (2003). Wishart quadratic term structure models.\nWorking paper.\n[15] Grasselli, M. and Tebaldi, C. (2008). Solvable affine term structure models. Math.\nFinance 18 135\u2013153. MR2380943\n[16] Heston, S. (1993). A closed-form solution for options with stochastic volatility with\napplications to bond and currency options. The Review of Financial Studies 6\n327\u2013343.\n\n\f50\n\nA. AHDIDA AND A. ALFONSI\n\n[17] Kabe, D. G. (1964). A note on the Bartlett decomposition of a Wishart matrix.\nJ. Roy. Statist. Soc. Ser. B 26 270\u2013273. MR0171358\n[18] Kshirsagar, A. M. (1959). Bartlett decomposition and Wishart distribution. Ann.\nMath. Statist. 30 239\u2013241. MR0103552\n[19] Kusuoka, S. (2004). Approximation of expectation of diffusion processes based on\nLie algebra and Malliavin calculus. In Advances in Mathematical Economics.\nVol. 6. Adv. Math. Econ. 6 69\u201383. Springer, Tokyo. MR2079333\n[20] Levin, J. J. (1959). On the matrix Riccati equation. Proc. Amer. Math. Soc. 10\n519\u2013524. MR0108628\n[21] Lyons, T. and Victoir, N. (2004). Cubature on Wiener space. Proc. R. Soc. Lond.\nSer. A Math. Phys. Eng. Sci. 460 169\u2013198. Stochastic analysis with applications\nto mathematical finance. MR2052260\n[22] Mayerhofer, E., Pfaffel, O. and Stelzer, R. (2011). On strong solutions\nfor positive definite jump diffusions. Stochastic Process. Appl. 121 2072\u20132086.\nMR2819242\n[23] Ninomiya, M. and Ninomiya, S. (2009). A new higher-order weak approximation\nscheme for stochastic differential equations and the Runge\u2013Kutta method. Finance Stoch. 13 415\u2013443. MR2519839\n[24] Ninomiya, S. and Victoir, N. (2008). Weak approximation of stochastic differential\nequations and application to derivative pricing. Appl. Math. Finance 15 107\u2013121.\nMR2409419\n[25] Odell, P. L. and Feiveson, A. H. (1966). A numerical procedure to generate a\nsample covariance matrix. J. Amer. Statist. Assoc. 61 199\u2013203. MR0192635\n[26] Smith, W. B. and Hocking, R. R. (1972). Algorithm as 53: Wishart variate generator. J. R. Stat. Soc. Ser. C. Appl. Stat. 21 341\u2013345.\n[27] Strang, G. (1968). On the construction and comparison of difference schemes. SIAM\nJ. Numer. Anal. 5 506\u2013517. MR0235754\n[28] Talay, D. and Tubaro, L. (1990). Expansion of the global error for numerical\nschemes solving stochastic differential equations. Stoch. Anal. Appl. 8 483\u2013509.\nMR1091544\n[29] Teichmann, J. (2010). Covariance matrix valued affine processes structure and numerics. Talk at the Bachelier Seminar in Paris.\nCERMICS\nUniversit\u00e9 Paris-Est\nProject team MathFi ENPC-INRIA-UMLV\nEcole des Ponts\n6-8 avenue Blaise Pascal\n77455 Marne La Vall\u00e9e\nFrance\nE-mail: ahdidaa@cermics.enpc.fr\nalfonsi@cermics.enpc.fr\n\n\f"}