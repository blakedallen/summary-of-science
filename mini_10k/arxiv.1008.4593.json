{"id": "http://arxiv.org/abs/1008.4593v2", "guidislink": true, "updated": "2011-03-04T08:10:17Z", "updated_parsed": [2011, 3, 4, 8, 10, 17, 4, 63, 0], "published": "2010-08-26T20:19:31Z", "published_parsed": [2010, 8, 26, 20, 19, 31, 3, 238, 0], "title": "Hacking commercial quantum cryptography systems by tailored bright\n  illumination", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1008.2706%2C1008.0568%2C1008.4384%2C1008.0262%2C1008.2121%2C1008.2599%2C1008.4291%2C1008.3677%2C1008.2163%2C1008.3303%2C1008.1738%2C1008.0595%2C1008.3626%2C1008.1187%2C1008.3273%2C1008.3298%2C1008.3678%2C1008.0235%2C1008.2712%2C1008.3949%2C1008.3268%2C1008.4172%2C1008.0808%2C1008.0476%2C1008.4950%2C1008.4109%2C1008.2831%2C1008.1474%2C1008.2747%2C1008.4525%2C1008.4403%2C1008.2147%2C1008.2655%2C1008.3542%2C1008.1419%2C1008.0185%2C1008.3653%2C1008.5113%2C1008.1184%2C1008.4459%2C1008.0862%2C1008.3356%2C1008.2826%2C1008.3174%2C1008.1742%2C1008.2206%2C1008.2462%2C1008.1384%2C1008.1622%2C1008.0215%2C1008.5319%2C1008.3054%2C1008.3951%2C1008.4612%2C1008.4853%2C1008.1010%2C1008.1289%2C1008.3572%2C1008.2778%2C1008.0038%2C1008.1458%2C1008.4410%2C1008.0311%2C1008.4169%2C1008.1196%2C1008.5289%2C1008.4190%2C1008.4593%2C1008.0403%2C1008.4461%2C1008.2994%2C1008.2919%2C1008.5278%2C1008.2084%2C1008.3558%2C1008.5321%2C1008.3441%2C1008.1787%2C1008.5119%2C1008.1731%2C1008.2850%2C1008.1737%2C1008.1149%2C1008.0039%2C1008.3490%2C1008.0810%2C1008.3263%2C1008.5311%2C1008.4019%2C1008.1608%2C1008.4995%2C1008.4946%2C1008.3433%2C1008.3111%2C1008.1968%2C1008.4700%2C1008.0786%2C1008.2015%2C1008.5095%2C1008.2687%2C1008.0497&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Hacking commercial quantum cryptography systems by tailored bright\n  illumination"}, "summary": "The peculiar properties of quantum mechanics allow two remote parties to\ncommunicate a private, secret key, which is protected from eavesdropping by the\nlaws of physics. So-called quantum key distribution (QKD) implementations\nalways rely on detectors to measure the relevant quantum property of single\nphotons. Here we demonstrate experimentally that the detectors in two\ncommercially available QKD systems can be fully remote-controlled using\nspecially tailored bright illumination. This makes it possible to tracelessly\nacquire the full secret key; we propose an eavesdropping apparatus built of\noff-the-shelf components. The loophole is likely to be present in most QKD\nsystems using avalanche photodiodes to detect single photons. We believe that\nour findings are crucial for strengthening the security of practical QKD, by\nidentifying and patching technological deficiencies.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1008.2706%2C1008.0568%2C1008.4384%2C1008.0262%2C1008.2121%2C1008.2599%2C1008.4291%2C1008.3677%2C1008.2163%2C1008.3303%2C1008.1738%2C1008.0595%2C1008.3626%2C1008.1187%2C1008.3273%2C1008.3298%2C1008.3678%2C1008.0235%2C1008.2712%2C1008.3949%2C1008.3268%2C1008.4172%2C1008.0808%2C1008.0476%2C1008.4950%2C1008.4109%2C1008.2831%2C1008.1474%2C1008.2747%2C1008.4525%2C1008.4403%2C1008.2147%2C1008.2655%2C1008.3542%2C1008.1419%2C1008.0185%2C1008.3653%2C1008.5113%2C1008.1184%2C1008.4459%2C1008.0862%2C1008.3356%2C1008.2826%2C1008.3174%2C1008.1742%2C1008.2206%2C1008.2462%2C1008.1384%2C1008.1622%2C1008.0215%2C1008.5319%2C1008.3054%2C1008.3951%2C1008.4612%2C1008.4853%2C1008.1010%2C1008.1289%2C1008.3572%2C1008.2778%2C1008.0038%2C1008.1458%2C1008.4410%2C1008.0311%2C1008.4169%2C1008.1196%2C1008.5289%2C1008.4190%2C1008.4593%2C1008.0403%2C1008.4461%2C1008.2994%2C1008.2919%2C1008.5278%2C1008.2084%2C1008.3558%2C1008.5321%2C1008.3441%2C1008.1787%2C1008.5119%2C1008.1731%2C1008.2850%2C1008.1737%2C1008.1149%2C1008.0039%2C1008.3490%2C1008.0810%2C1008.3263%2C1008.5311%2C1008.4019%2C1008.1608%2C1008.4995%2C1008.4946%2C1008.3433%2C1008.3111%2C1008.1968%2C1008.4700%2C1008.0786%2C1008.2015%2C1008.5095%2C1008.2687%2C1008.0497&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "The peculiar properties of quantum mechanics allow two remote parties to\ncommunicate a private, secret key, which is protected from eavesdropping by the\nlaws of physics. So-called quantum key distribution (QKD) implementations\nalways rely on detectors to measure the relevant quantum property of single\nphotons. Here we demonstrate experimentally that the detectors in two\ncommercially available QKD systems can be fully remote-controlled using\nspecially tailored bright illumination. This makes it possible to tracelessly\nacquire the full secret key; we propose an eavesdropping apparatus built of\noff-the-shelf components. The loophole is likely to be present in most QKD\nsystems using avalanche photodiodes to detect single photons. We believe that\nour findings are crucial for strengthening the security of practical QKD, by\nidentifying and patching technological deficiencies."}, "authors": ["Lars Lydersen", "Carlos Wiechers", "Christoffer Wittmann", "Dominique Elser", "Johannes Skaar", "Vadim Makarov"], "author_detail": {"name": "Vadim Makarov"}, "author": "Vadim Makarov", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1038/NPHOTON.2010.214", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/1008.4593v2", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/1008.4593v2", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "Revised version, rewritten for clarity. 5 pages, 5 figures. To\n  download the Supplementary information (which is in open access), go to the\n  journal web site at http://dx.doi.org/10.1038/nphoton.2010.214", "arxiv_primary_category": {"term": "quant-ph", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "quant-ph", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/1008.4593v2", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/1008.4593v2", "journal_reference": "Nature Photonics 4, 686 - 689 (2010)", "doi": "10.1038/NPHOTON.2010.214", "fulltext": "arXiv:1008.4593v2 [quant-ph] 4 Mar 2011\n\nHacking commercial quantum cryptography systems by tailored bright\nillumination\nLars Lydersen,1, 2, a) Carlos Wiechers,3, 4, 5 Christoffer Wittmann,3, 4 Dominique Elser,3, 4 Johannes Skaar,1, 2 and\nVadim Makarov1\n1)\nDepartment of Electronics and Telecommunications, Norwegian University of Science and Technology,\nNO-7491 Trondheim, Norway\n2)\nUniversity Graduate Center, NO-2027 Kjeller, Norway\n3)\nMax Planck Institute for the Science of Light, G\u00fcnther-Scharowsky-Str. 1/Bau 24, 91058 Erlangen,\nGermany\n4)\nInstitut f\u00fcr Optik, Information und Photonik, University of Erlangen-Nuremberg, Staudtstrasse 7/B2,\n91058, Erlangen, Germany\n5)\nDepartamento de F\u0131\u0301sica, Universidad de Guanajuato, Lomas del Bosque 103,\nFraccionamiento Lomas del Campestre, 37150, Le\u00f3n, Guanajuato, M\u00e9xico\n(Dated: 9 July 2010)\n\nattack12 which requires the eavesdropper Eve to perform a quantum non-demolition measurement of the photon number sent by Alice. The attack is still unfeasible, and has been outruled by improved QKD protocols13,14 . In contrast, a more implementation-friendly\nattack is the time-shift attack15 based on detector efficiency mismatch16 . Experimentally however, this attack\nhas only given a small information-theoretical advantage\nfor Eve when applied to a modified version of a commercial QKD system17 . In the attack Eve captured partial\ninformation about the key in 4% of her attempts, such\nthat she could improve her random (brute-force) search\nover all possible keys.\nIn this Letter, we demonstrate how two commercial\nQKD systems id3110 Clavis2 and QPN 5505, from the\ncommercial vendors ID Quantique and MagiQ Technologies, can be fully cracked. We show experimentally that\nEve can blind the gated detectors in the QKD systems\nusing bright illumination, thereby converting them into\nclassical, linear detectors. The detectors are then fully\ncontrolled by classical laser pulses superimposed over the\nbright continuous-wave (CW) illumination. Remarkably\nthe detectors exactly measure what is dictated by Eve;\nwith matching measurement bases Bob detects exactly\nthe bit value sent by Eve, while with incompatible bases\nthe bit is undetected by Bob. Even the detectors dark\ncounts are completely eliminated (but can be simulated\nat will by Eve). Based on these experimental results we\npropose in detail how Eve can attack the systems with\noff-the-shelf components, obtaining a perfect copy of the\nraw key without leaving any trace of her presence.\nToday most QKD systems use avalanche photo diodes\n(APDs) to detect single photons18 . To detect single photons APDs are operated in Geiger mode (see Fig. 1).\nHowever all APDs spend part of the time being biased\nunder the breakdown voltage, in the linear mode. During this time the detector remains sensitive to bright light\nwith a classical optical power threshold Pth . If Eve has\naccess to the APDs in the linear mode, she may eavesdrop on the QKD system with an intercept-resend (fakedstate19,20 ) attack as follows: Eve uses a copy of Bob to de-\n\nThe peculiar properties of quantum mechanics\nallow two remote parties to communicate a private, secret key, which is protected from eavesdropping by the laws of physics1\u20134 . So-called\nquantum key distribution (QKD) implementations always rely on detectors to measure the relevant quantum property of single photons5 . Here\nwe demonstrate experimentally that the detectors in two commercially available QKD systems\ncan be fully remote-controlled using specially tailored bright illumination. This makes it possible to tracelessly acquire the full secret key; we\npropose an eavesdropping apparatus built of offthe-shelf components. The loophole is likely to\nbe present in most QKD systems using avalanche\nphotodiodes to detect single photons. We believe that our findings are crucial for strengthening the security of practical QKD, by identifying\nand patching technological deficiencies.\nThe field of quantum key distribution has evolved\nrapidly in the last decades. Today QKD implementations in laboratories can generate key over fibre channels\nwith lengths up to 250 km6 and a few QKD systems are\neven commercially available promising enhanced security\nfor data communication.\nIn all proofs for the security of QKD there are assumptions on the devices involved. However the components\nused for the experimental realizations of QKD deviate\nfrom the models in the security proofs. This has led\nto iterations where security threats caused by deviations\nhave been discovered, and the loopholes have been closed\neither by modification of the implementation, or more\ngeneral security proofs7\u20139 . In other cases, information\nleaking to the eavesdropper was quantified10,11 .\nAttacks exploiting the most severe loopholes are usually experimentally unfeasible with current technology.\nA prominent example is the photon number splitting\n\na) Electronic\n\nmail: lars.lydersen@iet.ntnu.no\n\n1\n\n\fIAPD\n\nLinear mode\n\nGeiger mode\n\nC\n\nPth\n\nPopt\n\nQ\n\ng\nchin\nuen\n\nSingle photon\n\nClick!\n\nC\n\nI0\nIth\nt\n\nI1\nIth\n\n(a)\n\nBias to APD (Vbias )\n\nVAPD\n\n\"1\"\n\nI0\nIth\n\nVAPD\n\nVbr\n\n\"0\"\n\nb)\n\n\"1\"\n\nIth\nIth\n\n\"0\"\n\na)\n\nIAPD\n\nI1\nIth\n\nt\n\nt\n\nt\n\nT1\n\nVbr\n\nFIG. 2. How Eve's trigger pulses are detected by Bob.\nSchemes show the last 50/50 coupler (C) and Bob's detectors in a phase-encoded QKD system. I0 /I1 is the current\nrunning through APD 0/1. a) Eve and Bob have selected\nmatching bases, and Eve detected the bit value 0. Therefore\nthe trigger pulse from Eve interferes constructively and its full\nintensity hits detector 0. The current caused by Eve's pulse\ncrosses the threshold current Ith and causes a click. b) Eve\nand Bob have selected opposite bases. The trigger pulse from\nEve does not interfere constructively and half of its intensity\nhits each detector. This causes no click as the current is below\nthe threshold Ith for each detector.\n\nRbias\n\nVbias\n0\n\ntime\n(b)\n\nVHV \u2248 40 V\n(c)\n\nFIG. 1. APD as a single-photon detector. a) In Geiger mode\nwhere the APD is reverse-biased above the breakdown voltage\nVbr , an absorbed single photon causes a large current IAPD\nthrough the APD. A detection signal called a click occurs\nwhen IAPD crosses the threshold Ith . Afterwards VAPD is\nlowered below Vbr to quench the avalanche, before returning to\nGeiger mode. Below Vbr , in the linear mode, the current IAPD\nis proportional to the incident optical power Popt . Then Ith\nbecomes an optical power threshold Pth . b) The commercial\nsystems use gated detectors, with the APDs in Geiger mode\nonly when a photon is expected, to reduce false detections\ncalled dark counts. In practice, the APD is biased just below\nVbr , and periodical \u223c3 V voltage pulses create Geiger mode\ntime regions, so-called gates. c) In both systems, the bias\nhigh-voltage supply VHV has impedance Rbias (Rbias = 1 k\u03a9\nin Clavis2 and 20 k\u03a9 in QPN 5505) before Vbias is applied to\nthe APD at the point T1. Therefore, any current through\nRbias reduces Vbias (see Supplementary information section I\nfor more details).\n\nprivacy amplification, Eve simply listens to this classical\ncommunication and applies the same operations as Bob\nto obtain the identical final key.\nThe attack is surprisingly general: all commercial\nQKD systems and the vast majority of research systems\nuse APD-based detectors which all operate their APDs\npart time in linear mode. Detectors with passively- and\nactively-quenched APDs can also be kept in linear mode\nthrough blinding20,22 . The attack works equally well on\nthe Scarani-Acin-Ribordy-Gisin 2004 (SARG04)14 and\ndecoy-state BB8413 protocols as well as the normal BB84\nprotocol4. With suitable modifications it applies to differential phase shift (DPS)23 , and given the right set of\ndetector parameters to coherent one-way (COW)24 protocols.\nNote that the threshold Pth should be sufficiently well\ndefined for perfect eavesdropping. To be precise, let detector i always click from a trigger pulse of optical peak\npower \u2265 Palways,i , and never click from a trigger pulse of\noptical peak power \u2264 Pnever,i . The requirement for Eve\nto be able to make any single detector click while none\nof the other detectors click, can be expressed in terms of\nthe click thresholds as\n\u0010\n\u0011\nmax {Palways,i } < 2 min {Pnever,i } .\n(1)\n\ntect the states from Alice in a random basis. Eve resends\nher detection results, but instead of sending pulses at the\nsingle photon level she sends bright trigger pulses, with\npeak power just above Pth . Bob will only have a detection event if his active basis choice coincides with Eve's\nbasis choice (see Fig. 2), otherwise no detector clicks.\nThis causes half of the bits to be lost, but in practice this\nis not a problem because transmittance from the output\nof Alice to Bob's detectors is much lower than 1/2. Also\nBob's APDs rarely have a quantum efficiency over 50%,\nwhile the trigger pulses always cause clicks. For a Bob\nusing passive basis choice, Eve launches the peak power\njust above 2Pth since half of the power hits the conjugate\nbasis detectors20,21 . Then Bob's detector always clicks.\n\ni\n\ni\n\nWhen eavesdropping, simply applying trigger pulses\nbetween the gates populates carrier trap levels in the\nAPD, thus raising the dark count probability and causing\na too high quantum bit error rate (QBER). To avoid this\nBob's detectors were blinded20,22 . Then the detectors\nare insensitive to single photons and have no dark counts.\n\nAfter the raw key exchange, Bob and Eve have identical bit values and basis choices. Since Alice and Bob\ncommunicate openly during sifting, error correction and\n2\n\n\f43.5\n\n3\n\nV\n\nGates, V\n\nbias,0\n\n43\n\nV\n\nbias,1\n\n42.5\n\n2\n1\n0\n2\n\nInput\nillumination, mW\n\nV\n\nbias\n\n,V\n\n42\n41.5\n41\n40.5\n40\n\n1.5\n1\n0.5\n0\n\n39.5\n=397 \u03bcW\n\nP\n\nblind,0\n\n0\n\n0.2\n\n0.4\n\n=765 \u03bcW\n\nDetector\noutput\n\nP\n39\n\nblind,1\n\n0.6\n\n0.8\n1\nPlaser,mW\n\n1.2\n\n1.4\n\n1.6\n\n1.8\n\nLogic 1\n\nLogic 0\n\u221210\n\nFIG. 3. Bias voltage at T1 versus CW laser power for Clavis2.\nDetector 0 is blind (dark count rate exactly zero) at Plaser >\n397 \u03bcW and detector 1 is blind at Plaser > 765 \u03bcW. QPN\n5505 has similar characteristics; due to larger value of Rbias ,\nits detector 0 goes blind at Plaser > 60 \u03bcW and detector 1\ngoes blind at Plaser > 85 \u03bcW (see Supplementary information\nsection II for more details of QPN 5505 blinding).\n\n0\n\n10\n\n20\n\n30\n\n\u221210\n\nTime, ns\n\n0\n\n10\n\n20\n\n30\n\nTime, ns\n\n(a)\n30\nP\nTrigger pulse peak power, mW\n\nnever,0\n\nOutside the gates the APD is biased below the breakdown\nvoltage, and the current caused by illuminating the APD\nis increasing with respect to the incident optical power.\nA current through the APD will decrease the bias voltage\nover the APD due to the presence of Rbias (see Fig. 1c)\nand the internal resistance of the APD. Fig. 3 shows the\nbias voltage drop at the point T1 in Clavis2 under CW\nillumination.\nThe blinding is caused by the drop of Vbias such that\nthe APD never operates in the Geiger mode, but rather is\na classical photo diode at all times. The voltages VHV,0/1\nof the high voltage supplies do not change; the entire\nchange of Vbias is due to the resistors Rbias . Although\nshorting this resistor seems like an easy countermeasure,\nat least for Clavis2 this does not prevent blinding. With\nhigher illumination the electrical power dissipated in the\nAPD generates substantial heat. Raised APD temperature increases its breakdown voltage by about 0.1 V/\u25e6 C\nwhile Vbias remains constant, which also leads to blinding\n(at several times higher power level, 4\u201310 mW).\nTo demonstrate detector control in Clavis2, each detector was blinded with 1.08 mW optical power with a\n2.5 ns long trigger pulse superimposed slightly after the\ngate. Note that a shorter trigger pulse can be timed inside the gate. Fig. 4a shows the response of detector 0 in\nClavis2 to trigger pulses at the click thresholds.\nSimilarly for the QPN 5505 the trigger pulse was timed\nwith its leading edge about 5 ns after the gate. Figure 4b\nshows the click thresholds for the detectors when blinded\nwith 100\u2013300 \u03bcW CW blinding illumination. In this case,\nfor blinding power levels 100\u2013250 \u03bcW the detectors remain silent at a power level of \u2264 0.61 * Palways,1 .\nFor both systems the click thresholds fulfill equation (1), hence perfect eavesdropping is possible.\nBoth systems under investigation operate according to\n\n25\n\nP\n\nalways,0\n\nP\n\nnever,1\n\n20\n\nPalways,1\n\n15\n\n10\n\n5\n\n0\n100\n\n150\n\n200\nBlinding power, \u03bcW\n\n250\n\n300\n\n(b)\n\nFIG. 4. Detector control. a) Electrical and optical signal oscillograms when detector 0 in Clavis2 is blinded by 1.08 mW\nCW illumination, and controlled by a superimposed 2.5 ns\nlong laser pulse timed slightly behind the gate (see Supplementary information section III for detailed measurement\nsetup). The superimposed Pnever,0 = 647 \u03bcW (detector 1:\nPnever,1 = 697\u03bcW) trigger pulse never causes a detection\nevent while the Palways,0 = 808 \u03bcW (Palways,1 = 932 \u03bcW)\ntrigger pulse always causes a detection event. b) Click thresholds versus the applied CW blinding illumination for the QPN\n5505. When the blinding power increases, Palways,0 diverges,\nperhaps because the bias voltage is approaching the punchthrough voltage of the APD (see Supplementary information\nsection II).\n\nthe plug-and-play principle25 which allows an easily installable plug-and-play eavesdropper (see Fig. 5).\nA full eavesdropper based on bright-light detector\ncontrol has previously been implemented and tested\nunder realistic conditions on a 290 m experimental\nentanglement-based QKD system21 . Since the attack is\nclearly implementable, building a full eavesdropper for a\ncommercial cryptosystem would not further expose the\nproblem. A better use of effort is to concentrate on thoroughly closing the vulnerability. An optical power meter\n3\n\n\fPlug-and-play Eve\nAlice\n\nBob\u2032\nBasis\nDetection result\n\nAlice\u2032\n\nOptical\namplifier\n\nBob\n\nBasis\nBit in\nBlinding laser\n\nFIG. 5. Proposed plug-and-play Eve. In the plug-and-play scheme25 the laser pulses travel from Bob to Alice and back to Bob,\npassing Bob's interferometer twice. Therefore, polarization drift in the fibre and drift in Bob's interferometer is automatically\ncompensated. Eve consists of copies of Alice (Alice\u2032 ) and Bob (Bob\u2032 ) which share bit and basis settings, a blinding laser, and an\noptical amplifier used to get the proper trigger pulse power. Due to the plug-and-play principle any environmental perturbations\nin the fibres Alice\u2013Bob\u2032 and Alice\u2032 \u2013Bob are automatically compensated. See Supplementary information section IV for a more\ndetailed scheme.\n\nat Bob's entrance with a classical threshold seems like an\nadequate countermeasure to prevent blinding. However,\nthe power meter output should be included into a security\nproof. Further, the click threshold at the transition between linear and Geiger mode may be very low, allowing\npractically non-detectable control pulses. How to design\nhack-proof detectors is unclear to us at this stage, and all\nfuture detectors clearly must be tested for side-channels.\nWe believe that openly discovering and closing security loopholes is a necessary step towards practical secure\nQKD, as it has been for multiple security technologies\nbefore. For example, RSA public key cryptography has\nreceived extensive scrutiny which in the past discovered\neffective attacks based on implementation loopholes26 . In\nour view quantum hacking is an indication of the mature\nstate of QKD rather than its insecurity. Rather than\ndemonstrating that practical QKD cannot become provably secure27 , our findings clearly show the necessity of\ninvestigating the practical security of QKD: Any large\nloopholes must be eliminated, and remaining imperfections must be incorporated into security proofs.\nBoth ID Quantique and MagiQ Technologies have been\nnotified about the loophole prior to this publication. ID\nQuantique has implemented countermeasures. According to MagiQ Technologies the system QPN 5505 is discontinued; newer models of their system have not been\navailable for our testing.\n\nings of IEEE International Conference on Computers,\nSystems, and Signal Processing, 175\u2013179 (IEEE Press,\nNew York, Bangalore, India, 1984).\n5\nScarani, V. et al. The security of practical quantum key\ndistribution. Rev. Mod. Phys. 81, 1301\u20131350 (2009).\n6\nStucki, D. et al. High rate, long-distance quantum key\ndistribution over 250 km of ultra low loss fibres. New\nJ. Phys. 11, 075003 (2009).\n7\nGottesman, D., Lo, H.-K., L\u00fctkenhaus, N. & Preskill,\nJ. Security of quantum key distribution with imperfect\ndevices. Quant. Inf. Comp. 4, 325\u2013360 (2004).\n8\nFung, C.-H.F., Tamaki, K., Qi, B., Lo, H.-K. & Ma,\nX. Security proof of quantum key distribution with\ndetection efficiency mismatch. Quant. Inf. Comp. 9,\n131\u2013165 (2009).\n9\nLydersen, L. and Skaar, J. Security of quantum key distribution with bit and basis dependent detector flaws.\nQuant. Inf. Comp. 10, 0060 (2010).\n10\nLamas-Linares, A. and Kurtsiefer, C. Breaking a quantum key distribution system through a timing side\nchannel. Opt. Express 15, 9388\u20139393 (2007).\n11\nNauerth, S., F\u00fcrst, M., Schmitt-Manderbach, T.,\nWeier, H. & Weinfurter, H. Information leakage via\nside channels in freespace BB84 quantum cryptography. New J. Phys. 11, 065001 (2009).\n12\nL\u00fctkenhaus, N. Security against individual attacks for\nrealistic quantum key distribution. Phys. Rev. A 61,\n052304 (2000).\n13\nHwang, W.Y. Quantum key distribution with high loss:\nToward global secure communication. Phys. Rev. Lett.\n91, 057901 (2003).\n14\nScarani, V., Acin, A., Ribordy, G. & Gisin, N. Quantum cryptography protocols robust against photon\nnumber splitting attacks for weak laser pulse implementations. Phys. Rev. Lett. 92, 057901 (2004).\n15\nQi, B., Fung, C.-H.F., Lo, H.-K. & Ma, X. Time-shift\nattack in practical quantum cryptosystems. Quant. Inf.\nComp. 7, 73\u201382 (2007).\n16\nMakarov, V., Anisimov, A. & Skaar, J. Effects of detector efficiency mismatch on security of quantum cryptosystems. Phys. Rev. A 74, 022313 (2006); Erratum\nibid. 78, 019905 (2008).\n\nREFERENCES\n1\n\nMayers, D. Advances in cryptology. In Proceedings of\nCrypto \u030196, Vol. 1109, edited by N. Koblitz, 343\u2013357\n(Springer, New York, 1996).\n2\nLo, H.-K. & Chau, H.F. Unconditional security of\nquantum key distribution over arbitrarily long distances. Science 283, 2050\u20132056 (1999).\n3\nShor, P.W. & Preskill, J. Simple proof of security of the\nBB84 quantum key distribution protocol. Phys. Rev.\nLett. 85, 441\u2013444 (2000).\n4\nBennett, C.H. & Brassard, G. Quantum cryptography:\nPublic key distribution and coin tossing. In Proceed4\n\n\f17\n\nprint quant-ph/0906.4547v1.\n\nZhao, Y., Fung, C.-H.F., Qi, B., Chen, C. & Lo,\nH.-K. Quantum hacking: Experimental demonstration of time-shift attack against practical quantum-keydistribution systems. Phys. Rev. A 78, 042333 (2008).\n18\nCova, S., Ghioni, M., Lotito, A., Rech, I. & Zappa,\nF. Evolution and prospects for single-photon avalanche\ndiodes and quenching circuits. J. Mod. Opt. 51, 1267\u2013\n1288 (2004).\n19\nMakarov, V. & Hjelme, D.R. Faked states attack on\nquantum cryptosystems. J. Mod. Opt. 52, 691\u2013705\n(2005).\n20\nMakarov, V., Anisimov, A. & Sauge, S. Quantum hacking: adding a commercial actively-quenched module to\nthe list of single-photon detectors controllable by Eve.\ne-print quant-ph/0809.3408v2.\n21\nGerhardt, I. et al. Unpublished results.\n22\nMakarov, V. Controlling passively quenched single photon detectors by bright light. New J. Phys. 11, 065003\n(2009).\n23\nTakesue, H. et al. Differential phase shift quantum\nkey distribution experiment over 105 km fibre. New\nJ. Phys. 7, 232 (2005).\n24\nStucki, D., Brunner, N., Gisin, N., Scarani, V. &\nZbinden, H. Fast and simple one-way quantum key\ndistribution. Appl. Phys. Lett. 87, 194108 (2005).\n25\nMuller, A. et al. \"Plug and play\" systems for quantum\ncryptography. Appl. Phys. Lett. 70, 793\u2013795 (1997).\n26\nBoneh, D. Twenty years of attacks on the RSA cryptosystem. Notices Amer. Math. Soc. 46, 203\u2013213\n(1999).\n27\nScarani, V. & Kurtsiefer, C. The black paper of quantum cryptography: real implementation problems. e-\n\nACKNOWLEDGEMENTS\nThis work was supported by the Research Council of\nNorway (grant no. 180439/V30). Overall cooperation\nand assistance of the Max Planck Institute for the Science of Light, Erlangen and personally Gerd Leuchs is acknowledged. L.L. and V.M. thank the Group of Applied\nPhysics at the University of Geneva, ID Quantique, and\narmasuisse Science and Technology for their hospitality,\ndiscussions, cooperativeness and loan of equipment. Service of Radiology of the Cantonal Hospital of Geneva is\nthanked for a quick help in revealing internal layers in a\nmultilayer printed circuit board of a commercial detector.\nAUTHOR CONTRIBUTIONS\nV.M. conceived the idea and planned the study. L.L.\nand V.M. conducted the Clavis2 experiment with the\nhelp of C. Wiechers, D.E. and C. Wittmann. L.L. and\nV.M. conducted the QPN 5505 experiment. L.L. and\nJ.S. wrote the paper and supplementary information with\ninput from all authors. J.S. and V.M. supervised the\nproject.\nADDITIONAL INFORMATION\nThe authors declare no competing financial interests.\nSupplementary information accompanies this paper.\n\n5\n\n\f"}