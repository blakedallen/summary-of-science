{"id": "http://arxiv.org/abs/astro-ph/0312201v1", "guidislink": true, "updated": "2003-12-08T12:34:33Z", "updated_parsed": [2003, 12, 8, 12, 34, 33, 0, 342, 0], "published": "2003-12-08T12:34:33Z", "published_parsed": [2003, 12, 8, 12, 34, 33, 0, 342, 0], "title": "Parametric Recovery of Line-of-Sight Velocity Distributions from\n  Absorption-Line Spectra of Galaxies via Penalized Likelihood", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=astro-ph%2F0312590%2Castro-ph%2F0312306%2Castro-ph%2F0312655%2Castro-ph%2F0312302%2Castro-ph%2F0312612%2Castro-ph%2F0312228%2Castro-ph%2F0312155%2Castro-ph%2F0312074%2Castro-ph%2F0312259%2Castro-ph%2F0312538%2Castro-ph%2F0312421%2Castro-ph%2F0312293%2Castro-ph%2F0312088%2Castro-ph%2F0312043%2Castro-ph%2F0312119%2Castro-ph%2F0312178%2Castro-ph%2F0312436%2Castro-ph%2F0312530%2Castro-ph%2F0312557%2Castro-ph%2F0312553%2Castro-ph%2F0312573%2Castro-ph%2F0312280%2Castro-ph%2F0312183%2Castro-ph%2F0312083%2Castro-ph%2F0312479%2Castro-ph%2F0312613%2Castro-ph%2F0312551%2Castro-ph%2F0312328%2Castro-ph%2F0312242%2Castro-ph%2F0312349%2Castro-ph%2F0312449%2Castro-ph%2F0312653%2Castro-ph%2F0312093%2Castro-ph%2F0312609%2Castro-ph%2F0312139%2Castro-ph%2F0312080%2Castro-ph%2F0312308%2Castro-ph%2F0312159%2Castro-ph%2F0312375%2Castro-ph%2F0312329%2Castro-ph%2F0312105%2Castro-ph%2F0312279%2Castro-ph%2F0312215%2Castro-ph%2F0312381%2Castro-ph%2F0312005%2Castro-ph%2F0312350%2Castro-ph%2F0312343%2Castro-ph%2F0312597%2Castro-ph%2F0312490%2Castro-ph%2F0312555%2Castro-ph%2F0312016%2Castro-ph%2F0312283%2Castro-ph%2F0312621%2Castro-ph%2F0312015%2Castro-ph%2F0312011%2Castro-ph%2F0312432%2Castro-ph%2F0312443%2Castro-ph%2F0312608%2Castro-ph%2F0312046%2Castro-ph%2F0312591%2Castro-ph%2F0312050%2Castro-ph%2F0312583%2Castro-ph%2F0312266%2Castro-ph%2F0312038%2Castro-ph%2F0312210%2Castro-ph%2F0312631%2Castro-ph%2F0312154%2Castro-ph%2F0312194%2Castro-ph%2F0312103%2Castro-ph%2F0312594%2Castro-ph%2F0312102%2Castro-ph%2F0312607%2Castro-ph%2F0312452%2Castro-ph%2F0312014%2Castro-ph%2F0312325%2Castro-ph%2F0312025%2Castro-ph%2F0312030%2Castro-ph%2F0312632%2Castro-ph%2F0312406%2Castro-ph%2F0312211%2Castro-ph%2F0312341%2Castro-ph%2F0312546%2Castro-ph%2F0312127%2Castro-ph%2F0312173%2Castro-ph%2F0312372%2Castro-ph%2F0312171%2Castro-ph%2F0312645%2Castro-ph%2F0312545%2Castro-ph%2F0312161%2Castro-ph%2F0312075%2Castro-ph%2F0312264%2Castro-ph%2F0312319%2Castro-ph%2F0312437%2Castro-ph%2F0312253%2Castro-ph%2F0312416%2Castro-ph%2F0312652%2Castro-ph%2F0312556%2Castro-ph%2F0312229%2Castro-ph%2F0312060%2Castro-ph%2F0312201%2Castro-ph%2F0312064&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Parametric Recovery of Line-of-Sight Velocity Distributions from\n  Absorption-Line Spectra of Galaxies via Penalized Likelihood"}, "summary": "We investigate the accuracy of the parametric recovery of the line-of-sight\nvelocity distribution (LOSVD) of the stars in a galaxy, while working in pixel\nspace. Problems appear when the data have a low signal-to-noise ratio, or the\nobserved LOSVD is not well sampled by the data. We propose a simple solution\nbased on maximum penalized likelihood and we apply it to the common situation\nin which the LOSVD is described by a Gauss-Hermite series. We compare different\ntechniques by extracting the stellar kinematics from observations of the barred\nlenticular galaxy NGC 3384 obtained with the SAURON integral-field\nspectrograph.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=astro-ph%2F0312590%2Castro-ph%2F0312306%2Castro-ph%2F0312655%2Castro-ph%2F0312302%2Castro-ph%2F0312612%2Castro-ph%2F0312228%2Castro-ph%2F0312155%2Castro-ph%2F0312074%2Castro-ph%2F0312259%2Castro-ph%2F0312538%2Castro-ph%2F0312421%2Castro-ph%2F0312293%2Castro-ph%2F0312088%2Castro-ph%2F0312043%2Castro-ph%2F0312119%2Castro-ph%2F0312178%2Castro-ph%2F0312436%2Castro-ph%2F0312530%2Castro-ph%2F0312557%2Castro-ph%2F0312553%2Castro-ph%2F0312573%2Castro-ph%2F0312280%2Castro-ph%2F0312183%2Castro-ph%2F0312083%2Castro-ph%2F0312479%2Castro-ph%2F0312613%2Castro-ph%2F0312551%2Castro-ph%2F0312328%2Castro-ph%2F0312242%2Castro-ph%2F0312349%2Castro-ph%2F0312449%2Castro-ph%2F0312653%2Castro-ph%2F0312093%2Castro-ph%2F0312609%2Castro-ph%2F0312139%2Castro-ph%2F0312080%2Castro-ph%2F0312308%2Castro-ph%2F0312159%2Castro-ph%2F0312375%2Castro-ph%2F0312329%2Castro-ph%2F0312105%2Castro-ph%2F0312279%2Castro-ph%2F0312215%2Castro-ph%2F0312381%2Castro-ph%2F0312005%2Castro-ph%2F0312350%2Castro-ph%2F0312343%2Castro-ph%2F0312597%2Castro-ph%2F0312490%2Castro-ph%2F0312555%2Castro-ph%2F0312016%2Castro-ph%2F0312283%2Castro-ph%2F0312621%2Castro-ph%2F0312015%2Castro-ph%2F0312011%2Castro-ph%2F0312432%2Castro-ph%2F0312443%2Castro-ph%2F0312608%2Castro-ph%2F0312046%2Castro-ph%2F0312591%2Castro-ph%2F0312050%2Castro-ph%2F0312583%2Castro-ph%2F0312266%2Castro-ph%2F0312038%2Castro-ph%2F0312210%2Castro-ph%2F0312631%2Castro-ph%2F0312154%2Castro-ph%2F0312194%2Castro-ph%2F0312103%2Castro-ph%2F0312594%2Castro-ph%2F0312102%2Castro-ph%2F0312607%2Castro-ph%2F0312452%2Castro-ph%2F0312014%2Castro-ph%2F0312325%2Castro-ph%2F0312025%2Castro-ph%2F0312030%2Castro-ph%2F0312632%2Castro-ph%2F0312406%2Castro-ph%2F0312211%2Castro-ph%2F0312341%2Castro-ph%2F0312546%2Castro-ph%2F0312127%2Castro-ph%2F0312173%2Castro-ph%2F0312372%2Castro-ph%2F0312171%2Castro-ph%2F0312645%2Castro-ph%2F0312545%2Castro-ph%2F0312161%2Castro-ph%2F0312075%2Castro-ph%2F0312264%2Castro-ph%2F0312319%2Castro-ph%2F0312437%2Castro-ph%2F0312253%2Castro-ph%2F0312416%2Castro-ph%2F0312652%2Castro-ph%2F0312556%2Castro-ph%2F0312229%2Castro-ph%2F0312060%2Castro-ph%2F0312201%2Castro-ph%2F0312064&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "We investigate the accuracy of the parametric recovery of the line-of-sight\nvelocity distribution (LOSVD) of the stars in a galaxy, while working in pixel\nspace. Problems appear when the data have a low signal-to-noise ratio, or the\nobserved LOSVD is not well sampled by the data. We propose a simple solution\nbased on maximum penalized likelihood and we apply it to the common situation\nin which the LOSVD is described by a Gauss-Hermite series. We compare different\ntechniques by extracting the stellar kinematics from observations of the barred\nlenticular galaxy NGC 3384 obtained with the SAURON integral-field\nspectrograph."}, "authors": ["Michele Cappellari", "Eric Emsellem"], "author_detail": {"name": "Eric Emsellem"}, "author": "Eric Emsellem", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1086/381875", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/astro-ph/0312201v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/astro-ph/0312201v1", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "7 pages, 7 figures, LaTeX (uses emulateapj). To appear in PASP,\n  v.116, 2004 February. Software implementing the pPXF method described in this\n  paper is available at http://www.strw.leidenuniv.nl/~mcappell/idl/", "arxiv_primary_category": {"term": "astro-ph", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "astro-ph", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/astro-ph/0312201v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/astro-ph/0312201v1", "journal_reference": "Publ.Astron.Soc.Pac.116:138,2004", "doi": "10.1086/381875", "fulltext": "T O APPEAR IN PASP, V. 116, 2004 F EBRUARY\nPreprint typeset using LATEX style emulateapj v. 11/26/03\n\nPARAMETRIC RECOVERY OF LINE-OF-SIGHT VELOCITY DISTRIBUTIONS FROM\nABSORPTION-LINE SPECTRA OF GALAXIES VIA PENALIZED LIKELIHOOD\nM ICHELE C APPELLARI\nLeiden Observatory, Postbus 9513, 2300 RA Leiden, The Netherlands\nAND\n\nE RIC E MSELLEM\n\narXiv:astro-ph/0312201v1 8 Dec 2003\n\nCentre de Recherche Astronomique de Lyon, 9 Avenue Charles Andr\u00e9, 69230 Saint Genis Laval, France\nTo appear in PASP, v. 116, 2004 February\n\nABSTRACT\nWe investigate the accuracy of the parametric recovery of the line-of-sight velocity distribution (LOSVD) of the\nstars in a galaxy, while working in pixel space. Problems appear when the data have a low signal-to-noise ratio,\nor the observed LOSVD is not well sampled by the data. We propose a simple solution based on maximum\npenalized likelihood and we apply it to the common situation in which the LOSVD is described by a GaussHermite series. We compare different techniques by extracting the stellar kinematics from observations of the\nbarred lenticular galaxy NGC 3384 obtained with the SAURON integral-field spectrograph.\nSubject headings: galaxies: individual (NGC 3384) \u2013 galaxies: kinematics and dynamics \u2013 line: profiles\n1. INTRODUCTION\n\nThe dynamics of stars in a galaxy is uniquely defined by\nthe distribution function and the potential in which the stars\nmove. From the many stable equilibrium configurations for\ncollisionless systems which can in principle be constructed,\nonly some of them are actually observed in our Universe. This\nconstitutes a 'fossil record' of galaxy formation. It is still\nnot clear what observable constraints are needed to recover\nboth the distribution function and the gravitational potential\nof a stellar system (but see, e.g., Dejonghe & Merritt 1992,\nfor spherical geometry), but simple dimensionality arguments\nimply that this should not be possible without the knowledge\nof the full line-of-sight velocity distributions (LOSVD) at all\nspatial positions on the galaxy image on the sky. It is therefore\nuseful to explore how the LOSVD can be recovered from the\nobservations.\nConsidering galaxies as pure stellar systems, the spectrum\nobserved at a certain sky position is a (luminosity-weighted)\nsum of individual stellar spectra redshifted according to their\nline-of-sight velocities. If one makes the assumption that the\nspectrum of all stars is given by a single template, then it\nsimply reduces to the convolution between that spectrum and\nthe LOSVD, which can then be retrieved by solving the inverse problem, i.e., deconvolving the spectra using the template. Deconvolution is an intrinsically ill-conditioned problem, which amplifies noise and measurement errors. Due to\nthe special care required in the inversion many techniques\nhave been developed in the last 30 years to recover the\nLOSVD from the data. The evolution in the methods has\nbeen mainly driven by the gradual improvement in the observational techniques and the signal-to-noise ratio (S/N) of the\ndata, and by the steady increase in the available computational\nspeed.\nEarly methods were mostly using Fourier based techniques,\nwhich allowed the LOSVD to be recovered quickly, from a\ndeconvolution process, and in some cases included techniques\nto reduce the effect of template mismatch (Simkin 1974; Sargent et al. 1977; Tonry & Davis 1979; Franx & Illingworth\nElectronic address: cappellari@strw.leidenuniv.nl\nElectronic address: emsellem@obs.univ-lyon1.fr\n\n1988; Bender 1990; Statler 1995). More recently methods\nhave shifted towards fitting the LOSVD directly in pixel space\n(Rix & White 1992; Kuijken & Merrifield 1993; van der\nMarel 1994; Saha & Williams 1994; Merritt 1997; Gebhardt\net al. 2000; Kelson et al. 2000). The reasons for this are that (i)\nin pixel space it becomes easy to exclude gas emission lines\nor bad pixels from the fit, and take continuum matching directly into account; (ii) current computers can accommodate\nthe larger computational cost involved; (iii) the availability of\nlibraries with high spectral resolution stellar and galaxy spectra allows the template to be carefully matched to the observed\ngalaxy spectrum (e.g., Emsellem et al. 2004). See de Bruyne\net al. (2003) for a more detailed historical overview of the\nvarious methods.\nThe different techniques can be further subdivided according to whether the LOSVD is derived in a non-parametric way\n(in practice computed on a small set of discrete values) or\nparametrically, as a function of a limited number of parameters. In the latter case the Gauss-Hermite parametrization\nby van der Marel & Franx (1993) and Gerhard (1993) is essentially always adopted (but see, e.g., Zhao & Prada 1996,\nfor an alternative). However even when the LOSVD is determined non-parametrically, the Gauss-Hermite parameters are\nstill generally used to present the result in an easily understandable way.\nIn this paper we study again the problem of recovering, while working in pixel space, a LOSVD described by\nthe Gauss-Hermite parametrization. Compared to the nonparametric case, the process and the estimation of measurement errors are simplified. In Sec. 2 we describe the general\nproblem. In Sec. 3 we discuss different approaches to the extraction, we find that special care has to be taken when the\nLOSVD is undersampled by the data or the S/N is low, and\nwe present a solution based on the maximum penalized likelihood formalism. In Sec. 4 we draw some conclusions.\n2. FORMULATION OF THE PROBLEM\n\nThe parametric recovery of the LOSVD in pixel space starts\nwith creating a model galaxy spectrum Gmod (x), by convolving a template spectrum T (x) by a parametrized LOSVD.\nBoth the object and the template spectra are rebinned in wave-\n\n\f2\n\nCappellari & Emsellem\n\nlength to a linear scale in x = ln \u03bb, while usually preserving\nthe number of spectral pixels. The best-fitting parameters\nof the LOSVD are determined by minimizing the \u03c72 , which\nmeasures the agreement between the model and the observed\ngalaxy spectrum G(x), over the set of N good pixels:\n\u03c72 =\n\nN\nX\n\nrn2\n\n(1)\n\nn=1\n\nwhere the residuals are defined as\nGmod (xn ) \u2212 G(xn)\nrn =\n,\n(2)\n\u2206G(xn )\nwith \u2206G(xn ) the measurement error on G(xn ).\nMore specifically the following model is adopted for the\ngalaxy spectrum:\nGmod (x) =\n\nK\nX\nk=1\n\nwk [B \u2217 Tk ](x) +\n\nL\nX\nl=0\n\nbl Pl (x)\n\nwk \u2265 0,\n\n(3)\n\nwhere Tk is in general a library of K galaxy or stellar templates, B(x) = L(cx) is the broadening function, with L(v) the\nLOSVD, c is the speed of light and \u2217 denotes convolution.\nThe Pl (x) are here chosen to be the Legendre polynomials of\norder l and account for low frequency differences in shape between the galaxy and the templates. For each given L(v), the\noptimization of \u03c72 is a bounded-variables linear least-squares\nproblem for the weights (w1 , . . . , wK , b0 , . . . , bL ) which can be\nsolved, e.g., with the specific BVLS algorithm by Lawson &\nHanson (1995), or as a quadratic programming problem. Here\nwe are interested in the determination of the parameters defining L(v) and in what follows we will assume that the weights\nof Eq. (3) are always optimized in this way. Multiplicative\npolynomials can also be included in the fit (see Kelson et al.\n2000), without affecting the discussion that follows.\nFollowing van der Marel & Franx (1993) and Gerhard\n(1993) it has become standard to expand the LOSVD as a\nGauss-Hermite series\n\"\n#\n2\nM\nX\ne\u2212(1/2)y\n1+\nhm Hm (y)\n(4)\nL(v) = \u221a\n\u03c3 2\u03c0\nm=3\nwhere y = (v \u2212 V )/\u03c3 and the Hm are the Hermite polynomials.\nWith these definitions the minimization of the \u03c72 in Eq. (1)\nis a nonlinear least-squares optimization problem for the M\nparameters (V, \u03c3, h3 , . . . , hM ). Least-squares problems can be\nsolved much more efficiently than general ones, by using specific algorithms which require the user to provide the residuals\nrn of Eq. (2), to compute explicitly the Hessian matrix of the\n\u03c72 merit function (see, e.g., Press et al. 1992, \u00a715.5). Here we\nwill use the MINPACK1 implementation (Mor\u00e9 et al. 1980) of\nthe Levenberg-Marquardt method for nonlinear least-squares\nproblems.\n3. DISCUSSION\n\nIn this section we compare three different approaches to the\ndetermination of the best-fitting parameters of the LOSVD in\nEq. (4). We explain the limitations of the different methods\nand finally select the last one as the optimal choice. We do not\naddress here the template mismatch issue, which we assume\nis minimized by the choice of an optimal library of templates\nin Eq. (3) as in Emsellem et al. (2004).\n1 We used an IDL porting of the code by Craig B. Markwardt, available\nfrom the Web page http://cow.physics.wisc.edu/\u223ccraigm/idl/\n\nF IG . 1.- Double Gaussian representation (Eq. 5) of the LOSVD observed by Scorza & Bender (1995) at 17\u2032\u2032 along the major axis of the S0\ngalaxy NGC 3115 (solid line). The two individual Gaussian components are\nshown with the gray lines, while the best fitting fourth order Gauss-Hermite\nparametrization is plotted with the dashed line.\n\nTo explain the characteristics of the three methods, we will\nuse each of them to extract a realistic but known LOSVD,\nobserved by Scorza & Bender (1995) at r = 17\u2032\u2032 along the major axis of the S0 galaxy NGC 3115 (their Fig. A.2). This\nLOSVD (Fig. 1) is representative of the one observed in a\nnumber of galaxies, and can be very well described by a double Gaussian parametrization\n#\n\"\n2\nX\n(v \u2212 V j )2\n,\n(5)\nF(v) =\nI j exp\n2 \u03c3 2j\nj=1\n\nwith parameters I1 = 0.041, I2 = 0.032, V1 = 48.7 km s\u22121 , V2 =\n\u221277.3 km s\u22121 , \u03c31 = 70.0 km s\u22121 and \u03c32 = 130.0 km s\u22121 (the\nLOSVD was shifted to zero mean velocity).\nThe best fit to F(v) using a fourth order Gauss-Hermite\nseries (Eq. 4) is obtained with parameters V = 0.0 km s\u22121 ,\n\u03c3 = 114.8 km s\u22121 , h3 = \u22120.150 and h4 = 0.036, while the best\nfitting Gaussian has V = \u22122.3 km s\u22121 and \u03c3 = 118.9 km s\u22121 .\n3.1. Fitting (V, \u03c3) first\n\nIn an ideal situation where the LOSVD is perfectly sampled by the data, the (h3 , . . . , hM ) parameters of the LOSVD\n(Eq. 4) are essentially uncorrelated to (V, \u03c3). Therefore one\nexpects the best-fitting parameters to change little, irrespective of whether (V, \u03c3) are fitted first or together with the other\nparameters. To lowest order the difference between the two\napproaches is given by Eq. (10) of van der Marel & Franx\n(1993).\nAn advantage of fitting (V, \u03c3) first is that the Gauss-Hermite\nparameters that one obtains, coincide with the true GaussHermite moments integrated over the LOSVD (see van der\nMarel & Franx 1993, for a detailed discussion). This also\nmeans that the value of the parameters (h3 , . . . , hM ) do not depend on the adopted number M of terms in the expansion.\nThis precise relation between the LOSVD and the extracted\nkinematical parameters can be very useful for the dynamical\nmodeling (e.g. Rix et al. 1997).\nMoreover when only a single template is adopted (K = 1 in\nEq. 3), for each pair of (V, \u03c3) values the best fitting value of\nall the remaining parameters (w1 , h3 , . . . , hM , b0 , . . . , bL ) can be\ndetermined linearly. These ideas led van der Marel (1994) to\n\n\fPenalized Pixel Fitting\n\nF IG . 2.- Logarithmically rebinned galaxy model spectrum (thin noisy line)\nconvolved with the LOSVD of Fig. 1 and with added Poissonian noise at a\nS/N = 60. The dots represent the residual difference between this model and\nthe best fitting template (thick gray line). The spectrum covers the wavelength\nrange 4800-5380 \u00c5, with a pixel scale of 60 km s\u22121 , and includes prominent\nabsorption features of H\u03b2, Mg b and Fe5270.\n\ndesign an efficient method to fit the parameters of the LOSVD\nin pixel space, where (V, \u03c3) are fitted first and the remaining\nparameters are linearly expanded at the best fitting (V, \u03c3) solution.\nFor extracting the stellar kinematics of the 72 galaxies of\nthe SAURON survey (de Zeeuw et al. 2002) we needed to operate in pixel space to be able to deal with the contamination\ndue to emission-line gas present in most of the observed objects (Emsellem et al. 2004). The speed of van der Marel\n(1994) pixel fitting algorithm was an attractive feature, given\nthe large number (\u223c 200.000) of independent spectra from\nthe survey and the need to compute accurate errors by Monte\nCarlo simulations. However the observed LOSVDs are not\nalways well sampled by the SAURON pixel scale of dv \u2248 60\nkm s\u22121 . The Nyquist critical frequency for h4 is \u223c \u03c3/2. This\nmeans that undersampling becomes a problem for the derivation of the first four Gauss-Hermite moments of the LOSVD\nwhen the observed velocity dispersion is of the order of \u223c 2\npixels (for SAURON 120 km s\u22121 ).\nTo test the accuracy of the recovery of the Gauss-Hermite\nmoments using this method, when undersampling becomes\nsignificant, we first created a realistic model spectrum by fitting a (logarithmically rebinned) library of Vazdekis (1999)\ngalaxy model spectra to the average SAURON spectrum of the\nbarred lenticular galaxy NGC 3384. This spectrum was oversampled by smoothly interpolating it on a 30 times finer spectral grid and was subsequently convolved with the LOSVD of\nFig. 1. It was integrated over the SAURON pixels, in the wavelength range 4800-5380 \u00c5, and Poissonian noise was finally\nadded to represent the simulated galaxy spectrum G(x). The\ntemplate T (x) was obtained by integrating the original oversampled spectrum over the SAURON pixels. In Fig. 2 we show\nan example of such a spectrum, with noise added at S/N = 60.\nWe subsequently tried to recover the true Gauss-Hermite\nmoments, by fitting (V, \u03c3) first and expanding (h3 , . . . , hM ) linearly at the best fitting (V, \u03c3) location. To check our results we\ncomputed the true moments (\u01253 , \u01254 ), by analytically integrating over the LOSVD (Eq. 8 of van der Marel & Franx 1993),\nusing (V, \u03c3) of the best fitting Gaussian computed in Sec. 3.\nWe found \u01253 = \u22120.144 and \u01254 = 0.029, which as expected are\n\n3\n\nF IG . 3.- Fitting (V, \u03c3) first. Recovery of the stellar kinematics from a\nmodel galaxy spectrum convolved with the LOSVD of Fig. 1. The shape of\nthe LOSVD was held fixed, while the velocity scale was varied so that the \u03c3in\nof the best fitting Gauss-Hermite series varied in the range 48\u2013360 km s\u22121 ,\ncorresponding to 0.8\u20136 pixels. In these measurements V and \u03c3 were fitted\nfirst (nonlinearly) and only then h3 and h4 were fitted (linearly) with V and \u03c3\nfixed to the optimal values. In each panel the thick dotted line represents the\ntrue Gauss-Hermite moments, that the method is trying to recover, the thick\nsolid line indicates the value of the best fitting Gauss-Hermite parameters,\nwhile the crosses represent the actually measured values, as a function of\nthe input \u03c3in , for 1000 different Monte Carlo realizations with S/N = 60.\nThe thick noisy line shows the measured values for 100 realizations with a\nvery high S/N = 600. The recovered moments start becoming biased when\n\u03c3in . 240 (4 pixels), and this method becomes essentially insensitive to any\ndeviation from a Gaussian when \u03c3in . 120 km s\u22121 (2 pixels), at any S/N.\n\nvery close to the best fitting parameters computed before.\nThe result of this test, both for a S/N = 60 and S/N = 600,\nis shown in Fig. 3. Here the shape of the input LOSVD was\nheld fixed, but the velocity scale was varied so that the \u03c3in\nof the best fitting Gauss-Hermite series varied in the range\n48\u2013360 km s\u22121 , corresponding to 0.8\u20136 SAURON pixels, for\n1000 different Monte Carlo realizations. By construction, for\n\u03c3in = 114.8 km s\u22121 the LOSVD reduces to the one presented\nin Fig. 1. The recovery of the true moments is strongly biased when \u03c3in . 240 km s\u22121 (4 pixels). This can be understood by the fact that, when the LOSVD is not very well sampled, an asymmetry in the profile can be compensated, during\nthe Gaussian fit, by a small V shift, while a symmetric deviation from a Gaussian is nearly equivalent to a change of\n\u03c3. The bias in the recovery of the input parameters remains\nunchanged even for a noise-free model spectrum, although\nof course the scatter in the values disappears. And no improvement is observed if the template is oversampled before\nconvolving it with a well sampled LOSVD in Eq. (3). These\nresults are representative of what we found with different realistic input LOSVDs.\nWhat was seen in the simulation is also found on real\nSAURON data. The approach of fitting (V, \u03c3) first, becomes insensitive to any deviation from a Gaussian LOSVD, when the\nobserved velocity dispersion is low (. 120 km s\u22121 , or 2 pixels). As a practical example this method gives the misleading\nimpression that the LOSVD in the nucleus of a low-dispersion\nobject like NGC 3384, containing a fast-rotating disk-like\nstructure, is consistent with being essentially symmetric, as,\ne.g., the central LOSVD of the high-dispersion non-rotating\ngiant elliptical galaxy M 87. This apparent similarity of\nthe overall shape of LOSVD in the two different galaxies is\nan artefact of the extraction method, and we will show that\n\n\f4\n\nCappellari & Emsellem\n\nF IG . 4.- Same as in Fig. 3, but in this plot the four parameters (V, \u03c3, h3 , h4 )\nwere all fitted simultaneously (nonlinearly). Now the measurements are supposed to reproduce the best-fitting Gauss-Hermite parameters, which are indicated by the thick solid line. The measurements are generally unbiased, but\nno reliable h3 and h4 measurements can be obtained at S/N = 60 for \u03c3in . 120\nkm s\u22121 (2 pixels). At low \u03c3in the scatter in V and \u03c3 increases due to their\ncorrelation with h3 and h4 respectively. Moreover the measured \u03c3 tends to\nbe systematically lower than the true value, while h4 is correspondingly too\nhigh. In the case of very high S/N the strong asymmetry of the LOSVD can\nbe recovered, with a modest bias, down to the smallest \u03c3in values.\n\nit is still possible to recover, with a different method, the\nstrong asymmetry of the LOSVD from the SAURON data of\nNGC 3384, even at low dispersion.\n3.2. Fitting all parameters simultaneously\n\nThe bias present in the recovery of the Gauss-Hermite moments of an undersampled LOSVD, in the previous section,\nwas mainly due to the fact that (V, \u03c3) were not fitted simultaneously with the other LOSVD parameters. The fit should\nthen become generally unbiased when all (V, \u03c3, h3 , . . . , hM )\nparameters are varied simultaneously to optimize the fit. In\nthis way one should recover the best fitting parameters of the\nGauss-Hermite series, which do not precisely coincide with\nthe true Gauss-Hermite moments of the LOSVD. By definition this method will provide the lowest \u03c72 in the fit, and for\nthis reason it was also originally chosen by van der Marel &\nFranx (1993).\nIn Fig. 4 we repeated the experiment of the previous section while fitting all the above nonlinear parameters together.\nAs expected the solution is now almost unbiased and the measurements tend to be spread around the true input values, for\na wider \u03c3in range. However, when \u03c3in . 120 km s\u22121 (2 pixels) and the LOSVD is correspondingly not well sampled, the\nspectrum does not contain enough information to constrain\nall the free parameters and the scatter in the recovered values\nincreases dramatically.\nMoreover, at low \u03c3in , the \u03c3 and h4 values are not unbiased any more, not being symmetrically distributed around\nthe known input values. The reason for this asymmetry can\nbe understood by looking at the shape of the \u03c72 contours,\nwhich measure the agreement between the input spectrum\nG(x) and its best fitting model Gmod (x). In Fig. 5 we plot the\n\u2206\u03c72 = \u03c72 \u2212 \u03c72min contours for fits obtained by convolving G(x)\nwith the LOSVD of Fig. 1, while keeping V and h3 fixed to\nthe known best fitting values (Sec. 3) and varying \u03c3 and h4\nof Gmod (x). The narrow curved valley of nearly constant \u03c72 ,\nfor decreasing \u03c3 and increasing h4 from the location of the\nminimum \u03c72min , is due to the strong correlation between these\n\nF IG . 5.- Contours of the \u2206\u03c72 = \u03c72 \u2212 \u03c72min which measure the agreement\nbetween a simulated noiseless input galaxy spectrum G(x) and its best fitting\nmodel Gmod (x). As in Fig. 4 G(x) was convolved with the LOSVD of Fig. 1.\nThe \u2206\u03c72 is plotted as a function of \u03c3 and h4 of the LOSVD of Gmod (x),\nwhile V and h3 are kept fixed to the known best fitting values (Sec. 3). The\nplus sign indicates the location of the known best fitting (\u03c3, h4 ). The three\nlowest \u2206\u03c72 levels correspond to confidence levels of 1, 2 and 3\u03c3 (thick line)\nrespectively, for a S/N = 60, while other levels are separated by factors of 2.\nNote the narrow valley of nearly constant \u03c72 , for decreasing \u03c3 and increasing\nh4 , which is due to the undersampling of the LOSVD. At this \u03c3in a very high\nS/N is needed for the fit to converge to the true minimum.\n\ntwo parameters, which is caused by the undersampling, and\nproduces the effects seen in Fig. 4.\nWhen the errors in the measured parameters are large, one\nhas to make a scatter versus bias tradeoff decision. Usually\nwhen the data are unable to tightly constrain a large number\nof parameters one prefers to retain in the fit only the parameters that are required to significantly decrease the \u03c72 . For this\nreason, while fitting a parametric LOSVD, it is common practice to reduce the fit to (V, \u03c3) at low S/N: although the fit may\nbe biased by the lack of freedom in the model, an additional\nflexibility would not lead to meaningful measurements, and\nstructures and trends in the (V, \u03c3) values can still be detected\ndue to the decreased scatter.\nAnother problem of the large scatter that is present when fitting all parameters together is specific to the two-dimensional\n(2D) kinematical measurements obtained with an integralfield spectrograph. When presenting kinematics maps there\nis no easy way to also attach errors to the displayed values,\nand it becomes difficult to estimate from the maps when some\nstructure is real and when it is due to noise. For this reason\nit would be preferable to display on the kinematics maps only\nthe features that are statistically significant.\n3.3. Penalized pixel fitting\nThe LOSVD of galaxies is generally well reproduced by\na Gaussian (e.g., Bender, Saglia, & Gerhard 1994). For this\nreason one would like to use a technique to fit the LOSVD in\nwhich the solution is free to reproduce the details of the actual\nprofile when the S/N is high, but where the solution tends to a\nGaussian shape in case the S/N is low. This was done for the\ncase the LOSVD is described by a non-parametric function,\nby using the maximum penalized likelihood formalism (e.g.,\nMerritt 1997), and we refer to that paper for details. Here we\napply the formalism to the case where the LOSVD is parametrically expanded as a Gauss-Hermite series. We will show\nthat this leads to a much simpler and faster implementation\n\n\fPenalized Pixel Fitting\n\n5\n\nthan for the general case.\nThe idea is to fit the parameters (V, \u03c3, h3 , . . . , hM ) simultaneously as in Sec. 3.2, but to add an adjustable penalty term\nto the \u03c72 , to bias the solution towards a Gaussian shape, when\nthe higher moments are unconstrained by the data, so that the\npenalized \u03c72 becomes:\n\u03c72p = \u03c72 + \u03b1P.\n\n(6)\n\nA natural form for the penalty function P is given by the integrated square deviation of the line profile L(v) from its best\nfitting Gaussian G(v):\nR\u221e\n[L(v) \u2212 G(v)]2dv\n2\n.\n(7)\nD = \u2212\u221eR \u221e\n2\n\u2212\u221e G(v) dv\n\nThis penalty does not suppress noisy solutions, which are already excluded by the use of a low order parametric expansion\nfor L(v). It was shown by van der Marel & Franx (1993) that\nin the case where L(v) has the form of Eq. (4) then Eq. (7) is\nwell approximated by:\nD2 \u2248\n\nM\nX\n\nh2m .\n\n(8)\n\nm=3\n\nIn principle one could then define the penalty as P = D2 and\noptimize \u03c72p (Eq. 6). In practice however this is not desirable\nfor two reasons:\n\u2022 as explained in Sec. 2, it is computationally much more\nefficient to minimize the residuals rn (Eq. 2) instead of\nexplicitly compute the \u03c72 ;\n\u2022 one needs a way to automatically adjust the penalty factor \u03b1 according to the \u03c72 of the observed fit.\nWe found that a simple and effective solution to these problems consists of using the following perturbed residuals as\ninput to the nonlinear least-squares optimizer:\nrn\u2032 = rn + \u03bb \u03c3(r) D,\n\n(9)\n\nwhere the variance is defined as\n\nN\n\n\u03c3 2 (r) =\n\n1X 2\nrn .\nN\n\n(10)\n\nn=1\n\nThe qualitative interpretation of this formula is that a deviation D of the LOSVD from a Gaussian shape will be accepted\nas an improvement of the fit, only if it is able to correspondingly decrease the scatter \u03c3(r) by an amount related to D. To\nquantify one can compute the objective function of the fit\n\u03c72p =\n\nN\nX\nn=1\n\nrn2 + 2\u03bb\u03c3(r)D\n\nN\nX\n\nrn + N [\u03bb\u03c3(r)D]2 .\n\n(11)\n\nn=1\n\nvalid as an approximation. One can see from this formula\nthat, with \u03bb = 1, a deviation D = 10% of the LOSVD from a\nGaussian (e.g., h3 = 0.1 and hm = 0) requires a corresponding\ndecrease in the scatter \u03c3(r) of the unperturbed residuals by\nmore than (1 + D2 )1/2 = 0.5% to be accepted by the optimization routine as an improvement of the fit.\nA statistical interpretation of Eq. (12) can be obtained by\nconsidering that for a good fit \u03c72 \u223c N. For a given \u03bb a deviation D from a Gaussian needs to decrease \u03c72 by more than\n\u2206\u03c72 \u223c N\u03bb2 D2 to be accepted, and this variation can be associated to a specific confidence level (see, e.g., Press et al.\n1992, \u00a715.6) at which a Gaussian shape is excluded. Although\nthis formula may serve as a guideline, we believe it is safer to\ntest a choice of \u03bb using simulations as the ones presented.\nA test of the application of Eq. (9) to the same model spectra of Sec. 3.2 is shown in Fig. 6. For the same S/N = 60 as\nbefore, using \u03bb = 0.7, the measurements are now essentially\nunbiased when \u03c3in & 120 km s\u22121 (2 pixels). For lower input\ndispersion the LOSVD converges towards a Gaussian and, as\nexpected, the bias becomes similar to Fig. 3. However the\ncrucial difference with the previous case consists of the fact\nthat for higher S/N = 600 the solution tends to converge to\nthe known best fitting values, due to the fact that the penalty\nscales with the \u03c72 .\nWe mention here that alternative forms to Eq. (9) are possible, with the requirement that the objective function has the\nform (6). One possibility is to include a multiplicative perturbation of the residuals:\nrn\u2032 = rn (1 + \u03bbD2).\n\n(13)\n\nIn this case the objective function becomes\n\nThe sum of the residuals in the second term is zero by construction, due to the fact that the weights are optimized for\ngiven L(v) (Sec. 2; this is required for this form of perturbation to work). Considering the definition of variance (Eq. 10)\none can finally write\n\u03c72p = \u03c72 (1 + \u03bb2D2 ),\n\nF IG . 6.- Penalized pixel fitting. Same as in Fig. 4 but using the new\npenalized parametric pixel fitting method with \u03bb = 0.7. At S/N = 60 the bias\non the parameters is now significant only when \u03c3in goes below about 120\nkm s\u22121 (2 pixels). But more importantly the fit tends to converge to the true\nsolution even for low \u03c3in at the higher S/N = 600.\n\n(12)\n\nwhich is of the desired form (6) with \u03b1 = \u03bb2 \u03c72 automatically scaled according to the \u03c72 of the fit. In practice \u03c3(r)\nin Eq. (9) is computed using a robust biweight estimator\n(Hoaglin, Mosteller, & Tukey 1983), so that Eq. (12) is only\n\n\u03c72p = \u03c72 (1 + 2\u03bbD2 + \u03bb2 D4 ),\n\n(14)\n4\n\nand if one neglects the small term containing D , this becomes\nagain of the form (6), with \u03b1 = 2\u03bb\u03c72 . We verified that in practice this alternative form of perturbing the residuals produces\nvirtually the same results as using Eq. (9), if the same \u03b1 parameter is adopted. We prefer the perturbation (9) given its\nrobustness against outliers, due to the use of the biweight in\nthe computation of \u03c3(r). The form (13) may be useful in implementations where the average residuals are not zero for a\ngiven L(v).\n\n\f6\n\nCappellari & Emsellem\n\nF IG . 7.- Comparison between the Voronoi 2D-binned (Cappellari & Copin 2003) SAURON stellar kinematics of the barred lenticular galaxy NGC 3384\nextracted with the different methods explored in this paper. Top panels: kinematics extracted by first fitting (V, \u03c3) (nonlinearly) and then expanding the (h3 , h4 )\nparameters at the optimal (V, \u03c3) location. The Gauss-Hermite parameters are everywhere significantly suppressed by this method. Middle panels: kinematics\nobtained by fitting (V, \u03c3, h3 , h4 ) simultaneously, without penalty. Due to the \u03c3\u2013h4 correlation (Fig. 5), caused by the undersampling of the LOSVD, the \u03c3 is\nnoisier and depressed, while h4 tends to be strongly positive. The h3 values fluctuates in the outer parts between large positive and negative values. Bottom\npanels: the kinematics measured with the new penalized PXF method (with \u03bb = 0.7). This overcomes the problems of the two previous approaches. Only the\nstatistically significant non-Gaussian features are preserved, otherwise the solution is smoothly reduced to a Gaussian. Contours of the reconstructed surface\nbrightness are superimposed (in 1 mag arcsec\u22122 steps).\n\nIn Fig. 7 we compare the three different approaches to the\nrecovery of the LOSVD by using them to extract the stellar kinematics from SAURON (Bacon et al. 2001) integralfield spectroscopic observations of the galaxy NGC 3384 (see\nde Zeeuw et al. 2002, for a description of the observations),\nwhich has a rather low velocity dispersion over the whole observed field. The data cube was spatially binned to a minimum\nS/N = 60 using the Voronoi 2D-binning method by Cappellari\n& Copin (2003). The same differences that we observed using\nsynthetic model spectra can also be seen from real data:\n\u2022 The Gauss-Hermite parameters are everywhere significantly suppressed when fitting V and \u03c3 first (top panels);\n\u2022 the simultaneous fit of all parameters (middle panels)\ntends to produce a velocity dispersion map which is\nnoisier and has smaller values, while h4 tends to be\nstrongly positive. The h3 values fluctuate in the outer\nparts between large positive and negative values;\n\u2022 the use of a penalty function (bottom panels) overcomes\nthe problems of the two previous approaches. Only the\nstatistically significant non-Gaussian features are preserved, otherwise the solution is smoothly reduced to a\nGaussian.\nWe also applied the three methods to the extraction of the\nkinematics of all the 48 early-type galaxies of the SAURON\n\nsurvey (de Zeeuw et al. 2002). As expected from the simulations, the three techniques gave very different results only for\ngalaxies like NGC 3384, which have a low velocity dispersion. The kinematics extracted from SAURON observations\nof galaxies with dispersion & 180 km s\u22121 over the whole observed field provided very similar result with the three methods (though by construction not identical).\n3.4. Errors on the fitted parameters\n\nThe availability of fast computers makes Monte Carlo simulations the preferred way to estimate measurements errors\nfor LOSVD extraction methods. This consists of repeating\nthe full measurement process for a large number of different\nrealization of the data, obtained by adding noise to the original spectra.\nThe method discussed in this paper, like many other available methods for extracting the LOSVD, makes use of some\nform of filtering or penalization of the solution, thus biasing\nthe results to suppress the noise. It may be worth emphasizing that, when computing Monte Carlo errors, one has to\ncorrect for the bias in the measurements, introduced by the\nnoise suppression mechanism. Failure to correct for the bias\nin the kinematics can provide a significant underestimation of\nthe confidence intervals of parameters determined by fitting\ndynamical models to the data.\nOne way to obtain proper errors from penalized methods\nconsists of correcting the error estimates by increasing the\n\n\fPenalized Pixel Fitting\npercentile intervals by an amount given by the bias (e.g.,\nBeers, Flynn, & Gebhardt 1990). In real measurements one\ndoes not know the actual bias (otherwise the measurements\nwould have been corrected for it), so an estimate of the maximum expected bias may be used instead. This requires one to\nperform Monte Carlo simulations of the kinematic extraction\nto determine the maximum bias at different S/N levels and\n\u03c3in values.\nA simpler order of magnitude estimate of the errors on the\nparameters may be obtained by noting that Fig. 4 provides\na more realistic representation of the scatter in the measurements than Fig. 6, at low \u03c3in values. In the case of the penalized pixel fitting routine described in the previous section\none can then obtain the errors by setting the parameter \u03bb in\nEq. (9) to a very small value before running the Monte Carlo\nsimulations. This simple approach will generally provide a\nconservative estimate of the actual errors.\n3.5. The algorithm\nTo summarize the discussion of the previous sections, the\nsuggested algorithm for recovering the LOSVD parametrized\nas a Gauss-Hermite series is the following:\n\n1. start with an initial guess for the parameters (V, \u03c3),\nwhile setting the initial Gauss-Hermite parameters\nh3 , . . . , hM = 0;\n2. solve the subproblem of Eq. (3) for the weights\n(w1 , . . . , wK , b0 , . . . , bL );\n3. compute the residuals rn from the fit using Eq. (2);\n4. perturb the residuals as in Eq. (9) to get rn\u2032 ;\n5. feed the perturbed residuals rn\u2032 into a nonlinear leastsquares optimization routine and iterate the procedure\nfrom step (2), to fit for the parameters (V, \u03c3, h3 , . . . , hM ).\n\n7\n\n3.6. Availability\nAn IDL routine implementing the algorithm described\nin this work is made available from the Web address\nhttp://www.strw.leidenuniv.nl/\u223cmcappell/idl/.\n4. CONCLUSIONS\n\nIn this paper we addressed the problem of extracting the\nLOSVD of the stars, parametrized using a Gauss-Hermite\nseries, from observed galaxy spectra. Using a method that\nworks directly in pixel space, we compared different techniques by applying them to the same problem, with both simulated and real data, and we showed that one has to pay special attention to the extraction, when the LOSVD is not well\nsampled by the data, or when the S/N is low.\nWe proposed that in these situations one should apply the\nmaximum penalized likelihood formalism to extract as much\ninformation as possible from the spectra, while suppressing\nthe noise in the solution. We demonstrated that this leads to\na fast and simple algorithm. We also discussed how Monte\nCarlo errors should be properly estimated. This penalized\npixel fitting method is particularly useful to extract the kinematics from integral-field spectroscopic data, as for 2D maps\nthere is no standard way to visualize errors and one wants to\nbe able to show only the non-Gaussian features that are statistically significant. A routine that implements the ideas of this\npaper is made publicly available.\nWe thank the SAURON team for making the data available, and in particular Richard McDermid for fruitful discussions and testing of the method, Tim de Zeeuw, Jesus Falc\u00f3nBarroso, Davor Krajnovi\u0107 and Glenn van de Ven for commenting on the draft. We are grateful to the referee Roeland\nvan der Marel, for useful comments that improved the presentation of this work. MC acknowledges support from a VENI\ngrant awarded by the Netherlands Organization of Scientific\nResearch (NWO).\n\nREFERENCES\nBacon, R., et al. 2001, MNRAS, 326, 23\nBeers, T. C., Flynn, K., & Gebhardt, K. 1990, AJ, 100, 32\nBender, R. 1990, A&A, 229, 441\nBender, R., Saglia, R. P., & Gerhard, O. E. 1994, MNRAS, 269, 785\nCappellari, M., & Copin, Y. 2003, MNRAS, 342, 345\nde Bruyne, V., Vauterin, P., de Rijcke, S., & Dejonghe, H. 2003, MNRAS,\n339, 215\nDejonghe, H., & Merritt, D. 1992, ApJ, 391, 531\nde Zeeuw, P. T., et al. 2002, MNRAS, 329, 513\nEmsellem, E., et al. 2004, MNRAS, submitted\nFranx, M., & Illingworth, G. D. 1988, ApJ, 327, L55\nGebhardt, K., et al. 2000, AJ, 119, 1157\nGerhard, O. E. 1993, MNRAS, 265, 213\nHoaglin, D. C., Mosteller, F., & Tukey, J. W. 1983, Understanding Robust\nand Exploratory Data Analysis (New York: Wiley)\nKelson, D. D., Illingworth, G. D., van Dokkum, P. G., & Franx, M. 2000,\nApJ, 531, 159\nKuijken, K., & Merrifield, M. R. 1993, MNRAS, 264, 712\nLawson, C. L., & Hanson, R. 1995, Solving Least Squares Problems (2d ed.;\nEnglewood Cliffs, NJ: Prentice-Hall)\nMerritt, D. 1997, AJ, 114, 228\n\nMor\u00e9, J. J., Garbow, B. S., & Hillstrom, K. E. 1980, User Guide for\nMINPACK-1, Argonne National Laboratory Report ANL-80-74\nPress, W. H., Teukolsky, S. A., Vetterling, W. T., & Flannery, B. P. 1992,\nNumerical Recipes in FORTRAN 77 (2d ed; Cambridge: Cambridge Univ.\nPress)\nRix, H.-W., & White, S. D. M. 1992, MNRAS, 254, 389\nRix, H.-W., de Zeeuw, P. T., Cretton, N., van der Marel, R. P., & Carollo,\nC. M. 1997, ApJ, 488, 702\nSaha, P., & Williams, T. B. 1994, AJ, 107, 1295\nSargent, W. L. W., Schechter, P. L., Boksenberg, A., & Shortridge, K. 1977,\nApJ, 212, 326\nScorza, C., & Bender, R. 1995, A&A, 293, 20\nSimkin, S. M. 1974, A&A, 31, 129\nStatler, T. 1995, AJ, 109, 1371\nTonry, J., & Davis, M. 1979, AJ, 84, 1511\nvan der Marel, R. P., & Franx, M. 1993, ApJ, 407, 525\nvan der Marel, R. P. 1994, MNRAS, 270, 271\nVazdekis, A. 1999, ApJ, 513, 224\nZhao, H.-S., & Prada, F. 1996, MNRAS, 282, 1223\n\n\f"}