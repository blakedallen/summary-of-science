{"id": "http://arxiv.org/abs/0805.2978v2", "guidislink": true, "updated": "2009-05-06T14:03:48Z", "updated_parsed": [2009, 5, 6, 14, 3, 48, 2, 126, 0], "published": "2008-05-19T22:31:25Z", "published_parsed": [2008, 5, 19, 22, 31, 25, 0, 140, 0], "title": "Adjoint functors and tree duality", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0805.0076%2C0805.1615%2C0805.3619%2C0805.4246%2C0805.0587%2C0805.2481%2C0805.0264%2C0805.3269%2C0805.0996%2C0805.2894%2C0805.0456%2C0805.3679%2C0805.2083%2C0805.0697%2C0805.2100%2C0805.0003%2C0805.3384%2C0805.3901%2C0805.3489%2C0805.3655%2C0805.2204%2C0805.4807%2C0805.0062%2C0805.4055%2C0805.1794%2C0805.1619%2C0805.4468%2C0805.4310%2C0805.3178%2C0805.3381%2C0805.1434%2C0805.3245%2C0805.2778%2C0805.2089%2C0805.0162%2C0805.2171%2C0805.0980%2C0805.2213%2C0805.4607%2C0805.4238%2C0805.4033%2C0805.3040%2C0805.4582%2C0805.4057%2C0805.2978%2C0805.4687%2C0805.2545%2C0805.2302%2C0805.0728%2C0805.2929%2C0805.0805%2C0805.2677%2C0805.2744%2C0805.4271%2C0805.3919%2C0805.2930%2C0805.2499%2C0805.2532%2C0805.1263%2C0805.0611%2C0805.4680%2C0805.4629%2C0805.2919%2C0805.2087%2C0805.3109%2C0805.1866%2C0805.1706%2C0805.3836%2C0805.2362%2C0805.2342%2C0805.0183%2C0805.4042%2C0805.3610%2C0805.3121%2C0805.1730%2C0805.1986%2C0805.4082%2C0805.2643%2C0805.3730%2C0805.4714%2C0805.0665%2C0805.0733%2C0805.1148%2C0805.1580%2C0805.0095%2C0805.3218%2C0805.1456%2C0805.1208%2C0805.4694%2C0805.4171%2C0805.0231%2C0805.3543%2C0805.3502%2C0805.4135%2C0805.0431%2C0805.4783%2C0805.2550%2C0805.3596%2C0805.1869%2C0805.3453%2C0805.3141&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Adjoint functors and tree duality"}, "summary": "A family T of digraphs is a complete set of obstructions for a digraph H if\nfor an arbitrary digraph G the existence of a homomorphism from G to H is\nequivalent to the non-existence of a homomorphism from any member of T to G. A\ndigraph H is said to have tree duality if there exists a complete set of\nobstructions T consisting of orientations of trees. We show that if H has tree\nduality, then its arc graph delta H also has tree duality, and we derive a\nfamily of tree obstructions for delta H from the obstructions for H.\n  Furthermore we generalise our result to right adjoint functors on categories\nof relational structures. We show that these functors always preserve tree\nduality, as well as polynomial CSPs and the existence of near-unanimity\nfunctions.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0805.0076%2C0805.1615%2C0805.3619%2C0805.4246%2C0805.0587%2C0805.2481%2C0805.0264%2C0805.3269%2C0805.0996%2C0805.2894%2C0805.0456%2C0805.3679%2C0805.2083%2C0805.0697%2C0805.2100%2C0805.0003%2C0805.3384%2C0805.3901%2C0805.3489%2C0805.3655%2C0805.2204%2C0805.4807%2C0805.0062%2C0805.4055%2C0805.1794%2C0805.1619%2C0805.4468%2C0805.4310%2C0805.3178%2C0805.3381%2C0805.1434%2C0805.3245%2C0805.2778%2C0805.2089%2C0805.0162%2C0805.2171%2C0805.0980%2C0805.2213%2C0805.4607%2C0805.4238%2C0805.4033%2C0805.3040%2C0805.4582%2C0805.4057%2C0805.2978%2C0805.4687%2C0805.2545%2C0805.2302%2C0805.0728%2C0805.2929%2C0805.0805%2C0805.2677%2C0805.2744%2C0805.4271%2C0805.3919%2C0805.2930%2C0805.2499%2C0805.2532%2C0805.1263%2C0805.0611%2C0805.4680%2C0805.4629%2C0805.2919%2C0805.2087%2C0805.3109%2C0805.1866%2C0805.1706%2C0805.3836%2C0805.2362%2C0805.2342%2C0805.0183%2C0805.4042%2C0805.3610%2C0805.3121%2C0805.1730%2C0805.1986%2C0805.4082%2C0805.2643%2C0805.3730%2C0805.4714%2C0805.0665%2C0805.0733%2C0805.1148%2C0805.1580%2C0805.0095%2C0805.3218%2C0805.1456%2C0805.1208%2C0805.4694%2C0805.4171%2C0805.0231%2C0805.3543%2C0805.3502%2C0805.4135%2C0805.0431%2C0805.4783%2C0805.2550%2C0805.3596%2C0805.1869%2C0805.3453%2C0805.3141&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "A family T of digraphs is a complete set of obstructions for a digraph H if\nfor an arbitrary digraph G the existence of a homomorphism from G to H is\nequivalent to the non-existence of a homomorphism from any member of T to G. A\ndigraph H is said to have tree duality if there exists a complete set of\nobstructions T consisting of orientations of trees. We show that if H has tree\nduality, then its arc graph delta H also has tree duality, and we derive a\nfamily of tree obstructions for delta H from the obstructions for H.\n  Furthermore we generalise our result to right adjoint functors on categories\nof relational structures. We show that these functors always preserve tree\nduality, as well as polynomial CSPs and the existence of near-unanimity\nfunctions."}, "authors": ["Jan Foniok", "Claude Tardif"], "author_detail": {"name": "Claude Tardif"}, "author": "Claude Tardif", "arxiv_comment": "14 pages, 2 figures; v2: minor revisions", "links": [{"href": "http://arxiv.org/abs/0805.2978v2", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/0805.2978v2", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "math.CO", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "math.CO", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "math.CT", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "16B50, 68R10, 05C15, 18A40", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/0805.2978v2", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/0805.2978v2", "journal_reference": "Discrete Math. Theor. Comput. Sci., 11(2), pp. 97-110, 2009", "doi": null, "fulltext": "Adjoint functors and tree duality\narXiv:0805.2978v2 [math.CO] 6 May 2009\n\nJan Foniok\nETH Zurich, Institute for Operations Research\nR\u00e4mistrasse 101, 8092 Zurich, Switzerland\nfoniok@math.ethz.ch\n\nClaude Tardif\nRoyal Military College of Canada\nPO Box 17000, Stn Forces, Kingston, Ontario\nCanada, K7K 7B4\nClaude.Tardif@rmc.ca\n\n6 May 2009\n\nA family T of digraphs is a complete set of obstructions for a digraph H if\nfor an arbitrary digraph G the existence of a homomorphism from G to H is\nequivalent to the non-existence of a homomorphism from any member of T\nto G. A digraph H is said to have tree duality if there exists a complete set\nof obstructions T consisting of orientations of trees. We show that if H has\ntree duality, then its arc graph \u03b4H also has tree duality, and we derive a\nfamily of tree obstructions for \u03b4H from the obstructions for H.\nFurthermore we generalise our result to right adjoint functors on categories\nof relational structures. We show that these functors always preserve tree\nduality, as well as polynomial CSPs and the existence of near-unanimity\nfunctions.\nKeywords: constraint satisfaction, tree duality, adjoint functor\n2000 Mathematics Subject Classification: 16B50, 68R10, 18A40,\n05C15\n\n1 Introduction\nOur primary motivation is the H-colouring problem (which has become popular under\nthe name Constraint Satisfaction Problem-CSP ): for a fixed digraph H (a template)\ndecide whether an input digraph G admits a homomorphism to H. The computational\ncomplexity of H-colouring depends on the template H. For some templates the problem\n\n1\n\n\ftractable\n\nbounded treewidth duality\n\nnuf\n\u03b4\u03c0 C\n\ntree\nduality\n\nfin. duality\n\nbounded\nheight\ntree\nduality\n\nFigure 1: The structure of tractable templates\nis known to be NP-complete, for others it is tractable (a polynomial-time algorithm exists). Assuming that P 6= NP, infinitely many complexity classes lie strictly between P\nand NP [10], but it has been conjectured that H-colouring belongs to no such intermediate class for any template H [3]. This conjecture has indeed been proved for symmetric\ntemplates H [5].\nIn this paper the focus is on tractable cases. Several conditions are known to imply\nthe existence of a polynomial-time algorithm for H-colouring (definitions follow in the\nnext two paragraphs): it is the case if H has a near-unanimity function (nuf), if H has\nbounded-treewidth duality, if H has tree duality, if H has finite duality (see [2, 3, 7]).\nSome of the conditions are depicted in the diagram (Fig. 1).\nA near-unanimity function is a homomorphism f from H k to H with k \u2265 3 such\nthat for all x, y \u2208 V (H) we have f (x, x, x, . . . , x) = f (y, x, x, . . . , x) = f (x, y, x, . . . , x) =\n* * * = f (x, x, x, . . . , y) = x. The power H k is the k-fold product H \u00d7 H \u00d7 * * * \u00d7 H in the\ncategory of digraphs and homomorphisms, see [6].\nA digraph is a tree (has treewidth k) if its underlying undirected graph is a tree (has\ntreewidth k, respectively). A set F of digraphs is a complete set of obstructions for H if\nfor an arbitrary digraph G there exists a homomorphism from G to H if and only if no\nF \u2208 F admits a homomorphism to G. A template has bounded-treewidth duality if it has\na complete set of obstructions with treewidth bounded by a constant; it has tree duality\nif it has a complete set of obstructions consisting of trees; and it has finite duality if it\n\n2\n\n\fhas a finite complete set of obstructions.\nThere is a fairly straightforward way to generate templates with finite duality. For\nan arbitrary tree T there exists a digraph D(T ) such that {T } is a complete set of\nobstructions for D(T ). The digraph D(T ) is unique up to homomorphic equivalence\u2217 ;\nit is called the dual of T . Several explicit constructions are\nQ known (see [4, 9, 15, 16]). If\nF is a finite set of oriented trees, then the product D = T \u2208F D(T ) is a template with\nfinite duality and F is a complete set of obstructions for D. This construction yields all\ndigraphs with finite duality [15], thus also proving that finite duality implies tree duality.\nEncouraged by the full description of finite dualities, we aim to provide a construction\nfor some more digraphs with tree duality. To this end we use the arc-graph construction\nand consider the class \u03b4\u03c0 C of digraphs generated from finite duals by taking iterated\narc graphs and finite Cartesian products. We show that all templates in this class have\ntree duality. We provide an explicit construction of the resulting tree obstructions,\nwhich allows us to show that all the digraphs in \u03b4\u03c0 C have in fact bounded-height tree\nduality, that is, they have a complete set of obstructions consisting of trees of bounded\nalgebraic height (these are tree obstructions that allow a homomorphism to a fixed\ndirected path). In this context we also prove that the problem of existence of a complete\nset of obstructions consisting of trees with bounded algebraic height is decidable.\nThe arc-graph construction is a special case of a more general phenomenon: it is a\nright adjoint in the category of digraphs and homomorphisms. We show in the more\ngeneral setting of the category of relational structures that right adjoints (characterised\nby Pultr [17] for all locally presentable categories) preserve tractability of templates and\nmoreover they preserve tree duality and existence of a near-unanimity function. In this\ncase, nevertheless, it remains open to provide a nice general description of complete sets\nof obstructions.\nWe use some notions and properties of graphs and homomorphisms which the reader\ncan look up in [6], as well as some category-theory notions, for which, e.g. [1, 13] may\nbe consulted.\n\n2 Arc graphs and tree duality\nLet G = (V, A) be a digraph. The arc graph of G is the digraph \u03b4G = (A, \u03b4A), where\n\b\n\u03b4A = ((u, v), (v, w)) : (u, v), (v, w) \u2208 A .\nNotice that \u03b4 is an endofunctor\u2217\u2217 in the category of digraphs and homomorphisms. This\nimplies in particular that if G \u2192 H, then \u03b4G \u2192 \u03b4H. (The notation G \u2192 H means that\nthere exists a homomorphism from G to H.)\nIf G is a digraph and \u223c is an equivalence relation on its vertex set V (G), the quotient G/\u223c is the digraph (V (G)/\u223c, A), where V (G)/\u223c is the set of all equivalence classes\n\u2217\n\nTwo digraphs H and H \u2032 are homomorphically equivalent if there exists a homomorphism from H\nto H as well as a homomorphism from H \u2032 to H. Clearly, if H and H \u2032 are homomorphically equivalent,\nthen H-colouring and H \u2032 -colouring are equivalent problems, because H and H \u2032 admit homomorphisms\nfrom exactly the same digraphs.\n\u2217\u2217\nAn endofunctor is a functor from a category to itself.\n\u2032\n\n3\n\n\fof \u223c on V (G), and for X, Y \u2208 V (G)/\u223c we have (X, Y ) \u2208 A if and only if there exist\nx \u2208 X and y \u2208 Y such that (x, y) \u2208 A(G).\nSuppose still that G = (V, A) is a digraph. Let V \u2032 = {ou , tu : u \u2208 V } and let\n\u2032\nA = {(ou , tu ) : u \u2208 V }. Define the relation \u223c0 such that tu \u223c0 ov if and only if (u, v) \u2208 A.\nLet \u223c be the minimal equivalence relation on V \u2032 containing \u223c0 . Set \u03b4\u22121 G = (V \u2032 , A\u2032 )/\u223c.\nIn the following, we use the notation V \u2032 (G) = V \u2032 , A\u2032 (G) = A\u2032 and \u223c0 and \u223c for the\nsets and relations appearing in the definition of \u03b4\u22121 ; the precise meaning will be clear\nfrom the context. Now \u03b4\u22121 is also an endofunctor in the category of digraphs. Strictly\nspeaking, it is not an inverse of \u03b4; its name is chosen because of the following property.\nProposition 1. For any digraphs G and H,\nG \u2192 \u03b4H\n\nif and only if\n\n\u03b4\u22121 G \u2192 H.\n\nProof. Let f : G \u2192 \u03b4H be a homomorphism. Then there exist two homomorphisms\no, t : G \u2192 H such that f (u) = (o(u), t(u)) for all u \u2208 V (G). Define the mapping\n\u011d : V \u2032 (G) \u2192 V (H) by \u011d(ou ) = o(u) and \u011d(tu ) = t(u). If tu \u223c0 ov , then (u, v) \u2208 A(G),\nwhence (f (u), f (v)) \u2208 A(\u03b4H) and thus t(u) = o(v). Therefore \u011d is constant on the\nequivalence classes of \u223c, and it induces a homomorphism from A\u2032 (G)/\u223c = \u03b4\u22121 G to H.\nConversely, let g : \u03b4\u22121 G \u2192 H be a homomorphism. We define f : V (G) \u2192 V (\u03b4H) by\nf (u) = (g(ou /\u223c), g(tu /\u223c)). If (u, v) \u2208 A(G), then tu /\u223c = ov /\u223c, whence (f (u), f (v)) \u2208\nA(\u03b4H). Therefore f is a homomorphism.\nThus \u03b4 and \u03b4\u22121 are Galois adjoints\u2217 with respect to the ordering by existence of\nhomomorphisms. They are in fact adjoint functors in the category of digraphs and\nhomomorphisms. We return to this topic in Section 4. For the moment we aim to prove\nthat \u03b4 preserves tree duality. More precisely, from the family T of tree obstructions\nof H, we will derive the family Sproink(T ) of tree obstructions of \u03b4H.\nThe algebraic height of an oriented tree T is the minimum number of arcs of a directed\npath to which T maps homomorphically. The algebraic height of every finite oriented\ntree is well-defined and finite, since every such tree admits a homomorphism to some\nfinite directed path. Thus a tree T is of height at most one if its vertex set can be split\ninto two parts 0T , 1T in such a way that for every arc (x, y) of T we have x \u2208 0T and\ny \u2208 1T . Note that if the tree T has no arcs, then it has only one vertex and thus one of\nthe sets 0T , 1T is empty and the other one is a singleton.\nLet T be a tree. For every vertex u of T , let F (u) be a tree of height at most one. For\neach arc e of T incident with u, let there be a fixed vertex v(e, F (u)) in F (u) such that\nif u is the initial vertex of e, then v(e, F (u)) \u2208 1F (u) , and if u is the terminal vertex of e,\nthen v(e, F (u)) \u2208 0F (u) .\u2217\u2217 A tree S is now constructed by taking all the trees F (u) for\nall vertices u of T , and by identifying the vertex v(e, F (u)) with v(e, F (u\u2032 )) whenever\ne = (u, u\u2032 ) is an arc of T .\n\u2217\n\nLet X and Y be partially ordered sets. Mappings \u03c6 : X \u2192 Y and \u03c8 : Y \u2192 X are Galois adjoints\nif \u03c6(x) \u2264Y y \u21d4 x \u2264X \u03c8(y) for all elements x \u2208 X and y \u2208 Y .\n\u2217\u2217\nIt follows that if u is neither a source nor a sink of T , then both 0F (u) and 1F (u) are non-empty,\nand so in this case F (u) is not a single vertex. If u is a source or a sink of T , then F (u) may be an\narbitrary tree of height at most one.\n\n4\n\n\fAny such tree S constructed from T by the above procedure is called a sproink of T .\nThe set of all sproinks of a tree T is denoted by Sproink(T ). The following lemma\nasserts that sproinks of obstructions for a template H are indeed obstructions for its arc\ngraph \u03b4H.\nLemma 2. Let T be a tree and H a digraph such that T 9 H. If S \u2208 Sproink(T ), then\nS 9 \u03b4H.\nProof. We prove that T \u2192 \u03b4\u22121 S. Consequently \u03b4\u22121 S 9 H because T 9 H, and\ntherefore S 9 \u03b4H by Proposition 1.\nThus let S \u2208 Sproink(T ). For a vertex u of T , consider the tree F (u), which is a\nsubgraph of S. Since F (u) has height at most one, its vertices are partitioned into\nthe sets 0F (u) and 1F (u) . The set V \u2032 (S), which appears in the definition of \u03b4\u22121 S, contains V \u2032 (F (u)) as a subset. If (x, y) is an arc of F (u), then tx \u223c0 oy . Thus whenever\nx \u2208 0F (u) and y \u2208 1F (u) , then tx \u223c oy . Hence for any vertex u of T there exists a unique\nvertex f (u) of \u03b4\u22121 S that is equal to tx /\u223c for all x \u2208 0F (u) and to oy /\u223c for all y \u2208 1F (u) .\nIn this way, we have defined a mapping f : V (T ) \u2192 V (\u03b4\u22121 S).\nNow assume that e = (u, v) is an arbitrary arc of T . Then the vertex v(e, F (u)), which\nbelongs to 1F (u) , has been identified with v(e, F (v)), which belongs to 0F (v) . Let this\nidentified vertex be x; it is a vertex of S. By definition, f (u) = ox /\u223c because x \u2208 1F (u) ,\nand f (v) = tx /\u223c because x \u2208 0F (v) . Of course (ox /\u223c, tx /\u223c) \u2208 A(\u03b4\u22121 S). Therefore\nf : T \u2192 \u03b4\u22121 S is a homomorphism, as we have promised to prove.\nS\nFor a set F of trees, let Sproink(F) = T \u2208F Sproink(T ).\nTheorem 3. Let F be a set of trees which is a complete set of obstructions for a\ntemplate H. Then Sproink(F) is a complete set of obstructions for \u03b4H.\nProof. Lemma 2 implies that Sproink(F) is a set of obstructions for \u03b4H. It remains\nto prove that it is complete, that is whenever G 9 \u03b4H, then there exists some S \u2208\nSproink(F) such that S \u2192 G.\nSo let G 9 \u03b4H. Thus by Proposition 1 we have \u03b4\u22121 G 9 H. Hence there exists a\ntree T \u2208 F such that T \u2192 \u03b4\u22121 G, because F is a complete set of obstructions for H.\nConsequently it suffices to prove that if T \u2192 \u03b4\u22121 G then there exists S \u2208 Sproink(T )\nsuch that S \u2192 G.\nThus assume that f : T \u2192 \u03b4\u22121 G is a homomorphism. For every u \u2208 V (T ), the\nimage f (u) is a \u223c-equivalence class; put\n1u = {y \u2208 V (G) : oy \u2208 f (u)},\n0u = {x \u2208 V (G) : tx \u2208 f (u)}.\nThen f (u) = 1u \u222a 0u , and by the definition of \u223c as the least equivalence containing \u223c0 ,\nthere exists a tree F (u) of height at most one and a homomorphism gu : F (u) \u2192 G such\nthat gu (0F (u) ) = 0u and gu (1F (u) ) = 1u . For every arc (u, v) of T , we have (f (u), f (v)) \u2208\nA(\u03b4\u22121 G) so there exists x \u2208 V (G) such that ox \u2208 f (u) and tx \u2208 f (v).\n\n5\n\n\fFigure 2: A thunderbolt\nWe then select y \u2208 1F (u) and z \u2208 0F (v) such that gu (y) = gv (z) = x, and identify\nthem. Proceeding\nwith all such identifications, we construct a tree S \u2208 Sproink(T ) such\nS\nthat g = u\u2208V (T ) gu : S \u2192 G is a well-defined homomorphism.\nCorollary 4. If a digraph H has tree duality, then its arc graph \u03b4H also has tree\nduality.\nExample. Consider T = P~4 , the directed path with four arcs, and its dual D = T~4 ,\nthe transitive tournament on four vertices. Here \u03b4D has six vertices, but its core\u2217 is the\ndirected path P~2 with two arcs. It is well known that a directed graph G admits a homomorphism to P~2 if and only if it does not admit a homomorphism from a \"thunderbolt\",\nthat is, an oriented path with two forward arcs at the beginning and at the end, and\nwith an odd-length alternating path between them (see Fig. 2). Thus the family of all\nthunderbolts is a complete set of tree obstructions for P~2 .\nOur construction Sproink(T ) gives all obstructions obtained by stacking five trees L0 ,\nL1 , L2 , L3 , L4 of height at most one, with one top vertex of Li identified with one\nbottom vertex of Li+1 for i = 0, 1, 2, 3. The example of thunderbolts shows that in\nfact L0 can be restricted to a single (top) vertex, and L4 can be restricted to a single\n(bottom) vertex. The same holds for leaves of general trees. Also, L1 , L2 , L3 can be\nrestricted to paths of height one, and it is also true in general that it is sufficient to\nconsider sproinks obtained by replacing vertices by paths of height at most one. In fact\nthe name \"sproink\" is inspired by picturing such a path springing out of every non-leaf\nof T .\nThe results of this section show that we can construct an interesting class of templates\nwith tree duality by repeatedly applying the arc-graph construction to digraphs with\nfinite duality. Moreover, if templates H1 , H2 , . . . , Hk all have tree duality, then also\ntheir product H1 \u00d7 H2 \u00d7 * * * \u00d7 Hk has tree duality as the union of the respective complete\nsets of obstructions of the factors is a complete set of obstructions for the product. The\nresulting class of templates is subject to examination in the next section.\n\u2217\nThe core of a digraph is any of its smallest subgraphs to which it admits a homomorphism. Every\ndigraph H has a unique core C (up to isomorphism), which is moreover the only core homomorphically\nequivalent to it. In fact, the core C of H is a retract of H, which means that there exists a homomorphism\n\u03c1 : H \u2192 C whose restriction on C is the identity mapping (such a homomorphism is called a retraction).\n\n6\n\n\f3 Finite duality\nFollowing [15], every tree T admits a dual D(T ) such that for every digraph G, we have\nG \u2192 D(T ) if and only if T 9 G. A digraph H has finite duality if and only if it is\nhomomorphically equivalent to a finite product of duals of trees.\nIn this section, we consider the class \u03b4\u03c0 C, the smallest class of digraphs that contains all\nduals of trees and is closed under taking arc graphs, finite products and homomorphically\nequivalent digraphs. It follows from Corollary 4 that all elements of \u03b4\u03c0 C have tree duality.\nMoreover we know how to construct a complete set of obstructions for each of these\ntemplates, using iterated Sproink constructions and unions. The question then arises as\nto how significant the class \u03b4\u03c0 C is within the class of digraphs with tree duality. It turns\nout that the digraphs in \u03b4\u03c0 C have properties that are not shared by all digraphs with\ntree duality.\nA digraph H has bounded-height tree duality provided there exists a constant m such\nthat H admits a complete set of obstructions consisting of trees of algebraic height at\nmost m.\nProposition 5.\n\n(i) Every core in \u03b4\u03c0 C admits a near-unanimity function.\n\n(ii) Every member of \u03b4\u03c0 C has bounded-height tree duality.\nProof. (i): By Corollary 4.5 of [11], every structure with finite duality admits a nearunanimity function. Therefore it suffices to show that the class of structures admitting a\nnear-unanimity function is closed under taking cores, finite products and the arc-graph\nconstruction.\nLet C be the core of H, \u03c1 : H \u2192 C a retraction and f : H k \u2192 H a near-unanimity\nfunction. Since C is an induced subgraph of H, the restriction \u03c1 \u25e6 f \u21be C k is a nearunanimity function on C.\nSuppose fi : Hiki \u2192 Hi , i = 1, . . . , m are near-unanimity functions. For k = max{ki :\ni = 1, . . . , m}, we define k-ary near-unanimity functions gi : Hik \u2192 Hi by gi (x1 , . . . , xk ) =\nk\nfi (x1 , . . . , xki ). For H = \u03a0m\ni=1 Hi we then define a near-unanimity function g : H \u2192 H\ncoordinate-wise, by putting\ng((x1,1 , . . . , xm,1 ), . . . , (x1,k , . . . , xm,k )) = (g1 (x1,1 , . . . , x1,k ), . . . , gm (xm,1 , . . . , xm,k )).\nNow suppose that f : H k \u2192 H is a near-unanimity function. Then (\u03b4H)k is naturally\nisomorphic to \u03b4(H k ), and we define g : (\u03b4H)k \u2192 \u03b4H by\ng((u1 , v1 ), . . . , (uk , vk )) = (f (u1 , . . . , uk ), f (v1 , . . . , vk )).\nThe fact that f is a homomorphism implies that g is well defined, and g is a homomorphism by the definition of adjacency in \u03b4H. Also, g clearly satisfies the near-unanimity\nidentities, so it is a near-unanimity function on \u03b4H.\n(ii): The class of digraphs with bounded-height tree duality is obviously preserved by\ntaking cores and finite products. By Theorem 3, if H has a complete set of obstructions\n\n7\n\n\fconsisting of trees of algebraic height at most k, then \u03b4H has a complete set of obstructions consisting of trees of algebraic height at most k + 1, so the class of digraphs with\nbounded-height tree duality is also preserved by the arc-graph construction.\nWe know a core digraph with tree duality but no near-unanimity function and no\nbounded-height tree duality. (The example is complicated and out of the scope of this\npaper, therefore we omit it.) Thus the class \u03b4\u03c0 C does not capture all core digraphs with\ntree duality. The problem of generating all structures with tree duality by means of suitable functors applied to structures with finite duality remains nevertheless interesting.\nMembership in \u03b4\u03c0 C is not known to be decidable. In the remainder of this section, we\nshow that bounded-height tree duality is decidable.\nGiven a digraph H, the n-th crushed cylinder Hn\u2217 is the quotient (H 2 \u00d7 Pn )/\u2243n ,\nwhere Pn is the path with arcs (0, 0), (0, 1), (1, 2), * * * , (n \u2212 1, n), (n, n), and \u2243n is the\nequivalence defined by\n\uf8f1\n\u2032\n\uf8f4\n\uf8f2i = j = 0 and u = u ,\n(u, v, i) \u2243n (u\u2032 , v \u2032 , j) \u21d4 or i = j = n and v = v \u2032 ,\n\uf8f4\n\uf8f3\nor (u, v, i) = (u\u2032 , v \u2032 , j).\nTheorem 6. For a core digraph H with tree duality, the following are equivalent:\n(1) H has bounded-height tree duality,\n(2) For some n we have Hn\u2217 \u2192 H.\n(3) There exists a directed (upward) path from the first projection to the second in\n2\nHH .\nProof. (1) \u21d2 (2): The two subgraphs obtained from Hn\u2217 by removing the two ends both\nadmit homomorphisms to H. Therefore, if a tree obstruction of H admits a homomorphism to Hn\u2217 , its image must intersect the two ends hence its algebraic length must be\nat least n.\n\u00ac(1) \u21d2 \u00ac(2): Let T be a critical obstruction of H of algebraic length n + 2. Let\nT0 , Tn be the subgraphs of T obtained by removing the vertices of height 0 and n + 2\nrespectively. Then there exists homomorphisms f0 : T0 \u2192 H and fn : Tn \u2192 H. Let\nh : T \u2192 Pn+2 be the height function of T . We define a map f : T \u2192 Hn\u2217 by\n\uf8f1\n\uf8f4\n\uf8f2(fn (u), f0 (u), h(u) \u2212 1)/\u2243n if h(u) 6\u2208 {0, n + 2},\nf (u) = (fn (u), fn (u), 0)/\u2243n\nif h(u) = 0,\n\uf8f4\n\uf8f3\n(f0 (u), f0 (u), n)/\u2243n\nif h(u) = n + 2.\nLet (u, v) be an arc of T . Then h(v) = h(u) + 1. If {h(u), h(v)} \u2229 {0, n + 2} = \u2205, we\nclearly have (f (u), f (v)) \u2208 A(Hn\u2217 ). If h(u) = 0, then f (u) = (fn (u), fn (u), 0)/\u2243n is an\nin-neighbour of (fn (v), fn (v), 0)/\u2243n = (fn (v), f0 (v), 0)/\u2243n = f (v), and if h(v) = n + 2,\nf (v) = (f0 (v), f0 (v), n)/\u2243n is an out-neighbour of f (u) because\n(f0 (u), f0 (u), n)/\u2243n = (fn (u), f0 (u), n)/\u2243n = f (u).\n\n8\n\n\fTherefore f is a homomorphism.\n(2) \u21d4 (3): This equivalence follows easily from the definition.\nCorollary 7. The problem whether an input digraph has bounded-height tree duality is\ndecidable.\nProof. It is decidable whether a digraph has tree duality [3] (see Theorem 11 below).\nFor a digraph with tree duality, bounded height of the obstructions (the condition (1)\nof Theorem 6) is equivalent to the condition (3), which involves directed reachability in\na finite graph. Hence bounded-height tree duality is decidable.\n\n4 Adjoint functors and generation of tractable templates\nThe correspondence of Proposition 1 can be extended to a wide class of functors presented\nin this section. To illustrate this extension, we first redefine \u03b4 in terms of patterns. Let\nP be the digraph with vertices 0, 1 and arc (0, 1), and Q the digraph with vertices\n0, 1, 2 and arcs (0, 1), (1, 2). Furthermore let q1 , q2 : P \u2192 Q be the homomorphisms\nmapping the arc (0, 1) to (0, 1) and (1, 2) respectively. For an arbitrary digraph G, its\narc graph \u03b4G can be described as follows: The vertices of \u03b4G are the arcs of G, that\nis, the homomorphisms f : P \u2192 G. The arcs of \u03b4G are the couples of consecutive arcs\nin G, that is, the couples (f1 , f2 ) such that there exists a homomorphism g : Q \u2192 G\nsatisfying g \u25e6 q1 = f1 and g \u25e6 q2 = f2 . Thus the functor \u03b4 is generated by the pattern\n{P, (Q, q1 , q2 ))} in a way that generalises quite naturally.\nThe rest of this section deals with relational structures. A vocabulary is a finite set\n\u03c3 = {R1 , . . . , Rm } of relation symbols, each with an arity ri assigned to it. A \u03c3-structure\nis a relational structure A = hA; R1 (A), . . . , Rm (A)i where A is a non-empty set called the\nuniverse of A, and Ri (A) is an ri -ary relation on A for each i. Homomorphisms of relational structures are relation-preserving mappings between universes; a homomorphism\nis defined only between structures with the same vocabulary. Cores, trees, quotient\nstructures, etc. can also be defined in the context of relational structures, consult [12]\nfor the details (see also [8, 11]). The notions of the constraint satisfaction problem,\ntemplate, and tree duality also carry over naturally from the setting of digraphs.\nLet \u03c3 and \u03c4 be two vocabularies. Let P be a \u03c3-structure, and for every relation R of\n\u03c4 of arity r = a(R), let QR be a \u03c3-structure with r fixed homomorphisms qR,i : P \u2192 QR\nfor i = 1, . . . , r. Then the family {P } \u222a {(QR , qR,1 , . . . , qR,a(R) ) : R \u2208 \u03c4 } defines a functor\n\u03a8 from the category A of \u03c3-structures to the category B of \u03c4 -structures as follows.\n\u2022 For a \u03c3-structure A, let B = \u03a8A be a \u03c4 -structure whose universe is the set of all\nhomomorphisms f : P \u2192 A.\n\u2022 For every relation R of \u03c4 of arity r = a(R), let R(B) be the set of r-tuples\n(f1 , . . . , fr ) such that there exists a homomorphism g : QR \u2192 A such that for\ni = 1, . . . , r we have g \u25e6 qR,i = fi .\nIt was shown by Pultr [17] that functors \u03a8 defined by means of patterns are right\nadjoints into a category of relational structures characterised by axioms of a specific\n\n9\n\n\ftype. We exhibit their corresponding left adjoints \u03a8\u22121 in the case when both the domain\nand the range of \u03a8 is the category of all relational structures with a given vocabulary.\nFor every \u03c4 -structure B, we define a \u03c3-structure \u03a8\u22121 B = A/\u223c, where\n\u2022 A is a disjoint union of \u03c3-structures; for every element x of the universe of B, A\ncontains a copy Px of P , and for every R \u2208 \u03c4 and (x1 , . . . , xr ) \u2208 R(B), A contains\na copy QR,(x1 ,...,xr ) of QR .\n\u2022 \u223c is the least equivalence which identifies every element u of Pxi with its image\nqR,i (u) in QR,(x1 ,...,xr ) , for every R \u2208 \u03c4 , every (x1 , . . . , xr ) \u2208 R(B) and every\ni \u2208 {1, . . . , r}.\nProposition 8 ([17]). For any \u03c4 -structure B and \u03c3-structure A,\nB \u2192 \u03a8A\n\nif and only if\n\n\u03a8\u22121 B \u2192 A.\n\nProof. Let h : B \u2192 \u03a8A be a homomorphism, and put h(b) = fb : P \u2192 A. Then for every\nb \u2208 B, the mapping fb corresponds to a well-defined homomorphism to A from a copy Pb\nof P . Also, for every R \u2208 \u03c4 and (b1 , . . . , br ) \u2208 R(B), we have (h(b1 ), . . . , h(br )) \u2208 R(\u03a8A),\nso there exists a homomorphism g(b1 ,...,br ) : QR \u2192 A such that fbi = g(b1 ,...,br ) \u25e6 qR,i for\ni = 1, . . . , r; the mapping g(b1 ,...,br ) corresponds\nto a S\nwell-defined\nhomomorphism from a\nS\nS\ncopy QR,(b1 ,...,br ) of QR to A. Therefore b\u2208B fb \u222a \u03c4 R(B) g(b1 ,...,br ) corresponds to a\nS\nS S\nwell-defined homomorphism \u0125 : b\u2208B Pb \u222a \u03c4 R(B) QR,(b1 ,...,br ) \u2192 A, such that if x \u223c y,\n\nthen \u0125(x) = \u0125(y). Therefore \u0125 induces a homomorphism from the quotient structure\n\u03a8\u22121 B to A.\nConversely, if h : \u03a8\u22121 B \u2192 A is a homomorphism, we define a homomorphism \u0125 :\nB \u2192 \u03a8A by \u0125(b) = fb , where fb corresponds to the restriction of h to the quotient of Pb\nin \u03a8\u22121 B. Indeed, if R \u2208 \u03c4 and (b1 , . . . , br ) \u2208 R(B), then the restriction of h to the\nquotient of QR,(b1 ,...br ) in \u03a8\u22121 B corresponds to a homomorphism g : QR \u2192 A such that\nfbi = g \u25e6 qR,i for i = 1, . . . , r, whence (\u0125(b1 ), . . . , \u0125(br )) \u2208 R(\u03a8A).\nCorollary 9. If a \u03c3-structure A has polynomial CSP, then the \u03c4 -structure \u03a8A also has\npolynomial CSP.\nIn fact, Corollary 4 generalises as follows.\nTheorem 10. If a \u03c3-structure A has tree duality, then the \u03c4 -structure \u03a8A also has tree\nduality.\nWe prove Theorem 10 using Feder and Vardi's characterisation of structures with tree\nduality. For a \u03c3-structure A, let U A be the \u03c3-structure defined as follows. The universe\nof U A is the set of all nonempty subsets of A, and for R \u2208 \u03c3 of arity r, R(U A) is the\nset of all r-tuples (X1 , . . . , Xr ) such that for all j \u2208 {1, . . . , r} and xj \u2208 Xj there exist\nxk \u2208 Xk , k \u2208 {1, . . . , r} \\ {j} such that (x1 , . . . , xr ) \u2208 R(A).\nTheorem 11 ([3]). A structure A has tree duality if and only if there exists a homomorphism from U A to A.\n\n10\n\n\fProof of Theorem 10. Suppose A has tree duality. Then there is a homomorphism\nf : U A \u2192 A. Let U = P(\u03a8A) \\ {\u2205} be the universe of U \u03a8A and let S \u2208 U .\nFor p \u2208 P , define Sp = {f (p) : f \u2208 S} \u2208 U A, and fS (p) = f (Sp ). We claim that\nfS : P \u2192 A is a homomorphism. Indeed, for R \u2208 \u03c3 and (p1 , . . . , pr ) \u2208 R(P ), the r-tuples\n(f (p1 ), . . . , f (pr )) \u2208 R(A) for all f \u2208 S prove that (Sp1 , . . . , Spr ) \u2208 R(U A), whence\n(fS (p1 ), . . . , fS (pr )) = (f (Sp1 ), . . . , f (Spr )) \u2208 R(A).\nThus we define a map f\u02c6 : U \u03a8A \u2192 \u03a8A by f\u02c6(S) = fS . We show that it is a homomorphism. For R \u2208 \u03c4 and (S1 , . . . , Sr ) \u2208 R(U \u03a8A), every fi \u2208 Si , 1 \u2264 i \u2264 r is contained\nin an r-tuple (h1 , . . . , hr ) \u2208 R(\u03a8A) with fj \u2208 Sj for 1 \u2264 j \u2264 r and hi = fi , whence\nthere exists a homomorphism g(h1 ,...,hr ) : QR \u2192 A such that hj = g(h1 ,...,hr ) \u25e6 qR,j for\nj = 1, . . . , r. For x \u2208 Q, let Tx be the set of all images g(h1 ,...,hr ) (x) \u2208 A (with (S1 , . . . , Sr )\nfixed), and g(S1 ,...,Sr ) (x) = f (Tx ). Then g(S1 ,...,Sr ) : QR \u2192 A is a homomorphism, and\nfor x \u2208 qR,j (P ) we have Tx = Sx (because they are images of x under restrictions of\nthe same homomorphisms), whence g(S1 ,...,Sr ) (x) = fSj (x). Thus fSj = g(S1 ,...,Sr ) \u25e6 qR,j\nfor j = 1, . . . , r. Consequently (fS1 , . . . , fSr ) = (f\u02c6(S1 ), . . . , f\u02c6(Sr )) \u2208 R(\u03a8A). This shows\nthat f\u02c6 is a homomorphism.\nUnlike the case of the arc-graph construction, we are unable to provide an explicit\ndescription of the tree obstructions of \u03a8A in terms of those of A for a general right\nadjoint \u03a8. However, in isolated cases we can do it, as the following example shows.\nExample. The endofunctor \u03a8 on the category of digraphs is defined via the pattern\n{P, (Q, q1 , q2 )}, where P = P~1 is the one-arc path u \u2192 v, Q = P~3 is the directed path\n0 \u2192 1 \u2192 2 \u2192 3, the homomorphism q1 : u 7\u2192 0, v 7\u2192 1, and finally q2 : u 7\u2192 2, v 7\u2192 3.\nLet T be a tree of algebraic height h and consider the unique homomorphism t from T\nto the directed path P~h . The arcs of T are of two kinds: blue arcs Ab (T ) = {(x, y) :\nt(x) = 2k, t(y) = 2k + 1 for some integer k} and red arcs Ar (T ) = {(x, y) : t(x) =\n2k + 1, t(y) = 2k + 2 for some integer k}. We define two equivalence relations on the\nvertices of T : x \u223cb y if the (not necessarily directed) path from x to y in T has only\nblue arcs, and x \u223cr y if the path from x to y in T has only red arcs. Then T has two\n\u03a8-Sproinks, namely T /\u223cb and T /\u223cr with loops removed.\nFor a collection T of trees, let \u03a8-Sproink(T ) be the set of all \u03a8-Sproinks of the trees\ncontained in T . We claim that if T is a complete set of obstructions for a template H,\nthen \u03a8-Sproink(T ) is a complete set of obstructions for \u03a8H. To prove it, we follow the\nidea of the proofs of Lemma 2 and Theorem 3.\nFirst we prove that T \u2192 \u03a8\u22121 (T /\u223cb ). This is not difficult: every blue arc of T\nwas contracted to a vertex of T /\u223cb and this vertex was blown up to an arc in T \u2192\n\u03a8\u22121 (T /\u223cb ). Thus we can map blue arcs to the corresponding blown-up arcs. Red arcs\nof T are also arcs of T /\u223cb , and hence we can map each red arc to the arc (1, 2) of the\ncorresponding copy of Q in \u03a8\u22121 (T /\u223cb ). Clearly such a mapping is a homomorphism.\nAnalogously we show that T \u2192 \u03a8\u22121 T /\u223cr .\nFinally we want to prove that if T \u2192 \u03a8\u22121 G, then either T /\u223cb \u2192 G or T /\u223cr \u2192 G.\nSuppose that f : T \u2192 \u03a8\u22121 G. Then some arcs of T are mapped by f to arcs corresponding\nto vertices of G (arcs of copies of P ), and others are mapped to arcs corresponding to\n\n11\n\n\farcs of G (arcs (1, 2) of copies of Q). Let us call the former v-arcs and the latter a-arcs.\nIt follows from the definition of \u03a8\u22121 that either all blue arcs of T are v-arcs and all red\narcs of T are a-arcs, or all blue arcs of T are a-arcs and all red arcs of T are v-arcs. In\nthe former case T /\u223cb \u2192 G, while in the latter case T /\u223cr \u2192 G.\nIt is notable that in the above example each tree obstruction for H generates finitely\nmany obstructions for \u03a8H. This is no accident.\nTheorem 12. Let \u03a8 be a functor generated by a pattern {P } \u222a {(QR , qR,1 , . . . , qR,a(R) ) :\nR \u2208 \u03c4 }, where for every R \u2208 \u03c4 and 1 \u2264 i < j \u2264 a(R), the image qR,i (P ) is vertexdisjoint from qR,j (P ). If a \u03c3-structure A has finite duality, then the \u03c4 -structure \u03a8A also\nhas finite duality.\nThe proof uses the characterisation of structures with finite duality of [11]. The square\nof a \u03c3-structure B is the structure B \u00d7 B. It contains the diagonal \u2206B\u00d7B = {(b, b) :\nb \u2208 B}. An element a of B is dominated by an element b of B if for every R \u2208 \u03c3,\nfor every i and every (x1 , . . . , xa(R) ) \u2208 R(B) with xi = a, we have (y1 , . . . , ya(R) ) \u2208\nR(B) with yi = b and yj = xj for j 6= i. A structure B dismantles to its induced\nsubstructure C if there exists a sequence x1 , . . . , xk of distinct elements of B such that\nB \\ C = {x1 , . . . , xk } and for each 1 \u2264 i \u2264 k the element xi is dominated in the structure\ninduced by C\u222a{xi , . . . , xk }. The sequence x1 , . . . , xk is then called a dismantling sequence\nof B on C.\nTheorem 13 ([11]). A structure has finite duality if and only if it has a retract whose\nsquare dismantles to its diagonal.\nProof of Theorem 12. Let A be a \u03c3-structure with finite duality. Without loss of generality, we assume that A is a core, so that A has no proper retracts; thus the square\nof A dismantles to its diagonal. Let (x1 , y1 ), . . . , (xk , yk ) be a dismantling sequence of\nA \u00d7 A on \u2206A\u00d7A . Then \u03a8(A \u00d7 A) \u223c\n= \u03a8A \u00d7 \u03a8A; we want to prove that it dismantles to\n\u2206\u03a8A\u00d7\u03a8A \u223c\n= \u03a8\u2206A\u00d7A .\nFor i \u2208 {1, . . . , k}, define Xi to be the substructure of A \u00d7 A induced by the set\n\u2206A\u00d7A \u222a {(xi , yi ), . . . , (xk , yk )}, and let Xk+1 = \u2206A\u00d7A . We will show that \u03a8Xi can be\ndismantled to \u03a8Xi+1 , i = 1, . . . , k.\nLet b = (b1 , b2 ) be an element dominating a = (xi , yi ) in Xi . Let f \u2208 \u03a8Xi \\ \u03a8Xi+1 ,\nand assume that f = (f1 , f2 ) : P \u2192 A \u00d7 A. Then there exists (at least one) p0 \u2208 P such\nthat f (p0 ) = a. We define g = (g1 , g2 ) : P \u2192 A \u00d7 A by g(p0 ) = b and g(p) = f (p) if\np 6= p0 . Since b dominates a, g is a homomorphism, and obviously g \u2208 \u03a8Xi . We claim\nthat g dominates f . Indeed, for R \u2208 \u03c4 and (f1 , . . . , fa(R) ) \u2208 R(\u03a8Xi ) such that f = fj ,\nthere exists a homomorphism h : QR \u2192 Xi such that f = h \u25e6 qR,j . Define h\u2032 : QR \u2192 Xi\nby h\u2032 (qR,j (p0 )) = b and h\u2032 (z) = h(z) for z 6= qR,j (p0 ). Since b dominates a = h(qR,j (p0 )),\nthe mapping h\u2032 is a homomorphism. By hypothesis, for l 6= j, the image qR,l (P ) is\ndisjoint from qR,j (P ), whence fl = h\u2032 \u25e6 qR,l , while h\u2032 \u25e6 qR,j = g. Therefore R(\u03a8Xi )\ncontains all the a(R)-tuples needed to establish the domination of f by g.\nLet p1 , p2 , . . . , pm be an enumeration of the elements of P . We dismantle \u03a8Xi to \u03a8Xi+1\nby successively removing the functions f such that f (pj ) = (xi , yi ) for j = 1, . . . , m.\n\n12\n\n\fProceeding in this way for i = 1, . . . , k, we get a dismantling of \u03a8A \u00d7 \u03a8A \u223c\n= \u03a8X1 to\n\u223c\n\u03a8Xk+1 = \u2206\u03a8A\u00d7\u03a8A . Therefore \u03a8A has finite duality.\nPerhaps the lack of knowledge of a general construction is natural since there is no\nrestriction on the pattern {P } \u222a {(QR , qR,1 , . . . , qR,a(R) ) : R \u2208 \u03c4 }. On the other hand,\nthere are many possible transformations T \u2032 on a family T of tree obstructions, in the\nstyle of Sproink(T ). Any such transformation gives rise to a complete set of obstructions\nto homomorphisms into a structure H \u2032 = \u03a0T \u2208T \u2032 DT ; however in general there is no\nway of guaranteeing that such structure H \u2032 is finite, even when T is a complete set of\nobstructions for a finite structure H.\n\n5 Concluding comments\nIn this paper we tried to shed more light on the structure of tractable templates with\ntree duality. Let us turn our attention one more time to Fig. 1. The grey areas in the\ndiagram are areas that need a closer look in future research.\nCurrently we do not know any digraph with a near-unanimity function and with\nbounded-height tree duality that could not be generated using right adjoints and products, starting from digraphs with finite duality; it is not clear whether any such \"reasonable\" class of structures with tree duality can be generated from structures with finite\nduality with a \"reasonable\" set of adjoint functors.\nWe have shown here that possession of bounded-height tree duality is decidable. It\nis natural to ask what its complexity is; in particular, whether it is complete for some\nclass of problems.\nEqually interesting is the decidability of membership in other classes depicted in Fig. 1.\nTree duality is known to be decidable [3], but not known to be in PSPACE. Our decision\nprocedure for bounded-height duality is in PSPACE for graphs with tree duality; this\nsuggests that checking tree duality may be harder than checking bounded height of the\nobstructions.\nFurthermore, finite duality is NP-complete [11]. The decidability of bounded-treewidth duality is unknown, and so is the decidability of a near-unanimity function (see [14]\nfor a related result).\nThe properties of near-unanimity functions proved in the proof of Proposition 5 (i)\nin the context of digraphs and the arc-graph construction, also hold in the context of\ngeneral structures and right adjoints. The proofs carry over naturally.\n\nReferences\n[1] M. Barr and C. Wells. Category Theory for Computing Science. Les Publications\nCRM, Montr\u00e9al, 3rd edition, 1999.\n[2] D. Cohen and P. Jeavons. The complexity of constraint languages. In F. Rossi,\nP. van Beek, and T. Walsh, editors, Handbook of Constraint Programming, volume 2\nof Foundations of Artificial Intelligence, chapter 8. Elsevier, 2006.\n\n13\n\n\f[3] T. Feder and M. Y. Vardi. The computational structure of monotone monadic SNP\nand constraint satisfaction: A study through Datalog and group theory. SIAM J.\nComput., 28(1):57\u2013104, 1999.\n[4] J. Foniok. Homomorphisms and Structural Properties of Relational Systems. PhD\nthesis, Charles University, Prague, 2007.\n[5] P. Hell and J. Ne\u0161et\u0159il. On the complexity of H-coloring. J. Combin. Theory Ser.\nB, 48(1):92\u2013110, 1990.\n[6] P. Hell and J. Ne\u0161et\u0159il. Graphs and Homomorphisms, volume 28 of Oxford Lecture\nSeries in Mathematics and Its Applications. Oxford University Press, 2004.\n[7] P. Hell, J. Ne\u0161et\u0159il, and X. Zhu. Duality and polynomial testing of tree homomorphisms. Trans. Amer. Math. Soc., 348(4):1281\u20131297, 1996.\n[8] W. Hodges. A shorter model theory. Cambridge University Press, 1997.\n[9] P. Kom\u00e1rek. Good characterisations in the class of oriented graphs. PhD thesis,\nCzechoslovak Academy of Sciences, Prague, 1987. In Czech (Dobr\u00e9 charakteristiky\nve t\u0159\u0131\u0301d\u011b orientovan\u00fdch graf\u016f).\n[10] R. E. Ladner. On the structure of polynomial time reducibility. J. Assoc. Comput.\nMach., 22(1):155\u2013171, 1975.\n[11] B. Larose, C. Loten, and C. Tardif. A characterisation of first-order constraint\nsatisfaction problems. In Proceedings of the 21st IEEE Symposium on Logic in\nComputer Science (LICS'06), pages 201\u2013210. IEEE Computer Society, 2006.\n[12] C. Loten and C. Tardif. Majority functions on structures with finite duality. European J. Combin., 29(4):979\u2013986, 2008.\n[13] S. Mac Lane. Categories for the Working Mathematician, volume 5 of Graduate\ntexts in mathematics. Springer-Verlag, New York Berlin Heidelberg, 2nd edition,\n1998.\n[14] M. Mar\u00f3ti. The existence of a near-unanimity term in a finite algebra is decidable.\nManuscript, 2005.\n[15] J. Ne\u0161et\u0159il and C. Tardif. Duality theorems for finite structures (characterising gaps\nand good characterisations). J. Combin. Theory Ser. B, 80(1):80\u201397, 2000.\n[16] J. Ne\u0161et\u0159il and C. Tardif. Short answers to exponentially long questions: Extremal\naspects of homomorphism duality. SIAM J. Discrete Math., 19(4):914\u2013920, 2005.\n[17] A. Pultr. The right adjoints into the categories of relational systems. In Reports of\nthe Midwest Category Seminar, IV, volume 137 of Lecture Notes in Mathematics,\npages 100\u2013113, Berlin, 1970. Springer.\n\n14\n\n\f"}