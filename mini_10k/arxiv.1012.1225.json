{"id": "http://arxiv.org/abs/1012.1225v2", "guidislink": true, "updated": "2011-08-12T08:59:59Z", "updated_parsed": [2011, 8, 12, 8, 59, 59, 4, 224, 0], "published": "2010-12-06T16:23:14Z", "published_parsed": [2010, 12, 6, 16, 23, 14, 0, 340, 0], "title": "Stokes imaging polarimetry using image restoration: A calibration\n  strategy for Fabry-P\u00e9rot based instruments", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1012.1444%2C1012.0127%2C1012.1961%2C1012.1793%2C1012.4889%2C1012.1225%2C1012.3748%2C1012.1252%2C1012.5287%2C1012.2021%2C1012.5981%2C1012.1747%2C1012.5634%2C1012.0311%2C1012.1010%2C1012.3955%2C1012.5830%2C1012.5534%2C1012.1659%2C1012.0075%2C1012.5468%2C1012.4466%2C1012.0971%2C1012.1074%2C1012.0726%2C1012.5739%2C1012.5790%2C1012.2570%2C1012.5475%2C1012.5798%2C1012.0856%2C1012.0727%2C1012.3441%2C1012.4281%2C1012.0713%2C1012.3200%2C1012.4193%2C1012.2845%2C1012.4320%2C1012.1241%2C1012.1530%2C1012.1154%2C1012.0161%2C1012.2876%2C1012.4013%2C1012.2310%2C1012.3379%2C1012.0927%2C1012.5869%2C1012.1931%2C1012.0004%2C1012.1968%2C1012.1310%2C1012.3316%2C1012.1506%2C1012.0299%2C1012.0170%2C1012.4034%2C1012.5284%2C1012.5676%2C1012.5285%2C1012.3310%2C1012.4720%2C1012.5096%2C1012.2253%2C1012.4199%2C1012.3849%2C1012.1997%2C1012.1856%2C1012.3718%2C1012.4937%2C1012.3279%2C1012.5720%2C1012.4365%2C1012.5433%2C1012.5734%2C1012.1177%2C1012.4322%2C1012.5529%2C1012.2520%2C1012.5377%2C1012.0542%2C1012.5577%2C1012.5693%2C1012.3507%2C1012.2511%2C1012.2824%2C1012.5952%2C1012.0617%2C1012.2066%2C1012.3876%2C1012.2335%2C1012.1329%2C1012.0430%2C1012.5770%2C1012.2904%2C1012.4203%2C1012.3877%2C1012.0414%2C1012.4257%2C1012.1210&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Stokes imaging polarimetry using image restoration: A calibration\n  strategy for Fabry-P\u00e9rot based instruments"}, "summary": "context: The combination of image restoration and a Fabry-P\\'{e}rot\ninterferometer (FPI) based instrument in solar observations results in specific\ncalibration issues. FPIs generally show variations over the field-of-view,\nwhile in the image restoration process, the 1-to-1 relation between pixel space\nand image space is lost, thus complicating any correcting for such variations.\naims: We develop a data reduction method that takes these issues into account\nand minimizes the resulting errors. methods: By accounting for the time\nvariations in the telescope's Mueller matrix and using separate calibration\ndata optimized for the wavefront sensing in the MOMFBD image restoration\nprocess and for the final deconvolution of the data, we have removed most of\nthe calibration artifacts from the resulting data. results: Using this method\nto reduce full Stokes data from CRISP at the SST, we find that it drastically\nreduces the instrumental and image restoration artifacts resulting from cavity\nerrors, reflectivity variations, and the polarization dependence of flatfields.\nThe results allow for useful scientific interpretation. Inversions of restored\ndata from the $\\delta$ sunspot AR11029 using the Nicole inversion code, reveal\nstrong (~10 km/s) downflows near the disk center side of the umbra.\nconclusions: The use of image restoration in combination with an FPI-based\ninstrument leads to complications in the calibrations and intrinsic limitations\nto the accuracy that can be achieved. We find that for CRISP, the resulting\nerrors can be kept mostly below the polarimetric accuracy of ~10^-3. Similar\ninstruments aiming for higher polarimetric and high spectroscopic accuracy,\nwill, however, need to take these problems into account. keywords: Techniques:\nimage processing, polarimetric, imaging spectroscopy, Sun: surface magnetism,\nsunspots, activity", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1012.1444%2C1012.0127%2C1012.1961%2C1012.1793%2C1012.4889%2C1012.1225%2C1012.3748%2C1012.1252%2C1012.5287%2C1012.2021%2C1012.5981%2C1012.1747%2C1012.5634%2C1012.0311%2C1012.1010%2C1012.3955%2C1012.5830%2C1012.5534%2C1012.1659%2C1012.0075%2C1012.5468%2C1012.4466%2C1012.0971%2C1012.1074%2C1012.0726%2C1012.5739%2C1012.5790%2C1012.2570%2C1012.5475%2C1012.5798%2C1012.0856%2C1012.0727%2C1012.3441%2C1012.4281%2C1012.0713%2C1012.3200%2C1012.4193%2C1012.2845%2C1012.4320%2C1012.1241%2C1012.1530%2C1012.1154%2C1012.0161%2C1012.2876%2C1012.4013%2C1012.2310%2C1012.3379%2C1012.0927%2C1012.5869%2C1012.1931%2C1012.0004%2C1012.1968%2C1012.1310%2C1012.3316%2C1012.1506%2C1012.0299%2C1012.0170%2C1012.4034%2C1012.5284%2C1012.5676%2C1012.5285%2C1012.3310%2C1012.4720%2C1012.5096%2C1012.2253%2C1012.4199%2C1012.3849%2C1012.1997%2C1012.1856%2C1012.3718%2C1012.4937%2C1012.3279%2C1012.5720%2C1012.4365%2C1012.5433%2C1012.5734%2C1012.1177%2C1012.4322%2C1012.5529%2C1012.2520%2C1012.5377%2C1012.0542%2C1012.5577%2C1012.5693%2C1012.3507%2C1012.2511%2C1012.2824%2C1012.5952%2C1012.0617%2C1012.2066%2C1012.3876%2C1012.2335%2C1012.1329%2C1012.0430%2C1012.5770%2C1012.2904%2C1012.4203%2C1012.3877%2C1012.0414%2C1012.4257%2C1012.1210&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "context: The combination of image restoration and a Fabry-P\\'{e}rot\ninterferometer (FPI) based instrument in solar observations results in specific\ncalibration issues. FPIs generally show variations over the field-of-view,\nwhile in the image restoration process, the 1-to-1 relation between pixel space\nand image space is lost, thus complicating any correcting for such variations.\naims: We develop a data reduction method that takes these issues into account\nand minimizes the resulting errors. methods: By accounting for the time\nvariations in the telescope's Mueller matrix and using separate calibration\ndata optimized for the wavefront sensing in the MOMFBD image restoration\nprocess and for the final deconvolution of the data, we have removed most of\nthe calibration artifacts from the resulting data. results: Using this method\nto reduce full Stokes data from CRISP at the SST, we find that it drastically\nreduces the instrumental and image restoration artifacts resulting from cavity\nerrors, reflectivity variations, and the polarization dependence of flatfields.\nThe results allow for useful scientific interpretation. Inversions of restored\ndata from the $\\delta$ sunspot AR11029 using the Nicole inversion code, reveal\nstrong (~10 km/s) downflows near the disk center side of the umbra.\nconclusions: The use of image restoration in combination with an FPI-based\ninstrument leads to complications in the calibrations and intrinsic limitations\nto the accuracy that can be achieved. We find that for CRISP, the resulting\nerrors can be kept mostly below the polarimetric accuracy of ~10^-3. Similar\ninstruments aiming for higher polarimetric and high spectroscopic accuracy,\nwill, however, need to take these problems into account. keywords: Techniques:\nimage processing, polarimetric, imaging spectroscopy, Sun: surface magnetism,\nsunspots, activity"}, "authors": ["R. S. Schnerr", "J. de la Cruz Rodriguez", "M. van Noort"], "author_detail": {"name": "M. van Noort"}, "author": "M. van Noort", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1051/0004-6361/201016000", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/1012.1225v2", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/1012.1225v2", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "Astronomy and Astrophysics (accepted)", "arxiv_primary_category": {"term": "astro-ph.SR", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "astro-ph.SR", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "astro-ph.IM", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/1012.1225v2", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/1012.1225v2", "journal_reference": null, "doi": "10.1051/0004-6361/201016000", "fulltext": "c ESO 2018\n\nAstronomy & Astrophysics manuscript no. 6302\nNovember 4, 2018\n\nStokes imaging polarimetry using image restoration:\nA calibration strategy for Fabry-P\u00e9rot based instruments\nR. S. Schnerr1,2 , J. de la Cruz Rodr\u0131\u0301guez1,2 , and M. van Noort1,2,3\n1\n2\n3\n\nInstitute for Solar Physics of the Royal Swedish Academy of Sciences, AlbaNova University Center, SE-106 91 Stockholm, Sweden\nDepartment of Astronomy, Stockholm University, AlbaNova University Center, SE-106 91 Stockholm, Sweden\nMax-Planck-Institut f\u00fcr Sonnensystemforschung, Max-Planck-Str. 2, 37191 Katlenburg-Lindau, Germany\n\narXiv:1012.1225v2 [astro-ph.SR] 12 Aug 2011\n\nPreprint online version: November 4, 2018\nABSTRACT\nContext. The combination of image restoration and a Fabry-P\u00e9rot interferometer (FPI) based instrument in solar observations results\n\nin specific calibration issues. FPIs generally show variations over the field-of-view, while in the image restoration process, the 1-to-1\nrelation between pixel space and image space is lost, thus complicating any correcting for such variations.\nAims. We develop a data reduction method that takes these issues into account and minimizes the resulting errors.\nMethods. By accounting for the time variations in the telescope's Mueller matrix and using separate calibration data optimized for\nthe wavefront sensing in the MOMFBD image restoration process and for the final deconvolution of the data, we have removed most\nof the calibration artifacts from the resulting data.\nResults. Using this method to reduce full Stokes data from CRISP at the SST, we find that it drastically reduces the instrumental\nand image restoration artifacts resulting from cavity errors, reflectivity variations, and the polarization dependence of flatfields. The\nresults allow for useful scientific interpretation. Inversions of restored data from the \u03b4 sunspot AR11029 using the Nicole inversion\ncode, reveal strong (\u223c10 km s\u22121 ) downflows near the disk center side of the umbra.\nConclusions. The use of image restoration in combination with an FPI-based instrument leads to complications in the calibrations\nand intrinsic limitations to the accuracy that can be achieved. We find that for CRISP, the resulting errors can be kept mostly below the\npolarimetric accuracy of \u223c10\u22123 . Similar instruments aiming for higher polarimetric and high spectroscopic accuracy, will, however,\nneed to take these problems into account.\nKey words. Techniques: image processing, polarimetric, imaging spectroscopy, Sun: surface magnetism, sunspots, activity\n\n1. Introduction\nAs technical possibilities increase, more advanced and complicated instruments are being designed for observational studies\nof the Sun. New instrumentation is generally designed to offer\nbetter spatial resolution, better spectral coverage, and full polarization information. Higher spatial resolution will help resolve,\ne.g., small-scale magnetic fields in the quiet Sun. In sunspots, the\nmagnetic fields and flows in penumbra, lightbridges, and umbral\ndots make interesting targets. Better spectral coverage and polarization information are needed to enable meaningful interpretation of the observed features. Adaptive optics (AO) are currently\navailable at the major ground-based solar observatories and have\ngreatly improved the performance of telescopes.\nAdditionally, postprocessing of high-cadence imaging data\nto correct the blurring effect of seeing has made a huge impact\non image quality. Image restoration methods such as MOMFBD\n(Multi-Object Multi-Frame Blind Deconvolution, van Noort\net al. 2005; L\u00f6fdahl 2002) and Speckle interferometry (see von\nder L\u00fche 1993, and references therein) have become essential\nfor ground-based, high spatial-resolution solar imaging. Because\nthese methods allow combining all the images obtained within a\ndataset, while retaining high image quality, it removes the need\nfor frame selection and results in more reliable and higher signalto-noise data.\nSend offprint requests to: R.S.S.: e-mail: roald@schnerr.nl\n\nIn this context, Fabry-P\u00e9rot interferometer (FPI) based instruments have become quite popular and are in operation at\nmany solar observatories, e.g. CRISP (Scharmer et al. 2008)\nat the Swedish 1-m Solar Telescope (SST), the Telecentric\netalon solar spectrometer (TESOS, Kentischer et al. 1998), and\nG\u00f6ttingen Fabry-P\u00e9rot spectropolarimeter (Puschmann et al.\n2006) at the Vacuum Tower Telescope and the Interferometric\nbidirectional spectrometer (IBIS, Cavallini 2006) at the Dunn\nSolar Telescope. Similar instruments are likely to be developed\nfor the future 4-m class solar telescopes ATST and EST. The\nmain advantages of FPIs over Lyot filters are that they have a\nhigh transmission, allow for rapid wavelength tuning, and allow\nfor a dual-beam polarimetric setup with a polarizing beam splitter close to the final focal plane. A disadvantage is that even\nvery well-made FPIs will show variations in the width and central wavelength of the transmission peak over the field of view\n(FOV, e.g. Reardon & Cavallini 2008). When the FPIs are set\nup in a telecentric mount, as with CRISP, these variations cause\nintensity variations on relatively small spatial scales. In collimated mount, such small-scale features disappear, but the central\nwavelength shifts systematically away from the center of the image. For further comments on FPIs in telecentric vs. collimated\nmount see Scharmer (2006).\nWe plan to discuss a theoretical approach to the processing\nof full-Stokes line scans from FPI-based instruments in a future\npaper, but here we present the practical application of that approach to real CRISP data of a sunspot observed in the 6302.5 \u00c5\nFe i line, including all the necessary data reduction steps, such as\n\n\f2\n\nSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\nS/P\n\nCCD\n\nThe data required for calibrating the science data from CRISP\nare obtained in the following way. The dark images are recorded\nin a similar way as the science data, but with the light path\nblocked after the exit window of the vacuum tube. The final dark\nis the average of a large number of darks (typically 100\u20131000).\nFlatfields are obtained by summing many (\u223c1000) images of the\nSun taken with the telescope pointing moving across the solar\ndisk. As such, the flatfields include both transmission variations\nover the FOV as actual CCD gain variations, as do the gains that\nare derived from these flatfields. Therefore, in this paper, \"flatfielding\" and \"gain correction\" imply the same correction. The\npolarization calibration data is obtained by producing light with\nknown polarization states using a linear polarizer and a quarterwave plate placed below the exit window of the vacuum tube in\nthe tower. The modulation scheme is then calibrated using the\nmethod described in Appendix A. The (time-dependent) tele-\n\nLRE\nHRE\n\n2.2. Calibration data\n\nliquid crystals\n\nThe data acquisition setup used with CRISP at the SST (see\nFig. 1) is similar to the one used by van Noort & Rouppe van\nder Voort (2008), with the notable difference that the SOUP Lyot\ntunable filter has been replaced with the CRISP Fabry-P\u00e9rot filter (Scharmer et al. 2008). The significantly higher (\u223c 8\u00d7) peak\ntransmission of the Fabry-P\u00e9rot filter results in a higher S/N for\nsimilar exposure times than with the Lyot filter, and the use of\na dual beam polarimetric setup results in a significant reduction\nof the seeing-induced crosstalk. In addition, the higher tuning\nspeed of CRISP allows for observing programs scanning over\n\u223c10 spectral points instead of the two to four points one would\ntypically get with the Lyot filter. A downside, however, is that\nthe placement of the filter cavities in a telecentric mount configuration leads to small-scale pass-band shifts and transmission\nprofile width variations across the FOV, due to cavity and reflectivity errors. In the case of CRISP, the high- and low-resolution\nFPIs have been placed \u223c10 cm away from the focal plane in order to smooth out such variations.\nCRISP data are obtained while continuously cycling through\na 4-state liquid-crystal (LC) scheme, which converts combinations of the incoming polarization states Q, U, and V to linear polarization that can be analyzed with the polarizing beam splitter\nclose to the final focal plane. Data are simultaneously recorded\nusing two narrow-band cameras (called transmitted and reflected\ncamera) in a dual-beam setup and a wide-band camera (receiving 10% of the light passing the prefilter via a beam-splitter)\nplaced before the liquid-crystal variable retarders. The frame rate\nof \u223c36 Hz is set by the rotating chopper, which has a duty cycle\nsetting the exposure time at 16 ms. CCD readout is performed\nduring the dark part of the cycle. For the data shown in this paper, 4 full LC-cycles were completed before tuning to the next of\na total of 12 wavelengths. The complete linescan of 4 LC-states\n\u00d7 4 repeats \u00d7 12 wavelengths = 202 frames covers \u223c 6 seconds.\n\nCCD\n10/90\n\n2.1. The optical setup\n\nCCD\nfilter wheel\n\n2. Polarimetric data acquisition\n\nchopper\n\ncorrection for telescope polarization, flatfielding, image restoration, and demodulation. In Sect. 2 we discuss the general setup\nof the data acquisition procedures, and in Sect. 3 the challenges\nand possibilities for calibration procedures. The proposed calibration procedure is presented in Sect. 4, results of the procedure\napplied to CRISP data are presented in Sect. 5, and the conclusions in Sect. 6.\n\nFig. 1. Schematic drawing of the optical set-up at the SST. After\nreflecting off the dichroic mirror separating the red and blue\nbeams (not shown), the red beam passes the chopper and prefilter. Then a beam splitter sends 10% of the light to the WB camera. The other beam passes the LCs, the high- and low-resolution\netalons of the CRISP filter (HRE and LRE resp.), and finally a\npolarizing beam splitter separating the p- and s-polarized light\nto the transmitted and reflected beams. All three cameras are\n1024\u00d71024 pixel CCD (Sarnoff) cameras running at \u223c36 Hz.\nscope Mueller matrix has been measured by Selbing (2006) and\nis assumed to be known here.\n2.3. Image restoration\n\nFor ground-based, high-resolution imaging, image restoration\nis a vital tool. However, it is especially important for multiwavelength and polarimetric observations, because it will reduce\ndifferential image shifts and blurring between images recorded\nat different wavelengths and polarization states. For polarimetric\ndata, this implies that the image restoration has to be done before demodulating the data (to convert the LC-states to Stokes\nparameters I,Q,U,V), because the images of the different LCstates are each associated with a particular seeing disturbance\nthat must be compensated for individually, to reduce artificial,\nseeing-induced signals. In our analysis we focused on image\nrestoration using MOMFBD (van Noort et al. 2005), but some\nof the complications discussed below are equally relevant for\nSpeckle restorations.\nMOMFBD has several properties that can complicate calibrations.\n1. The direct relation between an image pixel in the original\ndata and the restored image is lost.\n2. Artificial features in images can influence the wavefront\nsensing and can be amplified by the deconvolution.\n3. Input images are assumed to be monochromatic, although\nMOMFBD can handle different wavelength channels within\none restoration.\n4. Noise is assumed to follow a Gaussian distribution with a\nconstant width over each isoplanatic patch, which can be a\nproblem when high-contrast targets are observed.\nThe loss of the direct relation between input data pixels and\nrestored data pixels means that all calibrations that cannot be\ndone before image restoration, and hence before demodulating,\ncannot be done on a pixel-by-pixel basis, but involve the pointspread-functions (PSFs, which result from seeing and the finite\n\n\fSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\npupil size) of the input images. Similarly, artificial features in\nthe input images should be removed as much as possible before\nimage restoration, because they will interfere with the wavefront sensing and can be strongly amplified by the deconvolution. Input images that are not monochromatic over the FOV are\nrather hard to deal with, because this cannot be properly corrected without knowing the entire line profile.\nBoth the wavelength changes over the FOV and the assumption of noise with a Gaussian distribution of a constant width are\nlimiting factors for the maximum (polarimetric) accuracy that\ncan be obtained when using image restoration. To avoid interference from artifacts in the narrow band cameras on the wavefront\nsensing, one can only use images from the wide band camera\nfor the wavefront sensing and apply the corrections to the data\nof all cameras. However, the additional wavefront information\ncontained in the narrow band data is then not used for the image\nrestoration.\nThe changing beam configuration due to seeing corrections\nby the AO (and tip-tilt mirror) in principle also affects data calibration, because it changes the way the optics in front of the AO\nare sampled. However, it does not prevent pixel-based calibrations, and since we assume the telescope matrix is constant over\nthe FOV, the effects of the changing beam configuration are not\nconsidered here. Image restoration of the data used in this paper\nwas performed with MOMFBD assuming isoplanatic patches of\n96\u00d796 pixels (\u223c5.7\u00d75.700 ) and using 37 Karhunen-Lo\u00e8ve modes\nfor modeling the wavefront phases.\n\n3. Instrument calibration\nA straightforward calibration scheme typically involves the following steps.\n1. Dark-correct data from the different cameras (transmitted,\nreflected, and wide band).\n2. Gain-correct the different LC-state and wavelength images\nof all cameras.\n3. Use image restoration to combine the data for the different\ncameras and states, and correct for the seeing.\n4. Demodulate transmitted and reflected beams using the polarization calibration matrix (see Appendix A).\n5. Combine Stokes images from the transmitted and reflected\nbeams to reduce seeing crosstalk.\n6. Compensate for telescope polarization using the inverse of\nthe telescope Mueller matrix.\nDue to specific instrumental properties, such as polarizationdependent flatfields and FPI inhomogeneities, polarimetric and\nspectral calibration problems arise in steps 2 to 4. These are discussed in more detail below.\n3.1. Polarimetric issues\n\nFor polarimetric calibration of the data it is convenient to split\nthe calibration in two parts.\n1. Telescope, from the 1-m primary lens at the entrance of the\nvacuum tube down to the exit window at the bottom of the\nvacuum tube. Due to the 45\u25e6 angle of incidence on the rotating azimuth- and elevation-mirrors, this part is intrinsically\ntime variable, but is assumed to be independent of the lineof-sight (constant over the FOV). A model describing the\nMueller matrix of the telescope as a function of the azimuth\nand elevation angles at 6302 \u00c5 was determined by Selbing\n(2006).\n\n3\n\n2. Instrument, from the vacuum exit window to the CCDs.\nThis part is FOV-dependent (e.g. dust close to the focal\nplane), but can be calibrated daily using calibration optics\nand is assumed not to vary in time. It is described by a modulation matrix, which converts the input Stokes vector into\nintensities measured with the LC-states. How this matrix can\nbe determined is described in Appendix A.\nWe can describe the total conversion matrix of the system (A)\nas a matrix product of the Mueller matrix of the telescope T and\nthe modulation matrix of the instrument M:\nA(x, y, t) = M(x, y) * T (t),\n\n(1)\n\nwhere the transmitted and the reflected beams have their own\n(although related) modulation matrices. Because the intensity of\nthe light during the determination of the telescope matrix and the\nmodulation matrix is not known, an additional gain calibration is\nstill required. The telescope matrix T (t) varies with time, so the\ntotal system response matrix A is time dependent. This means\nthat unless the flatfield images and the data are recorded at the\nsame time, which is not practical, an appropriate gain correction\n(for the modulated data) must be computed. To this end, the flatfield must first be transformed to a time-independent location.\nThe obvious (and only) place available for this is the plane of\nthe sky, i.e. on the Sun, since we assume that all time variability\nis contained in the telescope matrix. The details of this procedure\nare discussed in Sect. 4.\n3.2. Spectral issues\n\nAn important calibration problem is that part of the intensity\nchanges over the field of view are not the result of real CCD gain\nvariations, but of variations in FPI reflectivity and cavity size\n(see, e.g., Reardon & Cavallini 2008; Cauzzi et al. 2009). When\nobserving at a wavelength where \u03b4I/\u03b4\u03bb , 0, e.g. in the wing of\na spectral line, a wavelength shift due to a cavity error results in\na change in the observed intensity that is completely unrelated\nto the gain of that particular pixel. Similarly, variations in the\nreflectivity cause changes in the integrated transmission profile.\nThe question, however, is which flatfield correction should\nbe applied to the data. Although the intensity variations due to\ncavity errors are not real gain changes, the same cavity errors\nalso affect the science data. The line profiles in the science data\ncan be very different, though, so the intensity changes will in\ngeneral not be the same as in the flatfield data. A change in wavelength scale due to a cavity error just cannot be corrected in a\nflatfielding procedure, which only changes the intensity, unless\none knows the exact line profile. For a data calibration scheme\nwithout image restoration, one could attempt to somehow determine the real pixel gains, apply those, and account for the\nwavelength shifts later on in the analysis. For image restoration,\nhowever, the intensity variations that then remain could pose a\nproblem for the wavefront sensing and/or the deconvolution.\nThe strategy that we propose is discussed in the next section.\n\n4. Calibration scheme\nFor the wavefront sensing part of the image restoration, it is important to use images that are as monochromatic as possible and\nthat have no sharp artifacts. Sharp features can result from CCD\npixel rows that have different responses to the polarization of the\nincoming Stokes vector, when the S/P beamsplitter (see Fig. 1)\nis not 100% effective. These pixels then stand out in some of\n\n\f4\n\nSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\nthe matrix elements of M. Such features should be reproduced\nin flatfields that are properly converted to the time of the observations, because this information is contained in the modulation\nmatrix, as long as the polarization of the incoming light is low,\nthe telescope polarization is known, and the instrument is stable. Therefore these features should be removed from the data\nby flatfielding.\nDealing with the non monochromatic nature of the data, resulting from FPI transmission variations over the FOV, is more\ncomplicated. In the final restored data, one can attempt to take\nthe wavelength shifts caused by cavity errors into account, although as a result of the image restoration process the effective\nshift in a given pixel in the restored image is always some mixture of the shifts of all CCD pixels within the PSFs of the dataset.\nFor the image restoration, the intensity changes are more problematic, especially if they contain high spatial frequencies, because these distort the wavefront sensing. Intensity changes due\nto reflectivity and cavity errors of the FPI cannot be interpreted\nas simply brighter or darker regions in the observed object by\nthe wavefront sensing, because they do not move with the object\nwhile the seeing varies throughout a dataset.\nOur approach is to use flatfields that make the data as smooth\nas possible, before using the data for the wavefront sensing. This\nis done using the recipe described in Sect. 4.1. These flatfields\ninclude intensity changes due to varying cavity properties over\nthe FOV. This is a straightforward choice, but a relatively arbitrary one, because such a flatfield will only properly correct\nthese intensity changes if the observed line profile is the same as\nthe one of the flatfield data, which is in general not the case. For\nthe final restored data however, we do not want to use these flatfields, because they modify the observed line profiles, but rather\nthose flatfields that are properly corrected for the varying cavity\nproperties.\nA relatively simple way to obtain flats that are not affected\nby cavity errors in the FPI would be to use a wavelength close\nto the observed line where \u03b4I/\u03b4\u03bb = 0. However, such a method\ndoes not account for the wavelength dependence of the flatfields\nfrom variations in the prefilter transmission profile, LRE/HRE\nco-tuning errors and the wavelength dependent fringes that are\nobserved in the Sarnoff cameras. Additionally, the wavelength\nwhere such flats have to be taken might not correspond to the\npreferred continuum point, because the instrumental response\nhas to be taken into account, increasing the time required for\ncalibrations. Therefore we developed a more accurate routine to\nderive proper flatfields, which simultaneously solves for the FPI\ncavity and reflectivity errors, and prefilter changes over the FOV.\nThis routine is described in Sect. 4.2.\n4.1. Time-independent and image-restoration flatfields\n\nThe proposed scheme thus consists of creating flats especially\ndesigned to minimize image restoration artifacts and timeindependent flatfields that should properly flatfield the data without modifying the line profile. The image restoration flatfields\nare applied before the image restoration process, but removed\nagain afterwards when the time-independent flatfields are applied.\nTo obtain time-independent flatfields, we have to invert the\nmodulation matrix of each pixel to obtain the demodulation matrix (M\u22121 , the inverse of the modulation matrix M). By applying the demodulation matrix to the flatfield data of the 4 LCstates, we obtain flatfield images for all Stokes parameters under\nthe vacuum-tube's exit window. Using the inverse Mueller matrix of the telescope, valid for the time at which the flatfields\n\nwere taken, we can calculate the Stokes flats on the Sun (on the\nplane of the sky). The flatfields represent the effective flatfields\nfor Stokes I, Q, U, and V. An overview of how both the timeindependent and image-restoration flatfields are determined is\nshown in Fig. 2.\nTo calculate the flatfields relevant for the time the observations were obtained, one has to apply the telescope matrix applicable for that time to the flatfields on the Sun and then apply the modulation matrix. For this we only use the Stokes I\nflatfield (and set Stokes Q, U, and V to 0) to avoid imprinting\na polarization pattern on our LC1..4 flats (which results from\nthe FOV-variations in the Stokes QUV-to-LC1..4 components of\nM). These flats will include intensity changes due to cavity and\nreflectivity errors, which should smooth these variations in the\ndata (when wavelength shifts due to line-of-sight velocity variations are small compared to the cavity errors). Also the polarization levels should be properly reproduced to the accuracy that\nthe telescope Mueller matrix and modulation matrix are known,\nif the intrinsic polarization of the observed target is low.\n4.2. Determining the proper flatfields\n\nThe FPI has small variations in the cavity size and reflectivity,\nwhich results in changes in the central wavelength and width\nof the transmission profile, respectively. In addition, the central\nwavelength of the prefilter shows a slight variation over the FOV\nas the angle of incidence on the prefilter changes (due to the\nphysical dimensions of the CCD). To determine the real transmission over the FOV, one has to account for these effects. At\nthe SST, flatfields are determined by summing many (\u223c1000)\nexposures per state and wavelength obtained while the telescope pointing is moving across the solar disk (to avoid intensity\nchanges over the FOV due to limb darkening). If one assumes\nthat the observed line profile of the averaged flatfield is constant\nover the FOV, then the different factors can be determined by\nusing an iterative fitting scheme.\nThe transmission of a single FPI is given by the Airy function\n(e.g. Kentischer et al. 1998):\nT FPI =\n\n1\n1 + F sin (2\u03c0dn cos \u03b8/\u03bb)\n2\n\n(2)\n\nwhere the finesse F is given by\nF=\n\n4R\n(1 \u2212 R)2\n\n(3)\n\nwith R the reflectivity, d the cavity size, n the refractive index\nin the cavity, \u03b8 the angle of incidence, and \u03bb the wavelength.\nThe total transmission \u03a8 of the dual FPI setup of CRISP is calculated by multiplying the transmission of the high-resolution\n(T hr ) and low-resolution FPI (T lr ), assuming \u03b8 = 0 and assuming that cavity and reflectivity errors in the low-resolution FPI\ncan be neglected because those in the high-resolution FPI will\nbe dominant:\n\u03a8(R, \u2206R) = T lr (R) * T hr (R + \u2206R).\n\n(4)\n\nBecause the spectral range used is only a small fraction of the\nprefilter transmission profile width, we can limit the number of\nfree parameters by not including the average prefilter shape in\nour fits, but instead only fit the deviations from the mean prefilter\nshape, assuming a linear dependence on wavelength.\nGiven the constant line profile \u03c6(\u03bb), average transmission\nprofile \u03a8(R) of the combined FPIs, and (wavelength independent) gain g, the observed line profile in pixel i will be given\n\n\fSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\nLC1..4 flats\n\nNormalize\nflats\n\nDarks\n\nSubtract\ndark\n\nIQUV flats\nplane of the sky\n\nApply T(t obs )\n\nFit lineprofile\n\nNormalized\nLC1..4 flats\n\nIQUV flats\nexit window\n\nDemodulate\n\n5\n\n\u22121\n\nApply T(t flat )\n\nTime independent\nflats\n\nIQUV flats t obs\nexit window\n\nFlats for\nwavefront sensing\n\nModulate\n\nFig. 2. Flowchart illustrating the procedure used to calculate the flatfields used for wavefront sensing and the time-independent\nflatfields corrected for wavelength shifts.\nby\n\n1.3\n\n\u03c6obs,i (\u03bb) = gi * [(1 + D p f,i ) * (\u03bb \u2212 \u03bb0 )] * \u03a8(R + \u2206Ri ) \u2217 \u03c6(\u03bb \u2212 \u2206\u03bbi ) (5)\nIntensity\n\n1.1\n1.0\n0.9\n0.8\n0.7\n0.6\n1.3\n\nIteration = 0\n\u22120.2\n\n0.0\n\n0.2\n\n0.4\n\n0.6\n\n\u03bb \u2212 \u03bb0 [\u00c5]\n\n1.2\n\nIntensity\n\nwhere gi is the pixel gain, D p f,i the prefilter deviation factor,\n\u2206Ri the reflectivity error, \u2206\u03bbi the cavity error, and \u03bb0 the central\nwavelength of the line.\nThe iterative scheme is initiated by setting gi to the inverse\nof the mean intensity of the line profile, \u03bb0 \u2212 \u2206\u03bbi to the minimum of a parabolic fit to the line minimum, and D p f,i and \u2206Ri to\nzero. After applying these corrections, one can overplot all the\nobserved line profiles and determine the average line profile by\ncalculating a spline through a set of points at fixed wavelengths,\nfor which the intensity is determined by a \u03c72 minimalization routine (see Fig. 3; all fitting was done using the mpfit package, see\nMarkwardt 2009; Mor\u00e9 1978). The \"real\" line profile is then calculated by deconvolving this fitted line profile with the average\ntransmission profile. As we now have an estimate for the average line profile and transmission profile, we can fit for the four\nunknown parameters in Eq. 5 for each pixel. These parameters\nallow us to improve our estimate for the average line profile and\ntransmission profile. These two steps can be repeated until no\nmore improvement is made.\nResults of this fitting routine applied to a real dataset (see\nSect. 5) are shown in Figs. 3 and 4. The total gain of a pixel\nis determined by the wavelength-independent part gi and a\nwavelength-dependent part given by the ratio of the observed\nintensity and the fitted line profile, as shown in Fig. 3.\n\n1.2\n\n1.1\n1.0\n0.9\n0.8\n0.7\n0.6\n\nIteration = 2\n\u22120.2\n\n0.0\n\n0.2\n\n0.4\n\n0.6\n\n\u03bb \u2212 \u03bb0 [\u00c5]\n\nFig. 3. Density plot of intensity (arbitrary units) vs. wavelength\nrelative to line core for all points in the summed flatfield data\nbefore the first iteration (top, where the line center has been determined using a parabolic fit to the line core) and the same plot\nafter the second iteration (bottom). The average line profile \u03c6(\u03bb),\ndescribed by a spline curve through several nodes (red plusses),\nis overplotted in red.\n\n4.3. The prefilter transmission profile\n\nAfter the prefilter deviation factor and average line profile have\nbeen determined, we use the average line profile of all the pixels (corrected for cavity errors and gain) to determine the average prefilter shape T PF . The prefilter, which is mounted at a\nslight angle to tune the central wavelength, is assumed to have a\nLorentzian profile:\nT PF (\u03bb) =\n\n1\n1 + (2 (\u03bb \u2212 \u03bb0,PF )/w)2Ncav\n\n(6)\n\nwhere \u03bb0,PF is the prefilter central wavelength, w the full-width\nat half-maximum (FWHM), and Ncav (=2) the number of cavities\nof the prefilter.\n\nThe prefilter parameters \u03bb0,PF and w are determined by\nmatching the average observed line profile to the line profile\nof the FTS atlas (the atlas acquired with the Fourier transform\nspectrometer at the McMath-Pierce Telescope, available from\nBrault & Neckel 1987) convolved with the average transmission\nof CRISP (see Fig. 5), masking the points in the telluric line. We\nfind a prefilter width of 4.7\u00b10.4 \u00c5, which agrees with the specification of 4.4-4.6 \u00c5, and a central wavelength of 6301.2\u00b10.2 \u00c5.\n\n\f6\n\nSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\n\u221240 \u221232 \u221224 \u221216 \u22128\n\n0\n\n8\n\n16\n\n24\n\n32\n\n40\n\n\u22121.5\u22121.2\u22120.9\u22120.6\u22120.3 0.0\n\n0.3\n\n0.6\n\n0.9\n\n1.2\n\n1.5\n\nReflectivity deviations [%]\n\nWavelength shift [m\u00c5]\n\n\u22120.2\n\n\u22120.1\n\n0.0\n\nPrefilter variation factor [\u00c5\n\n0.1\n\u22121\n\n]\n\nFig. 4. Wavelength shift resulting from cavity errors (left), variations in the FPI reflectivity (middle, nominal value 93.5%), and the\nprefilter variation factor (right) as determined by the fitting routine described in Sect. 4.2 (see also Eq. 5) when applied to the 6302\n\u00c5 dataset presented in Sect. 5.\n1.0\n\nIntensity\n\n0.9\n0.8\n0.7\nPrefilter\nFTS atlas\nData corrected\nData\n\n0.6\n0.5\n\u22120.2\n\n0.0\n\n0.2\n\n0.4\n\n0.6\n\n\u03bb \u2212 \u03bb0 [\u00c5]\n\nFig. 5. The prefilter shape (dashed line) is determined by matching the uncorrected average spectrum (crosses) to the FTS convolved with the CRISP transmission (full black line). After correcting for the prefilter, an excellent match is found (red circles).\nThe points in the telluric line (gray circles) were not used in the\nprocedure.\n\ntermined as described in Sect. 4.1, which are used for the image\nrestoration process. These flatfields are then removed from the\nrestored data and the true flatfield applied by multiplying the\ndata with the ratio of the image restoration flatfield and the true\nflatfield, convolved with the average PSF. The demodulation is\nthen performed with the inverse of the modulation matrix convolved with the average PSF. The idea behind this is that each\npixel in the restored image \"samples\" the whole PSF, and therefore the convolved calibration data should be applied.\nAn alternative method, which is simpler but computationally more expensive, is the iterative method, which will be described in more detail in a future paper we are preparing. This\napproach solves the entire forward problem, including all the\ncalibrations and individual PSFs, and iteratively improves the incoming Stokes images to find the solution that fits the observed\ndata best.\n\n5. Results\n4.4. Iterative versus direct method\n\nAfter calculating both the actual CCD gains that we want to apply in the end and flatfields that should be used for the image\nrestoration, we still have to account for the impact of the image\nrestoration process, as the result of which the 1-to-1 pixel relation is lost. Here we discuss two possible approaches to that\nproblem:\n\u2013 Direct method. Apply the flatfields prepared for the image\nrestoration to the data and after the image restoration remove\nthese flatfields and apply the time-independent flatfields, taking the average of the PSFs determined by the image restoration process into account.\n\u2013 Iterative method. Use the PSFs that have been determined\nby the image restoration to iteratively determine the Stokes\nimages that best reproduce the observed data given the telescope Mueller matrix, modulation matrix, PSFs, and gains.\nAn overview of both methods is presented in Fig. 6. For the\ndirect method, flatfields for the time of the observations are de-\n\n5.1. Example: sunspot 6302\n\nAs a test of our reduction method, we reduced a dataset from 27\nOctober 2009, which has part of the \u03b4 sunspot AR11029 in the\nfield of view (see Fig. 7) at a heliocentric angle of about 45\u25e6 (\u03bc \u2248\n0.7). The data contain 11 equidistant wavelength points around\nthe core of the Fe i 6302.5 \u00c5 line with a wavelength separation\nof 48 m\u00c5 and a continuum point at +600 m\u00c5.\n5.2. Stokes parameters\n\nIn Fig. 7 we show the improvement in the Stokes parameters that\nis reached by using the scheme described in Sect. 4 as compared\nto straightforwardly applying standard calibrations as listed in\nSect. 3. Polarimetric errors due to the changing telescope polarization that influences the flatfields are visible as saddle-shaped\noffsets, a vertical fringe-like pattern, and sharp lines in Stokes\nQ, U, and V. These errors almost completely disappear with the\nnew calibration method.\n\n\fSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\nLC1..4 data\n\nGuess for\nIQUV images\n\nSubtract dark\n\nFlats for\nwavefrontsensing\n\nDivide\nby flats\n\nCorrected\nLC1..4 data\n\nWavefront\nsensing\n\nPSF's\n\nadd\n\nConvolve\n\nMultiply\ndeconvolve\ncombine\n\n7\n\nLC1..4 data\nseeing corr.\n\nTime independent\nflats\n\nApply T(t )\nTime independent\nflats\n\nDivide\n\nmodulate\nModulation\nmatrices\n\nMultiply\n\nConvolve\n\nInvert\n\nDemodulate\nDefect\nFinal IQUV\nimages\nCorrection\n\nDirect method\n\nIterative method\n\nFig. 6. Flowchart illustrating the direct and indirect method to calculate the final Stokes I, Q, U, and V images using image restoration.\nThe origin of these problems lies in the variations in the modulation matrix. In Fig. 8 we show two representative examples of\nthe 16 components of the modulation matrix: the contributions\nof Stokes I and Q to LC-state 1. As for all the LC-states, the\nStokes I contribution shows a vertical fringe-like pattern over the\nwhole FOV, some smaller scale patterns, likely related to dust,\nand sharp lines. The Stokes Q contribution is much smoother\nand mainly shows a saddle shape and some sharp lines, which\nis typical of the contributions of Stokes Q, U, and V to the LCstates. Because such patterns are present in the modulation and\ndemodulation matrices, it is not possible to remove them both\nfrom the Stokes I, Q, U, and V images and from the corresponding modulated LC-states at the same time. Flats being chosen to\nmake the Stokes images smooth, implies that the modulated images will not be smooth, and vice versa. Therefore our scheme\nuses two sets of flats, one to make the modulated images smooth\nfor the wavefront sensing and one to properly flatfield the Stokes\nimages.\nThe dark regions in the Stokes V map in Fig. 7 are actual\nsignals redshifted into the continuum wavelength due to strong\ndownflows (see also Sect. 5.3). The small spot of fringes near\nthe bottom of the Stokes Q, U, and V images is likely from a polarizing speck, e.g. dust, in the telescope, which is not accounted\nfor in the telescope model. Outside these areas, the noise in the\ncontinuum point of the Stokes I normalized polarization images\nis \u223c0.3%.\n5.3. Inversion results\n\nThe data are inverted using the inversion code Nicole (SocasNavarro et al. 2011). For the inversions we use three nodes in\ntemperature, one node (i.e. the parameter has a constant value)\nin line-of-sight velocity (vlos ), and one node for the line-of-sight\nmagnetic field strength and the microturbulence. The average\n\ntransmission profile (see Sect. 4.2) is used to account for the\nfinite spectral resolution of CRISP.\nResults of the inversions are shown in Fig. 9. The shift in\nthe velocities due to cavity errors of the FPI is corrected by subtracting a map of the cavity errors as determined in Sect. 4.2\nconvolved with the average PSF of the whole dataset. The zero\nvelocity reference was set to the average velocity in the umbra.\nAdopting this velocity reference, we find a convective blueshift\nas measured from the granulation in the FOV of 0.3 km s\u22121 ,\nwhich is consistent with the theoretical value of 0.4 km s\u22121 (de\nLa Cruz Rodr\u0131\u0301guez et al. 2011).\nBoth the velocity and longitudinal magnetic field can reliably\nbe determined from the data, showing fast (\u223c5 km s\u22121 ) outflows\nat the center-side penumbra and downflows (up to \u223c10 km s\u22121 )\non the intersection between the umbra and penumbra slightly\nbelow the middle of the FOV. These downflows will be discussed\nin more detail in a future paper.\n\n6. Conclusions\nWe have presented a method for reducing full Stokes data obtained with CRISP at the SST, an instrument with a fast-tuning\nFabry-P\u00e9rot filter in a telecentric mount. Although some calibration issues are inherent to such an instrument used together with\nimage restoration, most problems can be overcome by using the\nproper calibration procedures.\nThe impact on the flatfields of wavelength shifts over the\nFOV, owing to cavity errors, can be corrected for. This is important for preventing changes in the line shape caused by errors\nin the gain tables. For instruments with the FPI in a collimated\nmount, the cavity errors occur in pupil space, and are therefore\nnot a problem in this respect. These instruments do show radial\nwavelength shifts over the FOV that have to be accounted for\n(Janssen & Cauzzi 2006).\n\n\f8\n\nSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\n40\"\n\n30\"\n\n20\"\n\n10\"\n\n0\"\n\n40\"\n\n30\"\n\n20\"\n\n10\"\n\n0\"\n\n40\"\n\n30\"\n\n20\"\n\n10\"\n\n0\"\n\n40\"\n\n30\"\n\n20\"\n\n10\"\n\n0\"\n0\"\n\n10\"\n\n20\"\n\n30\"\n\n40\"\n\n0\"\n\n10\"\n\n20\"\n\n30\"\n\n40\"\n\n0\"\n\n10\"\n\n20\"\n\n30\"\n\n40\"\n\nFig. 7. Continuum Stokes I, Q, U, and V images (from top to bottom) of the sunspot observed with the SST in the 6302.5 \u00c5 Fe i\nline on 27 October 2009. The images on the left were calibrated with the described calibration scheme and the iterative method,\nthe images in the middle used the direct method instead, and the images on the right were calibrated by straightforwardly applying\nstandard calibrations as listed in Sect. 3 and using the direct method. The full range of the polarized images is \u22121.5% to +1.5%. The\narrows indicate where sharp artifacts occur for some methods. Continuum offsets in the Q, U, and V images, most likely resulting\nfrom discrepancies in the telescope model, of up to \u223c0.35% have been subtracted. The small dark region visible in the Stokes V\nimage is actual signal in a region with strong downflows (see text).\n\n\fSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\n40\"\n\n40\"\n\n30\"\n\n30\"\n\n20\"\n\n20\"\n\n10\"\n\n10\"\n\n9\n\n0\"\n\n0\"\n0\"\n\n10\"\n\n20\"\n\n0.990\n\n30\"\n\n0\"\n\n40\"\n\n0.995\n\n10\"\n\n0.55\n\n1.000\n\n20\"\n\n0.60\n\n30\"\n\n0.65\n\n40\"\n\n0.70\n\n0.75\n\nStokes Q to LC1 component of the modulation matrix\n\nStokes I to LC1 component of the modulation matrix\n\nFig. 8. Variations in modulation matrix elements over the FOV. The element describing the contribution of Stokes I to LC-state 1 is\nshown on the left and the contribution of Stokes Q to LC-state 1 is shown on the right.\n\n40\"\n\n30\"\n\n20\"\n\n10\"\n\n0\"\n0\"\n\n10\"\n\n20\"\n\n0.6\n\n30\"\n\n0.8\n\n40\"\n\n1.0\n\nNormalized Intensity\n\n0\"\n\n1.2\n\n10\"\n\n\u22121.0\n\n20\"\n\n30\"\n\n\u22120.5\n\n40\"\n\n0.0\n\nBl [kG]\n\n0\"\n\n0.5\n\n10\"\n\n\u22123\n\n\u22122\n\n20\"\n\n\u22121\n\n30\"\n\n0\n\nVlos [km s\n\n1\n\u22121\n\n40\"\n\n2\n\n3\n\n]\n\nFig. 9. Results of inversions of the data, showing normalized continuum intensity (left), the line-of-sight component of the magnetic\nfield (middle), and the line-of-sight component of the velocity (right). The inversions reveal quite strong outflows (up to about 5\nkm s\u22121 ) and strong downflows (\u223c10 km s\u22121 ). The limb is towards the upper right.\nWithout a proper calibration scheme, the polarimetric imprint of the flatfielding can cause strong saddle-shaped offsets,\nfringes, and sharp lines from deviating pixel rows/columns that\nare enhanced by the deconvolution in the image restoration. By\nusing the proposed calibration scheme these artifacts can almost\nbe completely removed. Any remaining weak artifacts are most\n\nlikely due to discrepancies in the SST telescope model, which\nis only accurate to a few tenths of a percent, and nonzero intrinsic polarization. The severity of the artifacts depends on the\n(variation in the) telescope polarization and the variations in the\nmodulation matrix elements over the FOV. For telescopes that\nhave low and/or constant intrinsic polarization and instrumenta-\n\n\f10\n\nSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\ntion whose modulation matrix elements are nearly constant over\nthe FOV, such flatfielding problems will be much less severe.\nVelocities, as determined from inversions of the data, can be\ncorrected for cavity errors using a convolved version of the cavity map. However, the PSFs will vary from wavelength to wavelength resulting in a non equidistant wavelength sampling. Both\nthe wavelength sampling and the variations in the width of the\nFPI transmission peak will vary from pixel to pixel, but can in\nprinciple be taken into account during the inversions. An intrinsic limitation is the use of non monochromatic input images for\nthe image restoration, which results in deconvolution artifacts:\nmixing of information from different wavelengths through the\nimage restoration procedure.\nModern developments in FPI instrumentation, such as rapid\n(kHz) modulation combined with charge shuffling (which may\nallow for demodulation before image restoration), could reduce\ncalibration problems. However, to reach the polarimetric and\nspectroscopic accuracy that the future large solar observatories\nEST and ATST are aiming for with the next generation of FabryP\u00e9rot systems, advanced calibration techniques and optimized\noptical designs to deal with the issues discussed here will be required.\nAcknowledgements. We would like to thank P. S\u00fctterlin for taking the observations. This research project has been supported by a Marie Curie Early Stage\nResearch Training Fellowship of the European Community's Sixth Framework\nProgramme under contract number MEST-CT-2005-020395: The USO-SP\nInternational School for Solar Physics. The Swedish 1-m Solar Telescope is operated on the island of La Palma by the Institute for Solar Physics of the Royal\nSwedish Academy of Sciences in the Spanish Observatorio del Roque de los\nMuchachos of the Instituto de Astrof\u0131\u0301sica de Canarias.\n\nReferences\nBrault, J. W. & Neckel, H. 1987, ftp://ftp.hs.uni-hamburg.de/pub/outgoing/FTSAtlas\nCauzzi, G., Reardon, K., Rutten, R. J., Tritschler, A., & Uitenbroek, H. 2009,\nA&A, 503, 577\nCavallini, F. 2006, Sol. Phys., 236, 415\nde La Cruz Rodr\u0131\u0301guez, J., Kiselman, D., & Carlsson, M. 2011, A&A, 528, 113\nJanssen, K. & Cauzzi, G. 2006, A&A, 450, 365\nKentischer, T. J., Schmidt, W., Sigwarth, M., & Uexkuell, M. V. 1998, A&A,\n340, 569\nL\u00f6fdahl, M. G. 2002, in Proc. SPIE, Vol. 4792, Image Reconstruction from\nIncomplete Data II, ed. Bones, Fiddy, & Millane, 146\nMarkwardt, C. B. 2009, in Astronomical Society of the Pacific Conference\nSeries, Vol. 411, Astronomical Society of the Pacific Conference Series, ed.\nD. A. Bohlender, D. Durand, & P. Dowler, 251\nMor\u00e9, J. 1978, in Lecture Notes in Mathematics, Vol. 360, Numerical Analysis,\ned. G. A. Watson, 105\nPuschmann, K. G., Kneer, F., Seelemann, T., & Wittmann, A. D. 2006, A&A,\n451, 1151\nReardon, K. P. & Cavallini, F. 2008, A&A, 481, 897\nScharmer, G. B. 2006, A&A, 447, 1111\nScharmer, G. B., Narayan, G., Hillberg, T., et al. 2008, ApJ, 689, L69\nSelbing, J. 2006, Master's thesis, Stockholm University\nSocas-Navarro, H., de la Cruz Rodr\u0131\u0301guez, J., Asensio-Ramos, A., TrujilloBueno, J., & Ruiz-Cobo, B. 2011, in preparation\nvan Noort, M., Rouppe van der Voort, L., & L\u00f6fdahl, M. G. 2005, Sol. Phys.,\n228, 191\nvan Noort, M. J. & Rouppe van der Voort, L. H. M. 2008, A&A, 489, 429\nvon der L\u00fche, O. 1993, A&A, 268, 374\n\n\fSchnerr et al.: Stokes imaging polarimetry using image restoration: A calibration strategy for Fabry-P\u00e9rot based instruments\n\n11\n\nAppendix A: Determining the modulation matrix\nWhen fitting the pixel-dependent system response matrix M, it is important to realize that the incoming intensity I is not known. A fit can therefore only be made\non the fractional polarization, which means that we need to normalize the data with the intensity. The resulting data, lacking absolute transmission information, can\nonly be used to determine the modulation matrix up to a constant factor \u03bb\u22121 . Moreover, the normalization of the data requires us to compute the intensity from the\ndata using the inverse of the unknown modulation matrix M. It is therefore more natural to formulate the fit directly in terms of the demodulation matrix M\u22121 :\n\nM\u22121\n\n\uf8eb\n\uf8ec\uf8ec\uf8ec b11\n\uf8ec\uf8ec b\n= \uf8ec\uf8ec\uf8ec\uf8ec\uf8ec 21\n\uf8ec\uf8ed b31\nb41\n\nb12\nb22\nb32\nb42\n\nb13\nb23\nb33\nb43\n\nb14\nb24\nb34\nb44\n\n\uf8f6\n\uf8f7\uf8f7\uf8f7\n\uf8f7\uf8f7\uf8f7\n\uf8f7\uf8f7\uf8f7 .\n\uf8f7\uf8f7\uf8f8\n\nThe calibration data is taken using a linear polarizer followed by a \u03bb/4-wave plate, which produces a known (relative) polarization, independent of polarization\nof the incoming light, by separately rotating the two plates. Given the calibration data v and the known (normalized) Stokes vector of the incoming light S, we have\nfor each calibration measurement point n with unknown intensity In\nbi j v j,n = S i,n Il = S i,n\n\n4\nX\n\n(A.1)\n\nb1k vk,n\n\nk=1\n\nso that for a given guess-solution for M\u22121 , the total accumulated fit error between the data and the guess matrix can be written as\n\uf8eb\n\uf8f62\n4 X\uf8ec\n4\n4\n\uf8f7\uf8f7\uf8f7\nX\nX\n\uf8ec\uf8ec\uf8ecX\n\uf8ec\n\u03c7 =\nb1 j v j,n \uf8f7\uf8f7\uf8f7\uf8f7\uf8f8 .\n\uf8ec\uf8ec\uf8ed bi j v j,n \u2212 S i,n\n2\n\ni=1\n\nn\n\nj=1\n\n(A.2)\n\nj=1\n\nDue to the use of normalized data, we have\n4\nX\n\nb1 j = \u03bb.\n\n(A.3)\n\nj=1\n\nSubstitution in Eq. A.2 eliminates the contribution to \u03c72 for i = 1, as S i,n = 1. The minimum value of \u03c72 is then given by\n\n\u2202\u03c72\n\u2202bkl\n\n= 0, giving\n\n\uf8eb\n\uf8ee\n\uf8f9\uf8f62\n4\n4\n4\n\uf8fa\uf8fa\uf8fa\uf8f7\uf8f7\uf8f7\nX\n\uf8ef\uf8ef\uf8ef\uf8ef\n\u2202 X X \uf8ec\uf8ec\uf8ec\uf8ec\uf8ecX\n\uf8ef\nb1 j (v j,n \u2212 v1,n )\uf8fa\uf8fa\uf8fa\uf8fa\uf8fb\uf8f7\uf8f7\uf8f7\uf8f7\uf8f8 = 0\n\uf8ec bi j v j,n \u2212 S i,n \uf8ef\uf8ef\uf8f0\u03bbv1,n +\n\u2202bkl i=2 n \uf8ec\uf8ed j=1\nj=2\n4 X\nX\n\u2202\n\u2202bkl\ni=2 n\n\n\uf8f9\uf8f62\n\uf8ee\n\uf8eb\n4\n4\n\uf8fa\uf8fa\uf8fa\uf8f7\uf8f7\uf8f7\n\uf8ef\uf8ef\n\uf8ec\uf8ec\uf8ecX\nX\n\uf8ec\uf8ec\uf8ec\uf8ec bi j v j,n \u2212 S i,n \uf8ef\uf8ef\uf8ef\uf8ef\uf8ef\u03bbv1,n +\nb1 j (v j,n \u2212 v1,n )\uf8fa\uf8fa\uf8fa\uf8fa\uf8fb\uf8f7\uf8f7\uf8f7\uf8f7\uf8f8 = 0.\n\uf8f0\n\uf8ed\nj=2\n\nj=1\n\nApplying the chain rule results in\n\uf8f6\n\uf8f9\uf8f6 \uf8eb\n\uf8ee\n\uf8eb\n4\n4\n4\n4\n4 X\uf8ec\n\uf8f7\uf8f7\uf8f7\n\uf8fa\uf8fa\uf8fa\uf8f7\uf8f7\uf8f7 \uf8ec\uf8ec\uf8ecX\n\uf8ef\uf8ef\uf8ef\nX\nX\nX\n\uf8ec\uf8ec\uf8ecX\n\uf8fa\n\uf8f7\n\uf8ec\n\uf8ef\n\uf8ec\uf8ec\uf8ec bi j v j,n \u2212 S i,n \uf8ef\uf8ef\uf8ef\u03bbv1,n +\n\u03b41k \u03b4 jl (v j,n \u2212 v1,n )\uf8f7\uf8f7\uf8f7\uf8f7\uf8f8 = 0,\nb1 j (v j,n \u2212 v1,n )\uf8fa\uf8fa\uf8fa\uf8fb\uf8f7\uf8f7\uf8f7\uf8f8 \uf8ec\uf8ec\uf8ec\uf8ed \u03b4ik \u03b4 jl v j,n \u2212 S i,n\n2\n\uf8f0\n\uf8ed\ni=2\n\nn\n\nj=1\n\nj=2\n\nj=1\n\nj=2\n\nwhere the last two sums over j can be evaluated as\n\uf8eb\n\uf8ee\n\uf8f9\uf8f6\n4\n4\n4 X\uf8ec\n\uf8ef\uf8ef\uf8ef\n\uf8fa\uf8fa\uf8fa\uf8f7\uf8f7\uf8f7\nX\nX\n\uf8ec\uf8ec\uf8ecX\n\u0001\n\uf8ef\n\uf8ec\uf8ec\uf8ec bi j v j,n \u2212 S i,n \uf8ef\uf8ef\uf8ef\u03bbv1,n +\nb1 j (v j,n \u2212 v1,n )\uf8fa\uf8fa\uf8fa\uf8fa\uf8fb\uf8f7\uf8f7\uf8f7\uf8f7\uf8f8 \u03b4ik vl,n \u2212 S i,n \u03b41k (vl,n \u2212 v1,n ) = 0.\n\uf8ed\n\uf8f0\nn\n\ni=2\n\nj=1\n\nThis expression splits naturally into two separate cases:\nFor k = 1, l = 2, 3, 4:\n\uf8f9\uf8f6\n\uf8eb\n\uf8ee\n4 X\uf8ec\n4\n4\n\uf8fa\uf8fa\uf8fa\uf8f7\uf8f7\uf8f7\n\uf8ef\uf8ef\nX\nX\n\uf8ec\uf8ec\uf8ecX\n\uf8fa\uf8f7\uf8f7 \u2212S (v \u2212 v )\u0001 = 0\n\uf8ec\uf8ec\uf8ec bi j v j,n \u2212 S i,n \uf8ef\uf8ef\uf8ef\uf8ef\uf8ef\u03bbv1,n +\nb\n(v\n\u2212\nv\n)\n1 j j,n\n1,n \uf8fa\uf8fa\uf8fa\uf8fb\uf8f7\ni,n l,n\n1,n\n\uf8f7\uf8f8\n\uf8ed\n\uf8f0\nj=2\ni=2 n\nj=1\n\uf8f6\n\uf8eb\n4 X\n4\n4\n4 X\uf8ec\n\uf8f7\uf8f7\uf8f7\nX\nX\nX\n\uf8ec\uf8ec\uf8ecX\n\uf8f7\uf8f7\uf8f7 S (v \u2212 v ) = \u03bb\n2\n\uf8ec\uf8ec\uf8ec bi j v j,n \u2212 S i,n\nS i,n\nv1,n (vl,n \u2212 v1,n )\nb\n(v\n\u2212\nv\n)\ni,n\nj,n\n1,n\n1\nj\nj,n\n1,n\n\uf8f7\n\uf8f8\n\uf8ed\ni=2\n\nn\n\n(A.4)\n\nj=2\n\nj=1\n\ni=2\n\nj=2\n\n(A.5)\n\nn\n\nand for k > 1, l = 1, 2, 3, 4\n\uf8f9\uf8f6\n\uf8eb\n\uf8ee\n4\n4\n4 X\uf8ec\n\uf8fa\uf8fa\uf8fa\uf8f7\uf8f7\uf8f7\n\uf8ef\uf8ef\nX\nX\n\uf8ec\uf8ec\uf8ecX\n\uf8ec\uf8ec\uf8ec bi j v j,n \u2212 S i,n \uf8ef\uf8ef\uf8ef\uf8ef\uf8ef\u03bbv1,n +\nb1 j (v j,n \u2212 v1,n )\uf8fa\uf8fa\uf8fa\uf8fa\uf8fb\uf8f7\uf8f7\uf8f7\uf8f7\uf8f8 \u03b4ik vl,n = 0\n\uf8f0\n\uf8ed\ni=2\n\nn\n\nj=2\n\nj=1\n\n\uf8f6\n\uf8eb\n4\n4\n\uf8f7\uf8f7\uf8f7\nX\nX\nX \uf8ec\uf8ec\uf8ecX\n\uf8f7\uf8f7 v = \u03bb\n\uf8ec\uf8ec\uf8ec b v \u2212 S\nvl,n S k,n v1,n\nb\n(v\n\u2212\nv\n)\n1 j j,n\n1,n \uf8f7\nk j j,n\nk,n\n\uf8f7\uf8f8 l,n\n\uf8ed\uf8ec\nn\n\nj=1\n\nj=2\n\n(A.6)\n\nn\n\nThe solution of this system gives the least-squares fit to the data, which can be renormalized by choosing an appropriate value for \u03bb. The natural choice for \u03bb is\n2, as the maximum intensity measured by one of the beams of the polarimeter is 21 I for unpolarized light. The one remaining element b11 is constrained by Eq. A.3.\n\n\f"}