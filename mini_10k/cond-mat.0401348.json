{"id": "http://arxiv.org/abs/cond-mat/0401348v3", "guidislink": true, "updated": "2004-09-09T19:17:45Z", "updated_parsed": [2004, 9, 9, 19, 17, 45, 3, 253, 0], "published": "2004-01-19T22:47:02Z", "published_parsed": [2004, 1, 19, 22, 47, 2, 0, 19, 0], "title": "Method for Computing Protein Binding Affinity", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=cond-mat%2F0401549%2Ccond-mat%2F0401537%2Ccond-mat%2F0401174%2Ccond-mat%2F0401154%2Ccond-mat%2F0401227%2Ccond-mat%2F0401113%2Ccond-mat%2F0401312%2Ccond-mat%2F0401055%2Ccond-mat%2F0401580%2Ccond-mat%2F0401122%2Ccond-mat%2F0401404%2Ccond-mat%2F0401282%2Ccond-mat%2F0401410%2Ccond-mat%2F0401315%2Ccond-mat%2F0401623%2Ccond-mat%2F0401587%2Ccond-mat%2F0401608%2Ccond-mat%2F0401178%2Ccond-mat%2F0401011%2Ccond-mat%2F0401224%2Ccond-mat%2F0401504%2Ccond-mat%2F0401115%2Ccond-mat%2F0401347%2Ccond-mat%2F0401182%2Ccond-mat%2F0401348%2Ccond-mat%2F0401490%2Ccond-mat%2F0401400%2Ccond-mat%2F0401339%2Ccond-mat%2F0401539%2Ccond-mat%2F0401188%2Ccond-mat%2F0401085%2Ccond-mat%2F0401388%2Ccond-mat%2F0401190%2Ccond-mat%2F0401152%2Ccond-mat%2F0401260%2Ccond-mat%2F0401414%2Ccond-mat%2F0401134%2Ccond-mat%2F0401292%2Ccond-mat%2F0401409%2Ccond-mat%2F0401232%2Ccond-mat%2F0401466%2Ccond-mat%2F0401299%2Ccond-mat%2F0401189%2Ccond-mat%2F0401176%2Ccond-mat%2F0401361%2Ccond-mat%2F0401380%2Ccond-mat%2F0401596%2Ccond-mat%2F0401264%2Ccond-mat%2F0401319%2Ccond-mat%2F0401029%2Ccond-mat%2F0401615%2Ccond-mat%2F0401295%2Ccond-mat%2F0401560%2Ccond-mat%2F0401310%2Ccond-mat%2F0401510%2Ccond-mat%2F0401130%2Ccond-mat%2F0401652%2Ccond-mat%2F0401457%2Ccond-mat%2F0401099%2Ccond-mat%2F0401002%2Ccond-mat%2F0401258%2Ccond-mat%2F0401517%2Ccond-mat%2F0401235%2Ccond-mat%2F0401296%2Ccond-mat%2F0401474%2Ccond-mat%2F0401076%2Ccond-mat%2F0401593%2Ccond-mat%2F0401491%2Ccond-mat%2F0401217%2Ccond-mat%2F0401494%2Ccond-mat%2F0401308%2Ccond-mat%2F0401548%2Ccond-mat%2F0401566%2Ccond-mat%2F0401288%2Ccond-mat%2F0401253%2Ccond-mat%2F0401220%2Ccond-mat%2F0401185%2Ccond-mat%2F0401206%2Ccond-mat%2F0401058%2Ccond-mat%2F0401407%2Ccond-mat%2F0401128%2Ccond-mat%2F0401345%2Ccond-mat%2F0401471%2Ccond-mat%2F0401540%2Ccond-mat%2F0401284%2Ccond-mat%2F0401384%2Ccond-mat%2F0401606%2Ccond-mat%2F0401014%2Ccond-mat%2F0401335%2Ccond-mat%2F0401146%2Ccond-mat%2F0401552%2Ccond-mat%2F0401038%2Ccond-mat%2F0401340%2Ccond-mat%2F0401448%2Ccond-mat%2F0401429%2Ccond-mat%2F0401184%2Ccond-mat%2F0401110%2Ccond-mat%2F0401203%2Ccond-mat%2F0401527%2Ccond-mat%2F0401536%2Ccond-mat%2F0401645&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Method for Computing Protein Binding Affinity"}, "summary": "A Monte Carlo method is given to compute the binding affinity of a ligand to\na protein. The method involves extending configuration space by a discrete\nvariable indicating whether the ligand is bound to the protein and a special\nMonte Carlo move which allows transitions between the unbound and bound states.\nProvided that an accurate protein structure is given, that the protein-ligand\nbinding site is known, and that an accurate chemical force field together with\na continuum solvation model is used, this method provides a quantitative\nestimate of the free energy of binding.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=cond-mat%2F0401549%2Ccond-mat%2F0401537%2Ccond-mat%2F0401174%2Ccond-mat%2F0401154%2Ccond-mat%2F0401227%2Ccond-mat%2F0401113%2Ccond-mat%2F0401312%2Ccond-mat%2F0401055%2Ccond-mat%2F0401580%2Ccond-mat%2F0401122%2Ccond-mat%2F0401404%2Ccond-mat%2F0401282%2Ccond-mat%2F0401410%2Ccond-mat%2F0401315%2Ccond-mat%2F0401623%2Ccond-mat%2F0401587%2Ccond-mat%2F0401608%2Ccond-mat%2F0401178%2Ccond-mat%2F0401011%2Ccond-mat%2F0401224%2Ccond-mat%2F0401504%2Ccond-mat%2F0401115%2Ccond-mat%2F0401347%2Ccond-mat%2F0401182%2Ccond-mat%2F0401348%2Ccond-mat%2F0401490%2Ccond-mat%2F0401400%2Ccond-mat%2F0401339%2Ccond-mat%2F0401539%2Ccond-mat%2F0401188%2Ccond-mat%2F0401085%2Ccond-mat%2F0401388%2Ccond-mat%2F0401190%2Ccond-mat%2F0401152%2Ccond-mat%2F0401260%2Ccond-mat%2F0401414%2Ccond-mat%2F0401134%2Ccond-mat%2F0401292%2Ccond-mat%2F0401409%2Ccond-mat%2F0401232%2Ccond-mat%2F0401466%2Ccond-mat%2F0401299%2Ccond-mat%2F0401189%2Ccond-mat%2F0401176%2Ccond-mat%2F0401361%2Ccond-mat%2F0401380%2Ccond-mat%2F0401596%2Ccond-mat%2F0401264%2Ccond-mat%2F0401319%2Ccond-mat%2F0401029%2Ccond-mat%2F0401615%2Ccond-mat%2F0401295%2Ccond-mat%2F0401560%2Ccond-mat%2F0401310%2Ccond-mat%2F0401510%2Ccond-mat%2F0401130%2Ccond-mat%2F0401652%2Ccond-mat%2F0401457%2Ccond-mat%2F0401099%2Ccond-mat%2F0401002%2Ccond-mat%2F0401258%2Ccond-mat%2F0401517%2Ccond-mat%2F0401235%2Ccond-mat%2F0401296%2Ccond-mat%2F0401474%2Ccond-mat%2F0401076%2Ccond-mat%2F0401593%2Ccond-mat%2F0401491%2Ccond-mat%2F0401217%2Ccond-mat%2F0401494%2Ccond-mat%2F0401308%2Ccond-mat%2F0401548%2Ccond-mat%2F0401566%2Ccond-mat%2F0401288%2Ccond-mat%2F0401253%2Ccond-mat%2F0401220%2Ccond-mat%2F0401185%2Ccond-mat%2F0401206%2Ccond-mat%2F0401058%2Ccond-mat%2F0401407%2Ccond-mat%2F0401128%2Ccond-mat%2F0401345%2Ccond-mat%2F0401471%2Ccond-mat%2F0401540%2Ccond-mat%2F0401284%2Ccond-mat%2F0401384%2Ccond-mat%2F0401606%2Ccond-mat%2F0401014%2Ccond-mat%2F0401335%2Ccond-mat%2F0401146%2Ccond-mat%2F0401552%2Ccond-mat%2F0401038%2Ccond-mat%2F0401340%2Ccond-mat%2F0401448%2Ccond-mat%2F0401429%2Ccond-mat%2F0401184%2Ccond-mat%2F0401110%2Ccond-mat%2F0401203%2Ccond-mat%2F0401527%2Ccond-mat%2F0401536%2Ccond-mat%2F0401645&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "A Monte Carlo method is given to compute the binding affinity of a ligand to\na protein. The method involves extending configuration space by a discrete\nvariable indicating whether the ligand is bound to the protein and a special\nMonte Carlo move which allows transitions between the unbound and bound states.\nProvided that an accurate protein structure is given, that the protein-ligand\nbinding site is known, and that an accurate chemical force field together with\na continuum solvation model is used, this method provides a quantitative\nestimate of the free energy of binding."}, "authors": ["Charles F. F. Karney", "Jason E. Ferrara", "Stephan Brunner"], "author_detail": {"name": "Stephan Brunner"}, "author": "Stephan Brunner", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1002/jcc.20167", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/cond-mat/0401348v3", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/cond-mat/0401348v3", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "RevTex, 10 pages with 5 figures. Explanatory figure added", "arxiv_primary_category": {"term": "cond-mat.stat-mech", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "cond-mat.stat-mech", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "physics.bio-ph", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "physics.chem-ph", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "q-bio.QM", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/cond-mat/0401348v3", "affiliation": "Locus Pharmaceuticals", "arxiv_url": "http://arxiv.org/abs/cond-mat/0401348v3", "journal_reference": "J. Comput. Chem. 26(3), 243-251 (Feb. 2005)", "doi": "10.1002/jcc.20167", "fulltext": "Method for Computing Protein Binding Affinity\nCharles F. F. Karney\u2217 and Jason E. Ferrara\n\narXiv:cond-mat/0401348v3 [cond-mat.stat-mech] 9 Sep 2004\n\nSarnoff Corporation, Princeton, NJ 08543-5300\n\nStephan Brunner\u2020\nLocus Pharmaceuticals, Inc., Blue Bell, PA 19422-2700\n(Dated: July 14, 2004; revised September 9, 2004)\nA Monte Carlo method is given to compute the binding affinity of a ligand to a protein. The method involves\nextending configuration space by a discrete variable indicating whether the ligand is bound to the protein and\na special Monte Carlo move which allows transitions between the unbound and bound states. Provided that an\naccurate protein structure is given, that the protein-ligand binding site is known, and that an accurate chemical\nforce field together with a continuum solvation model is used, this method provides a quantitative estimate of\nthe free energy of binding.\nKeywords: free energy; binding affinity; Monte Carlo methods; equilibrium constants; proteins\n\nIntroduction\n\nMany drugs work by binding to a target protein in an organism and affecting the action of this protein. The binding\nof the drug molecule, the ligand L, to the protein P under\nphysiological conditions is usually reversible (characterized\nby weak chemical interactions rather than covalent bonds),\nL + P \u21cb LP,\nand, in equilibrium and in the dilute limit, the concentration of\nthe ligand-protein complex [LP] is given by the dissociation\nconstant\nKd =\n\n[L][P]\n.\n[LP]\n\nIt is convenient to define the binding affinity as\n\u0012\n\u0013\nKd /NA\npKd = \u2212 log10\n,\n1 kmol m\u22123\nwhere NA is the Avogadro constant. A high value for pKd is\ncrucial to obtaining a good drug molecule and, consequently,\nthe ability to compute pKd accurately would greatly accelerate drug discovery by allowing many molecules to be screened\nin silico before any time-consuming syntheses and assays are\ndone. The dissociation constant can also be expressed in terms\nof the binding free energy \u2206F ,\nKd = exp(\u03b2\u2206F )/V0 ,\n\n(1)\n\nwhere V0 is the system volume, \u03b2 = 1/(kT ), T is the temperature, and k is the Boltzmann constant. Similarly pKd is\ngiven by\npKd = \u2212\n\n\u03b2\u2206F\n+ log10 (V0 NA \u00d7 1 kmol m\u22123 ).\nln 10\n\nThe quantity \u2206F is the free energy difference of the ligand\nand the protein forming a bound complex LP, the \"bound system,\" compared to the ligand and the protein isolated from one\nanother L + P, the \"unbound system.\"\n\nIn order to compute pKd , we require (1) a sufficiently accurate model of the protein and the ligand and their interaction\nand (2) a good way to compute the resulting value of pKd .\nIn this paper, we assume the first requirement is fulfilled and\ninstead focus on meeting the second.\nThe standard methods of computing free energies [1, 2] are\nnot capable of computing \u2206F directly because the unbound\nand bound systems are too dissimilar, which hinders transitions between these systems. Instead, typically, two close ligands La and Lb , are compared separately unbound and bound\nto the protein, thereby obtaining the difference in the free energies \u2206Fa \u2212 \u2206Fb .\nWe present here a practical method for directly computing \u2206F and hence pKd . The method consists of: (1) formulating the problem in an extended phase space which allows the unbound and bound systems to be treated as a single\nsystem and Kd to be expressed as the ratio of two canonical averages; (2) introducing a new Monte Carlo move, the\n\"wormhole move,\" to make transitions between the unbound\nand bound states in this extended system; and (3) a method to\ndetermine the \"portals\" needed for the wormhole move.\n\nFormulation\n\nConsider a system of volume V0 consisting of a ligand molecule L and a protein molecule P dissolved in NS molecules\nS. The overall state of the system is given by [\u0393, \u0393S ] where\n\u0393 represents the phase space configuration of L and P and \u0393S\nrepresents the configurations of all the solvent molecules S.\nThe energy of the system is given by E(\u0393, \u0393S ) and, in equilibrium, the system obeys the Boltzmann distribution [3]\nf (\u0393, \u0393S ) = R\n\nexp[\u2212\u03b2E(\u0393, \u0393S )]\n.\nexp[\u2212\u03b2E(\u0393, \u0393S )] d\u0393 d\u0393S\n\nIt is frequently useful to average over the configurations of the\nsolvent molecules by integrating the Boltzmann distribution\n\n\f2\nover \u0393S to give a reduced Boltzmann distribution\nZ\nf (\u0393) =\nf (\u0393, \u0393S ) d\u0393S\n\nwhere\n\n= R\n\nexp[\u2212\u03b2E(\u0393)]\n,\nexp[\u2212\u03b2E(\u0393)] d\u0393\n\n\u0012Z\n\u0013\n1\nexp[\u2212\u03b2E(\u0393, \u0393S )] d\u0393S\nE(\u0393) = \u2212 ln\n\u03b2\nis the energy of the system with ligand and protein configurations specified by \u0393 and with the equilibrium effects of the\nsolvent implicitly included as a solvation free energy. In this\npaper, we will assume that E(\u0393) is given.\nTypical molecular interactions have a short range. In view\nof this, let us define \u03a30 to represent all accessible \u0393 space\n(i.e., L and P somewhere in the system volume V0 ), and \u03a31\nto represent that portion of \u03a30 where there is an appreciable\ninteraction between L and P which therefore form the complex LP. In the phase-space volume \u03a31 we write the energy\nas E1 (\u0393) which is just an alternate notation for the full energy\nE(\u0393), while in the volume \u03a30 \u2212 \u03a31 we may write the energy\nas E0 (\u0393) which we define as the \"unbound\" energy, i.e., E(\u0393)\nexcluding the interaction between L and P. The dissociation\nconstant can then be written as\n\u00112\n\u0010R\n\u2212\u03b2E(\u0393)\ne\nd\u0393\n\u03a30 \u2212\u03a31\n1\nR\nR\nKd =\nV0 \u03a30 e\u2212\u03b2E(\u0393) d\u0393 \u03a31 e\u2212\u03b2E(\u0393) d\u0393\n\u0010R\n\u00112\n\u2212\u03b2E0 (\u0393)\ne\nd\u0393\n\u03a30 \u2212\u03a31\n1\nR\n\u00d7\n=\n\u2212\u03b2E1 (\u0393) d\u0393\nV0\n\u03a31 e\n1\nR\nR\n.\n\u2212\u03b2E1 (\u0393) d\u0393\n\u2212\u03b2E0 (\u0393) d\u0393 +\ne\n\u03a31 e\n\u03a30 \u2212\u03a31\n\nIn the dilute limit V0 \u2192 \u221e, this can be simplified by ignoring the second term in the denominator of the last factor and\nby extending the limits of the integrals over \u03a30 \u2212 \u03a31 to include \u03a31 . In extending the definition of E0 (\u0393) to \u0393 \u2208 \u03a31 , we\ninclude the intramolecular energy and the solvation free energy but continue to omit the intermolecular (ligand-protein)\nenergy. This yields [1, 4, 5]\nR\n1 \u03a30 exp[\u2212\u03b2E0 (\u0393)] d\u0393\nR\nKd =\n.\n(2)\nV0 \u03a31 exp[\u2212\u03b2E1 (\u0393)] d\u0393\n\nThe Helmholtz free energy of the unbound and bound systems\nis [3]\n\u0012Z\n\u0013\n1\nexp[\u2212\u03b2E\u03bb (\u0393)] d\u0393 ,\nF\u03bb = \u2212 ln\n\u03b2\n\u03a3\u03bb\nfor \u03bb = 0 and 1, and Eq. (1) is obtained from Eq. (2) with\n\u2206F = F1 \u2212 F0 . The definition of Kd , Eq. (2), is strictly independent of V0 because of translational symmetry (ignoring\n\nboundary effects). It is also independent of the precise definition of \u03a31 , provided that \u03a31 includes the protein-ligand binding site and does not include a \"macroscopic\" volume beyond\nthis.\nIn this formulation, we have assumed that the system volume V0 is fixed. However, in most physiological systems, the\npressure is held constant and the binding affinity is then related to the differences in the Gibbs free energy which introduces a correction term which is the product of the pressure\nand the change in the volume caused by the formation of the\nLP complex [6]. We expect this correction to be small for\ntypical ligand-protein interactions in solution.\nWe would like to cast Eq. (2) as the ratio of canonical averages which can be computed using the canonical-ensemble\nMonte Carlo method [7]. To achieve this, we combine the\nunbound and bound systems by extending phase space to include a discrete index \u03bb \u2208 {0, 1} and consider a system in\nthis extended space with energy E\u03bb\u2217 (\u0393) for which the canonical average is defined by\nP R\nd\u0393 exp[\u2212\u03b2E\u03bb\u2217 (\u0393)]X\u03bb (\u0393)\nhXi = \u03bbP R\n.\n\u2217\n\u03bb d\u0393 exp[\u2212\u03b2E\u03bb (\u0393)]\nWe take E\u03bb\u2217 (\u0393) to be infinite for \u0393 \u2208\n/ \u03a3\u03bb and finite otherwise.\nNow Eq. (2) can be rewritten as\n\u0001\n1 \u03b4\u03bb0 exp \u2212\u03b2[E0 (\u0393) \u2212 E0\u2217 (\u0393)]\n\u0001 ,\n(3)\nKd =\nV0 \u03b4\u03bb1 exp \u2212\u03b2[E1 (\u0393) \u2212 E1\u2217 (\u0393)]\n\nwhere \u03b4\u03bb\u03bc is the Kronecker delta. If E\u03bb\u2217 (\u0393) \u2248 E\u03bb (\u0393), the\nterms being averaged are O(1). Because the definition of Kd\nis independent of V0 , we can pick V0 \u223c 1/Kd so that approximately the same number of samples contribute to each of the\ncanonical averages. We show later, Eq. 7, that this choice\nminimizes the error in the estimate of Kd .\nWe can evaluate E\u03bb\u2217 (\u0393) with short energy cutoffs allowing\nit to be computed more quickly than E\u03bb (\u0393) and the terms contributing to the averages in Eq. (3) can be accumulated every\nhundred steps, for example. Since there is typically a high\ncorrelation between successive steps in a Monte Carlo simulation, this method allows the averages to be computed to\na given degree of accuracy in less time than if we had used\nE\u03bb\u2217 (\u0393) = E\u03bb (\u0393).\nThe extension of phase space has been used in other free energy calculations, to combine, for example, systems at several\ndifferent temperatures [8] or to treat the \"reaction coordinate\"\ncontrolling the transition between two chemical species as a\ndynamic variable [9, 10]. In our case, the use of the wormhole Monte Carlo (described in the next section) allows us to\ninclude just the two systems of interest without the need to\ncompute the properties of (possibly unphysical) intermediate\nsystems.\nWormhole Monte Carlo\n\nWe can compute the canonical averages in Eq. (3) using the\nMonte Carlo method [7] to make steps from [\u0393, \u03bb] to [\u0393\u2032 , \u03bb\u2032 ]\n\n\f3\n(a)\nE*0(\u0393)\n\nwhose equilibrium distribution is proportional to g(\u03a5). The\ncanonical average of a quantity X(\u03a5) is defined by\nR\nd\u03a5 g(\u03a5)X(\u03a5)\nR\nhXi =\n.\nd\u03a5 g(\u03a5)\n\nE*1(\u0393)\n\nIn\nwe make the identification \u03a5 = [\u0393, \u03bb],\nR our application,\nP R\nd\u03a5 = \u03bb d\u0393, and g(\u03a5) = exp[\u2212\u03b2E\u03bb (\u0393)].\nLet us define a set of \"portal functions,\" w, w\u2032 , w\u2032\u2032 , . . . , on\n\u03a5, with properties\n\n\u0393\n\n\u0393\n\n(b)\n\u0393; \u03bb = 0\n\n\u0393; \u03bb = 1\n\nFIG. 1: (a) Schematic representation of E0\u2217 (\u0393) (shallow and wide)\nand E1\u2217 (\u0393) (deep and narrow). Conventional Monte Carlo moves\nbetween \u03bb = 0 and 1 (shown as dashed lines) are nearly always\nrejected because they lead to large increases in energy. (b) Schematic\nrepresentation of typical portals for the wormhole moves for the case\nillustrated in (a), The large ratio of the volume of the unbound (\u03bb =\n0) portal compared to the bound (\u03bb = 1) portals compensates for the\nhigher energy of the unbound configurations. This results in accepted\nwormhole moves (dashed lines) between all the portals.\n\nwith probability\n\u0002\n\u0001\u0003\nmin 1, exp \u2212\u03b2[E\u03bb\u2217\u2032 (\u0393\u2032 ) \u2212 E\u03bb\u2217 (\u0393)] .\n\nHowever, the estimate of the ratio in Eq. (3) will be very poor,\nbecause transitions between \u03bb = 0 and 1 will be extremely\nrare-typically, E0\u2217 is shallow and wide, while E1\u2217 is deep and\nnarrow; see Fig. 1(a). One possible way of remedying this is\nto treat \u03bb as a continuous variable [9, 10], providing a suitably\ninterpolated definition of E\u03bb (\u0393), and allowing Monte Carlo\nsteps with small changes in \u03bb. In practice, this approach only\n\"works\" if the two endpoints are sufficiently similar, thus limiting this method to the comparison of chemically close molecules.\nHere we propose an alternative way of carrying out a Monte\nCarlo simulation of the E\u03bb\u2217 (\u0393) system. We restrict the standard moves to changes in \u0393 only, and allow changes in \u03bb\nvia \"wormhole moves\" [11] which connect otherwise disconnected regions of configuration space. This obviates the need\nto treat (possibly unphysical) intermediate values of \u03bb, permitting us to compute the free energy differences needed to\ndetermine the absolute binding affinity.\nAssume we have some system defined on a phase space \u03a5\n\n0 \u2264 w(\u03a5) \u2264 1/v < \u221e,\nZ\n\nd\u03a5 w(\u03a5) = 1,\n\nwhere v is a representative phase-space volume of the portal\nfunction. A wormhole move consists of the following steps:\nselect a pair of portals (w, w\u2032 ) with probability pww\u2032 ; reject\nthe move with probability 1 \u2212 vw(\u03a5), where \u03a5 is the current\nstate; otherwise, with probability vw(\u03a5), pick a configuration\n\u03a5\u2032 with probability w\u2032 (\u03a5\u2032 ); and accept the move to \u03a5\u2032 with\nprobability Pww\u2032 (\u03a5, \u03a5\u2032 ). If the move is rejected, \u03a5 is retained\nas the new state. We determine Pww\u2032 (\u03a5, \u03a5\u2032 ) by demanding\nthat the rate of making transitions from \u03a5 to \u03a5\u2032 via portals\n(w, w\u2032 ) is balanced by the reverse rate from \u03a5\u2032 to \u03a5 via portals\n(w\u2032 , w), i.e.,\nRww\u2032 (\u03a5, \u03a5\u2032 ) = Rw\u2032 w (\u03a5\u2032 , \u03a5)\n(the condition of detailed balance), where the rates are given\nby\nRww\u2032 (\u03a5, \u03a5\u2032 ) = pww\u2032 R\n\ng(\u03a5)\n\u00d7\nd\u03a5 g(\u03a5)\n\nvw(\u03a5)w\u2032 (\u03a5\u2032 )Pww\u2032 (\u03a5, \u03a5\u2032 ).\n\nA possible solution for the acceptance probability is\n\u0012\n\u0013\npw\u2032 w g(\u03a5\u2032 ) v \u2032\nPww\u2032 (\u03a5, \u03a5\u2032 ) = min 1,\n,\npww\u2032 g(\u03a5) v\nwhere we have made use of the identity \u03b1 min(1, \u03b1\u22121 ) =\nmin(1, \u03b1), which is valid for \u03b1 > 0.\nIn order to apply this move, let us use a specific rather simple form for the portal functions, w(\u03a5), namely\n\u001a\n1/v, for \u03a5 \u2208 w,\nw(\u03a5) =\n0,\notherwise,\nwhere we now denote a portal by w which defines an arbitrary subset of \u03a5 space of volume v. In principle, there is\nno restriction on the choice of the portals; however, practical\nconsiderations, discussed below, dictate how they are chosen.\nFurthermore, for simplicity, we will assume that the wormhole\nprobabilities are all equal, pww\u2032 = const.\nLet us now describe the wormhole move in [\u0393, \u03bb] space.\nStarting with a configuration [\u0393, \u03bb], first pick a random portal\n\n\f4\nw. If [\u0393, \u03bb] \u2208\n/ w, then reject the move. Otherwise, pick a\nrandom configuration [\u0393\u2032 , \u03bb\u2032 ] uniformly in a randomly chosen\nportal w\u2032 , and accept the move to [\u0393\u2032 , \u03bb\u2032 ] with probability\n\u0013\n\u0012\nexp[\u2212\u03b2E\u03bb\u2217\u2032 (\u0393\u2032 )] v \u2032\n.\n(4)\nmin 1,\nexp[\u2212\u03b2E\u03bb\u2217 (\u0393)] v\nThis differs from the standard Boltzmann acceptance probabilty by the ratio of volumes, v \u2032 /v, which can be large enough\nto compensate for the difference in the mean energies in the\nportals. Indeed, if the mean energy of configurations in w\nscales as \u03b2 \u22121 ln v+const., the acceptance probability, Eq. (4),\nis O(1), thereby allowing moves between shallow wide wells\nand deep narrow ones; see Fig. 1(b). In practice, each portal will occupy one of the energy wells of either E0\u2217 (\u0393) or\nE1\u2217 (\u0393). This implies that the \u03bb = 0 portals will permit unrestricted translation and rotation of the ligand and the protein\nsubject to the V0 constraint, and the \u03bb = 1 portals will allow\nunrestricted motion of one of the molecules.\nThe wormhole move embodies two concepts which have\nbeen used separately in other works: stretching or shrinking \u0393 space when making the move compensates for possibly\nlarge energy differences between wells [12, 13]; and jumping between disconnected regions of phase space enables the\nMarkov chain to explore regions of phase space separated by\nlarge energy barriers [14, 15]. In the following sections, we\nwill show how these elements may be combined to permit the\ncomputation of protein binding affinities with realistic force\nfields.\n\nseparately for \u03bb = 0 and 1. For each \u03bb, we obtain a canonical set of configurations {\u039e} (suppressing the \u03bb subscripts\nfor brevity), to which we fit n-dimensional ellipsoids, as follows. First we try to fit a single ellipsoid to {\u039e}. The center\nof the ellipsoid is given by the mean configuration h\u039ei. For\neach configuration in {\u039e}, we determine the deviation from\nthe mean, \u03b4\u039e = \u039e \u2212 h\u039ei, and compute a covariance matrix\nfor the configurations which can be diagonalized as\nh\u03b4\u039e \u03b4\u039ei = P\u039bPT ,\nwhere P is the matrix of (column) eigenvectors and \u039b is the\ndiagonal matrix of eigenvalues. Because of the properties of\nthe covariance, P is real and orthogonal, P\u22121 = PT , and the\neigenvalues are real and non-negative. If there are no hidden\nconstraints on the motion, we additionally can assume that\nthe eigenvalues are strictly positive. We find it convenient to\ndefine\nB = P\u039b1/2 ,\n\nB\u22121 = \u039b\u22121/2 PT ,\n\nso that we can write\nh\u03b4\u039e \u03b4\u039ei = BBT .\nWe \u221atake the semi-axes of the ellipsoid\nto be the columns\n\u221a\nof nB. The multiplier here, n, is chosen to ensure\nthat O(1) of the configurations in {\u039e} lie within the ellipsoid. This choice is motivated by considering a symmetric\nn-dimensional Gaussian\nf (r) =\n\nFinding the portals\n\nexp(\u2212 12 r2 )\n,\n(2\u03c0)n/2\n\nfor which we have\nIn order for the wormhole method to be practical, we need a\nreliable way of choosing the portals. We describe this process\nfirst in the general case. Let us write \u0393 = [\u0393L , \u0393P ], where\n\u0393M = [XM , \u039eM ] represents the state of molecule M, XM represents its position and orientation, and \u039eM represents its conformation.\nWe assume that \u039eM is expressed in such a way that any constraints on the positions of the atoms in M (e.g., bond lengths\nand bond angles) is implicitly accounted for, so that the dimensionality of \u039eM reflects the number of degrees of conformational freedom, nM , for this molecule.\nBecause of the translational and rotational symmetry of the\nsystem, certain components of \u0393 are ignorable. We can therefore write E\u03bb\u2217 (\u0393) = E\u03bb\u2217 (\u039e\u03bb ), with\n\u039e0 = [\u039eL , \u039eP ],\n\u039e1 = [Y, \u039eL , \u039eP ],\nwhere Y = XL \u2212 XP denotes the position and orientation of\nthe ligand relative to the protein. The dimensionality of \u039e\u03bb is\nn\u03bb with n0 = nL + nP and n1 = n0 + 6.\nThe strategy for determining the portals is to carry out conventional canonical Monte Carlo simulations with E\u03bb\u2217 (\u039e\u03bb )\n\n2\n\nhr i =\n\nZ\n\nr2 f (r) dn r = n.\n\nEllipsoids are a natural choice to use to fit the set of configurations for the following reasons: (1) The iso-density contours\nof the distribution in a harmonic well are ellipsoids. (2) It is\neasy to sample points randomly from an ellipsoid. (3) Conversely, it is easy to test that a point lies inside an ellipsoid.\n(4) The volume of an n-dimensional ellipsoid is given by\nn\n\nvn =\n\n\u03c0 n/2 Y\nai ,\n(n/2)! i=1\n\nwhere ai is the length of ith semi-axis. Note well the degenerate case of this result, v0 = 1, which is used if the protein and\nligand are both rigid (n0 = 0). The sampling and testing of\npoints, (2) and (3), can either be accomplished by transforming with the matrix B. Alternatively, we can use the simpler\nCholesky decomposition of the covariance matrix\nh\u03b4\u039e \u03b4\u039ei = CCT ,\nwhere C is a lower triangular matrix. Both C and C\u22121 may be\ncomputed by direct (non-iterative) methods [16].\n\n\f5\nHaving defined an ellipsoid in this way, we test its suitability as a portal by demanding that O(1) of the configurations\nsampled uniformly from it have energies close to its mean energy hE \u2217 (\u039e)i. If this test fails, we split {\u039e} into two sets\naccording to the sign of \u03b4\u039e projected along the largest semiaxis of the ellipsoid and construct new trial portals from each\nof these sets.\nThe ellipsoids that result from this process constitute our\nportals. When computing the volumes of the portals for use\nin Eq. (4), we need to account for the freedom to place 2 \u2212 \u03bb\nmolecules at arbitrary positions and orientations in the volume\nV0 . In practice, this means we multiply the volume of the\n\u03bb = 0 portals by \u03c3V0 where V0 is the translational volume\nand \u03c3 is the orientational volume (given below).\nIn order to complete the specification of the portals, we\nneed to describe how h\u039ei and \u03b4\u039e are formed, since, as a\nconsequence of working in the subspace where the molecular constraints are implicitly satisfied, \u039e is not simply a point\nin Rn . We wish to represent each ellipsoid on a locally Cartesian space Rn which lets us use familiar formulas for defining\nthe ellipsoid. We also demand that the mapping to Rn have\nconstant Jacobian in order to maintain detailed balance when\nsampling from the ellipsoids.\nWe illustrate this by considering the case of the protein and\nthe ligand being made up of nM + 1 rigid fragments simply\nconnected by nM bonds each of which allow rotation only\n(i.e., the bond lengths and bond angles are fixed). The relative\nposition and orientation of L with respect to P, Y , can be defined in terms of one of the rigid fragments of each molecule.\nFinally, we use unit quaternions [17] to represent orientation.\nSince the quaternions q and \u2212q represent the same rotation,\norientations are given by an axis [18] of the sphere S 3 .\nThe coordinates making up \u039e are then: (a) the position\ncomponent of Y , a point in R3 ; (b) the orientation component\nof Y , an axis of the sphere S 3 ; and (c) the dihedral angles\nof the rotatable bonds of the ligand and protein, points on the\ncircle S 1 . The definition of h\u039ei and \u03b4\u039e is straightforward for\n(a), since we use the normal arithmetic definitions. For (c),\nwe define the mean for each angle [18] by the direction of the\nmean of the points on S 1 embedded in R2 . We form the deviation in this case by subtraction modulo 2\u03c0 so that the result\nlies in [\u2212\u03c0, \u03c0].\nTo find the mean of the orientations (b), we similarly embed S 3 in R4 . We define the mean orientation [18] as the\naxis in R4 about which the moment of inertia of the sample\naxes is minimum. To find the deviation of the orientation,\nwe compute the differential rotation \u03b4q = qhqi\u2217 which takes\nthe mean orientation to the sample orientation and we project\nthis into a \"turn\" vector u in the unit ball in R3 so as to preserve the metric. This is achieved by a generalization of the\nLambert azimuthal equal-area projection as described in the\nAppendix. In this representation, the volume of orientational\nspace (which contributes to the multiplier for the unbound volumes) is \u03c3 = 43 \u03c0.\nOccasionally, the point sampled from w\u2032 corresponds to one\nof the coordinates \"wrapping around,\" i.e., the change in the\n\ndihedral lies outside [\u2212\u03c0, \u03c0] or the turn u lies outside the unit\nball. In order to preserve detailed balance, we reject the resulting move.\nThere are four ways in which we can improve the quality of the portals obtained by this method so as to make successful wormhole moves more likely. (1) The Monte Carlo\nruns used to obtain the samples from which the portals are\ndefined should begin with an \"annealing\" phase where the\ntemperature is started at some high value and slowly reduced\nto T at which point we start gathering samples. This allows the Monte Carlo sampling to explore phase space more\nthoroughly. (2) Other methods of finding conformational energy minima [19] can be applied to provide additional starting\npoints for the Monte Carlo runs. (3) The samples can be supplemented with those obtained by applying those symmetry\noperations which leave the molecules invariant. In the case\nof non-chiral ligands, we would also apply a reflection of the\nligand in the unbound case since this will leave the energy unchanged. In this way, the portal moves allow all the symmetric\nvariants of the molecules to be explored so that symmetry is\nincluded in a systematic way in the computation of the binding affinity. (4) When forming h\u03b4\u039e0 \u03b4\u039e0 i, we should set the\nintermolecular cross terms to zero because the conformations\nof the two molecules are independent when \u03bb = 0.\nThis method of finding portals depends on the samples\n\"spanning\" a volume of phase space. This requires that the\ndimensionality of phase space be sufficiently small and this,\nin turn, implies the use of an implicit solvation model. In addition the portals can be more reliably found if the \"hard\" degrees of freedom in the molecules are replaced by constraints\n(e.g., by fixing the bond lengths and bond angles as described\nabove).\nThe method of successively subdividing the samples may\nlead to suboptimal portals in some cases, for example, by dividing a contiguous set of samples. We have recently experimented with fitting a mixture of Gaussians to the samples\nusing the expectation-maximization (EM) algorithm [20, 21].\nSince this optimizes the fit to all the samples, it usually results\nin fewer, better, portals. In this case, we are naturally lead to\nuse Gaussians for the portal functions rather than the more restrictive ellipsoids. By enforcing the symmetries of the ligand\nwhen making the fits, ligand symmetry can also be included\nin a rigorous way. These improvements will be described in a\nsubsequent publication.\n\nThe free energy calculation\n\nPrior to the calculation of the free energy, we estimate a\nsuitable value of V0 , which enters into the definition of the\nvolumes of the \u03bb = 0 portals, by assigning an estimated statistical weight of v exp(\u2212\u03b2hE \u2217 i) to each portal and estimating\nP\nv exp(\u2212\u03b2hE \u2217 i)\n,\nV0 \u223c P \u03bb=1\n\u2217\n\u03bb=0 (v/V0 ) exp(\u2212\u03b2hE i)\n\n\f6\nNH 2\n\n+\n\nH2 N\n\nNH 2\n\nFIG. 2: The structure of p-amino-benzamidine.\n\nwhere the sums in numerator (denominator) are over the\nbound (unbound) portals and v/V0 for the unbound portals\nis the volume of the ellipsoid (multiplied by \u03c3) and thus does\nnot depend on V0 . If this estimate for V0 results in the sampling being too heavily weighted toward \u03bb = 0 or 1, V0 may\nbe changed and the current values of the sample sums for Kd\ncan be adjusted to account for this change.\nThe choice of the starting configuration for the free energy\ncalculation may introduce some bias in the results. We can\nremove much of this bias by using the portals to select the\nstarting configuration: select a portal w with probability proportional to its estimated statistical weight; select a configuration, [\u0393, \u03bb], uniformly from this portal; and accept the configuration with probability\n\u0001\u0003\n\u0002\nmin 1, exp \u2212\u03b2[E\u03bb\u2217 (\u0393) \u2212 hE \u2217 i] ,\n\nwhere hE \u2217 i is the canonical average energy over the portal.\nThis procedure is repeated until a configuration is accepted.\nThe bias can be further reduced by running the Monte Carlo\ncalculation for several correlation times, defined by Eq. (6),\nprior to gathering the data for Eq. (3).\nDuring the course of the free energy calculation, normal\nand wormhole Monte Carlo moves are mixed. With the normal moves, we only attempt to change \u0393 and, for this reason,\nit is possible to have the Monte Carlo step size depend on\n\u03bb (with, usually, the step size being larger with \u03bb = 0). In\npractice, most (\u223c 90%) of the attempted moves are wormhole moves because frequently we have [\u0393, \u03bb] \u2208\n/ w and the\nattempted wormhole move is inexpensively rejected.\nThe method is robust in the sense that it does not depend\non the particular form of the energy function. In addition, a\nfailure to make transitions between \u03bb = 0 and 1 can be detected. This may be because the test [\u0393, \u03bb] \u2208 w never succeeds (i.e., the configuration has been trapped in a new well),\nor because the acceptance criterion is never met, which indicates that there is a deep well within the well of one of the\nportals. In both cases, the problem can be corrected by adding\na new portal based on recent configurations.\n\nExample\n\nThe efficacy of the wormhole method depends on how frequently a configuration lies within one of the portals and how\noften the jump to the new portal is accepted. In order to assess\nthese questions, we have computed the binding affinity of pamino-benzamidine, whose structure is shown in Fig. 2, to the\ndigestive enzyme trypsin, at T = 290 K. We emphasize that\n\nthe primary goal of this exercise is to assess how well wormhole moves allow the free energy calculation to converge. For\nthis purpose, we are not so interested in comparing the resulting computed binding affinity to the experimental data since\nthis will depend in large measure on the accuracy of the force\nfield and of the protein structure. Nevertheless, since the convergence will depend on the complexity of the energy \"landscape,\" we use this example to epitomize the binding of a\nsmall ligand to a protein.\nThe coordinates of the atoms in trypsin are taken from a\ntrypsin-benzamidine complex, 1BTY [22]. At physiological pH, the amidine group is protonated (net charge of +1)\nand, in the complex, it is attracted to a negatively charged\naspartate residue in trypsin inhibiting its enzymatic action.\nWe employ the Amber 7 force field [23, 24, 25] and the\nGB/SA solvation model [26, 27, 28]. The protein is taken\nto be rigid, nP = 0, and two bonds of the ligand are allowed to rotate, namely, those connecting the amidine and\nthe amino groups to the benzene ring, nL = 2. The published force field [23] does not provide a satisfactory torsion for the bond between the benzene ring and the amidine\ngroup and this term was determined using Gaussian 98 [29] as\n[\u221214.2 cos(2\u03c6) + 3.3 cos(4\u03c6) + 0.5 cos(6\u03c6)] kJ/mol, where\n\u03c6 is the dihedral angle.\nFive unbound and five bound canonical simulations of 1000\nsteps each were carried out to find the portals. The resulting\nconfigurations were supplemented by those obtained by applying the symmetry operations which leave the ligand invariant. This gave 16 unbound and 8 bound portals. The configurations of the bound portals are all the same \"pose\" of the\nligand on the protein and correspond to the symmetries of pamino-benzamidine given by rotating the amino, benzene, and\namidine groups by 180\u25e6 . The unbound ligand also exhibits 8\nsymmetries given by rotating the amino and amidine groups\nby 180\u25e6 relative to the central benzene ring and by including\nthe mirror images. However since the bond parameters allow\npartially free rotation of the amidine group, each symmetric\nset of configurations is represented by two portals.\nWe estimated a suitable value for V0 of 0.39 \u00d7 10\u221218 m3\nbased on the volumes and the mean energies of the computed portals. During the binding affinity calculation, wormhole moves were attempted on 90% of the steps (the other\n10% were standard Monte Carlo moves). Of these attempted\nwormhole moves, 97% failed (inexpensively) because the\nconfiguration was not in the chosen w. Of the remaining 3%,\nabout 60% lead to a successful move, of which about 40% involved switching from \u03bb = 0 to 1 and vice versa. The major\ncomputational cost in the free energy calculation is the evaluation of the bound energies. In this example, the wormhole\nmoves required less than 3 bound energy evaluations, on average, to effect the transition from a bound configuration to\nan unbound one and back. This enables an accurate estimate\nto be made of the ratio of the averages in Eq. (3) which after\n5 \u00d7 106 steps yields pKd = 7.99 \u00b1 0.01. The error estimate is\nderived in the next section and represents a 2% relative error\nin Kd .\n\n\f7\n8.1\n0.1\n\nCt\n\npKd(s)\n\nc\n8\n\nb\n\n0.01\n\nd\na\n\ne\n\n0.001\n7.9\n0\n\n1\n\n2\n\n3\ns\n\n4\n\u00d7 10\n\n6\n\n5\n\n0\n\n0.5\n\n1\n\n1.5\nt\n\nFIG. 3: Cumulative estimates pKd (s) obtained by sampling every\n100th step from the first s steps of 5 independent\nMonte Carlo runs.\n\u221a\nThe dashed lines shows convergence as 1/ s to the mean value of\n7.99.\n\nThis example illustrates that the method is effective at allowing sufficient transitions between the bound and unbound\nstates to enable the binding affinity of protein-ligand systems\nto be accurately computed. We note that our computed binding affinity differs from the experimental results of 5.1 to 5.2\n[30, 31]. This discrepancy may be accounted for by modest,\n\u223c 20%, errors in the force field.\n\n2\n\u00d7 10\n\n3\n\n2.5\n\nFIG. 4: The \u03bb-correlation function Ct . The curves show Ct for\n1\nV0 /(0.39 \u00d7 10\u221218 m3 ) = (a) 10\n, (b) 31 , (c) 1, (d) 3, and (e) 10. The\n). The\nratio q/p varies correspondingly (from approximately 18 to 100\n8\ncorrelation times are (a) 329, (b) 346, (c) 352, (d) 382, and (e) 415.\nIn determining the correlation times, we limit the sum in Eq. (6) to\n0 < t \u2264 2500 in order to avoid including the small but noisy terms\nfor large t.\n\nverges depends, naturally, on the \"correlation time\" of the system. If wormhole moves rarely cause the system to switch between bound and unbound states, the correlation time is large\nand the convergence will be slow.\nIn order to make these ideas quantitative, we define the \u03bbcorrelation function,\n\nError analysis\n\nIn order to assess the errors in the computation of pKd in\nmore detail, we carried out 10 independent runs similar to the\none described in previous section. Each of these used the same\nportals and the same value of V0 . We computed cumulative\nestimates for pKd based on the first s steps of the Markov\nchains. When forming the averages in Eq. (3) we sample every\n100th step. (As we shall see, there is a high degree of correlation within 100 steps; thus there would be little improvement\nin the estimate of pKd by sampling more frequently.) The results for 5 of these runs are\n\u221a shown in Fig. 3. The convergence\ntoward the mean is as 1/ s; after 5 \u00d7 106 steps, the error in\npKd has been reduced to about \u00b10.01.\nFor the purposes of further analysis, let us assume that the\ncomputation is carried out with E\u03bb\u2217 (\u0393) = E\u03bb (\u0393) so that all\nsamples have the same statistical weight. The probability that\nthe system is in the bound (resp. unbound) state is p = h\u03b4\u03bb1 i\n(resp. q = 1 \u2212 p = h\u03b4\u03bb0 i) and Eq. (3) becomes\nKd =\n\n1 q\n.\nV0 p\n\n(5)\n\nThe determination of Kd is then equivalent to estimating q/p\nby taking the ratio of the number of unbound and bound steps\nin the Monte Carlo simulation. How well this estimate con-\n\nCt = h(\u03bbs \u2212 p)(\u03bbs+t \u2212 p)is ,\nwhere \u03bbs is the value of \u03bb at simulation step s and h. . .is denotes an average over steps. Figure 4 shows Ct for several\ndifferent values of V0 . (From Eq. (5), we have q/p \u221d V0 .)\nIn a Markov chain of length s, the expected number of bound\nstates is ps, while, for s \u2192 \u221e, the variance in the number of\nbound states is 2Ds, where\nD=\n\nX\n1\n1\nC0 +\nCt = C0 \u03c4.\n2\n2\nt>0\n\n(6)\n\nThis provides us with the definition of the correlation time, \u03c4 .\nFrom Fig. 4, we see that Ct decays approximately exponentially so that the sum converges.\nWe can compare the Monte Carlo simulation to a simpler\nMarkov process of independent trials, e.g., tossing a coin\nwhere the probability of heads is p. In this case, we have\nCt>0 = 0 and D = 12 C0 = 21 pq. In the limit s \u2192 \u221e,\nthe relative errors in estimating p for the Monte Carlo simulation will be the same as that for s/\u03c4 tosses of the coin. We\ncan illustrate this by making 5 independent simulations of a\ncoin tossing experiment to match the data in Fig. 3, for which\np = 0.443 and \u03c4 = 352. The results are given in Fig. 5, where\nwe plot hn /tn against n where hn (resp. tn ) is the number of\n\n\f8\nand bound systems to be treated as a single canonical system\nand Kd to be expressed as the ratio of canonical averages,\nEq. (3); (2) the wormhole move which allows transitions between the bound and unbound systems; and (3) the use of an\nimplicit solvation model which reduces the number of degrees\nof freedom and so allows portals to be identified.\n\n1\n\nhn/tn\n\n0.9\n\n0.8\n\n0.7\n\n0\n\n2\n\n4\n\n6\n\n8\n\n10\n\nn\n\n12\n14\n3\n\u00d7 10\n\nFIG. 5: Estimation of the bias of a coin with p = 0.443. Five\nindependent runs are shown. In each run, the coin was tossed 5 \u00d7\n106 /\u03c4 = 14200 times, where \u03c4 is the correlation time for Fig. 4(c),\nand the cumulative value of hn /tn is recorded. The expected value,\np/q, is shown as a dashed line. The axes have been adjusted to allow\nthe figure to be directly compared with Fig. 3.\n\nheads (resp. tails) after n throws. As expected, Figs. 3 and 5\nboth exhibit the same convergence behavior.\nSince the distribution of outcomes hn in the coin tossing\nexperiment is the binomial distribution, the mean and variance\nfor ln = ln(hn /tn ) can be calculated, yielding\n\u0012\n\u0013\n\u0012 \u0013\n1 p q\np\n+\n+ O(n\u22122 ),\n\u2212\nhln i = ln\nq\n2n q\np\nh(ln \u2212 hln i)2 i =\n\n1\n+ O(n\u22122 ).\nnpq\n\nThe standard error in the estimate of pKd from a Monte Carlo\nrun with s steps is found by substituting n = s/\u03c4 and scaling by ln 10 (since pKd is defined in terms of the common\nlogarithm) to give\nr\n\u03c4\n1\n\u2206pKd \u2248\n.\n(7)\nln 10 spq\nIn the case of the simulations shown in Fig. 3, we find\n\u2206pKd \u2248 0.01 consistent with the data in the figure. From\nFig. 4, we see that \u03c4 is weakly dependent on p. Thus for a\ngiven s, we minimize the error by choosing p = q = 12 . Alternatively, we may wish to minimize the error for a given\namount of computational effort. If bound steps are f times\nmore expensive to carry out\u221athan unbound steps, \u221a\nthe error is\nminimized by taking q/p = f , i.e., p = 1/(1 + f ).\n\nA method similar to ours is \"simulated mutational equilibration,\" [32] which employs an extended phase space, uses\nan implicit solvation model, and allows jumps between different systems. However, in place of the wormhole move, this\nwork employed a more restrictive \"jumping between wells\"\nmove, which limited its applicability to computing the difference in the binding affinities for two enantiomers. In contrast,\nour wormhole method can be used to compute directly the\nbinding affinity of a ligand with several rotatable bonds to a\nprotein target. This allows us to study a wide range of interesting drug-like ligands.\nIn the special case of binding rigid molecules (for which\nwe have E0\u2217 (\u0393) = 0), wormhole Monte Carlo is isomorphic\nto a grand canonical Monte Carlo simulation [33]. Consider a\ngrand canonical system with a single protein molecule and\nwith ligand molecules at a fixed chemical potential \u03bc; we\nmake the additional restriction that the ligand-ligand interaction energy is infinite, so that the system can only accommodate 0 or 1 ligand molecule. For the wormhole simulation,\nwe specify the bound portal to include the full simulation volume with arbitrary orientation; the unbound port is degenerate\nand corresponds merely to specifying \u03bb = 0. The wormhole\nmoves from \u03bb = 0 to 1 and vice versa correspond to particle\ninsertion and deletion in the grand canonical simulation; and\nwe can verify the acceptance probabilities are the same.\nThe application described here can be extended by allowing a greater degree of flexibility for the protein and the ligand. This permits the treatment of side-chain rotation and\nligand-induced loop movement on the part of the protein and\nthe treatment of flexible rings for the ligand. Many standard Monte Carlo techniques can be used with this method,\nif appropriate-preferential sampling, early rejection, force\nbias, etc. Wormhole moves could also be used to treat other\ndiscrete, or nearly discrete, transitions. Examples are: the\ntreatment of molecules, such as cyclohexane, which can assume distinct conformations; discrete sets of side chain rotations in the protein; protonation and tautomerization states for\neither molecule. In each of these cases, the acceptance probability for the transitions should account for the free energy\ndifference between the discrete states.\n\nDiscussion\n\nAcknowledgment\n\nThe important aspects of this method that enable us to compute the binding affinity of a ligand to a protein are: (1) formulation in the extended [\u0393, \u03bb] space, which allows the unbound\n\nThis work was supported, in part, by the U.S. Army Medical Research and Materiel Command under Contract No.\nDAMD17-03-C-0082.\n\n\f9\nAppendix: Generalized Lambert projection\n\nThe Lambert azimuthal equal-area projection projects a\npoint on S 2 to a point on a disk in R2 . Here, we will generalize this to arbitrary dimensions, i.e., we will find a projection from S n to a ball in Rn . (Thus the circle S 1 is projected\ninto a line segment; the surface of a sphere S 2 is project into\na disk; S 3 is projected into a sphere; etc.) The projection is\nazimuthal, so that directions from the pole are preserved in the\nprojected space.\nThe sequence S n can be defined recursively by\n\n(The other hemisphere, corresponding to 12 \u03c0 < \u03b8 \u2264 \u03c0, maps\nonto the shell 1 < u \u2264 21/3 .) We call this u representation of\norientations \"turn space.\"\n\n\u2217\n\u2020\n\n[1]\n[2]\n\nS 0 = [\u00b11],\nS n = [cos \u03b8, sin \u03b8 S n\u22121 ],\nwhere \u03b8 is the colatitude and 0 \u2264 \u03b8 \u2264 \u03c0. The area of S n lying\nbetween \u03b8 and \u03b8 + d\u03b8 is therefore\n\n[3]\n\n[4]\n\ndA = an\u22121 sinn\u22121 \u03b8 d\u03b8,\nwhere an is the area of S n . We project that portion of S n\nwith colatitude in [0, \u03b8] to a ball in Rn of radius t. Equating\nthe measures (area on S n and volume in Rn ), we obtain\nZ \u03b8\nn\nvn t = an\u22121\nsinn\u22121 \u03b8\u2032 d\u03b8\u2032\n0\n\n[5]\n\n[6]\n\n[7]\n\nwhere vn is the volume of a unit ball in Rn . Using the relation,\nd(vn tn )\ndt\n\nan\u22121 =\n\n[8]\n\n= nvn ,\nt=1\n\nwe obtain\n\n[9]\n\n\u0012 Z\nt= n\n\n0\n\n\u03b8\n\nsinn\u22121 \u03b8\u2032 d\u03b8\u2032\n\n\u00131/n\n\n.\n\n(8)\n[10]\n\nThe general \"equal-area\" projection is given by the mapping\n[cos \u03b8, sin \u03b8 S n\u22121 ] \u2192 t,\n\n[11]\n\nwhere t \u2208 Rn , t\u0302 is given by the point on S n\u22121 , and t is given\nby Eq. (8). Some special cases of Eq. (8) are\n\uf8f1\n\u03b8,\nfor n = 1,\n\uf8f4\n\uf8f4\n\uf8f4\n\uf8f2 2 sin 1 \u03b8,\nfor n = 2,\n2\n\u00031/3\nt = \u00023\n(2\u03b8\n\u2212\nsin\n2\u03b8)\n,\nfor\nn = 3,\n\uf8f4\n4\n\uf8f4\n\uf8f4\n\u00021\n\u00031/4\n\uf8f3\n1\n2 1\n, for n = 4.\n2 sin 2 \u03b8 3 (1 + 2 cos 2 \u03b8)\n\n[12]\n\nThe case n = 1 corresponds to unwrapping a circle onto a\nline; and n = 2 gives the Lambert azimuthal equal-area projection. We are interested in the case n = 3 as a way of\nmapping orientations from unit quaternion space to R3 . A\nquaternion q = [cos \u03b8, sin \u03b8 \u00fb] represents a rotation of \u03c8 = 2\u03b8\nabout \u00fb. Noting that q and \u2212q represent the same rotation, we\nmay make the restriction 0 \u2264 \u03b8 \u2264 21 \u03c0 . We choose, therefore, to map this hemisphere of S 3 onto u in the unit ball, by\n\u00011/3\nu to give\nmaking the substitutions \u03b8 = 21 \u03c8 and t = 43 \u03c0\n\u00131/3\n\u0012\n\u03c8 \u2212 sin \u03c8\n.\nu=\n\u03c0\n\n[13]\n\n[14]\n\n[15]\n\n[16]\n\nElectronic address: ckarney@sarnoff.com\nCurrent address: CRPP, Ecole Polytechnique F\u00e9d\u00e9rale de Lausanne, CH-1015 Lausanne, Switzerland.\nM. Mezei and D. L. Beveridge. Free energy simulations. Ann.\nN.Y. Acad. Sci., 1986, 482, 1\u201323.\nP. A. Kollman. Free energy calculations: Applications to chemical and biochemical phenomena. Chem. Rev., 1993, 93, 2395\u2013\n2417.\nL. D. Landau and E. M. Lifshitz. Statistical Physics, volume 5\nof Course of Theoretical Physics. Pergamon Press, 2nd edition,\n1969.\nC. H. Bennett. Efficient estimation of free energy differences\nfrom Monte Carlo data. J. Comp. Phys., 1976, 22, 245\u2013268.\nH. Luo and K. Sharp. On the calculation of absolute macromolecular binding free energies. Proc. Nat. Acad. Sci., 2002,\n99, 10399\u201310404.\nM. K. Gilson, J. A. Given, B. L. Bush, and J. A. McCammon.\nThe statistical-thermodynamic basis for computation of binding\naffinities: A critical review. Biophys. J., 1997, 72, 1047\u20131069.\nN. Metropolis, A. W. Rosenbluth, M. N. Rosenbluth, A. H.\nTeller, and E. Teller. Equation of state calculations by fast computing machines. J. Chem. Phys., 1953, 21, 1087\u20131092.\nA. P. Lyubartsev, A. A. Martsinovski, S. V. Shevkunov, and\nP. N. Vorontsov-Velyaminov. New approach to Monte Carlo\ncalculation of the free energy: Method of expanded ensembles.\nJ. Chem. Phys., 1992, 96, 1776\u20131783.\nB. Tidor. Simulated annealing on free energy surfaces by a\ncombined molecular dynamics and Monte Carlo approach. J.\nPhys. Chem., 1993, 97, 1069\u20131073.\nX. Kong and C. L. Brooks III. \u03bb-dynamics: A new approach\nto free energy calculations. J. Chem. Phys., 1996, 105, 2414\u2013\n2423.\nThe term \"wormhole\" is employed to evoke the idea of interstellar travel via wormholes [M. S. Morris, K. S. Thorne,\nand U. Yurtsever, Phys. Rev. Lett., 1988, 61, 1446\u20131449]. This\nwormhole move is not to be confused with a different move of\nthe same name used in polymer simulations [J. Houdayer, J.\nChem. Phys., 2002, 116, 1783\u20131787].\nM. A. Miller and W. P. Reinhardt. Efficient free energy calculations by variationally optimized metric scaling: Concepts and\napplications to the volume dependence of cluster free energies\nand to solid-solid phase transitions. J. Chem. Phys., 2000, 113,\n7035\u20137046.\nZ. Zhu, M. E. Tuckerman, S. O. Samuelson, and G. J. Martyna. Using novel variable transformations to enhance conformational sampling in molecular dynamics. Phys. Rev. Lett.,\n2002, 88, 100201.\nA. F. Voter. A Monte Carlo method for determining free-energy\ndifferences and transition state theory rate constants. J. Chem.\nPhys., 1985, 82, 1890\u20131899.\nH. Senderowitz, F. Guarnieri, and W. C. Still. A smart Monte\nCarlo technique for free energy simulations of multiconformational molecules: Direct calculations of the conformational\npopulations of organic molecules. J. Am. Chem. Soc., 1995,\n117, 8211\u20138219.\nG. H. Golub and C. F. Van Loan. Matrix Computations. Johns\n\n\f10\nHopkins University Press, 3rd edition, 1996.\n[17] W. R. Hamilton. On quaternions. Proc. Royal Irish Acad., 1847,\n3, 1\u201316. URL http://www.maths.tcd.ie/pub/HistMath/People/\nHamilton/Quatern2/.\n[18] K. V. Mardia and P. E. Jupp. Directional Statistics. J. Wiley &\nSons, 1999.\n[19] M. S. Head, J. A. Given, and M. K. Gilson. Mining minima: Direct computation of conformational free energy. J. Phys. Chem.,\n1997, 101, 1609\u20131618.\n[20] A. P. Dempster, N. M. Laird, and D. B. Rubin. Maximum likelihood from incomplete data via the EM algorithm. J. Royal\nStat. Soc., 1977, 39, 1\u201338.\n[21] J. J. Verbeek, N. Vlassis, and B. Kr\u00f6se. Efficient greedy learning of Gaussian mixture models. Neural Computation, 2003,\n15, 469\u2013485.\n[22] B. A. Katz, J. Finer-Moore, R. Mortezaei, D. H. Rich, and R. M.\nStroud. Episelection: Novel Ki \u223c nanomolar inhibitors of\nserine proteases selected by binding or chemistry on an enzyme surface. Biochemistry, 1995, 34, 8264\u20138280. URL\nhttp://www.rcsb.org/pdb/cgi/explore.cgi?pdbId=1bty.\n[23] D. A. Case, D. A. Pearlman, J. W. Caldwell, T. E. Cheatham,\nIII, J. Wang, W. S. Ross, C. L. Simmerling, T. A. Darden, K. M.\nMerz, R. V. Stanton, et al. Amber 7. University of California,\nSan Francisco, 2002. URL http://amber.scripps.edu/doc7/.\n[24] W. D. Cornell, P. Cieplak, C. I. Bayly, I. R. Gould, K. M. Merz,\nJr., D. M. Ferguson, D. C. Spellmeyer, T. Fox, J. W. Caldwell,\nand P. A. Kollman. A second generation force field for the simulation of proteins, nucleic acids and organic molecules. J. Am.\nChem. Soc., 1995, 117, 5179\u20135197.\n[25] C. I. Bayley, P. Cieplak, W. D. Cornell, and P. A. Kollman. A\n\n[26]\n\n[27]\n\n[28]\n\n[29]\n\n[30]\n[31]\n\n[32]\n\n[33]\n\nwell-behaved electrostatic potential based method using charge\nrestraints for deriving atomic charges: The RESP method. J.\nPhys. Chem., 1993, 97, 10269\u201310280.\nW. C. Still, A. Tempczyk, R. C. Hawley, and T. Hendrickson.\nSemianalytical treatment of solvation for molecular mechanics\nand dynamics. J. Am. Chem. Soc., 1990, 112, 6127\u20136129.\nG. D. Hawkins, C. J. Cramer, and D. G. Truhlar. Pairwise solute\ndescreening of solute charges from a dielectric medium. Chem.\nPhys. Lett, 1995, 246, 122\u2013129.\nV. Tsui and D. A. Case. Molecular dynamics simulations of\nnucleic acids with a generalized Born solvation model. J. Am.\nChem. Soc., 2000, 122, 2489\u20132498.\nM. J. Frisch, G. W. Trucks, H. B. Schlegel, G. E. Scuseria, M. A. Robb, J. R. Cheeseman, V. G. Zakrzewski, J. A.\nMontgomery, Jr., R. E. Stratmann, J. C. Burant, et al. Gaussian 98, Revision A.9. Gaussian, Inc., Pittsburg, 1998. URL\nhttp://www.gaussian.com.\nM. Mares-Guia and E. Shaw. Studies of the active center of\ntrypsin. J. Biol. Chem., 1965, 240, 1579\u20131585.\nS. M. Schwarzl, T. B. Tschopp, J. C. Smith, and S. Fischer.\nCan the calculation of ligand binding free energies be improved\nwith continuum solvent electrostatics and an ideal-gas entropy\ncorrection? J. Comp. Chem., 2002, 23, 1143\u20131149.\nH. Senderowitz, D. Q. McDonald, and W. C. Still. A practical method for calculating relative free energies of binding:\nChiral recognition of peptidic ammonium ions by synthetic\nionophores. J. Org. Chem., 1997, 62, 9123\u20139127.\nD. J. Adams. Grand canonical ensemble Monte Carlo for a\nLennard-Jones fluids. Mol. Phys., 1975, 29, 307\u2013311.\n\n\f"}