{"id": "http://arxiv.org/abs/1106.5934v2", "guidislink": true, "updated": "2011-07-29T08:29:58Z", "updated_parsed": [2011, 7, 29, 8, 29, 58, 4, 210, 0], "published": "2011-06-29T13:38:46Z", "published_parsed": [2011, 6, 29, 13, 38, 46, 2, 180, 0], "title": "Force-free twisted magnetospheres of neutron stars", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1106.1412%2C1106.3398%2C1106.6072%2C1106.5781%2C1106.0389%2C1106.4669%2C1106.3220%2C1106.1983%2C1106.5282%2C1106.0610%2C1106.2290%2C1106.5229%2C1106.2535%2C1106.1357%2C1106.3678%2C1106.4170%2C1106.0272%2C1106.2288%2C1106.0725%2C1106.1839%2C1106.4769%2C1106.2328%2C1106.1900%2C1106.1472%2C1106.1701%2C1106.0103%2C1106.2494%2C1106.0116%2C1106.1949%2C1106.0746%2C1106.1399%2C1106.4703%2C1106.3862%2C1106.4260%2C1106.2519%2C1106.2713%2C1106.4673%2C1106.0665%2C1106.0749%2C1106.4407%2C1106.3578%2C1106.3667%2C1106.3596%2C1106.3699%2C1106.4040%2C1106.5790%2C1106.2600%2C1106.2775%2C1106.1799%2C1106.2570%2C1106.1031%2C1106.5840%2C1106.1273%2C1106.3609%2C1106.4693%2C1106.3137%2C1106.3593%2C1106.1700%2C1106.5934%2C1106.2815%2C1106.3977%2C1106.5689%2C1106.0533%2C1106.6116%2C1106.3575%2C1106.4267%2C1106.4495%2C1106.5967%2C1106.3005%2C1106.5214%2C1106.1678%2C1106.4027%2C1106.3070%2C1106.0874%2C1106.5362%2C1106.3382%2C1106.1980%2C1106.4502%2C1106.4714%2C1106.5392%2C1106.2635%2C1106.0241%2C1106.4552%2C1106.3270%2C1106.3944%2C1106.5498%2C1106.2817%2C1106.4169%2C1106.4978%2C1106.1735%2C1106.1621%2C1106.3285%2C1106.2622%2C1106.6071%2C1106.3800%2C1106.5391%2C1106.1798%2C1106.5097%2C1106.4995%2C1106.0525%2C1106.5320&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Force-free twisted magnetospheres of neutron stars"}, "summary": "The X-ray spectra observed in the persistent emission of magnetars are\nevidence for the existence of a magnetosphere. The high-energy part of the\nspectra is explained by resonant cyclotron upscattering of soft thermal photons\nin a twisted magnetosphere, which has motivated an increasing number of efforts\nto improve and generalize existing magnetosphere models. We want to build more\ngeneral configurations of twisted, force-free magnetospheres as a first step to\nunderstanding the role played by the magnetic field geometry in the observed\nspectra. First we reviewed and extended previous analytical works to assess the\nviability and limitations of semi-analytical approaches. Second, we built a\nnumerical code able to relax an initial configuration of a nonrotating\nmagnetosphere to a force-free geometry, provided any arbitrary form of the\nmagnetic field at the star surface. The numerical code is based on a\nfinite-difference time-domain, divergence-free, and conservative scheme, based\nof the magneto-frictional method used in other scenarios. We obtain new\nnumerical configurations of twisted magnetospheres, with distributions of twist\nand currents that differ from previous analytical solutions. The range of\nglobal twist of the new family of solutions is similar to the existing\nsemi-analytical models (up to some radians), but the achieved geometry may be\nquite different. The geometry of twisted, force-free magnetospheres shows a\nwider variety of possibilities than previously considered. This has\nimplications for the observed spectra and opens the possibility of implementing\nalternative models in simulations of radiative transfer aiming at providing\nspectra to be compared with observations.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=1106.1412%2C1106.3398%2C1106.6072%2C1106.5781%2C1106.0389%2C1106.4669%2C1106.3220%2C1106.1983%2C1106.5282%2C1106.0610%2C1106.2290%2C1106.5229%2C1106.2535%2C1106.1357%2C1106.3678%2C1106.4170%2C1106.0272%2C1106.2288%2C1106.0725%2C1106.1839%2C1106.4769%2C1106.2328%2C1106.1900%2C1106.1472%2C1106.1701%2C1106.0103%2C1106.2494%2C1106.0116%2C1106.1949%2C1106.0746%2C1106.1399%2C1106.4703%2C1106.3862%2C1106.4260%2C1106.2519%2C1106.2713%2C1106.4673%2C1106.0665%2C1106.0749%2C1106.4407%2C1106.3578%2C1106.3667%2C1106.3596%2C1106.3699%2C1106.4040%2C1106.5790%2C1106.2600%2C1106.2775%2C1106.1799%2C1106.2570%2C1106.1031%2C1106.5840%2C1106.1273%2C1106.3609%2C1106.4693%2C1106.3137%2C1106.3593%2C1106.1700%2C1106.5934%2C1106.2815%2C1106.3977%2C1106.5689%2C1106.0533%2C1106.6116%2C1106.3575%2C1106.4267%2C1106.4495%2C1106.5967%2C1106.3005%2C1106.5214%2C1106.1678%2C1106.4027%2C1106.3070%2C1106.0874%2C1106.5362%2C1106.3382%2C1106.1980%2C1106.4502%2C1106.4714%2C1106.5392%2C1106.2635%2C1106.0241%2C1106.4552%2C1106.3270%2C1106.3944%2C1106.5498%2C1106.2817%2C1106.4169%2C1106.4978%2C1106.1735%2C1106.1621%2C1106.3285%2C1106.2622%2C1106.6071%2C1106.3800%2C1106.5391%2C1106.1798%2C1106.5097%2C1106.4995%2C1106.0525%2C1106.5320&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "The X-ray spectra observed in the persistent emission of magnetars are\nevidence for the existence of a magnetosphere. The high-energy part of the\nspectra is explained by resonant cyclotron upscattering of soft thermal photons\nin a twisted magnetosphere, which has motivated an increasing number of efforts\nto improve and generalize existing magnetosphere models. We want to build more\ngeneral configurations of twisted, force-free magnetospheres as a first step to\nunderstanding the role played by the magnetic field geometry in the observed\nspectra. First we reviewed and extended previous analytical works to assess the\nviability and limitations of semi-analytical approaches. Second, we built a\nnumerical code able to relax an initial configuration of a nonrotating\nmagnetosphere to a force-free geometry, provided any arbitrary form of the\nmagnetic field at the star surface. The numerical code is based on a\nfinite-difference time-domain, divergence-free, and conservative scheme, based\nof the magneto-frictional method used in other scenarios. We obtain new\nnumerical configurations of twisted magnetospheres, with distributions of twist\nand currents that differ from previous analytical solutions. The range of\nglobal twist of the new family of solutions is similar to the existing\nsemi-analytical models (up to some radians), but the achieved geometry may be\nquite different. The geometry of twisted, force-free magnetospheres shows a\nwider variety of possibilities than previously considered. This has\nimplications for the observed spectra and opens the possibility of implementing\nalternative models in simulations of radiative transfer aiming at providing\nspectra to be compared with observations."}, "authors": ["Daniele Vigan\u00f2", "Jose A. Pons", "Juan A. Miralles"], "author_detail": {"name": "Juan A. Miralles"}, "author": "Juan A. Miralles", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1051/0004-6361/201117105", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/1106.5934v2", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/1106.5934v2", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "16 pages, 17 figures, A&A accepted", "arxiv_primary_category": {"term": "astro-ph.HE", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "astro-ph.HE", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/1106.5934v2", "affiliation": "University of Alicante", "arxiv_url": "http://arxiv.org/abs/1106.5934v2", "journal_reference": "Astronomy & Astrophysics, 533 (2011) A125", "doi": "10.1051/0004-6361/201117105", "fulltext": "c ESO 2018\n\nAstronomy & Astrophysics manuscript no. ff\nNovember 23, 2018\n\nForce-free twisted magnetospheres of neutron stars\nD. Vigan\u00f21 , J.A. Pons1 , and J.A. Miralles1\nDepartament de F\u0131\u0301sica Aplicada, Universitat d'Alacant, Ap. Correus 99, 03080 Alacant, Spain\nPreprint online version: November 23, 2018\n\narXiv:1106.5934v2 [astro-ph.HE] 29 Jul 2011\n\nABSTRACT\n\nContext. The X-ray spectra observed in the persistent emission of magnetars are evidence for the existence of a magnetosphere. The\nhigh-energy part of the spectra is explained by resonant cyclotron upscattering of soft thermal photons in a twisted magnetosphere,\nwhich has motivated an increasing number of efforts to improve and generalize existing magnetosphere models.\nAims. We want to build more general configurations of twisted, force-free magnetospheres as a first step to understanding the role\nplayed by the magnetic field geometry in the observed spectra.\nMethods. First we reviewed and extended previous analytical works to assess the viability and limitations of semi-analytical approaches. Second, we built a numerical code able to relax an initial configuration of a nonrotating magnetosphere to a force-free\ngeometry, provided any arbitrary form of the magnetic field at the star surface. The numerical code is based on a finite-difference\ntime-domain, divergence-free, and conservative scheme, based of the magneto-frictional method used in other scenarios.\nResults. We obtain new numerical configurations of twisted magnetospheres, with distributions of twist and currents that differ from\nprevious analytical solutions. The range of global twist of the new family of solutions is similar to the existing semi-analytical models\n(up to some radians), but the achieved geometry may be quite different.\nConclusions. The geometry of twisted, force-free magnetospheres shows a wider variety of possibilities than previously considered.\nThis has implications for the observed spectra and opens the possibility of implementing alternative models in simulations of radiative\ntransfer aiming at providing spectra to be compared with observations.\nKey words. magnetohydrodynamics - stars: neutron - stars: magnetic fields - scattering\n\n1. Introduction\nAnomalous X-ray pulsars (AXPs) and soft gamma-ray repeaters (SGRs) are a class of neutron stars (NSs) characterized by high X-ray quiescent luminosities, short X-ray bursts,\nand giant flares (for SGRs). They are believed to be magnetars (Duncan & Thompson, 1992, Thompson & Duncan, 1996):\nyoung (P/2 \u1e56 \u223c 102 \u2212 105 yr) NSs with very strong magnetic\nfields \u223c 1014 \u2212 1015 G. Magnetars are supposedly born with\na very short spin period (few milliseconds), which causes the\nformation of an intense inner magnetic field via dynamo processes and a subsequent rapid loss of rotational energy by means\nof magnetic braking. As more and better data become available\nin the last decade,1 the separation between the two traditional\nclasses (SGRs and AXPs) has become thinner, and they are no\nlonger considered different classes. All SGRs and most of AXPs\nhave shown sporadic bursts in the X and \u03b3 bands, and the recent\ndiscovery of transient magnetars has made the situation even less\nclear. Currently, our interpretation of the term magnetars is being\nreconsidered (see Mereghetti (2008), Rea & Esposito (2011) for\nobservational reviews). In general, magnetars are characterized\nby long periods P \u223c 2 \u2212 12 s and high X-ray persistent luminosities LX \u223c 2 \u00d7 1033 \u2212 2 \u00d7 1035 erg s\u22121 , which point to the magnetic\nfield decay as the main source of energy, unlike radio pulsars,\nfed by the loss of rotational energy. One key ingredient in those\nmodels that try to explain the variety of magnetar phenomenology and their spectra is the presence of toroidal fields, of the\nsame order of magnitude or even larger than the poloidal component, both in the interior and in the external magnetosphere.\n\nThe object of this paper is the modeling of the magnetosphere of magnetars, which is crucial because it is one of the\nmain ingredients in the formation of spectra. The difficulty in\nbuilding fully consistent solutions of NS magnetospheres is such\nthat, after more than 40 years, the aligned rotator model proposed by Goldreich & Julian (1969) still remains very popular\nfor explaining the basic features of a rotating magnetosphere. We\nmust point out that the aligned rotator model, with all its variants,\nis surely a naive description of pulsars that has been strongly\ncriticized (e.g. Michel, 1980), among other reasons, simply because it cannot explain why pulsars pulsate. A further refinement consists of the ideal MHD approximation for force-free\nmagnetospheres, which leads to the so-called pulsar equation.\nThis is simply the balance of the electromagnetic forces around\nthe rotating neutron star under the assumption of axial symmetry and it neglects the pressure, inertial, and gravitational terms.\nThe rotationally induced electric field is required to be perpendicular to the magnetic field. The latter can in general have an\nazimuthal component, that twists the poloidal field lines. This\ntoroidal component has to be sustained by currents, whose shape\nis the source term of the pulsar equation: it is the fundamental\nparameter to be chosen in order to find the corresponding geometric configuration of the magnetic field.\n\nThe problem is analytically solvable only for a few simple, ad-hoc choices of the current, such as in Michel (1973b),\nbut these solutions generally present unphysical features in\nsome border regions. An alternative numerical approach by\nContopoulos et al. (1999) is useful to construct consistent forcefree models, with a smooth matching across the light cylinder. In\n1\nThe updated catalog of these sources can be found at this model the corotating region only hosts an untwisted dipolar\nhttp://www.physics.mcgill.ca/\u223cpulsar/magnetar/main.html magnetic field, and the focus is on the bundle of open twisted\n\n\f2\n\nD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nlines that cross the light cylinder and the resulting output power.\nThe model was refined by Gruzinov (2005) and extended to the\ntime-dependent, misaligned case by means of 3D simulations by\nSpitkovsky (2006) and Kalapotharakos & Contopoulos (2009).\nNowadays, X-ray instruments allow us to obtain more and\nmore information from the spectra of magnetars. An especially\ninteresting feature in the persistent emission of all of the magnetar candidates is that their spectra can be well fitted with a thermal component (0.4 \u2212 0.7 keV) plus a hard nonthermal tail, described by a power law with photon index \u03b2 \u223c 3 \u2212 4 (Mereghetti,\n2008). This hard component is commonly attributed to resonant\nCompton scattering, which becomes important in the presence\nof a strong current (i.e. high charge density). For this reason,\nmuch attention has been given to the modeling of currents flowing in a twisted magnetosphere and obtaining estimates of the\ncharge carrier density and the corresponding resonant optical\ndepth. Lyutikov & Gavriil (2006) propose a semi-analytical 1D\nmodel able to describe the basic properties of radiation transfer across a twisted magnetosphere. More accurate 3D Monte\nCarlo simulations have been performed for the nonrelativistic\n(Fern\u00e1ndez & Thompson, 2007, Nobili et al., 2008a) and relativistic cases (Nobili et al., 2008b). Fern\u00e1ndez & Davis (2011)\ndiscuss the implications of the outgoing polarization. The implementation in XSpec and the systematic fits to observational\ndata have been successfully performed by Rea et al. (2008) and\nZane et al. (2009) for the 1D and 3D cases, respectively. All\nthese very remarkable results rely on the same family of models: the self-similar twisted dipole proposed by Thompson et al.\n(2002), extended to higher multipoles by Pavan et al. (2009),\nwhich represents a semi-analytical, easy-to-implement solution\nto the pulsar equation. However, this model lacks generality, as\nit relies on a very particular choice of the form of the current.\nWe note that force-free magnetosphere models rely on a\npurely macrophysical approach but a fully coherent microphysical description is still lacking: how are the currents and electric\nfields in a given model generated and sustained? Which particles are present (electrons, ions, pairs)? Where do they come\nfrom? Which velocity distribution can be assigned to each kind\nof particle? In the magnetar framework, there are some excellent attempts to give a microphysical description of coronae.\nBeloborodov & Thompson (2007) deal with the problem considering a deviation from force-free equilibrium, which has to\nbe introduced to explain the production of pairs, but many questions remain open. Given the complexity of the problem, one\nhas to decide whether to focus on detailed microphysical processes of an approximate macrophysical solution or to improve\nthe large-scale electrodynamics solutions by gradually removing\nsome of the simplifying hypotheses.\nIn this article, we present our efforts to obtain some more\ngeneral configurations of a twisted magnetosphere and to estimate the dependence of the spectrum on the geometric configuration. In Sect. 2, we set the formalism needed to describe the\nproblem and present some analytical and semi-analytical generalizations of previous works. In Sect. 3 we describe the numerical code used to build force-free configurations and the battery\nof tests performed to verify the code. We pay special attention\nto the effect of key input parameters and the convergence of the\nmethod. In Sect. 4 we present new results for magnetosphere\nmodels, and explore the sensitivity of the relevant output (current, charge distribution, and resonant optical depth) to different\ninput parameters. In Sect. 5 we summarize our findings and outline future improvements.\n\nFig. 1. Relation between magnetic flux function \u0393, enclosed current function I(\u0393), and toroidal field.\n\n2. Analytical and semianalytical solutions\n2.1. The pulsar equation\n\nWe consider an NS with a magnetic field B and angular velocity\n\u03a9. Assuming that the plasma is a perfect conductor in vicinity\nof the star, rotation induces an electric field given by\nE=\u2212\n\n\u03a9\u00d7r\n\u00d7 B.\nc\n\n(1)\n\nwhere c is the velocity of light. Neglecting centrifugal (i.e. inertial), collisional, and gravitational terms compared to electromagnetic forces, the force equilibrium equation is expressed by\n\u03c1e E +\n\n1\nJ\u00d7B=0,\nc\n\n(2)\n\nwhere \u03c1e is the charge density and J the current density.\nAssuming axial symmetry (aligned rotator) and working in\nspherical coordinates (r, \u03b8, \u03c6), we introduce the magnetic flux\nfunction \u0393(r, \u03b8), in terms of which the poloidal field is\nBp =\n\n\u2207\u0393(r, \u03b8) \u00d7 \u03c6\u0302\n,\nr sin \u03b8\n\n(3)\n\nwhere \u03c6\u0302 is the unit azimuthal vector. With the choice of gauge\n\u0393 = 0 on the axis, the function \u0393(r, \u03b8) is related to the\n\u03c6\u2212component of the potential vector by\n\u0393(r, \u03b8) = A\u03c6 (r, \u03b8)r sin \u03b8 ,\n\n(4)\n\nand it is constant along a field line (B p * \u2207\u0393 = 0). Thus its value\nlabels the axisymmetric surface S \u0393 given by the azimuthal rotation of one field line. The magnetic flux flowing within the\nsurface S \u0393 , with value \u03a6\u0393 (B) = 2\u03c0\u0393, is conserved by definition.\nA toroidal component (i.e. \u03c6-component in axial symmetry) of\nthe magnetic field is present if sustained by poloidal currents.\nThe enclosed current I flowing within S \u0393 (see blue arrows in\nFig. 1 and note that the force-free condition implies that currents\nflow parallel to the surfaces S \u0393 ) has to be a function of only \u0393,\nwith the only requirement being that I(0) = 0. Thus we have the\nfreedom of choosing the enclosed current function I(\u0393), and by\nAmp\u00e9re's law, the \u03c6\u2212component of the magnetic field is related\nto I by\nB\u03c6 =\n\n2\nI(\u0393) .\ncr sin \u03b8\n\n(5)\n\nFor a given magnetosphere model, it is useful to define the\ntwist of a field line as the azimuthal displacement between its\n\n\fD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nsurface footprints (for a dipolar-like configuration, one footprint in each hemisphere). The integral of the local displacement\n\u03b4\u03c6(r, \u03b8) = B\u03c6 \u03b4\u03b8/B\u03b8 sin \u03b8 along the magnetic field line, l\u0393 , between its surface footprints at magnetic colatitudes \u03b81,2 (\u0393) is the\nline twist\nZ \u03b82\nB\u03c6 (r(\u03b8, \u0393), \u03b8)\n\u2206\u03c6tw (\u0393) \u2261\nd\u03b8 ,\n(6)\n\u03b81 B\u03b8 (r(\u03b8, \u0393), \u03b8) sin \u03b8\nwhere the dependence r(\u03b8, \u0393) can be found by solving the field\nline equations. The function \u2206\u03c6tw (\u0393) is used to characterize a\nmagnetosphere.\nWe then return to the equilibrium equation (2). In axial symmetry, only poloidal components of the electric field are allowed. Considering the poloidal component of Eq. (2) in cylindrical coordinates (\u03c1, \u03c6, z) and denoting the radius of the light\ncylinder by rl = c/\u03a9, we obtain the so-called pulsar equation\n(Scharlemann & Wagoner, 1973, Michel, 1973b):\n\uf8eb\n\uf8eb\n\uf8f6\n\uf8f6\n\uf8ec\uf8ec\uf8ec\n\u03c12 \uf8f7\ndI\n\u03c12 \uf8f7\n1\uf8ec\n4\n\uf8ec\uf8ed1 \u2212 2 \uf8f7\uf8f7\uf8f7\uf8f8 (\u0393zz + \u0393\u03c1\u03c1 ) \u2212 \uf8ec\uf8ec\uf8ec\uf8ed1 + 2 \uf8f7\uf8f7\uf8f7\uf8f8 \u0393\u03c1 = \u2212 2 I(\u0393)\n,\n(7)\n\u03c1\nd\u0393\nc\nrl\nrl\n\nwhere we indicate the partial derivatives of \u0393 with a subscript.\nThe terms (\u03c1/rl )2 arise from the Coulomb force \u03c1e E. The pulsar\nequation is actually the Grad-Shafranov equation for force-free\nfields. In general, Eq. (7) has to be solved numerically. Even\nfor trivial choices of untwisted configurations (I(\u0393) = 0), the\ncorotation velocity of the charged particles distorts the vacuum\nsolutions, resulting in open field lines near the light cylinder\n\u03c1 \u223c O(rl ) (Michel, 1973a). The only fully analytical solution\nincluding rotation and a smooth matching across the light cylinder is the split twisted monopole presented by Michel (1973b),\nin which the field lines are radial and the magnetic field changes\nsign between the northern and southern hemispheres. A current\nsheet at the equator is needed to ensure the divergence-free condition. This is a wind-like solution inappropriate to describing\nthe region with closed field lines. Later, the numerical solution\nby Contopoulos et al. (1999) for the first time provided a complete description of a magnetosphere, whose closed lines are untwisted, while the wind zone has a configuration that is very similar to the split monopole.\nIn the case of a nonrotating star (magnetars are slow rotators\nand this may be a reasonable approximation for some problems),\nno electric field is induced and the equilibrium equation is simply J \u00d7B = 0: the force-free condition only requires that currents\nflow parallel to magnetic field lines. In this limit, we can reformulate the whole problem with the simple equation\n\u2207 \u00d7 B = \u03b1(\u0393)B ,\n\n(8)\n\nwhere the function \u03b1(\u0393) is related to the enclosed current function introduced in Eq. (5) by\n\u03b1(\u0393) =\n\n2 dI(\u0393)\n.\nc d\u0393\n\n(9)\n\nThe pulsar equation in spherical coordinates is now expressed as\nZ\n\u22022 \u0393 cos \u03b8 1 \u2202\u0393 1 \u22022 \u0393\n+\n\u2212\n=\n\u2212\u03b1(\u0393)\n\u03b1(\u0393)d\u0393 .\n(10)\nsin \u03b8 r2 \u2202\u03b8 r2 \u2202\u03b82\n\u2202r2\nNext we expand the magnetic flux function in Legendre polynomials, Pl (\u03bc):\nX r\ndPl (\u03bc)\nal (r)(1 \u2212 \u03bc2 )\n,\n(11)\n\u0393(r, \u03bc) = \u03930\nr\nd\u03bc\n\u22c6\nl\n\n3\n\nwhere \u03bc = cos \u03b8, al (r) is the dimensionless radial function, r\u22c6\nthe radius of the star, and \u03930 the magnetic flux normalization.\nDenoting the strength at pole by B0 , we hereafter choose\nB0 r\u22c62\n.\n(12)\n2\nThis leads to the following expression for the poloidal magnetic\nfield components:\nB0 r\u22c6 X\nl(l + 1)Pl (\u03bc)al (r) ,\nBr =\n2 r l\nq\nX dPl (\u03bc) d(ral (r))\nB0 r\u22c6\n.\n(13)\nB\u03b8 = \u2212\n1 \u2212 \u03bc2\n2 r\nd\u03bc\ndr\nl\n\u03930 =\n\nWe can obtain the governing differential equation from Eq. (10):\n#\nX dPl (\u03bc) \" d2 (ral (r))\nB0 r\u22c6\nal (r)\n2\n=\n(1 \u2212 \u03bc )\n\u2212 l(l + 1)\n2\nd\u03bc\nr\ndr2\nl\nZ\n= \u2212\u03b1(\u0393) \u03b1(\u0393)d\u0393 .\n(14)\nFinally, by using the orthogonality relations of Legendre polynomials, we have\n\"\n#\nl(l + 1) d2 (ral (r))\nal (r)\n=\nB0 r\u22c6\n\u2212 l(l + 1)\n2l + 1\nr\ndr2\n\"\n#\nZ 1\nZ\ndPl (\u03bc)\n=\u2212\n\u03b1(\u0393) \u03b1(\u0393)d\u0393 d\u03bc .\n(15)\nd\u03bc\n\u22121\nThe righthand side depends on the functional form of \u03b1(\u0393) and\nis responsible for the coupling between different multipoles. For\nconstant \u03b1 the equation has analytical solutions (see Sect. 2.2),\nwhile the problem is more difficult for other choices. The rest of\nthis section is devoted to reviewing some possible choices that\nmake the problem (semi)analytically solvable in the nonrotating\ncase, which applies to magnetars.\n2.2. Constant \u03b1: Bessel solutions\n\nThe choice of constant \u03b1 = k/r\u22c6 , where k is a dimensionless parameter, leads to decoupled equations for each single multipole,\nso that for each l, we must independently solve the equation\n\uf8ee\n\uf8f9\n!2\n2\n\uf8fa\uf8fa\ndal (r) \uf8ef\uf8ef\uf8ef\uf8ef r\n2 d al (r)\n+ 2r\nr\n+ \uf8ef\uf8f0 k\n\u2212 l(l + 1)\uf8fa\uf8fa\uf8fa\uf8fb al (r) = 0.\n(16)\n2\ndr\nr\u22c6\ndr\nThe analytic solutions of this equation are the spherical Bessel\nfunctions of the first and second kinds:\n!l\n1 \u2202 sin x\n,\n(17)\nJl (x) = (\u2212x)l\nx \u2202x\nx\n!l\ncos x\nl+1 1 \u2202\nYl (x) = (\u2212x)\n,\n(18)\nx \u2202x\nx\n\nwhere x = kr/r\u22c6 . The constant ratio r\u22c6 /k gives the typical scalelength of the magnetic field. The physical solutions (from which\nthe vacuum solution B p \u221d r\u2212(l+1) can be recovered in the limit\nk \u2192 0) are represented by the functions of the second kind, explicitly:\nal (r) = cl Yl (x) ,\nB0 r\u22c6 X\nl(l + 1)Pl (\u03bc)cl Yl (x) ,\nBr =\n2 r l\n\n\f4\n\nD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nX dPl (\u03bc) d(xYl (x))\nB0 r\u22c6\n1 \u2212 \u03bc2\ncl\n,\n2 r\nd\u03bc\ndx\nl\nq\nX dPl (\u03bc)\nB0\n1 \u2212 \u03bc2\nB\u03c6 = k\ncl Yl (x) ,\n2\nd\u03bc\nl\nq\n\nB\u03b8 = \u2212\n\n(19)\n\nwhere cl is the weight of the l-multipole.\nThis choice of constant \u03b1 has been followed in several studies of the solar corona (Chiu & Hilton, 1977, Seehafer, 1978) or\napplied to the region with open field lines of the pulsar magnetosphere (Scharlemann & Wagoner, 1973). The Yl (x) functions are\noscillatory at large distances, and the magnetic field components\nchange sign as r varies (at fixed parameter k). The problem with\nthis family of analytical solutions is that, at large distances, all\ncomponents (which have the same radial dependence for any l)\ndecay too slowly: Br \u2192 r\u22122 , B\u03b8 \u2192 r\u22121 , B\u03c6 \u2192 r\u22121 . Thus this configuration cannot be a solution for the whole space, as it would\nimply infinite magnetic energy in an infinite volume. Also, these\nsolutions cannot be continuously matched with vacuum, because\nit would require that, at the same radius rout , B\u03c6 (rout ) = 0 and\nBr (rout ) , 0, a condition that cannot be satisfied because those\ntwo components are both proportional to the Yl (x) functions and\nhave the same zeros.\n2.3. Self-similar models\n\nLow & Lou (1990), followed by Wolfson (1995) and other authors, studied a particular class of self-similar solutions to describe the opening of the solar coronal magnetic field lines due\nto their shear. Thompson et al. (2002) applied the same approach\nin the magnetar framework. Assuming a radial power-law form\nfor the magnetic flux function and a radial dependence \u03b1 \u221d 1/r,\n\u0012 r \u0013p\n\u22c6\nF(\u03bc) ,\n(20)\n\u0393 = \u03930\nr\n!1/p\nk ss\nk ss |\u0393|\n\u03b1=\n|F(\u03bc)|1/p =\n,\n(21)\nr\nr\u22c6 \u03930\nthe enclosed current function is\nI(\u0393) = I0\n\n\u0393\n\u03930\n\n1+1/p\n\n,\n\n(22)\n\nwhere\nI0 = k ss\n\np\ncB0r\u22c6\n4(p + 1)\n\n(23)\n\nis the current normalization, related to the amount of current, like\nthe dimensionless parameter k ss . Equation (10) becomes a nonlinear second-order differential equation for the angular function\nF(\u03bc):\n(1 \u2212 \u03bc2 )F \u2032\u2032 (\u03bc) + p(p + 1)F(\u03bc) = \u2212k2ss\n\np\nF(\u03bc)|F(\u03bc)|2/p\np+1\n\n(24)\n\nwhere primes stand for derivatives of F(\u03bc) with respect to \u03bc. The\nmagnetic field is given by\nB0 \u0012 r\u22c6 \u0013(p+2) \u2032\nBr = \u2212\nF (\u03bc) ,\n2 r\nF(\u03bc)\nB0 \u0012 r\u22c6 \u0013(p+2)\n,\n(25)\npp\nB\u03b8 =\n2 r\n1 \u2212 \u03bc2\nB0 \u0012 r\u22c6 \u0013(p+2) p F(\u03bc)|F(\u03bc)|1/p\nB\u03c6 = k ss\n.\np\n2 r\np+1\n1 \u2212 \u03bc2\n\nFig. 2. Curve I0 (p) describing the family of self-similar twisted\ndipoles.\n\nThe three components of the magnetic field have the same\nradial dependence, so we are seeking for self-similar solutions.\nThe maximum line twist, which is the one suffered by a polar\nline (\u0393 \u2192 0), is called global twist, and it can be taken as the parameter that uniquely describes the l-pole family of self-similar\nsolutions. Due to self-similarity, Eq. (6) for \u0393 \u2192 0 becomes very\nstraightforward:\n2k ss\n\u2206\u03c6 =\np+1\n\nZ\n\n0\n\n1\n\n|F(\u03bc)|1/p\nd\u03bc\n1 \u2212 \u03bc2\n\n(26)\n\nEquation (24) has to be numerically solved by imposing\nthree physical requirements: F(1) = F(\u22121) = 0 (on the axis,\nonly the radial field component is allowed), and F \u2032 (1) = \u22122 (to\nfix the normalization). Given a value of k ss , one can find an infinite number of solutions characterized by an eigenvalue p. Each\nsolution represents a different multipole (except the dipole for\nwhich there are two solutions). Fixing k ss = 0 (i.e. I0 = 0, no\ncurrent) implies an integer value of p, so that we recover the vacuum multipolar solution with F(\u03bc) = (1 \u2212 \u03bc2 )dP p (\u03bc)/d\u03bc where\nP p is the pth Legendre polynomial. For each multipole, a unique\nrelation k ss (p) (or I0 (p) once the values of B0 and r\u22c6 are fixed)\ndefines the family of solutions. In Fig. 2 we show the curve of\nparameters we obtained for the twisted dipole family. Our results\nagree with the dipolar solutions of Thompson et al. (2002) and\nthe higher multipole solutions of Pavan et al. (2009). We have\nused these models in the numerical code (section Sect. 3) for\ntesting purposes and for the sake of comparison with other numerical solutions.\nHowever, all these solutions are of limited generality because\nthey have a defined symmetry with respect to the equator, and a\nlinear combination of solutions for different multipoles is not a\nnew solution, due to the nonlinear character of the problem.\n2.4. General axisymmetric solutions\n\nThe righthand side depends on the functional form of \u03b1(\u0393) and\nis responsible for the coupling between different multipoles. We\nhave explored several possible analytical forms of \u03b1(\u0393). Aiming\nat more general solutions, we explore several possible analytical\nforms of \u03b1(\u0393) in Eq. (15). In search of semianalytical solutions,\nwe consider power laws of the form\n!q\nk \u0393\n\u03b1=\n,\n(27)\nr\u22c6 \u03930\n\n\fD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nwith k the dimensionless parameter regulating the amount of currents, and \u03930 given by Eq. (12).\nObviously the trivial choice \u03b1 = 0 gives the vacuum (i.e. untwisted) solutions. The choice of \u03b1 constant has already been\nconsidered in Sect. 2.2. Some choices with q < 0, such as\nq = \u22121/2, present mathematical problems and are definitely not\nphysical, and high values of q make the problem unsolvable with\nsemi-analytical methods. Therefore, only a few simple choices\nmay be useful because of their simplicity. An interesting case is\nq = 1/2. Assuming that \u0393 > 0 in the domain of integration, this\nparticular choice leads to\n!3/2\n1\n\u0393\nr\u22c6\nB\u03c6 = kB0\n,\n(28)\n3\nr sin \u03b8 \u03930\nand the following ODE for each radial function fl = al (r)r/r\u22c6 :\n!2 X\n\u221e\nd2 fl (r)\nfl (r)\nk\nfm (r) fn (r)glmn ,\n(29)\n\u2212\nl(l\n+\n1)\n=\n\u2212\nr\u22c6 m,n=1\ndr2\nr2\nwhere each dimensionless Gaunt factor glmn involves the integral\nof the product of three Legendre polynomials (see Appendix B\nfor a detailed derivation). Numerically it is \u223c O(1). Therefore,\nthe source term couples each multipole l with an infinite number\nof multipoles m and n. One can solve the problem by truncating\nthe series and allowing only for a finite number of multipoles.\nThis approach is more general than other simple cases, but it has\nmany more degrees of freedom.\n\nc\n\u2207 \u00d7 B.\u03bd is a normalization constant that sets the\nwhere J = 4\u03c0\ntime unit in the induction equation. Hereafter we use \u03bd = 1. This\nresults in a fictitious electric field:\n\nE f = \u2212v f \u00d7 B .\n\nIn the previous section we have discussed some analytical and\nsemi-analytical solutions that share the same drawback: the arbitrary choice of the enclosed current function I(\u0393) or, equivalently, \u03b1(\u0393). Some of these solutions are nonphysical, in the\nsense that they can neither be extended to infinity nor matched\nto vacuum solutions. All these limitations make the (semi)analytical approach insufficient for general purposes, because\nwe have no physical argument for preferring one particular form\nof the current over another. The alternative is to find numerical\nsolutions of the nonlinear, force-free equations describing an NS\nmagnetosphere. We have three main reasons for working in this\ndirection. First, we expect these solutions to be more general and\nin some cases very different from the semi-analytical ones. By\nstudying new numerical equilibrium solutions, we hope to gain\ninsight into the form of the most realistic choices of enclosed\ncurrent functions. Second, a reliable numerical code could in\nprinciple be extended, if adding the rotationally-induced electric field, to build a consistent corotating magnetosphere model\nfrom which the distribution of charge density can be computed\ndirectly. Third, the ability to build magnetospheric solutions for\nany prescribed form of the magnetic field at the surface is very\nuseful for future studies of the dynamics of the magnetosphere\ncoupled with the physics of the crust.\n3.1. The magneto-frictional method\n\nFor simplicity, we begin with the two-dimensional nonrotating\ncase, assuming that the force-free approximation is valid up to\nan outer radius rout , which reduces the problem to finding solutions of Eq. (10). In the so-called magneto-frictional method\n(Yang et al., 1986, Roumeliotis et al., 1994), one begins with an\ninitially non-force-free configuration and defines a fictitious velocity field proportional to the Lorentz force, v f = \u03bdJ \u00d7 B/B2 ,\n\n(30)\n\nThis fictitious electric field enters into the induction equation as\na frictional term that forces the solution to relax to a force-free\nconfiguration.\nIn the original method, Roumeliotis et al. (1994) write the\nmagnetic field as\nB = \u2207\u0393 \u00d7 \u2207\u03b2 ,\n\n(31)\n\nwhere \u0393 is the magnetic flux function defined in Eq. (3), and\n\u03b2 = \u03c6 \u2212 \u03b3(r, \u03b8), where \u03b3(r, \u03b8) is a scalar potential related with the\nfreedom in the choice of the form of the enclosed current. The\ninduction equation becomes a system of two advection equations\nfor those two functions:\n\u2202t \u0393 + v f * \u2207\u0393 = 0\n\u2202t \u03b2 + v f * \u2207\u03b2 = 0 .\n\n(32)\n\nA static solution is achieved if and only if v f = 0, since the\nvelocity field, \u2207\u0393, and \u2207\u03b2 are all orthogonal to the magnetic\nfield by definition.\nWe apply the same idea but, instead of evolving the functions\n\u0393 and \u03b2, we evolve the magnetic field components directly by\nsolving the induction equation\n\u2202t B = \u2212\u2207 \u00d7 E f ,\n\n3. Numerical solutions\n\n5\n\n(33)\n\nwhere the fictitious electric field can be written as\nE f = J \u2212 (J * B)B/B2 ,\n\n(34)\n\nwhere E f is a measure of the deviation from the force-free condition, because J k B is accomplished if and only if E f \u2261 0. The\nmain reason for solving the induction equation instead of Eqs.\n(32) is to allow for future extensions of the code by considering a\nreal, rotationally-induced electric field. The disadvantage is that\nwe have to be more careful when setting boundary conditions for\nthe electric field, because we could converge to stationary solutions characterized by \u2207 \u00d7 E f = 0, which are not necessarily\nforce-free.\n3.2. Linear analysis of the magneto-frictional method\n\nWe now consider a background, uniform magnetic field B0 and\na small perturbation \u03b4B \u221d ei(k*r\u2212\u03c9t) . In the linear regime, the\nequations read as\nc\nik \u00d7 \u03b4B\n4\u03c0\n1\n\u03b4E f = \u2212 2 [(\u03b4J \u00d7 B0 ) \u00d7 B0 ]\nB0\n\u2202\u03b4B\n= \u2212i\u03c9\u03b4B = \u2212\u2207 \u00d7 \u03b4E f .\n\u2202t\n\u03b4J =\n\n(35)\n\nExplicitly, the last equation can be written as\n\u2212i\n\nk \u00d7 B0\n4\u03c0\u03c9\n\u03b4B =\n[\u03b4B * (k \u00d7 B0 )] \u2212 k2 \u03b4B .\nc\nB20\n\n(36)\n\nIf the perturbed current is orthogonal to the background magnetic field (either longitudinal perturbations \u03b4B k B0 or transverse perturbations with k k B0 ), the first term on the righthand\n\n\f6\n\nD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nSince the the righthand side of Eq. (33) contains \u2207 \u00d7 E f , it is\nuseful to apply Stokes' theorem as follows. The magnetic flux\nacross S n(i, j) is approximated by\nj)\nj) (i, j)\n\u03a6(i,\n= B(i,\n,\nn\nn Sn\n\n(41)\n\nand the magnetic fluxes are advanced in time using\nI\nj)\n(i, j)\nE f * dl,\n\u03a6(i,\n(t\n+\n\u2206t)\n=\n\u03a6\n(t)\n\u2212\n\u2206t\nn\nn\n\u2202S n(i, j)\n\n(42)\n\nwhere the numerical circulation of the electric field along the\nedges of the surface S n is approximated by using the values of\nE f in the middle of the edges, whose lengths are\n(i, j)\n\nFig. 3. Location of the variables in the numerical grid.\nside of Eq. (36) vanishes and the dispersion relation is purely\ndissipative:\n\u03c9 = \u2212i\n\nc 2\nk .\n4\u03c0\n\n(37)\n\nAny perturbation of this type will be dissipated on a timescale\n\u221d k\u22122 . In contrast, for transverse perturbations with both \u03b4B and\nk orthogonal to B0 , the current is parallel to the background\nmagnetic field, and the two terms in the righthand side of Eq.\n(36) cancel out, so that the perturbation does not evolve (a neutral mode with \u03c9 = 0). Therefore, the magneto-frictional method\nis designed to dissipate all induced currents nonparallel to the\nmagnetic field but allows for stationary solutions with currents\nparallel to the field. Since the largest lengthscale in our problem\nis set by the size of the numerical domain, \u03bbmax \u03c0rout , the typical\ndiffusion timescale on which we expect to converge to a force2\nfree solution is tdi f \u221d rout\n.\n3.3. The numerical method\n\nWe work in spherical coordinates (r, \u03b8, \u03c6) under the assumption\nof axial symmetry. We employ a fully explicit finite difference\ntime domain (FDTD) method (Taflove & Brodwin, 1975) with a\nnumerical grid equally spaced in \u03b8 and logarithmic in the radial\ndirection, unless the outer radius is very close to the surface of\nthe star (located at r = 1), in which case we employ a linearly\nspaced radial grid. Our typical resolution varies between 30-200\npoints in the radial direction and 30-100 points in the angular\ndirection. At each node (\u03b8i , r j ), we define all components of B(i, j)\nand consider the three surfaces S n(i, j) centered on this node and\nnormal to the unit vectors n\u0302 = r\u0302, \u03b8\u0302, \u03c6\u0302. The elementary areas are\ncalculated by the following exact formulas:\nZ 2\u03c0 Z \u03b8i+1\n(i, j)\nSr =\nr2j sin \u03b8 d\u03c6 d\u03b8 = 2\u03c0r2j (cos \u03b8i\u22121 \u2212 cos \u03b8i+1 ()38)\n0\n\nS \u03b8(i, j) =\n\nZ\n\n2\u03c0\n\nS \u03c6(i, j)\n\nZ\n\n\u03b8i+1\n\n=\n\n0\n\n\u03b8i\u22121\nr j+1\n\nZ\n\nr j\u22121\n\n\u03b8i\u22121\n\nZ\n\nr sin \u03b8i d\u03c6 dr = \u03c0(r2j+1 \u2212 r2j\u22121 ) sin \u03b8i\n\nr j+1\n\nr j\u22121\n\n(39)\n\nr d\u03b8 dr = (\u03b8i+1 \u2212 \u03b8i\u22121 )(r2j+1 \u2212 r2j\u22121 )/2 . (40)\n\nlr\n\n= (r j+1 \u2212 r j\u22121 )\n\n(43)\n\nj)\nl(i,\n\u03b8\n(i, j)\nl\u03c6\n\n= r j (\u03b8i+1 \u2212 \u03b8i\u22121 )\n\n(44)\n\n= 2\u03c0r j sin \u03b8i .\n\n(45)\n\nExplicitly, the circulation of E f along the edge of each surface\n(i, j)\nS n is\nI\n(i+1, j) (i+1, j)\n(i\u22121, j) (i\u22121, j)\nE * dl = E\u03c6\nl\u03c6\n\u2212 E\u03c6\nl\u03c6\n(46)\n\u2202S r(i, j)\nI\nj+1)\nj\u22121)\nE * dl = \u2212E\u03c6(i, j+1) l(i,\n+ E\u03c6(i, j\u22121) l(i,\n(47)\n\u03c6\n\u03c6\n\u2202S \u03b8(i, j)\n\nI\n\n(i, j)\n\nj+1)\nj\u22121)\nE\u03b8(i, j+1) l(i,\n\u2212 E\u03b8(i, j\u22121) l(i,\n\u03b8\n\u03b8\n\nE * dl =\n\n\u2202S \u03c6\n\nj)\nj)\n\u2212Er(i+1, j) l(i+1,\n+ Er(i\u22121, j) l(i\u22121,\n.\nr\nr\n\n(48)\n\nIn Fig. 3 we show the location of the variables needed for the\nj)\nj)\nj)\ntime advance of B(i\u22121,\n, B(i+1,\n(red), and B(i,\n\u03c6\n\u03c6\n\u03c6 (green).\nWe also make use of Stokes' theorem to calculate the current\ncomponents at each node:\nI\n1\n(i, j)\nJn = (i, j)\nB * dl .\n\u2202S n(i, j)\nSn\nThen, the values of J (i, j) and B(i, j) directly provide E(i,f j) , as defined by Eq. (34). For each cell (i, j) the local divergence of B\nis defined as the net magnetic flux flowing across the surfaces\ndivided by the cell volume (fluxes through the toroidal surfaces\nS \u03c6 cancel due to axial symmetry):\n(i, j+1)\n\n\u2212 \u03a6r\n\n\u03b8i+1\n\nr j+1\n\n(\u2207 * B)(i, j) = [\u03a6r\n\n(i, j\u22121)\n\n(i+1, j)\n\n+ \u03a6\u03b8\n\n(i\u22121, j)\n\n\u2212 \u03a6\u03b8\n\n]/V (i, j) ,\n\n(49)\n\nwith\nV (i, j) =\n\nZ\n\n0\n\n2\u03c0\n\nZ\n\n\u03b8i\u22121\n\nZ\n\nr2 sin \u03b8 d\u03c6 d\u03b8 dr\n\nr j\u22121\n\n2\u03c0\n(cos \u03b8i\u22121 \u2212 cos \u03b8i+1 )(r3j+1 \u2212 r3j\u22121 ) .\n=\n3\n\n(50)\n\nThe numerical method ensures that the local divergence is conserved to machine accuracy by construction. As a matter of fact,\nEqs. (42) and (49) imply\n\" I\nI\nd(\u2207 * B)(i, j)\nE * dl\nE * dl +\n= \u2212\ndt\n\u2202S r(i, j\u22121)\n\u2202S r(i, j+1)\n\uf8f9\nI\nI\n\uf8fa\uf8fa\nE * dl\uf8fa\uf8fa\uf8fb .\nE * dl +\n\u2212\n(51)\nj)\n\u2202S (i+1,\n\u03b8\n\nj)\n\u2202S (i\u22121,\n\u03b8\n\n\fD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nAccording to Eqs. (46), the last equation is written as a sum\nof toroidal elements E\u03c6 l\u03c6 . They are evaluated twice at each of\nthe four surrounding edges (with center \u03b8i\u00b11 , r j\u00b11 ), with opposite sign, so they cancel exactly. Therefore, provided there is an\ninitial divergence-less field, it is guaranteed that the numerical\ndivergence defined by Eq. (49) remains zero to round-off level at\neach time step.\nWe must mention that we also tried a method with a staggered grid (Yee, 1966), in which each n-component of the magnetic field is defined only at the center of the normal surface,\nS n(i, j) , while the electric field components are defined in the middle of its delimiting edges. Methods based on staggered grid are\nwell-suited to solving Maxwell's equations, because it provides\na natural way to time-advance one field by means of the circulation of the other one. However, we are not dealing with the true\nMaxwell's equations, but rather with an artificial electric field,\nEq. (34). Evaluating the dot product J * B requires the interpolation between two or four values of several of the six mutually\ndisplaced components. Considering the red components in Fig.\nj)\n3, for instance, the calculation of Er(i+1, j) also requires B(i+1,\n,\n\u03c6\nwhich would be not defined at that location. The unavoidable\ninterpolation errors prevent the code from completely relax to\nE f = 0, except in the trivial case of untwisted configurations.\nFor this reason, we decided to work with a standard grid.\n\n3.4. Boundary conditions\n\nAt the polar axis, we impose the vanishing of all angular components of magnetic field and currents: B\u03b8 = B\u03c6 = J\u03b8 = J\u03c6 = E\u03b8 =\nE\u03c6 = 0 . At the surface, we have to fix the magnetic field components as provided by some interior solution. However, an arbitrary choice of poloidal and toroidal fields may not be compatible with a force-free solution. We decided to impose E f = 0, at\nthe surface, which is equivalent to keeping the value of the radial\ncomponent fixed at the surface, Br (1, \u03b8) and therefore to fixing\nthe angular dependence of the magnetic flux function, \u0393(1, \u03b8). As\na consequence, B\u03b8 and B\u03c6 are allowed to vary on the first radial\ngrid point.\nThe external boundary is set at r = rout . We have explored\ntwo different boundary conditions: E f (r \u2265 rout ) = 0 and the\ncontinuous matching to external vacuum solutions. The first\nchoice is equivalent to fix the radial component Br (rout , \u03b8), while\nallowing for B\u03b8 and B\u03c6 to evolve. Coupling to vacuum solutions can be done using the spectral Legendre decomposition\nof the radial field at the outer surface, or more precisely, of the\nmagnetic flux function, in terms of which the vacuum boundary condition for each multipole is easily imposed (e.g., as in\nPons & Geppert, 2007). Then we can reconstruct the angular dependence of B\u03b8 (rout , \u03b8). The vacuum region is characterized by\nB\u03c6 = 0 and the absence of currents or fictitious electric fields.\nThis implies that a current sheet J\u03b8 (rout ) , 0 is needed to ensure\ncurrent conservation.\nIf we choose E f = 0 as outer boundary condition, the\ncode can actually converge to E f \u2261 0 at a round-off level, because mathematically this is the only solution compatible with\n\u2207 \u00d7 E f = 0. The price to pay is a forced matching of the inner\nsolution with a fixed value of Br (rout ). In contrast, if we couple with vacuum, there is no guarantee that the final solution is\nE f = 0 everywhere. We discuss below the influence of the different boundary conditions on the results.\n\nrout\n5\n5\n10\n10\n100\n\nnr\n30\n50\n30\n50\n50\n\nn\u03b8\n30\n100\n30\n30\n30\n\n7\n\ntdis\n41\n35\n183\n162\n180 \u00d7 102\n\nTable 1. Time needed to dissipate the numerical currents of the\nvacuum dipole.\n\n3.5. Convergence criterion and tests\n\nSince the magneto-frictional method is based on introducing an\nartificial, viscous electric field that drives an arbitrary initial configuration into a force-free state, we need a convergence criterion\nto decide when our solutions are acceptable. For that purpose, we\nkeep track during the run of the following quantities:\n\u2013 Volume-integrated magnetic energy (total and contribution\nfrom the toroidal field)\nZ 2\nZ B2\nB\n\u03c6\nEb =\ndV, Eb\u03c6 =\ndV.\n2\n2\n\u2013 Volume-integrated energy stored in the fictitious electric\nfield\nZ E2\nf\nEe =\ndV.\n2\n\u2013 Total volume-integrated helicity\nZ\nB\u03c6 A\u03c6 dV\nH\u2261\nV\n\n(see Appendix A for a discussion about this definition).\n\u2013 Volume-integrated absolute value of the divergence of both,\nB and J. These two quantities are expected to vanish at\nround-off level by construction.\n\u2013 An average throughout the entire magnetosphere volume of\nthe local angle between current and magnetic field2\nP 2 2\nP\nJ sin \u03b7\nE* J\n2\nsin \u03b7\u0304 =\n= P 2 .\n(52)\nP 2\nJ\nJ\nwhere the sum is performed over each node (i, j).\n\u2013 A last important cross-check is the consistency of the functions I(\u0393) and \u03b1(\u0393). First, we check that, for each ncomponent, the three functions \u03b1n (r, \u03b8) = 4\u03c0Jn /cBn (r, \u03b8) are\nthe same. Second, at each radius or angle, the relation (9) has\nto be satisfied.\n\nHereafter, we show the electromagnetic quantities in units\nof B0 , r\u22c6 , c, so the magnetic field B scales with B0 , the current\ndensity J with cB0 /r\u22c6 , the enclosed current I with cB0r\u22c6 , and\nthe magnetic flux function \u0393 with \u03930 = B0 r\u22c62 /2. To test our code\nand to fix our convergence criteria for the realistic models, we\nperformed a battery of tests. In the first basic test we considered\nthe analytical vacuum dipole with A\u03c6 = B0 sin \u03b8/2r2 , B\u03c6 = 0\nand checked the ability of the code to maintain this solution.\nDue to the discretization errors, a little numerical toroidal current appears, and consequently a nonvanishing toroidal fictitious\nelectric field. These errors are small (\u2206Eb /Eb . 1%), but it is\n2\n\nThis average weighted with J 2 avoids numerical problems in regions where the numerical value of the current is very low and the angle\nsin2 \u03b7 = E * J/J 2 is numerically ill-defined.\n\n\f8\n\nD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n1\n10\n1e-05\n\n1\n0.1\n\u03b7 [deg]\n\nEe / Eb\u03c6\n\n1e-10\n1e-15\n1e-20\n1e-25\n1e-30\n0.001\n\n0.1\n1\n10\nNumerical time\n\n0.001\n0.0001\n\nE=0 r=100\nE=0 r= 10\nvac. r= 10\ns.-s. r= 10\nbes r= 10\n0.01\n\n0.01\n\n1e-05\n1e-06\n100\n\n1000\n\n1e-07\n0.001\n\n0.01\n\n0.1\n1\n10\nNumerical time\n\n100\n\n1000\n\nFig. 4. Influence of the outer boundary condition and the location of the external boundary on the evolution of the ratio Ee /Eb\u03c6 (left)\nand \u03b7\u0304 (right).\n\nFig. 5. Current density distribution J near the surface for solutions obtained with the same initial data and boundary conditions,\nE f = 0, but varying rout = 5, 10, 50, 100 (left to right).\ninteresting to see how long it takes to dissipate the perturbation\nto obtain Ee = 0 to machine accuracy. In Table 1 we show the\nresults with different resolutions and values of outer radius, always keeping the timestep close to the maximum value allowed\n2\nby the Courant condition. The expected behavior tdis \u223c rout\nis\nobtained, with the constant of proportionality depending on the\ngrid resolution, which affects the strength of the initial numerical\ncurrent.\nThe second, less trivial test is provided by the analytical\nmodels discussed above: the Bessel and self-similar solutions\n(Sect. 2.2, Sect. 2.3). Again we began with an initial model consisting of a known solution, and let the system dissipate the currents that come from discretization errors. To obtain the initial\nmodels, the self-similar solutions require the numerical resolution of the nonlinear ODE (24), while the analytical Bessel solutions are directly implemented. We tried different parameters for\nthe Bessel solutions (varying k) and self-similar models (varying the multipole index and the global twist). For every model\ntested with analytical solutions, we observe a very slight numerical readjustment of the configuration and the code rapidly\nreaches the relaxed state, with relative changes in Eb , Eb\u03c6 , H\nless than \u223c 1%. We had to pay special attention to work with\nsufficient radial resolution in the case of highly twisted Bessel\nmodels k & 1, due to their oscillatory radial dependence. For low\nresolution, the code may find, after a large scale reconfiguration,\na completely different solution with smaller k, which is numeri-\n\ncally more stable. If the resolution is high enough, all analytical\nsolutions are found to be stable.\nWe have also studied the evolution of vacuum dipolar solutions with an additional toroidal field for different values of rout .\nIn this case the initial currents are due not only to discretization errors, but also to an inconsistency in the initial model.\nMoreover, the mean angle defined in Eq. (52) initially has a finite value \u03b7\u0304in . In Fig. 4 we show how some convergence monitors evolve as a function of time for three cases with an initial\ntoroidal field of the form B\u03c6 = 0.1B0 sin \u03b8/r3 (\u03b7\u0304in = 15.1\u25e6), but\ndifferent external boundary conditions: matching with vacuum\nat rout = 10 or imposing E f = 0 at rout = 10 or 100. For comparison, we also show results for two analytical solutions: a Bessel\nsolution and a twisted self-similar model with the same helicity.\nFinally, we tested a vacuum dipole perturbed by a weak\ntoroidal field. This is a case of physical interest for quasi periodic oscillations of magnetars, as discussed in Timokhin et al.\n(2008) and Gabler et al. (2011). Given a background poloidal\nfield described by \u0393, we chose an arbitrary functional form I(\u0393)\nand built the toroidal field according to Eq. (5). As expected,\nthe perturbed configuration is stable and the stationary solution is rapidly reached after a small readjustment. Typically, for\nmax(B\u03c6 ) = 0.1 B0, we have \u03b7\u0304in \u223c O(1\u25e6 ) and changes \u2206B/B \u223c\n1%.\nIn general, the magnetic energy is not conserved, since the\nsystem has to dissipate part of the current to reach a force-free\nconfiguration. This effect is more evident for initial configu-\n\n\fD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\nModel\nS1\nS2\nA\nB\nC\nD\nE\nF\nG\n\nH\n[B20r\u22c63 ]\n0.21\n1.11\n0.021\n0.21\n1.11\n0.21\n0.21\n0.21\n0.21\n\n\u2206\u03c6max\n[rad]\n0.5\n1.6\n0.12\n1.2\n6.5\n0.7\n0.4\n0.4\n0.3\n\nmax(J)\n[cB0 /r\u22c6 ]\n1.8 \u00d7 10\u22122\n8.1 \u00d7 10\u22122\n1.2 \u00d7 10\u22123\n1.2 \u00d7 10\u22122\n4.8 \u00d7 10\u22122\n1.5 \u00d7 10\u22122\n4.2 \u00d7 10\u22122\n4.3 \u00d7 10\u22122\n2.0 \u00d7 10\u22122\n\n9\nI0\n[cB0 r\u22c6 ]\n0.061\n0.15\n0.0050\n0.049\n...\n0.056\n0.106\n...\n0.038\n\np\n0.97\n0.69\n1.45\n1.40\n...\n1.14\n0.50\n...\n2.22\n\nTable 3. Comparison between two self-similar solutions (S1-S2)\nand our numerical solutions (A-G).\n\n4. Results\nWith the numerical code described above, we can obtain very\ngeneral solutions of force-free, twisted magnetospheres. We discuss separately the influence of the following relevant parameters:\n\nFig. 6. Enclosed current I(\u0393) for different boundary conditions\n(E f = 0 or coupled with vacuum) at rout = 5, 10, 50, or 100.\nModel\nA\nB\nC\nD\nE\nF\nG\n\nktor\n0.010\n0.100\n0.500\n0.115\n0.230\n0.234\n0.113\n\ngin (r)\nr\u22123\nr\u22123\nr\u22123\nr\u22123\nr\u22125\nr\u22123 e\u2212[(r\u22121)/0.5]\nr\u22123\n\n2\n\nFin (\u03b8)\nsin \u03b8\nsin \u03b8\nsin \u03b8\nsin2 \u03b8\nsin2 \u03b8\nsin2 \u03b8\nsin2 \u03b8\n\n\u03b7\u0304in [deg]\n13.8\n15.1\n29.9\n10.7\n25.1\n23.3\n34.2\n\nTable 2. Parameters defining the initial toroidal field, as indicated in Eq. (53).\n\nrations with high helicity. When the outer boundary condition\nE f = 0 is imposed, the helicity is conserved within a few percent, as expected (see Appendix A for the helicity conservation\ntheorem), and both electric field and mean angle eventually vanish (to machine accuracy). However, when rout is large, or when\nvacuum boundary conditions are imposed, configurations with\nhigh initial helicity take a much longer time to relax (see Fig.\n4). In all cases, the relaxation process is faster near the surface,\nwhere the configuration of the magnetosphere is more important\nfor our purposes.\nOn the basis of these results, our convergence criteria for accepting that a configuration has reached a force-free state are\nhereafter Ee /Eb\u03c6 < 10\u22128 and \u03b7\u0304 < 10\u22123 \u25e6 , plus the requirement that both quantities are monotonically decreasing with\ntime. Some short, initial relaxation phase, in which some largescale reconfiguration occurs is possible. We chose to compare\nthe electric energy to the magnetic energy contribution from the\ntoroidal field, which is much more restrictive than simply the\nratio of electric to magnetic energy, especially for low helicity.\n\n\u2013 the location of the outer radius rout in combination with the\nexternal boundary condition;\n\u2013 angular and radial dependence of the initial toroidal field;\n\u2013 initial twist and helicity, fixed by the functional form and the\nstrength of the initial toroidal field;\n\u2013 the geometry of the initial poloidal field.\nIn Fig. 5 we compare the distribution of currents in a solution\nobtained by imposing E f = 0 at rout = 5, 10, 50, or 100. In\nall cases the initial poloidal component is a vacuum dipole solution with A\u03c6 = B0 sin \u03b8/r2 and a toroidal field of the form\nB\u03c6 = 0.1B0 sin \u03b8/r3 . We observe that, near the axis, the solutions\nare clearly affected by the location of the external boundary, if\nit is not far enough from the surface (rout . 10). In such a case,\nthe influence of the external boundary is important, and it introduces artificial features, although the current distribution in the\nequatorial region is similar in all cases. The final configurations\nbecome almost indistinguishable when rout = 50 or 100. Taking\nrout & 100, we ensure that the numerical noise caused by the interaction with the external boundary is negligible. By neglecting\nthe contribution from the open field lines, for which the twist is\nill-defined, the global amount of twist is similar in all models\n(\u223c 1.2 rad).\nThe function I(\u0393) for the same four cases is shown in Fig.\n6, together with two more cases corresponding to rout = 5 and\nrout = 100 but replacing the external boundary condition E f = 0\nby a smooth matching with vacuum solutions. The use of a different boundary condition affects the final solution only for low\nvalues of rout . Matching with external vacuum implies that no\ncurrents can flow through the boundary, so that I(\u0393) = \u03b1(\u0393) = 0\nalong every field line crossing the outer boundary. As a consequence, a force-free configuration, coupled with a vacuum, will\nbe characterized by a plateaux I(\u0393) = 0 for \u0393 < \u0393c , with \u0393c labeling the first closed field line. This means that a bundle of open\nfield lines is potential. The fraction of open field lines (the length\nof the plateaux for low \u0393) is large only for low values of rout .\nFor \u0393 > 0.2 (equatorial region), all curves coincide. Increasing\nrout > 100 further has no visible effect on the models with this\nhelicity. For models with higher helicity, the interaction with the\nboundary becomes more important, and rout needs to be accordingly increased to minimize the boundary effects.\n\n\f10\n\nD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nFig. 7. Self-similar model S2. From left to right: poloidal magnetic field lines (white) and strength of the toroidal component (colored\nlogarithmic scale); current density distribution J in the near region (r \u2264 5) (colored linear scale); angular profiles of the magnetic\nfield components close to the star surface, and angular profiles of the current density.\n\nFig. 8. Same as Fig. 7 for model A.\n\nFig. 9. Same as Fig. 7 for model B.\nThe next step is to explore the influence of the strength and\nform of the initial toroidal field. Table 2 summarizes the parameters of the initial models employed and the initial mean angle\nbetween B and J, Eq. (52). Models A-F are obtained starting\nfrom a dipolar poloidal component with strength at pole B0 and\na toroidal component given by the general form\nBin\n\u03c6 = ktor B0 gin (r) fin (\u03b8) .\n\n(53)\n\nThe angular part is chosen to be of the form fin (\u03b8) = sind \u03b8, with\nd being a positive integer. The radial dependence of models A to\nE is a power law, gin (r) = r\u2212s , while in model F we use a rapidly\ndecaying function:\n2\n\ngin (r) = r\u22123 e\u2212[(r\u22121)/0.5] .\n\n(54)\n\nThe initial configuration of model G is asymmetric with respect\nto the equator: it is a superposition of dipolar and quadrupolar\npoloidal components plus a toroidal component, as follows:\nB0 sin \u03b8 B0 sin \u03b8 cos \u03b8\n+\n,\n2 r2\n2\nr3\nsin \u03b8\nB\u03c6 = 0.1B0 3 .\nr\n\nA\u03c6 =\n\n(55)\n\nWe fix rout = 100 and the external boundary condition to\nE f (rout ) = 0 for all models, except for model C (highest helicity), where rout = 500 to reduce the influence of boundary, as\ndiscussed before.\nTable 3 shows the features of our final configurations: helicity, maximum line twist, maximum value of current density,\n\n\fD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nFig. 10. Same as Fig. 7 for model C.\n\nFig. 11. Same as Fig. 7 for model D.\n\nFig. 12. Same as Fig. 7 for model E.\n\nFig. 13. Same as Fig. 7 for model F.\n\n11\n\n\f12\n\nD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nFig. 14. Same as Fig. 7 for model G.\nand parameters of I(\u0393) = I0 (\u0393/\u03930 )1+1/p . We also include (model\nS1 and S2) two self-similar solutions (Sect. 2.3) of similar helicity, where all components have the same radial dependence\nBi \u223c r\u2212(p+2) . In this case the current function is analytical,\nI = I0 (\u0393/\u03930 )1+1/p with (p, I0 ) belonging to the family of solutions in Fig. 2. In the other cases I0 and p are obtained with fits\nto the numerical function.\nThe final geometry of the magnetic field and currents for all\nthese models is shown in Figs. 7 to 14. For ktor . 0.1 (models A and B), the initial poloidal field remains almost unaltered,\nand the behavior of the solutions is nearly linear. Toroidal field\nstrength, helicity, current density J, enclosed current function\nI(\u0393), and global twist scale linearly with ktor . In contrast, for\nktor & 0.1, the high initial helicity results in a larger twist angle,\nup to several radians, which in turn corresponds to a highly deformed poloidal field. A direct comparison of models A, B and\nC, which differ from each other only in the strength of the initial\ntoroidal component, illustrates this effect: models A and B have\nthe same shape with just a different scale factor, but model C is\nqualitatively different.\nThe general features in the low ktor models do not differ\nmuch from self-similar solutions, because the initial conditions\nwere close to a slightly twisted dipole. In self-similar models,\ntwo features are the absence of radial currents on the axis and\na higher concentration of currents around the equatorial plane.\nConversely, in our models, currents are spread more over the angular direction, and we allow for the existence of radial current\non the axis. As a consequence, comparing numerical solutions\nA and B with self-similar models with comparable helicity, the\nformer reaches lower maximum values of current density with a\nhigher global twist. We also note that in the most extreme case\n(model C) the angular dependence of the toroidal field and radial currents becomes steeper.3 It is also interesting to compare\nmodels C and S2 (Figs. 10 and 7). Both have a similar helicity,\nbut the global twist is higher in model C, while the maximum\ncurrent density is higher in model S2.\nComparing models B and D, which only differ in the angular\ndependence of the initial data and the normalization (fixed to obtain the same helicity), we find that the converged solutions are\nvery similar, except near the axis where model D has no radial\ncurrents. The effect of varying the initial radial dependence can\nbe estimated by comparing model D to model E. It seems that\nin this case the final solution keeps memory of the initial model:\n3\n\nIn some cases it approaches the formation of a current sheet near the\nequatorial plane, and this introduces numerical noise that does not allow\nreaching a smooth solution or calculating the twist angle accurately.\n\nthe converged solution shows a toroidal field that decreases with\ndistance faster in the model E than in model D.\nIn model E a tiny toroidal field (note the color scale in the\nfigures) appears near the axis. This is likely a numerical artifact\nthat can be partly ascribed to the (narrow) bundle of lines that\ndepart from polar region and interact with the outer boundary.\nAs a matter of fact, these structures are stronger for low values\nof rout , as already shown in Fig. 5. Moreover, the numerical dissipation of the current is slower near the axis and longer runs are\nneeded to reach more restrictive convergence criteria.\nThe different radial dependences of the magnetic field components in models B, E and F, together with S1, are shown in\nFig. 15. The self-similar solution has the same radial dependence\nr\u2212(p+2) for the three components, but in the numerical solutions\nthe toroidal field can decrease faster (model E and F) or slower\n(model B) than the poloidal components. Furthermore, the radial\nbehavior may depend on the magnetic colatitude \u03b8, too. In addition, the radial dependence of the poloidal components is close\nto the power law r\u22123 when the twist is low, but it may significantly deviate from a power law for the more complex models.\nThe departure from self-similar solutions is likely to have a visible effect on the observed spectrum, as discussed in more detail\nin the next section.\nA different solution that can only be found numerically is\nmodel G, the asymmetric configuration. Most of the current density is concentrated at a high latitude \u03b8m .\nAn interesting case (not shown) consists of an initial model\nwith toroidal and poloidal fields of opposite parity (e.g. a dipolar\npoloidal field plus a quadrupolar toroidal field). In this case, the\ntotal initial helicity is zero and, since this is a conserved quantity,\nthe current is dissipated and a potential solution is found by the\nnumerical code. This is consistent with the fact that the numerical evolution converges towards the most trivial solution with\nthe same helicity.\nFinally, to better understand the differences among models,\na comparison between the enclosed current function I(\u0393) is very\nhelpful, as shown in Fig. 16. In principle, if we know this function or an approximation fits the results of numerical simulations, the pulsar equation (Eq. 7) can be solved and the magnetospheric structure can be determined. In our models A, B, D,\nE, G, the current I(\u0393) is monotonic and can be well fitted by a\nsingle power law I0 (\u0393/\u03930 )1+1/p , but the values obtained for the\nparameter p are not consistent with the value of I0 describing the\nself-similar family of solutions (Fig. 2), as expected. As a matter of fact, for models A, B, D, the values of p are greater than\n1 (the self-similar dipolar family is described by p \u2208 [0, 1]). In\ncontrast, model E lies quite close to the self-similar solution. The\n\n\fD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\n13\n\nFig. 16. I(\u0393) for different models. The curve of model A is magnified by a factor of 10.\n\nFig. 15. Radial profiles of the magnetic field components for\nmodels S1, B (top), E and F (bottom). We show Br on the axis\nand B\u03b8 , B\u03c6 at the equator for r \u2208 [1, 30].\n\nenclosed current of models C and E varies more rapidly, describing the concentration of currents in a smaller angular region. For\nsome models, a power-law fit to I(\u0393) simply does not work. In\nmodel G, even if the symmetry with respect to the equatorial\nplane is broken, the resulting enclosed current I(\u0393) is not very\ndifferent from models A, B, D, and S1 (after rescaling accordingly to the factor ktor ). The difference is the mapping between\n\u0393 and the surface footprints. In all symmetric models, the maximum magnetic flux (proportional to \u0393) is located at the equator,\nwhile it corresponds to \u03b8m , \u03c0/2 for model G. Depending on the\nviewing angle, this has a strong imprint on the processed spectra.\n4.1. Resonant optical depth\n\nA prime candidate mechanism for generating the hard tail component observed in magnetar X-ray spectra is the resonant\nCompton upscattering of photons in an external magnetic field.\nWe denote the cyclotron frequency by \u03c9B = ZeB/mc, where Ze\nand m are the charge and mass of the particle. For electrons, this\ncorresponds to an energy ~\u03c9B = 11.6(B/1012 G) keV. In the Xray band, the plasma frequency is much lower than the photon\nfrequency, thus taking the polarization vector orthogonal to the\npropagation direction k\u0302 (semitransverse approximation) works\nwell (see Canuto et al. (1971) and Ventura (1979)). The normal\nmodes of propagation are in general elliptically polarized and the\ndegree of ellipticity depends on the ratio \u03c9/\u03c9B and \u03b8kB , defined\n\nas the the angle between k\u0302 and B. It is common to introduce\nthe ordinary (O) and extraordinary (X) modes. In the limit of\npropagation perpendicular to the magnetic field (\u03b8kB = \u03c0/2), the\nmodes are linearly polarized, with the polarization vector parallel (O-mode) or orthogonal (X-mode) to B. For parallel propagation (\u03b8kB = 0), we recover the circularly polarized modes.\nThe cross section of O and E modes depends in a nontrivial\nway on \u03b8kB , and on the ratio \u03c9/\u03c9B . The cross section of the Omode is close to the Thomson cross section \u03c3T for \u03b8kB near to\n\u03c0/2, it scales with sin2 \u03b8kB if \u03c9 \u226a \u03c9B , and it does not depend\ndramatically on the frequency. Conversely, for low photon energies ~\u03c9 \u226a ~\u03c9B , the cross section of the X-mode is strongly suppressed due to the reduced mobility of charged particles across\nmagnetic field lines. Moreover, at photon frequency \u03c9 = \u03c9B ,\nthe X-mode becomes resonant (Ventura, 1979). If we neglect\nthe thermal velocity of the particles (cold plasma approximation)\nand the natural width of resonance due to the radiation-damping\nforce, the resonant cross section can be approximated by a delta\nfunction:\n\u03c3res = \u03c02 (1 + cos2 \u03b8kB )\n\n(Ze)2\n\u03b4(\u03c9 \u2212 \u03c9B )\nmc\n\n(56)\n\nwhere the factor (1 + cos2 \u03b8kB ) arises from the assumption of\nunpolarized light. The first attempts to consider this process\nquantitatively in magnetars are presented by Lyutikov & Gavriil\n(2006). They study a simplified, semi-analytical 1-D model by\nassuming that seed photons are radially emitted from the NS surface with a blackbody spectrum (BB) and the resonant Compton\nscattering occurs in a thin, plane parallel magnetospheric slab.\nBy assuming a bulk velocity of electrons, but neglecting all effects of their recoil (Thomson limit ~\u03c9B \u226a me c2 /\u03b3, where \u03b3\nis the Lorentz factor of electrons), it can be estimated how a\nBB spectra is affected. Lyutikov & Gavriil (2006) find an average upscattering for the transmitted radiation (forward scattered\nphotons), while the mean energy of the reflected radiation remains the same. Later, Nobili et al. (2008a,b) predicted spectra\nobtained via a new 3-D Monte Carlo code, accounting for polarization, QED effects, and relativistic cross sections. Although including our magnetospheric models in such sophisticated Monte\nCarlo simulations is beyond the scope of this paper, we can estimate some of the possible effects by looking at the behavior of\nrelevant quantities.\n\n\f14\n\nD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nIn particular, we can estimate the resonant optical depth,\ngiven by the integration of Eq. (56) along a given line of sight of\nconstant \u03b8 (Lyutikov & Gavriil, 2006):\n\u03c4res (\u03b8) = \u03c02 nZ Ze(1 + cos2 \u03b8kB )\n\ndB\ndr\n\n\u22121\n\n(57)\n\nwhere nZ is the density of scatterer particles, and all the quantities are evaluated at the resonant radius rres . As the latter depends\non the photon energy, the energy dependence of the optical depth\nis given basically by the local ratio (1+cos2 \u03b8kB )nZ /|dB/dr| (provided that rres lies above the star surface). If we assume charge\nseparation, the particle density is proportional to the current density, J = \u03bacnZ Ze. The dimensionless factor \u03ba depends locally on\nthe plasma composition and on the (bulk and/or thermal) velocity of the particles. Following Thompson et al. (2002) and\nNobili et al. (2008a), we can (very roughly) estimate the optical depth along a line of sight (assuming \u03ba constant along it),\nand considering only radially directed photons:\n!\nB2r dB \u22121\n2J\n\u03ba\u03c4res (\u03b8) = \u03c0\n1+ 2\n.\n(58)\nc\ndr\nB\nIf we consider self-similar magnetosphere models under\nthese naive assumptions, the optical depth becomes independent\nof rres , hence, independent of where the scattering happens. This\nis because the local ratio (1 + cos2 \u03b8kB )J/|dB/dr| is the same\nfor each angle, since for every component i, Bi \u221d r\u2212p+2 , and\nJi \u221d r\u2212p+3 . Furthermore, the optical depth does not depend on\nthe normalization of the magnetic field, B0 .\nIn contrast, the optical depth in our numerical models depends on the photon energy, because the components of J and\nB cannot be described by the same power law. In Fig. 17 we\nshow the estimated resonant optical depth, Eq. (58), for our models, compared with the self-similar model S1. We plot \u03ba\u03c4res as a\nfunction of the polar angle \u03b8, for different energies of the seed\nphotons, ~\u03c9 = 0.5, 1, 2, 4, 8 keV, taking B0 = 1013 G. If the magnetic field is predominantly poloidal (low helicity), the optical\ndepth is roughly given by the ratio between toroidal field (which\nprovides poloidal current) and poloidal field at the resonant radius. Increasing the photon energy, the resonant radius will be\ncloser to the surface, modifying the estimate of J and dB/dr\nwhich are involved in Eq. (58). Thus, if the toroidal field decays\nslower than the poloidal component, a higher photon energy implies a lower ratio J/|dB/dr| at the resonant radius. Looking at\nthe radial profiles (Fig. 15), we can understand why the optical\ndepth increases with the photon energy for models E and F, while\nfor other models the optical depth is greater for soft photons. A\nmore precise prediction of how the spectrum is modified when\nusing one or another magnetosphere model requires more elaborated calculations than those presented here. We also point out\nthat, due to the linear relation between B and \u03c9B , increasing the\nenergy is equivalent to decreasing the normalization B0 by the\nsame factor.\n\n5. Conclusions\nThe study of force-free magnetosphere models from an analytical or semi-analytical point of view have led to remarkable\nresults in a few cases. In the literature, the twisted configurations usually implemented in the modeling of synthetic spectra\nare often based on the self-similar solutions by Thompson et al.\n(2002), which are restricted to a twisted dipole or to a single higher multipole (Pavan et al., 2009). Since semi-analytical\n\nstudies of a general combination of multipoles are more difficult due to the nonlinear character of the equations, we faced\nthe problem by constructing and thoroughly testing a numerical\ncode that relaxes an arbitrary initial model to a force-free solution with given boundary conditions. With our numerical simulations we can find general solutions of twisted magnetospheres\nwith complex geometries. Our only input is the radial field at\nthe surface, which can be completely general (i.e. provided by\nnumerical simulations of the internal evolution).\nOur main conclusion is that the possible family of relaxed\nconfigurations depends on the initial data. As already pointed out\nby Contopoulos et al. (2011) in a different context, the solution\nis not unique, given the surface radial magnetic field and the\nouter boundary conditions. This reflects the freedom we have in\nchoosing the enclosed current function I(\u0393), for a given \u0393(\u03b8) at\nthe surface. Starting with two different configurations with the\nsame value of volume-integrated helicity does not necessarily\nlead to the same final configuration. Thus we were able to find\na variety of solutions, which can be qualitatively different from\nthe self-similar models.\nSome of the new magnetosphere models that we found are\ncharacterized by a high degree of nonlinearity, twists up to a few\nradians, and a nontrivial functional form of the threading current\nI(\u0393). These models establish a new basis for generalizing the\nstudy of radiation transfer in neutron star magnetospheres, as already extensively done with the self-similar models (Rea et al.,\n2008, Fern\u00e1ndez & Thompson, 2007, Zane et al., 2009). In particular, our approach provides a more general framework for\nstudying how the geometry of the magnetic field and currents\naffects the output X-ray spectrum of a magnetar. If resonant\nCompton scattering is a crucial ingredient in forming the spectra,\nrelaxing the self-similarity constraint in the models may have a\nsignificant effect, as our preliminary estimates of optical depths\nhave shown. This opens the possibility of implementing alternative models in simulations of radiative transfer. In the future we\naim at providing spectra to be compared with observations.\nAcknowledgements. We are grateful to P. Cerd\u00e1-Dur\u00e1n, M. Gabler, and\nT. Akg\u00fcn for interesting discussions and comments. This work was partly supported by CompStar, a Research Networking Program of the European Science\nFoundation and the Spanish grant AYA 2010-21097-C03-02. D. Vigan\u00f2 is supported by a fellowship from the Prometeo program for research groups of excellence of the Generalitat Valenciana.\n\nReferences\nBeloborodov, A. M. & Thompson, C. 2007, ApJ, 657, 967\nCanuto, V., Lodenquai, J., & Ruderman, M. 1971, Phys. Rev. D, 3, 2303\nChiu, Y. T. & Hilton, H. H. 1977, ApJ, 212, 873\nContopoulos, I., Kalapotharakos, C., & Georgoulis, M. K. 2011, Sol. Phys., 269,\n351\nContopoulos, I., Kazanas, D., & Fendt, C. 1999, ApJ, 511, 351\nDuncan, R. C. & Thompson, C. 1992, ApJ, 392, L9\nFern\u00e1ndez, R. & Davis, S. W. 2011, ApJ, 730, 131\nFern\u00e1ndez, R. & Thompson, C. 2007, ApJ, 660, 615\nGabler, M., Cerd\u00e1 Dur\u00e1n, P., Font, J. A., M\u00fcller, E., & Stergioulas, N. 2011,\nMNRAS, 410, L37\nGaunt, J. A. 1930, Royal Society of London Philosophical Transactions Series\nA, 229, 163\nGoldreich, P. & Julian, W. H. 1969, ApJ, 157, 869\nGruzinov, A. 2005, Physical Review Letters, 94, 021101\nKalapotharakos, C. & Contopoulos, I. 2009, A&A, 496, 495\nLow, B. C. & Lou, Y. Q. 1990, ApJ, 352, 343\nLyutikov, M. & Gavriil, F. P. 2006, MNRAS, 368, 690\nMereghetti, S. 2008, A&A Rev., 15, 225\nMichel, F. C. 1973a, ApJ, 180, 207\nMichel, F. C. 1973b, ApJ, 180, L133+\nMichel, F. C. 1980, Ap&SS, 72, 175\nNobili, L., Turolla, R., & Zane, S. 2008a, MNRAS, 386, 1527\n\n\fD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\n15\n\nFig. 17. Estimated resonant optical depth (multiplied by the microphysical factor \u03ba) for radial photons as a function of the polar\nangle \u03b8. We show results for models S1, A, B, C (first row), D, E, F, G (second row) for different photon energies as indicated in the\nlegend. We set B0 = 1013 G.\nNobili, L., Turolla, R., & Zane, S. 2008b, MNRAS, 389, 989\nPavan, L., Turolla, R., Zane, S., & Nobili, L. 2009, MNRAS, 395, 753\nPons, J. A. & Geppert, U. 2007, A&A, 470, 303\nRea, N. & Esposito, P. 2011, in High-Energy Emission from Pulsars and their\nSystems, ed. D. F. Torres & N. Rea, 247\u2013+\nRea, N., Zane, S., Turolla, R., Lyutikov, M., & G\u00f6tz, D. 2008, ApJ, 686, 1245\nRoumeliotis, G., Sturrock, P. A., & Antiochos, S. K. 1994, ApJ, 423, 847\nScharlemann, E. T. & Wagoner, R. V. 1973, ApJ, 182, 951\nSeehafer, N. 1978, Sol. Phys., 58, 215\nSpitkovsky, A. 2006, ApJ, 648, L51\nTaflove, A. & Brodwin, M. E. 1975, IEEE Trans. Microwave Theory and\nTechniques, 23, 623\nThompson, C. & Duncan, R. C. 1996, ApJ, 473, 322\nThompson, C., Lyutikov, M., & Kulkarni, S. R. 2002, ApJ, 574, 332\nTimokhin, A. N., Eichler, D., & Lyubarsky, Y. 2008, ApJ, 680, 1398\nVentura, J. 1979, Phys. Rev. D, 19, 1684\nWolfson, R. 1995, ApJ, 443, 810\nYang, W. H., Sturrock, P. A., & Antiochos, S. K. 1986, ApJ, 309, 383\nYee, K. S. 1966, IEEE Trans. on Antennas and Propagat., 302\nZane, S., Rea, N., Turolla, R., & Nobili, L. 2009, MNRAS, 398, 1403\n\nAppendix A: Magnetic helicity\n\nsymmetry (no \u03c6-dependence), the following definition of helicity\nZ\nH\u2261\nA\u03c6 B\u03c6 dV\n(A.2)\nR\nis gauge-independent because H \u2192 H + B\u03c6 \u2207\u03c6 \u03a8 = H. We\nhave employed this definition of helicity in numerical code. It\ncan also be shown that this quantity is conserved during the evolution. Taking the time derivative (denoted by \u2202t ) and using the\ninduction equation, we have\nZ\nZ\n\u2202t H =\nA\u03c6 (\u2202t B\u03c6 )dV + (\u2202t A\u03c6 )B\u03c6 dV =\nZ\nZ\n= \u2212 A\u03c6 \u03c6\u0302 * (\u2207 \u00d7 E)dV \u2212\nE\u03c6 B\u03c6dV =\nZ\nZ h\ni\n\u2207 * (A\u03c6 \u03c6\u0302 \u00d7 E) \u2212 E * \u2207 \u00d7 (A\u03c6 \u03c6\u0302) dV \u2212\nE\u03c6 B\u03c6 dV =\n=\nZ\nI\n(A\u03c6 \u03c6\u0302 \u00d7 E) * dS \u2212 (E * B)dV .\n(A.3)\n=\n\u2202V\n\nFor a given magnetic field configuration, the usual definition of\nmagnetic helicity\nZ\nH \u2261 ( A * B)dV\n(A.1)\nis not unique due to the gauge freedom in the vector potential,\nA \u2192 A + \u2207\u03a8, where \u03a8 is a scalar function. However, in axial\n\nIf the poloidal electric field vanishes at the boundaries, the total\nhelicity is conserved.\nWith the definition (A.2), the explicit expression of the magnetic helicity for self-similar models (Sect. 2.3) is\nZ\n\u03c0\nk\nF(\u03bc)2+1/p\nH = B20\nd\u03bc,\n(A.4)\n4 p+1\n1 \u2212 \u03bc2\n\n\f16\n\nD. Vigan\u00f2, J.A. Pons & J.A. Miralles: Force-free twisted magnetospheres of Neutron Stars\n\nand for a dipolar Bessel model (Sect. 2.2) we have\nZ\nZ \u221e\n4\nkB20 Y1 (x)2 sin2 \u03b8dV = kB20\nH=\nY1 (x)2 dx .\n3\nV\nk\n\n(A.5)\n\nAppendix B: A nontrivial semi-analytical\nconfiguration\n\n2 (\u2212)(s\u2212b\u2212w)\n\nHere we show the derivation of Eq. (29) in Sect. 2.4. Substituting\n\u03b1 = rk\u22c6 |\u0393/\u03930 |1/2 in Eq. (15), with \u0393 given by Eq. (11), leads to\n\"\n#\nl(l + 1) d2 (ral (r))\nal (r)\n\u2212 l(l + 1)\n=\n2l + 1\ndr2\nr\n!2\nZ 1\nk2 1\ndPl (\u03bc) \u0393\n\u2212\nsgn(\u0393)d\u03bc .\n(B.1)\n3 r\u22c6 \u22121 d\u03bc\n\u03930\nThe integral at the righthand side can be written as\nZ 1\n1\ndPl (\u03bc) 2\n1\n\u0393 sgn(\u0393)d\u03bc = 2 [\u03932 sgn(\u0393)Pl (\u03bc)]1\u22121 +\nI = 2\n\u03930 \u22121 d\u03bc\n\u03930\n\"Z 1\n#\nZ 1\n2\nd\u0393\nd\u0393\n2\n\u2212 2\n\u0393 \u03b4(\u0393) Pl (\u03bc)d\u03bc ,\n\u0393 sgn(\u0393)Pl (\u03bc)d\u03bc +\nd\u03bc\n\u03930 \u22121 d\u03bc\n\u22121\nwhere the third term comes from sgn\u2032 (x) = 2\u03b4(x). The first and\nthird terms in this equation are zero. Next, we assume by simplicity that \u0393 \u2265 0 in the whole domain, so that sgn(\u0393) \u2261 1, and\nwe define the dimensionless radial functions fm (r) = am (r)r/r\u22c6 .\nHereafter we drop the dependences on \u03bc, r, and the integration\nlimits for conciseness. Using the Legendre equation we obtain\nfrom Eq. (11)\nX\nd\u0393\nn(n + 1) fn Pn ,\n(B.2)\n= \u2212\u03930\nd\u03bc\nn\nand we can express the integral I in a more compact form\nZ\n\u221e\n\u221e\nX\nX\ndPm\nPn =\n(B.3)\nI = 2\nfm (1 \u2212 \u03bc2 )Pl\nn(n + 1) fn\nd\u03bc\nm=1\nn=1\n\"Z\n#\nZ\n\u221e\nX\n2m(m + 1)\n=\nn(n + 1) fm fn\nPl Pm\u22121 Pn \u2212\nPl Pm+1 Pn ,\n2m + 1\nm,n=1\nwhere we have also used the recurrence relations between\nLegendre polynomials. Finally, the ODE (15) for each fl (r) is\n!2 X\n\u221e\nfl\nk\nd2 fl\n\u2212\nl(l\n+\n1)\n=\n\u2212\nfm fn glmn ,\n(B.4)\nr\u22c6 m,n=1\ndr2\nr2\nwhere\nglmn =\n\n2 2l + 1 m(m + 1)\nn(n + 1)\n3 2m + 1 l(l + 1)\n\n\"Z\n\nPl Pm\u22121 Pn \u2212\n\nThese integrals can be evaluated analytically using Gaunt's formula (Gaunt, 1930)\nZ\nI3 =\nPua Pvb Pwc =\n\nZ\n\n#\nPl Pm+1 Pn .\n\nThe integral of the product of three Legendre polynomials can\nbe expressed by Wigner 3 \u2212 j symbols:\n!2\nZ\na b c\nPa Pb Pc =\n.\n(B.5)\n0 0 0\nAlternatively, we can express the factors above in terms of associated Legendre polynomials:\n\"Z\n#\nZ\n2 n(n + 1)\n1\n1 0\n1\n1 0\nglmn =\nPl+1 Pm Pn \u2212\nPl\u22121 Pm Pn .\n(B.6)\n3 l(l + 1)\n\nq\nX\n\u00d7 (\u2212)t\nt=p\n\n(b + v)!(c + w)!(2s \u2212 2c)!s!\n\u00d7\n(b \u2212 v)!(s \u2212 a)!(s \u2212 b)!(s \u2212 c)!(2s + 1)!\n\n(a + u + t)!(b + c \u2212 u \u2212 t)!\nt!(a \u2212 u \u2212 t)!(b \u2212 c + u + t)!(c \u2212 w \u2212 t)!\n\n(B.7)\n\na+b+c\n2\np = max[0, c \u2212 b \u2212 u]\nq = min[b + c \u2212 u, a \u2212 u, c \u2212 w] .\ns=\n\nThe integral I3 is non-zero if and only if both the following\nrelations are satisfied:\n\u2013 b \u2212 c \u2264 a \u2264 b + c, a triangular condition;\n\u2013 a + b + c is even.\nFor each fixed l in Eq. (B.6), the conditions above are satisfied\nfor an infinite number of pairs (m, n), with glmn having numerical\nvalues of \u223c O(1). Thus Eq. (B.4) couples each l-multipole with\nan infinite number of other multipoles.\nIt should be noted that this is valid only if \u0393 \u2265 0 in its whole\ndomain (r, \u03bc) \u2208 [1, rmax ] \u00d7 [\u22121, 1], otherwise we cannot use the\nformulas above (Eqs. (B.5), (B.7)). A non positive \u0393 would make\nthe calculation of these factors much harder.\n\n\f"}