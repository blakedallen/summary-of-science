{"id": "http://arxiv.org/abs/0905.1260v1", "guidislink": true, "updated": "2009-05-08T14:07:06Z", "updated_parsed": [2009, 5, 8, 14, 7, 6, 4, 128, 0], "published": "2009-05-08T14:07:06Z", "published_parsed": [2009, 5, 8, 14, 7, 6, 4, 128, 0], "title": "Improving approximate-optimized effective potentials by imposing exact\n  conditions: Theory and applications to electronic statics and dynamics", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0905.4562%2C0905.3451%2C0905.3028%2C0905.4115%2C0905.2288%2C0905.0459%2C0905.2477%2C0905.0001%2C0905.0075%2C0905.1284%2C0905.3981%2C0905.3768%2C0905.0231%2C0905.0334%2C0905.4865%2C0905.3691%2C0905.3621%2C0905.1627%2C0905.3616%2C0905.0823%2C0905.0382%2C0905.3547%2C0905.3990%2C0905.1730%2C0905.0725%2C0905.1525%2C0905.4845%2C0905.1969%2C0905.4034%2C0905.1660%2C0905.1497%2C0905.1520%2C0905.0938%2C0905.0250%2C0905.1138%2C0905.2045%2C0905.4074%2C0905.2387%2C0905.1352%2C0905.2359%2C0905.1142%2C0905.4951%2C0905.3688%2C0905.2116%2C0905.3845%2C0905.2802%2C0905.1426%2C0905.4458%2C0905.1620%2C0905.4540%2C0905.0605%2C0905.1446%2C0905.0701%2C0905.2140%2C0905.2043%2C0905.3567%2C0905.3937%2C0905.4910%2C0905.0799%2C0905.2638%2C0905.4538%2C0905.1658%2C0905.2084%2C0905.0852%2C0905.2305%2C0905.4174%2C0905.4161%2C0905.4894%2C0905.1135%2C0905.0957%2C0905.3583%2C0905.1260%2C0905.3063%2C0905.2920%2C0905.4283%2C0905.3157%2C0905.3986%2C0905.0970%2C0905.2373%2C0905.1868%2C0905.2649%2C0905.0586%2C0905.3489%2C0905.4573%2C0905.0241%2C0905.3307%2C0905.4260%2C0905.1645%2C0905.2756%2C0905.3076%2C0905.3788%2C0905.2817%2C0905.3002%2C0905.4618%2C0905.4858%2C0905.0147%2C0905.2825%2C0905.2543%2C0905.1674%2C0905.4425%2C0905.4402&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Improving approximate-optimized effective potentials by imposing exact\n  conditions: Theory and applications to electronic statics and dynamics"}, "summary": "We develop a method that can constrain any local exchange-correlation\npotential to preserve ba-sic exact conditions. Using the method of Lagrange\nmultipliers, we calculate for each set of given Kohn-Sham orbitals, a\nconstraint-preserving potential which is closest to the given\nexchange-correlation potential. The method is applicable to both the\ntime-dependent (TD) and independent cases. The exact conditions that are\nenforced for the time-independent case are: Galilean covariance, zero net force\nand torque, and Levy-Perdew virial theorem. For the TD case we enforce\ntranslational covariance, zero net force, the Levy-Perdew virial theorem and\nenergy balance. We test our method on the exchange Krieger-Li-Iafrate (xKLI)\napproximate-optimized effective potential (AOEP), for both cases. For the\ntime-independent case, we calculated the ground state properties of some\nhydrogen chains and small sodium clusters, for some constrained xKLI potentials\nand Hartree-Fock (HF) exchange. The results indicate that enforcing the exact\nconditions is not important for these cases. On the other hand, in the case,\nconstraining both energy balance and zero net force yields improved results\nrelative to TDHF calculations. We explored the electron dynamics in small\nsodium clusters driven by CW laser pulses. For each laser pulse we compared\ncalculations from TD constrained xKLI, TD partially constrained xKLI and TDHF.\nWe found that electron dynamics like elec-tron ionization and moment of inertia\ndynamics for the constrained xKLI are most similar to the TDHF results. Also,\nenergy conservation is better by at least an order of magnitude with respect to\nthe unconstrained xKLI. We also discuss the problems that arise in satisfying\nconstraints in the TD case with a non CW driving force.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0905.4562%2C0905.3451%2C0905.3028%2C0905.4115%2C0905.2288%2C0905.0459%2C0905.2477%2C0905.0001%2C0905.0075%2C0905.1284%2C0905.3981%2C0905.3768%2C0905.0231%2C0905.0334%2C0905.4865%2C0905.3691%2C0905.3621%2C0905.1627%2C0905.3616%2C0905.0823%2C0905.0382%2C0905.3547%2C0905.3990%2C0905.1730%2C0905.0725%2C0905.1525%2C0905.4845%2C0905.1969%2C0905.4034%2C0905.1660%2C0905.1497%2C0905.1520%2C0905.0938%2C0905.0250%2C0905.1138%2C0905.2045%2C0905.4074%2C0905.2387%2C0905.1352%2C0905.2359%2C0905.1142%2C0905.4951%2C0905.3688%2C0905.2116%2C0905.3845%2C0905.2802%2C0905.1426%2C0905.4458%2C0905.1620%2C0905.4540%2C0905.0605%2C0905.1446%2C0905.0701%2C0905.2140%2C0905.2043%2C0905.3567%2C0905.3937%2C0905.4910%2C0905.0799%2C0905.2638%2C0905.4538%2C0905.1658%2C0905.2084%2C0905.0852%2C0905.2305%2C0905.4174%2C0905.4161%2C0905.4894%2C0905.1135%2C0905.0957%2C0905.3583%2C0905.1260%2C0905.3063%2C0905.2920%2C0905.4283%2C0905.3157%2C0905.3986%2C0905.0970%2C0905.2373%2C0905.1868%2C0905.2649%2C0905.0586%2C0905.3489%2C0905.4573%2C0905.0241%2C0905.3307%2C0905.4260%2C0905.1645%2C0905.2756%2C0905.3076%2C0905.3788%2C0905.2817%2C0905.3002%2C0905.4618%2C0905.4858%2C0905.0147%2C0905.2825%2C0905.2543%2C0905.1674%2C0905.4425%2C0905.4402&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "We develop a method that can constrain any local exchange-correlation\npotential to preserve ba-sic exact conditions. Using the method of Lagrange\nmultipliers, we calculate for each set of given Kohn-Sham orbitals, a\nconstraint-preserving potential which is closest to the given\nexchange-correlation potential. The method is applicable to both the\ntime-dependent (TD) and independent cases. The exact conditions that are\nenforced for the time-independent case are: Galilean covariance, zero net force\nand torque, and Levy-Perdew virial theorem. For the TD case we enforce\ntranslational covariance, zero net force, the Levy-Perdew virial theorem and\nenergy balance. We test our method on the exchange Krieger-Li-Iafrate (xKLI)\napproximate-optimized effective potential (AOEP), for both cases. For the\ntime-independent case, we calculated the ground state properties of some\nhydrogen chains and small sodium clusters, for some constrained xKLI potentials\nand Hartree-Fock (HF) exchange. The results indicate that enforcing the exact\nconditions is not important for these cases. On the other hand, in the case,\nconstraining both energy balance and zero net force yields improved results\nrelative to TDHF calculations. We explored the electron dynamics in small\nsodium clusters driven by CW laser pulses. For each laser pulse we compared\ncalculations from TD constrained xKLI, TD partially constrained xKLI and TDHF.\nWe found that electron dynamics like elec-tron ionization and moment of inertia\ndynamics for the constrained xKLI are most similar to the TDHF results. Also,\nenergy conservation is better by at least an order of magnitude with respect to\nthe unconstrained xKLI. We also discuss the problems that arise in satisfying\nconstraints in the TD case with a non CW driving force."}, "authors": ["Yair Kurzweil Martin Head-Gordon"], "author_detail": {"name": "Yair Kurzweil Martin Head-Gordon"}, "author": "Yair Kurzweil Martin Head-Gordon", "links": [{"href": "http://arxiv.org/abs/0905.1260v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/0905.1260v1", "rel": "related", "type": "application/pdf"}], "arxiv_primary_category": {"term": "cond-mat.str-el", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "cond-mat.str-el", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "cond-mat.mtrl-sci", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/0905.1260v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/0905.1260v1", "arxiv_comment": null, "journal_reference": null, "doi": null, "fulltext": "Improving approximate-optimized effective potentials by imposing exact conditions: Theory and applications to electronic statics and dynamics\nYair Kurzweil and Martin Head-Gordon\nDepartment of Chemistry, University of California at Berkeley, and,\nChemical Sciences Division, Lawrence Berkeley National Laboratory,\nBerkeley, CA 94720, USA\n\nWe develop a method that can constrain any local exchange-correlation potential to preserve basic exact conditions. Using the method of Lagrange multipliers, we calculate for each set of given\nKohn-Sham orbitals, a constraint-preserving potential which is closest to the given exchangecorrelation potential. The method is applicable to both the time-dependent (TD) and independent\ncases. The exact conditions that are enforced for the time-independent case are: Galilean covariance, zero net force and torque, and Levy-Perdew virial theorem. For the time-dependent case we\nenforce translational covariance, zero net force, the Levy-Perdew virial theorem and energy balance.\nWe test our method on the exchange (only) Krieger-Li-Iafrate (xKLI) approximate-optimized effective\npotential (AOEP), for both cases. For the time-independent case, we calculated the ground state\nproperties of some hydrogen chains and small sodium clusters, for some constrained xKLI potentials\nand Hartree-Fock (HF) exchange. The results (total energy, Kohn-Sham eigenvalues, polarizability and\nhyperpolarizability ) indicate that enforcing the exact conditions is not important for these cases. On\nthe other hand, in the time-dependent case, constraining both energy balance and zero net force\nyields improved results relative to TDHF calculations. We explored the electron dynamics in small\nsodium clusters driven by CW laser pulses. For each laser pulse we compared calculations from TD\nconstrained xKLI, TD partially constrained xKLI and TDHF. We found that electron dynamics like electron ionization and moment of inertia dynamics for the constrained xKLI are most similar to the\nTDHF results. Also, energy conservation is better by at least an order of magnitude with respect to\nthe unconstrained xKLI. We also discuss the problems that arise in satisfying constraints in the TD\ncase with a non CW driving force.\n1\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fI. INTRODUCTION\nDensity functional theory (DFT)1-3 and time-dependent density functional theory (TDDFT)4 are powerful and yet practical theories that are able\nto predict both ground state and dynamical properties of many-electron molecules. The method of mapping interacting systems onto noninteracting systems results in a huge reduction of computational expense, due to the change from a many-body Hamiltonian to an effective single particles Hamiltonian in the Kohn-Sham (KS) method.2, 5 The main price, however, is the need to approximate the unknown exchangecorrelation (XC) functional.2-4 The simplest approximation is the local density approximation (LDA),3, 6 where the XC functional is a function of\nthe local density. While LDA and its improved versions (involving spatial derivatives of the density) are very successful in many applications,3\nthey suffer from some fundamental problems,6 e.g. incorrect asymptotic behavior, missing the derivative discontinuity of the energy near integer number of particles, self-interaction, and a lack of systematic improvement beyond the homogeneous electron gas.\nA potential advance toward more realistic functionals is to approximate the XC energy as a functional of the KS orbitals, rather than the density.7 Obtaining the corresponding local XC potential in this case is done within the framework of the optimized effective potential (OEP) method.8, 9 The basic equation for calculating the OEP involves an integral equation, which has until very recently been found to be numerically\nhighly expensive. Therefore, some practical approximated OEP (AOEP) methods have been developed7, 10-13 (On the other hand, there is currently a new method that makes the time-independent OEP evaluation stable and feasible14). AOEP's have also been extended to the TD\ncase,15 where TD-OEP7, 16, 17 is still considered a very demanding calculation. Recent experimental developments in experimental ultrafast\nspectroscopy18-21(are opening new frontiers where simulating time-dependent electronic dynamics is of growing importance. It is therefore of\ninterest to assess and further improve AOEP's for this and other purposes.\nOne significant drawback of these (TD-) AOEPs potentials is the fact that they are not a complete functional derivative of any parent functional.\n\n22\n\nTherefore, the Hellman-Feynman theorem does not hold. As a further result, some known exact conditions are not satisfied. The\n22, 23\n\nsometimes severe consequences of violating these exact conditions, for TD cases, are discussed and demonstrated in Refs.\n\nIt is the aim of\n\nthis work to correct any given AOEP to preserve exact conditions for both TD and time-independent cases. Our method, following the work of\n23, 24\n\nKurzweil and Baer,\n\nuses the method of Lagrange multipliers in order to enforce desired exact conditions on a constraint-preserving new\n\nXC potential, optimally close to the given AOEP. The violation of known constraints is a symptom of the underlying failure of AOEP's to be a\nfunctional derivative, rather than the fundamental problem itself. Therefore the main question that this paper tries to address is whether\ncorrecting an AOEP to eliminate constraint violations is also sufficient to significantly improve calculated observables. To explore this question,\nwe test our method for the case of the exchange only KLI (xKLI)10 potential for both DFT and TDDFT. We show the changes associated with\nconstraint satisfaction on the static polarizabilities of hydrogen chains, and on electron dynamics in small sodium clusters.\nThe paper is organized as follows. In Sec. II we first briefly recall the principles of DFT and some exact conditions which the XC potential must\nsatisfy. We describe our method for constraining approximate potentials to satisfy these exact conditions, and show the effect on polarizabili2\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fties of hydrogen chains. In Sec. III we describe an extended version of the method for TDDFT, and discuss the numerical implementations and\nits difficulties. Applications to electron dynamics in Na 5 driven by CW laser pulses are then presented, followed by some discussion and conclusions.\n\nII. CONSTRUCTION OF TIME-INDEPENDENT CONSTRAINT-PRESERVING XC POTENTIALS\nA.\n\nSOME FUNDAMENTAL EXACT CONDITIONS IN DENSITY FUNCTIONAL THEORY\n1\nAssume a system of Ne electrons bound in a static external potential vext . According to the Hohenberg-Kohn theorem, their total energy\n\nfunctional can be written as\nE \uf0e9\uf0eb n \uf0f9\uf0fb \uf03d TS \uf0e9\uf0eb n \uf0f9\uf0fb \uf02b Vext \uf0e9\uf0eb n \uf0f9\uf0fb \uf02b EH \uf0e9\uf0eb n \uf0f9\uf0fb \uf02b EXC \uf0e9\uf0eb n \uf0f9\uf0fb ,\n\n(1)\n\nwhere\nTS \uf03d\n\n\uf0e5\ni .\uf073\n\n\uf06ai\uf073 \uf02d 12 \uf0d12 \uf06ai\uf073 ,\n\nVext \uf0e9\uf0eb n \uf0f9\uf0fb \uf03d \uf0f2 drvext \uf028 r \uf029 n \uf028 r \uf029,\nEH \uf0eb\uf0e9 n \uf0fb\uf0f9 \uf03d \uf0f2\uf0f2 drdr \uf0a2n \uf028 r \uf0a2 \uf029 n \uf028 r \uf029 r \uf02d r \uf0a2 ,\nEXC \uf0e9\uf0eb n \uf0f9\uf0fb \uf0ba \uf059 \uf0e9\uf0eb n \uf0f9\uf0fb T\u02c6 \uf02b W\u02c6 \uf059 \uf0e9\uf0eb n \uf0f9\uf0fb \uf02d EH \uf0e9\uf0eb n \uf0f9\uf0fb ,\n\n(2)\n\nT\u02c6 is the many body kinetic energy operator, \u0174 is the 2-body Coulomb interaction operator and \uf059 is the exact wavefunction of the interact-\n\ning electrons. The minima of E \uf0e9\uf0eb n \uf0f9\uf0fb can be obtained from the Kohn-Sham (KS) equations:2\n\uf0e9 \uf02d 1 \uf0d12 \uf02b v \uf028 r \uf029 \uf02b v \uf028 r \uf029 \uf02b v \uf073 \uf028 r \uf029 \uf0f9 \uf06a \uf073 \uf028 r \uf029 \uf03d \uf065 \uf073 \uf06a\uf073 \uf028 r \uf029 , (3)\next\nH\nXC\ni i\n\uf0fa\uf0fb i\n\uf0eb\uf0ea 2\nwhere vH \uf028 r \uf029 \uf03d\n\n\uf0f2 dr \uf0a2n \uf028 r \uf0a2 \uf029\n\nr \uf02d r \uf0a2 and vXC \uf028 r \uf029 \uf0ba \uf064E XC \uf0e9\uf0eb n \uf0f9\uf0fb \uf064n \uf028 r \uf029 .\n\nFrom the 1 R \uf02d R \uf0a2 nature of the Coulomb interaction, it can be shown that the XC energy functional is invariant under translations or\nrotations of the coordinates, which is called Galilean invariance (GI).25 Mathematically, GI of the XC energy functional,\nEXC \uf0e9\uf0eb n \uf0f9\uf0fb \uf0ba E X \uf0e9\uf0eb n \uf0f9\uf0fb \uf02b EC \uf0e9\uf0eb n \uf0f9\uf0fb , means that given two coordinate systems, r and r \uf0a2 , the energy functional is invariant under the transformation\nEX ,C \uf0e9\uf0eb n \uf0a2; r \uf0a2 \uf0f9\uf0fb \uf03d E X ,C \uf0e9\uf0eb n; r \uf0f9\uf0fb , (4)\n\n3\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fwhere r \uf0a2 \uf03d r \uf02b x for translations or r \uf0a2 \uf03d Mr for rotations. GI implies immediately additional four properties of the derived XC potential, vX ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r \uf029 \uf0ba \uf064EX ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf064n \uf028 r \uf029 . The first is translational covariance (TC): 25\nvX ,C \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf029 \uf03d vX ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r \uf02b x \uf029 ,\n\n(5)\n\nand the second is rotational covariance (RC):25\nvX ,C \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf029 \uf03d vX ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 Mr \uf029 ,\n\n(6)\n\nWe describe a functional which satisfies both TC and RC as a Galilean covariant (GC) functional. Since (4) is valid for any translation or rotation,\nit is easy to show, together with the Perdew-Levy virial theorems26 (see below), that for infinitesimal translation or rotation one can obtain the\nXC zero-force (ZF) and XC zero-torque (ZT) conditions:25\nfX ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r \uf029 \uf0ba \uf02d\uf0e5 \uf0f2 drn \uf073 \uf028 r \uf029 \uf0d1vX\uf073 ,C \uf028 r \uf029 \uf03d 0,\n\uf073\n\ntX ,C \uf0eb\uf0e9 n \uf0fb\uf0f9 \uf028 r \uf029 \uf0ba \uf02d\uf0e5 \uf0f2 drn \uf073 \uf028 r \uf029 r \uf0b4 \uf0d1vX\uf073 ,C \uf028 r \uf029 \uf03d 0,\n\n(7)\n\n\uf073\n\nwhere \uf073 is the spin component for spin polarized systems, n \uf03d\n\n\uf0e5 n\uf073 , and vX\uf073 ,C\n\uf073\n\n\uf0ba \uf064E \uf0e9\uf0eb n \uf0f9\uf0fb \uf064n \uf073 . Other known properties of the exact XC\n\nfunctional are the Perdew-Levy virial theorems (VT) (for any density):26\nEX \uf0e9\uf0eb n \uf0f9\uf0fb \uf02b \uf0e5 \uf0f2 dr\uf073 n \uf028 r \uf029 r \uf0d7 \uf0d1vX\uf073 ,C \uf028 r \uf029 \uf03d 0,\n\uf073\n\nEC \uf0e9\uf0eb n \uf0f9\uf0fb \uf02b \uf0e5 \uf0f2 drn\uf073 \uf028 r \uf029 r \uf0d7 \uf0d1vX\uf073 ,C \uf028 r \uf029 \uf02b\n\uf073\n\nTS \uf0e9\uf0eb n \uf0f9\uf0fb \uf02d T \uf0e9\uf0eb n \uf0f9\uf0fb \uf03d 0\n\n(8)\n\n(9)\n\nwhere TS \uf0e9\uf0eb n \uf0f9\uf0fb and T \uf0e9\uf0eb n \uf0f9\uf0fb are the noninteracting and interacting kinetic energy functionals, respectively.\n\nB.\n\nIMPOSING EXACT CONDITIONS ON A GIVEN XC POTENTIAL\n\nIn general, an approximate optimized effective potential (AOEP) will not be the complete functional derivative of any density/orbital functional, and therefore may not satisfy the ZF, ZT and the VT conditions. This situation is common to AOEPs where the XC energy functional is orbital-dependent.7, 22 On the other hand, they may certainly be GC, thanks to their orbital-dependency. However, this property alone does not\n\uf073 \uf0e9\n\uf0f9\nguarantee the other conditions. Let us be given such an AOEP, w XC\n\uf0eb \uf07b \uf06ai \uf07d \uf0fb \uf028 r \uf029 , which is an approximate functional derivative of an orbital\n\ndependent functional EX ,C \uf0e9\uf0ea \uf07b \uf06ai\uf073 \uf07d \uf0f9\uf0fa :\n\uf0eb\n\uf0fb\n\n4\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\f\uf064E X ,C \uf064n \uf073 \uf028 r \uf029 \uf0bb wX\uf073 ,C \uf0e9\uf0ea \uf07b \uf06ai\uf073 \uf07d \uf0f9\uf0fa \uf028 r \uf029 .\n\uf0eb\n\uf0fb\n\n(10)\n\nWe would like to impose as many exact conditions as possible in order to correct w X\uf073 ,C \uf028 r \uf029 . We wish to construct constrained potentials,\ndenoted as vX\uf073 ,C \uf028 r \uf029 , which exactly satisfy conditions (5)-(9). In order to keep vX\uf073 ,C \uf028 r \uf029 as close as possible to their original w X\uf073 ,C \uf028 r \uf029 , we formulate a constrained variational problem with the Lagrangian (for either the exchange, 'X' subscript, or the correlation, 'C' subscript):\n\nLX ,C \uf03d\n\n1\n2\n\n\uf0e5 \uf0f2 dr\n\uf073\n\nr\nr\n2\nvX\uf073 ,C \uf028 r \uf029 \uf02d wX\uf073 ,C \uf028 r \uf029 \uf02b AX ,C \uf0d7 C X ,C , (11)\n\nr\nr\nr\nwhere C X and C C are vectors that contain the constraints for the exchange and correlation respectively, and AX ,C are vectors that contain\ntheir corresponding Lagrange multipliers. The potentials vX\uf073 ,C \uf028 r \uf029 are obtained from the stationary point of the Lagrangians in Eq. (11), for\ngiven fixed orbitals and potentials, w X\uf073 ,C , where the variation is done with respect to vX\uf073 ,C \uf028 r \uf029 only, i.e.\n\uf064LX ,C\n\n\uf064vX\uf073 ,C \uf028 r \uf029\nvX\uf073 ,C\n\n\uf028 r\uf029\n\n\uf03d\n\n\uf02d wX\uf073 ,C\n\nr\nr\n\uf064C X ,C\nX ,C\n\uf03d 0,\n\uf028r\uf029 \uf02b A \uf0d7 \uf073\n\uf064vX ,C \uf028 r \uf029\n\n(12)\n\n(For simplicity we assume the same multipliers \uf07b AiX ,C \uf07d for each spin component \uf073 ). Additional variations with respect to the \uf07b AiX ,C \uf07d yield\nthe additional equations:\n\uf0b6LX ,C\n\n\uf0b6AiX ,C\n\n\uf03d C iX ,C \uf03d 0.\n\n(13)\n\n(Note that this method is an extension of the method of Kurzweil and Baer, from Ref. 23).\nr\nThe construction of the constraints C X ,C must be made with care regarding the Galilean transformation symmetries (Eqs. (5),(6)). If the\noriginal AOEP is already GC, then one expects the constrained vX\uf073 ,C to be GC also. Therefore, assuming w X\uf073 ,C \uf028 r \uf029 are GC, the potentials\nvX\uf073 ,C \uf028 r \uf029 should transform like vX ,C in Eqs. (5),(6), under translations and rotations. Therefore, instead of taking the constraints as Eqs. (7)-(9),\n\nwe construct equivalent constraints which ensure GC and also satisfy Eqs. (7)-(9) :\nr\n,C X ,C\nC X ,C \uf0ba \uf07b c1X ,C , cX\n\uf07d,\n2 , c3\nX ,C \uf0e9 \uf0f9\nc1 \uf0eb n \uf0fb \uf03d fX ,C \uf0e9\uf0eb n \uf0f9\uf0fb ,\nc2X ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf03d tX ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf02d D \uf0e9\uf0eb n \uf0f9\uf0fb \uf0b4 fX ,C \uf0e9\uf0eb n \uf0f9\uf0fb ,\nc3X ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf03d \uf050X ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf02b\n\uf0f2 drn \uf028 r \uf029 r \uf0d7 \uf0d1vX ,C \uf02d D \uf0e9\uf0eb n \uf0f9\uf0fb \uf0d7 fX ,C \uf0e9\uf0eb n \uf0f9\uf0fb ,\n5\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n(14)\n\n\fwhere vX ,C \uf0ba\n\n\uf0e5 vX\uf073 ,C ,\n\uf073\n\n\uf050X\n\uf050C\n\n\uf0e9 n \uf0f9 \uf0ba EX \uf0e9 n \uf0f9 ,\n\uf0eb \uf0fb\n\uf0eb \uf0fb\n\uf0e9 n \uf0f9 \uf0ba EC \uf0e9 n \uf0f9 \uf02b T \uf0e9 n \uf0f9 \uf02d TS \uf0e9 n \uf0f9 ,\n\uf0eb \uf0fb\n\uf0eb \uf0fb\n\uf0eb \uf0fb\n\uf0eb \uf0fb\n\n(15)\n\nand D is the CM position of the electrons:\nD \uf0e9\uf0eb n \uf0f9\uf0fb \uf0ba\nNe \uf03d\n\n\uf0f2\n\n1\ndrn \uf028 r \uf029 r,\nNe \uf0f2\ndrn \uf028 r \uf029,\n\n(16)\n\nIt is clear that at the stationary point, conditions (14) are equivalent to conditions (5)-(9), since constraints c1X ,C guarantee zero net force:\nfX ,C \uf03d 0 . The resulting vX\uf073 ,C , according to Eqs. (12),(14), are therefore:\nr\nr\nvX\uf073 ,C \uf028 r \uf029 \uf03d w X\uf073 ,C \uf028 r \uf029 \uf02b AX ,C \uf0d7 \uf047\uf073 \uf028 r \uf029\n\n(17)\n\nwhere\nr\nAX ,C \uf0ba \uf07b a1X ,C \uf028 r \uf029 , a2X ,C \uf028 r \uf029 , a 3X ,C \uf07d ,\nr\n\uf047\uf073 \uf028 r \uf029 \uf0ba \uf07b g1\uf073 \uf028 r \uf029 , g2\uf073 \uf028 r \uf029 , g 3\uf073 \uf028 r \uf029 \uf07d ,\n\ng1\uf073 \uf028 r \uf029 \uf0ba \uf0d1n \uf073 \uf028 r \uf029 ,\ng2\uf073 \uf028 r \uf029 \uf0ba \uf0d1 \uf0b4 \uf0e9\uf0eb \uf028 r \uf02d D \uf029 n \uf073 \uf028 r \uf029 \uf0f9\uf0fb ,\ng 3\uf073 \uf028 r \uf029 \uf0ba \uf0d1 \uf0d7 \uf0eb\uf0e9 \uf028 r \uf02d D \uf029 n \uf073 \uf028 r \uf029 \uf0fb\uf0f9 .\n\n(18)\n\nThe Lagrange multipliers \uf07b AiX ,C \uf07d are determined from the following linear algebraic equations, denoted as\nr\nt\nr\nG X ,C \uf0d7 AX ,C \uf03d B X ,C ,\n\n(19)\n\nwhere\nGijX ,C \uf03d\n\n\uf0e5 \uf0f2 dr \uf047i\uf073 \uf028 r \uf029 \uf047\uf073j \uf028 r \uf029 \uf07b i, j \uf03d 1..2d \uf02b 2 \uf07d,\n\uf073\n\nr\n\uf0ec\n\uf0ef\nB X ,C \uf0ba \uf0ef\n\uf0ed \uf0e5 \uf0f2 drg1\uf073 wX\uf073 ,C , \uf0e5 \uf0f2 drg2\uf073 wX\uf073 ,C ,\n\uf0ef\n\uf0ef\n\uf0ee \uf073\n\uf073\n\uf0fc\n\uf0ef\n\uf073 \uf073\n\uf0ef\n\uf0e5 \uf0f2 drg3 wX ,C \uf02b \uf050X ,C \uf0fd\uf0ef\n\uf0ef\n\uf073\n\uf0fe\n(d is the spatial dimension of the system)\n\n6\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n(20)\n\n\fr\nIn (20) we used integration by parts to achieve a redefinition of the exact conditions (14), reflected in B X ,C . The fact that the matrices\nr\nt\nG X ,C are symmetric positive-definite (unless the density is constant) ensures nonsingular solution forA . It is also possible to constrain only\nsome of the conditions. In this case only the relevant \uf07b AiX ,C \uf07d ,\n\n\uf07b BiX ,C \uf07d and \uf07bGiX, j,C \uf07d are accounted in Eqs.(17) and (19). The last step in our\n\nanalysis is verifying the GC of vX\uf073 ,C \uf028 r \uf029 in Eq. (17); we refer the reader to appendix A for a proof.\nWe would like to note here that the global form of the constraints we are imposing, e.g. integrals over all space, may have a size-consistency\nproblem. Thus while approximate AOEP's are size-consistent in the sense that well-separated subsystems have zero interaction, the constrained AOEP's may violate size-consistency because satisfying global constraints for a system of non-interacting components can induce an\ninteraction between them. It is, however, in principle possible to construct local constraints when the XC tensor is available.27 In this case the\nLagrange multipliers are calculated locally, at each spatial point and size-consistency is satisfied. Since this method will be far more numerically expensive than enforcing global constraints, we shall not consider it further here..\nIn summary, the SCF algorithm works as follows. (i) guess initial orbitals \uf07b \uf06ai\uf073 0 \uf07d , (ii) construct the potentials vH and w X\uf073 ,C , (iii) obtain the\nconstrained potentials vX\uf073 ,C as described above, (iv) solve KS equations (3), (v) if the stop condition is not satisfied, go back to (ii).\n\nC.\n\nNUMERICAL APPLICATION\n\nWe study the effects of the constrained potential for simple H2 chains which nonetheless can be strongly correlated systems. Furthermore,\nthere are some detailed OEP, AOEP and HF results available in the literature, and we use them as a benchmark for our calculations.28 These\n10\n\ncalculations refer to exact-exchange (only) KLI (xKLI) and OEP, and HF (the correlation energy is omitted). The xKLI potential has the form\n\n\uf073\nwxKLI\n\uf028 r\uf029 \uf03d\n\nN\n\n\uf0e5 ni\uf073 \uf028 r \uf029 \uf0e9\uf0ea\uf0eb ui\uf073 \uf028 r \uf029 \uf02b \uf028 wi\uf073 \uf02d ui\uf073 \uf029 \uf0f9\uf0fa\uf0fb\ni \uf03d1\n\nn\uf073 \uf028 r \uf029, (21)\n\nwhere\n\nui\uf073\n\n\uf028 r\uf029 \uf0ba \uf02d\n\n1\n\n\uf06ai\uf073 \uf028 r \uf029\n2\n\n\uf0e5 \uf028 r\uf029 \uf0f2\nj\n\n\uf06a\uf073j\n\nni\uf073 \uf028 r \uf029 \uf0ba \uf06ai\uf073 \uf028 r \uf029 , n \uf073 \uf028 r \uf029 \uf0ba\nwi\uf073 \uf03d \uf06ai\uf073 wX \uf06ai\uf073 , ui\uf073 \uf03d\n\ndr \uf0a2\n\n\uf06a*j \uf073 \uf028 r \uf0a2 \uf029 \uf06ai\uf073 \uf028 r \uf0a2 \uf029\n,\nr \uf02d r\uf0a2\n\n\uf0e5 \uf06ai\uf073 \uf028 r \uf029\n\ni\n\uf073\n\uf06ai\n\n2\n\n,\n\nui \uf06ai\uf073 ,\n\nand wN\uf073 \uf03d uN\uf073 . The implicit Eq. (21) is solved easily for \uf07b wi\uf073 \uf07d , projecting on both sides with each orbital \uf06ai , as is described elsewhere.10\n\n7\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fThe relevant exact conditions for this case are for the exchange potential, denoted by subscript 'X' in Eqs. (5)-(8). Following Ref.29 we calculate\nthe first and second polarizability for four potentials; HF, xKLI, xKLI constrained to preserve ZF only ('xKLI-ZF'), and xKLI constrained to preserve\nboth ZF and the Perdew-Levy VT ('xKLI-ZFV') condition. Accordingly, for each such xKLI model, different multipliers \uf07b AiX \uf07d are introduced, e.g.\nr\nfor xKLI-ZF we take AX \uf03d \uf07b a1X , 0, 0 \uf07d in Eqs. (17) and (19), where the only corresponding part of the linear equations (19) are solved:\n\n\uf0e5 GiX, j AjX\nj\n\n\uf073\n\uf03d B jX , i, j \uf03d 1..3 . The constrained potential is therefore vX\uf073 \uf028 r \uf029 \uf03d w xKLI\n\uf028 r \uf029 \uf02b a1X \uf0d7 g1\uf073 \uf028 r \uf029 . Because of the high symmetry of\n\nthe H-chains, torque is preserved automatically, in the GS, in accordance with preserving ZF, if the external field acts along the chain.\nThe specific details of our calculations are as follows. For each chain, the H2 bond length is taken as 2a 0 ( a 0 is the Bohr radius) and the distance between the H2 molecules is taken as 3a 0 . Calculations were carried out using our real-space-plane-wave basis set code, with a local\npseudopotential for hydrogen.30 The system was enclosed in a Cartesian box (Lm \uf02b 20) \uf0b4 20 \uf0b4 20 a 03 , where Lm is the given chain length.\nThe box is discretized equally along each axis; \uf044x \uf03d \uf044y \uf03d \uf044z \uf03d 0.364a 0 . For each chain and potential we calculated the dipole moment of\nthe GS, while applying a dipole electric field along the chain, vext \uf03d \uf065i x . From the inversion symmetry of the chains (at r \uf03d 0 ), the polarization can be expanded as a function of odd powers of the applied electric field:\n\uf067ijkl\nr\nP \uf028 \uf065 \uf029 \uf03d \uf061ij \uf065j \uf02b\n\uf065 \uf065 \uf065 \uf02b ...\n3! j k l\n\n(22)\n\nwhere \uf061ij is the first, or linear polarizability, and \uf067ijkl is the second polarizability. We calculate \uf061xx and \uf067xxxx following method 2 of Ref. 29: we\nfirst calculate the polarizations, Pxj , resulting from a series of electric fields, \uf065j \uf03d 0.002 j , where j \uf03d 0..8 , and use this data to fit the polarizability coefficients using Eq. (22) via least squares. The results, summarized in Table I and TABLE II, are similar to the reported results in Ref.\n29\n\n, for HF and xKLI. For xKLI-ZF and xKLI-ZFV, the constraints lead to overestimates of the linear polarizability by up to : 1% , and up to\n\n: 5% for the hyperpolarizability, with respect to regular xKLI. Also, the total energy and eigenvalues for xKLI-ZF and xKLI-ZFV, are very close\nto xKLI. For instance, the total energy for H 12 , with vext \uf03d 0.02x , is about \uf02d175eV , and the HOMO energy is about. \uf02d7.6eV .. The differences between xKLI and xKLI-ZFV are : 2meV for the total energy and : 5meV for the HOMO.\n\n8\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fTABLE I. First polarizability \uf061 in a.u. for hydrogen chains.\nHF\n\nxKLI\n\nxKLI-ZF\n\nxKLI-ZFV\n\nH4\n\n32.2\n\n33.3\n\n33.6\n\n33.6\n\nH6\n\n56.7\n\n60.6\n\n61.3\n\n61.3\n\nH8\n\n83.8\n\n91.8\n\n93.1\n\n93.1\n\nH 12\n\n140.1\n\n159.4\n\n161.9\n\n161.9\n\nTABLE II. Second polarizability \uf067 103 in a.u. for hydrogen chains\n\nHF\n\nxKLI\n\nxKLI-ZF\n\nxKLI-ZFV\n\nH4\n\n10.4\n\n10.5\n\n10.8\n\n10.8\n\nH6\n\n29.7\n\n35.4\n\n36.7\n\n36.7\n\nH8\n\n61.8\n\n90.4\n\n94.0\n\n93.9\n\nH 12\n\n152.5\n\n304.5\n\n317.6\n\n318.1\n\nThe same trend is found for some small sodium clusters, where the xKLI-ZF/xKLI-ZFV values for the GS energy and eigenvalues are negligibly\nt\ndifferent from xKLI. The first polarizability tensor, \uf061 , is slightly overestimated by the xKLI-ZF and xKLI-ZFV with respect to the xKLI results.\nThe small overestimation of the polarizabilities in the results where exact conditions are enforced suggests that a very small amount of selfr\ninteraction has been introduced, due to the additional local density terms \uf047 , in the constrained potential vX\uf073 ,C (Eqs. (15),(16)).\n\nIII. EXTENSION TO TIME DEPENDENT XC POTENTIALS\nA.\n\nEXACT CONDITIONS IN TIME-DEPENDENT DENSITY FUNCTIONAL THEORY\n9\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fWhile derivation of exact conditions in DFT resulted from a variation of the energy functional, in the time-dependent theory things are more\ncomplicated.4 The present lack of a real-time action functional requires alternative formalisms such as the Keldysh contour method.24, 31-33\nHowever, some exact conditions may be formulated without such an action, and are actually TD versions of the DFT conditions (see Sec. IIB).\nWe refer to four of them: (i) generalized translational covariance of the vXC \uf028 r, t \uf029 \uf0ba vX \uf028 r, t \uf029 \uf02b vC \uf028 r, t \uf029 . i.e. for any TD transla34\ntion r \uf0a2 \uf03d r \uf02b x \uf028 t \uf029 :\n\nvXC \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r, t \uf029 \uf03d vXC \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 .\n\n(23)\n\nThis condition results from the harmonic potential theorem.35 (ii) zero net XC-force,34\n\uf073\nfXC \uf028 t \uf029 \uf0ba \uf02d\uf0e5 \uf0f2 drn\uf073 \uf028 r, t \uf029 \uf0d1vXC\n\uf028 r, t \uf029 \uf03d 0,\n\uf073\n\n(24)\n\nwhich results from Ehrenfest's equations.\nFor adiabatic energy functionals, like the exact exchange, a TD energy functional can be defined as E \uf028 t \uf029 \uf0ba E \uf0e9\uf0ea \uf07b \uf06ai\uf073 \uf028 r, t \uf029 \uf07d \uf0f9\uf0fa . The functional\n\uf0eb\n\uf0fb\nE \uf0e9\uf0ea \uf07b \uf06ai\uf073 \uf028 r, t \uf029\uf07d \uf0f9\uf0fa is the time-independent energy functional defined in Eq. (1). The other functionals in (1) can be defined correspondingly, e.g.\n\uf0eb\n\uf0fb\nEXC \uf028 t \uf029 \uf0ba EXC \uf0e9\uf0ea \uf07b \uf06ai\uf073 \uf028 r, t \uf029\uf07d \uf0f9\uf0fa . In such a case, there are two more conditions: (iii) the virial theorem36\n\uf0eb\n\uf0fb\n\uf073\nEXC \uf0e9\uf0eb n \uf0f9\uf0fb \uf03d \uf02d\uf0e5 \uf0f2 drn \uf073 \uf028 r, t \uf029 r \uf0d7 \uf0d1vXC\n\uf028 r, t \uf029 \uf02b\n\uf073\nTS \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 t \uf029 \uf02d T \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 t \uf029 ,\n\n(25)\n\nand (iv) the XC energy balance (EB)36\nE& XC \uf028 t \uf029 \uf03d\n\n\uf073\n\uf028 r, t \uf029 n& \uf073 \uf028 r, t \uf029,\n\uf0e5 \uf0f2 drvXC\n\n(26)\n\n\uf073\n\nwhich is required from the energy balance of the interacting TD energy, E \uf028 t \uf029 , and the non-interacting energy, ES \uf028 t \uf029 :\nE& \uf028 t \uf029 \uf03d W&ext ,\nE& S \uf028 t \uf029 \uf03d W& S ,\n\nwhere Wext ,S \uf0ba\n\n(27)\n\nt\n\n\uf0f20 dt \uf0a2 \uf0f2 drv&ext,S \uf028 r, t \uf0a2 \uf029 n \uf028 r, t \uf0a2 \uf029 is the total external mechanical work done by the external potential vext ,S .\n\nNote that conditions (23)-(25) are formulated for the total XC potential rather than for the exchange and correlation potentials separately.\n\nB.\n\nIMPOSING EXACT CONDITIONS ON A GIVEN TIME-DEPENDENT XC POTENTIAL\n10\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fImposing the exact conditions in the TD case is done here similarly to the time-independent case, described in sec. IIB. Here, however, we\n\uf073\n\uf073\n\uf073\nsearch for each time t and given TD orbitals (and w XC\n\uf028 r, t \uf029 ), for the closest vXC\n\uf028 r, t \uf029 to w XC\n\uf028 r, t \uf029 .\n\nWe formulate, again, a variational problem for the constrained TD Lagrangian\n2\n\n\uf073\n\uf073\nl \uf028 t \uf029 \uf03d 12 \uf0e5 \uf0f2 dr vXC\n\uf028 r, t \uf029 \uf02d wXC\n\uf028 r, t \uf029 \uf02b\n\uf073\nr\nr\nA\uf028t \uf029 \uf0d7 C \uf028t \uf029.\n\n(28)\n\nCorrespondingly, we construct the relevant TD constraints, C \uf028 t \uf029 \uf0ba \uf07b c1 \uf028 t \uf029, c2 \uf028 t \uf029 , c3 \uf028 t \uf029 \uf07d , by replacing n \uf028 r \uf029 by n \uf028 r, t \uf029 for the relevant\nphysical quantities in Eqs. (10)-(15), i.e.\nc1 \uf028 t \uf029 \uf03d c1X \uf0e9\uf0eb n \uf028 r, t \uf029 \uf0f9\uf0fb \uf02b cC1 \uf0e9\uf0eb n \uf028 r, t \uf029 \uf0f9\uf0fb ,\nc \uf028 t \uf029 \uf03d E& \uf028 t \uf029 \uf02d\ndrv \uf073 \uf028 r, t \uf029 N&\n2\n\nXC\n\n\uf0e5\uf0f2\n\uf073\n\nXC\n\n\uf073\n\nc3 \uf028 t \uf029 \uf03d c3X \uf0e9\uf0eb n \uf028 r, t \uf029 \uf0f9\uf0fb \uf02b cC3 \uf0e9\uf0eb n \uf028 r, t \uf029 \uf0f9\uf0fb ,\n\n\uf028 r, t \uf029,\n\n(29)\n\nwhere\n& \uf028t \uf029 \uf0f9 \uf03d\nN& \uf073 \uf028 r, t \uf029 \uf0ba \uf0e9\uf0eb n& \uf073 \uf028 r, t \uf029 \uf02b \uf0d1n \uf073 \uf028 r, t \uf029 \uf0d7 D\n\uf0fb\n& \uf028t \uf029 \uf0f9\n\uf02d\uf0d1 \uf0d7 \uf0e9\uf0eb j\uf073 \uf028 r, t \uf029 \uf02d n \uf073 \uf028 r, t \uf029 D\n\uf0fb\nvXC \uf028 r, t \uf029 \uf03d\n\n\uf073\n\uf028 r, t \uf029 , \uf07bciX ,C \uf0e9\uf0eb n \uf0f9\uf0fb \uf07d\n\uf0e5 vXC\n\uf073\n\nare defined in Eq. (14), and D \uf028 t \uf029 \uf0ba D \uf0e9\uf0eb n \uf028 r, t \uf029 \uf0f9\uf0fb is now the TD CM position of the electron density.\n\nIt is clear, again, that the conditions in (29), at the stationary point, are equivalent to the conditions (24)-(26), since fXC \uf028 t \uf029 \uf03d 0 is enforced\nby c1 \uf028 t \uf029 . Hence, following the variation of l \uf028 t \uf029 , the corrected potential is (similar to Eq. (17))\nr\n\uf073\n\uf073\nvXC\n\uf028 r, t \uf029 \uf03d w XC\n\uf028 r, t \uf029 \uf02b A\n\nr\n\n\uf028 t \uf029 \uf0d7 \uf04c\uf073 \uf028 r, t \uf029 ,\n\n(30)\n\nwhere\nr\n\uf04c \uf0ba \uf07b l1\uf073 , l2\uf073 , l 3\uf073 \uf07d ,\n\nl1\uf073 \uf028 r, t \uf029 \uf0ba \uf0d1n\uf073 \uf028 r, t \uf029,\nl \uf073 \uf028 r, t \uf029 \uf0ba N& \uf028 r, t \uf029 ,\n2\nl 3\uf073\n\n(31)\n\n\uf073\n\n\uf028 r, t \uf029 \uf0ba \uf0d1 \uf0d7 \uf0e9\uf0eb \uf028 r \uf02d D \uf028 t \uf029 \uf029 n\uf073 \uf028 r, t \uf029 \uf0f9\uf0fb .\n\nThe TD Lagrange multipliers are determined from the linear algebraic equations,\nr\nt\nr\nL \uf028 t \uf029 \uf0d7 A \uf028 t \uf029 \uf03d B \uf028 t \uf029,\n\n11\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n(32)\n\n\fwhich must be solved separately for each time, t , where:\nLij \uf028 t \uf029 \uf03d\n\n\uf0e5 \uf0f2 drli\uf073 \uf028 r, t \uf029l j\uf073 \uf028 r, t \uf029 \uf07bi, j \uf03d 1..d \uf02b 2 \uf07d,\n\uf073\n\nr\nA \uf028 t \uf029 \uf0ba \uf07b a1 , a2 , a 3 \uf07d ,\nr\n\uf0ec\uf0ef\n\uf073\n\uf073\nB \uf028 t \uf029 \uf0ba \uf0ef\uf0ed \uf0e5 \uf0f2 drl1\uf073 wXC\n, E& XC \uf02d \uf0e5 \uf0f2 drl2\uf073 wXC\n,\n\uf0ef\uf0ef\uf0ee \uf073\n\uf073\n\uf0fc\n\uf0ef\n\uf073\n\uf02b \uf050X \uf02b \uf050C \uf0ef\n\uf0fd.\n\uf0e5 \uf0f2 drl3\uf073wXC\n\uf0ef\n\uf0ef\n\uf073\n\uf0fe\n\n(33)\n\n( d is the spatial dimension of the system).\nr\nt\nThe fact that the matrix L is symmetric and positive-definite for t \uf03e 0 , ensures a unique solution for A . Also note that the TD and timeindependent potentials in (30) and (17), respectively, should be matched at t \uf03d 0 , in order to guarantee continuity in time. Since TD and\n\uf073\ntime-independent conditions are not exactly the same, a proper match is desired at t \uf03d 0 . For instance, it is possible to replace w XC\n\uf028 r, t \uf029 in\n\uf073\n\uf073\nEqs. (28), (29), (30) and (33) by wXC\n\uf028 r, t \uf029 \uf03d wXC\n\uf028 r, t \uf029 \uf02b \uf0e5 Ai0\uf047i0 \uf028 r, t \uf029 , in order to achieve continuity across t \uf03d 0 . In the last equality,\ni\n\n\uf07b Ai0 \uf07d are the time-independent Lagrange multipliers, calculated for the GS, and the \uf047i 's of Eq.(18) are substituted. Another possibility for\nachieving continuity across t \uf03d 0 , is by enforcing all the GS conditions plus the EB condition from Eq. (26) (despite the fact that zero net tor\uf073\nque is not necessary for the TD XC potential). Finally, we refer the reader to Appendix A to verify that vXC\n\uf028 r, t \uf029 in Eq. (30) is TC.\n\nC.\n\nNUMERICAL IMPLEMENTATION\n\nThe numerical procedure of propagating the TDKS equations requires calculating the GS first. At this stage the SCF is obtained as is described\nin Sec. IIB. Then, the orbitals are propagated in time by the TDKS equations:5\ni\uf06a& i\uf073 \uf028 r, t \uf029 \uf03d h\u02c6S\uf073 \uf028 r, t \uf029 \uf06ai\uf073 \uf028 r, t \uf029 ,\nh\u02c6S\uf073 \uf028 r, t \uf029 \uf03d \uf02d\uf0d12 2 \uf02b vext \uf028 r, t \uf029 \uf02b\n\uf073 \uf0e9\n\uf073 \uf0f9\nvH \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r, t \uf029 \uf02b vXC\n\uf0ea\uf0eb \uf07b \uf06ai \uf07d \uf0fa\uf0fb \uf028 r, t \uf029 ,\n\n(34)\n\n\uf073\n\uf073\nas follows. For each time step, first w XC\n\uf028 r, t \uf029 is constructed from the actual KS orbitals, then, vXC\n\uf028 r, t \uf029 is calculated as is described in IIIB,\n\nand finally, \uf07b \uf06ai\uf073 \uf028 r, t \uf02b \uf044t \uf029 \uf07d are obtained from Eqs. (34).\nFor the case that ionization processes are occurring, an imaginary absorbing potential is the most convenient way to treat the ionized electrons in our code, which is operates in real time and space. In this case, we add the following negative imaginary potential37\n\n12\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fvabs \uf028 r \uf029 \uf03d \uf02diuabs \uf028 r \uf029 ,\n\nuabs \uf028 r \uf029 \uf03d \uf068 \uf0b4 \uf071 \uf028 x \uf02d a \uf029 \uf0b4 \uf028 x \uf02d a \uf029 ,\nn\n\n(35)\n\nThe parameters \uf068, n, are taken from Ref. 37, a is chosen as the plane x \uf03d a which is far away from the GS CM, and \uf071 \uf028 x \uf029 is the step function. In Eq. (35) we assume that the driving field and therefore any ionization process acts along thex axis. The Hamiltonian h\u02c6S\uf073 in Eq. (34) is\n%\nthis case is replaced by h\u02c6S\uf073 \uf0ba h\u02c6S\uf073 \uf02b vabs . Correspondingly, the evolution of TD expectation values are changed, where for each Hermitian op-\n\nerator \u00f4 we can write\n\u02c6 abs . (36)\nd o%\u02c6 dt \uf0ba i \uf0e9\uf0ea\uf0eb h\u02c6S , o\u02c6 \uf0f9\uf0fa\uf0fb \uf02b \uf0b6o\u02c6 \uf0b6t \uf02d uabso\u02c6 \uf02b ou\nTherefore, the continuity equation, the total number of electrons, the CM position and the mechanical work are changed to\nn%& \uf028 r, t \uf029 \uf03d \uf02d\uf0d1 \uf0d7 j \uf028 r, t \uf029 \uf02d 2n \uf028 r, t \uf029 uabs \uf028 r \uf029 ,\n%\nN& \uf028 t \uf029 \uf03d \uf02d2 drn \uf028 r, t \uf029 u \uf028 r \uf029 ,\n\n\uf0f2\n\ne\n\nabs\n\n%&\nD\n\uf028 t \uf029 \uf0ba D& \uf028 t \uf029 \uf02d 2\uf0f2 drn \uf028 r, t \uf029 uabs \uf028 r \uf029 r Ne \uf028 t \uf029,\n%\nW& \uf028 t \uf029 \uf0ba W& \uf028 t \uf029 \uf02d 2 dru \uf028 r \uf029 v \uf028 r, t \uf029 n \uf028 r, t \uf029 \uf02d\next\n\nRe \uf0e5 \uf0f2\ni .\uf073\n\n& \uf03d\uf02d\nwhere D\n\n\uf028 \uf0f2 dr \uf0d1 \uf0d7 j \uf028 r, t \uf029 r\n\next\n\ndr \uf06ai\uf073\n\n\uf028 r, t \uf029\n\n*\n\n\uf0f2\n\nuabs \uf028 r \uf029\n\nabs\n\n(37)\n\nS\n\n\uf0d12\uf06ai\uf073\n\n\uf028 r, t \uf029,\n\n\uf029\n\nNe \uf02b D \uf0b4 N& e Ne . Also, note that N& \uf073 \uf028 r, t \uf029 (Eq. (29)) and E& XC (Eq. (33)) should be changed in corres-\n\npondence to Eq. (37) and (36), respectively.\nAn important numerical issue is connected with the inherent singularity of the Lagrange multiplier Ad \uf02b1 \uf028 t \uf029 , related to the EB condition. In\nthe linear response regime, the deviation from the exact EB is \uf044E& XC ,1 \uf0bb\nhand sides of the corresponding linear equation,\n\n\uf0f9 &\nXC \uf028 r \uf029 \uf02d w XC \uf028 r \uf029 \uf0fa\uf0fb n1 \uf028 r, t \uf029 . Looking at the left and right\n\uf0f2 dr \uf0e9\uf0ea\uf0eb vexact\n\n\uf0e5 Ld \uf02b1,i \uf028 t \uf029 Ai \uf028 t \uf029 \uf03d Bd \uf02b1 \uf028 t \uf029 , we can see that\ni\n\nLd \uf02b1,1..d , Ld \uf02b1,d \uf02b 2 , Bd \uf02b1 : o \uf028 n&1 \uf029 ,\nLd \uf02b1,d \uf02b1 \uf03d\n\n\uf0e5 \uf0f2 drl2\uf073 \uf028 r, t \uf029\n\n2\n\n\uf073\n\n: o \uf028 n&12 \uf029 .\n\nTherefore, Ad \uf02b1 \uf028 t \uf029 : o \uf028 1 n&1 \uf029 . The consequence of this divergence for n& 1 \uf0ae 0 is the need for significantly smaller time-steps, down to\n10\uf02d4 \uf02d 10\uf02d5 a.u., which makes calculations impractical. Furthermore, negative values of Ad \uf02b1 may yield 'hydrodynamical' instabilities, while\nanalyzing the quantum equation of motion for the current density (see Appendix B). Therefore, in order to overcome this singularity and other\nr\npotential numerical instabilities, we calculate A from a set of regularized linear equations, as is described in appendix B. As a result, the EB\ncondition will be preserved on the average, approximately, while the other conditions will be preserved exactly.\n13\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fD.\n\nAPPLICATIONS TO ELECTRON DYNAMICS IN SODIUM CLUSTERS\n\n\uf073\nFor the TD case, we test our constraining method on electron dynamics in small sodium clusters. We tested the performance of vXC\n\uf028 r, t \uf029 ,\n\uf073\nwhere w XC\n\uf028 r, t \uf029 is taken as the TD version of the xKLI (TD-xKLI) potential, as defined by substituting the TD orbitals\n\n\uf07b \uf06ai\uf073 \uf028 r, t \uf029 \uf07d\n\nin the\n\n\uf073\nwxKLI\nof Eq. (21). We mainly focus on the case of Na 5 , where pathological behavior had already reported by Mundt and Kummel (MK), in\n\nRef. 22. MK found that for weak initial perturbation of Na 5 (initially in the GS) treated by xKLI, the TD dipole moment is unphysically amplified,\ncorresponding to ZF violation. We do confirm their observation for the case of a short weak driving field. Moreover, even when we enforce ZF,\nZT, and the VT during the propagation, the Na 5 dipole moment is also unphysically amplified, after some tens of fs,. Furthermore, enforcing\nboth EB and ZF does not yield better results, since EB is only preserved approximately, due to the singularity discussed above (see IIIC). On the\n38\nother hand, for other clusters like Na 4 , Na+\n5 , and Na 6 , we do not face such unphysical excitations (despite the ZF and EB violations).\n\nOur method, despite its inefficiency for finite time-interval driving field, is applicable when (either weak or strong) CW field is applied. In this\n2\n2\ncase, the CW field generates an oscillating N& \uf028 r, t \uf029 field, where N& \uf028 r, t \uf029 \uf0ae 0 for short periods. During such periods, our regularization pre-\n\nvents catastrophic timestep reductions, and in turn, the EB condition is recovered at other nonsingular time intervals.\nWe present some typical results of electron dynamics in the model Na5 cluster. The cluster geometry is a planar \uf028 x \uf02d y \uf029 trapezoid,39 where\nthe bases are parallel to the x-axis. Also, we slightly broke symmetry within the x-y plane, to make the problem more general. The sodium\natoms are located at the following x-y coordinates: (7.36, \uf02d2.9) , (\uf02d7.06, \uf02d2.9) , (\uf02d0.1, \uf02d2.9) , (3.6, 4) and (\uf02d3.8, 4.7) . We used a local\npseudopotential for the s-electron of each sodium atom, described in Ref. 38.\nFollowing the SCF calculation, we apply a CW laser field:\n\n\uf028\n\nvlaser \uf028 r, t \uf029 \uf03d \uf02dx \uf0b4 E 0 sin2 \uf070 T\n\np\n\n\uf029 cos \uf028 \uf077\n\nopt t\n\n\uf029,\n\n(38)\n\nwhere \uf077opt \uf0ba 2\uf070 Topt is the optical laser frequency, Tp is the laser pulse duration, and E 0 is the amplitude. For a given vlaser we compare\nfour calculations: TDHF, and three TD-xKLI models having the general form\n\uf073\nvXC\n\uf028 r, t \uf029 \uf03d\n\n\uf073\nwxKLI\n\uf028 r, t \uf029 \uf02b a1 \uf028 t \uf029 \uf0d7 \uf0d1n\uf073 \uf028 r, t \uf029 \uf02b a2 \uf028 t \uf029 N& \uf073 \uf028 r, t \uf029 ,\n\n(39)\n\nFor TD-xKLI without any constraints: a1 \uf028 t \uf029 \uf0ba 0, a2 \uf028 t \uf029 \uf0ba 0 . For TD-xKLI-ZF: a2 \uf028 t \uf029 \uf0ba 0 , and for TD-xKLI-ZF-EB we fit both a1 and a2 . Recall\nthat since ionization is involved we include the absorbing potential, Eq. (35), in the TDKS Hamiltonian. Therefore, the tilda quantities, defined\n14\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fin Eq. (37), are substituted in Eq.(39). Also, for consistency (and simplicity) we enforced exactly the same constraints at the SCF stage for each\nmodel (e.g. for TD-xKLI-ZF/TD-xKLI-ZF-EB, only ZF is enforced in the SCF).\nAs diagnostics, we record the TD dipole moment d \uf028 t \uf029 \uf0ba\n\n\uf0f2 drn \uf028 r, t \uf029 r , the total number of ionized electrons, N I \uf028 t \uf029 \uf0ba Ne \uf028 0 \uf029 \uf02d Ne \uf028 t \uf029 ,\n\nthe energy conservation parameter \uf044EB \uf028 t \uf029 \uf0ba E \uf028 t \uf029 \uf02d W%ext \uf028 t \uf029 , and the moment of inertia tensor, \uf07b I \uf028 t \uf029 \uf07d \uf03d\nij\n\n\uf0f2 drn \uf028 r, t \uf029 \uf0e9\uf0eb\uf0ea r 2\uf064ij\n\n\uf02d rirj \uf0f9\uf0fa .\n\uf0fb\n\n2\nFinally, at the end of the time propagation we also calculate the emission power spectra of dx \uf028 t \uf029 : Px \uf028 \uf077 \uf029 \uf0ba \uf077 2d%x \uf028 \uf077 \uf029 , where d%x \uf028 \uf077 \uf029 is\n\nthe Fourier transform of dx \uf028 t \uf029 . We performed all calculations on a 75 \uf0b4 45 \uf0b4 45 a 03 Cartesian grid, where a uniform mesh spacing,\n\uf044x \uf03d \uf044y \uf03d \uf044z \uf03d 1a0 , was used. We used optimized parameter values, n \uf03d 3 , \uf068 \uf03d 10\uf02d4 and a \uf03d 17a 0 for the absorbing potential in Eq.\n(35).\nWe present here calculations for three different laser pulses (LP), summarized in Table 3.\nTable III. The properties of 3 laser pulses used here (see Eq. (38)).\nLabel E 0 \uf028 H\n\na0\n\n\uf029\n\n\uf077opt \uf028 a.u. \uf029\n\nTp Topt\n\nIlaser \uf028 W/cm 2 \uf029\n\nLP1\n\n0.001\n\n0.05\n\n15 \uf028 :\n\n46fs \uf029\n\n3.5 \uf0b4 1010\n\nLP2\n\n0.01\n\n0.05\n\n16 \uf028 :\n\n49fs \uf029\n\n3.5 \uf0b4 1012\n\nLP3\n\n0.01\n\n0.04\n\n13 \uf028 :\n\n50fs \uf029\n\n3.5 \uf0b4 1012\n\nThe results for the energy conservation parameter, \uf044EB \uf028 t \uf029 , are depicted in FIG. 1, for each laser pulse shown in Table III. For LP1 (FIG. 1a)\nand LP2 (FIG. 1b), we see a consistent hierarchy, where xKLI-ZF-EB is the most energy conserving model and xKLI is least conserving. In FIG. 1c,\non the other hand, we notice that the xKLI-ZF is the worst model for energy conservation. For this case, we checked numerical convergence\nwith respect to both time step size and spatial meshing, resulting in similar results -- we note that \uf044EB increasing is due to both W%ext decreasing and the total energy,E , increasing. Typically, xKLI-ZF-EB conserves energy to about a few times 10\uf02d2 a.u. , while the other KLI-models\nare only good to about 0.1a.u. or more. On the other hand, the energy conservation of the TDHF method is 3-4 orders of magnitude better\nthan xKLI-ZF-EB. The characteristic total work, W%ext \uf028Tp \uf029 , is : 0.02 \uf02d 0.05 a.u. for LP1, : 1.2 \uf02d 1.5 a.u. for LP2 and : 0.22 \uf02d 0.8 a.u. for\nLP3, where 0.22 a.u. refers to TD-xKLI-ZF, while the rest are : 0.7 \uf02d 0.8 a.u.\n15\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fIn FIG. 2 we compare the total number of ionized electrons for each model, resulting from the LP2 and LP3 pulses. Here, again, xKLI-ZF-EB results are the KLI model that is closest to TDHF. It is also interesting to see, again, that xKLI-ZF is not necessarily a better model for ionization\nthan xKLI, as is shown in FIG. 2a. In FIG. 3 we show the 'transversal dynamics', for LP3, characterized by the moment of inertia eigenvalue related to the x-axis (general) direction. This quantity indicates the electron density distribution, perpendicular to the laser field direction. Here,\nat the initial stage of the dynamics, up to 700-800 a.u., all KLI models and HF seem quite similar, while at the final stage, xKLI-ZF-EB and HF\nremain close and seem separated from the other KLI models.\nFinally, we compare the emission power spectra for LP2, in FIG. 4, where each xKLI model is compared individually to the HF spectra. Here,\nxKLI-ZF-EB does not exhibit better results, as it did for the previously discussed quantities. For instance, the first three harmonics in FIG. 4 look\nsimilar for all three xKLI models, and it is only for a few harmonics, e.g. the 9th harmonic, that xKLI-ZF-EB looks notably most similar to the HF\nspectra. Furthermore, for the very high harmonics, not shown here, xKLI-ZF-EB continues to be similar to the other xKLI models (all overestimate the power spectra with respect to HF).\n\nIV.DISCUSSIONS AND CONCLUSIONS\nWe have developed a practical method that constrains any given XC potential to preserve some exact conditions. The method is numerically stable and efficient, for both DFT and TDDFT. We tested the performance of constrained xKLI potentials for both time-dependent and independent cases. In the time-independent case, the GS results are negligibly different to the non-conserving xKLI results, for some H-chains and\nsmall sodium clusters. We found very small and small overestimations of the first and second polarizabilities, respectively, with respect to xKLI\nwhen constraints are satisfied. We explain this overestimation by the introduction of a very small amount of self-interaction via the local denr\nr\nsity correction, AX \uf0d7 \uf047\uf073 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r \uf029 , in Eq. (17). We conclude that preserving exact conditions does not yield worthwhile improvements for the\n\nexamples discussed.\nOn the other hand, our method for ensuring constraints are satisfied is important for the TD case, and does exhibit improved results with respect to TDHF. We demonstrated the importance of preserving both ZF and EB during the time-propagation. The xKLI-ZF-EB method preserves\nenergy typically by at least by an order of magnitude better than the other xKLI models. It also least overestimates total ionization relative to\nTDHF, and has 'transversal dynamics' that is more similar to TDHF than the other xKLI models. On the other hand, the emission power spectrum via xKLI-ZF-EB is not significantly improved relative to xKLI.\nThe main problem that prevents full energy conservation is likely to be the lack of EB, even in first order, as is explained in Sec. IIIC. To overcome this problem we suggest a possible alternative method, which unfortunately cannot be applied in our numerical code. Since time40\nindependent OEP can be done relatively routinely now, we suggest calculating the GS, first, by the exact OEP, wOEP \uf028 r \uf029 , and then, propa-\n\ngate by the TD-AOEP: wAOEP \uf028 r, t \uf029 \uf02d wAOEP \uf028 r \uf029 \uf02b wOEP \uf028 r \uf029 and its constrained versions. It is clear, that in first order, the EB deviation will\n16\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fbe \uf044E XC ,1 \uf028 t \uf029 \uf03d 0 (see sec. IIIC). Consequently, the singularity should also disappear, and therefore the constraints can be applied without\ndivergences (see Sec. IIIC).\nIt should also be reiterated that constraining approximate OEP's to ensure known exact conditions are satisfied is treating symptoms (violation of such conditions) rather than the disease that is causing those symptoms (which is the failure of AOEP's to be a complete functional\nderivative of an XC energy functional). In this respect, the improvements obtained for time-dependent observables are encouraging, but the\nunderlying limitation remains.\nFinally, some insight about the, as yet unexplained, TD-OEP instability17 may be gleaned from this problem regarding the stability of the EB\nconstraint. Recall that the term a2N& \uf028 r, t \uf029 in Eq. (39) may yield a 'hydrodynamical' instability. As explained in Appendix B, an explicit currentdensity dependent XC potential may yield a 'negative viscosity' term in the current-density evolution equation, resulting in in numerical instabilities. Unfortunately, such terms appear in the regular version of TD-OEP,16 developed by Ullrich, Gossmann and Gross (see Eqs. (18),(19) in\nRef. 16). We therefore suggest checking this issue at least for simple cases.\n\nACKNOWLEDGEMENTS\nWe would like to thank Dr. Leeor Kronik and Prof. Stephan Kummel, for providing us their detailed calculations, regarding hyperpolarizabilities\nof H-chains. Also, Y.K. gratefully thanks Prof. Roi Baer and his research group, for hosting his numerical code, patiently, on their computers\ncluster, 'CUBIOT'. This work was supported by the Director, Office of Science, Office of Basic Energy Sciences, of the US Department of Energy\nunder contract DE-AC02-05CH11231 (the Ultrafast X-ray Science Laboratory).\n\n17\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fFIG. 1 Energy conservation (right scale) and field strength (left scale) vs. time for the laser pulses: a) LP1, b) LP2, c) LP3.\n\n18\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fFIG. 2 Total number of ionized electrons (right scale) and field strength (left scale) vs. time for the laser pulses: a) LP2, b) LP3. (Ionization for\nLP1 is very weak for all models, therefore is not depicted).\n\nFIG. 3 Transverse dynamics: moment of inertia eigenvalue I 1 \uf028 a 20 \uf029 (right scale) and field strength (left scale) vs. time, for laser pulse LP3.\n\n19\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fFIG. 4 Emission power spectra (arb. units) vs. harmonic number for laser pulse LP2. Each of the models (green lines) in the\nFigs. a) TD-xKLI-ZF-EB, b) TD-xKLI-ZF, c) TD-xKLI, is compared to TDHF (red lines) emission power spectra.\n20\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fAPPENDIX A: TRANSLATIONAL AND ROTATIONAL COVARIANCE PROOFS\nWe prove in this appendix the GC of the time-independent constrained X,C potentials, vX\uf073 ,C (Eq. (17)) , and the TC of the TD\nXC potential of Eq. (30).\nConsider two fixed Cartesian coordinates systems, r \uf0a2 and r . Under translation with an arbitrary vector, x , the density is\ntransformed as\nn \uf073\uf0a2 \uf028 r \uf029 \uf03d n\uf073 \uf028 r \uf02b x \uf029 ,\nn \uf0a2 \uf028 r \uf029 \uf0ba \uf0e5 n\uf073\uf0a2 \uf028 r \uf029 \uf03dn \uf028 r \uf029 ,\n\n(A1)\n\n\uf073\n\nthe CM position transforms as:\n\nD \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf03d\n1\nNe\n\n1\nNe\n\n\uf0f2 drn \uf0a2 \uf028 r \uf029 r \uf03d\n\n\uf0f2 drn \uf028 r \uf02b x \uf029 r \uf03d D \uf0e9\uf0eb n \uf0f9\uf0fb \uf02d x,\n\n(A2)\n\nand correspondingly the \uf047i\uf0a2s transform as :\ng1\uf073 \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf029 \uf0ba \uf0d1n\uf073\uf0a2 \uf028 r \uf029 \uf03d \uf0d1n \uf073 \uf028 r \uf02b x \uf029 \uf03d g1\uf073 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r \uf02b x \uf029 ,\ng2\uf073 \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf029 \uf0ba \uf0d1 \uf0b4 \uf0e9\uf0eb \uf028 r \uf02d D\uf0a2 \uf029 n\uf073\uf0a2 \uf028 r \uf029 \uf0f9\uf0fb \uf03d\n(A3)\n\uf0d1 \uf0b4 \uf0e9\uf0eb \uf028 r \uf02d D \uf02b x \uf029 n\uf073 \uf028 r \uf02b x \uf029 \uf0f9\uf0fb \uf03d g2\uf073 \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf02b x \uf029 ,\ng 3\uf073 \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf029 \uf0ba \uf0d1 \uf0d7 \uf0e9\uf0eb \uf028 r \uf02d D\uf0a2 \uf029 n \uf073\uf0a2 \uf028 r \uf029 \uf0f9\uf0fb \uf03d\n\uf0d1 \uf0d7 \uf0eb\uf0e9 \uf028 r \uf02d D \uf02b x \uf029 n\uf073 \uf028 r \uf02b x \uf029 \uf0fb\uf0f9 \uf03d g 3\uf073 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r \uf02b x \uf029 .\nr\nThe matrix G X ,C and the vector B X ,C , in Eqs. (20), are constructed as spatial integrations of the \uf07b \uf047i \uf07d and the original potential w X\uf073 ,C . The former is assumed to be TC, therefore,\nt\nt\nG \uf0a2X ,C \uf03d G X ,C ,\nr\nr\nB \uf0a2X ,C \uf03d B X ,C ,\nr\nt\n\uf02d1 r\nA\uf0a2X ,C \uf03d \uf028G \uf0a2X ,C \uf029 B \uf0a2X ,C \uf03d\nr\nt\n\uf02d1 r\n\uf028G X ,C \uf029 B X ,C \uf03d AX ,C ,\n\n(A4)\n\n21\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fand thus\nr\nr\nr\nr\nA\uf0a2X ,C \uf0d7 \uf047 \uf0a2 \uf028 r \uf029 \uf03d AX ,C \uf0d7 \uf047 \uf028 r \uf02b x \uf029 ,\n\n(A5)\n\n\uf073\nis TC.\ni.e. vXC\n\nHence, under a rigid transformation by d \uf0b4 d rotation matrix M , the density and the CM transform as\n\nTogether\n\nn \uf0a2 \uf028 r \uf029 \uf03d n \uf028 Mr \uf029 ,\n\nD \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf03d\n\n1\nNe\n\nwith\n\nthe\n\n\uf0f2 drn \uf028 Mr \uf029 r \uf03d M\nnabla\n\nand \uf0e9\uf0eb \uf0d1f \uf0f9\uf0fb i \uf028 r \uf029 \uf0ba \uf0b6f \uf028 R \uf029 \uf0b6Ri\n\n\uf02d1\n\ntransformation \uf0e9\uf0eb \uf0d1f \uf0f9\uf0fb\n\nR\uf03dr\n\n(A6)\n\nD \uf0e9\uf0eb n \uf0f9\uf0fb .\n\ni\n\n\uf028 r \uf0a2 \uf029 \uf03d \uf028 M \uf02d1 \uf029ij \uf0e9\uf0eb \uf0d1f \uf0f9\uf0fb j \uf028 Mr \uf029 ,\n\n, we find that\ng1\uf073 \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf029 \uf03d M \uf02d1g1\uf073 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 Mr \uf029 ,\ng2\uf073 \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf029 \uf03d M \uf02d1g\uf0732 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 Mr \uf029 , (A7)\ng 3\uf073 \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf029 \uf0ba g 3\uf073 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 Mr \uf029 .\n\nr\nHence, the matrix G X ,C and the vector B X ,C , transform, by construction again, as\nt\nt\nG \uf0a2X ,C \uf03d OGOT ,\nr\nr\nB \uf0a2X ,C \uf03d O\uf062 X ,C ,\n\n(A8)\n\nwhere the \uf028 2d \uf02b 1 \uf029 \uf0b4 \uf028 2d \uf02b 1 \uf029 matrix O is\n\uf0e6M\n\uf0e7\uf0e7\nO \uf03d \uf0e7\uf0e7\uf0e7\n\uf0e7\uf0e7\n\uf0e7\uf0e8\n\nM\n\n\uf0f6\uf0f7\n\uf0f7\uf0f7\uf0f7\n\uf0f7\uf0f7\n\uf0f7\n1 \uf0f7\uf0f8\uf0f7\n\n(A9)\n\n(d is the spatial dimensions).\nThus, following Eq. (A8), the equation\nr\nt\nr\nG \uf0a2X ,C \uf0d7 A\uf0a2X ,C \uf03d B \uf0a2X ,C ,\n\n(A10)\n22\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\nwhere\n\nf is\n\na\n\nscalar\n\nfunction,\n\n\fcan be rewritten as\nr\nt\nr\nOG X ,C OT \uf0d7 A\uf0a2X ,C \uf03d OB X ,C .\n\n(A11)\n\nTherefore\nr\nt\nA\uf0a2X ,C \uf03d O \uf028G X ,C\n\n\uf029\n\n\uf02d1\n\nr\nr\n\uf0d7 B X ,C \uf03d OAX ,C ,\n\n(A12)\n\nand\nr\nr\nr\nr\nA\uf0a2X ,C \uf0d7 \uf047 \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r \uf029 \uf03d AX ,C OT \uf0d7 O \uf047 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 Mr \uf029 \uf03d\nr\nr\n(A13)\nAX ,C \uf0d7 \uf047 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 Mr \uf029 .\ni.e. combining (A5) and (A13), vX\uf073 ,C is fully GC.\nFor the TD case we restrict ourselves to TC only. Thus, consider two Cartesian systems, r \uf0a2 and r , distinguished by a TD\ntranslational vector x \uf028 t \uf029 , r \uf0a2 \uf03d r \uf02b x \uf028 t \uf029 , the density and its CM are transformed as\nn \uf073\uf0a2 \uf028 r, t \uf029 \uf03d n \uf073 \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 ,\n1\ndrn \uf0a2 \uf028 r, t \uf029 r \uf03d\nD \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf03d\n(A14)\nNe \uf028 t \uf029 \uf0f2\n1\ndrn \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 r \uf03d D \uf0e9\uf0eb n \uf0f9\uf0fb \uf02d x \uf028 t \uf029 .\nNe \uf028 t \uf029 \uf0f2\nThus, similarly to Eq. (A3),\nl1\uf073 \uf0e9\uf0eb n \uf0a2 \uf0f9\uf0fb \uf028 r, t \uf029 \uf03d l1\uf073 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r \uf02b x \uf028 t \uf029, t \uf029,\nl 3\uf073 \uf0eb\uf0e9 n \uf0a2 \uf0f9\uf0fb \uf028 r, t \uf029 \uf03d l1\uf073 \uf0e9\uf0eb n \uf0f9\uf0fb \uf028 r \uf02b x \uf028 t \uf029 , t \uf029.\n\n(A15)\n\nHence, from the continuity equation,\n\uf0d1 \uf0d7 j\uf073\uf0a2 \uf028 r, t \uf029 \uf03d\n(A16)\n\uf0d1 \uf0d7 j\uf073 \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 \uf02d \uf0d1n \uf073 \uf028 r \uf02b x \uf028 t \uf029, t \uf029 \uf0d7 x& \uf028 t \uf029,\nand together with the transformation of the CM velocity\n\n23\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\f& \uf0e9n\uf0a2 \uf0f9 \uf03d D\n& \uf0e9 n \uf0f9 \uf02d x& \uf028 t \uf029 ,\nD\n\uf0eb \uf0fb\n\uf0eb \uf0fb\n\n(A17)\n\nwe conclude that l2\uf073 transforms as a scalar:\n& \uf0e9n\uf0a2 \uf0f9 \uf0f9 \uf03d\nl2\uf0a2\uf073 \uf028 r, t \uf029 \uf03d N& \uf073 \uf028 r, t \uf029 \uf03d \uf02d\uf0d1 \uf0d7 \uf0e9\uf0eb j\uf073\uf0a2 \uf028 r, t \uf029 \uf02d n \uf073\uf0a2 \uf028 r, t \uf029 D\n\uf0eb \uf0fb\uf0fb\n\uf02d \uf07b \uf0d1 \uf0d7 j\uf073 \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 \uf02d \uf0d1n\uf073 \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 \uf0d7 x& \uf028 t \uf029 \uf07d \uf02d\n& \uf0e9 n \uf0f9 \uf02d \uf0d1n \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 x& \uf028 t \uf029 \uf07d \uf03d (A18)\n\uf02d \uf07b \uf0d1n \uf073 \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 D\n\uf073\n\uf0eb \uf0fb\nN& \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 \uf03d l \uf073 \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 .\n\uf073\n\n2\n\nr\nSince the matrix L \uf028 t \uf029 and the vector B X ,C (see Eq. (32)) are, again, constructed from spatial integration of TC terms, they\ntransform as in the time-independent case, i.e.\nt\nt\nL \uf0a2 \uf028 t \uf029 \uf03d L \uf028 t \uf029,\nr\nr\nB \uf0a2 \uf028t \uf029 \uf03d B \uf028t \uf029.\n\n(A19)\n\nTherefore, repeating the same proof for the time-independent case, we can conclude that\nr\nr\nA\uf0a2 \uf028 t \uf029 \uf0d7 \uf04c\uf073\uf0a2 \uf028 r, t \uf029 \uf03d A \uf028 t \uf029 \uf0d7 \uf04c\uf073 \uf028 r \uf02b x \uf028 t \uf029 , t \uf029 ,\n\n(A20)\n\n\uf073\nand that TD vXC\nin Eq. (30) is TC.\n\nAPPENDIX B: AVOIDING SINGULARITY AND 'HYDRODYNAMICAL' INSTABILITY\nThe singularity of Eqs. (32) arises from the matrix element Ld \uf02b1,d \uf02b1 \uf028 t \uf029 \uf03d\n\n\uf0f2 drN& \uf028 r, t \uf029\n\n2\n\n, when N& \uf028 r, t \uf029 \uf0ae 0 . Therefore, we\n\nregularize it by adding a small positive term, \uf065 \uf028 t \uf029 , e.g.\nLrd \uf02b1,d \uf02b1 \uf028 t \uf029 \uf03d Ld \uf02b1,d \uf02b1 \uf028 t \uf029 \uf02b \uf065 \uf028 t \uf029 ,\n\uf065 \uf028 t \uf029 \uf03d max \uf07b \uf0650 / (1 \uf02b t )n , \uf065min \uf07d ,\n\n(B1)\n\nwhere the following values yielded good results: \uf0650 : 10\uf02d6 \uf02d 107 , \uf065min : 10\uf02d8 \uf02d 10\uf02d10 and n \uf03d 2 . Predicting the best\nregularization parameters is a nontrivial task. Therefore, in addition, we smoothly cut off the Lagrange multiplier\na2 \uf028 t \uf029 \uf0ba Ad \uf02b1 \uf028 t \uf029 , i.e.\n24\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\f\uf0ec\uf0efa2 \uf028 t \uf029, 0 \uf0a3 a2 \uf028 t \uf029 \uf0a3 \uf061max ,\n\uf0ef\uf0ef\na2c \uf028 t \uf029 \uf03d \uf0ed\uf0ef \uf0ea\uf0e9 1 \uf02b \uf028a2 \uf028 t \uf029 \uf02d \uf061max \uf029 2a2 \uf028 t \uf029 \uf0fa\uf0f9 \uf061max , a2 \uf028 t \uf029 \uf03e \uf061max ,\n\uf0eb\n\uf0fb\n\uf0ef\n\uf0ef\n\uf0ef\n0,\na\nt\n0,\n\uf03c\n\uf028\n\uf029\n2\n\uf0ef\n\uf0ee\n\n(B2)\n\nWe take 500 \uf03c \uf061max \uf03c 800 . It is also necessary to cut off a2 \uf028 t \uf029 from below, to prevent negative values of a2 \uf028 t \uf029 . The reason is a 'hydrodynamical' instability which is related to the current-density equation of motion\ndj \uf028 r, t \uf029 dt \uf03d\nT \uf028 r, t \uf029 \uf02d n \uf028 r, t \uf029 \uf0d1 \uf0e9\uf0eb vext \uf028 r, t \uf029 \uf02b vH \uf028 r, t \uf029 \uf02b vXC \uf028 r, t \uf029 \uf0f9\uf0fb ,\nwhere\n\nT \uf028 r, t \uf029 \uf03d i \uf0e9\uf0ea\uf0ebT\u02c6, \u02c6j \uf0f9\uf0fa\uf0fb .\n\nIn\n\nthis\n\nequation\n\nthe\n\nconstrained\n\nvXC\n\ncontributes\n\na\n\nviscosity-like\n\nterm:\n\na2 \uf028 t \uf029 n \uf028 r, t \uf029 \uf0d1 \uf0e9\uf0eb \uf0d1 \uf0d7 j \uf028 r, t \uf029 \uf0f9\uf0fb , and thus it is clear that negative viscosity coefficient a2 \uf028 t \uf029 values yield a numerical instability.\nWe also confirm this behavior numerically, when a2 \uf028 t \uf029 was not cut off from below. In this case, significant unphysical noise\nand amplification emerges in the very high harmonics of the emission spectra.\nIt should be obvious that following cutoffs, the EB condition will not be preserved exactly. Therefore, in order to compensate for this on the average, we replace Bd \uf02b1 \uf028 t \uf029 by Bdr \uf02b1 \uf028 t \uf029 \uf03d \uf028 E \uf028 t \uf029 \uf02d Wext \uf028 t \uf029 \uf029 \uf074 \uf02b Bd \uf02b1 \uf028 t \uf029 . Here E \uf028 t \uf029 and Wext \uf028 t \uf029\nare defined through Eq.(27), and \uf074 : 0.1 \uf02d 1 a.u. is recommended.\nIn summary, the calculation of the Lagrange multipliers is done as follows:\n\ni)\n\nSolve Eqs. (32) following replacing Ld \uf02b1,d \uf02b1 \uf028 t \uf029 and Bd \uf02b1 \uf028 t \uf029 by Lrd \uf02b1,d \uf02b1 \uf028 t \uf029 and Bdr \uf02b1 \uf028 t \uf029 , respectively.\n\nii)\n\nCalculate a2c \uf028 t \uf029 from Eq. (B2), if a2 \uf028 t \uf029 was cutoff by, recalculate the other Lagrange's multipliers for the fixed Lagrange's multiplier Adc \uf02b1 \uf0ba a2c , from the linear equations\nr\n%t\n%r\nL \uf028 t \uf029 A \uf028 t \uf029 \uf03d B \uf028 t \uf029,\n\n(B3)\n\nt\n%t\nwhere L and L are identical except for the d \uf02b 1 row; L%d \uf02b1, j \uf028 t \uf029 \uf03d \uf064j .d \uf02b1 , and B% and B are identical except for the\nd \uf02b 1 entity; B%d \uf02b1 \uf028 t \uf029 \uf03d a2c \uf028 t \uf029 .\n25\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\fReferences\n1\n\nP. Hohenberg and W. Kohn, Phys. Rev. 136, B864 (1964).\n\n2\n\nW. Kohn and L. J. Sham, Phys. Rev. 140, A1133 (1965).\n\n3\n\nC. Fiolhais, F. Noqueria, and M. A. L. Marques, LECTURE NOTES IN PHYSICS: A Primer in Density Functional Theory\n(Springer-Verlag, Berlin, 2003).\n\n4\n\nMarques M. A. L. , Nogueira F. , Ullrich C.A., et al., TDDFT, Lecture notes (Springer-Verlag, 2006).\n\n5\n\nE. Runge and E. K. U. Gross, Phys. Rev. Lett. 52, 997 (1984).\n\n6\n\nR. G. Parr and W. Yang, Density Functional Theory of Atoms and Molecules (Oxford University Press, Oxford, 1989).\n\n7\n\nS. Kuemmel and L. Kronik, Rev. Mod. Phys. 80, 3 (2008).\n\n8\n\nJ. D. Talman and W. F. Shadwick, Phys. Rev. A 14, 36 (1976).\n\n9\n\nJ. D. Talman, Comput Phys Commun 54, 85 (1989).\n\n10\n\nJ. B. Krieger, L. Yan, and G. J. Iafrate, Phys. Rev. A 45, 101 (1992).\n\n11\n\nM. Gruning, O. V. Gritsenko, and E. J. Baerends, J. Chem. Phys. 116, 6435 (2002).\n\n12\n\nF. Della Sala and A. Gorling, J. Chem. Phys. 115, 5718 (2001).\n\n13\n\nA. F. Izmaylov, V. N. Staroverov, G. E. Scuseria, et al., J. Chem. Phys. 127, 6 (2007).\n\n14\n\nS. Kummel and J. P. Perdew, Phys. Rev. B 68, 15 (2003).\n\n15\n\nX. Chu and S. I. Chu, Phys. Rev. A 63, 023411 (2001).\n\n16\n\nC. a. Ullrich, U. J. Gossmann, and E. K. U. Gross, Phys. Rev. Lett. 74, 872 (1995).\n\n17\n\nM. Mundt and S. Kummel, Phys. Rev. A 74, 7 (2006).\n\n18\n\nA. Stolow, A. E. Bragg, and D. M. Neumark, Chem. Rev. 104, 1719 (2004).\n\n19\n\nT. Pfeifer, L. Gallmann, M. J. Abel, et al., Phys. Rev. Lett. 97, 163901 (2006).\n\n20\n\nT. Pfeifer, M. J. Abel, P. M. Nagel, et al., Chem. Phys. Lett. 463, 11 (2008).\n\n21\n\nL. Zhi-Heng and S. R. Leone, J. Chem .Phys. 128, 204302 (2008).\n\n22\n\nM. Mundt, S. Kummel, R. van Leeuwen, et al., Phys. Rev. A 75, 4 (2007).\n\n23\n\nY. Kurzweil and R. Baer, Phys. Rev. B 77, 8 (2008).\n\n24\n\nY. Kurzweil and R. Baer, Phys. Rev. B 73, 13 (2006).\n\n25\n\nR. van Leeuwen and E. J. Baerends, Phys Rev A 49, 2421 (1994).\n26\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\f26\n\nM. Levy and J. P. Perdew, Phys. Rev. A 32, 2010 (1985).\n\n27\n\nN. O. Folland, Phys. Rev. B 34, 8296 (1986).\n\n28\n\nS. Kummel, L. Kronik, and J. P. Perdew, Phys. Rev. Lett. 93, 4 (2004).\n\n29\n\nS. K\u00fcmmel and L. Kronik, Comput. Mater. Sci. 35, 321 (2006).\n\n30\n\nF. Gygi, Phys. Rev. B 48, 11692 (1993).\n\n31\n\nR. van Leeuwen, Phys. Rev. Lett. 80, 1280 (1998).\n\n32\n\nY. Kurzweil and R. Baer, J. Chem. Phys. 121, 8731 (2004).\n\n33\n\nY. Kurzweil and R. Baer, Phys. Rev. B 72, 035106 (2005).\n\n34\n\nG. Vignale, Phys. Rev. Lett. 74, 3233 (1995).\n\n35\n\nJ. F. Dobson, Phys. Rev. Lett. 73, 2244 (1994).\n\n36\n\nP. Hessler, J. Park, and K. Burke, Phys. Rev. Lett. 82, 378 (1999).\n\n37\n\nU. V. Riss and H. D. Meyer, J. Chem .Phys. 105, 1409 (1996).\n\n38\n\nS. Kummel, M. Brack, and P.-G. Reinhard, Phys. Rev B. 62, 7602 (2000).\n\n39\n\nI. Moullet, J. L. Martins, F. Reuse, et al., Phys. Rev. Lett. 65, 476 (1990).\n\n40\n\nS. K\u00fcmmel and J. P. Perdew, Phys. Rev. B 68, 035103 (2003).\n\n27\n\nPDF created with pdfFactory trial version www.softwarelabs.com\n\n\f"}