{"id": "http://arxiv.org/abs/0903.0291v1", "guidislink": true, "updated": "2009-03-02T13:25:57Z", "updated_parsed": [2009, 3, 2, 13, 25, 57, 0, 61, 0], "published": "2009-03-02T13:25:57Z", "published_parsed": [2009, 3, 2, 13, 25, 57, 0, 61, 0], "title": "Fluid limits for networks with bandwidth sharing and general document\n  size distributions", "title_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0903.3845%2C0903.1143%2C0903.3102%2C0903.0888%2C0903.3442%2C0903.0684%2C0903.4260%2C0903.4502%2C0903.2035%2C0903.4615%2C0903.0631%2C0903.0559%2C0903.5344%2C0903.3506%2C0903.0319%2C0903.4084%2C0903.3600%2C0903.3802%2C0903.0625%2C0903.0192%2C0903.4892%2C0903.0453%2C0903.3419%2C0903.1107%2C0903.4090%2C0903.4988%2C0903.1778%2C0903.1636%2C0903.4584%2C0903.4164%2C0903.0212%2C0903.0866%2C0903.2313%2C0903.1986%2C0903.0083%2C0903.3288%2C0903.4241%2C0903.0412%2C0903.1451%2C0903.5042%2C0903.4608%2C0903.4453%2C0903.0350%2C0903.2015%2C0903.4508%2C0903.0291%2C0903.3829%2C0903.3788%2C0903.3721%2C0903.3801%2C0903.2469%2C0903.3363%2C0903.1277%2C0903.2672%2C0903.4801%2C0903.2793%2C0903.3646%2C0903.4894%2C0903.4556%2C0903.1265%2C0903.3859%2C0903.0797%2C0903.0836%2C0903.0855%2C0903.3777%2C0903.2046%2C0903.1864%2C0903.3518%2C0903.2200%2C0903.0994%2C0903.1470%2C0903.4286%2C0903.4535%2C0903.4054%2C0903.3404%2C0903.3720%2C0903.3956%2C0903.5493%2C0903.2622%2C0903.3703%2C0903.3444%2C0903.5381%2C0903.3105%2C0903.1375%2C0903.5198%2C0903.4970%2C0903.5008%2C0903.1267%2C0903.2776%2C0903.3540%2C0903.0913%2C0903.4517%2C0903.4724%2C0903.3156%2C0903.2141%2C0903.4302%2C0903.2760%2C0903.4826%2C0903.1240%2C0903.5482%2C0903.4358&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "Fluid limits for networks with bandwidth sharing and general document\n  size distributions"}, "summary": "We consider a stochastic model of Internet congestion control, introduced by\nMassouli\\'{e} and Roberts [Telecommunication Systems 15 (2000) 185--201], that\nrepresents the randomly varying number of flows in a network where bandwidth is\nshared among document transfers. In contrast to an earlier work by Kelly and\nWilliams [Ann. Appl. Probab. 14 (2004) 1055--1083], the present paper allows\ninterarrival times and document sizes to be generally distributed, rather than\nexponentially distributed. Furthermore, we allow a fairly general class of\nbandwidth sharing policies that includes the weighted $\\alpha$-fair policies of\nMo and Walrand [IEEE/ACM Transactions on Networking 8 (2000) 556--567], as well\nas certain other utility based scheduling policies. To describe the evolution\nof the system, measure valued processes are used to keep track of the residual\ndocument sizes of all flows through the network. We propose a fluid model (or\nformal functional law of large numbers approximation) associated with the\nstochastic flow level model. Under mild conditions, we show that the\nappropriately rescaled measure valued processes corresponding to a sequence of\nsuch models (with fixed network structure) are tight, and that any weak limit\npoint of the sequence is almost surely a fluid model solution. For the special\ncase of weighted $\\alpha$-fair policies, we also characterize the invariant\nstates of the fluid model.", "summary_detail": {"type": "text/plain", "language": null, "base": "http://export.arxiv.org/api/query?search_query=&id_list=0903.3845%2C0903.1143%2C0903.3102%2C0903.0888%2C0903.3442%2C0903.0684%2C0903.4260%2C0903.4502%2C0903.2035%2C0903.4615%2C0903.0631%2C0903.0559%2C0903.5344%2C0903.3506%2C0903.0319%2C0903.4084%2C0903.3600%2C0903.3802%2C0903.0625%2C0903.0192%2C0903.4892%2C0903.0453%2C0903.3419%2C0903.1107%2C0903.4090%2C0903.4988%2C0903.1778%2C0903.1636%2C0903.4584%2C0903.4164%2C0903.0212%2C0903.0866%2C0903.2313%2C0903.1986%2C0903.0083%2C0903.3288%2C0903.4241%2C0903.0412%2C0903.1451%2C0903.5042%2C0903.4608%2C0903.4453%2C0903.0350%2C0903.2015%2C0903.4508%2C0903.0291%2C0903.3829%2C0903.3788%2C0903.3721%2C0903.3801%2C0903.2469%2C0903.3363%2C0903.1277%2C0903.2672%2C0903.4801%2C0903.2793%2C0903.3646%2C0903.4894%2C0903.4556%2C0903.1265%2C0903.3859%2C0903.0797%2C0903.0836%2C0903.0855%2C0903.3777%2C0903.2046%2C0903.1864%2C0903.3518%2C0903.2200%2C0903.0994%2C0903.1470%2C0903.4286%2C0903.4535%2C0903.4054%2C0903.3404%2C0903.3720%2C0903.3956%2C0903.5493%2C0903.2622%2C0903.3703%2C0903.3444%2C0903.5381%2C0903.3105%2C0903.1375%2C0903.5198%2C0903.4970%2C0903.5008%2C0903.1267%2C0903.2776%2C0903.3540%2C0903.0913%2C0903.4517%2C0903.4724%2C0903.3156%2C0903.2141%2C0903.4302%2C0903.2760%2C0903.4826%2C0903.1240%2C0903.5482%2C0903.4358&start=0&max_results=1000&sortBy=relevance&sortOrder=descending", "value": "We consider a stochastic model of Internet congestion control, introduced by\nMassouli\\'{e} and Roberts [Telecommunication Systems 15 (2000) 185--201], that\nrepresents the randomly varying number of flows in a network where bandwidth is\nshared among document transfers. In contrast to an earlier work by Kelly and\nWilliams [Ann. Appl. Probab. 14 (2004) 1055--1083], the present paper allows\ninterarrival times and document sizes to be generally distributed, rather than\nexponentially distributed. Furthermore, we allow a fairly general class of\nbandwidth sharing policies that includes the weighted $\\alpha$-fair policies of\nMo and Walrand [IEEE/ACM Transactions on Networking 8 (2000) 556--567], as well\nas certain other utility based scheduling policies. To describe the evolution\nof the system, measure valued processes are used to keep track of the residual\ndocument sizes of all flows through the network. We propose a fluid model (or\nformal functional law of large numbers approximation) associated with the\nstochastic flow level model. Under mild conditions, we show that the\nappropriately rescaled measure valued processes corresponding to a sequence of\nsuch models (with fixed network structure) are tight, and that any weak limit\npoint of the sequence is almost surely a fluid model solution. For the special\ncase of weighted $\\alpha$-fair policies, we also characterize the invariant\nstates of the fluid model."}, "authors": ["H. Christian Gromoll", "Ruth J. Williams"], "author_detail": {"name": "Ruth J. Williams"}, "author": "Ruth J. Williams", "links": [{"title": "doi", "href": "http://dx.doi.org/10.1214/08-AAP541", "rel": "related", "type": "text/html"}, {"href": "http://arxiv.org/abs/0903.0291v1", "rel": "alternate", "type": "text/html"}, {"title": "pdf", "href": "http://arxiv.org/pdf/0903.0291v1", "rel": "related", "type": "application/pdf"}], "arxiv_comment": "Published in at http://dx.doi.org/10.1214/08-AAP541 the Annals of\n  Applied Probability (http://www.imstat.org/aap/) by the Institute of\n  Mathematical Statistics (http://www.imstat.org)", "arxiv_primary_category": {"term": "math.PR", "scheme": "http://arxiv.org/schemas/atom"}, "tags": [{"term": "math.PR", "scheme": "http://arxiv.org/schemas/atom", "label": null}, {"term": "60K30 (Primary) 60F17, 90B15 (Secondary)", "scheme": "http://arxiv.org/schemas/atom", "label": null}], "pdf_url": "http://arxiv.org/pdf/0903.0291v1", "affiliation": "None", "arxiv_url": "http://arxiv.org/abs/0903.0291v1", "journal_reference": "Annals of Applied Probability 2009, Vol. 19, No. 1, 243-280", "doi": "10.1214/08-AAP541", "fulltext": "arXiv:0903.0291v1 [math.PR] 2 Mar 2009\n\nThe Annals of Applied Probability\n2009, Vol. 19, No. 1, 243\u2013280\nDOI: 10.1214/08-AAP541\nc Institute of Mathematical Statistics, 2009\n\nFLUID LIMITS FOR NETWORKS WITH BANDWIDTH SHARING\nAND GENERAL DOCUMENT SIZE DISTRIBUTIONS\nBy H. Christian Gromoll1 and Ruth J. Williams2\nUniversity of Virginia and University of California, San Diego\nWe consider a stochastic model of Internet congestion control,\nintroduced by Massouli\u00e9 and Roberts [Telecommunication Systems\n15 (2000) 185\u2013201], that represents the randomly varying number of\nflows in a network where bandwidth is shared among document transfers. In contrast to an earlier work by Kelly and Williams [Ann. Appl.\nProbab. 14 (2004) 1055\u20131083], the present paper allows interarrival\ntimes and document sizes to be generally distributed, rather than exponentially distributed. Furthermore, we allow a fairly general class\nof bandwidth sharing policies that includes the weighted \u03b1-fair policies of Mo and Walrand [IEEE/ACM Transactions on Networking\n8 (2000) 556\u2013567], as well as certain other utility based scheduling\npolicies. To describe the evolution of the system, measure valued\nprocesses are used to keep track of the residual document sizes of\nall flows through the network. We propose a fluid model (or formal\nfunctional law of large numbers approximation) associated with the\nstochastic flow level model. Under mild conditions, we show that the\nappropriately rescaled measure valued processes corresponding to a\nsequence of such models (with fixed network structure) are tight,\nand that any weak limit point of the sequence is almost surely a fluid\nmodel solution. For the special case of weighted \u03b1-fair policies, we\nalso characterize the invariant states of the fluid model.\n\n1. Introduction. Massouli\u00e9 and Roberts [18] have introduced and studied a model of Internet congestion control that represents the randomly\nReceived August 2006; revised March 2008.\nSupported in part by an NSF Mathematical Sciences Postdoctoral Research Fellowship, NSF Grant DMS-FRG-02-44323 and a European Union Marie Curie Postdoctoral\nResearch Fellowship.\n2\nSupported in part by NSF Grants DMS-03-05272 and DMS-06-04537.\nAMS 2000 subject classifications. Primary 60K30; secondary 60F17, 90B15.\nKey words and phrases. Bandwidth sharing, \u03b1-fair, flow level Internet model, congestion control, simultaneous resource possession, fluid model, workload, measure valued\nprocess, invariant manifold.\n1\n\nThis is an electronic reprint of the original article published by the\nInstitute of Mathematical Statistics in The Annals of Applied Probability,\n2009, Vol. 19, No. 1, 243\u2013280. This reprint differs from the original in pagination\nand typographic detail.\n1\n\n\f2\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nvarying number of flows in a network where bandwidth is shared dynamically among flows. The flows correspond to continuous transfers of individual elastic documents. This connection level model assumes a \"separation\nof time scales\" such that the time scale of the flow dynamics (of document\narrivals and departures) is much longer than the time scale of the packet\nlevel dynamics on which rate control schemes such as TCP converge to equilibrium.\nSubsequent to the work of Massouli\u00e9 and Roberts [18], assuming exponentially distributed document sizes, de Veciana, Lee and Konstantopoulos\n[5] and Bonald and Massouli\u00e9 [1] studied the stability of the flow level model\noperating under various bandwidth sharing policies. A bandwidth sharing\npolicy generalizes the notion of a processor sharing discipline from a single\nresource to a network with several shared resources. Lyapunov functions constructed in [5] for weighted max-min fair and proportionally fair policies, and\nin [1] for weighted \u03b1-fair policies (\u03b1 \u2208 (0, \u221e)) [19], imply positive recurrence\nof the Markov chain associated with the model when the average load on each\nresource is less than its capacity. Several authors [9, 13, 15, 16, 21, 22, 23]\nhave considered variants of the Massouli\u00e9 and Roberts model [18] and more\ngeneral bandwidth sharing policies. In particular, Lin, Shroff and Srikant\n[15, 16, 21] have given sufficient conditions for stability where the assumption of time scale separation is relaxed. Ye [22], Ye, Ou and Yuan [23] and\nHansen, Reynolds and Zachary [9] have given conditions for stability and\ninstability with more general bandwidth sharing policies. Key and Massouli\u00e9 [13] have considered a model with file transfers and streaming flows,\ncertain utility based policies and relaxed capacity constraints. However, all\nof these works maintain a critical exponential distributional assumption on\ndocument sizes or holding times to enable the use of a relatively simple\nMarkovian model. A major aim of our work is to relax this exponential\nassumption.\nHere, we consider the model of Massouli\u00e9 and Roberts, with generally\ndistributed document sizes and interarrival times, operating under a fairly\ngeneral bandwidth sharing policy. Important examples of this policy include\nthe weighted \u03b1-fair policies introduced by Mo and Walrand [19], and more\ngenerally certain utility based policies (see, e.g., [3, 13, 22, 23]) in the context of flow level models. We are interested in the stability and heavy traffic\nbehavior of this flow level model. (Despite the claim in [1], the proof of sufficient conditions for stability under weighted \u03b1-fair policies given there does\nnot apply when document sizes are other than exponentially distributed.\nThe reason for this is that the method of Dai [4] quoted there implicitly assumes (through the form of the model equations) that the service discipline\nis a head-of-the-line discipline. Consequently, the method does not apply in\ngeneral to processor sharing type disciplines, such as the bandwidth sharing\npolicies considered here. In the case of exponentially distributed document\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n3\n\nsizes, one can equate the distribution of the queue length process for a bandwidth sharing model with the queue length process of a stochastic processing\nnetwork (cf. [10]) operating under a head-of-the-line policy. Even then, to\nconclude the stability result using an analogue of Dai's result, one has to\ngeneralize the results of [4] to stochastic processing networks from multiclass queueing networks. However, in the case of exponential interarrival\ntimes and document sizes, the Lyapunov function given in [1] can be used\ndirectly on the original Markov chain stochastic model to establish stability\nunder the nominal condition that the average load placed on each resource\nis less than its capacity.)\nThere are a few results on sufficient conditions for stability of the flow\nlevel model with general document size distributions. With Poisson arrivals\nand document sizes having a phase-type distribution, for a weighted \u03b1-fair\npolicy with \u03b1 = 1, Lakshmikantha, Beck and Srikant [14] have established\nstability of some two resource linear networks and a 2 \u00d7 2 grid network\nwhen the average load on each resource is less than its capacity. For generally distributed interarrival and document sizes, Bramson [2] has shown\nsufficiency of such a condition for stability under a max-min fair policy (corresponding to an \u03b1-fair policy as \u03b1 \u2192 \u221e). Under proportional fair sharing,\nMassouli\u00e9 [17] has recently established stability of a fluid model for the\nflow level model with exponential interarrival and document sizes, and additional routing. From this, he infers stability of the stochastic flow level\nmodel when documents have phase-type distributions. In general, however,\nit remains an open question whether, with renewal arrivals and arbitrarily\n(rather than exponentially) distributed document sizes, the flow level model\nis stable under a weighted \u03b1-fair (or more general) bandwidth sharing policy\nwhen the nominal load placed on each resource is less than its capacity. In\ncontemporaneous work, Chiang, Shah and Tang [3] have developed a fluid\napproximation for the flow level model when the arrival rate and capacity are allowed to grow proportionally but the bandwidth per flow stays\nuniformly bounded. Using their fluid model, they derive some conclusions\nconcerning rate stability for general (bounded) document size distributions\nwhen \u03b1 \u2208 (0, \u221e) is sufficiently small.\nThis paper is a first step in our study of the flow level model with general interarrival and document size distributions, and a general bandwidth\nsharing policy. Here, we define measure valued processes that keep track\nof the residual sizes of all documents in the system at any given time. We\npropose a fluid model (or formal functional law of large numbers approximation) associated with the stochastic flow level model. Under mild conditions,\nwe show that the measure valued processes corresponding to a fluid scaled\nsequence of such models (with fixed network structure) are tight and that\nany weak limit point of the sequence is almost surely a fluid model solution.\nFor weighted \u03b1-fair policies, we also characterize the invariant states for the\n\n\f4\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nfluid model. In future work, we plan to study the asymptotic behavior of\nfluid model solutions and to use that to study the stability and heavy traffic\nbehavior of the associated flow level models. A summary of the results of this\npaper as they pertain to weighted \u03b1-fair policies appears in [8], along with\ntwo examples showing stability of the fluid model under a natural condition\nfor linear networks and simple tree networks.\nThe paper is organized as follows. In Section 2, we define the network\nstructure, the bandwidth sharing policy, the stochastic flow level model and\nwe introduce the measure valued processes used to describe the evolution of\nthe system. The notion of a fluid model solution is defined in Section 3. In\nSection 4, we introduce a sequence of flow level models and state our main\nresult concerning the tightness of this sequence and that weak limit points\nare fluid model solutions (see Theorem 4.1). The proof of the main result is\ngiven in Section 5. In Section 6, we characterize the invariant states of the\nfluid model for weighted \u03b1-fair policies.\n1.1. Notation. Let N = {1, 2, . . .}, let R = (\u2212\u221e, \u221e), and let Rd denote\nd-dimensional Euclidean space. For x, y \u2208 R, x \u2228 y is the maximum of x\nand y, x \u2227 y is the minimum of x and y, x+ is the positive part and \u230ax\u230b\nis the integer part of x. For x, y \u2208 Rd , let kxk = maxdi=1 |xi |, and interpret\nvector inequalities componentwise: x \u2264 y means xi \u2264 yi for all i = 1, . . . , d.\nThe positive d-dimensional orthant is denoted Rd+ = {x \u2208 Rd : x \u2265 0}. To\nease notation throughout the paper, all vectors are considered to be column\nvectors when used in mathematical expressions, but will be written out\nas row vectors within paragraphs. Also, define c/0 to be zero for any real\nconstant\nc, and define a sum over an empty set of indices or of the form\nPl\nwith\nj > l to be zero.\nk=j\nFor two functions f and g with the same domain, f \u2261 g means f (x) = g(x)\nfor all x in the domain. For a bounded function f : R+ \u2192 R, let kf k\u221e =\nsupx\u2208R+ |f (x)|. Let Cb (R+ ) be the set of continuous bounded functions\nf : R+ \u2192 R, let C1 (R+ ) be the set of once continuously differentiable functions f : R+ \u2192 R, and let C1b (R+ ) be the set of functions f in C1 (R+ ) that\ntogether with the first derivative f \u2032 , are bounded on R+ . If w \u2208 C1b (R+ ) is a\nfunction of time, its derivative will be denoted by \u1e87. For a Polish (complete\nseparable metric) space S, let D([0, \u221e), S) be the space of right continuous\nfunctions from [0, \u221e) into S that have left limits in S. Endow this space\nwith the Skorohod J1 -topology. For a finite nonnegative Borel measure \u03be on\nR+ and a \u03be-integrable function f : R+ \u2192 R, define\nhf, \u03bei =\n\nZ\n\nf d\u03be.\n\nR+\n\nIf \u03be = (\u03be1 , . . . , \u03bed ) is a vector of such measures, then hf, \u03bei is the vector\n(hf, \u03be1 i, . . . , hf, \u03bed i). All functions f : R+ \u2192 R are extended to be identically\n\n\f5\n\nFLUID LIMITS FOR BANDWIDTH SHARING\n\nzero on (\u2212\u221e, 0) so that f (* \u2212 x) is well defined on R+ for all x > 0. Let\n\u03c7 : R+ \u2192 R+ denote the identity function \u03c7(x) = x for x \u2208 R+ .\nLet M be the set of finite nonnegative Borel measures on R+ , endowed\nw\nwith the weak topology: \u03be k \u2212\u2192 \u03be in M if and only if hf, \u03be k i \u2192 hf, \u03bei for all\nf \u2208 Cb (R+ ). This topology is induced by the following generalization of the\nProhorov metric: for \u03be, \u03b6 \u2208 M define\nd[\u03be, \u03b6] = inf{\u03b5 > 0 : \u03be(B) \u2264 \u03b6(B \u03b5 ) + \u03b5 and\n(1.1)\n\n\u03b6(B) \u2264 \u03be(B \u03b5 ) + \u03b5 for all nonempty closed B \u2282 R+ },\n\nwhere B \u03b5 = {x \u2208 R+ : inf y\u2208B |x \u2212 y| < \u03b5}. It will be convenient to extend\nthe notion of uniform integrability for random variables (and their associated distributions) to elements of M. Call a sequence {\u03be k } \u2282 M uniformly\nintegrable, if h\u03c7, \u03be k i < \u221e for all k and\nlim suph\u03c71[x,\u221e) , \u03be k i = 0.\n\nx\u2192\u221e k\n\nw\n\nIt is easy to show that if {\u03be k } \u2282 M is uniformly integrable and \u03be k \u2212\u2192 \u03be,\nthen h\u03c7, \u03bei < \u221e and h\u03c7, \u03be k i \u2192 h\u03c7, \u03bei.\nFor I \u2208 N, let\nMI = {(\u03be1 , . . . , \u03beI ) : \u03bei \u2208 M for all i \u2264 I}\nand for \u03be, \u03b6 \u2208 MI , define\n(1.2)\n\ndI [\u03be, \u03b6] = max d[\u03bei , \u03b6i ].\ni\u2264I\n\nEquipped with the metric dI [*, *], the space MI is Polish. Convergence of a\nw\nsequence {\u03be k } to \u03be in MI is also denoted \u03be k \u2212\u2192 \u03be. The zero measure in M\nis denoted by 0.\nThe notation X \u223c Y means X and Y are equal in distribution, and X n \u21d2\nX means the sequence {X n } converges in distribution to X. All continuous\ntime stochastic processes used in this work are assumed to have sample paths\nthat are right continuous with left limits.\n2. Flow level model. This section defines the network structure, the\nbandwidth sharing policy and the stochastic flow level model.\n2.1. Network structure. Consider a network with finitely many resources\nlabelled by j = 1, . . . , J, and a finite set of routes labeled by i = 1, . . . , I. A\nroute i is a nonempty subset of {1, . . . , J}, interpreted as the set of resources\nused by the route. Let A be the J \u00d7 I incidence matrix satisfying Aji = 1 if\nresource j is used by route i, and Aji = 0 otherwise. Since each route is a\nnonempty subset of {1, . . . , J}, no column of A is identically zero.\n\n\f6\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nA flow on route i is the continuous transfer of a document through the\nresources used by the route. Assume that while being transferred, a flow\ntakes simultaneous possession of all resources on its route. The processing\nrate allocated to a flow is the rate at which the associated document is being\ntransferred. There may be multiple flows on a route, and the bandwidth \u039bi\nallocated to route i is the sum of the processing rates allocated to flows\non route i. The bandwidth allocated through resource j is the sum of the\nbandwidths allocated to routes using resource j. Assume that each resource\nj \u2264 J has finite capacity Cj > 0, interpreted as the maximum bandwidth\nthat can be allocated through it. Let C = (C1 , . . . , CJ ) be the vector of\ncapacities in RJ+ . Then any vector \u039b = (\u039b1 , . . . , \u039bI ) of bandwidth allocations\nmust satisfy\nA\u039b \u2264 C.\n2.2. Bandwidth sharing policy. We consider the network operating under\na policy that dynamically allocates bandwidth to routes as a function of the\nnumber of flows on all routes. The resulting allocation to each route is shared\nequally among individual flows on that route.\nLet Zi (t) denote the number of flows on route i \u2264 I at time t, and let\nZ(t) = (Z1 (t), . . . , ZI (t)) be the corresponding vector in RI+ . The bandwidth\nallocated to route i at time t is a function of the vector Z(t) and is denoted\nby \u039bi (Z(t)). The corresponding vector of bandwidth allocations at time t\nis \u039b(Z(t)) = (\u039b1 (Z(t)), . . . , \u039bI (Z(t))). Although the coordinates of Z(*) are\nnonnegative and integer valued, we assume that the function \u039b is defined\non the entire orthant RI+ to accommodate fluid analogues of Z(*) later.\nDefinition 2.1. A bandwidth sharing policy for the network (A, C) is\na function \u039b : RI+ \u2192 RI+ such that for each z \u2208 RI+ :\n(i)\n(ii)\n(iii)\n(iv)\n(v)\n\n\u039bi (z) > 0 for each i such that zi > 0,\n\u039bi (z) = 0 for each i such that zi = 0,\nA\u039b(z) \u2264 C,\n\u039b(rz) = \u039b(z) for each r > 0, and such that for each i \u2264 I,\n\u039bi (*) is continuous on {z \u2208 RI+ : zi > 0}.\n\nProperties (i) and (ii) imply that routes with active flows may not idle,\nand that no bandwidth is allocated to routes with no flows. Property (iii) is\nthe basic feasibility constraint, and property (iv) requires that bandwidth\nallocations are invariant under scaling. Note that by property (iii), since\neach route uses at least one resource, we have\n(2.1)\n\nsup k\u039b(z)k \u2264 kCk.\nz\u2208RI+\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n7\n\nWe assume further that the bandwidth \u039bi (Z(t)) allocated to route i at\ntime t is shared equally by all flows on the route. That is, if there are\nZi (t) > 0 flows on route i at time t, then each flow is allocated a processing\nrate of \u039bi (Z(t))/Zi (t) at time t.\nThe following property of \u039b(*) will be used later in this paper.\nLemma 2.2. Let \u039b(*) be a bandwidth sharing policy for the network\n(A, C). For each \u03b5, M \u2208 (0, \u221e), there exists c > 0 such that for each i \u2264 I,\non {z \u2208 RI+ : zi \u2265 \u03b5, kzk \u2264 M }.\n\n\u039bi (z) \u2265 c\n\nProof. For each i \u2264 I, the function \u039bi (*) is continuous and strictly\npositive on {z \u2208 RI+ : zi > 0} by Definition 2.1. So \u039b(*) is bounded away from\nzero on the compact subset {z \u2208 RI+ : zi \u2265 \u03b5, kzk \u2264 M }. \u0003\nAn important class of bandwidth sharing policies satisfying Definition 2.1\nis described below.\nExample. The following family of policies was introduced by Mo and\nWalrand [19]. Fix a parameter \u03b1 \u2208 (0, \u221e) and a vector of strictly positive weights \u03ba = (\u03ba1 , . . . , \u03baI ). For z \u2208 RI+ , let I0 (z) = {i \u2264 I : zi = 0} and\nI+ (z) = {i \u2264 I : zi > 0}. Let O(z) = {\u03bb \u2208 RI+ : \u03bbi = 0 for all i \u2208 I0 (z)}. Define\na function Gz : RI+ \u2192 [\u2212\u221e, \u221e) by\n\n(2.2)\n\n\uf8f1\n1\u2212\u03b1\nX\n\uf8f4\n\uf8f4\n\u03b1 \u03bbi\n\uf8f4\n,\n\u03ba\nz\n\uf8f4\ni i\n\uf8f2\n1\u2212\u03b1\ni\u2208I\n(z)\n+\nGz (\u03bb) =\nX\n\uf8f4\n\uf8f4\n\u03bai zi log \u03bbi ,\n\uf8f4\n\uf8f4\n\uf8f3\n\n\u03b1 \u2208 (0, \u221e) \\ {1},\n\u03b1 = 1,\n\ni\u2208I+ (z)\n\nwhere the value of Gz (\u03bb) is taken to be \u2212\u221e if \u03b1 \u2208 [1, \u221e) and \u03bbi = 0 for\nsome i \u2208 I+ (z), and Gz (\u03bb) = 0 if I+ (z) = \u2205. For each z \u2208 RI+ , define \u039b(z)\nas the unique vector \u03bb \u2208 RI+ that solves the optimization problem:\n(2.3)\n\nmaximize Gz (\u03bb),\n\n(2.4)\n\nsubject to A\u03bb \u2264 C,\n\n(2.5)\n\nover O(z).\n\nThe resulting allocation is called a weighted \u03b1-fair allocation, and the\nfunction \u039b : RI+ \u2192 RI+ is called a weighted \u03b1-fair bandwidth sharing policy.\nNote that by (2.4) and (2.5), \u039b satisfies properties (ii) and (iii) of Definition\n2.1. Properties (i), (iv), and (v) hold for \u039b by the proofs of Lemmas A.1\u2013\nA.3 of [12]. (Although it is assumed at the beginning of [12] that A has full\nrow rank, scrutiny of the proofs of Lemmas A.1\u2013A.3 in [12] reveals that this\n\n\f8\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nassumption is not used in verifying these properties.) When \u03bai = 1 for all\ni \u2264 I, the case \u03b1 = 1 and the limiting cases \u03b1 \u2192 0 and \u03b1 \u2192 \u221e correspond,\nrespectively, to a bandwidth allocation that is proportionally fair, achieves\nmaximum throughput, or is max-min fair [1, 19].\nSome authors (see, e.g., Ye [22], Ye, Ou and Yuan [23], Key and Massouli\u00e9\n[13] and Chiang, Shah and Tang [3]) have proposed more general objective\nfunctions than Gz (*) for determining bandwidth allocations in the context\nof flow level models. Indeed, the optimization problem (2.3)\u2013(2.5) can be\nreplaced by an equivalent one for the per flow bandwidth allocations xi =\n\u03bbi /zi for i \u2208 I+ (z), where Gz (\u03bb) given by (2.2) is replaced by\nX\n\n\u03bai zi U (xi )\n\ni\u2208I+ (z)\n\nand the utility function U is given by\nU (x) =\n\n\uf8f1 1\u2212\u03b1\n\uf8f2x\n\n\uf8f3 1\u2212\u03b1\n\n,\n\nlog(x),\n\n\u03b1 \u2208 (0, \u221e) \\ {1},\n\u03b1 = 1.\n\nWhen a more general strictly concave utility function U is used, properties\n(ii) and (iii) are immediate from the form of the optimization problem, properties (i) and (v) will hold under suitable regularity conditions on U , and\n(as pointed out by Chiang, Shah and Tang [3]), the critical scaling property\n(iv) will be satisfied if U has the scaling property that U (rx) = g(r)U (x) for\nall r > 0, x > 0, and some function g : (0, \u221e) \u2192 (0, \u221e). As Chiang, Shah and\nTang [3] also indicate, by seeking a scaling limit involving large capacities,\none can relax this last assumption. However, this involves allowing the network capacity C to grow with the scaling limit and is a different limiting\nregime than the one considered here; the present analysis is oriented toward\na system with fixed network parameters A, C.\n2.3. Stochastic model. Henceforth, we fix a network structure (A, C) and\na bandwidth sharing policy \u039b. Our stochastic model of document flows consists of the following: a collection of stochastic primitives E1 , . . . , EI and\n\u221e\n{v1k }\u221e\nk=1 , . . . , {vIk }k=1 describing the arrivals of document flows (including\ntheir sizes) to the network, a random initial condition Z(0) \u2208 MI specifying\nthe state of the system at time zero and a collection of performance processes describing the time evolution of the system state. The performance\nprocesses are defined in terms of the primitives and initial condition through\na set of descriptive equations. The random objects involved are defined on\na common probability space (\u03a9, F , P), with expectation operator E.\nThe stochastic primitives consist of an exogenous arrival process Ei and a\nsequence of document sizes {vik }\u221e\nk=1 for each route i \u2264 I. The arrival process\nEi is a counting process, that is, a nondecreasing, nonnegative integer valued\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n9\n\nprocess starting from zero. For t \u2265 0, Ei (t) represents the number of flows\nthat have arrived to route i during the time interval (0, t]. The kth such\narrival is called flow k on route i and arrives at time Uik = inf{t \u2265 0 : Ei (t) \u2265\nk} (note that simultaneous arrivals are allowed). Flows already on route i\nat time zero are called initial flows.\nFor each i \u2264 I and k \u2265 1, the random variable vik represents the initial\nsize of the document associated with flow k on route i. This is the cumulative amount of processing that must be allocated to the flow to complete\nits transfer through the network. Assume that for each i \u2264 I, the random\nvariables {vik }\u221e\nk=1 are strictly positive and form a sequence of independent\nand identically distributed random variables with common distribution \u03b8i\non R+ . Assume that the mean h\u03c7, \u03b8i i \u2208 (0, \u221e) and let \u03bci = h\u03c7, \u03b8i i\u22121 . We\nmake no further assumptions about the relationship between \u03bci and Ei .\nThe fluid approximation result stated in Section 4.3 below is valid for both\nunderloaded and overloaded systems.\nIt will be convenient to combine the collection of stochastic primitives into\na single, measure valued load process. For each x \u2208 R+ , let \u03b4x \u2208 M denote\nthe Dirac point measure at x.\nDefinition 2.3.\n\nFor i \u2264 I, define the load process for route i by\nEi (t)\n\n(2.6)\n\nLi (t) =\n\nX\n\n\u03b4vik ,\n\nt \u2265 0.\n\nk=1\n\nFor t \u2265 s \u2265 0, define the increment Li (s, t) = Li (t) \u2212 Li (s).\nThe process L = (L1 , . . . , LI ) is a random element of the Skorohod space\nD([0, \u221e), MI ). Note that L(s, t) \u2208 MI for all t \u2265 s \u2265 0.\nThe initial condition specifies Z(0) = (Z1 (0), . . . , ZI (0)), the number of\ninitial flows on each route at time zero, as well as the initial sizes of the\ndocuments associated to these flows. Assume that the components of Z(0)\nare nonnegative, integer valued random variables. The initial document sizes\nof the initial flows on route i \u2264 I are the first Zi (0) elements of a sequence\n{\u1e7dil }\u221e\nl=1 of strictly positive random variables. A convenient way to express\nthe initial condition is to define an initial random vector of measures Z(0) \u2208\nMI with components\nZi (0)\n\nZi (0) =\n\nX\n\n\u03b4\u1e7dil ,\n\ni \u2264 I.\n\nl=1\n\nHenceforth, Z(0) will be used as the initial condition for the network.\nThe performance processes consist of a measure valued process Z, taking\nvalues in D([0, \u221e), MI ), and a collection of auxiliary processes (Z, T, U, W ).\n\n\f10\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nThe process Z = (Z1 , . . . , ZI ) takes values in D([0, \u221e), RI+ ). For i \u2264 I and\nt \u2265 0, Zi (t) is the number of (active) flows on route i at time t. Recall\nthat at time t, the bandwidth allocated to route i is \u039bi (Z(t)), and this\nbandwidth is shared equally by all Zi (t) flows on route i; each such flow\nreceives a processing rate of \u039bi (Z(t))/Zi (t), which equals zero by convention\nif Zi (t) = 0. Thus, a flow that is active on route i during a time interval\n[s, t] \u2282 [0, \u221e) receives cumulative service during [s, t] equal to\n(2.7)\n\nSi (s, t) =\n\nZ\n\nt\n\ns\n\n\u039bi (Z(u))\ndu.\nZi (u)\n\nConsider flow k on route i. This flow arrives at time Uik and has initial\ndocument size vik . At time t \u2265 Uik , the cumulative service received by this\nflow during [Uik , t] equals Si (Uik , t) \u2227 vik . The amount of service still required\ntherefore equals (vik \u2212 Si (Uik , t))+ . (Once this latter quantity becomes zero,\nthe flow becomes inactive, i.e., it departs from the system.) A similar description applies for the initial flows on route i. For t \u2265 0, k \u2264 Ei (t), and\nl \u2264 Zi (0), define the residual document size at time t of flow k on route i\nand initial flow l on route i, by\n(2.8)\n\nvik (t) = (vik \u2212 Si (Uik , t))+\n\nand \u1e7dil (t) = (\u1e7dil \u2212 Si (0, t))+ ,\n\nrespectively.\nThe measure valued process Z = (Z1 , . . . , ZI ) is called the state descriptor ;\nit tracks the residual document sizes of flows on all routes at any given time.\nLet \u03b4x+ \u2208 M denote the Dirac measure at x if x \u2208 (0, \u221e), with \u03b40+ = 0. For\nt \u2265 0 and i \u2264 I, define the finite Borel measure\nEi (t)\n\nZi (0)\n\n(2.9)\n\nZi (t) =\n\nX\n\n\u03b4\u1e7d+il (t)\n\n+\n\nX\n\n\u03b4v+ik (t) .\n\nk=1\n\nl=1\n\nNote that at t = 0, this definition coincides with the definition of the initial\ncondition Z(0). Note also that by definition of the residual document sizes,\nthe measure Zi (t) has a unit of mass only for flows on route i that have not\nyet completed transfer. Thus, for all t \u2265 0 and i \u2264 I,\n(2.10)\n\nZi (t) = h1, Zi (t)i.\n\nFor t \u2265 0 and i \u2264 I, define\n(2.11)\n\nTi (t) =\n\nZ\n\n0\n\nt\n\n\u039bi (Z(s)) ds.\n\nThe process T takes values in D([0, \u221e), RI+ ) and tracks the cumulative bandwidth allocated to each route. For t \u2265 0, define\n(2.12)\n\nU (t) = Ct \u2212 AT (t).\n\n\f11\n\nFLUID LIMITS FOR BANDWIDTH SHARING\n\nThe process U takes values in D([0, \u221e), RJ+ ) and tracks the cumulative unused bandwidth capacity of each resource. Since A\u039b(z) \u2264 C for all z \u2208 RI+ ,\nthe process U is nondecreasing. For t \u2265 0, define\n(2.13)\n\nW (t) = h\u03c7, Z(t)i.\n\nRecall that \u03c7(x) = x and that integration against the vector of measures\nZ(t) is interpreted componentwise. The process W takes values in the path\nspace D([0, \u221e), RI+ ). By (2.9), Wi (t) is the sum of all residual document\nsizes on route i at time t. Thus, Wi (t) represents the immediate amount of\nwork still to be transferred on route i at time t. It can be shown that\n(2.14)\n\nWi (t) = Wi (0) + h\u03c7, Li (t)i \u2212 Ti (t),\n\ni \u2264 I, t \u2265 0.\n\nThis equation describes the workload on route i at time t in terms of the\ncumulative amount of work that arrives to and is processed on the route\nduring [0, t].\n3. Fluid model. In this section, we define a fluid analogue of the stochastic model introduced in Section 2.3. The main goal of the paper is to establish, under mild assumptions, that a sequence of fluid scaled stochastic\nstate descriptors is tight and that weak limit points are fluid model solutions (see Theorem 4.1 below). Fix a vector of strictly positive constants\n\u03bd = (\u03bd1 , . . . , \u03bdI ) and a vector of probability measures \u03b8 = (\u03b81 , . . . , \u03b8I ) in MI ,\nsatisfying h\u03c7, \u03b8i i < \u221e and h1{0} , \u03b8i i = 0 for all i \u2264 I. The constant \u03bdi , i \u2264 I,\nwill be the fluid analogue of mean arrival rate to route i in the stochastic\nmodel (when that exists). Let \u03bci = h\u03c7, \u03b8i i\u22121 and \u03c1i = \u03bdi /\u03bci for each i \u2264 I.\nWe do not impose criticality assumptions on the constants \u03c1i ; they may\ntake any value in (0, \u221e). The fluid model consists of a deterministic measure valued function of time, called the fluid model solution, and a collection\nof auxiliary functions of time defined below.\nDefinition 3.1. Given a continuous function \u03b6 : [0, \u221e) \u2192 MI , define the\nauxiliary functions (z, \u03c4, u, w) of \u03b6, with respect to the data (A, C, \u039b, \u03bd, \u03b8),\nby\nz(t) = h1, \u03b6(t)i,\n\u03c4i (t) =\n\nZ\n\n0\n\nt\n\n(\u039bi (z(s))1(0,\u221e) (zi (s)) + \u03c1i 1{0} (zi (s))) ds,\n\nu(t) = Ct \u2212 A\u03c4 (t),\nw(t) = h\u03c7, \u03b6(t)i\nfor all t \u2265 0.\n\ni \u2264 I,\n\n\f12\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nHere z(t) and \u03c4 (t) take values in RI+ and u(t) will take values in RJ+ . On\nthe other hand, w(t) takes values in [0, \u221e]I , as \u03b6(t) need not have a finite\nfirst moment [see (ii) below].\nA fluid model solution is now defined via projections against test functions\nin the class\nC = {f \u2208 C1b (R+ ) : f (0) = f \u2032 (0) = 0}.\nDefinition 3.2. A fluid model solution for the data (A, C, \u039b, \u03bd, \u03b8) is\na continuous function \u03b6 : [0, \u221e) \u2192 MI that, together with its auxiliary functions (z, \u03c4, u), satisfies:\n(i) kh1{0} , \u03b6(t)ik = 0 for all t \u2265 0,\n(ii) uj is nondecreasing for all j \u2264 J,\n(iii) for each f \u2208 C, i \u2264 I, and t \u2265 0,\nt\n\nhf, \u03b6i (t)i = hf, \u03b6i (0)i \u2212\n\nZ\n\nt\n\n+ \u03bdi hf, \u03b8i i\n\nZ\n\n(3.1)\n\n0\n\n0\n\nhf \u2032 , \u03b6i (s)i\n\n\u039bi (z(s))\nds\nzi (s)\n\n1(0,\u221e) (zi (s)) ds.\n\nRecall that in (3.1), the integrand in the first integral term is defined to\nbe zero when its denominator is zero.\nIn Definition 3.2, it is possible to extend property (iii) to the class of functions {f \u2208 C1b (R+ ) : f (0) = 0}, yielding an equivalent definition. The more\nrestrictive class C is used here to facilitate parts of the proof of Theorem\n4.1 below. In particular, since f (0) = f \u2032 (0) = 0 on C, a function in C can\nbe extended to a function in C1b (R) by defining it to be identically zero on\n(\u2212\u221e, 0).\nWhen the initial fluid workload is finite, we have the following result.\nLemma 3.3. Suppose \u03b6 is a fluid model solution with finite initial workload, that is, wi (0) = h\u03c7, \u03b6i (0)i < \u221e for all i \u2264 I. Then the fluid workload\nfunction w associated with \u03b6 satisfies the following for each i \u2264 I and t \u2265 0:\nwi (t) = wi (0) +\n(3.2)\n\nZ\n\n0\n\nt\n\n(\u03c1i \u2212 \u039bi (z(s)))1(0,\u221e) (zi (s)) ds\n\n= wi (0) + \u03c1i t \u2212 \u03c4i (t).\n\nIn particular, the fluid workload wi (t) is finite for all t \u2265 0 and i \u2264 I.\nProof. To obtain the first equality in (3.2), approximate \u03c7 by a sequence of functions {fn } \u2282 C such that 0 \u2264 fn \u2191 \u03c7 and 0 \u2264 fn\u2032 \u2191 1(0,\u221e) as\nn \u2192 \u221e, and then use monotone convergence in (3.1), noting property (i) of\nDefinition 3.2. The second equality follows immediately from the definition\nof \u03c4i . \u0003\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n13\n\nRemark. In fact, (3.2) holds also if h\u03c7, \u03b6i (0)i = \u221e, but then h\u03c7, \u03b6i (t)i =\n\u221e for all t \u2265 0.\n4. Sequence of systems and fluid limit theorem. Let R be a sequence of\npositive real numbers increasing to infinity. Consider an R-indexed sequence\nof stochastic models, each defined as in Section 2.3 for the same underlying\nnetwork structure (A, C) and bandwidth sharing policy \u039b. For each r \u2208 R,\nr }\u221e , i \u2264 I;\nthere are arrival processes E1r , . . . , EIr with arrival times {Uik\nk=1\nr\n\u221e\nr\n\u221e\nthere are document sizes {v1k }k=1 , . . . , {vIk }k=1 , with parameters \u03b8r and\n\u03bcr ; there is the corresponding measure valued load process Lr ; there is an\ninitial condition Z r (0); there is a state descriptor Z r with auxiliary processes\n(Z r , T r , U r , W r ) and cumulative service process S r (*, *). The stochastic elements of each model are defined on a probability space (\u03a9r , F r , Pr ) with\nexpectation operator Er .\n4.1. Scaling. A fluid scaling (or law of large numbers scaling) is applied\nto each model in the R-indexed sequence. For each r \u2208 R and t \u2265 s \u2265 0, let\n1\n\u0112 r (t) = E r (rt),\nS\u0304 r (s, t) = S r (rs, rt),\nr\n1\n1\nL\u0304r (t) = Lr (rt),\nL\u0304r (s, t) = Lr (rs, rt),\nr\nr\n1\n1\nZ\u0304 r (t) = Z r (rt),\n(4.1)\nZ\u0304 r (t) = Z r (rt),\nr\nr\n1\n1\n\u016a r (t) = U r (rt),\nT\u0304 r (t) = T r (rt),\nr\nr\n1\nW\u0304 r (t) = W r (rt).\nr\nWith these definitions, (2.10)\u2013(2.14), and the scaling property of Definition\n2.1(iv), we have that for r \u2208 R and t \u2265 0,\n(4.2)\n\nZ\u0304 r (t) = h1, Z\u0304 r (t)i,\n\n(4.3)\n\nT\u0304ir (t) =\n\nt\n\nZ\n\n0\n\n\u039bi (Z\u0304 r (s)) ds,\n\ni \u2264 I,\n\n(4.4)\n\n\u016a r (t) = Ct \u2212 AT\u0304 r (t),\n\n(4.5)\n\nW\u0304 r (t) = h\u03c7, Z\u0304 r (t)i,\n\n(4.6)\n\nW\u0304 r (t) = W\u0304 r (0) + h\u03c7, L\u0304r (t)i \u2212 T\u0304 r (t).\n\nAlso, (2.7) and Definition 2.1(iv) imply that for r \u2208 R and [s, t] \u2282 [0, \u221e),\n(4.7)\n\nS\u0304ir (s, t) =\n\nZ\n\ns\n\nt\n\n\u039bi (Z\u0304 r (u))\ndu,\nZ\u0304ir (u)\n\ni \u2264 I.\n\n\f14\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\n4.2. Asymptotic assumptions. In this section, we impose asymptotic assumptions on the R-indexed sequence of models. This is the setting in which\nour fluid limit result, Theorem 4.1 below, is proved.\nLet \u03bd = (\u03bd1 , . . . , \u03bdI ) be a vector of strictly positive constants and let \u03bd(t) =\n\u03bdt for all t \u2265 0. Let \u03b8 = (\u03b81 , . . . , \u03b8I ) be a vector of probability measures in\nMI satisfying\n(4.8)\n\nkh1{0} , \u03b8ik = 0,\n\n(4.9)\n\nkh\u03c7, \u03b8ik < \u221e.\ni\u22121\n\nFor i \u2264 I, let \u03bci = h\u03c7, \u03b8i\nand \u03c1i = \u03bdi /\u03bci . Define \u03c1(t) = \u03c1t for all t \u2265 0. For\nthe sequence of arrival processes, assume that as r \u2192 \u221e,\n\u0112 r (*) \u21d2 \u03bd(*).\n\n(4.10)\n\nConditions under which the functional law of large numbers result (4.10)\nholds are well known. For the sequence of document size distributions, assume that\nw\n\n(4.11)\n\n\u03b8r \u2212\u2192 \u03b8\n\n(4.12)\n\n{\u03b8ri : r \u2208 R} is uniformly integrable for each i \u2264 I.\n\nas r \u2192 \u221e,\n\nNote that (4.11) and (4.12) imply that\n\u03bcr \u2192 \u03bc\n\n(4.13)\n\nas r \u2192 \u221e.\n\nFor the sequence of fluid scaled initial conditions {Z\u0304 r (0) : r \u2208 R}, assume\nthat as r \u2192 \u221e,\n(Z\u0304 r (0), h\u03c7, Z\u0304 r (0)i) \u21d2 (Z 0 , h\u03c7, Z 0 i),\n\n(4.14)\n\nwhere Z 0 is a random vector of measures (taking values in MI ) satisfying\nkh\u03c7, Z 0 ik < \u221e\n\n(4.15)\n(4.16)\n\n\u0012\n\n\u0013\n\nlim P sup kh1[x,x+\u03b4] , Z 0 ik < \u03b5 = 1\n\n\u03b4\u21920\n\nx\u2208R+\n\na.s.,\nfor all \u03b5 > 0.\n\nAssumption (4.15) means that the limiting initial workload on each route\nis finite almost surely; (4.16) is equivalent to the assumption that almost\nsurely, Zi0 has no atoms for all i \u2264 I (see [7], Lemma A.1).\n4.3. Fluid limit theorem. The assumptions made so far are now summarized for ease of reference.\nThere is a fixed network structure (A, C) and a bandwidth sharing\npolicy \u039b. There is a sequence of stochastic models, each defined as in\n(A) Section 2.3; there exist a vector of strictly positive constants \u03bd, a vector\nof probability measures \u03b8 \u2208 MI , and a random vector of measures Z 0\ntaking values in MI such that (4.8)\u2013(4.16) hold.\nThe following is the main result of the paper.\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n15\n\nTheorem 4.1. Assume (A). The sequence {(Z\u0304 r , Z\u0304 r , T\u0304 r , \u016a r , W\u0304 r )} is Ctight, and each weak limit point (Z, Z, T, U, W ) is such that almost surely,\nZ is a fluid model solution with auxiliary functions (Z, T, U, W ) for the data\n(A, C, \u039b, \u03bd, \u03b8), where W (t) is finite for all t \u2265 0.\n5. Proof of Theorem 4.1. The proof has several stages. Section 5.1 contains a functional law of large numbers result for the measure valued load\nprocesses {Lr }. This result follows from the assumptions imposed on the\nstochastic primitives. Section 5.2 derives two dynamic equations satisfied by\nthe fluid scaled state descriptors {Z\u0304 r }, as well as several related bounds. Section 5.3 establishes a compact containment property, and Sections 5.4 and\n5.5 establish control of oscillations for the state descriptors. These properties are combined in Section 5.6 to prove the tightness claim of Theorem 4.1,\nand properties of weak limit points are derived in Section 5.7. We assume\n(A) throughout this entire section.\nThe general strategy outlined above is similar to that in [7]. However, the\nmodel studied here presents the additional complication of multiple routes\nthat interact with each other via the bandwidth sharing policy \u039b. In particular, the numerator in the first integral term of (3.1) is a function of the\ncurrent state of the whole system, as opposed to a constant as is the case\nin the analogous equation in [7]. This requires additional care to carry out\nthe analysis. A key difference in the present proof is in verifying (at various\nstages along the way), that the assumptions imposed by Definition 2.1 on\nthe more general function \u039b are sufficient to allow the above strategy to\ngo through. Furthermore, [7] focused only on a heavily loaded single server\nqueue and its critical fluid limit. Here, we have a network of resources and\nthere is no a priori assumption on the system load, that is, the traffic intensity parameters \u03c1i are unrestricted in (0, \u221e). This results in a more subtle\nfluid model and limit proof (see Section 5.7) related to the treatment of\ntimes when fluid queue lengths become zero.\n5.1. Limit of the primitive load processes. Recall that \u03bd(t) = \u03bdt, and\n\u03c1(t) = \u03c1t for all t \u2265 0.\nTheorem 5.1.\n(5.1)\n\nAs r \u2192 \u221e,\n(L\u0304r (*), h\u03c7, L\u0304r (*)i) \u21d2 (\u03bd(*)\u03b8, \u03c1(*)).\n\nThe proof of this theorem is a straightforward application of a functional\nlaw of large numbers. For completeness, a proof is given in the Appendix.\n\n\f16\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\n5.2. Dynamic equations. Fix r \u2208 R. For each route i \u2264 I, a dynamic\nequation satisfied by the component Z\u0304ir (*) of the fluid scaled state descriptor is the starting point for much of our subsequent analysis. The equation\nresults, after some simplification, from substituting the definition of the\nresidual document sizes (2.8) into (2.9). Almost surely, for all Borel measurable f : R+ \u2192 R, all i \u2264 I, and all t \u2265 s \u2265 0,\nEir (t)\n\nhf, Zir (t)i = hf (* \u2212 Sir (s, t)), Zir (s)i +\n\nX\n\nr\nr\nf (vik\n\u2212 Sir (Uik\n, t)).\n\nk=Eir (s)+1\n\nRecall that f is always extended to be zero on (\u2212\u221e, 0) so that f (* \u2212 x) is\nwell defined on R+ for all x \u2265 0. Applying the fluid scaling (4.1) produces\n(5.2)\n\nhf, Z\u0304ir (t)i = hf (* \u2212 S\u0304ir (s, t)), Z\u0304ir (s)i\n1\n+\nr\n\nr \u0112ir (t)\n\nX\n\nr\nr \u22121\nf (vik\n\u2212 S\u0304ir (Uik\nr , t)).\n\nk=r \u0112ir (s)+1\n\nThis equation yields several estimates that will be used frequently. If f is\nnonnegative and nondecreasing, then using the bound supx\u2208R+ f (* \u2212 x) \u2264\nf (*) in (5.2) yields\n(5.3)\n\nhf, Z\u0304ir (t)i \u2264 hf (* \u2212 S\u0304ir (s, t)), Z\u0304ir (s)i + hf, L\u0304ri (s, t)i\n\u2264 hf, Z\u0304ir (s)i + hf, L\u0304ri (s, t)i.\n\nIf f is bounded, then (5.2) implies that\n(5.4)\n\nhf, Z\u0304ir (t)i \u2264 hf (* \u2212 S\u0304ir (s, t)), Z\u0304ir (s)i + kf k\u221e h1, L\u0304ri (s, t)i\n\u2264 kf k\u221e h1, Z\u0304ir (s)i + kf k\u221e h1, L\u0304ri (s, t)i.\n\nBy ignoring the sum in (5.2), we obtain for any nonnegative f that\n(5.5)\n\nhf (* \u2212 S\u0304ir (s, t)), Z\u0304ir (s)i \u2264 hf, Z\u0304ir (t)i.\n\nAn alternative dynamic equation to (5.2), that is satisfied by Z\u0304ir (*) on\ncertain time intervals, will be used when passing to the limit as r \u2192 \u221e.\nThis equation is a prelimit analogue of the (3.1) satisfied by fluid model\nsolutions. It is derived from (5.2) and is written in terms of projections\nagainst functions f in the more restrictive class\n(5.6)\n\nCc = {f \u2208 C : f has compact support in R+ }.\n\nNote that for f \u2208 Cc , the derivative f \u2032 has compact support and kf \u2032 k\u221e < \u221e.\nThe proof of the following result appears in the Appendix.\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n17\n\nLemma 5.2. Fix r \u2208 R. Almost surely, for all i \u2264 I, all f \u2208 Cc , and all\nfinite time intervals [s, t] \u2282 [0, \u221e) satisfying inf u\u2208[s,t] Z\u0304ir (u) > 0, we have\nhf, Z\u0304ir (t)i = hf, Z\u0304ir (s)i \u2212\n(5.7)\n\nZ\n\nt\ns\n\nhf \u2032 , Z\u0304ir (u)i\n\n\u039bi (Z\u0304 r (u))\ndu\nZ\u0304ir (u)\n\n+ hf, L\u0304ri (t)i \u2212 hf, L\u0304ri (s)i.\n\n5.3. Compact containment. In this section, we establish the first of the\ntwo main conditions used in proving tightness.\nLemma 5.3.\nsuch that\n\nLet T > 0 and \u03b7 > 0. There exists a compact set K \u2282 MI\n\nlim inf Pr (Z\u0304 r (t) \u2208 K for all t \u2208 [0, T ]) \u2265 1 \u2212 \u03b7.\nr\u2192\u221e\n\nProof. By (4.15) and since kh1, Z 0 ik < \u221e almost surely, there exists\nan M > 0 such that\n(5.8)\n\nP(kh1, Z 0 ik \u2228 kh\u03c7, Z 0 ik \u2265 M ) \u2264 \u03b7.\n\nSince \u03be 7\u2192 h1, \u03bei is a continuous RI+ -valued function on MI , assumption\n(4.14) and the continuous mapping theorem imply that\n(5.9)\n\n(h1, Z\u0304 r (0)i, h\u03c7, Z\u0304 r (0)) \u21d2 (h1, Z 0 i, h\u03c7, Z 0 i)\n\nas r \u2192 \u221e.\n\nThe set {(z, w) \u2208 RI+ \u00d7 RI+ : kzk \u2228 kwk < M } is open, so by (5.8), (5.9) and\nthe Portmanteau theorem,\nlim inf Pr (kh1, Z\u0304 r (0)ik \u2228 kh\u03c7, Z\u0304 r (0)ik < M )\n(5.10)\n\nr\u2192\u221e\n\n\u2265 P(kh1, Z 0 ik \u2228 kh\u03c7, Z 0 ik < M ) \u2265 1 \u2212 \u03b7.\n\nFor each r \u2208 R, let \u03a9r1 be the event in the left-hand side of (5.10) and define\n\u03a9r2 = {kh1, L\u0304r (T )ik \u2228 kh\u03c7, L\u0304r (T )ik < K},\nwhere K = (k\u03bdT k \u2228 k\u03c1T k) + 1. By Theorem 5.1,\n(h1, L\u0304r (T )i, h\u03c7, L\u0304r (T )) \u21d2 (\u03bdT, \u03c1T )\n\nas r \u2192 \u221e.\n\nSo lim inf r\u2192\u221e Pr (\u03a9r2 ) = 1 by the choice of K. For each r \u2208 R, let \u03a9r3 be a\nfull probability event on which the dynamic equation (5.2) holds. Then\n(5.11)\n\nlim inf Pr (\u03a9r1 \u2229 \u03a9r2 \u2229 \u03a9r3 ) \u2265 1 \u2212 \u03b7.\nr\u2192\u221e\n\nLet K be the closure in MI of the set {\u03be \u2208 MI : kh1, \u03beik \u2228 kh\u03c7, \u03beik \u2264 M + K}.\nThe set K is compact by [11], Theorem 15.7.5. Fix r \u2208 R and an outcome\n\u03c9 \u2208 \u03a9r1 \u2229 \u03a9r2 \u2229 \u03a9r3 ; assume for the rest of the proof that all random objects are\n\n\f18\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nevaluated at this \u03c9. Fix t \u2208 [0, T ]; by (5.11), it suffices to show that Z\u0304 r (t) \u2208\nK. The dynamic equation bound (5.4) and the definition of \u03a9r1 \u2229 \u03a9r2 \u2229 \u03a9r3\nimply that\nmaxh1, Z\u0304ir (t)i \u2264 max{h1, Z\u0304ir (0)i + h1, L\u0304ri (t)i}\ni\u2264I\n\ni\u2264I\n\n\u2264 max{h1, Z\u0304ir (0)i + h1, L\u0304ri (T )i}\n\n(5.12)\n\ni\u2264I\n\n\u2264 M + K.\nSimilarly, the dynamic equation bound (5.3) implies that\nmaxh\u03c7, Z\u0304ir (t)i \u2264 max{h\u03c7, Z\u0304ir (0)i + h\u03c7, L\u0304ri (t)i}\ni\u2264I\n\ni\u2264I\n\n\u2264 max{h\u03c7, Z\u0304ir (0)i + h\u03c7, L\u0304ri (T )i}\n\n(5.13)\n\ni\u2264I\n\n\u2264 M + K.\nCombining (5.12) and (5.13) with (5.11) completes the proof. \u0003\n5.4. Asymptotic regularity near zero. Over any finite time interval, with\narbitrarily high probability as r \u2192 \u221e, the fluid scaled state descriptor Z\u0304ir (*)\nfor route i puts arbitrarily small mass on a sufficiently small neighborhood\nof zero. This is proved in the following lemma, and is a key ingredient for\nestablishing an oscillation property in the next section.\nLemma 5.4.\nthat\n(5.14)\n\nLet T > 0. For each \u03b5, \u03b7 \u2208 (0, 1), there exists an a > 0 such\nlim inf Pr\nr\u2192\u221e\n\n\u0012\n\n\u0013\n\nsup kh1[0,a] , Z\u0304 r (t)ik \u2264 \u03b5 \u2265 1 \u2212 \u03b7.\n\nt\u2208[0,T ]\n\nProof. Fix \u03b5, \u03b7 \u2208 (0, 1). The proof consists of several steps. The first\nthree steps are concerned with defining four high probability events \u03a9r1 , \u03a9r2 , \u03a9r3 , \u03a9r4 .\nSteps four and five supply the desired bound (in two parts) on the intersection of these events.\nStep 1. By (4.16), there exists b > 0 such that\n(5.15)\n\n\u0012\n\nP supkh1[(n\u22121)b,nb] , Z 0 ik <\nn\u2208N\n\n\u03b7\n\u03b5\n\u22651\u2212 .\n4\n2\n\u0013\n\nLet B = {\u03be \u2208 MI : supn\u2208N kh1[(n\u22121)b,nb] , \u03beik < \u03b5/4} and suppose that \u03be \u2208 B\nw\nand {\u03be k } \u2282 MI satisfy \u03be k \u2212\u2192 \u03be. Choose L \u2208 N large enough so that kh1[Lb,\u221e) , \u03beik <\nw\n\u03b5/4. Since \u03beik \u2212\u2192 \u03bei for each i \u2264 I, the Portmanteau theorem implies that\nlim sup supkh1[(n\u22121)b,nb] , \u03be k ik\nk\u2192\u221e n\u2208N\n\n\f19\n\nFLUID LIMITS FOR BANDWIDTH SHARING\n\n\u0012\n\n\u0013\n\n\u2264 lim sup maxkh1[(n\u22121)b,nb] , \u03be k ik \u2228 kh1[Lb,\u221e) , \u03be k ik\nk\u2192\u221e\n\nn\u2264L\n\n\u03b5\n\u2264 maxkh1[(n\u22121)b,nb] , \u03beik \u2228 kh1[Lb,\u221e) , \u03beik < .\nn\u2264L\n4\n\nSo \u03be k \u2208 B for sufficiently large k, which implies that B \u2282 MI is open. We\ndeduce from (4.14) and the Portmanteau theorem that\nlim inf Pr\nr\u2192\u221e\n\n\u0012\n\nsup kh1[x,x+b] , Z\u0304 r (0)ik <\n\nx\u2208R+\n\nr\n\n(5.16)\n\n\u2265 lim inf P\nr\u2192\u221e\n\n\u03b5\n2\n\n\u0013\n\n\u03b5\nsupkh1[(n\u22121)b,nb] , Z\u0304 (0)ik <\n4\nn\u2208N\n\n\u0012\n\nr\n\n\u0013\n\n\u03b5\n\u2265 P supkh1[(n\u22121)b,nb] , Z ik <\n.\n4\nn\u2208N\n\u0012\n\n0\n\n\u0013\n\nCombining (5.16) with (5.15) yields\n(5.17)\n\nlim inf Pr\nr\u2192\u221e\n\n\u0012\n\nsup kh1[x,x+b] , Z\u0304 r (0)ik <\n\nx\u2208R+\n\n\u03b7\n\u03b5\n\u22651\u2212 .\n2\n2\n\u0013\n\nLet \u03a9r1 be the event in the left-hand side of (5.17).\nStep 2. By Lemma 5.3, there exists a compact set K \u2282 MI such that\n\u03b7\nlim inf Pr (Z\u0304 r (t) \u2208 K for all t \u2208 [0, T ]) \u2265 1 \u2212 .\n(5.18)\nr\u2192\u221e\n2\nSince K is compact, there exists M < \u221e such that\n(5.19)\n\nsup kh1, \u03beik \u2264 M.\n\u03be\u2208K\n\nLet \u03a9r2 be the event in the left-hand side of (5.18).\nStep 3. By Lemma 2.2, there exists c > 0 such that for each i \u2264 I,\n(5.20)\n\n\u039bi (z) \u2265 c\n\non {z \u2208 RI+ : zi \u2265 \u03b5/8, kzk \u2264 M }.\n\nLet \u03b4 = \u03b5(12k\u03bdk)\u22121 \u2227 T and let a = \u03b4c(2M )\u22121 \u2227 b. Choose N \u2208 N large enough\nso that\n8\n(5.21)\nN a > a + T kCk .\n\u03b5\nLet I0 = \u2205 and, for each n \u2208 N, define In = [(n \u2212 1)a, na) and choose gn \u2208\nCb (R+ ) satisfying 1In \u2264 gn \u2264 1In\u22121 \u222aIn \u222aIn+1 . Then since \u03b8 is a vector of probability measures,\n(5.22)\n\nmax\ni\u2264I\n\n\u221e\nX\n\nhgn , \u03b8i i \u2264 max\n\nn=1\n\ni\u2264I\n\n\u221e\nX\n\nh1In\u22121 \u222aIn \u222aIn+1 , \u03b8i i \u2264 3.\n\nn=1\n\n\f20\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nFor notational convenience, let g0 \u2261 1. For each n \u2208 N \u222a {0}, the RI+ -valued\nmap \u03be 7\u2192 hgn , \u03bei is continuous on MI . So for each such n, Theorem 5.1 and\nthe continuous mapping theorem yield\nhgn , L\u0304r (*)i \u21d2 \u03bd(*)hgn , \u03b8i\n\n(5.23)\n\nas r \u2192 \u221e.\n\nThe limit in (5.23) is a deterministic and continuous function taking values in\nRI+ . So, the convergence is uniform on compact time intervals in probability,\nand occurs jointly for all n = 0, . . . , N . Therefore,\n(5.24)\n\nr\n\nlim inf P\nr\u2192\u221e\n\n\u0012\n\n\u03b5\nmax sup khgn , L\u0304 (t)i \u2212 \u03bdthgn , \u03b8ik \u2264\nn=0,...,N t\u2208[0,T ]\n8N\nr\n\n\u0013\n\n= 1.\n\nLet \u03a9r3 be the event in (5.24) and let \u03a9r4 be a full probability event on which\n(5.2) holds. Define \u03a9r0 = \u03a9r1 \u2229 \u03a9r2 \u2229 \u03a9r3 \u2229 \u03a9r4 . By (5.17), (5.18) and (5.24),\nlim inf Pr (\u03a9r0 ) \u2265 1 \u2212 \u03b7.\nr\u2192\u221e\n\nequal to the event in (5.14), it suffices to show that \u03a9r0 \u2282 \u03a9r\u2217\nThus, setting\nfor each r \u2208 R. To this end, fix r \u2208 R, \u03c9 \u2208 \u03a9r0 , t \u2208 [0, T ], and i \u2264 I; assume\nfor the rest of the proof that all random objects are evaluated at this \u03c9. It\nsuffices to show that\n\u03a9r\u2217\n\nh1[0,a] , Z\u0304ir (t)i \u2264 \u03b5.\n\n(5.25)\n\nStep 4. Define the random time\n\u001a\n\n\u03c4 = sup s \u2264 t : Z\u0304ir (s) \u2264\n\n(5.26)\n\n\u03b5\n,\n8\n\u001b\n\nwhere sup \u2205 = 0. We first show that\n\u03b5\nsup h1[0,a] (* \u2212 x), Z\u0304ir (\u03c4 )i \u2264 .\n2\nx\u2208R+\n\n(5.27)\n\nIf \u03c4 = 0, this follows from the definition of \u03a9r1 , since a \u2264 b. If \u03c4 > 0, then the\ndefinition of \u03c4 implies the existence of \u03c4\u0303 \u2208 [(\u03c4 \u2212 \u03b4)+ , \u03c4 ] such that h1, Z\u0304ir (\u03c4\u0303 )i =\nZ\u0304ir (\u03c4\u0303 ) \u2264 \u03b5/8. By the dynamic equation bound (5.4) and the definition of \u03c4\u0303 ,\nsup h1[0,a] (* \u2212 x), Z\u0304ir (\u03c4 )i \u2264 h1, Z\u0304ir (\u03c4\u0303 )i + h1, L\u0304ri (\u03c4\u0303 , \u03c4 )i\n\nx\u2208R+\n\n\u03b5\n+ h1, L\u0304ri (\u03c4 )i \u2212 h1, L\u0304ri (\u03c4\u0303 )i.\n8\nApplying the definition of \u03a9r3 and noting that g0 \u2261 1, we obtain\n\u03b5\n\u03b5\n\u03b5\n\u03b5\nsup h1[0,a] (* \u2212 x), Z\u0304ir (\u03c4 )i \u2264 + \u03bdi (\u03c4 \u2212 \u03c4\u0303 )h1, \u03b8i i +\n\u2264 + \u03b4k\u03bdk + ,\n8\n4N\n8\n4\nx\u2208R+\n\u2264\n\nwhich implies (5.27) by the choice of \u03b4.\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n21\n\nStep 5. Note that if \u03c4 = t, then (5.25) follows directly from (5.27); so\nassume that t > \u03c4 . For all s \u2208 (\u03c4, t], Z\u0304ir (s) > \u03b5/8 and kZ\u0304 r (s)k \u2264 M by (5.19)\nand the definition of \u03a9r2 . So, (5.20) implies that\ninf \u039bi (Z\u0304 r (s)) \u2265 c.\n\n(5.28)\n\ns\u2208(\u03c4,t]\n\nUsing (5.2) and (5.27),\nh1[0,a] , Z\u0304ir (t)i = h1[0,a] (* \u2212 S\u0304ir (\u03c4, t)), Z\u0304ir (\u03c4 )i\n1\n+\nr\n\n(5.29)\n\nr \u0112ir (t)\nr\nr \u22121\n1[0,a] (vik\n\u2212 S\u0304ir (Uik\nr , t))\n\nX\n\nk=r \u0112ir (\u03c4 )+1\n\n\u221e\n\u03b5 X\n1\n\u2264 +\n2 n=1 r\n\nr \u0112ir (t)\nr\nr\nr \u22121\n1In (vik\n)1[0,a] (vik\n\u2212 S\u0304ir (Uik\nr , t)).\n\nX\n\nk=r \u0112ir (\u03c4 )+1\n\nr r \u22121 \u2208 (\u03c4, t] and v r \u2208 I for n > N . Then\nConsider a flow k such that Uik\nn\nik\nr \u2265 N a > a + T kCk8\u03b5\u22121 . Since Z\u0304 r (s) > \u03b5/8 for s \u2208 (\u03c4, t],\nvik\ni\nr \u22121\nS\u0304ir (Uik\nr , t) =\n\nZ\n\nt\n\nr r \u22121\nUik\n\n8\n\u039bi (Z\u0304 r (s))\nds \u2264 T kCk .\nr\n\u03b5\nZ\u0304i (s)\n\nr \u22121\nr\nr\nr \u2212 S\u0304 r (U r r \u22121 , t)) > a and so 1\nThus, (vik\n[0,a] (vik \u2212 S\u0304i (Uik r , t)) = 0. We dei\nik\nduce from (5.29) that\n\n(5.30)\n\nh1[0,a] , Z\u0304ir (t)i \u2264\n\nN\n\u03b5 X\n1\n+\n2 n=1 r\n\nr \u0112ir (t)\nr\nr\nr \u22121\n1In (vik\n)1[0,a] (vik\n\u2212 S\u0304ir (Uik\nr , t)).\n\nX\n\nk=r \u0112ir (\u03c4 )+1\n\nr r \u22121 , U r r \u22121 \u2208 (\u03c4, t] and v r , v r \u2208 I\nConsider two flows k < l satisfying Uik\nn\nil\nik il\nr\n\u22121\nr\n\u22121\nfor some n = 1, . . . , N . If Uil r \u2212 Uik r \u2265 \u03b4, then by the definition of \u03a9r2 ,\n(5.19), (5.28) and the definition of a,\nr r \u22121\nUil\n\n\u039bi (Z\u0304 r (s))\nds\nr r \u22121\nZ\u0304ir (s)\nUik\nr \u22121 c\n\u2265 (Uilr r \u22121 \u2212 Uik\nr )\nM\n\u03b4c\n\u2265 2a.\n\u2265\nM\n\nr \u22121\nS\u0304ir (Uik\nr , t) \u2212 S\u0304ir (Uilr r \u22121 , t) =\n\nZ\n\nConsequently,\nr\nr \u22121\nr\n(vilr \u2212 S\u0304ir (Uilr r \u22121 , t)) \u2212 (vik\n\u2212 S\u0304ir (Uik\nr , t)) \u2265 2a + vilr \u2212 vik\n> 2a \u2212 a = a\n\nand so at most one of\nr\nr \u22121\n1[0,a] (vik\n\u2212 S\u0304ir (Uik\nr , t)) and\n\n1[0,a] (vilr \u2212 S\u0304ir (Uilr r \u22121 , t))\n\n\f22\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nis nonzero. This implies that flows arriving to route i during (\u03c4, t] with\ndocument sizes in In and residual document sizes at time t in [0, a] must\nall arrive during some time interval of length less than \u03b4. That is, for each\nn = 1, . . . , N , there exists an interval (sn , sn + \u03b4n ] \u2282 (\u03c4, t], with \u03b4n < \u03b4, such\nr r \u22121 \u2208 (\u03c4, t], v r \u2208 I , and v r \u2212 S\u0304 r (U r r \u22121 , t) \u2208 [0, a], implies U r r \u22121 \u2208\nthat Uik\nn\ni\nik\nik\nik\nik\n(sn , sn + \u03b4n ]. Combining this fact with (5.30) yields\nh1[0,a] , Z\u0304ir (t)i \u2264\n\nN\n1\n\u03b5 X\n+\nsup\n2 n=1 s\u2208[0,T \u2212\u03b4] r\n\nr \u0112ir (s+\u03b4)\nr\n1In (vik\n).\n\nX\n\nk=r \u0112ir (s)+1\n\nBound 1In by gn and rewrite the above to obtain\nh1[0,a] , Z\u0304ir (t)i \u2264\n\nN\n\u03b5 X\n+\nsup (hgn , L\u0304ri (s + \u03b4)i \u2212 hgn , L\u0304ri (s)i).\n2 n=1 s\u2208[0,T \u2212\u03b4]\n\nApplying the definition of \u03a9r3 and (5.22), we obtain\nh1[0,a] , Z\u0304ir (t)i \u2264\n\nN\n\u03b5\n\u03b5 X\n+\n\u03bdi \u03b4hgn , \u03b8i i +\n2 n=1\n4N\n\n\u0012\n\n\u0013\n\n\u2264\n\n3\u03b5\n+ \u03b43k\u03bdk.\n4\n\nBy the choice of \u03b4, the right-hand side is bounded above by \u03b5. \u0003\n5.5. Oscillations. This section contains an oscillation bound used in proving tightness.\nDefinition 5.5. Let T > 0 and \u03b4 \u2208 [0, T ]. For each \u03b6(*) \u2208 D([0, \u221e), MI ),\ndefine a modulus of continuity on [0, T ] by\n(5.31)\n\nwT (\u03b6(*), \u03b4) = sup dI [\u03b6(s), \u03b6(t)].\ns,t\u2208[0,T ]\n|t\u2212s|<\u03b4\n\nLemma 5.6.\n(5.32)\n\nLet T > 0. For all \u03b5, \u03b7 \u2208 (0, 1), there exists \u03b4 > 0 such that\nlim inf Pr (wT (Z\u0304 r (*), \u03b4) \u2264 \u03b5) \u2265 1 \u2212 \u03b7.\nr\u2192\u221e\n\nProof. Fix \u03b5, \u03b7 \u2208 (0, 1). By Lemma 5.4, with \u03b5/2 in place of \u03b5, there\nexists a > 0 such that\n\u0012\n\u0013\n\u03b5\nr\nr\nlim inf P\nsup kh1[0,a] , Z\u0304 (t)ik \u2264\n(5.33)\n\u2265 1 \u2212 \u03b7.\nr\u2192\u221e\n2\nt\u2208[0,T ]\nLet \u03a9r1 be the event in (5.33) and let \u03b4 = min{\u03b5(\u03b5 \u2227 a)(4kCk)\u22121 , \u03b5(4k\u03bdk)\u22121 }.\nSince \u03be 7\u2192 h1, \u03bei is continuous on MI , Theorem 5.1 implies that h1, L\u0304r (*)i \u21d2\n\u03bd(*) as r \u2192 \u221e. Thus,\n(5.34)\n\nlim inf Pr\nr\u2192\u221e\n\n\u0012\n\nsup kh1, L\u0304r (t)i \u2212 \u03bdtk \u2264\n\nt\u2208[0,T ]\n\n\u03b5\n= 1.\n8\n\u0013\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n23\n\nLet \u03a9r2 be the event in (5.34) and let \u03a9r3 be a full probability event on which\n(5.2) holds. By (5.33) and (5.34),\nlim inf Pr (\u03a9r1 \u2229 \u03a9r2 \u2229 \u03a9r3 ) \u2265 1 \u2212 \u03b7.\n\n(5.35)\n\nr\u2192\u221e\n\nFix r \u2208 R and an outcome \u03c9 \u2208 \u03a9r1 \u2229 \u03a9r2 \u2229 \u03a9r3 ; assume for the rest of the proof\nthat all random objects are evaluated at this \u03c9. Fix i \u2264 I and s, t \u2208 [0, T ]\nwith s \u2264 t and t \u2212 s < \u03b4. By (5.35), Definition 5.5 and (1.2) it suffices to\nshow that\nd[Z\u0304ir (s), Z\u0304ir (t)] \u2264 \u03b5.\nLet B \u2282 R+ be closed. By (1.1), it suffices to show the two inequalities,\n(5.36)\n\nh1B , Z\u0304ir (s)i \u2264 h1B \u03b5 , Z\u0304ir (t)i + \u03b5,\n\n(5.37)\n\nh1B , Z\u0304ir (t)i \u2264 h1B \u03b5 , Z\u0304ir (s)i + \u03b5.\n\nTo show (5.36), use the definition of \u03a9r1 to write\n(5.38)\n\nh1B , Z\u0304ir (s)i \u2264 h1[0,a] , Z\u0304ir (s)i + h1B\u2229(a,\u221e) , Z\u0304ir (s)i\n\u03b5\n+ h1B\u2229(a,\u221e) , Z\u0304ir (s)i.\n2\n\n\u2264\n\nLet I = {u \u2208 [s, t] : Z\u0304ir (u) < \u03b5/2}. Suppose that I = \u2205. Then Z\u0304ir (u) \u2265 \u03b5/2 for\nall u \u2208 [s, t]. So, by (2.1) and the definition of \u03b4,\n(5.39)\n\nS\u0304ir (s, t) =\n\nZ\n\ns\n\nt\n\n2kCk \u03b5 \u2227 a\n\u039bi (Z\u0304 r (u))\ndu \u2264 \u03b4\n\u2264\n< \u03b5 \u2227 a.\nr\n\u03b5\n2\nZ\u0304i (u)\n\nConsequently, x \u2208 B \u2229 (a, \u221e) implies x \u2212 S\u0304ir (s, t) \u2208 B \u03b5 , and so\nB \u2229 (a, \u221e) \u2282 B \u03b5 + S\u0304ir (s, t).\nWe deduce from (5.38) that\n\u03b5\n\u03b5\nh1B , Z\u0304ir (s)i \u2264 + h1B \u03b5 +S\u0304 r (s,t) , Z\u0304ir (s)i = + h1B \u03b5 (* \u2212 S\u0304ir (s, t)), Z\u0304ir (s)i.\ni\n2\n2\nApply the dynamic equation bound (5.5) to obtain\n\u03b5\n(5.40)\nh1B , Z\u0304ir (s)i \u2264 + h1B \u03b5 , Z\u0304ir (t)i.\n2\nNow, suppose I 6= \u2205 and let \u03c4 = inf I. Then by right continuity of Z\u0304ir (*),\n\u03b5\n(5.41)\nZ\u0304ir (\u03c4 ) \u2264 .\n2\nSince Z\u0304ir (u) \u2265 \u03b5/2 for all u \u2208 [s, \u03c4 ),\n(5.42)\n\nS\u0304ir (s, \u03c4 ) =\n\nZ\n\ns\n\n\u03c4\n\n\u039bi (Z\u0304 r (u))\n2kCk\n\u2264 a.\ndu \u2264 \u03b4\nr\n\u03b5\nZ\u0304i (u)\n\n\f24\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nBy (5.38) and (5.42),\n\u03b5\n+ h1(a,\u221e) , Z\u0304ir (s)i\n2\n\u03b5\n\u2264 + h1[S\u0304 r (s,\u03c4 ),\u221e) , Z\u0304ir (s)i\ni\n2\n\u03b5\n= + h1[0,\u221e) (* \u2212 S\u0304ir (s, \u03c4 )), Z\u0304ir (s)i.\n2\nApply the dynamic equation bound (5.5) to obtain\n\u03b5\n(5.43)\nh1B , Z\u0304ir (s)i \u2264 + h1, Z\u0304ir (\u03c4 )i \u2264 \u03b5.\n2\nSo (5.36) follows because either (5.40) or (5.43) holds.\nTo show (5.37), note that by definition of \u03a9r2 and \u03b4,\n\u03b5\n\u03b5 \u03b5\n(5.44) h1, L\u0304ri (s, t)i = h1, L\u0304ri (t)i \u2212 h1, L\u0304ri (s)i \u2264 \u03bdi (t \u2212 s) + \u2264 k\u03bdk\u03b4 + \u2264 .\n4\n4 2\nBy the first inequality in (5.4) and (5.44),\nh1B , Z\u0304ir (s)i \u2264\n\n(5.45)\n\nh1B , Z\u0304ir (t)i \u2264 h1B (* \u2212 S\u0304ir (s, t)), Z\u0304ir (s)i + h1, L\u0304ri (s, t)i\n\u03b5\n\u2264 h1B+S\u0304 r (s,t) , Z\u0304ir (s)i + .\ni\n2\n\nIf I = \u2205, then (5.39) implies that B + S\u0304ir (s, t) \u2282 B \u03b5 . So, (5.45) yields\n\u03b5\nh1B , Z\u0304ir (t)i \u2264 h1B \u03b5 , Z\u0304ir (s)i + .\n2\nIf I 6= \u2205, then by (5.4), (5.41) and (5.44),\nh1B , Z\u0304ir (t)i \u2264 h1, Z\u0304ir (\u03c4 )i + h1, L\u0304ri (\u03c4, t)i \u2264 h1, Z\u0304ir (\u03c4 )i + h1, L\u0304ri (s, t)i \u2264 \u03b5.\nIn both cases, (5.37) holds. \u0003\n5.6. Tightness. This section combines the work of Sections 5.1\u20135.5 to\nprove the tightness claim of Theorem 4.1.\nTheorem 5.7.\n\nThe sequence {(Z\u0304 r , Z\u0304 r , T\u0304 r , \u016a r , W\u0304 r )} is C-tight.\n\nProof. For each T > 0 and \u03b4 \u2208 [0, T ], let wT\u2032 (*, \u03b4) be the modulus of\ncontinuity on D([0, \u221e), MI ) used in Corollary 3.7.4 of [6]. By Definition 5.5,\nwT\u2032 (\u03b6(*), \u03b4) \u2264 wT +\u03b4 (\u03b6(*), 2\u03b4)\nfor all \u03b6(*) \u2208 D([0, \u221e), MI ). So by Lemmas 5.3 and 5.6, the measure valued\nstate descriptors {Z\u0304 r } satisfy the compact containment and oscillation conditions of Corollary 3.7.4 in [6]. Thus, {Z\u0304 r } is tight. Moreover, Definition\n5.5 and Lemma 5.6 also imply that any weak limit point Z (obtained as\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n25\n\na limit in distribution along a subsequence of {Z\u0304 r }) is continuous almost\nsurely. Since Z\u0304 r (*) = h1, Z\u0304 r (*)i and \u03be 7\u2192 h1, \u03bei is continuous on MI , it follows\nthat {(Z\u0304 r , Z\u0304 r )} is C-tight.\nBy (4.3) and (2.1), T\u0304 r (*) is almost surely Lipschitz continuous with Lipschitz constant kCk. Since this holds uniformly in r, the sequence {T\u0304 r } is\ntight and any weak limit point T is almost surely Lipschitz continuous with\nLipschitz constant kCk. By (4.4), C-tightness of {T\u0304 r } implies C-tightness\nof {\u016a r }.\nAs r \u2192 \u221e, W\u0304 r (0) \u21d2 h\u03c7, Z 0 i by (4.14), and h\u03c7, L\u0304r (*)i \u21d2 \u03c1(*) by Theorem 5.1. So (4.6) and C-tightness of {T\u0304 r } imply C-tightness of {W\u0304 r }. It\nfollows that {(Z\u0304 r , Z\u0304 r , T\u0304 r , \u016a r , W\u0304 r )} is C-tight. \u0003\n5.7. Weak limits as fluid model solutions. Let (Z, Z, T, U, W ) be a weak\nlimit of the sequence {(Z\u0304 r , Z\u0304 r , T\u0304 r , \u016a r , W\u0304 r )}, and let {q} \u2282 R be a subsequence such that\n(Z\u0304 q , Z\u0304 q , T\u0304 q , \u016a q , W\u0304 q ) \u21d2 (Z, Z, T, U, W )\n\nas q \u2192 \u221e.\n\nNote that since W\u0304 q (0) = h\u03c7, Z\u0304 q (0)i for all q, assumption (4.14) implies\nthat (Z(0), W (0)) \u223c (Z 0 , h\u03c7, Z 0 i) and so W (0) \u223c h\u03c7, Z(0)i. By Theorem\n5.1, (L\u0304q (*), h\u03c7, L\u0304q (*)i \u21d2 (\u03bd(*)\u03b8, \u03c1(*)) as q \u2192 \u221e. Using the Skorohod representation theorem, we may assume without loss of generality for the rest of\nthis subsection that (Z, Z, T, U, W ) and {(Z\u0304 q , Z\u0304 q , T\u0304 q , \u016a q , W\u0304 q , L\u0304q , h\u03c7, L\u0304q i)}\nare defined on a common probability space (\u03a9, F, P) such that, almost\nsurely, W (0) = h\u03c7, Z(0)i, and as q \u2192 \u221e,\n(5.46)\n\n(Z\u0304 q , Z\u0304 q , T\u0304 q , \u016a q , W\u0304 q , L\u0304q , h\u03c7, L\u0304q (*)i) \u2192 (Z, Z, T, U, W, \u03bd(*)\u03b8, \u03c1(*)),\n\nuniformly on compact time intervals. Let \u03a91 be the event of probability\none on which W (0) = h\u03c7, Z(0)i and (5.46) holds. For each q, let \u03a9q2 be an\nevent of probability one [cf. (5.2) and Lemma 5.2] on which (5.2) holds, and\non which for all i \u2264 I, all f \u2208 Cc , and all finite time intervals [s, t] \u2282 [0, \u221e)\nsatisfying inf u\u2208[s,t] Z\u0304iq (u) > 0,\nhf, Z\u0304iq (t)i =\n(5.47)\n\nhf, Z\u0304iq (s)i \u2212\n\nZ\n\nt\ns\n\nhf \u2032 , Z\u0304iq (u)i\n\n\u039bi (Z\u0304 q (u))\ndu\nZ\u0304iq (u)\n\n+ hf, L\u0304qi (t)i \u2212 hf, L\u0304qi (s)i.\n\nThen \u03a92 = q \u03a9q2 also has probability one. Define \u03a90 = \u03a91 \u2229 \u03a92 .\nLemma 5.8 and Theorem 5.9 below establish that almost surely, Z is\na fluid model solution with auxiliary functions (Z, T, U, W ) for the data\n(A, C, \u039b, \u03bd, \u03b8), where W (t) is finite for all t \u2265 0.\nFirst, recall that for a function x : [0, \u221e) \u2192 R, a regular point for x is a\nvalue of t \u2208 (0, \u221e) at which x is differentiable. If x is absolutely continuous,\nT\n\n\f26\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nthen almost every t \u2208 (0, \u221e) is a regular point for x, and\nx(t) = x(0) +\n\nZ\n\nt\n\n\u1e8b(s) ds,\n\nt \u2265 0,\n\n0\n\nwhere \u1e8b is equal to the derivative of x whenever x is differentiable, and\n\u1e8b is equal to zero otherwise. A uniformly Lipschitz continuous function\nx : [0, \u221e) \u2192 R is absolutely continuous.\nLemma 5.8.\nfies:\n(i)\n(ii)\n(iii)\n(iv)\n(v)\n(vi)\nkCk,\n(vii)\n\nAlmost surely, for all t \u2265 0, the limit (Z, Z, T, U, W ) satis-\n\nkh1{0} , Z(t)ik = 0,\nZ(t) = h1, Z(t)i,\nU (t) = Ct \u2212 AT (t),\nW (t) = W (0) + \u03c1t \u2212 T (t),\nW (t) = h\u03c7, Z(t)i,\nW is uniformly Lipschitz continuous with Lipschitz constant k\u03c1k +\nfor all i \u2264 I,\nTi (t) =\n\nZ\n\n0\n\nt\n\n(\u039bi (Z(s))1(0,\u221e) (Zi (s)) + \u03c1i 1{0} (Zi (s))) ds,\n\n(viii) Uj is nondecreasing for all j \u2264 J.\nProof. Let T > 0. It suffices to show (i) for all t \u2208 [0, T ). By Lemma\n5.4, there exists a sequence {an : n \u2208 N} of positive real numbers such that,\nfor each fixed n,\n(5.48)\n\n1\n1\n\u2265 1\u2212 2.\nlim inf P sup kh1[0,an ) , Z\u0304 (t)ik \u2264\nq\u2192\u221e\nn\nn\nt\u2208[0,T )\n\u0012\n\nq\n\n\u0013\n\nFor each n \u2208 N, let An = {\u03be \u2208 MI : kh1[0,an ) , \u03beik \u2264 1/n}, and suppose that\nw\n{\u03be k } \u2282 An satisfies \u03be k \u2212\u2192 \u03be as k \u2192 \u221e. By the Portmanteau theorem,\nkh1[0,an ) , \u03beik \u2264 lim supkh1[0,an ) , \u03be k ik \u2264\nk\u2192\u221e\n\n1\n.\nn\n\nSo \u03be \u2208 An , which implies that An \u2282 MI is closed for each n. By definition\nof the Skorohod topology, the set\nBn = {\u03b6(*) \u2208 D([0, \u221e), MI ) : \u03b6(t) \u2208 An for all t \u2208 [0, T )}\nis closed in D([0, \u221e), MI ) for each n. Thus, since Z\u0304 q \u21d2 Z, (5.48) and the\nPortmanteau theorem imply that\n(5.49)\n\nP(Z \u2208 Bn ) \u2265 lim inf P(Z\u0304 q \u2208 Bn ) \u2265 1 \u2212\nq\u2192\u221e\n\n1\n.\nn2\n\n\f27\n\nFLUID LIMITS FOR BANDWIDTH SHARING\n\nWe deduce from (5.49) and the Borel\u2013Cantelli lemma that\n\u0012\n\nP\n\n\u0013\n\nsup kh1{0} , Z(t)ik = 0 \u2265 P\n\nt\u2208[0,T )\n\n\u221e \\\n\u221e\n[\n\n!\n\n{Z \u2208 Bn } = 1,\n\nk=1 n=k\n\nwhich proves (i).\nFix an outcome \u03c9 \u2208 \u03a90 and assume for the rest of the proof that all\nrandom objects are evaluated at this \u03c9. Property (ii) follows from (4.2) and\n(5.46). Property (iii) follows from (4.4) and (5.46), and property (iv) follows\nfrom (4.6) and (5.46).\nTo prove (v), fix t \u2265 0 and i \u2264 I. Since W\u0304iq (t) = h\u03c7, Z\u0304iq (t)i for all q, and\nsince W\u0304iq (t) \u2192 Wi (t) as q \u2192 \u221e by (5.46), it suffices to show that h\u03c7, Z\u0304iq (t)i \u2192\nw\nh\u03c7, Zi (t)i as q \u2192 \u221e. Since Z\u0304iq (t) \u2212\u2192 Zi (t) as q \u2192 \u221e, it suffices to show that\nthe q-indexed sequence of measures {Z\u0304iq (t)} is uniformly integrable. To this\nw\nend, note that if a sequence {\u03be q } \u2282 M satisfies \u03be q \u2212\u2192 \u03be and h\u03c7, \u03be q i \u2192 h\u03c7, \u03bei <\n\u221e, then {\u03be q } is uniformly integrable. Thus, {Z\u0304iq (0)} is uniformly integrable\nby the definition of \u03a91 and (5.46), and {L\u0304qi (t)} is uniformly integrable by\n(5.46). We conclude from the dynamic equation bound (5.3) that, for each\nx > 0,\nsuph\u03c71[x,\u221e), Z\u0304iq (t)i \u2264 sup(h\u03c71[x,\u221e) , Z\u0304iq (0)i + h\u03c71[x,\u221e) , L\u0304qi (t)i).\nq\n\nq\n\nSo uniform integrability of {Z\u0304iq (t)} follows from uniform integrability of\n{Z\u0304iq (0)} and {L\u0304qi (t)}.\nTo prove (vi), recall from the proof of Theorem 5.7 that T is uniformly\nLipschitz continuous with Lipschitz constant kCk. So, (vi) follows from (iv).\nTo prove (vii), fix i \u2264 I. Since Wi and Ti are uniformly Lipschitz continuous, they are both absolutely continuous. Let t > 0 be a regular point for\nboth Wi and Ti . Then \u1e86i (t) = \u03c1i \u2212 \u1e6ai (t) by (iv). If Zi (t) = 0, then Wi (t) = 0\nby (v). Since Wi is a nonnegative function, this implies that \u1e86i (t) = 0 and\nso \u1e6ai (t) = \u03c1i . Alternatively, suppose that Zi (t) > 0. By (ii), continuity of Zi\nimplies continuity of Zi . So Zi (s) > 0 for all s \u2208 [t, t + h] and all sufficiently\nsmall h > 0. In this case, (5.46), (4.3), continuity of \u039bi on {z \u2208 RI+ : zi > 0},\n(2.1), and the bounded convergence theorem, imply that\nTi (t + h) \u2212 Ti (t) = lim (T\u0304iq (t + h) \u2212 T\u0304iq (t))\nq\u2192\u221e\n\n(5.50)\n\n= lim\n\nZ\n\nq\u2192\u221e t\n\n=\n\nZ\n\nt+h\n\n\u039bi (Z\u0304 q (s)) ds\n\nt+h\n\nt\n\n\u039bi (Z(s)) ds.\n\nSince \u039bi (Z(*)) is continuous at t for Zi (t) > 0, it follows that\n(5.51)\n\n\u1e6ai (t) =\n\n\u001a\n\n\u039bi (Z(t)),\n\u03c1i ,\n\nif Zi (t) > 0,\nif Zi (t) = 0.\n\n\f28\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nSince almost every t > 0 is a regular point for Wi and Ti , (5.51) implies (vii).\nProperty (viii) follows because \u016ajq is nondecreasing for each q and j \u2264 J,\nand because \u016a q \u2192 U uniformly on compact time intervals by (5.46). \u0003\nThe next result establishes the family of dynamic equations satisfied by\nthe limit in (5.46).\nTheorem 5.9.\n\nAlmost surely, for all i \u2264 I, f \u2208 C, and t \u2265 0,\n\nhf, Zi (t)i = hf, Zi (0)i \u2212\n(5.52)\n+ \u03bdi hf, \u03b8i i\n\nZ\n\nZ\n\nt\n0\n\nhf \u2032 , Zi (s)i\n\n\u039bi (Z(s))\nds\nZi (s)\n\nt\n\n0\n\n1(0,\u221e) (Zi (s)) ds.\n\nRecall that the first integrand above is defined to be zero when Zi (s) = 0.\nProof of Theorem 5.9. All random objects in this proof are evaluated at a fixed outcome \u03c9 \u2208 \u03a90 such that (5.2), (5.46), (5.47) and the\nproperties listed in Lemma 5.8 hold. The theorem will be proved first for\nf \u2208 Cc , and an extension to C is made at the end. Recall that for f \u2208 Cc ,\nthe derivative f \u2032 has compact support and kf \u2032 k\u221e < \u221e. Note also that since\nf (0) = f \u2032 (0) = 0, there exists a constant Cf < \u221e such that |f (x)| \u2264 Cf x for\nall x \u2208 R+ . Therefore,\n(5.53)\n\n|hf, Zi (t)i| \u2264 Cf h\u03c7, Zi (t)i = Cf Wi (t)\n\nfor all t \u2265 0.\n\nThe following preliminary result is used several times in this proof.\nFor each fixed f \u2208 Cc , each i \u2264 I and each interval [s, t] \u2282 R+ satisfying\ninf u\u2208[s,t] Zi (u) > 0, we have\n(5.54)\n\nhf, Zi (t)i = hf, Zi (s)i \u2212\n\nZ\n\nt\ns\n\nhf \u2032 , Zi (u)i\n\n\u039bi (Z(u))\ndu + \u03bdi (t \u2212 s)hf, \u03b8i i.\nZi (u)\n\nTo see this, fix an f , i and interval [s, t] satisfying the assumption. By (5.46)\nand Lemma 5.8 (ii), Z\u0304iq (*) \u2192 Zi (*) as q \u2192 \u221e, uniformly on compact time\nintervals. Thus,\n(5.55)\n\nlim inf inf Z\u0304iq (u) > 0.\nq\u2192\u221e u\u2208[s,t]\n\nBy definition of \u03a92 , this implies that (5.47) holds for all sufficiently large q.\nLet q \u2192 \u221e in (5.47). Note that f and f \u2032 are elements of Cb (R+ ), and that \u039bi\nis continuous on {z \u2208 RI+ : zi > 0} (see Definition 2.1). Thus, (5.46) and (5.55)\nimply that for all q sufficiently large, the integrands in the second righthand term of (5.47) are uniformly bounded on [s, t] and converge pointwise\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n29\n\n. Apply bounded convergence to this term and\non [s, t] to hf \u2032 , Zi (*)i \u039biZ(Z(*))\ni (*)\napply (5.46) to the remaining terms in (5.47) to obtain (5.54).\nWe now proceed with the proof of the theorem. Fix f \u2208 Cc , i \u2264 I, and an\ninterval [s, t] \u2282 R+ with t > s. Define\n(5.56)\n\n\u03c40 = inf{u \u2208 [s, t] : Zi (u) = 0},\n\nwhere the infimum of the empty set is defined to be t. If \u03c40 > s, then\ninf u\u2208[s,\u03c4 ] Zi (u) > 0 for all intervals [s, \u03c4 ] \u2282 [s, \u03c40 ). So, for each such \u03c4 , (5.54)\nwith \u03c4 in place of t implies that\n(5.57)\n\n|hf, Zi (\u03c4 )i \u2212 hf, Zi (s)i| \u2264 (\u03c4 \u2212 s)kf \u2032 k\u221e kCk + (\u03c4 \u2212 s)\u03bdi kf k\u221e .\n\nSince both sides of (5.57) are continuous in \u03c4 , letting \u03c4 \u2191 \u03c40 yields\n(5.58)\n\n|hf, Zi (\u03c40 )i \u2212 hf, Zi (s)i| \u2264 (\u03c40 \u2212 s)kf \u2032 k\u221e kCk + (\u03c40 \u2212 s)\u03bdi kf k\u221e .\n\nNote that if \u03c40 = s, then (5.58) holds trivially. If \u03c40 < t, then Zi (\u03c40 ) = 0\nby continuity of Zi , and so hf, Zi (\u03c40 )i = Wi (\u03c40 ) = 0. Then by (5.53) and\nproperty (vi) of Lemma 5.8,\n|hf, Zi (t)i \u2212 hf, Zi (\u03c40 )i| = |hf, Zi (t)i| \u2264 Cf Wi (t)\n(5.59)\n\n= Cf |Wi (t) \u2212 Wi (\u03c40 )|\n\u2264 Cf (k\u03c1k + kCk)(t \u2212 \u03c40 ).\n\nIf \u03c40 = t, then (5.59) holds trivially. Combining (5.58) and (5.59) yields\n|hf, Zi (t)i \u2212 hf, Zi (s)i| \u2264 |hf, Zi (t)i \u2212 hf, Zi (\u03c40 )i|\n+ |hf, Zi (\u03c40 )i \u2212 hf, Zi (s)i|\n\u2264 Cf (k\u03c1k + kCk)(t \u2212 \u03c40 )\n+ (kf \u2032 k\u221e kCk + \u03bdi kf k\u221e )(\u03c40 \u2212 s)\n\u2264 Kf (t \u2212 s),\nwhere\nKf = Cf (k\u03c1k + kCk) + kf \u2032 k\u221e kCk + \u03bdi kf k\u221e .\nSince s \u2264 t were arbitrary, it follows that hf, Zi (*)i is uniformly Lipschitz\ncontinuous and is therefore absolutely continuous on R+ . Suppose t > 0 is\na regular point for both hf, Zi (*)i and Wi (*). If Zi (t) > 0, then by (5.54)\n(with [t, t + h] in place of [s, t]), and continuity of \u039bi on {z \u2208 RI+ : zi > 0}\n(see Definition 2.1),\n(5.60)\n\nhf, Zi (t + h)i \u2212 hf, Zi (t)i\n\u039bi (Z(t))\n= \u2212hf \u2032 , Zi (t)i\n+ \u03bdi hf, \u03b8i i.\nh\u21920\nh\nZi (t)\nlim\n\n\f30\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nIf Zi (t) = 0, then hf, Zi (t)i = Wi (t) = 0, and so \u1e86i (0) = 0 because Wi is a\nnonnegative function. Combining this with (5.53), we obtain\nlim sup\nh\u21920\n\nhf, Zi (t + h)i \u2212 hf, Zi (t)i\nhf, Zi (t + h)i\n= lim sup\nh\nh\nh\u21920\n\u2264 lim sup Cf\n\nWi (t + h)\nh\n\n= lim sup Cf\n\nWi (t + h) \u2212 Wi (t)\nh\n\nh\u21920\n\n(5.61)\n\nh\u21920\n\n= Cf |\u1e86i (t)| = 0.\nCombining (5.60) and (5.61), we obtain\n(5.62)\n\n\u039bi (Z(t))\n\uf8f2\nd\n\u2212hf \u2032 , Zi (t)i\n+ \u03bdi hf, \u03b8i i,\nhf, Zi (t)i =\nZi (t)\n\uf8f3\ndt\n0,\n\uf8f1\n\nZi (t) > 0,\nZi (t) = 0.\n\nThe set of all t \u2208 (0, \u221e) that are regular points for both hf, Zi (*)i and Wi (*)\nhas full Lebesgue measure, so (5.52) follows from (5.62).\nThis proves the theorem for f \u2208 Cc . To extend to C, choose functions\n{gn : n \u2208 N} \u2282 C1b (R+ ) such that 1[0,n] \u2264 gn \u2264 1[0,n+1] and kgn\u2032 k\u221e \u2264 2 for all\nn. For f \u2208 C, define fn = f gn so that fn \u2208 Cc for all n. Then for all n \u2208 N\nand t \u2265 0,\nhfn , Zi (t)i = hfn , Zi (0)i \u2212\n(5.63)\n+ \u03bdi hfn , \u03b8i i\n\nZ\n\n0\n\nZ\n\n0\n\nt\n\nhfn\u2032 , Zi (s)i\n\n\u039bi (Z(s))\nds\nZi (s)\n\nt\n\n1(0,\u221e) (Zi (s)) ds.\n\nSince fn \u2192 f pointwise and boundedly as n \u2192 \u221e, the bounded convergence\ntheorem implies that the left-hand side, as well as the first and third terms\non the right-hand side of (5.63), converge to the corresponding terms of\n(5.52) as n \u2192 \u221e. Similarly, fn\u2032 \u2192 f \u2032 pointwise and boundedly as n \u2192 \u221e. So,\nthe integrand in the second right-hand term of (5.63) converges pointwise\non [0, t] to hf \u2032 , Zi (*)i \u039bZi (Z(*)\nas n \u2192 \u221e. For each n \u2208 N,\ni (*)\nsup hfn\u2032 , Zi (s)i\n\ns\u2208[0,t]\n\n\u039bi (Z(s))\n\u2264 kfn\u2032 k\u221e kCk \u2264 (kf \u2032 k\u221e + 2kf k\u221e )kCk.\nZi (s)\n\nSo, the bounded convergence theorem implies that the second right-hand\nterm in (5.63) converges to the corresponding term in (5.52) as n \u2192 \u221e. \u0003\nProof of Theorem 4.1. The sequence {(Z\u0304 r , Z\u0304 r , T\u0304 r , \u016a r , W\u0304 r )} is Ctight by Theorem 5.7. Let (Z, Z, T, U, W ) be a weak limit point of this\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n31\n\nsequence. Then by Theorem 5.9 and properties (i)\u2013(v), (vii) and (viii) of\nLemma 5.8, Z is almost surely a fluid model solution with auxiliary functions\n(Z, T, U, W ) for the data (A, C, \u039b, \u03bd, \u03b8) (see Definitions 3.1 and 3.2), and\nW (t) is finite for all t \u2265 0. \u0003\n6. Invariant states for fluid model under weighted \u03b1-fair policies. In\nthis section, we consider the special case of weighted \u03b1-fair policies. Fix fluid\nmodel data (A, C, \u039b, \u03bd, \u03b8), where \u039b is a weighted \u03b1-fair bandwidth sharing\npolicy with parameters (\u03b1, \u03ba) as described in the example of Section 2.2.\nUnder a natural condition on the network parameters A, C, \u03bd and \u03b8, there\nexist fluid model solutions that are time invariant. This section identifies the\ncondition and characterizes the set of these invariant states.\nThe following representation of the weighted \u03b1-fair policy \u039b follows from\nLemma A.4 of [12]. (Although it is assumed at the beginning of [12] that A\nhas full row rank, this property is not used in the proof of Lemma A.4 in\n[12], and hence the result holds without restriction on the row rank of A.)\nProposition 6.1. For each z \u2208 RI+ , there exists at least one p \u2208 RJ+ ,\ndepending on z, such that\n(6.1)\nwhere\n(6.2)\n\n\u0012\n\n\u039bi (z) = zi P\np j Cj \u2212\n\n\u03bai\nj\u2264J pj Aji\n\nX\ni\u2264I\n\n\u00131/\u03b1\n!\n\nAji \u039bi (z) = 0\n\nfor all i \u2208 I+ (z),\n\nfor all j \u2264 J.\n\nThe (pj : j \u2264 J) are Lagrange multipliers for the optimization problem\n(2.3)\u2013(2.5), one for each of the capacity constraints in (2.4). Note that for\neach i \u2208 I+ (z), the bandwidth \u039bi (z) > 0 by Definition 2.1(i), and zi > 0 by\ndefinition. Thus, (6.1) implies that the denominator on the right-hand side\nof (6.1) does not vanish.\nDefinition 6.2. A vector of measures \u03be \u2208 MI is an invariant state for\nthe fluid model if there is a fluid model solution \u03b6(*) satisfying \u03b6(t) = \u03be for\nall t \u2265 0.\nThe following notation helps describe invariant states. Recall that \u03bci =\nh\u03c7, \u03b8i i\u22121 and \u03c1i = \u03bdi /\u03bci for i \u2264 I. Also recall that I+ (z) = {i \u2264 I : zi > 0}\nand I0 (z) = {i \u2264 I : zi = 0} for z \u2208 RI+ . Let\nP = {z \u2208 RI+ : \u039bi (z) = \u03c1i for all i \u2208 I+ (z)}.\n\n\f32\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nFor each i \u2264 I, let \u03b8ei denote the excess lifetime distribution associated with\n\u03b8i . The probability measure \u03b8ei is absolutely continuous with density\npei (x) = \u03bci h1(x,\u221e) , \u03b8i i,\nTheorem 6.3.\nonly if\n\nx \u2208 R+ .\n\nThere exist invariant states for the fluid model if and\n\n(6.3)\n\nA\u03c1 \u2264 C.\n\nWhen (6.3) holds, the set of invariant states is given by\n(6.4)\n\nM = {\u03be \u2208 MI : \u03bei = zi \u03b8ei for all i \u2264 I and some z \u2208 P}.\n\nProof. Suppose that \u03be is an invariant state and let \u03b6(*) \u2261 \u03be be the\ncorresponding fluid model solution with auxiliary functions (z, \u03c4, u) given\nby Definition 3.1 (we omit w here). Then z is a constant vector, denoted\nz = h1, \u03bei. For each f \u2208 C, i \u2208 I+ (z) and t \u2265 0, property (iii) of Definition\n3.2 yields\nhf, \u03bei i = hf, \u03bei i \u2212 thf \u2032 , \u03bei i\n\n(6.5)\n\n\u039bi (z)\n+ t\u03bdi hf, \u03b8i i.\nzi\n\nSince (cf. Proposition 3.1 in [20]),\nhf, \u03b8i i =\n\n(6.6)\n\n1 \u2032 e\nhf , \u03b8i i\n\u03bci\n\nfor all f \u2208 C,\n\ncanceling like terms in (6.5) yields\nhf \u2032 , \u03bei i\n\n(6.7)\n\n\u039bi (z)\n= \u03c1i hf \u2032 , \u03b8ei i.\nzi\n\nReplacing f by a suitable sequence of functions {fn } \u2282 C satisfying fn\u2032 \u2265 0\nand fn\u2032 \u2191 1(0,\u221e) , the monotone convergence theorem implies that (6.7) holds\nwith f \u2032 \u2261 1(0,\u221e) . So by property (i) of Definition 3.2, and since \u03b8ei does not\ncharge {0},\n(6.8)\n\n\u039bi (z) = \u03c1i\n\nfor all i \u2208 I+ (z).\n\nSince zi = 0 for i \u2208 I0 (z), this implies by Definition 3.1 that for all t \u2265 0,\n(6.9) \u03c4i (t) =\n\nZ\n\n0\n\nt\n\n(\u039bi (z)1(0,\u221e) (zi ) + \u03c1i 1{0} (zi )) ds = \u03c1i t\n\nfor all i \u2264 I.\n\nThus, u(t) = Ct \u2212 A\u03c1t = (C \u2212 A\u03c1)t for all t \u2265 0. Since u is nondecreasing by\nproperty (ii) of Definition 3.2, (6.3) holds. Moreover, substituting (6.8) into\n(6.7) and canceling \u03c1i yields\nhf \u2032 , \u03bei i\n= hf \u2032 , \u03b8ei i\nzi\n\nfor all f \u2208 C and i \u2208 I+ (z).\n\n\f33\n\nFLUID LIMITS FOR BANDWIDTH SHARING\n\nThis implies (in the same manner as in the proof of Theorem 1.1 in [20])\nthat\n\u03bei = zi \u03b8ei\n\n(6.10)\n\nfor all i \u2208 I+ (z).\n\nSince \u03bei = 0 for all i \u2208 I0 (z), combining (6.10) with (6.8) implies that \u03be \u2208 M.\nTo prove the converse, suppose that (6.3) holds and let \u03be \u2208 M. Define\n\u03b6(t) = \u03be for all t \u2265 0, and let (z, \u03c4, u) be the auxiliary functions of \u03b6 given by\nDefinition 3.1. Since \u03b8ei does not charge {0} \u2282 R+ for each i \u2264 I, \u03b6(*) satisfies\nproperty (i) of Definition 3.2. Note that z = h1, \u03bei is a constant vector, and\nthat z \u2208 P because \u03be \u2208 M. Thus, \u03c4 satisfies (6.9) and so u(t) = Ct \u2212 A\u03c1t =\n(C \u2212 A\u03c1)t for all t \u2265 0. By (6.3), uj is nondecreasing for all j \u2264 J, and so\nproperty (ii) of Definition 3.2 holds. Let f \u2208 C and i \u2208 I+ (z). Since \u03be \u2208 M\nand z \u2208 P, (6.6) implies that for all t \u2265 0,\nthf \u2032 , \u03bei i\n\n\u039bi (z)\n= t\u03c1i hf \u2032 , \u03b8ei i = t\u03bdi hf, \u03b8i i.\nzi\n\nThus, (6.5) holds and so \u03b6 satisfies property (iii) of Definition 3.2 for i \u2208\nI+ (z). This property holds for i \u2208\n/ I+ (z) since then all terms are zero. Thus,\n\u03b6 is a fluid model solution. Note that M is nonempty because \u03be = 0 is in\nM. \u0003\nUnder condition (6.3), the set P can be characterized using results in\nKelly and Williams [12]. (Although it was assumed in [12] that A has full\nrow rank, as we explain below, the results that we cite below from [12] hold\nwithout that additional restriction.) Let\n(\n\nJ\u2217 = j \u2264 J :\n\nX\n\nAji \u03c1i = Cj\n\ni\u2264I\n\n)\n\nand let J\u2217 = |J\u2217 |. For z \u2208 RI+ , define\nF (z) =\n\n1 X\nzi\n\u03bdi \u03bai \u03bc\u03b1\u22121\ni\n\u03b1 + 1 i\u2264I\n\u03bdi\n\u0012\n\n\u0013\u03b1+1\n\n.\n\nWhen J\u2217 6= \u2205, define \u2206 : RJ+\u2217 \u2192 RI+ by\n(\n\n\u2206(w) = arg min F (z) : z\n\n\u2208 RI+\n\n)\n\nzi\nAji \u2265 wj for all j \u2208 J\u2217 .\nand\n\u03bci\ni\u2264I\nX\n\nFor each j \u2208 J\u2217 , Aji > 0 for some i \u2264 I. It follows that the feasible set for\nthe above optimization problem is nonempty. Then since F is nonnegative,\ncontinuous, strictly convex and satisfies F (z) \u2192 \u221e as kzk \u2192 \u221e, \u2206(w) is well\ndefined as the unique minimum of the optimization problem.\n\n\f34\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nLemma 6.4. Assume that (6.3) holds. If J\u2217 = \u2205, then P = {0} and the\nonly invariant state is \u03be = 0. If J\u2217 6= \u2205, then the following three conditions\nare equivalent:\n(i) z \u2208 P,\nP\n(ii) for some q \u2208 RJ+\u2217 , zi = \u03c1i ( \u03ba1i j\u2208J\u2217 qj Aji )1/\u03b1 for all i \u2264 I,\nP\n(iii) z = \u2206(w(z)), where wj (z) = i\u2264I Aji \u03bczii for all j \u2208 J\u2217 .\n\nProof. If J\u2217 = \u2205, then A\u03c1 < C. In this case, there is no z 6= 0 such\nthat \u039bi (z) = \u03c1i for all i \u2208 I+ (z). This follows because for z 6= 0, the optimal\nsolution \u039b(z) of the concave optimization problem (2.3)\u2013(2.5) must have\none of the constraints binding, that is, (A\u039b(z))j = Cj for some j \u2264 J. (For\nthis, we use the fact that there is at least one route i, which necessarily uses\nat least one resource j, and hence there is at least one i and j such that\nAji > 0.) It follows that P = {0} when J\u2217 = \u2205.\nIf J\u2217 6= \u2205, then the three equivalent characterizations of P follow from\nLemma 5.1 and Theorems 5.1 and 5.3 in [12]. (At the beginning of [12],\nit is assumed that A has full row rank. However, scrutiny of the proofs of\nLemma 5.1 and Theorems 5.1 and 5.3 of that paper reveals that the above\nequivalence still holds without this additional assumption. Indeed, one only\nneeds the weaker property that for each j \u2208 J\u2217 , the jth row of A has at least\none nonzero entry. This property holds here by the definition of J\u2217 .) \u0003\n\nAPPENDIX\nProof of Theorem 5.1.\nload process\n\nFor each r \u2208 R, define a simplified fluid scaled\n\u230art\u230b\n\n(A.1)\n\nV\u0304ir (t) =\n\n1X\n\u03b4vr ,\nr k=1 ik\n\nt \u2265 0, i \u2264 I\n\nand let \u03b8(t) = t\u03b8 for all t \u2265 0. We first show that\n(A.2)\n\n(V\u0304 r (*), h\u03c7, V\u0304 r (*)i) \u21d2 (\u03b8(*), h\u03c7, \u03b8(*)i)\n\nas r \u2192 \u221e.\n\nSince for each r \u2208 R, t \u2265 0, and i \u2264 I, h\u03c7, \u03b8i i = 1/\u03bci and\nh\u03c7, V\u0304ir (t)i =\n\n\u230art\u230b \u0012\n\n1\n\u230art\u230b 1 X r\nvik \u2212 r\nr \u230art\u230b k=1\n\u03bci\n\n\u0013\n\n+\n\n\u230art\u230b\n,\nr\u03bcri\n\nthe second component of (A.2) follows from assumptions (4.12), (4.13) and\na functional weak law of large numbers. Note that for each K > 0, the set\n{\u03be \u2208 MI : kh1 \u2228 \u03c7, \u03beik \u2264 K} is relatively compact in MI (see [11], Theorem\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n35\n\n15.7.5). For each T > 0, supt\u2208[0,T ] kh1 \u2228 \u03c7, V\u0304 r (t)ik \u2264 T \u2228 kh\u03c7, V\u0304 r (T )ik, and so\nthe second component of (A.2) implies the compact containment condition\n(A.3)\n\nr\n\nlim lim inf P\n\nK\u2192\u221e r\u2192\u221e\n\n\u0012\n\nr\n\n\u0013\n\nsup kh1 \u2228 \u03c7, V\u0304 (t)ik \u2264 K = 1.\n\nt\u2208[0,T ]\n\nMoreover, for all r \u2208 R, i \u2264 I, t \u2265 s \u2265 0, and all nonempty closed B \u2282 R+ ,\n(A.1) implies the two inequalities\nh1B , V\u0304ir (s)i \u2264 h1B , V\u0304ir (t)i \u2264 h1B t\u2212s , V\u0304ir (t)i + t \u2212 s,\n\u230art\u230b\n\nh1B , V\u0304ir (t)i = h1B , V\u0304ir (s)i +\n\n1 X\nr\n1B (vik\n) \u2264 h1B t\u2212s , V\u0304ir (s)i + t \u2212 s.\nr k=\u230ars\u230b+1\n\nSo by (1.1) and (1.2),\ndI [V\u0304 r (s), V\u0304 r (t)] \u2264 t \u2212 s\n\nfor all r \u2208 R and t \u2265 s \u2265 0.\n\nOn combining this with (A.3), we see that {V\u0304 r (*)} is C-tight. Let {V\u0304 q (*)} \u2282\n{V\u0304 r (*)} be a weakly convergent subsequence with almost surely continuous\nlimit V(*). Then by the continuous mapping theorem, for all f \u2208 Cb (R+ ),\n(A.4)\n\nhf, V\u0304 q (*)i \u21d2 hf, V(*)i\n\nas q \u2192 \u221e.\n\nOn the other hand, for each q, f \u2208 Cb (R+ ), t \u2265 0, and i \u2264 I,\n\u230aqt\u230b\n\nhf, V\u0304iq (t)i =\n\n\u230aqt\u230b\n\u230aqt\u230b 1 X\nq\nhf, \u03b8qi i.\n) \u2212 hf, \u03b8qi i) +\n(f (vik\nq \u230aqt\u230b k=1\nq\n\nAssumptions (4.11)\u2013(4.13), and a functional weak law of large numbers imply that hf, V\u0304 q (*)i \u21d2 hf, \u03b8(*)i as q \u2192 \u221e for each f \u2208 Cb (R+ ). Combining\nwith (A.4), we see that V(*) \u2261 \u03b8(*) almost surely, and so V\u0304 r (*) \u21d2 \u03b8(*) as\nr \u2192 \u221e. Since the limits are deterministic, the convergence in (A.2) is indeed\njoint.\nBy assumption (4.10), \u0112 r (*) \u21d2 \u03bd(*) as r \u2192 \u221e. Since L\u0304r (*) = V\u0304 r (\u0112 r (*))\nand h\u03c7, \u03b8(\u03bd(*))i = \u03c1(*), (A.2) and the random time change theorem imply\n(5.1). \u0003\nProof of Lemma 5.2. Let \u03a9r1 be an event of probability one on which\n(5.2) holds and fix \u03c9 \u2208 \u03a9r1 . For the rest of the proof, all random objects are\nevaluated at this particular \u03c9. Fix i \u2264 I, f \u2208 Cc , and let [s, t] be an interval\nsatisfying inf u\u2208[s,t] Z\u0304ir (u) > 0. It suffices to show (5.7). Since Z\u0304ir (*) is right\ncontinuous with finite left limits, there exist \u03b5, M \u2208 (0, \u221e) such that\n(A.5)\n\n\u03b5 \u2264 inf Z\u0304ir (u) \u2264 sup Z\u0304ir (u) \u2264 M.\nu\u2208[s,t]\n\nu\u2208[s,t]\n\nLet l = t \u2212 s and, for n, j \u2208 N, let tj = s + jl/n and tj = tj+1 . For each n,\nhf, Z\u0304ir (t)i \u2212 hf, Z\u0304ir (s)i =\n\nn\u22121\nX\n\n(hf, Z\u0304ir (tj )i \u2212 hf, Z\u0304ir (tj )i).\n\nj=0\n\n\f36\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nAdd and subtract a term in each summand to get\nhf, Z\u0304ir (t)i \u2212 hf, Z\u0304ir (s)i =\n\nn\u22121\nX\n\n(hf, Z\u0304ir (tj )i \u2212 hf (* \u2212 S\u0304ir (tj , tj )), Z\u0304ir (tj )i)\n\nj=0\n\n+\n\nn\u22121\nX\n\n(hf (* \u2212 S\u0304ir (tj , tj )), Z\u0304ir (tj )i \u2212 hf, Z\u0304ir (tj )i).\n\nj=0\n\nUse the dynamic equation (5.2) in the first term and rewrite the second term\non the right to obtain\nhf, Z\u0304ir (t)i \u2212 hf, Z\u0304ir (s)i =\n(A.6)\n\nn\u22121\nX\n\n1\nr\nj=0\n+\n\nr \u0112ir (tj )\nr\nr \u22121 j\nf (vik\n\u2212 S\u0304ir (Uik\nr , t ))\n\nX\n\nk=r \u0112ir (tj )+1\n\nn\u22121\nX\n\nhf (* \u2212 S\u0304ir (tj , tj )) \u2212 f (*), Z\u0304ir (tj )i.\n\nj=0\n\nDenote the first and second right-hand terms in (A.6) by arn and brn , respectively, and consider first arn . Since f \u2208 Cc , a first-order Taylor expansion of\neach summand yields\nr\nr \u22121 j\nr\nf (vik\n\u2212 S\u0304ir (Uik\nr , t )) = f (vik\n) + f \u2032 (wjk )hkj ,\n\n(A.7)\n\nr r \u22121 , tj ) and w k \u2208 R is in the interval\nwhere for each j and k, hkj = \u2212S\u0304ir (Uik\nj\nr\nk\nr\nr\n\u22121\nj\n[vik + hj , vik ]. Since Uik r \u2208 (tj , t ] for each pair j, k in (A.7), (2.1) and\n(A.5) imply that\n\nZ tj\nk\nmax |hj | \u2264 max\nj\nj,k\ntj\n\n(A.8)\n\n\u039bi (Z\u0304 r (u))\nlkCk\n.\ndu \u2264\nr\nn\u03b5\nZ\u0304i (u)\n\nUsing (A.7) and (A.8), deduce that for each n,\n|arn\n\n\u2212 (hf, L\u0304ri (t)i \u2212 hf, L\u0304ri (s)i)| =\n\narn\n\n1\n\u2212\nr\n\nn\u22121\nX\n\n1\n=\nr\nj=0\n\nr \u0112ir (t)\n\nX\n\nr\nf (vik\n)\n\nk=r \u0112ir (s)+1\nr \u0112ir (tj )\n\nX\n\nf \u2032 (wjk )hkj\n\nk=r \u0112ir (tj )+1\n\n\u2264 (\u0112ir (t) \u2212 \u0112ir (s))kf \u2032 k\u221e\nSo as n \u2192 \u221e,\n(A.9)\n\narn \u2192 (hf, L\u0304ri (t)i \u2212 hf, L\u0304ri (s)i).\n\nlkCk\n.\nn\u03b5\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n37\n\nNext, consider brn . Another first-order Taylor expansion for each x \u2208 R+\nand j \u2208 {0, . . . , n \u2212 1} yields\nf (x \u2212 S\u0304ir (tj , tj )) \u2212 f (x) = f \u2032 (wjx )hj ,\n\n(A.10)\n\nwhere hj = \u2212S\u0304ir (tj , tj ) and wjx \u2208 R is in the interval [x + hj , x]. Define\n\u039bi (Z\u0304 r (u))\nZ\u0304ir (u)\nu\u2208[tj ,tj )\n\nzj = sup\n\n(A.11)\n\nand let h\u0303j = \u2212zj l/n. Combine terms and bound the integrand to obtain\nbrn \u2212\n\nn\u22121\nX\n\nhf \u2032 h\u0303j , Z\u0304ir (tj )i\n\nj=0\n\nn\u22121\nX\n\nhf (* \u2212 S\u0304ir (tj , tj )) \u2212 f (*) \u2212 f \u2032 (*)h\u0303j , Z\u0304ir (tj )i\n\n=\n\nj=0\n\n\u2264\n\nn\u22121\nX\n\nsup|f (x \u2212 S\u0304ir (tj , tj )) \u2212 f (x) \u2212 f \u2032 (x)h\u0303j |h1, Z\u0304ir (tj )i.\n\nj=0 x\u2208R\n\nApply (A.5) and (A.10) to get\nbrn \u2212\n\nn\u22121\nX\n\nhf \u2032 h\u0303j , Z\u0304ir (tj )i\n\nj=0\n\n(A.12)\n\n\u2264\n\nn\u22121\nX\n\nsup |f \u2032 (wjx )hj \u2212 f \u2032 (x)h\u0303j |h1, Z\u0304ir (tj )i\n\nj=0 x\u2208R\n\n\u2264M\n\nn\u22121\nX\n\nsup(|f \u2032 (wjx ) \u2212 f \u2032 (x)khj | + |f \u2032 (x)khj \u2212 h\u0303j |).\n\nj=0 x\u2208R\n\nSince wjx \u2208 [x + hj , x] for each j \u2208 {0, . . . , n \u2212 1} and x \u2208 R, deduce from the\ndefinition of hj , S\u0304ir (tj , tj ), and from (2.1) and (A.5), that\n(A.13)\n\n|wjx\n\n\u2212 x| \u2264 |hj | =\n\nZ\n\ntj\n\ntj\n\nlkCk\n\u039bi (Z\u0304 r (u))\ndu \u2264\n.\nr\nn\u03b5\nZ\u0304i (u)\n\nSince f \u2032 has compact support, it is uniformly continuous. Hence, there exists\na continuous nondecreasing function \u03c8f : R+ \u2192 R+ such that \u03c8f (0) = 0 and\nfor all h \u2208 R+ ,\n(A.14)\n\nsup |f \u2032 (x + h) \u2212 f \u2032 (x)| \u2264 \u03c8f (|h|).\nx\u2208R\n\n\f38\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\nWe deduce from (A.12)\u2013(A.14) that\nn\u22121\nX\n\nbrn \u2212\n\nhf \u2032 h\u0303j , Z\u0304ir (tj )i\n\nj=0\n\n(A.15)\n\n\u2264 M n\u03c8f\nLet \u03c6n (u) =\n(A.16)\n\nPn\u22121\nj=0\n\nn\u22121\nX\u0012\n\n\u0012\n\nn\u22121\nX\nl\nlkCk lkCk\n+ kf \u2032 k\u221e\nzj \u2212 S\u0304ir (tj , tj )\nn\u03b5\nn\u03b5\nn\nj=0\n\n\u0013\n\nj=0\n\n\u0013!\n\n.\n\nzj 1[tj ,tj ) (u) for each n \u2208 N and u \u2208 [tj , tj ]. Then\n\nl\n\u2212 S\u0304ir (tj , tj ) =\nn\n\nzj\n\n\u0012\n\n\u0013\n\nZ\n\nt\n\ns\n\n\u03c6n (u) du \u2212\n\nZ\n\nt\ns\n\n\u039bi (Z\u0304 r (u))\ndu.\nZ\u0304ir (u)\n\nObserve that \u03c6n (u) \u2192 \u039bi (Z\u0304 r (u))Z\u0304ir (u)\u22121 as n \u2192 \u221e, for all u \u2208 [s, t) at which\nthe latter function is continuous, which is at almost every u. So, by the\nbounded convergence theorem, (A.16) converges to zero as n \u2192 \u221e. This\nimplies, by definition of \u03c8f , that (A.15) converges to zero as n \u2192 \u221e. Note\nthat\nn\u22121\nX\n\nhf \u2032 h\u0303j , Z\u0304ir (tj )i = \u2212\n\nj=0\n\nn\u22121\nX\n\nl\nhf \u2032 , Z\u0304ir (tj )izj ,\nn\nj=0\n\nand that, as n \u2192 \u221e,\n\u2212\n\nn\u22121\nX\n\nhf \u2032 , Z\u0304ir (tj )izj\n\nj=0\n\nl\n\u2192\u2212\nn\n\nZ\n\ns\n\nt\n\nhf \u2032 , Z\u0304ir (u)i\n\n\u039bi (Z\u0304 r (u))\ndu,\nZ\u0304ir (u)\n\nby (A.11) and bounded convergence, since the integrand on the right is also\ncontinuous at almost every u. Conclude that, as n \u2192 \u221e,\n(A.17)\n\nbrn\n\n\u2192\u2212\n\nZ\n\ns\n\nt\n\nhf \u2032 , Z\u0304ir (u)i\n\n\u039bi (Z\u0304 r (u))\ndu.\nZ\u0304ir (u)\n\nCombining (A.6), (A.9) and (A.17) yields (5.7). \u0003\nREFERENCES\n[1] Bonald, T. and Massouli\u00e9, L. (2001). Impact of fairness on Internet performance.\nIn Proceedings of ACM Sigmetrics 2001 82\u201391.\n[2] Bramson, M. (2005). Stability of networks for max-min fair routing. Presentation\nat the 13th INFORMS Applied Probability Conference, Ottawa.\n[3] Chiang, M., Shah, D. and Tang, A. (2006). Stochastic stability under fair bandwidth allocation: General file size distribution. In Proceedings of the 44th Allerton Conference 899\u2013908.\n[4] Dai, J. G. (1995). On positive Harris recurrence of multiclass queueing networks: A unified approach via fluid limit models. Ann. Appl. Probab. 5 49\u201377.\nMRMR1325041\n\n\fFLUID LIMITS FOR BANDWIDTH SHARING\n\n39\n\n[5] de Veciana, G., Konstantopoulos, T. and Lee, T.-J. (2001). Stability and performance analysis of networks supporting elastic services. IEEE/ACM Transactions on Networking 9 2\u201314.\n[6] Ethier, S. N. and Kurtz, T. G. (1986). Markov Processes. Wiley, New York.\nMRMR838085\n[7] Gromoll, H. C., Puha, A. L. and Williams, R. J. (2002). The fluid limit of\na heavily loaded processor sharing queue. Ann. Appl. Probab. 12 797\u2013859.\nMRMR1925442\n[8] Gromoll, H. C. and Williams, R. J. (2008). Fluid model for a data network\nwith \u03b1-fair bandwidth sharing and general document size distributions: Two\nexamples of stability. In Proceedings of Markov Processes and Related Topics-\nA Festschrift (T. G. Kurtz, S. N. Ethier, J. Feng and R. H. Stockbridge, eds.).\nInstitute of Mathematical Statistics. Forthcoming.\n[9] Hansen, J., Reynolds, C. and Zachary, S. (2007). Stability of processor sharing\nnetworks with simultaneous resource requirements. J. Appl. Probab. 44 636\u2013651.\nMRMR2355581\n[10] Harrison, J. M. (2000). Brownian models of open processing networks: Canonical\nrepresentation of workload. Ann. Appl. Probab. 10 75\u2013103. Corr. 13 (2003) 390\u2013\n393. MRMR1765204\n[11] Kallenberg, O. (1986). Random Measures, 4th ed. Academic Press, London.\nMRMR0854102\n[12] Kelly, F. P. and Williams, R. J. (2004). Fluid model for a network operating under a fair bandwidth-sharing policy. Ann. Appl. Probab. 14 1055\u20131083.\nMRMR2071416\n[13] Key, P. and Massouli\u00e9, L. (2006). Fluid models of integrated traffic and multipath\nrouting. Queueing Syst. 53 85\u201398. MRMR2230015\n[14] Lakshmikantha, A., Beck, C. L. and Srikant, R. (2004). Connection level stability analysis of the internet using the sum of squares (sos) techniques. In\nConference on Information Sciences and Systems (Princeton, New Jersey).\n[15] Lin, X. and Shroff, N. (2004). On the stability region of congestion control. In\nProceedings of the 42nd Allerton Conference on Communications, Control and\nComputing 1266\u20131275.\n[16] Lin, X., Shroff, N. and Srikant, R. (2008). On the connection-level stability of\ncongestion-controlled communication networks. IEEE Trans. Inform. Theory 54\n2317\u20132338.\n[17] Massouli\u00e9, L. (2007). Structural properties of proportional fairness: Stability and\ninsensitivity. Ann. Appl. Probab. 17 809\u2013839. MRMR2326233\n[18] Massouli\u00e9, L. and Roberts, J. (2000). Bandwidth sharing and admission control\nfor elastic traffic. Telecommunication Systems 15 185\u2013201.\n[19] Mo, J. and Walrand, J. (2000). Fair end-to-end window-based congestion control.\nIEEE/ACM Transactions on Networking 8 556\u2013567.\n[20] Puha, A. L. and Williams, R. J. (2004). Invariant states and rates of convergence\nfor a critical fluid model of a processor sharing queue. Ann. Appl. Probab. 14\n517\u2013554. MRMR2052894\n[21] Srikant, R. (2004). On the positive recurrence of a Markov chain describing file\narrivals and departures in a congestion-controlled network. Presentation the\nIEEE Computer Communications Workshop.\n[22] Ye, H.-Q. (2003). Stability of data networks under an optimization-based bandwidth\nallocation. IEEE Trans. Automat. Control 48 1238\u20131242. MRMR1988097\n\n\f40\n\nH. C. GROMOLL AND R. J. WILLIAMS\n\n[23] Ye, H.-Q., Ou, J. and Yuan, X.-M. (2005). Stability of data networks: Stationary\nand bursty models. Oper. Res. 53 107\u2013125. MRMR2131101\nDepartment of Mathematics\nUniversity of Virginia\nCharlottesville, Virginia 22903\nUSA\nE-mail: gromoll@virginia.edu\n\nDepartment of Mathematics\nUniversity of California\nSan Diego\n9500 Gilman Drive\nLa Jolla, California 92093\nUSA\nE-mail: williams@math.ucsd.edu\n\n\f"}